<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>kerykeion API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#web-api"><strong>Web"></a></li>
</ul></li>
<li><a href="#kerykeion">Kerykeion</a>
<ul>
  <li><a href="#web-api"><strong>Web API</strong></a></li>
  <li><a href="#table-of-contents">Table of Contents</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#quick-start">Quick Start</a></li>
  <li><a href="#basic-usage">Basic Usage</a></li>
  <li><a href="#generate-a-svg-chart">Generate a SVG Chart</a></li>
  <li><a href="#wheel-only-charts">Wheel Only Charts</a></li>
  <li><a href="#report-generator">Report Generator</a></li>
  <li><a href="#ai-context-serializer">AI Context Serializer</a></li>
  <li><a href="#example-retrieving-aspects">Example: Retrieving Aspects</a></li>
  <li><a href="#element-quality-distribution-strategies">Element &amp; Quality Distribution Strategies</a></li>
  <li><a href="#ayanamsa-sidereal-modes">Ayanamsa (Sidereal Modes)</a></li>
  <li><a href="#house-systems">House Systems</a></li>
  <li><a href="#perspective-type">Perspective Type</a></li>
  <li><a href="#themes">Themes</a></li>
  <li><a href="#alternative-initialization">Alternative Initialization</a></li>
  <li><a href="#lunar-nodes-rahu-ketu">Lunar Nodes (Rahu &amp; Ketu)</a></li>
  <li><a href="#json-support">JSON Support</a></li>
  <li><a href="#documentation">Documentation</a></li>
  <li><a href="#development">Development</a></li>
  <li><a href="#integrating-kerykeion-into-your-project">Integrating Kerykeion into Your Project</a></li>
  <li><a href="#license">License</a></li>
  <li><a href="#contributing">Contributing</a></li>
  <li><a href="#citations">Citations</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#AspectsFactory">AspectsFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AspectsFactory.single_chart_aspects">single_chart_aspects</a>
                        </li>
                        <li>
                                <a class="function" href="#AspectsFactory.dual_chart_aspects">dual_chart_aspects</a>
                        </li>
                        <li>
                                <a class="function" href="#AspectsFactory.natal_aspects">natal_aspects</a>
                        </li>
                        <li>
                                <a class="function" href="#AspectsFactory.synastry_aspects">synastry_aspects</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AstrologicalSubjectFactory">AstrologicalSubjectFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AstrologicalSubjectFactory.from_birth_data">from_birth_data</a>
                        </li>
                        <li>
                                <a class="function" href="#AstrologicalSubjectFactory.from_iso_utc_time">from_iso_utc_time</a>
                        </li>
                        <li>
                                <a class="function" href="#AstrologicalSubjectFactory.from_current_time">from_current_time</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ChartDataFactory">ChartDataFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ChartDataFactory.create_chart_data">create_chart_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDataFactory.create_natal_chart_data">create_natal_chart_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDataFactory.create_synastry_chart_data">create_synastry_chart_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDataFactory.create_transit_chart_data">create_transit_chart_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDataFactory.create_composite_chart_data">create_composite_chart_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDataFactory.create_return_chart_data">create_return_chart_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDataFactory.create_single_wheel_return_chart_data">create_single_wheel_return_chart_data</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#ChartDataModel">ChartDataModel</a>
            </li>
            <li>
                    <a class="class" href="#SingleChartDataModel">SingleChartDataModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SingleChartDataModel.chart_type">chart_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.subject">subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.aspects">aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.element_distribution">element_distribution</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.quality_distribution">quality_distribution</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#SingleChartDataModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DualChartDataModel">DualChartDataModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#DualChartDataModel.chart_type">chart_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.first_subject">first_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.second_subject">second_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.aspects">aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.house_comparison">house_comparison</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.relationship_score">relationship_score</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.element_distribution">element_distribution</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.quality_distribution">quality_distribution</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#DualChartDataModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ElementDistributionModel">ElementDistributionModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ElementDistributionModel.fire">fire</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.earth">earth</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.air">air</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.water">water</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.fire_percentage">fire_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.earth_percentage">earth_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.air_percentage">air_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.water_percentage">water_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#ElementDistributionModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#QualityDistributionModel">QualityDistributionModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#QualityDistributionModel.cardinal">cardinal</a>
                        </li>
                        <li>
                                <a class="variable" href="#QualityDistributionModel.fixed">fixed</a>
                        </li>
                        <li>
                                <a class="variable" href="#QualityDistributionModel.mutable">mutable</a>
                        </li>
                        <li>
                                <a class="variable" href="#QualityDistributionModel.cardinal_percentage">cardinal_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#QualityDistributionModel.fixed_percentage">fixed_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#QualityDistributionModel.mutable_percentage">mutable_percentage</a>
                        </li>
                        <li>
                                <a class="variable" href="#QualityDistributionModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ChartDrawer">ChartDrawer</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ChartDrawer.__init__">ChartDrawer</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.first_obj">first_obj</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.second_obj">second_obj</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.chart_type">chart_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.theme">theme</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.double_chart_aspect_grid_type">double_chart_aspect_grid_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.chart_language">chart_language</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.transparent_background">transparent_background</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.external_view">external_view</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.show_house_position_comparison">show_house_position_comparison</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.custom_title">custom_title</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.fire">fire</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.earth">earth</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.air">air</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.water">water</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.first_circle_radius">first_circle_radius</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.second_circle_radius">second_circle_radius</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.third_circle_radius">third_circle_radius</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.width">width</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.language_settings">language_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.chart_colors_settings">chart_colors_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.planets_settings">planets_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.aspects_settings">aspects_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.available_planets_setting">available_planets_setting</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.height">height</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.location">location</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.geolat">geolat</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.geolon">geolon</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.template">template</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.show_cusp_position_comparison">show_cusp_position_comparison</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.show_degree_indicators">show_degree_indicators</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.show_aspect_icons">show_aspect_icons</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.auto_size">auto_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.chart_data">chart_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.main_radius">main_radius</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.available_kerykeion_celestial_points">available_kerykeion_celestial_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.t_available_kerykeion_celestial_points">t_available_kerykeion_celestial_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.cardinal">cardinal</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.fixed">fixed</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChartDrawer.mutable">mutable</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.set_up_theme">set_up_theme</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.generate_svg_string">generate_svg_string</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.save_svg">save_svg</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.generate_wheel_only_svg_string">generate_wheel_only_svg_string</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.save_wheel_only_svg_file">save_wheel_only_svg_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.generate_aspect_grid_only_svg_string">generate_aspect_grid_only_svg_string</a>
                        </li>
                        <li>
                                <a class="function" href="#ChartDrawer.save_aspect_grid_only_svg_file">save_aspect_grid_only_svg_file</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CompositeSubjectFactory">CompositeSubjectFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CompositeSubjectFactory.__init__">CompositeSubjectFactory</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.first_subject">first_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.second_subject">second_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.composite_chart_type">composite_chart_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.zodiac_type">zodiac_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.sidereal_mode">sidereal_mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.houses_system_identifier">houses_system_identifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.houses_system_name">houses_system_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.perspective_type">perspective_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.houses_names_list">houses_names_list</a>
                        </li>
                        <li>
                                <a class="variable" href="#CompositeSubjectFactory.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="function" href="#CompositeSubjectFactory.get_midpoint_composite_subject_model">get_midpoint_composite_subject_model</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EphemerisDataFactory">EphemerisDataFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EphemerisDataFactory.__init__">EphemerisDataFactory</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.start_datetime">start_datetime</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.end_datetime">end_datetime</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.step_type">step_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.step">step</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.lat">lat</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.lng">lng</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.tz_str">tz_str</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.is_dst">is_dst</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.zodiac_type">zodiac_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.sidereal_mode">sidereal_mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.houses_system_identifier">houses_system_identifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.perspective_type">perspective_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.max_days">max_days</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.max_hours">max_hours</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.max_minutes">max_minutes</a>
                        </li>
                        <li>
                                <a class="variable" href="#EphemerisDataFactory.dates_list">dates_list</a>
                        </li>
                        <li>
                                <a class="function" href="#EphemerisDataFactory.get_ephemeris_data">get_ephemeris_data</a>
                        </li>
                        <li>
                                <a class="function" href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects">get_ephemeris_data_as_astrological_subjects</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HouseComparisonFactory">HouseComparisonFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HouseComparisonFactory.__init__">HouseComparisonFactory</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonFactory.first_subject">first_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonFactory.second_subject">second_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonFactory.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="function" href="#HouseComparisonFactory.get_house_comparison">get_house_comparison</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HouseComparisonModel">HouseComparisonModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#HouseComparisonModel.first_subject_name">first_subject_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonModel.second_subject_name">second_subject_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonModel.first_points_in_second_houses">first_points_in_second_houses</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonModel.second_points_in_first_houses">second_points_in_first_houses</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonModel.first_cusps_in_second_houses">first_cusps_in_second_houses</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonModel.second_cusps_in_first_houses">second_cusps_in_first_houses</a>
                        </li>
                        <li>
                                <a class="variable" href="#HouseComparisonModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KerykeionException">KerykeionException</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KerykeionException.__init__">KerykeionException</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PlanetaryReturnFactory">PlanetaryReturnFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PlanetaryReturnFactory.__init__">PlanetaryReturnFactory</a>
                        </li>
                        <li>
                                <a class="variable" href="#PlanetaryReturnFactory.subject">subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#PlanetaryReturnFactory.online">online</a>
                        </li>
                        <li>
                                <a class="variable" href="#PlanetaryReturnFactory.cache_expire_after_days">cache_expire_after_days</a>
                        </li>
                        <li>
                                <a class="variable" href="#PlanetaryReturnFactory.altitude">altitude</a>
                        </li>
                        <li>
                                <a class="function" href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time">next_return_from_iso_formatted_time</a>
                        </li>
                        <li>
                                <a class="function" href="#PlanetaryReturnFactory.next_return_from_year">next_return_from_year</a>
                        </li>
                        <li>
                                <a class="function" href="#PlanetaryReturnFactory.next_return_from_date">next_return_from_date</a>
                        </li>
                        <li>
                                <a class="function" href="#PlanetaryReturnFactory.next_return_from_month_and_year">next_return_from_month_and_year</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PlanetReturnModel">PlanetReturnModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#PlanetReturnModel.return_type">return_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#PlanetReturnModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RelationshipScoreFactory">RelationshipScoreFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RelationshipScoreFactory.__init__">RelationshipScoreFactory</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.SCORE_MAPPING">SCORE_MAPPING</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.MAJOR_ASPECTS">MAJOR_ASPECTS</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.use_only_major_aspects">use_only_major_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.first_subject">first_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.second_subject">second_subject</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.score_value">score_value</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.relationship_score_description">relationship_score_description</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.is_destiny_sign">is_destiny_sign</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.relationship_score_aspects">relationship_score_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#RelationshipScoreFactory.score_breakdown">score_breakdown</a>
                        </li>
                        <li>
                                <a class="function" href="#RelationshipScoreFactory.get_relationship_score">get_relationship_score</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ReportGenerator">ReportGenerator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ReportGenerator.__init__">ReportGenerator</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReportGenerator.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#ReportGenerator.chart_type">chart_type</a>
                        </li>
                        <li>
                                <a class="function" href="#ReportGenerator.generate_report">generate_report</a>
                        </li>
                        <li>
                                <a class="function" href="#ReportGenerator.print_report">print_report</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KerykeionSettingsModel">KerykeionSettingsModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#KerykeionSettingsModel.language_settings">language_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionSettingsModel.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TransitsTimeRangeFactory">TransitsTimeRangeFactory</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TransitsTimeRangeFactory.__init__">TransitsTimeRangeFactory</a>
                        </li>
                        <li>
                                <a class="variable" href="#TransitsTimeRangeFactory.natal_chart">natal_chart</a>
                        </li>
                        <li>
                                <a class="variable" href="#TransitsTimeRangeFactory.ephemeris_data_points">ephemeris_data_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#TransitsTimeRangeFactory.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#TransitsTimeRangeFactory.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#TransitsTimeRangeFactory.settings_file">settings_file</a>
                        </li>
                        <li>
                                <a class="variable" href="#TransitsTimeRangeFactory.axis_orb_limit">axis_orb_limit</a>
                        </li>
                        <li>
                                <a class="function" href="#TransitsTimeRangeFactory.get_transit_moments">get_transit_moments</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#to_context">to_context</a>
            </li>
            <li>
                    <a class="class" href="#AstrologicalSubject">AstrologicalSubject</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AstrologicalSubject.__init__">AstrologicalSubject</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.NOW">NOW</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.json_dir">json_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.mean_node">mean_node</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.true_node">true_node</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.mean_south_node">mean_south_node</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.true_south_node">true_south_node</a>
                        </li>
                        <li>
                                <a class="function" href="#AstrologicalSubject.json">json</a>
                        </li>
                        <li>
                                <a class="function" href="#AstrologicalSubject.model">model</a>
                        </li>
                        <li>
                                <a class="function" href="#AstrologicalSubject.get">get</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.utc_time">utc_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#AstrologicalSubject.local_time">local_time</a>
                        </li>
                        <li>
                                <a class="function" href="#AstrologicalSubject.get_from_iso_utc_time">get_from_iso_utc_time</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#KerykeionChartSVG">KerykeionChartSVG</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#KerykeionChartSVG.__init__">KerykeionChartSVG</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.chart_type">chart_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.language_pack">language_pack</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.theme">theme</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.double_chart_aspect_grid_type">double_chart_aspect_grid_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.chart_language">chart_language</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.user">user</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.first_obj">first_obj</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.t_user">t_user</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.second_obj">second_obj</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.output_directory">output_directory</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.template">template</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.aspects_list">aspects_list</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.available_planets_setting">available_planets_setting</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.t_available_kerykeion_celestial_points">t_available_kerykeion_celestial_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.available_kerykeion_celestial_points">available_kerykeion_celestial_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.chart_colors_settings">chart_colors_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.planets_settings">planets_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.aspects_settings">aspects_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.language_settings">language_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.height">height</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.width">width</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.location">location</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.geolat">geolat</a>
                        </li>
                        <li>
                                <a class="variable" href="#KerykeionChartSVG.geolon">geolon</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeTemplate">makeTemplate</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeSVG">makeSVG</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeWheelOnlyTemplate">makeWheelOnlyTemplate</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeWheelOnlySVG">makeWheelOnlySVG</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeAspectGridOnlyTemplate">makeAspectGridOnlyTemplate</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeAspectGridOnlySVG">makeAspectGridOnlySVG</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.save_svg">save_svg</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.save_wheel_only_svg_file">save_wheel_only_svg_file</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.save_aspect_grid_only_svg_file">save_aspect_grid_only_svg_file</a>
                        </li>
                        <li>
                                <a class="function" href="#KerykeionChartSVG.makeGridOnlySVG">makeGridOnlySVG</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NatalAspects">NatalAspects</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NatalAspects.__init__">NatalAspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.user">user</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.new_settings_file">new_settings_file</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.language_pack">language_pack</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.celestial_points">celestial_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.aspects_settings">aspects_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.axes_orbit_settings">axes_orbit_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.all_aspects">all_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#NatalAspects.relevant_aspects">relevant_aspects</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SynastryAspects">SynastryAspects</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SynastryAspects.__init__">SynastryAspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.first_user">first_user</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.second_user">second_user</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.new_settings_file">new_settings_file</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.language_pack">language_pack</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.celestial_points">celestial_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.aspects_settings">aspects_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.axes_orbit_settings">axes_orbit_settings</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.active_points">active_points</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.active_aspects">active_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.all_aspects">all_aspects</a>
                        </li>
                        <li>
                                <a class="variable" href="#SynastryAspects.relevant_aspects">relevant_aspects</a>
                        </li>
                        <li>
                                <a class="function" href="#SynastryAspects.get_relevant_aspects">get_relevant_aspects</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
kerykeion    </h1>

                        <div class="docstring"><p>This is part of Kerykeion (C) 2025 Giacomo Battaglia</p>

<h1 id="kerykeion" align="center">Kerykeion</h1>

<div align="center">
    <img src="https://img.shields.io/github/stars/g-battaglia/kerykeion.svg?logo=github" alt="stars">
    <img src="https://img.shields.io/github/forks/g-battaglia/kerykeion.svg?logo=github" alt="forks">
</div>

<div align="center">
    <img src="https://static.pepy.tech/badge/kerykeion/month" alt="PyPI Downloads">
    <img src="https://static.pepy.tech/badge/kerykeion/week" alt="PyPI Downloads">
    <img src="https://static.pepy.tech/personalized-badge/kerykeion?period=total&units=INTERNATIONAL_SYSTEM&left_color=GREY&right_color=BLUE&left_text=downloads/total" alt="PyPI Downloads">
</div>

<div align="center">
    <img src="https://img.shields.io/pypi/v/kerykeion?label=pypi%20package" alt="Package version">
    <img src="https://img.shields.io/pypi/pyversions/kerykeion.svg" alt="Supported Python versions">
</div>

<p align="center"> Like this project? Star it on GitHub and help it grow! </p>

<p>&nbsp;</p>

<p>Kerykeion is a Python library for astrology. It computes planetary and house positions, detects aspects, and generates SVG chartsincluding birth, synastry, transit, and composite charts. You can also customize which planets to include in your calculations.</p>

<p>The main goal of this project is to offer a clean, data-driven approach to astrology, making it accessible and programmable.</p>

<p>Kerykeion also integrates seamlessly with LLM and AI applications.</p>

<p>Here is an example of a birthchart:</p>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Dark%20Theme%20-%20Natal%20Chart.svg" alt="John Lenon Chart" /></p>

<blockquote>
  <p><strong> For AI Agents &amp; LLMs</strong>
  If you're building LLM-powered applications (or if you are an AI agent ), see <a href="./AI_AGENT_GUIDE.md"><code>AI_AGENT_GUIDE.md</code></a> for a comprehensive, concise reference optimized for programmatic use and AI context.</p>
</blockquote>

<h2 id="web-api"><strong>Web API</strong></h2>

<p>If you want to use Kerykeion in a web application or for commercial or _closed-source_ purposes, you can try the dedicated web API:</p>

<p><strong><a href="https://rapidapi.com/gbattaglia/api/astrologer/pricing">AstrologerAPI</a></strong></p>

<p>It is <a href="https://github.com/g-battaglia/Astrologer-API">open source</a> and directly supports this project.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<ul>
<li><a href="#web-api"><strong>Web API</strong></a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#generate-a-svg-chart">Generate a SVG Chart</a>
<ul>
<li><a href="#birth-chart">Birth Chart</a></li>
<li><a href="#external-birth-chart">External Birth Chart</a></li>
<li><a href="#synastry-chart">Synastry Chart</a></li>
<li><a href="#transit-chart">Transit Chart</a></li>
<li><a href="#solar-return-chart-dual-wheel">Solar Return Chart (Dual Wheel)</a></li>
<li><a href="#solar-return-chart-single-wheel">Solar Return Chart (Single Wheel)</a></li>
<li><a href="#lunar-return-chart">Lunar Return Chart</a></li>
<li><a href="#composite-chart">Composite Chart</a></li>
</ul></li>
<li><a href="#wheel-only-charts">Wheel Only Charts</a>
<ul>
<li><a href="#birth-chart-1">Birth Chart</a></li>
<li><a href="#wheel-only-birth-chart-external">Wheel Only Birth Chart (External)</a></li>
<li><a href="#synastry-chart-1">Synastry Chart</a></li>
<li><a href="#change-the-output-directory">Change the Output Directory</a></li>
<li><a href="#change-language">Change Language</a></li>
<li><a href="#minified-svg">Minified SVG</a></li>
<li><a href="#svg-without-css-variables">SVG without CSS Variables</a></li>
<li><a href="#grid-only-svg">Grid Only SVG</a></li>
</ul></li>
<li><a href="#report-generator">Report Generator</a></li>
<li><a href="#ai-context-serializer">AI Context Serializer</a>
<ul>
<li><a href="#quick-examples">Quick Examples</a></li>
<li><a href="#section-access">Section Access</a></li>
</ul></li>
<li><a href="#example-retrieving-aspects">Example: Retrieving Aspects</a></li>
<li><a href="#element--quality-distribution-strategies">Element \&amp; Quality Distribution Strategies</a></li>
<li><a href="#ayanamsa-sidereal-modes">Ayanamsa (Sidereal Modes)</a></li>
<li><a href="#house-systems">House Systems</a></li>
<li><a href="#perspective-type">Perspective Type</a></li>
<li><a href="#themes">Themes</a></li>
<li><a href="#alternative-initialization">Alternative Initialization</a></li>
<li><a href="#lunar-nodes-rahu--ketu">Lunar Nodes (Rahu \&amp; Ketu)</a></li>
<li><a href="#json-support">JSON Support</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#development">Development</a></li>
<li><a href="#integrating-kerykeion-into-your-project">Integrating Kerykeion into Your Project</a></li>
<li><a href="#license">License</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#citations">Citations</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>Kerykeion requires <strong>Python 3.9</strong> or higher.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>pip3<span class="w"> </span>install<span class="w"> </span>kerykeion
</code></pre>
</div>

<h2 id="quick-start">Quick Start</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Example Person&quot;</span><span class="p">,</span>
    <span class="n">year</span><span class="o">=</span><span class="mi">1990</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">hour</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">12.4964</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">41.9028</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
<span class="n">chart_drawer</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">chart_drawer</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;example-natal&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chart saved to&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;example-natal.svg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
</code></pre>
</div>

<p>This script shows the recommended workflow:</p>

<ol>
<li>Create an <code><a href="#AstrologicalSubject">AstrologicalSubject</a></code> with explicit coordinates and timezone (offline mode).</li>
<li>Build a <code><a href="#ChartDataModel">ChartDataModel</a></code> through <code><a href="#ChartDataFactory">ChartDataFactory</a></code>.</li>
<li>Render the SVG via <code><a href="#ChartDrawer">ChartDrawer</a></code>, saving it to a controlled folder (<code>charts_output</code>).</li>
</ol>

<p>Use the same pattern for synastry, composite, transit, or return charts by swapping the factory method.</p>

<h2 id="basic-usage">Basic Usage</h2>

<p>Below is a simple example illustrating the creation of an astrological subject and retrieving astrological details:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>

<span class="c1"># Create an instance of the AstrologicalSubjectFactory class.</span>
<span class="c1"># Arguments: Name, year, month, day, hour, minutes, city, nation</span>
<span class="n">john</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Retrieve information about the Sun:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">john</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">())</span>
<span class="c1"># &gt; {&quot;name&quot;:&quot;Sun&quot;,&quot;quality&quot;:&quot;Cardinal&quot;,&quot;element&quot;:&quot;Air&quot;,&quot;sign&quot;:&quot;Lib&quot;,&quot;sign_num&quot;:6,&quot;position&quot;:16.26789199474399,&quot;abs_pos&quot;:196.267891994744,&quot;emoji&quot;:&quot;&quot;,&quot;point_type&quot;:&quot;AstrologicalPoint&quot;,&quot;house&quot;:&quot;Sixth_House&quot;,&quot;retrograde&quot;:false}</span>

<span class="c1"># Retrieve information about the first house:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">john</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">())</span>
<span class="c1"># &gt; {&quot;name&quot;:&quot;First_House&quot;,&quot;quality&quot;:&quot;Cardinal&quot;,&quot;element&quot;:&quot;Fire&quot;,&quot;sign&quot;:&quot;Ari&quot;,&quot;sign_num&quot;:0,&quot;position&quot;:19.74676624176799,&quot;abs_pos&quot;:19.74676624176799,&quot;emoji&quot;:&quot;&quot;,&quot;point_type&quot;:&quot;House&quot;,&quot;house&quot;:null,&quot;retrograde&quot;:null}</span>

<span class="c1"># Retrieve the element of the Moon sign:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">john</span><span class="o">.</span><span class="n">moon</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
<span class="c1"># &gt; &#39;Air&#39;</span>
</code></pre>
</div>

<blockquote>
  <p><strong>Working offline:</strong> pass <code>online=False</code> and specify <code>lng</code>, <code>lat</code>, and <code>tz_str</code> as shown above.<br />
  <strong>Working online:</strong> set <code>online=True</code> and provide <code>city</code>, <code>nation</code>, and a valid GeoNames username (see <code><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data()</a></code> for details).</p>
</blockquote>

<p><strong>To avoid using GeoNames online, specify longitude, latitude, and timezone instead of city and nation:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">john</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>  <span class="c1"># Longitude for Liverpool</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4000</span><span class="p">,</span>  <span class="c1"># Latitude for Liverpool</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>  <span class="c1"># Timezone for Liverpool</span>
    <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Liverpool&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<h2 id="generate-a-svg-chart">Generate a SVG Chart</h2>

<p>All chart-rendering examples below create a local <code>charts_output/</code> folder so the tests can write without touching your home directory. Feel free to change the path when integrating into your own projects.</p>

<p>To generate a chart, use the <code><a href="#ChartDataFactory">ChartDataFactory</a></code> to pre-compute chart data, then <code><a href="#ChartDrawer">ChartDrawer</a></code> to create the visualization. This two-step process ensures clean separation between astrological calculations and chart rendering.</p>

<p><strong>Tip:</strong>
The optimized way to open the generated SVG files is with a web browser (e.g., Chrome, Firefox).
To improve compatibility across different applications, you can use the <code>remove_css_variables</code> parameter when generating the SVG. This will inline all styles and eliminate CSS variables, resulting in an SVG that is more broadly supported.</p>

<h3 id="birth-chart">Birth Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">john</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">john</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>The SVG file is saved under <code>charts_output/john-lennon-natal.svg</code>.
<img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Natal%20Chart.svg" alt="John Lennon Birth Chart" /></p>

<h3 id="external-birth-chart">External Birth Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data for external natal chart</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-external&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20ExternalNatal%20-%20Natal%20Chart.svg" alt="John Lennon External Birth Chart" /></p>

<h3 id="synastry-chart">Synastry Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subjects</span>
<span class="n">first</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Paul McCartney&quot;</span><span class="p">,</span> <span class="mi">1942</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute synastry chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_synastry_chart_data">ChartDataFactory.create_synastry_chart_data</a></span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">synastry_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synastry_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;lennon-mccartney-synastry&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://www.kerykeion.net/img/examples/synastry-chart.svg" alt="John Lennon and Paul McCartney Synastry" /></p>

<h3 id="transit-chart">Transit Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subjects</span>
<span class="n">transit</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="mi">2025</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">84.3880</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">33.7490</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/New_York&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute transit chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_transit_chart_data">ChartDataFactory.create_transit_chart_data</a></span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">transit</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">transit_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">transit_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-transit&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Transit%20Chart.svg" alt="John Lennon Transit Chart" /></p>

<h3 id="solar-return-chart-dual-wheel">Solar Return Chart (Dual Wheel)</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.planetary_return_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlanetaryReturnFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create natal subject</span>
<span class="n">john</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Calculate Solar Return subject (offline example with manual coordinates)</span>
<span class="n">return_factory</span> <span class="o">=</span> <span class="n">PlanetaryReturnFactory</span><span class="p">(</span>
    <span class="n">john</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4000</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">solar_return_subject</span> <span class="o">=</span> <span class="n">return_factory</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="mi">1964</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;Solar&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Pre-compute return chart data (dual wheel: natal + solar return)</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_return_chart_data">ChartDataFactory.create_return_chart_data</a></span><span class="p">(</span><span class="n">john</span><span class="p">,</span> <span class="n">solar_return_subject</span><span class="p">)</span>

<span class="c1"># Step 4: Create visualization</span>
<span class="n">solar_return_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">solar_return_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-solar-return-dual&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20DualReturnChart%20Chart%20-%20Solar%20Return.svg" alt="John Lennon Solar Return Chart (Dual Wheel)" /></p>

<h3 id="solar-return-chart-single-wheel">Solar Return Chart (Single Wheel)</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.planetary_return_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlanetaryReturnFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create natal subject</span>
<span class="n">john</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Calculate Solar Return subject (offline example with manual coordinates)</span>
<span class="n">return_factory</span> <span class="o">=</span> <span class="n">PlanetaryReturnFactory</span><span class="p">(</span>
    <span class="n">john</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4000</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">solar_return_subject</span> <span class="o">=</span> <span class="n">return_factory</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="mi">1964</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;Solar&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Build a single-wheel return chart</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_single_wheel_return_chart_data">ChartDataFactory.create_single_wheel_return_chart_data</a></span><span class="p">(</span><span class="n">solar_return_subject</span><span class="p">)</span>

<span class="c1"># Step 4: Create visualization</span>
<span class="n">single_wheel_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">single_wheel_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-solar-return-single&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20Solar%20Return%20-%20SingleReturnChart%20Chart.svg" alt="John Lennon Solar Return Chart (Single Wheel)" /></p>

<h3 id="lunar-return-chart">Lunar Return Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.planetary_return_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlanetaryReturnFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create natal subject</span>
<span class="n">john</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Calculate Lunar Return subject</span>
<span class="n">return_factory</span> <span class="o">=</span> <span class="n">PlanetaryReturnFactory</span><span class="p">(</span>
    <span class="n">john</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4000</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">lunar_return_subject</span> <span class="o">=</span> <span class="n">return_factory</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="mi">1964</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;Lunar&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Build a dual wheel (natal + lunar return)</span>
<span class="n">lunar_return_chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_return_chart_data">ChartDataFactory.create_return_chart_data</a></span><span class="p">(</span><span class="n">john</span><span class="p">,</span> <span class="n">lunar_return_subject</span><span class="p">)</span>
<span class="n">dual_wheel_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">lunar_return_chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dual_wheel_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-lunar-return-dual&quot;</span><span class="p">)</span>

<span class="c1"># Optional: create a single-wheel lunar return</span>
<span class="n">single_wheel_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_single_wheel_return_chart_data">ChartDataFactory.create_single_wheel_return_chart_data</a></span><span class="p">(</span><span class="n">lunar_return_subject</span><span class="p">)</span>
<span class="n">single_wheel_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">single_wheel_data</span><span class="p">)</span>
<span class="n">single_wheel_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-lunar-return-single&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20DualReturnChart%20Chart%20-%20Lunar%20Return.svg" alt="John Lennon Lunar Return Chart (Dual Wheel)" /></p>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20Lunar%20Return%20-%20SingleReturnChart%20Chart.svg" alt="John Lennon Lunar Return Chart (Single Wheel)" /></p>

<h3 id="composite-chart">Composite Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeSubjectFactory</span><span class="p">,</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subjects (offline configuration)</span>
<span class="n">angelina</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Angelina Jolie&quot;</span><span class="p">,</span> <span class="mi">1975</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">118.2437</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">34.0522</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">brad</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Brad Pitt&quot;</span><span class="p">,</span> <span class="mi">1963</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">96.7069</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">35.3273</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Create composite subject</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">CompositeSubjectFactory</span><span class="p">(</span><span class="n">angelina</span><span class="p">,</span> <span class="n">brad</span><span class="p">)</span>
<span class="n">composite_model</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">get_midpoint_composite_subject_model</span><span class="p">()</span>

<span class="c1"># Step 3: Pre-compute composite chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_composite_chart_data">ChartDataFactory.create_composite_chart_data</a></span><span class="p">(</span><span class="n">composite_model</span><span class="p">)</span>

<span class="c1"># Step 4: Create visualization</span>
<span class="n">composite_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">composite_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;jolie-pitt-composite&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/Angelina%20Jolie%20and%20Brad%20Pitt%20Composite%20Chart%20-%20Composite%20Chart.svg" alt="Angelina Jolie and Brad Pitt Composite Chart" /></p>

<h2 id="wheel-only-charts">Wheel Only Charts</h2>

<p>For _all_ the charts, you can generate a wheel-only chart by using the method <code>makeWheelOnlySVG()</code>:</p>

<h3 id="birth-chart-2">Birth Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_wheel_only_svg_file</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-wheel&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Wheel%20Only%20-%20Natal%20Chart%20-%20Wheel%20Only.svg" alt="John Lennon Birth Chart" /></p>

<h3 id="wheel-only-birth-chart-external">Wheel Only Birth Chart (External)</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute external natal chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization (external wheel view)</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">,</span> <span class="n">external_view</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_wheel_only_svg_file</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-wheel-external&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Wheel%20External%20Only%20-%20ExternalNatal%20Chart%20-%20Wheel%20Only.svg" alt="John Lennon Birth Chart" /></p>

<h3 id="synastry-chart-2">Synastry Chart</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subjects</span>
<span class="n">first</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Paul McCartney&quot;</span><span class="p">,</span> <span class="mi">1942</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute synastry chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_synastry_chart_data">ChartDataFactory.create_synastry_chart_data</a></span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">synastry_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synastry_chart</span><span class="o">.</span><span class="n">save_wheel_only_svg_file</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;lennon-mccartney-synastry-wheel&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Wheel%20Synastry%20Only%20-%20Synastry%20Chart%20-%20Wheel%20Only.svg" alt="John Lennon and Paul McCartney Synastry" /></p>

<h3 id="change-the-output-directory">Change the Output Directory</h3>

<p>To save the SVG file in a custom location, specify the <code>output_path</code> parameter in <code>save_svg()</code>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subjects</span>
<span class="n">first</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Paul McCartney&quot;</span><span class="p">,</span> <span class="mi">1942</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute synastry chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_synastry_chart_data">ChartDataFactory.create_synastry_chart_data</a></span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization with custom output directory</span>
<span class="n">synastry_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synastry_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saved to&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">synastry_chart</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - Synastry Chart.svg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
</code></pre>
</div>

<h3 id="change-language">Change Language</h3>

<p>You can switch chart language by passing <code>chart_language</code> to the <code><a href="#ChartDrawer">ChartDrawer</a></code> class:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization with Italian language</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span>
    <span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">,</span>
    <span class="n">chart_language</span><span class="o">=</span><span class="s2">&quot;IT&quot;</span>  <span class="c1"># Change to Italian</span>
<span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-it&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>You can also provide custom labels (or introduce a brand-new language) by passing
a dictionary to <code>language_pack</code>. Only the keys you supply are merged on top of the
built-in strings:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="n">custom_labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PT&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="s2">&quot;Informaes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;celestial_points&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Sun&quot;</span><span class="p">:</span> <span class="s2">&quot;Sol&quot;</span><span class="p">,</span> <span class="s2">&quot;Moon&quot;</span><span class="p">:</span> <span class="s2">&quot;Lua&quot;</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">custom_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span>
    <span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">,</span>
    <span class="n">chart_language</span><span class="o">=</span><span class="s2">&quot;PT&quot;</span><span class="p">,</span>
    <span class="n">language_pack</span><span class="o">=</span><span class="n">custom_labels</span><span class="p">[</span><span class="s2">&quot;PT&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">custom_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-pt&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>More details <a href="https://www.kerykeion.net/docs/chart-language">here</a>.</p>

<p>The available languages are:</p>

<ul>
<li>EN (English)</li>
<li>FR (French)</li>
<li>PT (Portuguese)</li>
<li>ES (Spanish)</li>
<li>TR (Turkish)</li>
<li>RU (Russian)</li>
<li>IT (Italian)</li>
<li>CN (Chinese)</li>
<li>DE (German)</li>
</ul>

<h3 id="minified-svg">Minified SVG</h3>

<p>To generate a minified SVG, set <code>minify_svg=True</code> in the <code>makeSVG()</code> method:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span>
    <span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-minified&quot;</span><span class="p">,</span>
    <span class="n">minify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<h3 id="svg-without-css-variables">SVG without CSS Variables</h3>

<p>To generate an SVG without CSS variables, set <code>remove_css_variables=True</code> in the <code>makeSVG()</code> method:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">birth_chart_svg</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">birth_chart_svg</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span>
    <span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-no-css-variables&quot;</span><span class="p">,</span>
    <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>This will inline all styles and eliminate CSS variables, resulting in an SVG that is more broadly supported.</p>

<h3 id="grid-only-svg">Grid Only SVG</h3>

<p>It's possible to generate a grid-only SVG, useful for creating a custom layout. To do this, use the <code>save_aspect_grid_only_svg_file()</code> method:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subjects</span>
<span class="n">birth_chart</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Paul McCartney&quot;</span><span class="p">,</span> <span class="mi">1942</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute synastry chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_synastry_chart_data">ChartDataFactory.create_synastry_chart_data</a></span><span class="p">(</span><span class="n">birth_chart</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization with dark theme</span>
<span class="n">aspect_grid_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;dark&quot;</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">aspect_grid_chart</span><span class="o">.</span><span class="n">save_aspect_grid_only_svg_file</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;lennon-mccartney-aspect-grid&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://raw.githubusercontent.com/g-battaglia/kerykeion/refs/heads/main/tests/charts/svg/John%20Lennon%20-%20Aspect%20Grid%20Only%20-%20Natal%20Chart%20-%20Aspect%20Grid%20Only.svg" alt="John Lennon Birth Chart" /></p>

<h2 id="report-generator">Report Generator</h2>

<p><code><a href="#ReportGenerator">ReportGenerator</a></code> mirrors the chart-type dispatch of <code><a href="#ChartDrawer">ChartDrawer</a></code>. It accepts raw <code>AstrologicalSubjectModel</code> instances as well as any <code><a href="#ChartDataModel">ChartDataModel</a></code> produced by <code><a href="#ChartDataFactory">ChartDataFactory</a></code>including natal, composite, synastry, transit, and planetary return chartsand renders the appropriate textual report automatically.</p>

<h3 id="quick-examples">Quick Examples</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportGenerator</span><span class="p">,</span> <span class="n">AstrologicalSubjectFactory</span><span class="p">,</span> <span class="n">ChartDataFactory</span>

<span class="c1"># Subject-only report</span>
<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Sample Natal&quot;</span><span class="p">,</span> <span class="mi">1990</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">12.4964</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">41.9028</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ReportGenerator</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span><span class="o">.</span><span class="n">print_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Single-chart data (elements, qualities, aspects enabled)</span>
<span class="n">natal_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
<span class="n">ReportGenerator</span><span class="p">(</span><span class="n">natal_data</span><span class="p">)</span><span class="o">.</span><span class="n">print_report</span><span class="p">(</span><span class="n">max_aspects</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Dual-chart data (synastry, transit, dual return, )</span>
<span class="n">partner</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Sample Partner&quot;</span><span class="p">,</span> <span class="mi">1992</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">12.4964</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">41.9028</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">synastry_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_synastry_chart_data">ChartDataFactory.create_synastry_chart_data</a></span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span>
<span class="n">ReportGenerator</span><span class="p">(</span><span class="n">synastry_data</span><span class="p">)</span><span class="o">.</span><span class="n">print_report</span><span class="p">(</span><span class="n">max_aspects</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</code></pre>
</div>

<p>Each report contains:</p>

<ul>
<li>A chart-aware title summarising the subject(s) and chart type</li>
<li>Birth/event metadata and configuration settings</li>
<li>Celestial points with sign, position, <strong>daily motion</strong>, <strong>declination</strong>, retrograde flag, and house</li>
<li>House cusp tables for every subject involved</li>
<li>Lunar phase details when available</li>
<li>Element/quality distributions and active configuration summaries (for chart data)</li>
<li>Aspect listings tailored for single or dual charts, with symbols for type and movement</li>
<li>Dual-chart extras such as house comparisons and relationship scores (when provided by the data)</li>
</ul>

<h3 id="section-access">Section Access</h3>

<p>All section helpers remain available for targeted output:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportGenerator</span><span class="p">,</span> <span class="n">AstrologicalSubjectFactory</span><span class="p">,</span> <span class="n">ChartDataFactory</span>

<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Sample Natal&quot;</span><span class="p">,</span> <span class="mi">1990</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">12.4964</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">41.9028</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">natal_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">ReportGenerator</span><span class="p">(</span><span class="n">natal_data</span><span class="p">)</span>
<span class="n">sections</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">max_aspects</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
</code></pre>
</div>

<p>Refer to the refreshed <a href="https://www.kerykeion.net/report/">Report Documentation</a> for end-to-end examples covering every supported chart model.</p>

<h2 id="ai-context-serializer">AI Context Serializer</h2>

<p>The <code>context_serializer</code> module transforms Kerykeion data models into precise, non-qualitative text optimized for LLM consumption. It provides the essential "ground truth" data needed for AI agents to generate accurate astrological interpretations.</p>

<h3 id="quick-example">Quick Example</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span><span class="p">,</span> <span class="n">to_context</span>

<span class="c1"># Create a subject</span>
<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="mi">1990</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;London&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span>
<span class="p">)</span>

<span class="c1"># Generate AI-ready context</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">to_context</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>Output:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>Chart for John Doe
Birth data: 1990-01-01 12:00, London, GB
...
Celestial Points:
  - Sun at 10.81 in Capricorn in Tenth House, quality: Cardinal, element: Earth...
  - Moon at 25.60 in Aquarius in Eleventh House, quality: Fixed, element: Air...
</code></pre>
</div>

<p><strong>Key Features:</strong></p>

<ul>
<li><strong>Standardized Output:</strong> Consistent format for Natal, Synastry, Composite, and Return charts.</li>
<li><strong>Non-Qualitative:</strong> Provides raw data (positions, aspects) without interpretive bias.</li>
<li><strong>Prompt-Ready:</strong> Designed to be injected directly into system prompts.</li>
</ul>

<p>For comprehensive documentation and examples, see <a href="site/docs/context_serializer.md">site/docs/context_serializer.md</a>.</p>

<h2 id="example-retrieving-aspects">Example: Retrieving Aspects</h2>

<p>Kerykeion provides a unified <code><a href="#AspectsFactory">AspectsFactory</a></code> class for calculating astrological aspects within single charts or between two charts:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AspectsFactory</span><span class="p">,</span> <span class="n">AstrologicalSubjectFactory</span>

<span class="c1"># Create astrological subjects</span>
<span class="n">jack</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Jack&quot;</span><span class="p">,</span> <span class="mi">1990</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">12.4964</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">41.9028</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">jane</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Jane&quot;</span><span class="p">,</span> <span class="mi">1991</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">12.4964</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">41.9028</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># For single chart aspects (natal, return, composite, etc.)</span>
<span class="n">single_chart_result</span> <span class="o">=</span> <span class="n"><a href="#AspectsFactory.single_chart_aspects">AspectsFactory.single_chart_aspects</a></span><span class="p">(</span><span class="n">jack</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">single_chart_result</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span><span class="si">}</span><span class="s2"> aspects in Jack&#39;s chart&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">single_chart_result</span><span class="o">.</span><span class="n">aspects</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># For dual chart aspects (synastry, transits, comparisons, etc.)</span>
<span class="n">dual_chart_result</span> <span class="o">=</span> <span class="n"><a href="#AspectsFactory.dual_chart_aspects">AspectsFactory.dual_chart_aspects</a></span><span class="p">(</span><span class="n">jack</span><span class="p">,</span> <span class="n">jane</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dual_chart_result</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span><span class="si">}</span><span class="s2"> aspects between Jack and Jane&#39;s charts&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dual_chart_result</span><span class="o">.</span><span class="n">aspects</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Each AspectModel includes:</span>
<span class="c1"># - p1_name, p2_name: Planet/point names</span>
<span class="c1"># - aspect: Aspect type (conjunction, trine, square, etc.)</span>
<span class="c1"># - orbit: Orb tolerance in degrees</span>
<span class="c1"># - aspect_degrees: Exact degrees for the aspect (0, 60, 90, 120, 180, etc.)</span>
<span class="c1"># - color: Hex color code for visualization</span>
</code></pre>
</div>

<p><strong>Advanced Usage with Custom Settings:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># You can also customize aspect calculations with custom orb settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.settings.config_constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span>

<span class="c1"># Modify aspect settings if needed</span>
<span class="n">custom_aspects</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># ... modify as needed</span>

<span class="c1"># The factory automatically uses the configured settings for orb calculations</span>
<span class="c1"># and filters aspects based on relevance and orb thresholds</span>
</code></pre>
</div>

<h2 id="element-quality-distribution-strategies">Element &amp; Quality Distribution Strategies</h2>

<p><code><a href="#ChartDataFactory">ChartDataFactory</a></code> now offers two strategies for calculating element and modality totals. The default <code>"weighted"</code> mode leans on a curated map that emphasises core factors (for example <code>sun</code>, <code>moon</code>, and <code>ascendant</code> weight 2.0, angles such as <code>medium_coeli</code> 1.5, personal planets 1.5, social planets 1.0, outers 0.5, and minor bodies 0.30.8). Provide <code>distribution_method="pure_count"</code> when you want every active point to contribute equally.</p>

<p>You can refine the weighting without rebuilding the dictionary: pass lowercase point names to <code>custom_distribution_weights</code> and use <code>"__default__"</code> to override the fallback value applied to entries that are not listed explicitly.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span><span class="p">,</span> <span class="n">ChartDataFactory</span>

<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Sample&quot;</span><span class="p">,</span> <span class="mi">1986</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=</span><span class="mf">11.3426</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">44.4949</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/Rome&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Equal weighting: every active point counts once</span>
<span class="n">pure_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span>
    <span class="n">subject</span><span class="p">,</span>
    <span class="n">distribution_method</span><span class="o">=</span><span class="s2">&quot;pure_count&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Custom emphasis: boost the Sun, soften everything else</span>
<span class="n">weighted_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span>
    <span class="n">subject</span><span class="p">,</span>
    <span class="n">distribution_method</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
    <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;sun&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="s2">&quot;__default__&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pure_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">fire</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">weighted_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">fire</span><span class="p">)</span>
</code></pre>
</div>

<p>All convenience helpers (<code>create_synastry_chart_data</code>, <code>create_transit_chart_data</code>, returns, and composites) forward the same keyword-only parameters, so you can keep a consistent weighting scheme across every chart type.</p>

<p>For an extended walkthrough (including category breakdowns of the default map), see <code>site-docs/element_quality_distribution.md</code>.</p>

<h2 id="ayanamsa-sidereal-modes">Ayanamsa (Sidereal Modes)</h2>

<p>By default, the zodiac type is <strong>Tropical</strong>. To use <strong>Sidereal</strong>, specify the sidereal mode:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">johnny</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Johnny Depp&quot;</span><span class="p">,</span> <span class="mi">1963</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">87.1112</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">37.7719</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">zodiac_type</span><span class="o">=</span><span class="s2">&quot;Sidereal&quot;</span><span class="p">,</span>
    <span class="n">sidereal_mode</span><span class="o">=</span><span class="s2">&quot;LAHIRI&quot;</span>
<span class="p">)</span>
</code></pre>
</div>

<p>More examples <a href="https://www.kerykeion.net/docs//sidereal-modes/">here</a>.</p>

<p>Full list of supported sidereal modes <a href="https://www.kerykeion.net/pydocs/kerykeion/schemas/kr_literals.html#SiderealMode">here</a>.</p>

<h2 id="house-systems">House Systems</h2>

<p>By default, houses are calculated using <strong>Placidus</strong>. Configure a different house system as follows:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">johnny</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Johnny Depp&quot;</span><span class="p">,</span> <span class="mi">1963</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">87.1112</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">37.7719</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">houses_system_identifier</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
<span class="p">)</span>
</code></pre>
</div>

<p>More examples <a href="https://www.kerykeion.net/docs//houses-systems/">here</a>.</p>

<p>Full list of supported house systems <a href="https://www.kerykeion.net/pydocs/kerykeion/schemas/kr_literals.html#HousesSystem">here</a>.</p>

<p>So far all the available houses system in the Swiss Ephemeris are supported but the Gauquelin Sectors.</p>

<h2 id="perspective-type">Perspective Type</h2>

<p>By default, Kerykeion uses the <strong>Apparent Geocentric</strong> perspective (the most standard in astrology). Other perspectives (e.g., <strong>Heliocentric</strong>) can be set this way:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">johnny</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Johnny Depp&quot;</span><span class="p">,</span> <span class="mi">1963</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">87.1112</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">37.7719</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">perspective_type</span><span class="o">=</span><span class="s2">&quot;Heliocentric&quot;</span>
<span class="p">)</span>
</code></pre>
</div>

<p>More examples <a href="https://www.kerykeion.net/docs//perspective-type/">here</a>.</p>

<p>Full list of supported perspective types <a href="https://www.kerykeion.net/pydocs/kerykeion/schemas/kr_literals.html#PerspectiveType">here</a>.</p>

<h2 id="themes">Themes</h2>

<p>Kerykeion provides several chart themes:</p>

<ul>
<li><strong>Classic</strong> (default)</li>
<li><strong>Dark</strong></li>
<li><strong>Dark High Contrast</strong></li>
<li><strong>Light</strong></li>
<li><strong>Strawberry</strong></li>
<li><strong>Black &amp; White</strong> (optimized for monochrome printing)</li>
</ul>

<p>Each theme offers a distinct visual style, allowing you to choose the one that best suits your preferences or presentation needs. If you prefer more control over the appearance, you can opt not to set any theme, making it easier to customize the chart by overriding the default CSS variables. For more detailed instructions on how to apply themes, check the <a href="https://www.kerykeion.net/docs/theming">documentation</a></p>

<p>The Black &amp; White theme renders glyphs, rings, and aspects in solid black on light backgrounds, designed for crisp B/W prints (PDF or paper) without sacrificing legibility.</p>

<p>Here's an example of how to set the theme:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">dark_theme_subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon - Dark Theme&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span><span class="n">dark_theme_subject</span><span class="p">)</span>

<span class="c1"># Step 3: Create visualization with dark high contrast theme</span>
<span class="n">dark_theme_natal_chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;dark-high-contrast&quot;</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dark_theme_natal_chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;john-lennon-natal-dark-high-contrast&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://www.kerykeion.net/img/showcase/John%20Lennon%20-%20Dark%20-%20Natal%20Chart.svg" alt="John Lennon" /></p>

<h2 id="alternative-initialization">Alternative Initialization</h2>

<p>Create an <code>AstrologicalSubjectModel</code> from a UTC ISO 8601 string:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>

<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_iso_utc_time">AstrologicalSubjectFactory.from_iso_utc_time</a></span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Johnny Depp&quot;</span><span class="p">,</span>
    <span class="n">iso_utc_time</span><span class="o">=</span><span class="s2">&quot;1963-06-09T05:00:00Z&quot;</span><span class="p">,</span>
    <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Owensboro&quot;</span><span class="p">,</span>
    <span class="n">nation</span><span class="o">=</span><span class="s2">&quot;US&quot;</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">87.1112</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">37.7719</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span>
</code></pre>
</div>

<p>If you prefer automatic geocoding, set <code>online=True</code> and provide your GeoNames credentials via <code>geonames_username</code>.</p>

<h2 id="lunar-nodes-rahu-ketu">Lunar Nodes (Rahu &amp; Ketu)</h2>

<p>Kerykeion supports both <strong>True</strong> and <strong>Mean</strong> Lunar Nodes:</p>

<ul>
<li><strong>True North Lunar Node</strong>: <code>"true_node"</code> (name kept without "north" for backward compatibility).</li>
<li><strong>True South Lunar Node</strong>: <code>"true_south_node"</code>.</li>
<li><strong>Mean North Lunar Node</strong>: <code>"mean_node"</code> (name kept without "north" for backward compatibility).</li>
<li><strong>Mean South Lunar Node</strong>: <code>"mean_south_node"</code>.</li>
</ul>

<p>In instances of the classes used to generate aspects and SVG charts, only the mean nodes are active. To activate the true nodes, you need to pass the <code>active_points</code> parameter to the <code><a href="#ChartDataFactory">ChartDataFactory</a></code> methods.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>

<span class="c1"># Step 1: Create subject</span>
<span class="n">subject</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;John Lennon&quot;</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">2.9833</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">53.4</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Step 2: Pre-compute chart data with custom active points including true nodes</span>
<span class="n">chart_data</span> <span class="o">=</span> <span class="n"><a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a></span><span class="p">(</span>
    <span class="n">subject</span><span class="p">,</span>
    <span class="n">active_points</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Sun&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Moon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mercury&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Venus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mars&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Jupiter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Saturn&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Uranus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Neptune&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pluto&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mean_Node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mean_South_Node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;True_Node&quot;</span><span class="p">,</span>       <span class="c1"># Activates True North Node</span>
        <span class="s2">&quot;True_South_Node&quot;</span><span class="p">,</span> <span class="c1"># Activates True South Node</span>
        <span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Descendant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Imum_Coeli&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Step 3: Create visualization</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span><span class="n">chart_data</span><span class="o">=</span><span class="n">chart_data</span><span class="p">)</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;charts_output&quot;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">chart</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;johnny-depp-custom-points&quot;</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="json-support">JSON Support</h2>

<p>You can serialize the astrological subject (the base data used throughout the library) to JSON:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">kerykeion</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>

<span class="n">johnny</span> <span class="o">=</span> <span class="n"><a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a></span><span class="p">(</span>
    <span class="s2">&quot;Johnny Depp&quot;</span><span class="p">,</span> <span class="mi">1963</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">lng</span><span class="o">=-</span><span class="mf">87.1112</span><span class="p">,</span>
    <span class="n">lat</span><span class="o">=</span><span class="mf">37.7719</span><span class="p">,</span>
    <span class="n">tz_str</span><span class="o">=</span><span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span>
    <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">johnny</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="documentation">Documentation</h2>

<ul>
<li><strong>Docs</strong>: <a href="https://www.kerykeion.net/content/docs/">kerykeion.net/docs</a></li>
<li><strong>Examples</strong>: See the <code>examples/</code> folder for runnable code</li>
<li><strong>Auto Generated API Reference</strong>: <a href="https://www.kerykeion.net/pydocs/">kerykeion.net/pydocs</a></li>
</ul>

<h2 id="development">Development</h2>

<p>Clone the repository or download the ZIP via the GitHub interface.</p>

<h2 id="integrating-kerykeion-into-your-project">Integrating Kerykeion into Your Project</h2>

<p>If you would like to incorporate Kerykeion's astrological features into your application, please reach out via <a href="mailto:kerykeion.astrology@gmail.com?subject=Integration%20Request">email</a>. Whether you need custom features, support, or specialized consulting, I am happy to discuss potential collaborations.</p>

<h2 id="license">License</h2>

<p>This project is covered under the AGPL-3.0 License. For detailed information, please see the <a href="LICENSE">LICENSE</a> file. If you have questions, feel free to contact me at <a href="mailto:kerykeion.astrology@gmail.com?subject=Kerykeion">kerykeion.astrology@gmail.com</a>.</p>

<p>As a rule of thumb, if you use this library in a project, you should open-source that project under a compatible license. Alternatively, if you wish to keep your source closed, consider using the <a href="https://rapidapi.com/gbattaglia/api/astrologer/">AstrologerAPI</a>, which is AGPL-3.0 compliant and also helps support the project.</p>

<p>Since the AstrologerAPI is an external third-party service, using it does _not_ require your code to be open-source.</p>

<h2 id="contributing">Contributing</h2>

<p>Contributions are welcome! Feel free to submit pull requests or report issues.</p>

<p>By submitting a contribution, you agree to assign the copyright of that contribution to the maintainer. The project stays openly available under the AGPL for everyone, while the re-licensing option helps sustain future development. Your authorship remains acknowledged in the commit history and release notes.</p>

<h2 id="citations">Citations</h2>

<p>If using Kerykeion in published or academic work, please cite as follows:</p>

<pre><code>Battaglia, G. (2025). Kerykeion: A Python Library for Astrological Calculations and Chart Generation.
https://github.com/g-battaglia/kerykeion
</code></pre>
</div>

                        <input id="mod-kerykeion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-kerykeion-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">This is part of Kerykeion (C) 2025 Giacomo Battaglia</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">.. include:: ../README.md</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="c1"># Local</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.aspects</span><span class="w"> </span><span class="kn">import</span> <span class="n">AspectsFactory</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.astrological_subject_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstrologicalSubjectFactory</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.chart_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDataFactory</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.context_serializer</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_context</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.schemas</span><span class="w"> </span><span class="kn">import</span> <span class="n">KerykeionException</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.schemas.kr_models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">ChartDataModel</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="n">SingleChartDataModel</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">DualChartDataModel</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="n">ElementDistributionModel</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="n">QualityDistributionModel</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="n">HouseComparisonModel</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a><span class="p">)</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.charts.chart_drawer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChartDrawer</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.composite_subject_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeSubjectFactory</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.ephemeris_data_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">EphemerisDataFactory</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.house_comparison.house_comparison_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">HouseComparisonFactory</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.planetary_return_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlanetaryReturnFactory</span><span class="p">,</span> <span class="n">PlanetReturnModel</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.relationship_score_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">RelationshipScoreFactory</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.report</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReportGenerator</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">KerykeionSettingsModel</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.transits_time_range_factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransitsTimeRangeFactory</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.backword</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="n">AstrologicalSubject</span><span class="p">,</span>  <span class="c1"># Legacy wrapper</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="n">KerykeionChartSVG</span><span class="p">,</span>    <span class="c1"># Legacy wrapper</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="n">NatalAspects</span><span class="p">,</span>         <span class="c1"># Legacy wrapper</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="n">SynastryAspects</span><span class="p">,</span>      <span class="c1"># Legacy wrapper</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;AspectsFactory&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;AstrologicalSubjectFactory&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;ChartDataFactory&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;ChartDataModel&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;SingleChartDataModel&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="s2">&quot;DualChartDataModel&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="s2">&quot;ElementDistributionModel&quot;</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;QualityDistributionModel&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="s2">&quot;ChartDrawer&quot;</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>    <span class="s2">&quot;CompositeSubjectFactory&quot;</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>    <span class="s2">&quot;EphemerisDataFactory&quot;</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a>    <span class="s2">&quot;HouseComparisonFactory&quot;</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a>    <span class="s2">&quot;HouseComparisonModel&quot;</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a>    <span class="s2">&quot;KerykeionException&quot;</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a>    <span class="s2">&quot;PlanetaryReturnFactory&quot;</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a>    <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a>    <span class="s2">&quot;RelationshipScoreFactory&quot;</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a>    <span class="s2">&quot;ReportGenerator&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a>    <span class="s2">&quot;KerykeionSettingsModel&quot;</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a>    <span class="s2">&quot;TransitsTimeRangeFactory&quot;</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a>    <span class="s2">&quot;to_context&quot;</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">60</span></a>    <span class="c1"># Legacy (v4) exported names for backward compatibility</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">61</span></a>    <span class="s2">&quot;AstrologicalSubject&quot;</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">62</span></a>    <span class="s2">&quot;KerykeionChartSVG&quot;</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">63</span></a>    <span class="s2">&quot;NatalAspects&quot;</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">64</span></a>    <span class="s2">&quot;SynastryAspects&quot;</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">65</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="AspectsFactory">
                            <input id="AspectsFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AspectsFactory</span>:

                <label class="view-source-button" for="AspectsFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AspectsFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AspectsFactory-41"><a href="#AspectsFactory-41"><span class="linenos"> 41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AspectsFactory</span><span class="p">:</span>
</span><span id="AspectsFactory-42"><a href="#AspectsFactory-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-43"><a href="#AspectsFactory-43"><span class="linenos"> 43</span></a><span class="sd">    Unified factory class for creating both single chart and dual chart aspects analysis.</span>
</span><span id="AspectsFactory-44"><a href="#AspectsFactory-44"><span class="linenos"> 44</span></a>
</span><span id="AspectsFactory-45"><a href="#AspectsFactory-45"><span class="linenos"> 45</span></a><span class="sd">    This factory provides methods to calculate all aspects within a single chart or</span>
</span><span id="AspectsFactory-46"><a href="#AspectsFactory-46"><span class="linenos"> 46</span></a><span class="sd">    between two charts. It consolidates the common functionality between different</span>
</span><span id="AspectsFactory-47"><a href="#AspectsFactory-47"><span class="linenos"> 47</span></a><span class="sd">    types of aspect calculations while providing specialized methods for each type.</span>
</span><span id="AspectsFactory-48"><a href="#AspectsFactory-48"><span class="linenos"> 48</span></a>
</span><span id="AspectsFactory-49"><a href="#AspectsFactory-49"><span class="linenos"> 49</span></a><span class="sd">    The factory provides both comprehensive and filtered aspect lists based on orb settings</span>
</span><span id="AspectsFactory-50"><a href="#AspectsFactory-50"><span class="linenos"> 50</span></a><span class="sd">    and relevance criteria.</span>
</span><span id="AspectsFactory-51"><a href="#AspectsFactory-51"><span class="linenos"> 51</span></a>
</span><span id="AspectsFactory-52"><a href="#AspectsFactory-52"><span class="linenos"> 52</span></a><span class="sd">    Key Features:</span>
</span><span id="AspectsFactory-53"><a href="#AspectsFactory-53"><span class="linenos"> 53</span></a><span class="sd">        - Calculates aspects within a single chart (natal, returns, composite, etc.)</span>
</span><span id="AspectsFactory-54"><a href="#AspectsFactory-54"><span class="linenos"> 54</span></a><span class="sd">        - Calculates aspects between two charts (synastry, transits, comparisons, etc.)</span>
</span><span id="AspectsFactory-55"><a href="#AspectsFactory-55"><span class="linenos"> 55</span></a><span class="sd">        - Filters aspects based on orb thresholds</span>
</span><span id="AspectsFactory-56"><a href="#AspectsFactory-56"><span class="linenos"> 56</span></a><span class="sd">        - Applies stricter orb limits for chart axes (ASC, MC, DSC, IC)</span>
</span><span id="AspectsFactory-57"><a href="#AspectsFactory-57"><span class="linenos"> 57</span></a><span class="sd">        - Supports multiple subject types (natal, composite, planetary returns)</span>
</span><span id="AspectsFactory-58"><a href="#AspectsFactory-58"><span class="linenos"> 58</span></a>
</span><span id="AspectsFactory-59"><a href="#AspectsFactory-59"><span class="linenos"> 59</span></a><span class="sd">    Example:</span>
</span><span id="AspectsFactory-60"><a href="#AspectsFactory-60"><span class="linenos"> 60</span></a><span class="sd">        &gt;&gt;&gt; # For single chart aspects (natal, returns, etc.)</span>
</span><span id="AspectsFactory-61"><a href="#AspectsFactory-61"><span class="linenos"> 61</span></a><span class="sd">        &gt;&gt;&gt; johnny = AstrologicalSubjectFactory.from_birth_data(&quot;Johnny&quot;, 1963, 6, 9, 0, 0, &quot;Owensboro&quot;, &quot;US&quot;)</span>
</span><span id="AspectsFactory-62"><a href="#AspectsFactory-62"><span class="linenos"> 62</span></a><span class="sd">        &gt;&gt;&gt; single_chart_aspects = AspectsFactory.single_chart_aspects(johnny)</span>
</span><span id="AspectsFactory-63"><a href="#AspectsFactory-63"><span class="linenos"> 63</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="AspectsFactory-64"><a href="#AspectsFactory-64"><span class="linenos"> 64</span></a><span class="sd">        &gt;&gt;&gt; # For dual chart aspects (synastry, comparisons, etc.)</span>
</span><span id="AspectsFactory-65"><a href="#AspectsFactory-65"><span class="linenos"> 65</span></a><span class="sd">        &gt;&gt;&gt; john = AstrologicalSubjectFactory.from_birth_data(&quot;John&quot;, 1990, 1, 1, 12, 0, &quot;London&quot;, &quot;GB&quot;)</span>
</span><span id="AspectsFactory-66"><a href="#AspectsFactory-66"><span class="linenos"> 66</span></a><span class="sd">        &gt;&gt;&gt; jane = AstrologicalSubjectFactory.from_birth_data(&quot;Jane&quot;, 1992, 6, 15, 14, 30, &quot;Paris&quot;, &quot;FR&quot;)</span>
</span><span id="AspectsFactory-67"><a href="#AspectsFactory-67"><span class="linenos"> 67</span></a><span class="sd">        &gt;&gt;&gt; dual_chart_aspects = AspectsFactory.dual_chart_aspects(john, jane)</span>
</span><span id="AspectsFactory-68"><a href="#AspectsFactory-68"><span class="linenos"> 68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-69"><a href="#AspectsFactory-69"><span class="linenos"> 69</span></a>
</span><span id="AspectsFactory-70"><a href="#AspectsFactory-70"><span class="linenos"> 70</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-71"><a href="#AspectsFactory-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">single_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-72"><a href="#AspectsFactory-72"><span class="linenos"> 72</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-73"><a href="#AspectsFactory-73"><span class="linenos"> 73</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory-74"><a href="#AspectsFactory-74"><span class="linenos"> 74</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-75"><a href="#AspectsFactory-75"><span class="linenos"> 75</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-76"><a href="#AspectsFactory-76"><span class="linenos"> 76</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-77"><a href="#AspectsFactory-77"><span class="linenos"> 77</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SingleChartAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory-78"><a href="#AspectsFactory-78"><span class="linenos"> 78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-79"><a href="#AspectsFactory-79"><span class="linenos"> 79</span></a><span class="sd">        Create aspects analysis for a single astrological chart.</span>
</span><span id="AspectsFactory-80"><a href="#AspectsFactory-80"><span class="linenos"> 80</span></a>
</span><span id="AspectsFactory-81"><a href="#AspectsFactory-81"><span class="linenos"> 81</span></a><span class="sd">        This method calculates all astrological aspects (angular relationships)</span>
</span><span id="AspectsFactory-82"><a href="#AspectsFactory-82"><span class="linenos"> 82</span></a><span class="sd">        within a single chart. Can be used for any type of chart including:</span>
</span><span id="AspectsFactory-83"><a href="#AspectsFactory-83"><span class="linenos"> 83</span></a><span class="sd">        - Natal charts</span>
</span><span id="AspectsFactory-84"><a href="#AspectsFactory-84"><span class="linenos"> 84</span></a><span class="sd">        - Planetary return charts</span>
</span><span id="AspectsFactory-85"><a href="#AspectsFactory-85"><span class="linenos"> 85</span></a><span class="sd">        - Composite charts</span>
</span><span id="AspectsFactory-86"><a href="#AspectsFactory-86"><span class="linenos"> 86</span></a><span class="sd">        - Any other single chart type</span>
</span><span id="AspectsFactory-87"><a href="#AspectsFactory-87"><span class="linenos"> 87</span></a>
</span><span id="AspectsFactory-88"><a href="#AspectsFactory-88"><span class="linenos"> 88</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory-89"><a href="#AspectsFactory-89"><span class="linenos"> 89</span></a><span class="sd">            subject: The astrological subject for aspect calculation</span>
</span><span id="AspectsFactory-90"><a href="#AspectsFactory-90"><span class="linenos"> 90</span></a>
</span><span id="AspectsFactory-91"><a href="#AspectsFactory-91"><span class="linenos"> 91</span></a><span class="sd">        Kwargs:</span>
</span><span id="AspectsFactory-92"><a href="#AspectsFactory-92"><span class="linenos"> 92</span></a><span class="sd">            active_points: List of points to include in calculations</span>
</span><span id="AspectsFactory-93"><a href="#AspectsFactory-93"><span class="linenos"> 93</span></a><span class="sd">            active_aspects: List of aspects with their orb settings</span>
</span><span id="AspectsFactory-94"><a href="#AspectsFactory-94"><span class="linenos"> 94</span></a><span class="sd">            axis_orb_limit: Optional orb threshold applied to chart axes; when None, no special axis filter</span>
</span><span id="AspectsFactory-95"><a href="#AspectsFactory-95"><span class="linenos"> 95</span></a>
</span><span id="AspectsFactory-96"><a href="#AspectsFactory-96"><span class="linenos"> 96</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-97"><a href="#AspectsFactory-97"><span class="linenos"> 97</span></a><span class="sd">            SingleChartAspectsModel containing all calculated aspects data</span>
</span><span id="AspectsFactory-98"><a href="#AspectsFactory-98"><span class="linenos"> 98</span></a>
</span><span id="AspectsFactory-99"><a href="#AspectsFactory-99"><span class="linenos"> 99</span></a><span class="sd">        Example:</span>
</span><span id="AspectsFactory-100"><a href="#AspectsFactory-100"><span class="linenos">100</span></a><span class="sd">            &gt;&gt;&gt; johnny = AstrologicalSubjectFactory.from_birth_data(&quot;Johnny&quot;, 1963, 6, 9, 0, 0, &quot;Owensboro&quot;, &quot;US&quot;)</span>
</span><span id="AspectsFactory-101"><a href="#AspectsFactory-101"><span class="linenos">101</span></a><span class="sd">            &gt;&gt;&gt; chart_aspects = AspectsFactory.single_chart_aspects(johnny)</span>
</span><span id="AspectsFactory-102"><a href="#AspectsFactory-102"><span class="linenos">102</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Found {len(chart_aspects.aspects)} aspects&quot;)</span>
</span><span id="AspectsFactory-103"><a href="#AspectsFactory-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-104"><a href="#AspectsFactory-104"><span class="linenos">104</span></a>        <span class="c1"># Initialize settings and configurations</span>
</span><span id="AspectsFactory-105"><a href="#AspectsFactory-105"><span class="linenos">105</span></a>        <span class="n">celestial_points</span> <span class="o">=</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span>
</span><span id="AspectsFactory-106"><a href="#AspectsFactory-106"><span class="linenos">106</span></a>        <span class="n">aspects_settings</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_ASPECTS_SETTINGS</span>
</span><span id="AspectsFactory-107"><a href="#AspectsFactory-107"><span class="linenos">107</span></a>        <span class="c1"># Set active aspects with default fallback</span>
</span><span id="AspectsFactory-108"><a href="#AspectsFactory-108"><span class="linenos">108</span></a>        <span class="n">active_aspects_resolved</span> <span class="o">=</span> <span class="n">active_aspects</span> <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span>
</span><span id="AspectsFactory-109"><a href="#AspectsFactory-109"><span class="linenos">109</span></a>
</span><span id="AspectsFactory-110"><a href="#AspectsFactory-110"><span class="linenos">110</span></a>        <span class="c1"># Determine active points to use</span>
</span><span id="AspectsFactory-111"><a href="#AspectsFactory-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AspectsFactory-112"><a href="#AspectsFactory-112"><span class="linenos">112</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="AspectsFactory-113"><a href="#AspectsFactory-113"><span class="linenos">113</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AspectsFactory-114"><a href="#AspectsFactory-114"><span class="linenos">114</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="AspectsFactory-115"><a href="#AspectsFactory-115"><span class="linenos">115</span></a>                <span class="n">subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-116"><a href="#AspectsFactory-116"><span class="linenos">116</span></a>                <span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-117"><a href="#AspectsFactory-117"><span class="linenos">117</span></a>            <span class="p">)</span>
</span><span id="AspectsFactory-118"><a href="#AspectsFactory-118"><span class="linenos">118</span></a>
</span><span id="AspectsFactory-119"><a href="#AspectsFactory-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_create_single_chart_aspects_model</span><span class="p">(</span>
</span><span id="AspectsFactory-120"><a href="#AspectsFactory-120"><span class="linenos">120</span></a>            <span class="n">subject</span><span class="p">,</span>
</span><span id="AspectsFactory-121"><a href="#AspectsFactory-121"><span class="linenos">121</span></a>            <span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-122"><a href="#AspectsFactory-122"><span class="linenos">122</span></a>            <span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-123"><a href="#AspectsFactory-123"><span class="linenos">123</span></a>            <span class="n">aspects_settings</span><span class="p">,</span>
</span><span id="AspectsFactory-124"><a href="#AspectsFactory-124"><span class="linenos">124</span></a>            <span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory-125"><a href="#AspectsFactory-125"><span class="linenos">125</span></a>            <span class="n">celestial_points</span><span class="p">,</span>
</span><span id="AspectsFactory-126"><a href="#AspectsFactory-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-127"><a href="#AspectsFactory-127"><span class="linenos">127</span></a>
</span><span id="AspectsFactory-128"><a href="#AspectsFactory-128"><span class="linenos">128</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-129"><a href="#AspectsFactory-129"><span class="linenos">129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dual_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-130"><a href="#AspectsFactory-130"><span class="linenos">130</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-131"><a href="#AspectsFactory-131"><span class="linenos">131</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-132"><a href="#AspectsFactory-132"><span class="linenos">132</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory-133"><a href="#AspectsFactory-133"><span class="linenos">133</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-134"><a href="#AspectsFactory-134"><span class="linenos">134</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-135"><a href="#AspectsFactory-135"><span class="linenos">135</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-136"><a href="#AspectsFactory-136"><span class="linenos">136</span></a>        <span class="n">first_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AspectsFactory-137"><a href="#AspectsFactory-137"><span class="linenos">137</span></a>        <span class="n">second_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AspectsFactory-138"><a href="#AspectsFactory-138"><span class="linenos">138</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DualChartAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory-139"><a href="#AspectsFactory-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-140"><a href="#AspectsFactory-140"><span class="linenos">140</span></a><span class="sd">        Create aspects analysis between two astrological charts.</span>
</span><span id="AspectsFactory-141"><a href="#AspectsFactory-141"><span class="linenos">141</span></a>
</span><span id="AspectsFactory-142"><a href="#AspectsFactory-142"><span class="linenos">142</span></a><span class="sd">        This method calculates all astrological aspects (angular relationships)</span>
</span><span id="AspectsFactory-143"><a href="#AspectsFactory-143"><span class="linenos">143</span></a><span class="sd">        between planets and points in two different charts. Can be used for:</span>
</span><span id="AspectsFactory-144"><a href="#AspectsFactory-144"><span class="linenos">144</span></a><span class="sd">        - Synastry (relationship compatibility)</span>
</span><span id="AspectsFactory-145"><a href="#AspectsFactory-145"><span class="linenos">145</span></a><span class="sd">        - Transit comparisons</span>
</span><span id="AspectsFactory-146"><a href="#AspectsFactory-146"><span class="linenos">146</span></a><span class="sd">        - Composite vs natal comparisons</span>
</span><span id="AspectsFactory-147"><a href="#AspectsFactory-147"><span class="linenos">147</span></a><span class="sd">        - Any other dual chart analysis</span>
</span><span id="AspectsFactory-148"><a href="#AspectsFactory-148"><span class="linenos">148</span></a>
</span><span id="AspectsFactory-149"><a href="#AspectsFactory-149"><span class="linenos">149</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory-150"><a href="#AspectsFactory-150"><span class="linenos">150</span></a><span class="sd">            first_subject: The first astrological subject</span>
</span><span id="AspectsFactory-151"><a href="#AspectsFactory-151"><span class="linenos">151</span></a><span class="sd">            second_subject: The second astrological subject to compare with the first</span>
</span><span id="AspectsFactory-152"><a href="#AspectsFactory-152"><span class="linenos">152</span></a>
</span><span id="AspectsFactory-153"><a href="#AspectsFactory-153"><span class="linenos">153</span></a><span class="sd">        Kwargs:</span>
</span><span id="AspectsFactory-154"><a href="#AspectsFactory-154"><span class="linenos">154</span></a><span class="sd">            active_points: Optional list of celestial points to include in calculations.</span>
</span><span id="AspectsFactory-155"><a href="#AspectsFactory-155"><span class="linenos">155</span></a><span class="sd">                          If None, uses common points between both subjects.</span>
</span><span id="AspectsFactory-156"><a href="#AspectsFactory-156"><span class="linenos">156</span></a><span class="sd">            active_aspects: Optional list of aspect types with their orb settings.</span>
</span><span id="AspectsFactory-157"><a href="#AspectsFactory-157"><span class="linenos">157</span></a><span class="sd">                           If None, uses default aspect configuration.</span>
</span><span id="AspectsFactory-158"><a href="#AspectsFactory-158"><span class="linenos">158</span></a><span class="sd">            axis_orb_limit: Optional orb threshold for chart axes (applied to single chart calculations only)</span>
</span><span id="AspectsFactory-159"><a href="#AspectsFactory-159"><span class="linenos">159</span></a>
</span><span id="AspectsFactory-160"><a href="#AspectsFactory-160"><span class="linenos">160</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-161"><a href="#AspectsFactory-161"><span class="linenos">161</span></a><span class="sd">            DualChartAspectsModel: Complete model containing all calculated aspects data,</span>
</span><span id="AspectsFactory-162"><a href="#AspectsFactory-162"><span class="linenos">162</span></a><span class="sd">                                  including both comprehensive and filtered relevant aspects.</span>
</span><span id="AspectsFactory-163"><a href="#AspectsFactory-163"><span class="linenos">163</span></a>
</span><span id="AspectsFactory-164"><a href="#AspectsFactory-164"><span class="linenos">164</span></a><span class="sd">        Example:</span>
</span><span id="AspectsFactory-165"><a href="#AspectsFactory-165"><span class="linenos">165</span></a><span class="sd">            &gt;&gt;&gt; john = AstrologicalSubjectFactory.from_birth_data(&quot;John&quot;, 1990, 1, 1, 12, 0, &quot;London&quot;, &quot;GB&quot;)</span>
</span><span id="AspectsFactory-166"><a href="#AspectsFactory-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; jane = AstrologicalSubjectFactory.from_birth_data(&quot;Jane&quot;, 1992, 6, 15, 14, 30, &quot;Paris&quot;, &quot;FR&quot;)</span>
</span><span id="AspectsFactory-167"><a href="#AspectsFactory-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt; synastry = AspectsFactory.dual_chart_aspects(john, jane)</span>
</span><span id="AspectsFactory-168"><a href="#AspectsFactory-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Found {len(synastry.aspects)} aspects&quot;)</span>
</span><span id="AspectsFactory-169"><a href="#AspectsFactory-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-170"><a href="#AspectsFactory-170"><span class="linenos">170</span></a>        <span class="c1"># Initialize settings and configurations</span>
</span><span id="AspectsFactory-171"><a href="#AspectsFactory-171"><span class="linenos">171</span></a>        <span class="n">celestial_points</span> <span class="o">=</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span>
</span><span id="AspectsFactory-172"><a href="#AspectsFactory-172"><span class="linenos">172</span></a>        <span class="n">aspects_settings</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_ASPECTS_SETTINGS</span>
</span><span id="AspectsFactory-173"><a href="#AspectsFactory-173"><span class="linenos">173</span></a>        <span class="c1"># Set active aspects with default fallback</span>
</span><span id="AspectsFactory-174"><a href="#AspectsFactory-174"><span class="linenos">174</span></a>        <span class="n">active_aspects_resolved</span> <span class="o">=</span> <span class="n">active_aspects</span> <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span>
</span><span id="AspectsFactory-175"><a href="#AspectsFactory-175"><span class="linenos">175</span></a>
</span><span id="AspectsFactory-176"><a href="#AspectsFactory-176"><span class="linenos">176</span></a>        <span class="c1"># Determine active points to use - find common points between both subjects</span>
</span><span id="AspectsFactory-177"><a href="#AspectsFactory-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AspectsFactory-178"><a href="#AspectsFactory-178"><span class="linenos">178</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="AspectsFactory-179"><a href="#AspectsFactory-179"><span class="linenos">179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AspectsFactory-180"><a href="#AspectsFactory-180"><span class="linenos">180</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="AspectsFactory-181"><a href="#AspectsFactory-181"><span class="linenos">181</span></a>                <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-182"><a href="#AspectsFactory-182"><span class="linenos">182</span></a>                <span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-183"><a href="#AspectsFactory-183"><span class="linenos">183</span></a>            <span class="p">)</span>
</span><span id="AspectsFactory-184"><a href="#AspectsFactory-184"><span class="linenos">184</span></a>
</span><span id="AspectsFactory-185"><a href="#AspectsFactory-185"><span class="linenos">185</span></a>        <span class="c1"># Further filter with second subject&#39;s active points</span>
</span><span id="AspectsFactory-186"><a href="#AspectsFactory-186"><span class="linenos">186</span></a>        <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="AspectsFactory-187"><a href="#AspectsFactory-187"><span class="linenos">187</span></a>            <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-188"><a href="#AspectsFactory-188"><span class="linenos">188</span></a>            <span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-189"><a href="#AspectsFactory-189"><span class="linenos">189</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-190"><a href="#AspectsFactory-190"><span class="linenos">190</span></a>
</span><span id="AspectsFactory-191"><a href="#AspectsFactory-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_create_dual_chart_aspects_model</span><span class="p">(</span>
</span><span id="AspectsFactory-192"><a href="#AspectsFactory-192"><span class="linenos">192</span></a>            <span class="n">first_subject</span><span class="p">,</span>
</span><span id="AspectsFactory-193"><a href="#AspectsFactory-193"><span class="linenos">193</span></a>            <span class="n">second_subject</span><span class="p">,</span>
</span><span id="AspectsFactory-194"><a href="#AspectsFactory-194"><span class="linenos">194</span></a>            <span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-195"><a href="#AspectsFactory-195"><span class="linenos">195</span></a>            <span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-196"><a href="#AspectsFactory-196"><span class="linenos">196</span></a>            <span class="n">aspects_settings</span><span class="p">,</span>
</span><span id="AspectsFactory-197"><a href="#AspectsFactory-197"><span class="linenos">197</span></a>            <span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory-198"><a href="#AspectsFactory-198"><span class="linenos">198</span></a>            <span class="n">celestial_points</span><span class="p">,</span>
</span><span id="AspectsFactory-199"><a href="#AspectsFactory-199"><span class="linenos">199</span></a>            <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="n">first_subject_is_fixed</span><span class="p">,</span>
</span><span id="AspectsFactory-200"><a href="#AspectsFactory-200"><span class="linenos">200</span></a>            <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="n">second_subject_is_fixed</span><span class="p">,</span>
</span><span id="AspectsFactory-201"><a href="#AspectsFactory-201"><span class="linenos">201</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-202"><a href="#AspectsFactory-202"><span class="linenos">202</span></a>
</span><span id="AspectsFactory-203"><a href="#AspectsFactory-203"><span class="linenos">203</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-204"><a href="#AspectsFactory-204"><span class="linenos">204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_single_chart_aspects_model</span><span class="p">(</span>
</span><span id="AspectsFactory-205"><a href="#AspectsFactory-205"><span class="linenos">205</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-206"><a href="#AspectsFactory-206"><span class="linenos">206</span></a>        <span class="n">active_points_resolved</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span>
</span><span id="AspectsFactory-207"><a href="#AspectsFactory-207"><span class="linenos">207</span></a>        <span class="n">active_aspects_resolved</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">],</span>
</span><span id="AspectsFactory-208"><a href="#AspectsFactory-208"><span class="linenos">208</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-209"><a href="#AspectsFactory-209"><span class="linenos">209</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="AspectsFactory-210"><a href="#AspectsFactory-210"><span class="linenos">210</span></a>        <span class="n">celestial_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
</span><span id="AspectsFactory-211"><a href="#AspectsFactory-211"><span class="linenos">211</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SingleChartAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory-212"><a href="#AspectsFactory-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-213"><a href="#AspectsFactory-213"><span class="linenos">213</span></a><span class="sd">        Create the complete single chart aspects model with all calculations.</span>
</span><span id="AspectsFactory-214"><a href="#AspectsFactory-214"><span class="linenos">214</span></a>
</span><span id="AspectsFactory-215"><a href="#AspectsFactory-215"><span class="linenos">215</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-216"><a href="#AspectsFactory-216"><span class="linenos">216</span></a><span class="sd">            SingleChartAspectsModel containing filtered aspects data</span>
</span><span id="AspectsFactory-217"><a href="#AspectsFactory-217"><span class="linenos">217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-218"><a href="#AspectsFactory-218"><span class="linenos">218</span></a>        <span class="n">all_aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_calculate_single_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-219"><a href="#AspectsFactory-219"><span class="linenos">219</span></a>            <span class="n">subject</span><span class="p">,</span> <span class="n">active_points_resolved</span><span class="p">,</span> <span class="n">active_aspects_resolved</span><span class="p">,</span> <span class="n">aspects_settings</span><span class="p">,</span> <span class="n">celestial_points</span>
</span><span id="AspectsFactory-220"><a href="#AspectsFactory-220"><span class="linenos">220</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-221"><a href="#AspectsFactory-221"><span class="linenos">221</span></a>        <span class="n">filtered_aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_filter_relevant_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-222"><a href="#AspectsFactory-222"><span class="linenos">222</span></a>            <span class="n">all_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory-223"><a href="#AspectsFactory-223"><span class="linenos">223</span></a>            <span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory-224"><a href="#AspectsFactory-224"><span class="linenos">224</span></a>            <span class="n">apply_axis_orb_filter</span><span class="o">=</span><span class="n">axis_orb_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-225"><a href="#AspectsFactory-225"><span class="linenos">225</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-226"><a href="#AspectsFactory-226"><span class="linenos">226</span></a>
</span><span id="AspectsFactory-227"><a href="#AspectsFactory-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="n">SingleChartAspectsModel</span><span class="p">(</span>
</span><span id="AspectsFactory-228"><a href="#AspectsFactory-228"><span class="linenos">228</span></a>            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
</span><span id="AspectsFactory-229"><a href="#AspectsFactory-229"><span class="linenos">229</span></a>            <span class="n">aspects</span><span class="o">=</span><span class="n">filtered_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory-230"><a href="#AspectsFactory-230"><span class="linenos">230</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-231"><a href="#AspectsFactory-231"><span class="linenos">231</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-232"><a href="#AspectsFactory-232"><span class="linenos">232</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-233"><a href="#AspectsFactory-233"><span class="linenos">233</span></a>
</span><span id="AspectsFactory-234"><a href="#AspectsFactory-234"><span class="linenos">234</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-235"><a href="#AspectsFactory-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dual_chart_aspects_model</span><span class="p">(</span>
</span><span id="AspectsFactory-236"><a href="#AspectsFactory-236"><span class="linenos">236</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-237"><a href="#AspectsFactory-237"><span class="linenos">237</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-238"><a href="#AspectsFactory-238"><span class="linenos">238</span></a>        <span class="n">active_points_resolved</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span>
</span><span id="AspectsFactory-239"><a href="#AspectsFactory-239"><span class="linenos">239</span></a>        <span class="n">active_aspects_resolved</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">],</span>
</span><span id="AspectsFactory-240"><a href="#AspectsFactory-240"><span class="linenos">240</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-241"><a href="#AspectsFactory-241"><span class="linenos">241</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="AspectsFactory-242"><a href="#AspectsFactory-242"><span class="linenos">242</span></a>        <span class="n">celestial_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-243"><a href="#AspectsFactory-243"><span class="linenos">243</span></a>        <span class="n">first_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AspectsFactory-244"><a href="#AspectsFactory-244"><span class="linenos">244</span></a>        <span class="n">second_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AspectsFactory-245"><a href="#AspectsFactory-245"><span class="linenos">245</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DualChartAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory-246"><a href="#AspectsFactory-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-247"><a href="#AspectsFactory-247"><span class="linenos">247</span></a><span class="sd">        Create the complete dual chart aspects model with all calculations.</span>
</span><span id="AspectsFactory-248"><a href="#AspectsFactory-248"><span class="linenos">248</span></a>
</span><span id="AspectsFactory-249"><a href="#AspectsFactory-249"><span class="linenos">249</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory-250"><a href="#AspectsFactory-250"><span class="linenos">250</span></a><span class="sd">            first_subject: First astrological subject</span>
</span><span id="AspectsFactory-251"><a href="#AspectsFactory-251"><span class="linenos">251</span></a><span class="sd">            second_subject: Second astrological subject</span>
</span><span id="AspectsFactory-252"><a href="#AspectsFactory-252"><span class="linenos">252</span></a><span class="sd">            active_points_resolved: Resolved list of active celestial points</span>
</span><span id="AspectsFactory-253"><a href="#AspectsFactory-253"><span class="linenos">253</span></a><span class="sd">            active_aspects_resolved: Resolved list of active aspects with orbs</span>
</span><span id="AspectsFactory-254"><a href="#AspectsFactory-254"><span class="linenos">254</span></a><span class="sd">            aspects_settings: Chart aspect configuration settings</span>
</span><span id="AspectsFactory-255"><a href="#AspectsFactory-255"><span class="linenos">255</span></a><span class="sd">            axis_orb_limit: Orb threshold for chart axes</span>
</span><span id="AspectsFactory-256"><a href="#AspectsFactory-256"><span class="linenos">256</span></a><span class="sd">            celestial_points: Celestial points configuration</span>
</span><span id="AspectsFactory-257"><a href="#AspectsFactory-257"><span class="linenos">257</span></a>
</span><span id="AspectsFactory-258"><a href="#AspectsFactory-258"><span class="linenos">258</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-259"><a href="#AspectsFactory-259"><span class="linenos">259</span></a><span class="sd">            DualChartAspectsModel: Complete model containing filtered aspects data</span>
</span><span id="AspectsFactory-260"><a href="#AspectsFactory-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-261"><a href="#AspectsFactory-261"><span class="linenos">261</span></a>        <span class="n">all_aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_calculate_dual_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-262"><a href="#AspectsFactory-262"><span class="linenos">262</span></a>            <span class="n">first_subject</span><span class="p">,</span> <span class="n">second_subject</span><span class="p">,</span> <span class="n">active_points_resolved</span><span class="p">,</span> <span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-263"><a href="#AspectsFactory-263"><span class="linenos">263</span></a>            <span class="n">aspects_settings</span><span class="p">,</span> <span class="n">celestial_points</span><span class="p">,</span>
</span><span id="AspectsFactory-264"><a href="#AspectsFactory-264"><span class="linenos">264</span></a>            <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="n">first_subject_is_fixed</span><span class="p">,</span>
</span><span id="AspectsFactory-265"><a href="#AspectsFactory-265"><span class="linenos">265</span></a>            <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="n">second_subject_is_fixed</span><span class="p">,</span>
</span><span id="AspectsFactory-266"><a href="#AspectsFactory-266"><span class="linenos">266</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-267"><a href="#AspectsFactory-267"><span class="linenos">267</span></a>        <span class="n">filtered_aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_filter_relevant_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-268"><a href="#AspectsFactory-268"><span class="linenos">268</span></a>            <span class="n">all_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory-269"><a href="#AspectsFactory-269"><span class="linenos">269</span></a>            <span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory-270"><a href="#AspectsFactory-270"><span class="linenos">270</span></a>            <span class="n">apply_axis_orb_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="AspectsFactory-271"><a href="#AspectsFactory-271"><span class="linenos">271</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-272"><a href="#AspectsFactory-272"><span class="linenos">272</span></a>
</span><span id="AspectsFactory-273"><a href="#AspectsFactory-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="n">DualChartAspectsModel</span><span class="p">(</span>
</span><span id="AspectsFactory-274"><a href="#AspectsFactory-274"><span class="linenos">274</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="AspectsFactory-275"><a href="#AspectsFactory-275"><span class="linenos">275</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="AspectsFactory-276"><a href="#AspectsFactory-276"><span class="linenos">276</span></a>            <span class="n">aspects</span><span class="o">=</span><span class="n">filtered_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory-277"><a href="#AspectsFactory-277"><span class="linenos">277</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-278"><a href="#AspectsFactory-278"><span class="linenos">278</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory-279"><a href="#AspectsFactory-279"><span class="linenos">279</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-280"><a href="#AspectsFactory-280"><span class="linenos">280</span></a>
</span><span id="AspectsFactory-281"><a href="#AspectsFactory-281"><span class="linenos">281</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-282"><a href="#AspectsFactory-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_single_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-283"><a href="#AspectsFactory-283"><span class="linenos">283</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-284"><a href="#AspectsFactory-284"><span class="linenos">284</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span>
</span><span id="AspectsFactory-285"><a href="#AspectsFactory-285"><span class="linenos">285</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">],</span>
</span><span id="AspectsFactory-286"><a href="#AspectsFactory-286"><span class="linenos">286</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-287"><a href="#AspectsFactory-287"><span class="linenos">287</span></a>        <span class="n">celestial_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
</span><span id="AspectsFactory-288"><a href="#AspectsFactory-288"><span class="linenos">288</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AspectModel</span><span class="p">]:</span>
</span><span id="AspectsFactory-289"><a href="#AspectsFactory-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-290"><a href="#AspectsFactory-290"><span class="linenos">290</span></a><span class="sd">        Calculate all aspects within a single chart.</span>
</span><span id="AspectsFactory-291"><a href="#AspectsFactory-291"><span class="linenos">291</span></a>
</span><span id="AspectsFactory-292"><a href="#AspectsFactory-292"><span class="linenos">292</span></a><span class="sd">        This method handles all aspect calculations including settings updates,</span>
</span><span id="AspectsFactory-293"><a href="#AspectsFactory-293"><span class="linenos">293</span></a><span class="sd">        opposite pair filtering, and planet ID resolution for single charts.</span>
</span><span id="AspectsFactory-294"><a href="#AspectsFactory-294"><span class="linenos">294</span></a><span class="sd">        Works with any chart type (natal, return, composite, etc.).</span>
</span><span id="AspectsFactory-295"><a href="#AspectsFactory-295"><span class="linenos">295</span></a>
</span><span id="AspectsFactory-296"><a href="#AspectsFactory-296"><span class="linenos">296</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-297"><a href="#AspectsFactory-297"><span class="linenos">297</span></a><span class="sd">            List of all calculated AspectModel instances</span>
</span><span id="AspectsFactory-298"><a href="#AspectsFactory-298"><span class="linenos">298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-299"><a href="#AspectsFactory-299"><span class="linenos">299</span></a>        <span class="n">active_points_list</span> <span class="o">=</span> <span class="n">get_active_points_list</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AspectsFactory-300"><a href="#AspectsFactory-300"><span class="linenos">300</span></a>
</span><span id="AspectsFactory-301"><a href="#AspectsFactory-301"><span class="linenos">301</span></a>        <span class="c1"># Update aspects settings with active aspects orbs</span>
</span><span id="AspectsFactory-302"><a href="#AspectsFactory-302"><span class="linenos">302</span></a>        <span class="n">filtered_settings</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_update_aspect_settings</span><span class="p">(</span><span class="n">aspects_settings</span><span class="p">,</span> <span class="n">active_aspects</span><span class="p">)</span>
</span><span id="AspectsFactory-303"><a href="#AspectsFactory-303"><span class="linenos">303</span></a>
</span><span id="AspectsFactory-304"><a href="#AspectsFactory-304"><span class="linenos">304</span></a>        <span class="c1"># Create a lookup dictionary for planet IDs to optimize performance</span>
</span><span id="AspectsFactory-305"><a href="#AspectsFactory-305"><span class="linenos">305</span></a>        <span class="n">planet_id_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">planet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">planet</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">celestial_points</span><span class="p">}</span>
</span><span id="AspectsFactory-306"><a href="#AspectsFactory-306"><span class="linenos">306</span></a>
</span><span id="AspectsFactory-307"><a href="#AspectsFactory-307"><span class="linenos">307</span></a>        <span class="c1"># Define opposite pairs that should be skipped for single chart aspects</span>
</span><span id="AspectsFactory-308"><a href="#AspectsFactory-308"><span class="linenos">308</span></a>        <span class="n">opposite_pairs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AspectsFactory-309"><a href="#AspectsFactory-309"><span class="linenos">309</span></a>            <span class="p">(</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Descendant&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-310"><a href="#AspectsFactory-310"><span class="linenos">310</span></a>            <span class="p">(</span><span class="s2">&quot;Descendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-311"><a href="#AspectsFactory-311"><span class="linenos">311</span></a>            <span class="p">(</span><span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">,</span> <span class="s2">&quot;Imum_Coeli&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-312"><a href="#AspectsFactory-312"><span class="linenos">312</span></a>            <span class="p">(</span><span class="s2">&quot;Imum_Coeli&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-313"><a href="#AspectsFactory-313"><span class="linenos">313</span></a>            <span class="p">(</span><span class="s2">&quot;True_North_Lunar_Node&quot;</span><span class="p">,</span> <span class="s2">&quot;True_South_Lunar_Node&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-314"><a href="#AspectsFactory-314"><span class="linenos">314</span></a>            <span class="p">(</span><span class="s2">&quot;Mean_North_Lunar_Node&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean_South_Lunar_Node&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-315"><a href="#AspectsFactory-315"><span class="linenos">315</span></a>            <span class="p">(</span><span class="s2">&quot;True_South_Lunar_Node&quot;</span><span class="p">,</span> <span class="s2">&quot;True_North_Lunar_Node&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-316"><a href="#AspectsFactory-316"><span class="linenos">316</span></a>            <span class="p">(</span><span class="s2">&quot;Mean_South_Lunar_Node&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean_North_Lunar_Node&quot;</span><span class="p">),</span>
</span><span id="AspectsFactory-317"><a href="#AspectsFactory-317"><span class="linenos">317</span></a>        <span class="p">}</span>
</span><span id="AspectsFactory-318"><a href="#AspectsFactory-318"><span class="linenos">318</span></a>
</span><span id="AspectsFactory-319"><a href="#AspectsFactory-319"><span class="linenos">319</span></a>        <span class="n">all_aspects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AspectsFactory-320"><a href="#AspectsFactory-320"><span class="linenos">320</span></a>
</span><span id="AspectsFactory-321"><a href="#AspectsFactory-321"><span class="linenos">321</span></a>        <span class="k">for</span> <span class="n">first</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">active_points_list</span><span class="p">)):</span>
</span><span id="AspectsFactory-322"><a href="#AspectsFactory-322"><span class="linenos">322</span></a>            <span class="c1"># Generate aspects list without repetitions (single chart - same chart)</span>
</span><span id="AspectsFactory-323"><a href="#AspectsFactory-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">second</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_points_list</span><span class="p">)):</span>
</span><span id="AspectsFactory-324"><a href="#AspectsFactory-324"><span class="linenos">324</span></a>                <span class="c1"># Skip predefined opposite pairs (AC/DC, MC/IC, North/South nodes)</span>
</span><span id="AspectsFactory-325"><a href="#AspectsFactory-325"><span class="linenos">325</span></a>                <span class="n">first_name</span> <span class="o">=</span> <span class="n">active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="AspectsFactory-326"><a href="#AspectsFactory-326"><span class="linenos">326</span></a>                <span class="n">second_name</span> <span class="o">=</span> <span class="n">active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="AspectsFactory-327"><a href="#AspectsFactory-327"><span class="linenos">327</span></a>
</span><span id="AspectsFactory-328"><a href="#AspectsFactory-328"><span class="linenos">328</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">second_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">opposite_pairs</span><span class="p">:</span>
</span><span id="AspectsFactory-329"><a href="#AspectsFactory-329"><span class="linenos">329</span></a>                    <span class="k">continue</span>
</span><span id="AspectsFactory-330"><a href="#AspectsFactory-330"><span class="linenos">330</span></a>
</span><span id="AspectsFactory-331"><a href="#AspectsFactory-331"><span class="linenos">331</span></a>                <span class="n">aspect</span> <span class="o">=</span> <span class="n">get_aspect_from_two_points</span><span class="p">(</span>
</span><span id="AspectsFactory-332"><a href="#AspectsFactory-332"><span class="linenos">332</span></a>                    <span class="n">filtered_settings</span><span class="p">,</span>
</span><span id="AspectsFactory-333"><a href="#AspectsFactory-333"><span class="linenos">333</span></a>                    <span class="n">active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-334"><a href="#AspectsFactory-334"><span class="linenos">334</span></a>                    <span class="n">active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">]</span>
</span><span id="AspectsFactory-335"><a href="#AspectsFactory-335"><span class="linenos">335</span></a>                <span class="p">)</span>
</span><span id="AspectsFactory-336"><a href="#AspectsFactory-336"><span class="linenos">336</span></a>
</span><span id="AspectsFactory-337"><a href="#AspectsFactory-337"><span class="linenos">337</span></a>                <span class="k">if</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;verdict&quot;</span><span class="p">]:</span>
</span><span id="AspectsFactory-338"><a href="#AspectsFactory-338"><span class="linenos">338</span></a>                    <span class="c1"># Get planet IDs using lookup dictionary for better performance</span>
</span><span id="AspectsFactory-339"><a href="#AspectsFactory-339"><span class="linenos">339</span></a>                    <span class="n">first_planet_id</span> <span class="o">=</span> <span class="n">planet_id_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AspectsFactory-340"><a href="#AspectsFactory-340"><span class="linenos">340</span></a>                    <span class="n">second_planet_id</span> <span class="o">=</span> <span class="n">planet_id_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">second_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AspectsFactory-341"><a href="#AspectsFactory-341"><span class="linenos">341</span></a>
</span><span id="AspectsFactory-342"><a href="#AspectsFactory-342"><span class="linenos">342</span></a>                    <span class="c1"># Get speeds first, fall back to 0.0 only if missing/None</span>
</span><span id="AspectsFactory-343"><a href="#AspectsFactory-343"><span class="linenos">343</span></a>                    <span class="n">first_speed</span> <span class="o">=</span> <span class="n">active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="AspectsFactory-344"><a href="#AspectsFactory-344"><span class="linenos">344</span></a>                    <span class="n">second_speed</span> <span class="o">=</span> <span class="n">active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="AspectsFactory-345"><a href="#AspectsFactory-345"><span class="linenos">345</span></a>
</span><span id="AspectsFactory-346"><a href="#AspectsFactory-346"><span class="linenos">346</span></a>                    <span class="c1"># Determine aspect movement.</span>
</span><span id="AspectsFactory-347"><a href="#AspectsFactory-347"><span class="linenos">347</span></a>                    <span class="c1"># If both points are chart axes, there is no meaningful</span>
</span><span id="AspectsFactory-348"><a href="#AspectsFactory-348"><span class="linenos">348</span></a>                    <span class="c1"># dynamic movement between them, so we mark the aspect as</span>
</span><span id="AspectsFactory-349"><a href="#AspectsFactory-349"><span class="linenos">349</span></a>                    <span class="c1"># &quot;Static&quot; regardless of any synthetic speeds.</span>
</span><span id="AspectsFactory-350"><a href="#AspectsFactory-350"><span class="linenos">350</span></a>                    <span class="k">if</span> <span class="n">first_name</span> <span class="ow">in</span> <span class="n">AXES_LIST</span> <span class="ow">and</span> <span class="n">second_name</span> <span class="ow">in</span> <span class="n">AXES_LIST</span><span class="p">:</span>
</span><span id="AspectsFactory-351"><a href="#AspectsFactory-351"><span class="linenos">351</span></a>                        <span class="n">aspect_movement</span> <span class="o">=</span> <span class="s2">&quot;Static&quot;</span>
</span><span id="AspectsFactory-352"><a href="#AspectsFactory-352"><span class="linenos">352</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AspectsFactory-353"><a href="#AspectsFactory-353"><span class="linenos">353</span></a>                        <span class="c1"># Calculate aspect movement (applying/separating/fixed)</span>
</span><span id="AspectsFactory-354"><a href="#AspectsFactory-354"><span class="linenos">354</span></a>                        <span class="n">aspect_movement</span> <span class="o">=</span> <span class="n">calculate_aspect_movement</span><span class="p">(</span>
</span><span id="AspectsFactory-355"><a href="#AspectsFactory-355"><span class="linenos">355</span></a>                            <span class="n">active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-356"><a href="#AspectsFactory-356"><span class="linenos">356</span></a>                            <span class="n">active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-357"><a href="#AspectsFactory-357"><span class="linenos">357</span></a>                            <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect_degrees&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-358"><a href="#AspectsFactory-358"><span class="linenos">358</span></a>                            <span class="n">first_speed</span><span class="p">,</span>
</span><span id="AspectsFactory-359"><a href="#AspectsFactory-359"><span class="linenos">359</span></a>                            <span class="n">second_speed</span>
</span><span id="AspectsFactory-360"><a href="#AspectsFactory-360"><span class="linenos">360</span></a>                        <span class="p">)</span>
</span><span id="AspectsFactory-361"><a href="#AspectsFactory-361"><span class="linenos">361</span></a>
</span><span id="AspectsFactory-362"><a href="#AspectsFactory-362"><span class="linenos">362</span></a>                    <span class="n">aspect_model</span> <span class="o">=</span> <span class="n">AspectModel</span><span class="p">(</span>
</span><span id="AspectsFactory-363"><a href="#AspectsFactory-363"><span class="linenos">363</span></a>                        <span class="n">p1_name</span><span class="o">=</span><span class="n">first_name</span><span class="p">,</span>
</span><span id="AspectsFactory-364"><a href="#AspectsFactory-364"><span class="linenos">364</span></a>                        <span class="n">p1_owner</span><span class="o">=</span><span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="AspectsFactory-365"><a href="#AspectsFactory-365"><span class="linenos">365</span></a>                        <span class="n">p1_abs_pos</span><span class="o">=</span><span class="n">active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-366"><a href="#AspectsFactory-366"><span class="linenos">366</span></a>                        <span class="n">p2_name</span><span class="o">=</span><span class="n">second_name</span><span class="p">,</span>
</span><span id="AspectsFactory-367"><a href="#AspectsFactory-367"><span class="linenos">367</span></a>                        <span class="n">p2_owner</span><span class="o">=</span><span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="AspectsFactory-368"><a href="#AspectsFactory-368"><span class="linenos">368</span></a>                        <span class="n">p2_abs_pos</span><span class="o">=</span><span class="n">active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-369"><a href="#AspectsFactory-369"><span class="linenos">369</span></a>                        <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-370"><a href="#AspectsFactory-370"><span class="linenos">370</span></a>                        <span class="n">orbit</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;orbit&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-371"><a href="#AspectsFactory-371"><span class="linenos">371</span></a>                        <span class="n">aspect_degrees</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect_degrees&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-372"><a href="#AspectsFactory-372"><span class="linenos">372</span></a>                        <span class="n">diff</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-373"><a href="#AspectsFactory-373"><span class="linenos">373</span></a>                        <span class="n">p1</span><span class="o">=</span><span class="n">first_planet_id</span><span class="p">,</span>
</span><span id="AspectsFactory-374"><a href="#AspectsFactory-374"><span class="linenos">374</span></a>                        <span class="n">p2</span><span class="o">=</span><span class="n">second_planet_id</span><span class="p">,</span>
</span><span id="AspectsFactory-375"><a href="#AspectsFactory-375"><span class="linenos">375</span></a>                        <span class="n">aspect_movement</span><span class="o">=</span><span class="n">aspect_movement</span><span class="p">,</span>
</span><span id="AspectsFactory-376"><a href="#AspectsFactory-376"><span class="linenos">376</span></a>                        <span class="n">p1_speed</span><span class="o">=</span><span class="n">first_speed</span><span class="p">,</span>
</span><span id="AspectsFactory-377"><a href="#AspectsFactory-377"><span class="linenos">377</span></a>                        <span class="n">p2_speed</span><span class="o">=</span><span class="n">second_speed</span><span class="p">,</span>
</span><span id="AspectsFactory-378"><a href="#AspectsFactory-378"><span class="linenos">378</span></a>                    <span class="p">)</span>
</span><span id="AspectsFactory-379"><a href="#AspectsFactory-379"><span class="linenos">379</span></a>                    <span class="n">all_aspects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect_model</span><span class="p">)</span>
</span><span id="AspectsFactory-380"><a href="#AspectsFactory-380"><span class="linenos">380</span></a>
</span><span id="AspectsFactory-381"><a href="#AspectsFactory-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">all_aspects_list</span>
</span><span id="AspectsFactory-382"><a href="#AspectsFactory-382"><span class="linenos">382</span></a>
</span><span id="AspectsFactory-383"><a href="#AspectsFactory-383"><span class="linenos">383</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-384"><a href="#AspectsFactory-384"><span class="linenos">384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_dual_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-385"><a href="#AspectsFactory-385"><span class="linenos">385</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-386"><a href="#AspectsFactory-386"><span class="linenos">386</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-387"><a href="#AspectsFactory-387"><span class="linenos">387</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span>
</span><span id="AspectsFactory-388"><a href="#AspectsFactory-388"><span class="linenos">388</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">],</span>
</span><span id="AspectsFactory-389"><a href="#AspectsFactory-389"><span class="linenos">389</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-390"><a href="#AspectsFactory-390"><span class="linenos">390</span></a>        <span class="n">celestial_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-391"><a href="#AspectsFactory-391"><span class="linenos">391</span></a>        <span class="n">first_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AspectsFactory-392"><a href="#AspectsFactory-392"><span class="linenos">392</span></a>        <span class="n">second_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AspectsFactory-393"><a href="#AspectsFactory-393"><span class="linenos">393</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AspectModel</span><span class="p">]:</span>
</span><span id="AspectsFactory-394"><a href="#AspectsFactory-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-395"><a href="#AspectsFactory-395"><span class="linenos">395</span></a><span class="sd">        Calculate all aspects between two charts.</span>
</span><span id="AspectsFactory-396"><a href="#AspectsFactory-396"><span class="linenos">396</span></a>
</span><span id="AspectsFactory-397"><a href="#AspectsFactory-397"><span class="linenos">397</span></a><span class="sd">        This method performs comprehensive aspect calculations between all active points</span>
</span><span id="AspectsFactory-398"><a href="#AspectsFactory-398"><span class="linenos">398</span></a><span class="sd">        of both subjects, applying the specified orb settings and creating detailed</span>
</span><span id="AspectsFactory-399"><a href="#AspectsFactory-399"><span class="linenos">399</span></a><span class="sd">        aspect models with planet IDs and positional information.</span>
</span><span id="AspectsFactory-400"><a href="#AspectsFactory-400"><span class="linenos">400</span></a><span class="sd">        Works with any chart types (synastry, transits, comparisons, etc.).</span>
</span><span id="AspectsFactory-401"><a href="#AspectsFactory-401"><span class="linenos">401</span></a>
</span><span id="AspectsFactory-402"><a href="#AspectsFactory-402"><span class="linenos">402</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory-403"><a href="#AspectsFactory-403"><span class="linenos">403</span></a><span class="sd">            first_subject: First astrological subject</span>
</span><span id="AspectsFactory-404"><a href="#AspectsFactory-404"><span class="linenos">404</span></a><span class="sd">            second_subject: Second astrological subject</span>
</span><span id="AspectsFactory-405"><a href="#AspectsFactory-405"><span class="linenos">405</span></a><span class="sd">            active_points: List of celestial points to include in calculations</span>
</span><span id="AspectsFactory-406"><a href="#AspectsFactory-406"><span class="linenos">406</span></a><span class="sd">            active_aspects: List of aspect types with their orb settings</span>
</span><span id="AspectsFactory-407"><a href="#AspectsFactory-407"><span class="linenos">407</span></a><span class="sd">            aspects_settings: Base aspect configuration settings</span>
</span><span id="AspectsFactory-408"><a href="#AspectsFactory-408"><span class="linenos">408</span></a><span class="sd">            celestial_points: Celestial points configuration with IDs</span>
</span><span id="AspectsFactory-409"><a href="#AspectsFactory-409"><span class="linenos">409</span></a>
</span><span id="AspectsFactory-410"><a href="#AspectsFactory-410"><span class="linenos">410</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-411"><a href="#AspectsFactory-411"><span class="linenos">411</span></a><span class="sd">            List[AspectModel]: Complete list of all calculated aspect instances</span>
</span><span id="AspectsFactory-412"><a href="#AspectsFactory-412"><span class="linenos">412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-413"><a href="#AspectsFactory-413"><span class="linenos">413</span></a>        <span class="c1"># Get active points lists for both subjects</span>
</span><span id="AspectsFactory-414"><a href="#AspectsFactory-414"><span class="linenos">414</span></a>        <span class="n">first_active_points_list</span> <span class="o">=</span> <span class="n">get_active_points_list</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AspectsFactory-415"><a href="#AspectsFactory-415"><span class="linenos">415</span></a>        <span class="n">second_active_points_list</span> <span class="o">=</span> <span class="n">get_active_points_list</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AspectsFactory-416"><a href="#AspectsFactory-416"><span class="linenos">416</span></a>
</span><span id="AspectsFactory-417"><a href="#AspectsFactory-417"><span class="linenos">417</span></a>        <span class="c1"># Create a lookup dictionary for planet IDs to optimize performance</span>
</span><span id="AspectsFactory-418"><a href="#AspectsFactory-418"><span class="linenos">418</span></a>        <span class="n">planet_id_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">planet</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">planet</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">celestial_points</span><span class="p">}</span>
</span><span id="AspectsFactory-419"><a href="#AspectsFactory-419"><span class="linenos">419</span></a>
</span><span id="AspectsFactory-420"><a href="#AspectsFactory-420"><span class="linenos">420</span></a>        <span class="c1"># Update aspects settings with active aspects orbs</span>
</span><span id="AspectsFactory-421"><a href="#AspectsFactory-421"><span class="linenos">421</span></a>        <span class="n">filtered_settings</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_update_aspect_settings</span><span class="p">(</span><span class="n">aspects_settings</span><span class="p">,</span> <span class="n">active_aspects</span><span class="p">)</span>
</span><span id="AspectsFactory-422"><a href="#AspectsFactory-422"><span class="linenos">422</span></a>
</span><span id="AspectsFactory-423"><a href="#AspectsFactory-423"><span class="linenos">423</span></a>        <span class="n">all_aspects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AspectsFactory-424"><a href="#AspectsFactory-424"><span class="linenos">424</span></a>        <span class="k">for</span> <span class="n">first</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first_active_points_list</span><span class="p">)):</span>
</span><span id="AspectsFactory-425"><a href="#AspectsFactory-425"><span class="linenos">425</span></a>            <span class="c1"># Generate aspects list between all points of first and second subjects</span>
</span><span id="AspectsFactory-426"><a href="#AspectsFactory-426"><span class="linenos">426</span></a>            <span class="k">for</span> <span class="n">second</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">second_active_points_list</span><span class="p">)):</span>
</span><span id="AspectsFactory-427"><a href="#AspectsFactory-427"><span class="linenos">427</span></a>                <span class="n">aspect</span> <span class="o">=</span> <span class="n">get_aspect_from_two_points</span><span class="p">(</span>
</span><span id="AspectsFactory-428"><a href="#AspectsFactory-428"><span class="linenos">428</span></a>                    <span class="n">filtered_settings</span><span class="p">,</span>
</span><span id="AspectsFactory-429"><a href="#AspectsFactory-429"><span class="linenos">429</span></a>                    <span class="n">first_active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-430"><a href="#AspectsFactory-430"><span class="linenos">430</span></a>                    <span class="n">second_active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-431"><a href="#AspectsFactory-431"><span class="linenos">431</span></a>                <span class="p">)</span>
</span><span id="AspectsFactory-432"><a href="#AspectsFactory-432"><span class="linenos">432</span></a>
</span><span id="AspectsFactory-433"><a href="#AspectsFactory-433"><span class="linenos">433</span></a>                <span class="k">if</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;verdict&quot;</span><span class="p">]:</span>
</span><span id="AspectsFactory-434"><a href="#AspectsFactory-434"><span class="linenos">434</span></a>                    <span class="n">first_name</span> <span class="o">=</span> <span class="n">first_active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="AspectsFactory-435"><a href="#AspectsFactory-435"><span class="linenos">435</span></a>                    <span class="n">second_name</span> <span class="o">=</span> <span class="n">second_active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="AspectsFactory-436"><a href="#AspectsFactory-436"><span class="linenos">436</span></a>
</span><span id="AspectsFactory-437"><a href="#AspectsFactory-437"><span class="linenos">437</span></a>                    <span class="c1"># Get planet IDs using lookup dictionary for better performance</span>
</span><span id="AspectsFactory-438"><a href="#AspectsFactory-438"><span class="linenos">438</span></a>                    <span class="n">first_planet_id</span> <span class="o">=</span> <span class="n">planet_id_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AspectsFactory-439"><a href="#AspectsFactory-439"><span class="linenos">439</span></a>                    <span class="n">second_planet_id</span> <span class="o">=</span> <span class="n">planet_id_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">second_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AspectsFactory-440"><a href="#AspectsFactory-440"><span class="linenos">440</span></a>
</span><span id="AspectsFactory-441"><a href="#AspectsFactory-441"><span class="linenos">441</span></a>                    <span class="c1"># For aspects between axes (ASC, MC, DSC, IC) in different charts</span>
</span><span id="AspectsFactory-442"><a href="#AspectsFactory-442"><span class="linenos">442</span></a>                    <span class="c1"># there is no meaningful dynamic movement between two house systems,</span>
</span><span id="AspectsFactory-443"><a href="#AspectsFactory-443"><span class="linenos">443</span></a>                    <span class="c1"># so we mark the movement as &quot;Static&quot;.</span>
</span><span id="AspectsFactory-444"><a href="#AspectsFactory-444"><span class="linenos">444</span></a>                    <span class="k">if</span> <span class="n">first_name</span> <span class="ow">in</span> <span class="n">AXES_LIST</span> <span class="ow">and</span> <span class="n">second_name</span> <span class="ow">in</span> <span class="n">AXES_LIST</span><span class="p">:</span>
</span><span id="AspectsFactory-445"><a href="#AspectsFactory-445"><span class="linenos">445</span></a>                        <span class="n">aspect_movement</span> <span class="o">=</span> <span class="s2">&quot;Static&quot;</span>
</span><span id="AspectsFactory-446"><a href="#AspectsFactory-446"><span class="linenos">446</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="AspectsFactory-447"><a href="#AspectsFactory-447"><span class="linenos">447</span></a>                        <span class="c1"># Get speeds, fall back to 0.0 only if missing/None</span>
</span><span id="AspectsFactory-448"><a href="#AspectsFactory-448"><span class="linenos">448</span></a>                        <span class="n">first_speed</span> <span class="o">=</span> <span class="n">first_active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="AspectsFactory-449"><a href="#AspectsFactory-449"><span class="linenos">449</span></a>                        <span class="n">second_speed</span> <span class="o">=</span> <span class="n">second_active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="AspectsFactory-450"><a href="#AspectsFactory-450"><span class="linenos">450</span></a>
</span><span id="AspectsFactory-451"><a href="#AspectsFactory-451"><span class="linenos">451</span></a>                        <span class="c1"># Override speeds if subjects are fixed</span>
</span><span id="AspectsFactory-452"><a href="#AspectsFactory-452"><span class="linenos">452</span></a>                        <span class="k">if</span> <span class="n">first_subject_is_fixed</span><span class="p">:</span>
</span><span id="AspectsFactory-453"><a href="#AspectsFactory-453"><span class="linenos">453</span></a>                            <span class="n">first_speed</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="AspectsFactory-454"><a href="#AspectsFactory-454"><span class="linenos">454</span></a>                        <span class="k">if</span> <span class="n">second_subject_is_fixed</span><span class="p">:</span>
</span><span id="AspectsFactory-455"><a href="#AspectsFactory-455"><span class="linenos">455</span></a>                            <span class="n">second_speed</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="AspectsFactory-456"><a href="#AspectsFactory-456"><span class="linenos">456</span></a>
</span><span id="AspectsFactory-457"><a href="#AspectsFactory-457"><span class="linenos">457</span></a>                        <span class="c1"># Calculate aspect movement (applying/separating/fixed)</span>
</span><span id="AspectsFactory-458"><a href="#AspectsFactory-458"><span class="linenos">458</span></a>                        <span class="n">aspect_movement</span> <span class="o">=</span> <span class="n">calculate_aspect_movement</span><span class="p">(</span>
</span><span id="AspectsFactory-459"><a href="#AspectsFactory-459"><span class="linenos">459</span></a>                            <span class="n">first_active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-460"><a href="#AspectsFactory-460"><span class="linenos">460</span></a>                            <span class="n">second_active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-461"><a href="#AspectsFactory-461"><span class="linenos">461</span></a>                            <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect_degrees&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-462"><a href="#AspectsFactory-462"><span class="linenos">462</span></a>                            <span class="n">first_speed</span><span class="p">,</span>
</span><span id="AspectsFactory-463"><a href="#AspectsFactory-463"><span class="linenos">463</span></a>                            <span class="n">second_speed</span>
</span><span id="AspectsFactory-464"><a href="#AspectsFactory-464"><span class="linenos">464</span></a>                        <span class="p">)</span>
</span><span id="AspectsFactory-465"><a href="#AspectsFactory-465"><span class="linenos">465</span></a>
</span><span id="AspectsFactory-466"><a href="#AspectsFactory-466"><span class="linenos">466</span></a>                    <span class="n">aspect_model</span> <span class="o">=</span> <span class="n">AspectModel</span><span class="p">(</span>
</span><span id="AspectsFactory-467"><a href="#AspectsFactory-467"><span class="linenos">467</span></a>                        <span class="n">p1_name</span><span class="o">=</span><span class="n">first_name</span><span class="p">,</span>
</span><span id="AspectsFactory-468"><a href="#AspectsFactory-468"><span class="linenos">468</span></a>                        <span class="n">p1_owner</span><span class="o">=</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="AspectsFactory-469"><a href="#AspectsFactory-469"><span class="linenos">469</span></a>                        <span class="n">p1_abs_pos</span><span class="o">=</span><span class="n">first_active_points_list</span><span class="p">[</span><span class="n">first</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-470"><a href="#AspectsFactory-470"><span class="linenos">470</span></a>                        <span class="n">p2_name</span><span class="o">=</span><span class="n">second_name</span><span class="p">,</span>
</span><span id="AspectsFactory-471"><a href="#AspectsFactory-471"><span class="linenos">471</span></a>                        <span class="n">p2_owner</span><span class="o">=</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="AspectsFactory-472"><a href="#AspectsFactory-472"><span class="linenos">472</span></a>                        <span class="n">p2_abs_pos</span><span class="o">=</span><span class="n">second_active_points_list</span><span class="p">[</span><span class="n">second</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-473"><a href="#AspectsFactory-473"><span class="linenos">473</span></a>                        <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-474"><a href="#AspectsFactory-474"><span class="linenos">474</span></a>                        <span class="n">orbit</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;orbit&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-475"><a href="#AspectsFactory-475"><span class="linenos">475</span></a>                        <span class="n">aspect_degrees</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect_degrees&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-476"><a href="#AspectsFactory-476"><span class="linenos">476</span></a>                        <span class="n">diff</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;diff&quot;</span><span class="p">],</span>
</span><span id="AspectsFactory-477"><a href="#AspectsFactory-477"><span class="linenos">477</span></a>                        <span class="n">p1</span><span class="o">=</span><span class="n">first_planet_id</span><span class="p">,</span>
</span><span id="AspectsFactory-478"><a href="#AspectsFactory-478"><span class="linenos">478</span></a>                        <span class="n">p2</span><span class="o">=</span><span class="n">second_planet_id</span><span class="p">,</span>
</span><span id="AspectsFactory-479"><a href="#AspectsFactory-479"><span class="linenos">479</span></a>                        <span class="n">aspect_movement</span><span class="o">=</span><span class="n">aspect_movement</span><span class="p">,</span>
</span><span id="AspectsFactory-480"><a href="#AspectsFactory-480"><span class="linenos">480</span></a>                        <span class="n">p1_speed</span><span class="o">=</span><span class="n">first_speed</span><span class="p">,</span>
</span><span id="AspectsFactory-481"><a href="#AspectsFactory-481"><span class="linenos">481</span></a>                        <span class="n">p2_speed</span><span class="o">=</span><span class="n">second_speed</span><span class="p">,</span>
</span><span id="AspectsFactory-482"><a href="#AspectsFactory-482"><span class="linenos">482</span></a>                    <span class="p">)</span>
</span><span id="AspectsFactory-483"><a href="#AspectsFactory-483"><span class="linenos">483</span></a>                    <span class="n">all_aspects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect_model</span><span class="p">)</span>
</span><span id="AspectsFactory-484"><a href="#AspectsFactory-484"><span class="linenos">484</span></a>
</span><span id="AspectsFactory-485"><a href="#AspectsFactory-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="n">all_aspects_list</span>
</span><span id="AspectsFactory-486"><a href="#AspectsFactory-486"><span class="linenos">486</span></a>
</span><span id="AspectsFactory-487"><a href="#AspectsFactory-487"><span class="linenos">487</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-488"><a href="#AspectsFactory-488"><span class="linenos">488</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_aspect_settings</span><span class="p">(</span>
</span><span id="AspectsFactory-489"><a href="#AspectsFactory-489"><span class="linenos">489</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="AspectsFactory-490"><a href="#AspectsFactory-490"><span class="linenos">490</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span>
</span><span id="AspectsFactory-491"><a href="#AspectsFactory-491"><span class="linenos">491</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="AspectsFactory-492"><a href="#AspectsFactory-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-493"><a href="#AspectsFactory-493"><span class="linenos">493</span></a><span class="sd">        Update aspects settings with active aspects orbs.</span>
</span><span id="AspectsFactory-494"><a href="#AspectsFactory-494"><span class="linenos">494</span></a>
</span><span id="AspectsFactory-495"><a href="#AspectsFactory-495"><span class="linenos">495</span></a><span class="sd">        This is a common utility method used by both single chart and dual chart calculations.</span>
</span><span id="AspectsFactory-496"><a href="#AspectsFactory-496"><span class="linenos">496</span></a>
</span><span id="AspectsFactory-497"><a href="#AspectsFactory-497"><span class="linenos">497</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory-498"><a href="#AspectsFactory-498"><span class="linenos">498</span></a><span class="sd">            aspects_settings: Base aspect settings</span>
</span><span id="AspectsFactory-499"><a href="#AspectsFactory-499"><span class="linenos">499</span></a><span class="sd">            active_aspects: Active aspects with their orb configurations</span>
</span><span id="AspectsFactory-500"><a href="#AspectsFactory-500"><span class="linenos">500</span></a>
</span><span id="AspectsFactory-501"><a href="#AspectsFactory-501"><span class="linenos">501</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-502"><a href="#AspectsFactory-502"><span class="linenos">502</span></a><span class="sd">            List of filtered and updated aspect settings</span>
</span><span id="AspectsFactory-503"><a href="#AspectsFactory-503"><span class="linenos">503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-504"><a href="#AspectsFactory-504"><span class="linenos">504</span></a>        <span class="n">filtered_settings</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AspectsFactory-505"><a href="#AspectsFactory-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">aspect_setting</span> <span class="ow">in</span> <span class="n">aspects_settings</span><span class="p">:</span>
</span><span id="AspectsFactory-506"><a href="#AspectsFactory-506"><span class="linenos">506</span></a>            <span class="k">for</span> <span class="n">active_aspect</span> <span class="ow">in</span> <span class="n">active_aspects</span><span class="p">:</span>
</span><span id="AspectsFactory-507"><a href="#AspectsFactory-507"><span class="linenos">507</span></a>                <span class="k">if</span> <span class="n">aspect_setting</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">active_aspect</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
</span><span id="AspectsFactory-508"><a href="#AspectsFactory-508"><span class="linenos">508</span></a>                    <span class="n">aspect_setting</span> <span class="o">=</span> <span class="n">aspect_setting</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Don&#39;t modify original</span>
</span><span id="AspectsFactory-509"><a href="#AspectsFactory-509"><span class="linenos">509</span></a>                    <span class="n">aspect_setting</span><span class="p">[</span><span class="s2">&quot;orb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_aspect</span><span class="p">[</span><span class="s2">&quot;orb&quot;</span><span class="p">]</span>
</span><span id="AspectsFactory-510"><a href="#AspectsFactory-510"><span class="linenos">510</span></a>                    <span class="n">filtered_settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect_setting</span><span class="p">)</span>
</span><span id="AspectsFactory-511"><a href="#AspectsFactory-511"><span class="linenos">511</span></a>                    <span class="k">break</span>
</span><span id="AspectsFactory-512"><a href="#AspectsFactory-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="n">filtered_settings</span>
</span><span id="AspectsFactory-513"><a href="#AspectsFactory-513"><span class="linenos">513</span></a>
</span><span id="AspectsFactory-514"><a href="#AspectsFactory-514"><span class="linenos">514</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-515"><a href="#AspectsFactory-515"><span class="linenos">515</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_filter_relevant_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-516"><a href="#AspectsFactory-516"><span class="linenos">516</span></a>        <span class="n">all_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AspectModel</span><span class="p">],</span>
</span><span id="AspectsFactory-517"><a href="#AspectsFactory-517"><span class="linenos">517</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="AspectsFactory-518"><a href="#AspectsFactory-518"><span class="linenos">518</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory-519"><a href="#AspectsFactory-519"><span class="linenos">519</span></a>        <span class="n">apply_axis_orb_filter</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="AspectsFactory-520"><a href="#AspectsFactory-520"><span class="linenos">520</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AspectModel</span><span class="p">]:</span>
</span><span id="AspectsFactory-521"><a href="#AspectsFactory-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-522"><a href="#AspectsFactory-522"><span class="linenos">522</span></a><span class="sd">        Filter aspects based on orb thresholds for axes and comprehensive criteria.</span>
</span><span id="AspectsFactory-523"><a href="#AspectsFactory-523"><span class="linenos">523</span></a>
</span><span id="AspectsFactory-524"><a href="#AspectsFactory-524"><span class="linenos">524</span></a><span class="sd">        This method consolidates all filtering logic including axes checks and orb thresholds</span>
</span><span id="AspectsFactory-525"><a href="#AspectsFactory-525"><span class="linenos">525</span></a><span class="sd">        for both single chart and dual chart aspects in a single comprehensive filtering method.</span>
</span><span id="AspectsFactory-526"><a href="#AspectsFactory-526"><span class="linenos">526</span></a>
</span><span id="AspectsFactory-527"><a href="#AspectsFactory-527"><span class="linenos">527</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory-528"><a href="#AspectsFactory-528"><span class="linenos">528</span></a><span class="sd">            all_aspects: Complete list of calculated aspects</span>
</span><span id="AspectsFactory-529"><a href="#AspectsFactory-529"><span class="linenos">529</span></a><span class="sd">            axis_orb_limit: Optional orb threshold for axes aspects</span>
</span><span id="AspectsFactory-530"><a href="#AspectsFactory-530"><span class="linenos">530</span></a><span class="sd">            apply_axis_orb_filter: Whether to apply the axis-specific orb filtering logic</span>
</span><span id="AspectsFactory-531"><a href="#AspectsFactory-531"><span class="linenos">531</span></a>
</span><span id="AspectsFactory-532"><a href="#AspectsFactory-532"><span class="linenos">532</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory-533"><a href="#AspectsFactory-533"><span class="linenos">533</span></a><span class="sd">            Filtered list of relevant aspects</span>
</span><span id="AspectsFactory-534"><a href="#AspectsFactory-534"><span class="linenos">534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-535"><a href="#AspectsFactory-535"><span class="linenos">535</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculating relevant aspects by filtering orbs...&quot;</span><span class="p">)</span>
</span><span id="AspectsFactory-536"><a href="#AspectsFactory-536"><span class="linenos">536</span></a>
</span><span id="AspectsFactory-537"><a href="#AspectsFactory-537"><span class="linenos">537</span></a>        <span class="n">relevant_aspects</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AspectsFactory-538"><a href="#AspectsFactory-538"><span class="linenos">538</span></a>
</span><span id="AspectsFactory-539"><a href="#AspectsFactory-539"><span class="linenos">539</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">apply_axis_orb_filter</span> <span class="ow">or</span> <span class="n">axis_orb_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AspectsFactory-540"><a href="#AspectsFactory-540"><span class="linenos">540</span></a>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_aspects</span><span class="p">)</span>
</span><span id="AspectsFactory-541"><a href="#AspectsFactory-541"><span class="linenos">541</span></a>
</span><span id="AspectsFactory-542"><a href="#AspectsFactory-542"><span class="linenos">542</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">all_aspects</span><span class="p">:</span>
</span><span id="AspectsFactory-543"><a href="#AspectsFactory-543"><span class="linenos">543</span></a>            <span class="c1"># Check if aspect involves any of the chart axes and apply stricter orb limits</span>
</span><span id="AspectsFactory-544"><a href="#AspectsFactory-544"><span class="linenos">544</span></a>            <span class="n">aspect_involves_axes</span> <span class="o">=</span> <span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">p1_name</span> <span class="ow">in</span> <span class="n">AXES_LIST</span> <span class="ow">or</span> <span class="n">aspect</span><span class="o">.</span><span class="n">p2_name</span> <span class="ow">in</span> <span class="n">AXES_LIST</span><span class="p">)</span>
</span><span id="AspectsFactory-545"><a href="#AspectsFactory-545"><span class="linenos">545</span></a>
</span><span id="AspectsFactory-546"><a href="#AspectsFactory-546"><span class="linenos">546</span></a>            <span class="k">if</span> <span class="n">aspect_involves_axes</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">orbit</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">axis_orb_limit</span><span class="p">:</span>
</span><span id="AspectsFactory-547"><a href="#AspectsFactory-547"><span class="linenos">547</span></a>                <span class="k">continue</span>
</span><span id="AspectsFactory-548"><a href="#AspectsFactory-548"><span class="linenos">548</span></a>
</span><span id="AspectsFactory-549"><a href="#AspectsFactory-549"><span class="linenos">549</span></a>            <span class="n">relevant_aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="AspectsFactory-550"><a href="#AspectsFactory-550"><span class="linenos">550</span></a>
</span><span id="AspectsFactory-551"><a href="#AspectsFactory-551"><span class="linenos">551</span></a>        <span class="k">return</span> <span class="n">relevant_aspects</span>
</span><span id="AspectsFactory-552"><a href="#AspectsFactory-552"><span class="linenos">552</span></a>
</span><span id="AspectsFactory-553"><a href="#AspectsFactory-553"><span class="linenos">553</span></a>    <span class="c1"># Legacy methods for temporary backward compatibility</span>
</span><span id="AspectsFactory-554"><a href="#AspectsFactory-554"><span class="linenos">554</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-555"><a href="#AspectsFactory-555"><span class="linenos">555</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">natal_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-556"><a href="#AspectsFactory-556"><span class="linenos">556</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-557"><a href="#AspectsFactory-557"><span class="linenos">557</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory-558"><a href="#AspectsFactory-558"><span class="linenos">558</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-559"><a href="#AspectsFactory-559"><span class="linenos">559</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-560"><a href="#AspectsFactory-560"><span class="linenos">560</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-561"><a href="#AspectsFactory-561"><span class="linenos">561</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NatalAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory-562"><a href="#AspectsFactory-562"><span class="linenos">562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-563"><a href="#AspectsFactory-563"><span class="linenos">563</span></a><span class="sd">        Legacy method - use single_chart_aspects() instead.</span>
</span><span id="AspectsFactory-564"><a href="#AspectsFactory-564"><span class="linenos">564</span></a>
</span><span id="AspectsFactory-565"><a href="#AspectsFactory-565"><span class="linenos">565</span></a><span class="sd">          DEPRECATION WARNING </span>
</span><span id="AspectsFactory-566"><a href="#AspectsFactory-566"><span class="linenos">566</span></a><span class="sd">        This method is deprecated. Use AspectsFactory.single_chart_aspects() instead.</span>
</span><span id="AspectsFactory-567"><a href="#AspectsFactory-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-568"><a href="#AspectsFactory-568"><span class="linenos">568</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">single_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-569"><a href="#AspectsFactory-569"><span class="linenos">569</span></a>            <span class="n">subject</span><span class="p">,</span>
</span><span id="AspectsFactory-570"><a href="#AspectsFactory-570"><span class="linenos">570</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-571"><a href="#AspectsFactory-571"><span class="linenos">571</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory-572"><a href="#AspectsFactory-572"><span class="linenos">572</span></a>            <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory-573"><a href="#AspectsFactory-573"><span class="linenos">573</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory-574"><a href="#AspectsFactory-574"><span class="linenos">574</span></a>
</span><span id="AspectsFactory-575"><a href="#AspectsFactory-575"><span class="linenos">575</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory-576"><a href="#AspectsFactory-576"><span class="linenos">576</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">synastry_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-577"><a href="#AspectsFactory-577"><span class="linenos">577</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-578"><a href="#AspectsFactory-578"><span class="linenos">578</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory-579"><a href="#AspectsFactory-579"><span class="linenos">579</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory-580"><a href="#AspectsFactory-580"><span class="linenos">580</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-581"><a href="#AspectsFactory-581"><span class="linenos">581</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-582"><a href="#AspectsFactory-582"><span class="linenos">582</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory-583"><a href="#AspectsFactory-583"><span class="linenos">583</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynastryAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory-584"><a href="#AspectsFactory-584"><span class="linenos">584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory-585"><a href="#AspectsFactory-585"><span class="linenos">585</span></a><span class="sd">        Legacy method - use dual_chart_aspects() instead.</span>
</span><span id="AspectsFactory-586"><a href="#AspectsFactory-586"><span class="linenos">586</span></a>
</span><span id="AspectsFactory-587"><a href="#AspectsFactory-587"><span class="linenos">587</span></a><span class="sd">          DEPRECATION WARNING </span>
</span><span id="AspectsFactory-588"><a href="#AspectsFactory-588"><span class="linenos">588</span></a><span class="sd">        This method is deprecated. Use AspectsFactory.dual_chart_aspects() instead.</span>
</span><span id="AspectsFactory-589"><a href="#AspectsFactory-589"><span class="linenos">589</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory-590"><a href="#AspectsFactory-590"><span class="linenos">590</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory-591"><a href="#AspectsFactory-591"><span class="linenos">591</span></a>            <span class="n">first_subject</span><span class="p">,</span>
</span><span id="AspectsFactory-592"><a href="#AspectsFactory-592"><span class="linenos">592</span></a>            <span class="n">second_subject</span><span class="p">,</span>
</span><span id="AspectsFactory-593"><a href="#AspectsFactory-593"><span class="linenos">593</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory-594"><a href="#AspectsFactory-594"><span class="linenos">594</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory-595"><a href="#AspectsFactory-595"><span class="linenos">595</span></a>            <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory-596"><a href="#AspectsFactory-596"><span class="linenos">596</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Unified factory class for creating both single chart and dual chart aspects analysis.</p>

<p>This factory provides methods to calculate all aspects within a single chart or
between two charts. It consolidates the common functionality between different
types of aspect calculations while providing specialized methods for each type.</p>

<p>The factory provides both comprehensive and filtered aspect lists based on orb settings
and relevance criteria.</p>

<p>Key Features:
    - Calculates aspects within a single chart (natal, returns, composite, etc.)
    - Calculates aspects between two charts (synastry, transits, comparisons, etc.)
    - Filters aspects based on orb thresholds
    - Applies stricter orb limits for chart axes (ASC, MC, DSC, IC)
    - Supports multiple subject types (natal, composite, planetary returns)</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="for-single-chart-aspects-natal-returns-etc">For single chart aspects (natal, returns, etc.)</h1>
      
      <p>johnny = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("Johnny", 1963, 6, 9, 0, 0, "Owensboro", "US")
      single_chart_aspects = <a href="#AspectsFactory.single_chart_aspects">AspectsFactory.single_chart_aspects</a>(johnny)</p>
      
      <h1 id="for-dual-chart-aspects-synastry-comparisons-etc">For dual chart aspects (synastry, comparisons, etc.)</h1>
      
      <p>john = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("John", 1990, 1, 1, 12, 0, "London", "GB")
      jane = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("Jane", 1992, 6, 15, 14, 30, "Paris", "FR")
      dual_chart_aspects = <a href="#AspectsFactory.dual_chart_aspects">AspectsFactory.dual_chart_aspects</a>(john, jane)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="AspectsFactory.single_chart_aspects" class="classattr">
                                        <input id="AspectsFactory.single_chart_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">single_chart_aspects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">SingleChartAspectsModel</span>:</span></span>

                <label class="view-source-button" for="AspectsFactory.single_chart_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AspectsFactory.single_chart_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AspectsFactory.single_chart_aspects-70"><a href="#AspectsFactory.single_chart_aspects-70"><span class="linenos"> 70</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory.single_chart_aspects-71"><a href="#AspectsFactory.single_chart_aspects-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">single_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory.single_chart_aspects-72"><a href="#AspectsFactory.single_chart_aspects-72"><span class="linenos"> 72</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory.single_chart_aspects-73"><a href="#AspectsFactory.single_chart_aspects-73"><span class="linenos"> 73</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-74"><a href="#AspectsFactory.single_chart_aspects-74"><span class="linenos"> 74</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-75"><a href="#AspectsFactory.single_chart_aspects-75"><span class="linenos"> 75</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-76"><a href="#AspectsFactory.single_chart_aspects-76"><span class="linenos"> 76</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-77"><a href="#AspectsFactory.single_chart_aspects-77"><span class="linenos"> 77</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SingleChartAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory.single_chart_aspects-78"><a href="#AspectsFactory.single_chart_aspects-78"><span class="linenos"> 78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory.single_chart_aspects-79"><a href="#AspectsFactory.single_chart_aspects-79"><span class="linenos"> 79</span></a><span class="sd">        Create aspects analysis for a single astrological chart.</span>
</span><span id="AspectsFactory.single_chart_aspects-80"><a href="#AspectsFactory.single_chart_aspects-80"><span class="linenos"> 80</span></a>
</span><span id="AspectsFactory.single_chart_aspects-81"><a href="#AspectsFactory.single_chart_aspects-81"><span class="linenos"> 81</span></a><span class="sd">        This method calculates all astrological aspects (angular relationships)</span>
</span><span id="AspectsFactory.single_chart_aspects-82"><a href="#AspectsFactory.single_chart_aspects-82"><span class="linenos"> 82</span></a><span class="sd">        within a single chart. Can be used for any type of chart including:</span>
</span><span id="AspectsFactory.single_chart_aspects-83"><a href="#AspectsFactory.single_chart_aspects-83"><span class="linenos"> 83</span></a><span class="sd">        - Natal charts</span>
</span><span id="AspectsFactory.single_chart_aspects-84"><a href="#AspectsFactory.single_chart_aspects-84"><span class="linenos"> 84</span></a><span class="sd">        - Planetary return charts</span>
</span><span id="AspectsFactory.single_chart_aspects-85"><a href="#AspectsFactory.single_chart_aspects-85"><span class="linenos"> 85</span></a><span class="sd">        - Composite charts</span>
</span><span id="AspectsFactory.single_chart_aspects-86"><a href="#AspectsFactory.single_chart_aspects-86"><span class="linenos"> 86</span></a><span class="sd">        - Any other single chart type</span>
</span><span id="AspectsFactory.single_chart_aspects-87"><a href="#AspectsFactory.single_chart_aspects-87"><span class="linenos"> 87</span></a>
</span><span id="AspectsFactory.single_chart_aspects-88"><a href="#AspectsFactory.single_chart_aspects-88"><span class="linenos"> 88</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory.single_chart_aspects-89"><a href="#AspectsFactory.single_chart_aspects-89"><span class="linenos"> 89</span></a><span class="sd">            subject: The astrological subject for aspect calculation</span>
</span><span id="AspectsFactory.single_chart_aspects-90"><a href="#AspectsFactory.single_chart_aspects-90"><span class="linenos"> 90</span></a>
</span><span id="AspectsFactory.single_chart_aspects-91"><a href="#AspectsFactory.single_chart_aspects-91"><span class="linenos"> 91</span></a><span class="sd">        Kwargs:</span>
</span><span id="AspectsFactory.single_chart_aspects-92"><a href="#AspectsFactory.single_chart_aspects-92"><span class="linenos"> 92</span></a><span class="sd">            active_points: List of points to include in calculations</span>
</span><span id="AspectsFactory.single_chart_aspects-93"><a href="#AspectsFactory.single_chart_aspects-93"><span class="linenos"> 93</span></a><span class="sd">            active_aspects: List of aspects with their orb settings</span>
</span><span id="AspectsFactory.single_chart_aspects-94"><a href="#AspectsFactory.single_chart_aspects-94"><span class="linenos"> 94</span></a><span class="sd">            axis_orb_limit: Optional orb threshold applied to chart axes; when None, no special axis filter</span>
</span><span id="AspectsFactory.single_chart_aspects-95"><a href="#AspectsFactory.single_chart_aspects-95"><span class="linenos"> 95</span></a>
</span><span id="AspectsFactory.single_chart_aspects-96"><a href="#AspectsFactory.single_chart_aspects-96"><span class="linenos"> 96</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory.single_chart_aspects-97"><a href="#AspectsFactory.single_chart_aspects-97"><span class="linenos"> 97</span></a><span class="sd">            SingleChartAspectsModel containing all calculated aspects data</span>
</span><span id="AspectsFactory.single_chart_aspects-98"><a href="#AspectsFactory.single_chart_aspects-98"><span class="linenos"> 98</span></a>
</span><span id="AspectsFactory.single_chart_aspects-99"><a href="#AspectsFactory.single_chart_aspects-99"><span class="linenos"> 99</span></a><span class="sd">        Example:</span>
</span><span id="AspectsFactory.single_chart_aspects-100"><a href="#AspectsFactory.single_chart_aspects-100"><span class="linenos">100</span></a><span class="sd">            &gt;&gt;&gt; johnny = AstrologicalSubjectFactory.from_birth_data(&quot;Johnny&quot;, 1963, 6, 9, 0, 0, &quot;Owensboro&quot;, &quot;US&quot;)</span>
</span><span id="AspectsFactory.single_chart_aspects-101"><a href="#AspectsFactory.single_chart_aspects-101"><span class="linenos">101</span></a><span class="sd">            &gt;&gt;&gt; chart_aspects = AspectsFactory.single_chart_aspects(johnny)</span>
</span><span id="AspectsFactory.single_chart_aspects-102"><a href="#AspectsFactory.single_chart_aspects-102"><span class="linenos">102</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Found {len(chart_aspects.aspects)} aspects&quot;)</span>
</span><span id="AspectsFactory.single_chart_aspects-103"><a href="#AspectsFactory.single_chart_aspects-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory.single_chart_aspects-104"><a href="#AspectsFactory.single_chart_aspects-104"><span class="linenos">104</span></a>        <span class="c1"># Initialize settings and configurations</span>
</span><span id="AspectsFactory.single_chart_aspects-105"><a href="#AspectsFactory.single_chart_aspects-105"><span class="linenos">105</span></a>        <span class="n">celestial_points</span> <span class="o">=</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span>
</span><span id="AspectsFactory.single_chart_aspects-106"><a href="#AspectsFactory.single_chart_aspects-106"><span class="linenos">106</span></a>        <span class="n">aspects_settings</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_ASPECTS_SETTINGS</span>
</span><span id="AspectsFactory.single_chart_aspects-107"><a href="#AspectsFactory.single_chart_aspects-107"><span class="linenos">107</span></a>        <span class="c1"># Set active aspects with default fallback</span>
</span><span id="AspectsFactory.single_chart_aspects-108"><a href="#AspectsFactory.single_chart_aspects-108"><span class="linenos">108</span></a>        <span class="n">active_aspects_resolved</span> <span class="o">=</span> <span class="n">active_aspects</span> <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span>
</span><span id="AspectsFactory.single_chart_aspects-109"><a href="#AspectsFactory.single_chart_aspects-109"><span class="linenos">109</span></a>
</span><span id="AspectsFactory.single_chart_aspects-110"><a href="#AspectsFactory.single_chart_aspects-110"><span class="linenos">110</span></a>        <span class="c1"># Determine active points to use</span>
</span><span id="AspectsFactory.single_chart_aspects-111"><a href="#AspectsFactory.single_chart_aspects-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AspectsFactory.single_chart_aspects-112"><a href="#AspectsFactory.single_chart_aspects-112"><span class="linenos">112</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="AspectsFactory.single_chart_aspects-113"><a href="#AspectsFactory.single_chart_aspects-113"><span class="linenos">113</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AspectsFactory.single_chart_aspects-114"><a href="#AspectsFactory.single_chart_aspects-114"><span class="linenos">114</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="AspectsFactory.single_chart_aspects-115"><a href="#AspectsFactory.single_chart_aspects-115"><span class="linenos">115</span></a>                <span class="n">subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-116"><a href="#AspectsFactory.single_chart_aspects-116"><span class="linenos">116</span></a>                <span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-117"><a href="#AspectsFactory.single_chart_aspects-117"><span class="linenos">117</span></a>            <span class="p">)</span>
</span><span id="AspectsFactory.single_chart_aspects-118"><a href="#AspectsFactory.single_chart_aspects-118"><span class="linenos">118</span></a>
</span><span id="AspectsFactory.single_chart_aspects-119"><a href="#AspectsFactory.single_chart_aspects-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_create_single_chart_aspects_model</span><span class="p">(</span>
</span><span id="AspectsFactory.single_chart_aspects-120"><a href="#AspectsFactory.single_chart_aspects-120"><span class="linenos">120</span></a>            <span class="n">subject</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-121"><a href="#AspectsFactory.single_chart_aspects-121"><span class="linenos">121</span></a>            <span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-122"><a href="#AspectsFactory.single_chart_aspects-122"><span class="linenos">122</span></a>            <span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-123"><a href="#AspectsFactory.single_chart_aspects-123"><span class="linenos">123</span></a>            <span class="n">aspects_settings</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-124"><a href="#AspectsFactory.single_chart_aspects-124"><span class="linenos">124</span></a>            <span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-125"><a href="#AspectsFactory.single_chart_aspects-125"><span class="linenos">125</span></a>            <span class="n">celestial_points</span><span class="p">,</span>
</span><span id="AspectsFactory.single_chart_aspects-126"><a href="#AspectsFactory.single_chart_aspects-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create aspects analysis for a single astrological chart.</p>

<p>This method calculates all astrological aspects (angular relationships)
within a single chart. Can be used for any type of chart including:</p>

<ul>
<li>Natal charts</li>
<li>Planetary return charts</li>
<li>Composite charts</li>
<li>Any other single chart type</li>
</ul>

<p>Args:
    subject: The astrological subject for aspect calculation</p>

<p>Kwargs:
    active_points: List of points to include in calculations
    active_aspects: List of aspects with their orb settings
    axis_orb_limit: Optional orb threshold applied to chart axes; when None, no special axis filter</p>

<p>Returns:
    SingleChartAspectsModel containing all calculated aspects data</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>johnny = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("Johnny", 1963, 6, 9, 0, 0, "Owensboro", "US")
      chart_aspects = <a href="#AspectsFactory.single_chart_aspects">AspectsFactory.single_chart_aspects</a>(johnny)
      print(f"Found {len(chart_aspects.aspects)} aspects")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="AspectsFactory.dual_chart_aspects" class="classattr">
                                        <input id="AspectsFactory.dual_chart_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">dual_chart_aspects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">first_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">second_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">DualChartAspectsModel</span>:</span></span>

                <label class="view-source-button" for="AspectsFactory.dual_chart_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AspectsFactory.dual_chart_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AspectsFactory.dual_chart_aspects-128"><a href="#AspectsFactory.dual_chart_aspects-128"><span class="linenos">128</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory.dual_chart_aspects-129"><a href="#AspectsFactory.dual_chart_aspects-129"><span class="linenos">129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dual_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory.dual_chart_aspects-130"><a href="#AspectsFactory.dual_chart_aspects-130"><span class="linenos">130</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory.dual_chart_aspects-131"><a href="#AspectsFactory.dual_chart_aspects-131"><span class="linenos">131</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory.dual_chart_aspects-132"><a href="#AspectsFactory.dual_chart_aspects-132"><span class="linenos">132</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-133"><a href="#AspectsFactory.dual_chart_aspects-133"><span class="linenos">133</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-134"><a href="#AspectsFactory.dual_chart_aspects-134"><span class="linenos">134</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-135"><a href="#AspectsFactory.dual_chart_aspects-135"><span class="linenos">135</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-136"><a href="#AspectsFactory.dual_chart_aspects-136"><span class="linenos">136</span></a>        <span class="n">first_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-137"><a href="#AspectsFactory.dual_chart_aspects-137"><span class="linenos">137</span></a>        <span class="n">second_subject_is_fixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-138"><a href="#AspectsFactory.dual_chart_aspects-138"><span class="linenos">138</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DualChartAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory.dual_chart_aspects-139"><a href="#AspectsFactory.dual_chart_aspects-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory.dual_chart_aspects-140"><a href="#AspectsFactory.dual_chart_aspects-140"><span class="linenos">140</span></a><span class="sd">        Create aspects analysis between two astrological charts.</span>
</span><span id="AspectsFactory.dual_chart_aspects-141"><a href="#AspectsFactory.dual_chart_aspects-141"><span class="linenos">141</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-142"><a href="#AspectsFactory.dual_chart_aspects-142"><span class="linenos">142</span></a><span class="sd">        This method calculates all astrological aspects (angular relationships)</span>
</span><span id="AspectsFactory.dual_chart_aspects-143"><a href="#AspectsFactory.dual_chart_aspects-143"><span class="linenos">143</span></a><span class="sd">        between planets and points in two different charts. Can be used for:</span>
</span><span id="AspectsFactory.dual_chart_aspects-144"><a href="#AspectsFactory.dual_chart_aspects-144"><span class="linenos">144</span></a><span class="sd">        - Synastry (relationship compatibility)</span>
</span><span id="AspectsFactory.dual_chart_aspects-145"><a href="#AspectsFactory.dual_chart_aspects-145"><span class="linenos">145</span></a><span class="sd">        - Transit comparisons</span>
</span><span id="AspectsFactory.dual_chart_aspects-146"><a href="#AspectsFactory.dual_chart_aspects-146"><span class="linenos">146</span></a><span class="sd">        - Composite vs natal comparisons</span>
</span><span id="AspectsFactory.dual_chart_aspects-147"><a href="#AspectsFactory.dual_chart_aspects-147"><span class="linenos">147</span></a><span class="sd">        - Any other dual chart analysis</span>
</span><span id="AspectsFactory.dual_chart_aspects-148"><a href="#AspectsFactory.dual_chart_aspects-148"><span class="linenos">148</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-149"><a href="#AspectsFactory.dual_chart_aspects-149"><span class="linenos">149</span></a><span class="sd">        Args:</span>
</span><span id="AspectsFactory.dual_chart_aspects-150"><a href="#AspectsFactory.dual_chart_aspects-150"><span class="linenos">150</span></a><span class="sd">            first_subject: The first astrological subject</span>
</span><span id="AspectsFactory.dual_chart_aspects-151"><a href="#AspectsFactory.dual_chart_aspects-151"><span class="linenos">151</span></a><span class="sd">            second_subject: The second astrological subject to compare with the first</span>
</span><span id="AspectsFactory.dual_chart_aspects-152"><a href="#AspectsFactory.dual_chart_aspects-152"><span class="linenos">152</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-153"><a href="#AspectsFactory.dual_chart_aspects-153"><span class="linenos">153</span></a><span class="sd">        Kwargs:</span>
</span><span id="AspectsFactory.dual_chart_aspects-154"><a href="#AspectsFactory.dual_chart_aspects-154"><span class="linenos">154</span></a><span class="sd">            active_points: Optional list of celestial points to include in calculations.</span>
</span><span id="AspectsFactory.dual_chart_aspects-155"><a href="#AspectsFactory.dual_chart_aspects-155"><span class="linenos">155</span></a><span class="sd">                          If None, uses common points between both subjects.</span>
</span><span id="AspectsFactory.dual_chart_aspects-156"><a href="#AspectsFactory.dual_chart_aspects-156"><span class="linenos">156</span></a><span class="sd">            active_aspects: Optional list of aspect types with their orb settings.</span>
</span><span id="AspectsFactory.dual_chart_aspects-157"><a href="#AspectsFactory.dual_chart_aspects-157"><span class="linenos">157</span></a><span class="sd">                           If None, uses default aspect configuration.</span>
</span><span id="AspectsFactory.dual_chart_aspects-158"><a href="#AspectsFactory.dual_chart_aspects-158"><span class="linenos">158</span></a><span class="sd">            axis_orb_limit: Optional orb threshold for chart axes (applied to single chart calculations only)</span>
</span><span id="AspectsFactory.dual_chart_aspects-159"><a href="#AspectsFactory.dual_chart_aspects-159"><span class="linenos">159</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-160"><a href="#AspectsFactory.dual_chart_aspects-160"><span class="linenos">160</span></a><span class="sd">        Returns:</span>
</span><span id="AspectsFactory.dual_chart_aspects-161"><a href="#AspectsFactory.dual_chart_aspects-161"><span class="linenos">161</span></a><span class="sd">            DualChartAspectsModel: Complete model containing all calculated aspects data,</span>
</span><span id="AspectsFactory.dual_chart_aspects-162"><a href="#AspectsFactory.dual_chart_aspects-162"><span class="linenos">162</span></a><span class="sd">                                  including both comprehensive and filtered relevant aspects.</span>
</span><span id="AspectsFactory.dual_chart_aspects-163"><a href="#AspectsFactory.dual_chart_aspects-163"><span class="linenos">163</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-164"><a href="#AspectsFactory.dual_chart_aspects-164"><span class="linenos">164</span></a><span class="sd">        Example:</span>
</span><span id="AspectsFactory.dual_chart_aspects-165"><a href="#AspectsFactory.dual_chart_aspects-165"><span class="linenos">165</span></a><span class="sd">            &gt;&gt;&gt; john = AstrologicalSubjectFactory.from_birth_data(&quot;John&quot;, 1990, 1, 1, 12, 0, &quot;London&quot;, &quot;GB&quot;)</span>
</span><span id="AspectsFactory.dual_chart_aspects-166"><a href="#AspectsFactory.dual_chart_aspects-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; jane = AstrologicalSubjectFactory.from_birth_data(&quot;Jane&quot;, 1992, 6, 15, 14, 30, &quot;Paris&quot;, &quot;FR&quot;)</span>
</span><span id="AspectsFactory.dual_chart_aspects-167"><a href="#AspectsFactory.dual_chart_aspects-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt; synastry = AspectsFactory.dual_chart_aspects(john, jane)</span>
</span><span id="AspectsFactory.dual_chart_aspects-168"><a href="#AspectsFactory.dual_chart_aspects-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Found {len(synastry.aspects)} aspects&quot;)</span>
</span><span id="AspectsFactory.dual_chart_aspects-169"><a href="#AspectsFactory.dual_chart_aspects-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory.dual_chart_aspects-170"><a href="#AspectsFactory.dual_chart_aspects-170"><span class="linenos">170</span></a>        <span class="c1"># Initialize settings and configurations</span>
</span><span id="AspectsFactory.dual_chart_aspects-171"><a href="#AspectsFactory.dual_chart_aspects-171"><span class="linenos">171</span></a>        <span class="n">celestial_points</span> <span class="o">=</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span>
</span><span id="AspectsFactory.dual_chart_aspects-172"><a href="#AspectsFactory.dual_chart_aspects-172"><span class="linenos">172</span></a>        <span class="n">aspects_settings</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_ASPECTS_SETTINGS</span>
</span><span id="AspectsFactory.dual_chart_aspects-173"><a href="#AspectsFactory.dual_chart_aspects-173"><span class="linenos">173</span></a>        <span class="c1"># Set active aspects with default fallback</span>
</span><span id="AspectsFactory.dual_chart_aspects-174"><a href="#AspectsFactory.dual_chart_aspects-174"><span class="linenos">174</span></a>        <span class="n">active_aspects_resolved</span> <span class="o">=</span> <span class="n">active_aspects</span> <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span>
</span><span id="AspectsFactory.dual_chart_aspects-175"><a href="#AspectsFactory.dual_chart_aspects-175"><span class="linenos">175</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-176"><a href="#AspectsFactory.dual_chart_aspects-176"><span class="linenos">176</span></a>        <span class="c1"># Determine active points to use - find common points between both subjects</span>
</span><span id="AspectsFactory.dual_chart_aspects-177"><a href="#AspectsFactory.dual_chart_aspects-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AspectsFactory.dual_chart_aspects-178"><a href="#AspectsFactory.dual_chart_aspects-178"><span class="linenos">178</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="AspectsFactory.dual_chart_aspects-179"><a href="#AspectsFactory.dual_chart_aspects-179"><span class="linenos">179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AspectsFactory.dual_chart_aspects-180"><a href="#AspectsFactory.dual_chart_aspects-180"><span class="linenos">180</span></a>            <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="AspectsFactory.dual_chart_aspects-181"><a href="#AspectsFactory.dual_chart_aspects-181"><span class="linenos">181</span></a>                <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-182"><a href="#AspectsFactory.dual_chart_aspects-182"><span class="linenos">182</span></a>                <span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-183"><a href="#AspectsFactory.dual_chart_aspects-183"><span class="linenos">183</span></a>            <span class="p">)</span>
</span><span id="AspectsFactory.dual_chart_aspects-184"><a href="#AspectsFactory.dual_chart_aspects-184"><span class="linenos">184</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-185"><a href="#AspectsFactory.dual_chart_aspects-185"><span class="linenos">185</span></a>        <span class="c1"># Further filter with second subject&#39;s active points</span>
</span><span id="AspectsFactory.dual_chart_aspects-186"><a href="#AspectsFactory.dual_chart_aspects-186"><span class="linenos">186</span></a>        <span class="n">active_points_resolved</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="AspectsFactory.dual_chart_aspects-187"><a href="#AspectsFactory.dual_chart_aspects-187"><span class="linenos">187</span></a>            <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-188"><a href="#AspectsFactory.dual_chart_aspects-188"><span class="linenos">188</span></a>            <span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-189"><a href="#AspectsFactory.dual_chart_aspects-189"><span class="linenos">189</span></a>        <span class="p">)</span>
</span><span id="AspectsFactory.dual_chart_aspects-190"><a href="#AspectsFactory.dual_chart_aspects-190"><span class="linenos">190</span></a>
</span><span id="AspectsFactory.dual_chart_aspects-191"><a href="#AspectsFactory.dual_chart_aspects-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">_create_dual_chart_aspects_model</span><span class="p">(</span>
</span><span id="AspectsFactory.dual_chart_aspects-192"><a href="#AspectsFactory.dual_chart_aspects-192"><span class="linenos">192</span></a>            <span class="n">first_subject</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-193"><a href="#AspectsFactory.dual_chart_aspects-193"><span class="linenos">193</span></a>            <span class="n">second_subject</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-194"><a href="#AspectsFactory.dual_chart_aspects-194"><span class="linenos">194</span></a>            <span class="n">active_points_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-195"><a href="#AspectsFactory.dual_chart_aspects-195"><span class="linenos">195</span></a>            <span class="n">active_aspects_resolved</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-196"><a href="#AspectsFactory.dual_chart_aspects-196"><span class="linenos">196</span></a>            <span class="n">aspects_settings</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-197"><a href="#AspectsFactory.dual_chart_aspects-197"><span class="linenos">197</span></a>            <span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-198"><a href="#AspectsFactory.dual_chart_aspects-198"><span class="linenos">198</span></a>            <span class="n">celestial_points</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-199"><a href="#AspectsFactory.dual_chart_aspects-199"><span class="linenos">199</span></a>            <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="n">first_subject_is_fixed</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-200"><a href="#AspectsFactory.dual_chart_aspects-200"><span class="linenos">200</span></a>            <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="n">second_subject_is_fixed</span><span class="p">,</span>
</span><span id="AspectsFactory.dual_chart_aspects-201"><a href="#AspectsFactory.dual_chart_aspects-201"><span class="linenos">201</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create aspects analysis between two astrological charts.</p>

<p>This method calculates all astrological aspects (angular relationships)
between planets and points in two different charts. Can be used for:</p>

<ul>
<li>Synastry (relationship compatibility)</li>
<li>Transit comparisons</li>
<li>Composite vs natal comparisons</li>
<li>Any other dual chart analysis</li>
</ul>

<p>Args:
    first_subject: The first astrological subject
    second_subject: The second astrological subject to compare with the first</p>

<p>Kwargs:
    active_points: Optional list of celestial points to include in calculations.
                  If None, uses common points between both subjects.
    active_aspects: Optional list of aspect types with their orb settings.
                   If None, uses default aspect configuration.
    axis_orb_limit: Optional orb threshold for chart axes (applied to single chart calculations only)</p>

<p>Returns:
    DualChartAspectsModel: Complete model containing all calculated aspects data,
                          including both comprehensive and filtered relevant aspects.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>john = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("John", 1990, 1, 1, 12, 0, "London", "GB")
      jane = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("Jane", 1992, 6, 15, 14, 30, "Paris", "FR")
      synastry = <a href="#AspectsFactory.dual_chart_aspects">AspectsFactory.dual_chart_aspects</a>(john, jane)
      print(f"Found {len(synastry.aspects)} aspects")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="AspectsFactory.natal_aspects" class="classattr">
                                        <input id="AspectsFactory.natal_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">natal_aspects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">SingleChartAspectsModel</span>:</span></span>

                <label class="view-source-button" for="AspectsFactory.natal_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AspectsFactory.natal_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AspectsFactory.natal_aspects-554"><a href="#AspectsFactory.natal_aspects-554"><span class="linenos">554</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory.natal_aspects-555"><a href="#AspectsFactory.natal_aspects-555"><span class="linenos">555</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">natal_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory.natal_aspects-556"><a href="#AspectsFactory.natal_aspects-556"><span class="linenos">556</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory.natal_aspects-557"><a href="#AspectsFactory.natal_aspects-557"><span class="linenos">557</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-558"><a href="#AspectsFactory.natal_aspects-558"><span class="linenos">558</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-559"><a href="#AspectsFactory.natal_aspects-559"><span class="linenos">559</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-560"><a href="#AspectsFactory.natal_aspects-560"><span class="linenos">560</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-561"><a href="#AspectsFactory.natal_aspects-561"><span class="linenos">561</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NatalAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory.natal_aspects-562"><a href="#AspectsFactory.natal_aspects-562"><span class="linenos">562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory.natal_aspects-563"><a href="#AspectsFactory.natal_aspects-563"><span class="linenos">563</span></a><span class="sd">        Legacy method - use single_chart_aspects() instead.</span>
</span><span id="AspectsFactory.natal_aspects-564"><a href="#AspectsFactory.natal_aspects-564"><span class="linenos">564</span></a>
</span><span id="AspectsFactory.natal_aspects-565"><a href="#AspectsFactory.natal_aspects-565"><span class="linenos">565</span></a><span class="sd">          DEPRECATION WARNING </span>
</span><span id="AspectsFactory.natal_aspects-566"><a href="#AspectsFactory.natal_aspects-566"><span class="linenos">566</span></a><span class="sd">        This method is deprecated. Use AspectsFactory.single_chart_aspects() instead.</span>
</span><span id="AspectsFactory.natal_aspects-567"><a href="#AspectsFactory.natal_aspects-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory.natal_aspects-568"><a href="#AspectsFactory.natal_aspects-568"><span class="linenos">568</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">single_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory.natal_aspects-569"><a href="#AspectsFactory.natal_aspects-569"><span class="linenos">569</span></a>            <span class="n">subject</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-570"><a href="#AspectsFactory.natal_aspects-570"><span class="linenos">570</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-571"><a href="#AspectsFactory.natal_aspects-571"><span class="linenos">571</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-572"><a href="#AspectsFactory.natal_aspects-572"><span class="linenos">572</span></a>            <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory.natal_aspects-573"><a href="#AspectsFactory.natal_aspects-573"><span class="linenos">573</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Legacy method - use single_chart_aspects() instead.</p>

<p>  DEPRECATION WARNING 
This method is deprecated. Use <a href="#AspectsFactory.single_chart_aspects">AspectsFactory.single_chart_aspects()</a> instead.</p>
</div>


                            </div>
                            <div id="AspectsFactory.synastry_aspects" class="classattr">
                                        <input id="AspectsFactory.synastry_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">synastry_aspects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">DualChartAspectsModel</span>:</span></span>

                <label class="view-source-button" for="AspectsFactory.synastry_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AspectsFactory.synastry_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AspectsFactory.synastry_aspects-575"><a href="#AspectsFactory.synastry_aspects-575"><span class="linenos">575</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AspectsFactory.synastry_aspects-576"><a href="#AspectsFactory.synastry_aspects-576"><span class="linenos">576</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">synastry_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory.synastry_aspects-577"><a href="#AspectsFactory.synastry_aspects-577"><span class="linenos">577</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory.synastry_aspects-578"><a href="#AspectsFactory.synastry_aspects-578"><span class="linenos">578</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="AspectsFactory.synastry_aspects-579"><a href="#AspectsFactory.synastry_aspects-579"><span class="linenos">579</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-580"><a href="#AspectsFactory.synastry_aspects-580"><span class="linenos">580</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-581"><a href="#AspectsFactory.synastry_aspects-581"><span class="linenos">581</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-582"><a href="#AspectsFactory.synastry_aspects-582"><span class="linenos">582</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-583"><a href="#AspectsFactory.synastry_aspects-583"><span class="linenos">583</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SynastryAspectsModel</span><span class="p">:</span>
</span><span id="AspectsFactory.synastry_aspects-584"><a href="#AspectsFactory.synastry_aspects-584"><span class="linenos">584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AspectsFactory.synastry_aspects-585"><a href="#AspectsFactory.synastry_aspects-585"><span class="linenos">585</span></a><span class="sd">        Legacy method - use dual_chart_aspects() instead.</span>
</span><span id="AspectsFactory.synastry_aspects-586"><a href="#AspectsFactory.synastry_aspects-586"><span class="linenos">586</span></a>
</span><span id="AspectsFactory.synastry_aspects-587"><a href="#AspectsFactory.synastry_aspects-587"><span class="linenos">587</span></a><span class="sd">          DEPRECATION WARNING </span>
</span><span id="AspectsFactory.synastry_aspects-588"><a href="#AspectsFactory.synastry_aspects-588"><span class="linenos">588</span></a><span class="sd">        This method is deprecated. Use AspectsFactory.dual_chart_aspects() instead.</span>
</span><span id="AspectsFactory.synastry_aspects-589"><a href="#AspectsFactory.synastry_aspects-589"><span class="linenos">589</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AspectsFactory.synastry_aspects-590"><a href="#AspectsFactory.synastry_aspects-590"><span class="linenos">590</span></a>        <span class="k">return</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="AspectsFactory.synastry_aspects-591"><a href="#AspectsFactory.synastry_aspects-591"><span class="linenos">591</span></a>            <span class="n">first_subject</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-592"><a href="#AspectsFactory.synastry_aspects-592"><span class="linenos">592</span></a>            <span class="n">second_subject</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-593"><a href="#AspectsFactory.synastry_aspects-593"><span class="linenos">593</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-594"><a href="#AspectsFactory.synastry_aspects-594"><span class="linenos">594</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-595"><a href="#AspectsFactory.synastry_aspects-595"><span class="linenos">595</span></a>            <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="AspectsFactory.synastry_aspects-596"><a href="#AspectsFactory.synastry_aspects-596"><span class="linenos">596</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Legacy method - use dual_chart_aspects() instead.</p>

<p>  DEPRECATION WARNING 
This method is deprecated. Use <a href="#AspectsFactory.dual_chart_aspects">AspectsFactory.dual_chart_aspects()</a> instead.</p>
</div>


                            </div>
                </section>
                <section id="AstrologicalSubjectFactory">
                            <input id="AstrologicalSubjectFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AstrologicalSubjectFactory</span>:

                <label class="view-source-button" for="AstrologicalSubjectFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubjectFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubjectFactory-358"><a href="#AstrologicalSubjectFactory-358"><span class="linenos"> 358</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AstrologicalSubjectFactory</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-359"><a href="#AstrologicalSubjectFactory-359"><span class="linenos"> 359</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-360"><a href="#AstrologicalSubjectFactory-360"><span class="linenos"> 360</span></a><span class="sd">    Factory class for creating comprehensive astrological subjects.</span>
</span><span id="AstrologicalSubjectFactory-361"><a href="#AstrologicalSubjectFactory-361"><span class="linenos"> 361</span></a>
</span><span id="AstrologicalSubjectFactory-362"><a href="#AstrologicalSubjectFactory-362"><span class="linenos"> 362</span></a><span class="sd">    This factory creates AstrologicalSubjectModel instances with complete astrological</span>
</span><span id="AstrologicalSubjectFactory-363"><a href="#AstrologicalSubjectFactory-363"><span class="linenos"> 363</span></a><span class="sd">    information including planetary positions, house cusps, aspects, lunar phases, and</span>
</span><span id="AstrologicalSubjectFactory-364"><a href="#AstrologicalSubjectFactory-364"><span class="linenos"> 364</span></a><span class="sd">    various specialized astrological points. It provides multiple class methods for</span>
</span><span id="AstrologicalSubjectFactory-365"><a href="#AstrologicalSubjectFactory-365"><span class="linenos"> 365</span></a><span class="sd">    different initialization scenarios and supports both online and offline calculation modes.</span>
</span><span id="AstrologicalSubjectFactory-366"><a href="#AstrologicalSubjectFactory-366"><span class="linenos"> 366</span></a>
</span><span id="AstrologicalSubjectFactory-367"><a href="#AstrologicalSubjectFactory-367"><span class="linenos"> 367</span></a><span class="sd">    The factory handles complex astrological calculations using the Swiss Ephemeris library,</span>
</span><span id="AstrologicalSubjectFactory-368"><a href="#AstrologicalSubjectFactory-368"><span class="linenos"> 368</span></a><span class="sd">    supports multiple coordinate systems and house systems, and can automatically fetch</span>
</span><span id="AstrologicalSubjectFactory-369"><a href="#AstrologicalSubjectFactory-369"><span class="linenos"> 369</span></a><span class="sd">    location data from online sources.</span>
</span><span id="AstrologicalSubjectFactory-370"><a href="#AstrologicalSubjectFactory-370"><span class="linenos"> 370</span></a>
</span><span id="AstrologicalSubjectFactory-371"><a href="#AstrologicalSubjectFactory-371"><span class="linenos"> 371</span></a><span class="sd">    Supported Astrological Points:</span>
</span><span id="AstrologicalSubjectFactory-372"><a href="#AstrologicalSubjectFactory-372"><span class="linenos"> 372</span></a><span class="sd">        - Traditional Planets: Sun through Pluto</span>
</span><span id="AstrologicalSubjectFactory-373"><a href="#AstrologicalSubjectFactory-373"><span class="linenos"> 373</span></a><span class="sd">        - Lunar Nodes: Mean and True North/South Nodes</span>
</span><span id="AstrologicalSubjectFactory-374"><a href="#AstrologicalSubjectFactory-374"><span class="linenos"> 374</span></a><span class="sd">        - Lilith Points: Mean and True Black Moon</span>
</span><span id="AstrologicalSubjectFactory-375"><a href="#AstrologicalSubjectFactory-375"><span class="linenos"> 375</span></a><span class="sd">        - Asteroids: Ceres, Pallas, Juno, Vesta</span>
</span><span id="AstrologicalSubjectFactory-376"><a href="#AstrologicalSubjectFactory-376"><span class="linenos"> 376</span></a><span class="sd">        - Centaurs: Chiron, Pholus</span>
</span><span id="AstrologicalSubjectFactory-377"><a href="#AstrologicalSubjectFactory-377"><span class="linenos"> 377</span></a><span class="sd">        - Trans-Neptunian Objects: Eris, Sedna, Haumea, Makemake, Ixion, Orcus, Quaoar</span>
</span><span id="AstrologicalSubjectFactory-378"><a href="#AstrologicalSubjectFactory-378"><span class="linenos"> 378</span></a><span class="sd">        - Fixed Stars: Regulus, Spica (extensible)</span>
</span><span id="AstrologicalSubjectFactory-379"><a href="#AstrologicalSubjectFactory-379"><span class="linenos"> 379</span></a><span class="sd">        - Arabic Parts: Pars Fortunae, Pars Spiritus, Pars Amoris, Pars Fidei</span>
</span><span id="AstrologicalSubjectFactory-380"><a href="#AstrologicalSubjectFactory-380"><span class="linenos"> 380</span></a><span class="sd">        - Special Points: Vertex, Anti-Vertex, Earth (for heliocentric charts)</span>
</span><span id="AstrologicalSubjectFactory-381"><a href="#AstrologicalSubjectFactory-381"><span class="linenos"> 381</span></a><span class="sd">        - House Cusps: All 12 houses with configurable house systems</span>
</span><span id="AstrologicalSubjectFactory-382"><a href="#AstrologicalSubjectFactory-382"><span class="linenos"> 382</span></a><span class="sd">        - Angles: Ascendant, Medium Coeli, Descendant, Imum Coeli</span>
</span><span id="AstrologicalSubjectFactory-383"><a href="#AstrologicalSubjectFactory-383"><span class="linenos"> 383</span></a>
</span><span id="AstrologicalSubjectFactory-384"><a href="#AstrologicalSubjectFactory-384"><span class="linenos"> 384</span></a><span class="sd">    Supported Features:</span>
</span><span id="AstrologicalSubjectFactory-385"><a href="#AstrologicalSubjectFactory-385"><span class="linenos"> 385</span></a><span class="sd">        - Multiple zodiac systems (Tropical/Sidereal with various ayanamshas)</span>
</span><span id="AstrologicalSubjectFactory-386"><a href="#AstrologicalSubjectFactory-386"><span class="linenos"> 386</span></a><span class="sd">        - Multiple house systems (Placidus, Koch, Equal, Whole Sign, etc.)</span>
</span><span id="AstrologicalSubjectFactory-387"><a href="#AstrologicalSubjectFactory-387"><span class="linenos"> 387</span></a><span class="sd">        - Multiple coordinate perspectives (Geocentric, Heliocentric, Topocentric)</span>
</span><span id="AstrologicalSubjectFactory-388"><a href="#AstrologicalSubjectFactory-388"><span class="linenos"> 388</span></a><span class="sd">        - Automatic timezone and coordinate resolution via GeoNames API</span>
</span><span id="AstrologicalSubjectFactory-389"><a href="#AstrologicalSubjectFactory-389"><span class="linenos"> 389</span></a><span class="sd">        - Lunar phase calculations</span>
</span><span id="AstrologicalSubjectFactory-390"><a href="#AstrologicalSubjectFactory-390"><span class="linenos"> 390</span></a><span class="sd">        - Day/night chart detection for Arabic parts</span>
</span><span id="AstrologicalSubjectFactory-391"><a href="#AstrologicalSubjectFactory-391"><span class="linenos"> 391</span></a><span class="sd">        - Performance optimization through selective point calculation</span>
</span><span id="AstrologicalSubjectFactory-392"><a href="#AstrologicalSubjectFactory-392"><span class="linenos"> 392</span></a><span class="sd">        - Comprehensive error handling and validation</span>
</span><span id="AstrologicalSubjectFactory-393"><a href="#AstrologicalSubjectFactory-393"><span class="linenos"> 393</span></a>
</span><span id="AstrologicalSubjectFactory-394"><a href="#AstrologicalSubjectFactory-394"><span class="linenos"> 394</span></a><span class="sd">    Class Methods:</span>
</span><span id="AstrologicalSubjectFactory-395"><a href="#AstrologicalSubjectFactory-395"><span class="linenos"> 395</span></a><span class="sd">        from_birth_data: Create subject from standard birth data (most flexible)</span>
</span><span id="AstrologicalSubjectFactory-396"><a href="#AstrologicalSubjectFactory-396"><span class="linenos"> 396</span></a><span class="sd">        from_iso_utc_time: Create subject from ISO UTC timestamp</span>
</span><span id="AstrologicalSubjectFactory-397"><a href="#AstrologicalSubjectFactory-397"><span class="linenos"> 397</span></a><span class="sd">        from_current_time: Create subject for current moment</span>
</span><span id="AstrologicalSubjectFactory-398"><a href="#AstrologicalSubjectFactory-398"><span class="linenos"> 398</span></a>
</span><span id="AstrologicalSubjectFactory-399"><a href="#AstrologicalSubjectFactory-399"><span class="linenos"> 399</span></a><span class="sd">    Example:</span>
</span><span id="AstrologicalSubjectFactory-400"><a href="#AstrologicalSubjectFactory-400"><span class="linenos"> 400</span></a><span class="sd">        &gt;&gt;&gt; # Create natal chart</span>
</span><span id="AstrologicalSubjectFactory-401"><a href="#AstrologicalSubjectFactory-401"><span class="linenos"> 401</span></a><span class="sd">        &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory-402"><a href="#AstrologicalSubjectFactory-402"><span class="linenos"> 402</span></a><span class="sd">        ...     name=&quot;John Doe&quot;,</span>
</span><span id="AstrologicalSubjectFactory-403"><a href="#AstrologicalSubjectFactory-403"><span class="linenos"> 403</span></a><span class="sd">        ...     year=1990, month=6, day=15,</span>
</span><span id="AstrologicalSubjectFactory-404"><a href="#AstrologicalSubjectFactory-404"><span class="linenos"> 404</span></a><span class="sd">        ...     hour=14, minute=30,</span>
</span><span id="AstrologicalSubjectFactory-405"><a href="#AstrologicalSubjectFactory-405"><span class="linenos"> 405</span></a><span class="sd">        ...     city=&quot;Rome&quot;, nation=&quot;IT&quot;,</span>
</span><span id="AstrologicalSubjectFactory-406"><a href="#AstrologicalSubjectFactory-406"><span class="linenos"> 406</span></a><span class="sd">        ...     online=True</span>
</span><span id="AstrologicalSubjectFactory-407"><a href="#AstrologicalSubjectFactory-407"><span class="linenos"> 407</span></a><span class="sd">        ... )</span>
</span><span id="AstrologicalSubjectFactory-408"><a href="#AstrologicalSubjectFactory-408"><span class="linenos"> 408</span></a><span class="sd">        &gt;&gt;&gt; print(f&quot;Sun: {subject.sun.sign} {subject.sun.abs_pos}&quot;)</span>
</span><span id="AstrologicalSubjectFactory-409"><a href="#AstrologicalSubjectFactory-409"><span class="linenos"> 409</span></a><span class="sd">        &gt;&gt;&gt; print(f&quot;Active points: {len(subject.active_points)}&quot;)</span>
</span><span id="AstrologicalSubjectFactory-410"><a href="#AstrologicalSubjectFactory-410"><span class="linenos"> 410</span></a>
</span><span id="AstrologicalSubjectFactory-411"><a href="#AstrologicalSubjectFactory-411"><span class="linenos"> 411</span></a><span class="sd">        &gt;&gt;&gt; # Create chart for current time</span>
</span><span id="AstrologicalSubjectFactory-412"><a href="#AstrologicalSubjectFactory-412"><span class="linenos"> 412</span></a><span class="sd">        &gt;&gt;&gt; now_subject = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory-413"><a href="#AstrologicalSubjectFactory-413"><span class="linenos"> 413</span></a><span class="sd">        ...     name=&quot;Current Moment&quot;,</span>
</span><span id="AstrologicalSubjectFactory-414"><a href="#AstrologicalSubjectFactory-414"><span class="linenos"> 414</span></a><span class="sd">        ...     city=&quot;London&quot;, nation=&quot;GB&quot;</span>
</span><span id="AstrologicalSubjectFactory-415"><a href="#AstrologicalSubjectFactory-415"><span class="linenos"> 415</span></a><span class="sd">        ... )</span>
</span><span id="AstrologicalSubjectFactory-416"><a href="#AstrologicalSubjectFactory-416"><span class="linenos"> 416</span></a>
</span><span id="AstrologicalSubjectFactory-417"><a href="#AstrologicalSubjectFactory-417"><span class="linenos"> 417</span></a><span class="sd">    Thread Safety:</span>
</span><span id="AstrologicalSubjectFactory-418"><a href="#AstrologicalSubjectFactory-418"><span class="linenos"> 418</span></a><span class="sd">        This factory is not thread-safe due to its use of the Swiss Ephemeris library</span>
</span><span id="AstrologicalSubjectFactory-419"><a href="#AstrologicalSubjectFactory-419"><span class="linenos"> 419</span></a><span class="sd">        which maintains global state. Use separate instances in multi-threaded applications</span>
</span><span id="AstrologicalSubjectFactory-420"><a href="#AstrologicalSubjectFactory-420"><span class="linenos"> 420</span></a><span class="sd">        or implement appropriate locking mechanisms.</span>
</span><span id="AstrologicalSubjectFactory-421"><a href="#AstrologicalSubjectFactory-421"><span class="linenos"> 421</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-422"><a href="#AstrologicalSubjectFactory-422"><span class="linenos"> 422</span></a>
</span><span id="AstrologicalSubjectFactory-423"><a href="#AstrologicalSubjectFactory-423"><span class="linenos"> 423</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubjectFactory-424"><a href="#AstrologicalSubjectFactory-424"><span class="linenos"> 424</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-425"><a href="#AstrologicalSubjectFactory-425"><span class="linenos"> 425</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-426"><a href="#AstrologicalSubjectFactory-426"><span class="linenos"> 426</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-427"><a href="#AstrologicalSubjectFactory-427"><span class="linenos"> 427</span></a>        <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-428"><a href="#AstrologicalSubjectFactory-428"><span class="linenos"> 428</span></a>        <span class="n">month</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-429"><a href="#AstrologicalSubjectFactory-429"><span class="linenos"> 429</span></a>        <span class="n">day</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-430"><a href="#AstrologicalSubjectFactory-430"><span class="linenos"> 430</span></a>        <span class="n">hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-431"><a href="#AstrologicalSubjectFactory-431"><span class="linenos"> 431</span></a>        <span class="n">minute</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-432"><a href="#AstrologicalSubjectFactory-432"><span class="linenos"> 432</span></a>        <span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-433"><a href="#AstrologicalSubjectFactory-433"><span class="linenos"> 433</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-434"><a href="#AstrologicalSubjectFactory-434"><span class="linenos"> 434</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-435"><a href="#AstrologicalSubjectFactory-435"><span class="linenos"> 435</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-436"><a href="#AstrologicalSubjectFactory-436"><span class="linenos"> 436</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-437"><a href="#AstrologicalSubjectFactory-437"><span class="linenos"> 437</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-438"><a href="#AstrologicalSubjectFactory-438"><span class="linenos"> 438</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-439"><a href="#AstrologicalSubjectFactory-439"><span class="linenos"> 439</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-440"><a href="#AstrologicalSubjectFactory-440"><span class="linenos"> 440</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-441"><a href="#AstrologicalSubjectFactory-441"><span class="linenos"> 441</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-442"><a href="#AstrologicalSubjectFactory-442"><span class="linenos"> 442</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-443"><a href="#AstrologicalSubjectFactory-443"><span class="linenos"> 443</span></a>        <span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-444"><a href="#AstrologicalSubjectFactory-444"><span class="linenos"> 444</span></a>        <span class="n">is_dst</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-445"><a href="#AstrologicalSubjectFactory-445"><span class="linenos"> 445</span></a>        <span class="n">altitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-446"><a href="#AstrologicalSubjectFactory-446"><span class="linenos"> 446</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-447"><a href="#AstrologicalSubjectFactory-447"><span class="linenos"> 447</span></a>        <span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-448"><a href="#AstrologicalSubjectFactory-448"><span class="linenos"> 448</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-449"><a href="#AstrologicalSubjectFactory-449"><span class="linenos"> 449</span></a>        <span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-450"><a href="#AstrologicalSubjectFactory-450"><span class="linenos"> 450</span></a>        <span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-451"><a href="#AstrologicalSubjectFactory-451"><span class="linenos"> 451</span></a>
</span><span id="AstrologicalSubjectFactory-452"><a href="#AstrologicalSubjectFactory-452"><span class="linenos"> 452</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-453"><a href="#AstrologicalSubjectFactory-453"><span class="linenos"> 453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-454"><a href="#AstrologicalSubjectFactory-454"><span class="linenos"> 454</span></a><span class="sd">        Create an astrological subject from standard birth or event data.</span>
</span><span id="AstrologicalSubjectFactory-455"><a href="#AstrologicalSubjectFactory-455"><span class="linenos"> 455</span></a>
</span><span id="AstrologicalSubjectFactory-456"><a href="#AstrologicalSubjectFactory-456"><span class="linenos"> 456</span></a><span class="sd">        This is the most flexible and commonly used factory method. It creates a complete</span>
</span><span id="AstrologicalSubjectFactory-457"><a href="#AstrologicalSubjectFactory-457"><span class="linenos"> 457</span></a><span class="sd">        astrological subject with planetary positions, house cusps, and specialized points</span>
</span><span id="AstrologicalSubjectFactory-458"><a href="#AstrologicalSubjectFactory-458"><span class="linenos"> 458</span></a><span class="sd">        for a specific date, time, and location. Supports both online location resolution</span>
</span><span id="AstrologicalSubjectFactory-459"><a href="#AstrologicalSubjectFactory-459"><span class="linenos"> 459</span></a><span class="sd">        and offline calculation modes.</span>
</span><span id="AstrologicalSubjectFactory-460"><a href="#AstrologicalSubjectFactory-460"><span class="linenos"> 460</span></a>
</span><span id="AstrologicalSubjectFactory-461"><a href="#AstrologicalSubjectFactory-461"><span class="linenos"> 461</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-462"><a href="#AstrologicalSubjectFactory-462"><span class="linenos"> 462</span></a><span class="sd">            name (str, optional): Name or identifier for the subject. Defaults to &quot;Now&quot;.</span>
</span><span id="AstrologicalSubjectFactory-463"><a href="#AstrologicalSubjectFactory-463"><span class="linenos"> 463</span></a><span class="sd">            year (int, optional): Year of birth/event. Defaults to current year.</span>
</span><span id="AstrologicalSubjectFactory-464"><a href="#AstrologicalSubjectFactory-464"><span class="linenos"> 464</span></a><span class="sd">            month (int, optional): Month of birth/event (1-12). Defaults to current month.</span>
</span><span id="AstrologicalSubjectFactory-465"><a href="#AstrologicalSubjectFactory-465"><span class="linenos"> 465</span></a><span class="sd">            day (int, optional): Day of birth/event (1-31). Defaults to current day.</span>
</span><span id="AstrologicalSubjectFactory-466"><a href="#AstrologicalSubjectFactory-466"><span class="linenos"> 466</span></a><span class="sd">            hour (int, optional): Hour of birth/event (0-23). Defaults to current hour.</span>
</span><span id="AstrologicalSubjectFactory-467"><a href="#AstrologicalSubjectFactory-467"><span class="linenos"> 467</span></a><span class="sd">            minute (int, optional): Minute of birth/event (0-59). Defaults to current minute.</span>
</span><span id="AstrologicalSubjectFactory-468"><a href="#AstrologicalSubjectFactory-468"><span class="linenos"> 468</span></a><span class="sd">            seconds (int, optional): Seconds of birth/event (0-59). Defaults to 0.</span>
</span><span id="AstrologicalSubjectFactory-469"><a href="#AstrologicalSubjectFactory-469"><span class="linenos"> 469</span></a><span class="sd">            city (str, optional): City name for location lookup. Used with online=True.</span>
</span><span id="AstrologicalSubjectFactory-470"><a href="#AstrologicalSubjectFactory-470"><span class="linenos"> 470</span></a><span class="sd">                Defaults to None (Greenwich if not specified).</span>
</span><span id="AstrologicalSubjectFactory-471"><a href="#AstrologicalSubjectFactory-471"><span class="linenos"> 471</span></a><span class="sd">            nation (str, optional): ISO country code (e.g., &#39;US&#39;, &#39;GB&#39;, &#39;IT&#39;). Used with</span>
</span><span id="AstrologicalSubjectFactory-472"><a href="#AstrologicalSubjectFactory-472"><span class="linenos"> 472</span></a><span class="sd">                online=True. Defaults to None (&#39;GB&#39; if not specified).</span>
</span><span id="AstrologicalSubjectFactory-473"><a href="#AstrologicalSubjectFactory-473"><span class="linenos"> 473</span></a><span class="sd">            lng (float, optional): Longitude in decimal degrees. East is positive, West</span>
</span><span id="AstrologicalSubjectFactory-474"><a href="#AstrologicalSubjectFactory-474"><span class="linenos"> 474</span></a><span class="sd">                is negative. If not provided and online=True, fetched from GeoNames.</span>
</span><span id="AstrologicalSubjectFactory-475"><a href="#AstrologicalSubjectFactory-475"><span class="linenos"> 475</span></a><span class="sd">            lat (float, optional): Latitude in decimal degrees. North is positive, South</span>
</span><span id="AstrologicalSubjectFactory-476"><a href="#AstrologicalSubjectFactory-476"><span class="linenos"> 476</span></a><span class="sd">                is negative. If not provided and online=True, fetched from GeoNames.</span>
</span><span id="AstrologicalSubjectFactory-477"><a href="#AstrologicalSubjectFactory-477"><span class="linenos"> 477</span></a><span class="sd">            tz_str (str, optional): IANA timezone identifier (e.g., &#39;Europe/London&#39;).</span>
</span><span id="AstrologicalSubjectFactory-478"><a href="#AstrologicalSubjectFactory-478"><span class="linenos"> 478</span></a><span class="sd">                If not provided and online=True, fetched from GeoNames.</span>
</span><span id="AstrologicalSubjectFactory-479"><a href="#AstrologicalSubjectFactory-479"><span class="linenos"> 479</span></a><span class="sd">            geonames_username (str, optional): Username for GeoNames API. Required for</span>
</span><span id="AstrologicalSubjectFactory-480"><a href="#AstrologicalSubjectFactory-480"><span class="linenos"> 480</span></a><span class="sd">                online location lookup. Get one free at geonames.org.</span>
</span><span id="AstrologicalSubjectFactory-481"><a href="#AstrologicalSubjectFactory-481"><span class="linenos"> 481</span></a><span class="sd">            online (bool, optional): Whether to fetch location data online. If False,</span>
</span><span id="AstrologicalSubjectFactory-482"><a href="#AstrologicalSubjectFactory-482"><span class="linenos"> 482</span></a><span class="sd">                lng, lat, and tz_str must be provided. Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory-483"><a href="#AstrologicalSubjectFactory-483"><span class="linenos"> 483</span></a><span class="sd">            zodiac_type (ZodiacType, optional): Zodiac system - &#39;Tropical&#39; or &#39;Sidereal&#39;.</span>
</span><span id="AstrologicalSubjectFactory-484"><a href="#AstrologicalSubjectFactory-484"><span class="linenos"> 484</span></a><span class="sd">                Defaults to &#39;Tropical&#39;.</span>
</span><span id="AstrologicalSubjectFactory-485"><a href="#AstrologicalSubjectFactory-485"><span class="linenos"> 485</span></a><span class="sd">            sidereal_mode (SiderealMode, optional): Sidereal calculation mode (e.g.,</span>
</span><span id="AstrologicalSubjectFactory-486"><a href="#AstrologicalSubjectFactory-486"><span class="linenos"> 486</span></a><span class="sd">                &#39;FAGAN_BRADLEY&#39;, &#39;LAHIRI&#39;). Only used with zodiac_type=&#39;Sidereal&#39;.</span>
</span><span id="AstrologicalSubjectFactory-487"><a href="#AstrologicalSubjectFactory-487"><span class="linenos"> 487</span></a><span class="sd">            houses_system_identifier (HousesSystemIdentifier, optional): House system</span>
</span><span id="AstrologicalSubjectFactory-488"><a href="#AstrologicalSubjectFactory-488"><span class="linenos"> 488</span></a><span class="sd">                for cusp calculations (e.g., &#39;P&#39;=Placidus, &#39;K&#39;=Koch, &#39;E&#39;=Equal).</span>
</span><span id="AstrologicalSubjectFactory-489"><a href="#AstrologicalSubjectFactory-489"><span class="linenos"> 489</span></a><span class="sd">                Defaults to &#39;P&#39; (Placidus).</span>
</span><span id="AstrologicalSubjectFactory-490"><a href="#AstrologicalSubjectFactory-490"><span class="linenos"> 490</span></a><span class="sd">            perspective_type (PerspectiveType, optional): Calculation perspective:</span>
</span><span id="AstrologicalSubjectFactory-491"><a href="#AstrologicalSubjectFactory-491"><span class="linenos"> 491</span></a><span class="sd">                - &#39;Apparent Geocentric&#39;: Standard geocentric with light-time correction</span>
</span><span id="AstrologicalSubjectFactory-492"><a href="#AstrologicalSubjectFactory-492"><span class="linenos"> 492</span></a><span class="sd">                - &#39;True Geocentric&#39;: Geometric geocentric positions</span>
</span><span id="AstrologicalSubjectFactory-493"><a href="#AstrologicalSubjectFactory-493"><span class="linenos"> 493</span></a><span class="sd">                - &#39;Heliocentric&#39;: Sun-centered coordinates</span>
</span><span id="AstrologicalSubjectFactory-494"><a href="#AstrologicalSubjectFactory-494"><span class="linenos"> 494</span></a><span class="sd">                - &#39;Topocentric&#39;: Earth surface perspective (requires altitude)</span>
</span><span id="AstrologicalSubjectFactory-495"><a href="#AstrologicalSubjectFactory-495"><span class="linenos"> 495</span></a><span class="sd">                Defaults to &#39;Apparent Geocentric&#39;.</span>
</span><span id="AstrologicalSubjectFactory-496"><a href="#AstrologicalSubjectFactory-496"><span class="linenos"> 496</span></a><span class="sd">            cache_expire_after_days (int, optional): Days to cache GeoNames data locally.</span>
</span><span id="AstrologicalSubjectFactory-497"><a href="#AstrologicalSubjectFactory-497"><span class="linenos"> 497</span></a><span class="sd">                Defaults to 30.</span>
</span><span id="AstrologicalSubjectFactory-498"><a href="#AstrologicalSubjectFactory-498"><span class="linenos"> 498</span></a><span class="sd">            is_dst (bool, optional): Daylight Saving Time flag for ambiguous times.</span>
</span><span id="AstrologicalSubjectFactory-499"><a href="#AstrologicalSubjectFactory-499"><span class="linenos"> 499</span></a><span class="sd">                If None, pytz attempts automatic detection. Set explicitly for</span>
</span><span id="AstrologicalSubjectFactory-500"><a href="#AstrologicalSubjectFactory-500"><span class="linenos"> 500</span></a><span class="sd">                times during DST transitions.</span>
</span><span id="AstrologicalSubjectFactory-501"><a href="#AstrologicalSubjectFactory-501"><span class="linenos"> 501</span></a><span class="sd">            altitude (float, optional): Altitude above sea level in meters. Used for</span>
</span><span id="AstrologicalSubjectFactory-502"><a href="#AstrologicalSubjectFactory-502"><span class="linenos"> 502</span></a><span class="sd">                topocentric calculations and atmospheric corrections. Defaults to None</span>
</span><span id="AstrologicalSubjectFactory-503"><a href="#AstrologicalSubjectFactory-503"><span class="linenos"> 503</span></a><span class="sd">                (sea level assumed).</span>
</span><span id="AstrologicalSubjectFactory-504"><a href="#AstrologicalSubjectFactory-504"><span class="linenos"> 504</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]], optional): List of astrological</span>
</span><span id="AstrologicalSubjectFactory-505"><a href="#AstrologicalSubjectFactory-505"><span class="linenos"> 505</span></a><span class="sd">                points to calculate. Omitting points can improve performance for</span>
</span><span id="AstrologicalSubjectFactory-506"><a href="#AstrologicalSubjectFactory-506"><span class="linenos"> 506</span></a><span class="sd">                specialized applications. If None, uses DEFAULT_ACTIVE_POINTS.</span>
</span><span id="AstrologicalSubjectFactory-507"><a href="#AstrologicalSubjectFactory-507"><span class="linenos"> 507</span></a><span class="sd">            calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.</span>
</span><span id="AstrologicalSubjectFactory-508"><a href="#AstrologicalSubjectFactory-508"><span class="linenos"> 508</span></a><span class="sd">                Requires Sun and Moon in active_points. Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory-509"><a href="#AstrologicalSubjectFactory-509"><span class="linenos"> 509</span></a><span class="sd">            suppress_geonames_warning (bool, optional): If True, suppresses the warning</span>
</span><span id="AstrologicalSubjectFactory-510"><a href="#AstrologicalSubjectFactory-510"><span class="linenos"> 510</span></a><span class="sd">                message when using the default GeoNames username. Useful for testing</span>
</span><span id="AstrologicalSubjectFactory-511"><a href="#AstrologicalSubjectFactory-511"><span class="linenos"> 511</span></a><span class="sd">                or automated processes. Defaults to False.</span>
</span><span id="AstrologicalSubjectFactory-512"><a href="#AstrologicalSubjectFactory-512"><span class="linenos"> 512</span></a>
</span><span id="AstrologicalSubjectFactory-513"><a href="#AstrologicalSubjectFactory-513"><span class="linenos"> 513</span></a><span class="sd">        Returns:</span>
</span><span id="AstrologicalSubjectFactory-514"><a href="#AstrologicalSubjectFactory-514"><span class="linenos"> 514</span></a><span class="sd">            AstrologicalSubjectModel: Complete astrological subject with calculated</span>
</span><span id="AstrologicalSubjectFactory-515"><a href="#AstrologicalSubjectFactory-515"><span class="linenos"> 515</span></a><span class="sd">                positions, houses, and metadata. Access planetary positions via</span>
</span><span id="AstrologicalSubjectFactory-516"><a href="#AstrologicalSubjectFactory-516"><span class="linenos"> 516</span></a><span class="sd">                attributes like .sun, .moon, .mercury, etc.</span>
</span><span id="AstrologicalSubjectFactory-517"><a href="#AstrologicalSubjectFactory-517"><span class="linenos"> 517</span></a>
</span><span id="AstrologicalSubjectFactory-518"><a href="#AstrologicalSubjectFactory-518"><span class="linenos"> 518</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory-519"><a href="#AstrologicalSubjectFactory-519"><span class="linenos"> 519</span></a><span class="sd">            KerykeionException:</span>
</span><span id="AstrologicalSubjectFactory-520"><a href="#AstrologicalSubjectFactory-520"><span class="linenos"> 520</span></a><span class="sd">                - If offline mode is used without required location data</span>
</span><span id="AstrologicalSubjectFactory-521"><a href="#AstrologicalSubjectFactory-521"><span class="linenos"> 521</span></a><span class="sd">                - If invalid zodiac/sidereal mode combinations are specified</span>
</span><span id="AstrologicalSubjectFactory-522"><a href="#AstrologicalSubjectFactory-522"><span class="linenos"> 522</span></a><span class="sd">                - If GeoNames data is missing or invalid</span>
</span><span id="AstrologicalSubjectFactory-523"><a href="#AstrologicalSubjectFactory-523"><span class="linenos"> 523</span></a><span class="sd">                - If timezone localization fails (ambiguous DST times)</span>
</span><span id="AstrologicalSubjectFactory-524"><a href="#AstrologicalSubjectFactory-524"><span class="linenos"> 524</span></a>
</span><span id="AstrologicalSubjectFactory-525"><a href="#AstrologicalSubjectFactory-525"><span class="linenos"> 525</span></a><span class="sd">        Examples:</span>
</span><span id="AstrologicalSubjectFactory-526"><a href="#AstrologicalSubjectFactory-526"><span class="linenos"> 526</span></a><span class="sd">            &gt;&gt;&gt; # Basic natal chart with online location lookup</span>
</span><span id="AstrologicalSubjectFactory-527"><a href="#AstrologicalSubjectFactory-527"><span class="linenos"> 527</span></a><span class="sd">            &gt;&gt;&gt; chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory-528"><a href="#AstrologicalSubjectFactory-528"><span class="linenos"> 528</span></a><span class="sd">            ...     name=&quot;Jane Doe&quot;,</span>
</span><span id="AstrologicalSubjectFactory-529"><a href="#AstrologicalSubjectFactory-529"><span class="linenos"> 529</span></a><span class="sd">            ...     year=1985, month=3, day=21,</span>
</span><span id="AstrologicalSubjectFactory-530"><a href="#AstrologicalSubjectFactory-530"><span class="linenos"> 530</span></a><span class="sd">            ...     hour=15, minute=30,</span>
</span><span id="AstrologicalSubjectFactory-531"><a href="#AstrologicalSubjectFactory-531"><span class="linenos"> 531</span></a><span class="sd">            ...     city=&quot;Paris&quot;, nation=&quot;FR&quot;,</span>
</span><span id="AstrologicalSubjectFactory-532"><a href="#AstrologicalSubjectFactory-532"><span class="linenos"> 532</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="AstrologicalSubjectFactory-533"><a href="#AstrologicalSubjectFactory-533"><span class="linenos"> 533</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-534"><a href="#AstrologicalSubjectFactory-534"><span class="linenos"> 534</span></a>
</span><span id="AstrologicalSubjectFactory-535"><a href="#AstrologicalSubjectFactory-535"><span class="linenos"> 535</span></a><span class="sd">            &gt;&gt;&gt; # Offline calculation with manual coordinates</span>
</span><span id="AstrologicalSubjectFactory-536"><a href="#AstrologicalSubjectFactory-536"><span class="linenos"> 536</span></a><span class="sd">            &gt;&gt;&gt; chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory-537"><a href="#AstrologicalSubjectFactory-537"><span class="linenos"> 537</span></a><span class="sd">            ...     name=&quot;John Smith&quot;,</span>
</span><span id="AstrologicalSubjectFactory-538"><a href="#AstrologicalSubjectFactory-538"><span class="linenos"> 538</span></a><span class="sd">            ...     year=1990, month=12, day=25,</span>
</span><span id="AstrologicalSubjectFactory-539"><a href="#AstrologicalSubjectFactory-539"><span class="linenos"> 539</span></a><span class="sd">            ...     hour=0, minute=0,</span>
</span><span id="AstrologicalSubjectFactory-540"><a href="#AstrologicalSubjectFactory-540"><span class="linenos"> 540</span></a><span class="sd">            ...     lng=-74.006, lat=40.7128, tz_str=&quot;America/New_York&quot;,</span>
</span><span id="AstrologicalSubjectFactory-541"><a href="#AstrologicalSubjectFactory-541"><span class="linenos"> 541</span></a><span class="sd">            ...     online=False</span>
</span><span id="AstrologicalSubjectFactory-542"><a href="#AstrologicalSubjectFactory-542"><span class="linenos"> 542</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-543"><a href="#AstrologicalSubjectFactory-543"><span class="linenos"> 543</span></a>
</span><span id="AstrologicalSubjectFactory-544"><a href="#AstrologicalSubjectFactory-544"><span class="linenos"> 544</span></a><span class="sd">            &gt;&gt;&gt; # Sidereal chart with specific points</span>
</span><span id="AstrologicalSubjectFactory-545"><a href="#AstrologicalSubjectFactory-545"><span class="linenos"> 545</span></a><span class="sd">            &gt;&gt;&gt; chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory-546"><a href="#AstrologicalSubjectFactory-546"><span class="linenos"> 546</span></a><span class="sd">            ...     name=&quot;Vedic Chart&quot;,</span>
</span><span id="AstrologicalSubjectFactory-547"><a href="#AstrologicalSubjectFactory-547"><span class="linenos"> 547</span></a><span class="sd">            ...     year=2000, month=6, day=15, hour=12,</span>
</span><span id="AstrologicalSubjectFactory-548"><a href="#AstrologicalSubjectFactory-548"><span class="linenos"> 548</span></a><span class="sd">            ...     city=&quot;Mumbai&quot;, nation=&quot;IN&quot;,</span>
</span><span id="AstrologicalSubjectFactory-549"><a href="#AstrologicalSubjectFactory-549"><span class="linenos"> 549</span></a><span class="sd">            ...     zodiac_type=&quot;Sidereal&quot;,</span>
</span><span id="AstrologicalSubjectFactory-550"><a href="#AstrologicalSubjectFactory-550"><span class="linenos"> 550</span></a><span class="sd">            ...     sidereal_mode=&quot;LAHIRI&quot;,</span>
</span><span id="AstrologicalSubjectFactory-551"><a href="#AstrologicalSubjectFactory-551"><span class="linenos"> 551</span></a><span class="sd">            ...     active_points=[&quot;Sun&quot;, &quot;Moon&quot;, &quot;Mercury&quot;, &quot;Venus&quot;, &quot;Mars&quot;,</span>
</span><span id="AstrologicalSubjectFactory-552"><a href="#AstrologicalSubjectFactory-552"><span class="linenos"> 552</span></a><span class="sd">            ...                   &quot;Jupiter&quot;, &quot;Saturn&quot;, &quot;Ascendant&quot;]</span>
</span><span id="AstrologicalSubjectFactory-553"><a href="#AstrologicalSubjectFactory-553"><span class="linenos"> 553</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-554"><a href="#AstrologicalSubjectFactory-554"><span class="linenos"> 554</span></a>
</span><span id="AstrologicalSubjectFactory-555"><a href="#AstrologicalSubjectFactory-555"><span class="linenos"> 555</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-556"><a href="#AstrologicalSubjectFactory-556"><span class="linenos"> 556</span></a><span class="sd">            - For high-precision calculations, consider providing seconds parameter</span>
</span><span id="AstrologicalSubjectFactory-557"><a href="#AstrologicalSubjectFactory-557"><span class="linenos"> 557</span></a><span class="sd">            - Use topocentric perspective for observer-specific calculations</span>
</span><span id="AstrologicalSubjectFactory-558"><a href="#AstrologicalSubjectFactory-558"><span class="linenos"> 558</span></a><span class="sd">            - Some Arabic parts automatically activate required base points</span>
</span><span id="AstrologicalSubjectFactory-559"><a href="#AstrologicalSubjectFactory-559"><span class="linenos"> 559</span></a><span class="sd">            - The method handles polar regions by adjusting extreme latitudes</span>
</span><span id="AstrologicalSubjectFactory-560"><a href="#AstrologicalSubjectFactory-560"><span class="linenos"> 560</span></a><span class="sd">            - Time zones are handled with full DST awareness via pytz</span>
</span><span id="AstrologicalSubjectFactory-561"><a href="#AstrologicalSubjectFactory-561"><span class="linenos"> 561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-562"><a href="#AstrologicalSubjectFactory-562"><span class="linenos"> 562</span></a>        <span class="c1"># Resolve time defaults using current time</span>
</span><span id="AstrologicalSubjectFactory-563"><a href="#AstrologicalSubjectFactory-563"><span class="linenos"> 563</span></a>        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">month</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">day</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hour</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">minute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-564"><a href="#AstrologicalSubjectFactory-564"><span class="linenos"> 564</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-565"><a href="#AstrologicalSubjectFactory-565"><span class="linenos"> 565</span></a>            <span class="n">year</span> <span class="o">=</span> <span class="n">year</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">year</span>
</span><span id="AstrologicalSubjectFactory-566"><a href="#AstrologicalSubjectFactory-566"><span class="linenos"> 566</span></a>            <span class="n">month</span> <span class="o">=</span> <span class="n">month</span> <span class="k">if</span> <span class="n">month</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span>
</span><span id="AstrologicalSubjectFactory-567"><a href="#AstrologicalSubjectFactory-567"><span class="linenos"> 567</span></a>            <span class="n">day</span> <span class="o">=</span> <span class="n">day</span> <span class="k">if</span> <span class="n">day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">day</span>
</span><span id="AstrologicalSubjectFactory-568"><a href="#AstrologicalSubjectFactory-568"><span class="linenos"> 568</span></a>            <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span> <span class="k">if</span> <span class="n">hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span>
</span><span id="AstrologicalSubjectFactory-569"><a href="#AstrologicalSubjectFactory-569"><span class="linenos"> 569</span></a>            <span class="n">minute</span> <span class="o">=</span> <span class="n">minute</span> <span class="k">if</span> <span class="n">minute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span>
</span><span id="AstrologicalSubjectFactory-570"><a href="#AstrologicalSubjectFactory-570"><span class="linenos"> 570</span></a>            <span class="n">seconds</span> <span class="o">=</span> <span class="n">seconds</span> <span class="k">if</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">second</span>
</span><span id="AstrologicalSubjectFactory-571"><a href="#AstrologicalSubjectFactory-571"><span class="linenos"> 571</span></a>
</span><span id="AstrologicalSubjectFactory-572"><a href="#AstrologicalSubjectFactory-572"><span class="linenos"> 572</span></a>        <span class="c1"># Create a calculation data container</span>
</span><span id="AstrologicalSubjectFactory-573"><a href="#AstrologicalSubjectFactory-573"><span class="linenos"> 573</span></a>        <span class="n">calc_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AstrologicalSubjectFactory-574"><a href="#AstrologicalSubjectFactory-574"><span class="linenos"> 574</span></a>
</span><span id="AstrologicalSubjectFactory-575"><a href="#AstrologicalSubjectFactory-575"><span class="linenos"> 575</span></a>        <span class="c1"># Basic identity</span>
</span><span id="AstrologicalSubjectFactory-576"><a href="#AstrologicalSubjectFactory-576"><span class="linenos"> 576</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AstrologicalSubjectFactory-577"><a href="#AstrologicalSubjectFactory-577"><span class="linenos"> 577</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;json_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">())</span>
</span><span id="AstrologicalSubjectFactory-578"><a href="#AstrologicalSubjectFactory-578"><span class="linenos"> 578</span></a>
</span><span id="AstrologicalSubjectFactory-579"><a href="#AstrologicalSubjectFactory-579"><span class="linenos"> 579</span></a>        <span class="c1"># Create a deep copy of active points to avoid modifying the original list</span>
</span><span id="AstrologicalSubjectFactory-580"><a href="#AstrologicalSubjectFactory-580"><span class="linenos"> 580</span></a>        <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-581"><a href="#AstrologicalSubjectFactory-581"><span class="linenos"> 581</span></a>            <span class="n">active_points_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-582"><a href="#AstrologicalSubjectFactory-582"><span class="linenos"> 582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-583"><a href="#AstrologicalSubjectFactory-583"><span class="linenos"> 583</span></a>            <span class="n">active_points_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-584"><a href="#AstrologicalSubjectFactory-584"><span class="linenos"> 584</span></a>
</span><span id="AstrologicalSubjectFactory-585"><a href="#AstrologicalSubjectFactory-585"><span class="linenos"> 585</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;active_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_points_list</span>
</span><span id="AstrologicalSubjectFactory-586"><a href="#AstrologicalSubjectFactory-586"><span class="linenos"> 586</span></a>
</span><span id="AstrologicalSubjectFactory-587"><a href="#AstrologicalSubjectFactory-587"><span class="linenos"> 587</span></a>        <span class="c1"># Initialize configuration</span>
</span><span id="AstrologicalSubjectFactory-588"><a href="#AstrologicalSubjectFactory-588"><span class="linenos"> 588</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">ChartConfiguration</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-589"><a href="#AstrologicalSubjectFactory-589"><span class="linenos"> 589</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-590"><a href="#AstrologicalSubjectFactory-590"><span class="linenos"> 590</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-591"><a href="#AstrologicalSubjectFactory-591"><span class="linenos"> 591</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-592"><a href="#AstrologicalSubjectFactory-592"><span class="linenos"> 592</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-593"><a href="#AstrologicalSubjectFactory-593"><span class="linenos"> 593</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-594"><a href="#AstrologicalSubjectFactory-594"><span class="linenos"> 594</span></a>
</span><span id="AstrologicalSubjectFactory-595"><a href="#AstrologicalSubjectFactory-595"><span class="linenos"> 595</span></a>        <span class="c1"># Add configuration data to calculation data</span>
</span><span id="AstrologicalSubjectFactory-596"><a href="#AstrologicalSubjectFactory-596"><span class="linenos"> 596</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">zodiac_type</span>
</span><span id="AstrologicalSubjectFactory-597"><a href="#AstrologicalSubjectFactory-597"><span class="linenos"> 597</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;sidereal_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sidereal_mode</span>
</span><span id="AstrologicalSubjectFactory-598"><a href="#AstrologicalSubjectFactory-598"><span class="linenos"> 598</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">houses_system_identifier</span>
</span><span id="AstrologicalSubjectFactory-599"><a href="#AstrologicalSubjectFactory-599"><span class="linenos"> 599</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">perspective_type</span>
</span><span id="AstrologicalSubjectFactory-600"><a href="#AstrologicalSubjectFactory-600"><span class="linenos"> 600</span></a>
</span><span id="AstrologicalSubjectFactory-601"><a href="#AstrologicalSubjectFactory-601"><span class="linenos"> 601</span></a>        <span class="c1"># Set up geonames username if needed</span>
</span><span id="AstrologicalSubjectFactory-602"><a href="#AstrologicalSubjectFactory-602"><span class="linenos"> 602</span></a>        <span class="k">if</span> <span class="n">geonames_username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lat</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lng</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tz_str</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-603"><a href="#AstrologicalSubjectFactory-603"><span class="linenos"> 603</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_geonames_warning</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-604"><a href="#AstrologicalSubjectFactory-604"><span class="linenos"> 604</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-605"><a href="#AstrologicalSubjectFactory-605"><span class="linenos"> 605</span></a>            <span class="n">geonames_username</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span>
</span><span id="AstrologicalSubjectFactory-606"><a href="#AstrologicalSubjectFactory-606"><span class="linenos"> 606</span></a>
</span><span id="AstrologicalSubjectFactory-607"><a href="#AstrologicalSubjectFactory-607"><span class="linenos"> 607</span></a>        <span class="c1"># Initialize location data</span>
</span><span id="AstrologicalSubjectFactory-608"><a href="#AstrologicalSubjectFactory-608"><span class="linenos"> 608</span></a>        <span class="n">location</span> <span class="o">=</span> <span class="n">LocationData</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-609"><a href="#AstrologicalSubjectFactory-609"><span class="linenos"> 609</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span> <span class="ow">or</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-610"><a href="#AstrologicalSubjectFactory-610"><span class="linenos"> 610</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span> <span class="ow">or</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-611"><a href="#AstrologicalSubjectFactory-611"><span class="linenos"> 611</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">lat</span> <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">51.5074</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-612"><a href="#AstrologicalSubjectFactory-612"><span class="linenos"> 612</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">lng</span> <span class="k">if</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-613"><a href="#AstrologicalSubjectFactory-613"><span class="linenos"> 613</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span> <span class="ow">or</span> <span class="s2">&quot;Etc/GMT&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-614"><a href="#AstrologicalSubjectFactory-614"><span class="linenos"> 614</span></a>            <span class="n">altitude</span><span class="o">=</span><span class="n">altitude</span>
</span><span id="AstrologicalSubjectFactory-615"><a href="#AstrologicalSubjectFactory-615"><span class="linenos"> 615</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-616"><a href="#AstrologicalSubjectFactory-616"><span class="linenos"> 616</span></a>
</span><span id="AstrologicalSubjectFactory-617"><a href="#AstrologicalSubjectFactory-617"><span class="linenos"> 617</span></a>        <span class="c1"># If offline mode is requested but required data is missing, raise error</span>
</span><span id="AstrologicalSubjectFactory-618"><a href="#AstrologicalSubjectFactory-618"><span class="linenos"> 618</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tz_str</span> <span class="ow">or</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-619"><a href="#AstrologicalSubjectFactory-619"><span class="linenos"> 619</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-620"><a href="#AstrologicalSubjectFactory-620"><span class="linenos"> 620</span></a>                <span class="s2">&quot;For offline mode, you must provide timezone (tz_str) and coordinates (lat, lng)&quot;</span>
</span><span id="AstrologicalSubjectFactory-621"><a href="#AstrologicalSubjectFactory-621"><span class="linenos"> 621</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-622"><a href="#AstrologicalSubjectFactory-622"><span class="linenos"> 622</span></a>
</span><span id="AstrologicalSubjectFactory-623"><a href="#AstrologicalSubjectFactory-623"><span class="linenos"> 623</span></a>        <span class="c1"># Fetch location data if needed</span>
</span><span id="AstrologicalSubjectFactory-624"><a href="#AstrologicalSubjectFactory-624"><span class="linenos"> 624</span></a>        <span class="k">if</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tz_str</span> <span class="ow">or</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-625"><a href="#AstrologicalSubjectFactory-625"><span class="linenos"> 625</span></a>            <span class="n">location</span><span class="o">.</span><span class="n">fetch_from_geonames</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-626"><a href="#AstrologicalSubjectFactory-626"><span class="linenos"> 626</span></a>                <span class="n">username</span><span class="o">=</span><span class="n">geonames_username</span> <span class="ow">or</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-627"><a href="#AstrologicalSubjectFactory-627"><span class="linenos"> 627</span></a>                <span class="n">cache_expire_after_days</span><span class="o">=</span><span class="n">cache_expire_after_days</span>
</span><span id="AstrologicalSubjectFactory-628"><a href="#AstrologicalSubjectFactory-628"><span class="linenos"> 628</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-629"><a href="#AstrologicalSubjectFactory-629"><span class="linenos"> 629</span></a>
</span><span id="AstrologicalSubjectFactory-630"><a href="#AstrologicalSubjectFactory-630"><span class="linenos"> 630</span></a>        <span class="c1"># Prepare location for calculations</span>
</span><span id="AstrologicalSubjectFactory-631"><a href="#AstrologicalSubjectFactory-631"><span class="linenos"> 631</span></a>        <span class="n">location</span><span class="o">.</span><span class="n">prepare_for_calculation</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-632"><a href="#AstrologicalSubjectFactory-632"><span class="linenos"> 632</span></a>
</span><span id="AstrologicalSubjectFactory-633"><a href="#AstrologicalSubjectFactory-633"><span class="linenos"> 633</span></a>        <span class="c1"># Add location data to calculation data</span>
</span><span id="AstrologicalSubjectFactory-634"><a href="#AstrologicalSubjectFactory-634"><span class="linenos"> 634</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">city</span>
</span><span id="AstrologicalSubjectFactory-635"><a href="#AstrologicalSubjectFactory-635"><span class="linenos"> 635</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;nation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">nation</span>
</span><span id="AstrologicalSubjectFactory-636"><a href="#AstrologicalSubjectFactory-636"><span class="linenos"> 636</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">lat</span>
</span><span id="AstrologicalSubjectFactory-637"><a href="#AstrologicalSubjectFactory-637"><span class="linenos"> 637</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">lng</span>
</span><span id="AstrologicalSubjectFactory-638"><a href="#AstrologicalSubjectFactory-638"><span class="linenos"> 638</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;tz_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">tz_str</span>
</span><span id="AstrologicalSubjectFactory-639"><a href="#AstrologicalSubjectFactory-639"><span class="linenos"> 639</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;altitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">altitude</span>
</span><span id="AstrologicalSubjectFactory-640"><a href="#AstrologicalSubjectFactory-640"><span class="linenos"> 640</span></a>
</span><span id="AstrologicalSubjectFactory-641"><a href="#AstrologicalSubjectFactory-641"><span class="linenos"> 641</span></a>        <span class="c1"># Store calculation parameters</span>
</span><span id="AstrologicalSubjectFactory-642"><a href="#AstrologicalSubjectFactory-642"><span class="linenos"> 642</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
</span><span id="AstrologicalSubjectFactory-643"><a href="#AstrologicalSubjectFactory-643"><span class="linenos"> 643</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month</span>
</span><span id="AstrologicalSubjectFactory-644"><a href="#AstrologicalSubjectFactory-644"><span class="linenos"> 644</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">day</span>
</span><span id="AstrologicalSubjectFactory-645"><a href="#AstrologicalSubjectFactory-645"><span class="linenos"> 645</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
</span><span id="AstrologicalSubjectFactory-646"><a href="#AstrologicalSubjectFactory-646"><span class="linenos"> 646</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;minute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minute</span>
</span><span id="AstrologicalSubjectFactory-647"><a href="#AstrologicalSubjectFactory-647"><span class="linenos"> 647</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seconds</span>
</span><span id="AstrologicalSubjectFactory-648"><a href="#AstrologicalSubjectFactory-648"><span class="linenos"> 648</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;is_dst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_dst</span>
</span><span id="AstrologicalSubjectFactory-649"><a href="#AstrologicalSubjectFactory-649"><span class="linenos"> 649</span></a>
</span><span id="AstrologicalSubjectFactory-650"><a href="#AstrologicalSubjectFactory-650"><span class="linenos"> 650</span></a>        <span class="c1"># Calculate time conversions</span>
</span><span id="AstrologicalSubjectFactory-651"><a href="#AstrologicalSubjectFactory-651"><span class="linenos"> 651</span></a>        <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_time_conversions</span><span class="p">(</span><span class="n">calc_data</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-652"><a href="#AstrologicalSubjectFactory-652"><span class="linenos"> 652</span></a>        <span class="c1"># Initialize Swiss Ephemeris and calculate houses and planets with context manager</span>
</span><span id="AstrologicalSubjectFactory-653"><a href="#AstrologicalSubjectFactory-653"><span class="linenos"> 653</span></a>        <span class="n">ephe_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;sweph&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-654"><a href="#AstrologicalSubjectFactory-654"><span class="linenos"> 654</span></a>        <span class="k">with</span> <span class="n">ephemeris_context</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-655"><a href="#AstrologicalSubjectFactory-655"><span class="linenos"> 655</span></a>            <span class="n">ephe_path</span><span class="o">=</span><span class="n">ephe_path</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-656"><a href="#AstrologicalSubjectFactory-656"><span class="linenos"> 656</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-657"><a href="#AstrologicalSubjectFactory-657"><span class="linenos"> 657</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-658"><a href="#AstrologicalSubjectFactory-658"><span class="linenos"> 658</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-659"><a href="#AstrologicalSubjectFactory-659"><span class="linenos"> 659</span></a>            <span class="n">alt</span><span class="o">=</span><span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;altitude&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-660"><a href="#AstrologicalSubjectFactory-660"><span class="linenos"> 660</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">iflag</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-661"><a href="#AstrologicalSubjectFactory-661"><span class="linenos"> 661</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;_iflag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iflag</span>
</span><span id="AstrologicalSubjectFactory-662"><a href="#AstrologicalSubjectFactory-662"><span class="linenos"> 662</span></a>            <span class="c1"># House system name (previously set in _setup_ephemeris)</span>
</span><span id="AstrologicalSubjectFactory-663"><a href="#AstrologicalSubjectFactory-663"><span class="linenos"> 663</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;houses_system_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">house_name</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-664"><a href="#AstrologicalSubjectFactory-664"><span class="linenos"> 664</span></a>                <span class="n">config</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-665"><a href="#AstrologicalSubjectFactory-665"><span class="linenos"> 665</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-666"><a href="#AstrologicalSubjectFactory-666"><span class="linenos"> 666</span></a>            <span class="n">calculated_axial_cusps</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-667"><a href="#AstrologicalSubjectFactory-667"><span class="linenos"> 667</span></a>                <span class="n">calc_data</span><span class="p">,</span> <span class="n">active_points_list</span>
</span><span id="AstrologicalSubjectFactory-668"><a href="#AstrologicalSubjectFactory-668"><span class="linenos"> 668</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-669"><a href="#AstrologicalSubjectFactory-669"><span class="linenos"> 669</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_planets</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-670"><a href="#AstrologicalSubjectFactory-670"><span class="linenos"> 670</span></a>                <span class="n">calc_data</span><span class="p">,</span> <span class="n">active_points_list</span><span class="p">,</span> <span class="n">calculated_axial_cusps</span>
</span><span id="AstrologicalSubjectFactory-671"><a href="#AstrologicalSubjectFactory-671"><span class="linenos"> 671</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-672"><a href="#AstrologicalSubjectFactory-672"><span class="linenos"> 672</span></a>        <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_day_of_week</span><span class="p">(</span><span class="n">calc_data</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-673"><a href="#AstrologicalSubjectFactory-673"><span class="linenos"> 673</span></a>
</span><span id="AstrologicalSubjectFactory-674"><a href="#AstrologicalSubjectFactory-674"><span class="linenos"> 674</span></a>        <span class="c1"># Calculate lunar phase (optional - only if requested and Sun and Moon are available)</span>
</span><span id="AstrologicalSubjectFactory-675"><a href="#AstrologicalSubjectFactory-675"><span class="linenos"> 675</span></a>        <span class="k">if</span> <span class="n">calculate_lunar_phase</span> <span class="ow">and</span> <span class="s2">&quot;moon&quot;</span> <span class="ow">in</span> <span class="n">calc_data</span> <span class="ow">and</span> <span class="s2">&quot;sun&quot;</span> <span class="ow">in</span> <span class="n">calc_data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-676"><a href="#AstrologicalSubjectFactory-676"><span class="linenos"> 676</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_moon_phase</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-677"><a href="#AstrologicalSubjectFactory-677"><span class="linenos"> 677</span></a>                <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined,union-attr]</span>
</span><span id="AstrologicalSubjectFactory-678"><a href="#AstrologicalSubjectFactory-678"><span class="linenos"> 678</span></a>                <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span>  <span class="c1"># type: ignore[attr-defined,union-attr]</span>
</span><span id="AstrologicalSubjectFactory-679"><a href="#AstrologicalSubjectFactory-679"><span class="linenos"> 679</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-680"><a href="#AstrologicalSubjectFactory-680"><span class="linenos"> 680</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-681"><a href="#AstrologicalSubjectFactory-681"><span class="linenos"> 681</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AstrologicalSubjectFactory-682"><a href="#AstrologicalSubjectFactory-682"><span class="linenos"> 682</span></a>
</span><span id="AstrologicalSubjectFactory-683"><a href="#AstrologicalSubjectFactory-683"><span class="linenos"> 683</span></a>        <span class="c1"># Create and return the AstrologicalSubjectModel</span>
</span><span id="AstrologicalSubjectFactory-684"><a href="#AstrologicalSubjectFactory-684"><span class="linenos"> 684</span></a>        <span class="k">return</span> <span class="n">AstrologicalSubjectModel</span><span class="p">(</span><span class="o">**</span><span class="n">calc_data</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-685"><a href="#AstrologicalSubjectFactory-685"><span class="linenos"> 685</span></a>
</span><span id="AstrologicalSubjectFactory-686"><a href="#AstrologicalSubjectFactory-686"><span class="linenos"> 686</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubjectFactory-687"><a href="#AstrologicalSubjectFactory-687"><span class="linenos"> 687</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_iso_utc_time</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-688"><a href="#AstrologicalSubjectFactory-688"><span class="linenos"> 688</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-689"><a href="#AstrologicalSubjectFactory-689"><span class="linenos"> 689</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-690"><a href="#AstrologicalSubjectFactory-690"><span class="linenos"> 690</span></a>        <span class="n">iso_utc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-691"><a href="#AstrologicalSubjectFactory-691"><span class="linenos"> 691</span></a>        <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-692"><a href="#AstrologicalSubjectFactory-692"><span class="linenos"> 692</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-693"><a href="#AstrologicalSubjectFactory-693"><span class="linenos"> 693</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/GMT&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-694"><a href="#AstrologicalSubjectFactory-694"><span class="linenos"> 694</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-695"><a href="#AstrologicalSubjectFactory-695"><span class="linenos"> 695</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-696"><a href="#AstrologicalSubjectFactory-696"><span class="linenos"> 696</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">51.5074</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-697"><a href="#AstrologicalSubjectFactory-697"><span class="linenos"> 697</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-698"><a href="#AstrologicalSubjectFactory-698"><span class="linenos"> 698</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-699"><a href="#AstrologicalSubjectFactory-699"><span class="linenos"> 699</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-700"><a href="#AstrologicalSubjectFactory-700"><span class="linenos"> 700</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-701"><a href="#AstrologicalSubjectFactory-701"><span class="linenos"> 701</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-702"><a href="#AstrologicalSubjectFactory-702"><span class="linenos"> 702</span></a>        <span class="n">altitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-703"><a href="#AstrologicalSubjectFactory-703"><span class="linenos"> 703</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-704"><a href="#AstrologicalSubjectFactory-704"><span class="linenos"> 704</span></a>        <span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-705"><a href="#AstrologicalSubjectFactory-705"><span class="linenos"> 705</span></a>        <span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-706"><a href="#AstrologicalSubjectFactory-706"><span class="linenos"> 706</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-707"><a href="#AstrologicalSubjectFactory-707"><span class="linenos"> 707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-708"><a href="#AstrologicalSubjectFactory-708"><span class="linenos"> 708</span></a><span class="sd">        Create an astrological subject from an ISO formatted UTC timestamp.</span>
</span><span id="AstrologicalSubjectFactory-709"><a href="#AstrologicalSubjectFactory-709"><span class="linenos"> 709</span></a>
</span><span id="AstrologicalSubjectFactory-710"><a href="#AstrologicalSubjectFactory-710"><span class="linenos"> 710</span></a><span class="sd">        This method is ideal for creating astrological subjects from standardized</span>
</span><span id="AstrologicalSubjectFactory-711"><a href="#AstrologicalSubjectFactory-711"><span class="linenos"> 711</span></a><span class="sd">        time formats, such as those stored in databases or received from APIs.</span>
</span><span id="AstrologicalSubjectFactory-712"><a href="#AstrologicalSubjectFactory-712"><span class="linenos"> 712</span></a><span class="sd">        It automatically handles timezone conversion from UTC to the specified</span>
</span><span id="AstrologicalSubjectFactory-713"><a href="#AstrologicalSubjectFactory-713"><span class="linenos"> 713</span></a><span class="sd">        local timezone.</span>
</span><span id="AstrologicalSubjectFactory-714"><a href="#AstrologicalSubjectFactory-714"><span class="linenos"> 714</span></a>
</span><span id="AstrologicalSubjectFactory-715"><a href="#AstrologicalSubjectFactory-715"><span class="linenos"> 715</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-716"><a href="#AstrologicalSubjectFactory-716"><span class="linenos"> 716</span></a><span class="sd">            name (str): Name or identifier for the subject.</span>
</span><span id="AstrologicalSubjectFactory-717"><a href="#AstrologicalSubjectFactory-717"><span class="linenos"> 717</span></a><span class="sd">            iso_utc_time (str): ISO 8601 formatted UTC timestamp. Supported formats:</span>
</span><span id="AstrologicalSubjectFactory-718"><a href="#AstrologicalSubjectFactory-718"><span class="linenos"> 718</span></a><span class="sd">                - &quot;2023-06-15T14:30:00Z&quot; (with Z suffix)</span>
</span><span id="AstrologicalSubjectFactory-719"><a href="#AstrologicalSubjectFactory-719"><span class="linenos"> 719</span></a><span class="sd">                - &quot;2023-06-15T14:30:00+00:00&quot; (with UTC offset)</span>
</span><span id="AstrologicalSubjectFactory-720"><a href="#AstrologicalSubjectFactory-720"><span class="linenos"> 720</span></a><span class="sd">                - &quot;2023-06-15T14:30:00.123Z&quot; (with milliseconds)</span>
</span><span id="AstrologicalSubjectFactory-721"><a href="#AstrologicalSubjectFactory-721"><span class="linenos"> 721</span></a><span class="sd">            city (str, optional): City name for location. Defaults to &quot;Greenwich&quot;.</span>
</span><span id="AstrologicalSubjectFactory-722"><a href="#AstrologicalSubjectFactory-722"><span class="linenos"> 722</span></a><span class="sd">            nation (str, optional): ISO country code. Defaults to &quot;GB&quot;.</span>
</span><span id="AstrologicalSubjectFactory-723"><a href="#AstrologicalSubjectFactory-723"><span class="linenos"> 723</span></a><span class="sd">            tz_str (str, optional): IANA timezone identifier for result conversion.</span>
</span><span id="AstrologicalSubjectFactory-724"><a href="#AstrologicalSubjectFactory-724"><span class="linenos"> 724</span></a><span class="sd">                The ISO time is assumed to be in UTC and will be converted to this</span>
</span><span id="AstrologicalSubjectFactory-725"><a href="#AstrologicalSubjectFactory-725"><span class="linenos"> 725</span></a><span class="sd">                timezone. Defaults to &quot;Etc/GMT&quot;.</span>
</span><span id="AstrologicalSubjectFactory-726"><a href="#AstrologicalSubjectFactory-726"><span class="linenos"> 726</span></a><span class="sd">            online (bool, optional): Whether to fetch coordinates online. If True,</span>
</span><span id="AstrologicalSubjectFactory-727"><a href="#AstrologicalSubjectFactory-727"><span class="linenos"> 727</span></a><span class="sd">                coordinates are fetched via GeoNames API. Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory-728"><a href="#AstrologicalSubjectFactory-728"><span class="linenos"> 728</span></a><span class="sd">            lng (float, optional): Longitude in decimal degrees. Used when online=False</span>
</span><span id="AstrologicalSubjectFactory-729"><a href="#AstrologicalSubjectFactory-729"><span class="linenos"> 729</span></a><span class="sd">                or as fallback. Defaults to 0.0 (Greenwich).</span>
</span><span id="AstrologicalSubjectFactory-730"><a href="#AstrologicalSubjectFactory-730"><span class="linenos"> 730</span></a><span class="sd">            lat (float, optional): Latitude in decimal degrees. Used when online=False</span>
</span><span id="AstrologicalSubjectFactory-731"><a href="#AstrologicalSubjectFactory-731"><span class="linenos"> 731</span></a><span class="sd">                or as fallback. Defaults to 51.5074 (Greenwich).</span>
</span><span id="AstrologicalSubjectFactory-732"><a href="#AstrologicalSubjectFactory-732"><span class="linenos"> 732</span></a><span class="sd">            geonames_username (str, optional): GeoNames API username. Required when</span>
</span><span id="AstrologicalSubjectFactory-733"><a href="#AstrologicalSubjectFactory-733"><span class="linenos"> 733</span></a><span class="sd">                online=True. Defaults to DEFAULT_GEONAMES_USERNAME.</span>
</span><span id="AstrologicalSubjectFactory-734"><a href="#AstrologicalSubjectFactory-734"><span class="linenos"> 734</span></a><span class="sd">            zodiac_type (ZodiacType, optional): Zodiac system. Defaults to &#39;Tropical&#39;.</span>
</span><span id="AstrologicalSubjectFactory-735"><a href="#AstrologicalSubjectFactory-735"><span class="linenos"> 735</span></a><span class="sd">            sidereal_mode (SiderealMode, optional): Sidereal mode when zodiac_type</span>
</span><span id="AstrologicalSubjectFactory-736"><a href="#AstrologicalSubjectFactory-736"><span class="linenos"> 736</span></a><span class="sd">                is &#39;Sidereal&#39;. Defaults to None.</span>
</span><span id="AstrologicalSubjectFactory-737"><a href="#AstrologicalSubjectFactory-737"><span class="linenos"> 737</span></a><span class="sd">            houses_system_identifier (HousesSystemIdentifier, optional): House system.</span>
</span><span id="AstrologicalSubjectFactory-738"><a href="#AstrologicalSubjectFactory-738"><span class="linenos"> 738</span></a><span class="sd">                Defaults to &#39;P&#39; (Placidus).</span>
</span><span id="AstrologicalSubjectFactory-739"><a href="#AstrologicalSubjectFactory-739"><span class="linenos"> 739</span></a><span class="sd">            perspective_type (PerspectiveType, optional): Calculation perspective.</span>
</span><span id="AstrologicalSubjectFactory-740"><a href="#AstrologicalSubjectFactory-740"><span class="linenos"> 740</span></a><span class="sd">                Defaults to &#39;Apparent Geocentric&#39;.</span>
</span><span id="AstrologicalSubjectFactory-741"><a href="#AstrologicalSubjectFactory-741"><span class="linenos"> 741</span></a><span class="sd">            altitude (float, optional): Altitude in meters for topocentric calculations.</span>
</span><span id="AstrologicalSubjectFactory-742"><a href="#AstrologicalSubjectFactory-742"><span class="linenos"> 742</span></a><span class="sd">                Defaults to None (sea level).</span>
</span><span id="AstrologicalSubjectFactory-743"><a href="#AstrologicalSubjectFactory-743"><span class="linenos"> 743</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]], optional): Points to calculate.</span>
</span><span id="AstrologicalSubjectFactory-744"><a href="#AstrologicalSubjectFactory-744"><span class="linenos"> 744</span></a><span class="sd">                If None, uses DEFAULT_ACTIVE_POINTS.</span>
</span><span id="AstrologicalSubjectFactory-745"><a href="#AstrologicalSubjectFactory-745"><span class="linenos"> 745</span></a><span class="sd">            calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.</span>
</span><span id="AstrologicalSubjectFactory-746"><a href="#AstrologicalSubjectFactory-746"><span class="linenos"> 746</span></a><span class="sd">                Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory-747"><a href="#AstrologicalSubjectFactory-747"><span class="linenos"> 747</span></a>
</span><span id="AstrologicalSubjectFactory-748"><a href="#AstrologicalSubjectFactory-748"><span class="linenos"> 748</span></a><span class="sd">        Returns:</span>
</span><span id="AstrologicalSubjectFactory-749"><a href="#AstrologicalSubjectFactory-749"><span class="linenos"> 749</span></a><span class="sd">            AstrologicalSubjectModel: Astrological subject with positions calculated</span>
</span><span id="AstrologicalSubjectFactory-750"><a href="#AstrologicalSubjectFactory-750"><span class="linenos"> 750</span></a><span class="sd">                for the specified UTC time converted to local timezone.</span>
</span><span id="AstrologicalSubjectFactory-751"><a href="#AstrologicalSubjectFactory-751"><span class="linenos"> 751</span></a>
</span><span id="AstrologicalSubjectFactory-752"><a href="#AstrologicalSubjectFactory-752"><span class="linenos"> 752</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory-753"><a href="#AstrologicalSubjectFactory-753"><span class="linenos"> 753</span></a><span class="sd">            ValueError: If the ISO timestamp format is invalid or cannot be parsed.</span>
</span><span id="AstrologicalSubjectFactory-754"><a href="#AstrologicalSubjectFactory-754"><span class="linenos"> 754</span></a><span class="sd">            KerykeionException: If location data cannot be fetched or is invalid.</span>
</span><span id="AstrologicalSubjectFactory-755"><a href="#AstrologicalSubjectFactory-755"><span class="linenos"> 755</span></a>
</span><span id="AstrologicalSubjectFactory-756"><a href="#AstrologicalSubjectFactory-756"><span class="linenos"> 756</span></a><span class="sd">        Examples:</span>
</span><span id="AstrologicalSubjectFactory-757"><a href="#AstrologicalSubjectFactory-757"><span class="linenos"> 757</span></a><span class="sd">            &gt;&gt;&gt; # From API timestamp with online location lookup</span>
</span><span id="AstrologicalSubjectFactory-758"><a href="#AstrologicalSubjectFactory-758"><span class="linenos"> 758</span></a><span class="sd">            &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_iso_utc_time(</span>
</span><span id="AstrologicalSubjectFactory-759"><a href="#AstrologicalSubjectFactory-759"><span class="linenos"> 759</span></a><span class="sd">            ...     name=&quot;Event Chart&quot;,</span>
</span><span id="AstrologicalSubjectFactory-760"><a href="#AstrologicalSubjectFactory-760"><span class="linenos"> 760</span></a><span class="sd">            ...     iso_utc_time=&quot;2023-12-25T12:00:00Z&quot;,</span>
</span><span id="AstrologicalSubjectFactory-761"><a href="#AstrologicalSubjectFactory-761"><span class="linenos"> 761</span></a><span class="sd">            ...     city=&quot;Tokyo&quot;, nation=&quot;JP&quot;,</span>
</span><span id="AstrologicalSubjectFactory-762"><a href="#AstrologicalSubjectFactory-762"><span class="linenos"> 762</span></a><span class="sd">            ...     tz_str=&quot;Asia/Tokyo&quot;,</span>
</span><span id="AstrologicalSubjectFactory-763"><a href="#AstrologicalSubjectFactory-763"><span class="linenos"> 763</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="AstrologicalSubjectFactory-764"><a href="#AstrologicalSubjectFactory-764"><span class="linenos"> 764</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-765"><a href="#AstrologicalSubjectFactory-765"><span class="linenos"> 765</span></a>
</span><span id="AstrologicalSubjectFactory-766"><a href="#AstrologicalSubjectFactory-766"><span class="linenos"> 766</span></a><span class="sd">            &gt;&gt;&gt; # From database timestamp with manual coordinates</span>
</span><span id="AstrologicalSubjectFactory-767"><a href="#AstrologicalSubjectFactory-767"><span class="linenos"> 767</span></a><span class="sd">            &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_iso_utc_time(</span>
</span><span id="AstrologicalSubjectFactory-768"><a href="#AstrologicalSubjectFactory-768"><span class="linenos"> 768</span></a><span class="sd">            ...     name=&quot;Historical Event&quot;,</span>
</span><span id="AstrologicalSubjectFactory-769"><a href="#AstrologicalSubjectFactory-769"><span class="linenos"> 769</span></a><span class="sd">            ...     iso_utc_time=&quot;1969-07-20T20:17:00Z&quot;,</span>
</span><span id="AstrologicalSubjectFactory-770"><a href="#AstrologicalSubjectFactory-770"><span class="linenos"> 770</span></a><span class="sd">            ...     lng=-95.0969, lat=37.4419,  # Houston</span>
</span><span id="AstrologicalSubjectFactory-771"><a href="#AstrologicalSubjectFactory-771"><span class="linenos"> 771</span></a><span class="sd">            ...     tz_str=&quot;America/Chicago&quot;,</span>
</span><span id="AstrologicalSubjectFactory-772"><a href="#AstrologicalSubjectFactory-772"><span class="linenos"> 772</span></a><span class="sd">            ...     online=False</span>
</span><span id="AstrologicalSubjectFactory-773"><a href="#AstrologicalSubjectFactory-773"><span class="linenos"> 773</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-774"><a href="#AstrologicalSubjectFactory-774"><span class="linenos"> 774</span></a>
</span><span id="AstrologicalSubjectFactory-775"><a href="#AstrologicalSubjectFactory-775"><span class="linenos"> 775</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-776"><a href="#AstrologicalSubjectFactory-776"><span class="linenos"> 776</span></a><span class="sd">            - The method assumes the input timestamp is in UTC</span>
</span><span id="AstrologicalSubjectFactory-777"><a href="#AstrologicalSubjectFactory-777"><span class="linenos"> 777</span></a><span class="sd">            - Local time conversion respects DST rules for the target timezone</span>
</span><span id="AstrologicalSubjectFactory-778"><a href="#AstrologicalSubjectFactory-778"><span class="linenos"> 778</span></a><span class="sd">            - Milliseconds in the timestamp are supported but truncated to seconds</span>
</span><span id="AstrologicalSubjectFactory-779"><a href="#AstrologicalSubjectFactory-779"><span class="linenos"> 779</span></a><span class="sd">            - When online=True, the city/nation parameters override lng/lat</span>
</span><span id="AstrologicalSubjectFactory-780"><a href="#AstrologicalSubjectFactory-780"><span class="linenos"> 780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-781"><a href="#AstrologicalSubjectFactory-781"><span class="linenos"> 781</span></a>        <span class="c1"># Parse the ISO time</span>
</span><span id="AstrologicalSubjectFactory-782"><a href="#AstrologicalSubjectFactory-782"><span class="linenos"> 782</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_utc_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-783"><a href="#AstrologicalSubjectFactory-783"><span class="linenos"> 783</span></a>
</span><span id="AstrologicalSubjectFactory-784"><a href="#AstrologicalSubjectFactory-784"><span class="linenos"> 784</span></a>        <span class="c1"># Get location data if online mode is enabled</span>
</span><span id="AstrologicalSubjectFactory-785"><a href="#AstrologicalSubjectFactory-785"><span class="linenos"> 785</span></a>        <span class="k">if</span> <span class="n">online</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-786"><a href="#AstrologicalSubjectFactory-786"><span class="linenos"> 786</span></a>            <span class="k">if</span> <span class="n">geonames_username</span> <span class="o">==</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-787"><a href="#AstrologicalSubjectFactory-787"><span class="linenos"> 787</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_geonames_warning</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-788"><a href="#AstrologicalSubjectFactory-788"><span class="linenos"> 788</span></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-789"><a href="#AstrologicalSubjectFactory-789"><span class="linenos"> 789</span></a>
</span><span id="AstrologicalSubjectFactory-790"><a href="#AstrologicalSubjectFactory-790"><span class="linenos"> 790</span></a>            <span class="n">geonames</span> <span class="o">=</span> <span class="n">FetchGeonames</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-791"><a href="#AstrologicalSubjectFactory-791"><span class="linenos"> 791</span></a>                <span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-792"><a href="#AstrologicalSubjectFactory-792"><span class="linenos"> 792</span></a>                <span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-793"><a href="#AstrologicalSubjectFactory-793"><span class="linenos"> 793</span></a>                <span class="n">username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-794"><a href="#AstrologicalSubjectFactory-794"><span class="linenos"> 794</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-795"><a href="#AstrologicalSubjectFactory-795"><span class="linenos"> 795</span></a>
</span><span id="AstrologicalSubjectFactory-796"><a href="#AstrologicalSubjectFactory-796"><span class="linenos"> 796</span></a>            <span class="n">city_data</span> <span class="o">=</span> <span class="n">geonames</span><span class="o">.</span><span class="n">get_serialized_data</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-797"><a href="#AstrologicalSubjectFactory-797"><span class="linenos"> 797</span></a>            <span class="n">lng</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-798"><a href="#AstrologicalSubjectFactory-798"><span class="linenos"> 798</span></a>            <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-799"><a href="#AstrologicalSubjectFactory-799"><span class="linenos"> 799</span></a>
</span><span id="AstrologicalSubjectFactory-800"><a href="#AstrologicalSubjectFactory-800"><span class="linenos"> 800</span></a>        <span class="c1"># Convert UTC to local time</span>
</span><span id="AstrologicalSubjectFactory-801"><a href="#AstrologicalSubjectFactory-801"><span class="linenos"> 801</span></a>        <span class="n">local_time</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">tz_str</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-802"><a href="#AstrologicalSubjectFactory-802"><span class="linenos"> 802</span></a>        <span class="n">local_datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-803"><a href="#AstrologicalSubjectFactory-803"><span class="linenos"> 803</span></a>
</span><span id="AstrologicalSubjectFactory-804"><a href="#AstrologicalSubjectFactory-804"><span class="linenos"> 804</span></a>        <span class="c1"># Create the subject with local time</span>
</span><span id="AstrologicalSubjectFactory-805"><a href="#AstrologicalSubjectFactory-805"><span class="linenos"> 805</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-806"><a href="#AstrologicalSubjectFactory-806"><span class="linenos"> 806</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-807"><a href="#AstrologicalSubjectFactory-807"><span class="linenos"> 807</span></a>            <span class="n">year</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-808"><a href="#AstrologicalSubjectFactory-808"><span class="linenos"> 808</span></a>            <span class="n">month</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-809"><a href="#AstrologicalSubjectFactory-809"><span class="linenos"> 809</span></a>            <span class="n">day</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-810"><a href="#AstrologicalSubjectFactory-810"><span class="linenos"> 810</span></a>            <span class="n">hour</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-811"><a href="#AstrologicalSubjectFactory-811"><span class="linenos"> 811</span></a>            <span class="n">minute</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-812"><a href="#AstrologicalSubjectFactory-812"><span class="linenos"> 812</span></a>            <span class="n">seconds</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-813"><a href="#AstrologicalSubjectFactory-813"><span class="linenos"> 813</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-814"><a href="#AstrologicalSubjectFactory-814"><span class="linenos"> 814</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-815"><a href="#AstrologicalSubjectFactory-815"><span class="linenos"> 815</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">lng</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-816"><a href="#AstrologicalSubjectFactory-816"><span class="linenos"> 816</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-817"><a href="#AstrologicalSubjectFactory-817"><span class="linenos"> 817</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-818"><a href="#AstrologicalSubjectFactory-818"><span class="linenos"> 818</span></a>            <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Already fetched data if needed</span>
</span><span id="AstrologicalSubjectFactory-819"><a href="#AstrologicalSubjectFactory-819"><span class="linenos"> 819</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-820"><a href="#AstrologicalSubjectFactory-820"><span class="linenos"> 820</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-821"><a href="#AstrologicalSubjectFactory-821"><span class="linenos"> 821</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-822"><a href="#AstrologicalSubjectFactory-822"><span class="linenos"> 822</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-823"><a href="#AstrologicalSubjectFactory-823"><span class="linenos"> 823</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-824"><a href="#AstrologicalSubjectFactory-824"><span class="linenos"> 824</span></a>            <span class="n">altitude</span><span class="o">=</span><span class="n">altitude</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-825"><a href="#AstrologicalSubjectFactory-825"><span class="linenos"> 825</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-826"><a href="#AstrologicalSubjectFactory-826"><span class="linenos"> 826</span></a>            <span class="n">calculate_lunar_phase</span><span class="o">=</span><span class="n">calculate_lunar_phase</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-827"><a href="#AstrologicalSubjectFactory-827"><span class="linenos"> 827</span></a>            <span class="n">suppress_geonames_warning</span><span class="o">=</span><span class="n">suppress_geonames_warning</span>
</span><span id="AstrologicalSubjectFactory-828"><a href="#AstrologicalSubjectFactory-828"><span class="linenos"> 828</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-829"><a href="#AstrologicalSubjectFactory-829"><span class="linenos"> 829</span></a>
</span><span id="AstrologicalSubjectFactory-830"><a href="#AstrologicalSubjectFactory-830"><span class="linenos"> 830</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubjectFactory-831"><a href="#AstrologicalSubjectFactory-831"><span class="linenos"> 831</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_current_time</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-832"><a href="#AstrologicalSubjectFactory-832"><span class="linenos"> 832</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-833"><a href="#AstrologicalSubjectFactory-833"><span class="linenos"> 833</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-834"><a href="#AstrologicalSubjectFactory-834"><span class="linenos"> 834</span></a>        <span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-835"><a href="#AstrologicalSubjectFactory-835"><span class="linenos"> 835</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-836"><a href="#AstrologicalSubjectFactory-836"><span class="linenos"> 836</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-837"><a href="#AstrologicalSubjectFactory-837"><span class="linenos"> 837</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-838"><a href="#AstrologicalSubjectFactory-838"><span class="linenos"> 838</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-839"><a href="#AstrologicalSubjectFactory-839"><span class="linenos"> 839</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-840"><a href="#AstrologicalSubjectFactory-840"><span class="linenos"> 840</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-841"><a href="#AstrologicalSubjectFactory-841"><span class="linenos"> 841</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-842"><a href="#AstrologicalSubjectFactory-842"><span class="linenos"> 842</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-843"><a href="#AstrologicalSubjectFactory-843"><span class="linenos"> 843</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-844"><a href="#AstrologicalSubjectFactory-844"><span class="linenos"> 844</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-845"><a href="#AstrologicalSubjectFactory-845"><span class="linenos"> 845</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-846"><a href="#AstrologicalSubjectFactory-846"><span class="linenos"> 846</span></a>        <span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-847"><a href="#AstrologicalSubjectFactory-847"><span class="linenos"> 847</span></a>        <span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-848"><a href="#AstrologicalSubjectFactory-848"><span class="linenos"> 848</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-849"><a href="#AstrologicalSubjectFactory-849"><span class="linenos"> 849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-850"><a href="#AstrologicalSubjectFactory-850"><span class="linenos"> 850</span></a><span class="sd">        Create an astrological subject for the current moment in time.</span>
</span><span id="AstrologicalSubjectFactory-851"><a href="#AstrologicalSubjectFactory-851"><span class="linenos"> 851</span></a>
</span><span id="AstrologicalSubjectFactory-852"><a href="#AstrologicalSubjectFactory-852"><span class="linenos"> 852</span></a><span class="sd">        This convenience method creates a &quot;now&quot; chart, capturing the current</span>
</span><span id="AstrologicalSubjectFactory-853"><a href="#AstrologicalSubjectFactory-853"><span class="linenos"> 853</span></a><span class="sd">        astrological conditions at the moment of execution. Useful for horary</span>
</span><span id="AstrologicalSubjectFactory-854"><a href="#AstrologicalSubjectFactory-854"><span class="linenos"> 854</span></a><span class="sd">        astrology, electional astrology, or real-time astrological monitoring.</span>
</span><span id="AstrologicalSubjectFactory-855"><a href="#AstrologicalSubjectFactory-855"><span class="linenos"> 855</span></a>
</span><span id="AstrologicalSubjectFactory-856"><a href="#AstrologicalSubjectFactory-856"><span class="linenos"> 856</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-857"><a href="#AstrologicalSubjectFactory-857"><span class="linenos"> 857</span></a><span class="sd">            name (str, optional): Name for the current moment chart.</span>
</span><span id="AstrologicalSubjectFactory-858"><a href="#AstrologicalSubjectFactory-858"><span class="linenos"> 858</span></a><span class="sd">                Defaults to &quot;Now&quot;.</span>
</span><span id="AstrologicalSubjectFactory-859"><a href="#AstrologicalSubjectFactory-859"><span class="linenos"> 859</span></a><span class="sd">            city (str, optional): City name for location lookup. If not provided</span>
</span><span id="AstrologicalSubjectFactory-860"><a href="#AstrologicalSubjectFactory-860"><span class="linenos"> 860</span></a><span class="sd">                and online=True, defaults to Greenwich.</span>
</span><span id="AstrologicalSubjectFactory-861"><a href="#AstrologicalSubjectFactory-861"><span class="linenos"> 861</span></a><span class="sd">            nation (str, optional): ISO country code. If not provided and</span>
</span><span id="AstrologicalSubjectFactory-862"><a href="#AstrologicalSubjectFactory-862"><span class="linenos"> 862</span></a><span class="sd">                online=True, defaults to &#39;GB&#39;.</span>
</span><span id="AstrologicalSubjectFactory-863"><a href="#AstrologicalSubjectFactory-863"><span class="linenos"> 863</span></a><span class="sd">            lng (float, optional): Longitude in decimal degrees. If not provided</span>
</span><span id="AstrologicalSubjectFactory-864"><a href="#AstrologicalSubjectFactory-864"><span class="linenos"> 864</span></a><span class="sd">                and online=True, fetched from GeoNames API.</span>
</span><span id="AstrologicalSubjectFactory-865"><a href="#AstrologicalSubjectFactory-865"><span class="linenos"> 865</span></a><span class="sd">            lat (float, optional): Latitude in decimal degrees. If not provided</span>
</span><span id="AstrologicalSubjectFactory-866"><a href="#AstrologicalSubjectFactory-866"><span class="linenos"> 866</span></a><span class="sd">                and online=True, fetched from GeoNames API.</span>
</span><span id="AstrologicalSubjectFactory-867"><a href="#AstrologicalSubjectFactory-867"><span class="linenos"> 867</span></a><span class="sd">            tz_str (str, optional): IANA timezone identifier. If not provided</span>
</span><span id="AstrologicalSubjectFactory-868"><a href="#AstrologicalSubjectFactory-868"><span class="linenos"> 868</span></a><span class="sd">                and online=True, fetched from GeoNames API.</span>
</span><span id="AstrologicalSubjectFactory-869"><a href="#AstrologicalSubjectFactory-869"><span class="linenos"> 869</span></a><span class="sd">            geonames_username (str, optional): GeoNames API username for location</span>
</span><span id="AstrologicalSubjectFactory-870"><a href="#AstrologicalSubjectFactory-870"><span class="linenos"> 870</span></a><span class="sd">                lookup. Required when online=True and location is not fully specified.</span>
</span><span id="AstrologicalSubjectFactory-871"><a href="#AstrologicalSubjectFactory-871"><span class="linenos"> 871</span></a><span class="sd">            online (bool, optional): Whether to fetch location data online.</span>
</span><span id="AstrologicalSubjectFactory-872"><a href="#AstrologicalSubjectFactory-872"><span class="linenos"> 872</span></a><span class="sd">                Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory-873"><a href="#AstrologicalSubjectFactory-873"><span class="linenos"> 873</span></a><span class="sd">            zodiac_type (ZodiacType, optional): Zodiac system to use.</span>
</span><span id="AstrologicalSubjectFactory-874"><a href="#AstrologicalSubjectFactory-874"><span class="linenos"> 874</span></a><span class="sd">                Defaults to &#39;Tropical&#39;.</span>
</span><span id="AstrologicalSubjectFactory-875"><a href="#AstrologicalSubjectFactory-875"><span class="linenos"> 875</span></a><span class="sd">            sidereal_mode (SiderealMode, optional): Sidereal calculation mode.</span>
</span><span id="AstrologicalSubjectFactory-876"><a href="#AstrologicalSubjectFactory-876"><span class="linenos"> 876</span></a><span class="sd">                Only used when zodiac_type is &#39;Sidereal&#39;. Defaults to None.</span>
</span><span id="AstrologicalSubjectFactory-877"><a href="#AstrologicalSubjectFactory-877"><span class="linenos"> 877</span></a><span class="sd">            houses_system_identifier (HousesSystemIdentifier, optional): House</span>
</span><span id="AstrologicalSubjectFactory-878"><a href="#AstrologicalSubjectFactory-878"><span class="linenos"> 878</span></a><span class="sd">                system for calculations. Defaults to &#39;P&#39; (Placidus).</span>
</span><span id="AstrologicalSubjectFactory-879"><a href="#AstrologicalSubjectFactory-879"><span class="linenos"> 879</span></a><span class="sd">            perspective_type (PerspectiveType, optional): Calculation perspective.</span>
</span><span id="AstrologicalSubjectFactory-880"><a href="#AstrologicalSubjectFactory-880"><span class="linenos"> 880</span></a><span class="sd">                Defaults to &#39;Apparent Geocentric&#39;.</span>
</span><span id="AstrologicalSubjectFactory-881"><a href="#AstrologicalSubjectFactory-881"><span class="linenos"> 881</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]], optional): Astrological points</span>
</span><span id="AstrologicalSubjectFactory-882"><a href="#AstrologicalSubjectFactory-882"><span class="linenos"> 882</span></a><span class="sd">                to calculate. If None, uses DEFAULT_ACTIVE_POINTS.</span>
</span><span id="AstrologicalSubjectFactory-883"><a href="#AstrologicalSubjectFactory-883"><span class="linenos"> 883</span></a><span class="sd">            calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.</span>
</span><span id="AstrologicalSubjectFactory-884"><a href="#AstrologicalSubjectFactory-884"><span class="linenos"> 884</span></a><span class="sd">                Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory-885"><a href="#AstrologicalSubjectFactory-885"><span class="linenos"> 885</span></a>
</span><span id="AstrologicalSubjectFactory-886"><a href="#AstrologicalSubjectFactory-886"><span class="linenos"> 886</span></a><span class="sd">        Returns:</span>
</span><span id="AstrologicalSubjectFactory-887"><a href="#AstrologicalSubjectFactory-887"><span class="linenos"> 887</span></a><span class="sd">            AstrologicalSubjectModel: Astrological subject representing current</span>
</span><span id="AstrologicalSubjectFactory-888"><a href="#AstrologicalSubjectFactory-888"><span class="linenos"> 888</span></a><span class="sd">                astrological conditions at the specified or default location.</span>
</span><span id="AstrologicalSubjectFactory-889"><a href="#AstrologicalSubjectFactory-889"><span class="linenos"> 889</span></a>
</span><span id="AstrologicalSubjectFactory-890"><a href="#AstrologicalSubjectFactory-890"><span class="linenos"> 890</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory-891"><a href="#AstrologicalSubjectFactory-891"><span class="linenos"> 891</span></a><span class="sd">            KerykeionException: If online location lookup fails or if offline mode</span>
</span><span id="AstrologicalSubjectFactory-892"><a href="#AstrologicalSubjectFactory-892"><span class="linenos"> 892</span></a><span class="sd">                is used without sufficient location data.</span>
</span><span id="AstrologicalSubjectFactory-893"><a href="#AstrologicalSubjectFactory-893"><span class="linenos"> 893</span></a>
</span><span id="AstrologicalSubjectFactory-894"><a href="#AstrologicalSubjectFactory-894"><span class="linenos"> 894</span></a><span class="sd">        Examples:</span>
</span><span id="AstrologicalSubjectFactory-895"><a href="#AstrologicalSubjectFactory-895"><span class="linenos"> 895</span></a><span class="sd">            &gt;&gt;&gt; # Current moment for your location</span>
</span><span id="AstrologicalSubjectFactory-896"><a href="#AstrologicalSubjectFactory-896"><span class="linenos"> 896</span></a><span class="sd">            &gt;&gt;&gt; now_chart = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory-897"><a href="#AstrologicalSubjectFactory-897"><span class="linenos"> 897</span></a><span class="sd">            ...     name=&quot;Current Transits&quot;,</span>
</span><span id="AstrologicalSubjectFactory-898"><a href="#AstrologicalSubjectFactory-898"><span class="linenos"> 898</span></a><span class="sd">            ...     city=&quot;New York&quot;, nation=&quot;US&quot;,</span>
</span><span id="AstrologicalSubjectFactory-899"><a href="#AstrologicalSubjectFactory-899"><span class="linenos"> 899</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="AstrologicalSubjectFactory-900"><a href="#AstrologicalSubjectFactory-900"><span class="linenos"> 900</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-901"><a href="#AstrologicalSubjectFactory-901"><span class="linenos"> 901</span></a>
</span><span id="AstrologicalSubjectFactory-902"><a href="#AstrologicalSubjectFactory-902"><span class="linenos"> 902</span></a><span class="sd">            &gt;&gt;&gt; # Horary chart with specific coordinates</span>
</span><span id="AstrologicalSubjectFactory-903"><a href="#AstrologicalSubjectFactory-903"><span class="linenos"> 903</span></a><span class="sd">            &gt;&gt;&gt; horary = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory-904"><a href="#AstrologicalSubjectFactory-904"><span class="linenos"> 904</span></a><span class="sd">            ...     name=&quot;Horary Question&quot;,</span>
</span><span id="AstrologicalSubjectFactory-905"><a href="#AstrologicalSubjectFactory-905"><span class="linenos"> 905</span></a><span class="sd">            ...     lng=-0.1278, lat=51.5074,  # London</span>
</span><span id="AstrologicalSubjectFactory-906"><a href="#AstrologicalSubjectFactory-906"><span class="linenos"> 906</span></a><span class="sd">            ...     tz_str=&quot;Europe/London&quot;,</span>
</span><span id="AstrologicalSubjectFactory-907"><a href="#AstrologicalSubjectFactory-907"><span class="linenos"> 907</span></a><span class="sd">            ...     online=False</span>
</span><span id="AstrologicalSubjectFactory-908"><a href="#AstrologicalSubjectFactory-908"><span class="linenos"> 908</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-909"><a href="#AstrologicalSubjectFactory-909"><span class="linenos"> 909</span></a>
</span><span id="AstrologicalSubjectFactory-910"><a href="#AstrologicalSubjectFactory-910"><span class="linenos"> 910</span></a><span class="sd">            &gt;&gt;&gt; # Current sidereal positions</span>
</span><span id="AstrologicalSubjectFactory-911"><a href="#AstrologicalSubjectFactory-911"><span class="linenos"> 911</span></a><span class="sd">            &gt;&gt;&gt; sidereal_now = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory-912"><a href="#AstrologicalSubjectFactory-912"><span class="linenos"> 912</span></a><span class="sd">            ...     name=&quot;Sidereal Now&quot;,</span>
</span><span id="AstrologicalSubjectFactory-913"><a href="#AstrologicalSubjectFactory-913"><span class="linenos"> 913</span></a><span class="sd">            ...     city=&quot;Mumbai&quot;, nation=&quot;IN&quot;,</span>
</span><span id="AstrologicalSubjectFactory-914"><a href="#AstrologicalSubjectFactory-914"><span class="linenos"> 914</span></a><span class="sd">            ...     zodiac_type=&quot;Sidereal&quot;,</span>
</span><span id="AstrologicalSubjectFactory-915"><a href="#AstrologicalSubjectFactory-915"><span class="linenos"> 915</span></a><span class="sd">            ...     sidereal_mode=&quot;LAHIRI&quot;</span>
</span><span id="AstrologicalSubjectFactory-916"><a href="#AstrologicalSubjectFactory-916"><span class="linenos"> 916</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory-917"><a href="#AstrologicalSubjectFactory-917"><span class="linenos"> 917</span></a>
</span><span id="AstrologicalSubjectFactory-918"><a href="#AstrologicalSubjectFactory-918"><span class="linenos"> 918</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-919"><a href="#AstrologicalSubjectFactory-919"><span class="linenos"> 919</span></a><span class="sd">            - The exact time is captured at method execution, including seconds</span>
</span><span id="AstrologicalSubjectFactory-920"><a href="#AstrologicalSubjectFactory-920"><span class="linenos"> 920</span></a><span class="sd">            - For horary astrology, consider the moment of understanding the question</span>
</span><span id="AstrologicalSubjectFactory-921"><a href="#AstrologicalSubjectFactory-921"><span class="linenos"> 921</span></a><span class="sd">            - System clock accuracy affects precision; ensure accurate system time</span>
</span><span id="AstrologicalSubjectFactory-922"><a href="#AstrologicalSubjectFactory-922"><span class="linenos"> 922</span></a><span class="sd">            - Time zone detection is automatic when using online location lookup</span>
</span><span id="AstrologicalSubjectFactory-923"><a href="#AstrologicalSubjectFactory-923"><span class="linenos"> 923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-924"><a href="#AstrologicalSubjectFactory-924"><span class="linenos"> 924</span></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-925"><a href="#AstrologicalSubjectFactory-925"><span class="linenos"> 925</span></a>
</span><span id="AstrologicalSubjectFactory-926"><a href="#AstrologicalSubjectFactory-926"><span class="linenos"> 926</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-927"><a href="#AstrologicalSubjectFactory-927"><span class="linenos"> 927</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-928"><a href="#AstrologicalSubjectFactory-928"><span class="linenos"> 928</span></a>            <span class="n">year</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-929"><a href="#AstrologicalSubjectFactory-929"><span class="linenos"> 929</span></a>            <span class="n">month</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-930"><a href="#AstrologicalSubjectFactory-930"><span class="linenos"> 930</span></a>            <span class="n">day</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-931"><a href="#AstrologicalSubjectFactory-931"><span class="linenos"> 931</span></a>            <span class="n">hour</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-932"><a href="#AstrologicalSubjectFactory-932"><span class="linenos"> 932</span></a>            <span class="n">minute</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-933"><a href="#AstrologicalSubjectFactory-933"><span class="linenos"> 933</span></a>            <span class="n">seconds</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-934"><a href="#AstrologicalSubjectFactory-934"><span class="linenos"> 934</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-935"><a href="#AstrologicalSubjectFactory-935"><span class="linenos"> 935</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-936"><a href="#AstrologicalSubjectFactory-936"><span class="linenos"> 936</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">lng</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-937"><a href="#AstrologicalSubjectFactory-937"><span class="linenos"> 937</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-938"><a href="#AstrologicalSubjectFactory-938"><span class="linenos"> 938</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-939"><a href="#AstrologicalSubjectFactory-939"><span class="linenos"> 939</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-940"><a href="#AstrologicalSubjectFactory-940"><span class="linenos"> 940</span></a>            <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-941"><a href="#AstrologicalSubjectFactory-941"><span class="linenos"> 941</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-942"><a href="#AstrologicalSubjectFactory-942"><span class="linenos"> 942</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-943"><a href="#AstrologicalSubjectFactory-943"><span class="linenos"> 943</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-944"><a href="#AstrologicalSubjectFactory-944"><span class="linenos"> 944</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-945"><a href="#AstrologicalSubjectFactory-945"><span class="linenos"> 945</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-946"><a href="#AstrologicalSubjectFactory-946"><span class="linenos"> 946</span></a>            <span class="n">calculate_lunar_phase</span><span class="o">=</span><span class="n">calculate_lunar_phase</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-947"><a href="#AstrologicalSubjectFactory-947"><span class="linenos"> 947</span></a>            <span class="n">suppress_geonames_warning</span><span class="o">=</span><span class="n">suppress_geonames_warning</span>
</span><span id="AstrologicalSubjectFactory-948"><a href="#AstrologicalSubjectFactory-948"><span class="linenos"> 948</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-949"><a href="#AstrologicalSubjectFactory-949"><span class="linenos"> 949</span></a>
</span><span id="AstrologicalSubjectFactory-950"><a href="#AstrologicalSubjectFactory-950"><span class="linenos"> 950</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AstrologicalSubjectFactory-951"><a href="#AstrologicalSubjectFactory-951"><span class="linenos"> 951</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_time_conversions</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">location</span><span class="p">:</span> <span class="n">LocationData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-952"><a href="#AstrologicalSubjectFactory-952"><span class="linenos"> 952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-953"><a href="#AstrologicalSubjectFactory-953"><span class="linenos"> 953</span></a><span class="sd">        Calculate time conversions between local time, UTC, and Julian Day Number.</span>
</span><span id="AstrologicalSubjectFactory-954"><a href="#AstrologicalSubjectFactory-954"><span class="linenos"> 954</span></a>
</span><span id="AstrologicalSubjectFactory-955"><a href="#AstrologicalSubjectFactory-955"><span class="linenos"> 955</span></a><span class="sd">        Handles timezone-aware conversion from local civil time to UTC and astronomical</span>
</span><span id="AstrologicalSubjectFactory-956"><a href="#AstrologicalSubjectFactory-956"><span class="linenos"> 956</span></a><span class="sd">        Julian Day Number, including proper DST handling and timezone localization.</span>
</span><span id="AstrologicalSubjectFactory-957"><a href="#AstrologicalSubjectFactory-957"><span class="linenos"> 957</span></a>
</span><span id="AstrologicalSubjectFactory-958"><a href="#AstrologicalSubjectFactory-958"><span class="linenos"> 958</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-959"><a href="#AstrologicalSubjectFactory-959"><span class="linenos"> 959</span></a><span class="sd">            data (Dict[str, Any]): Calculation data dictionary containing time components</span>
</span><span id="AstrologicalSubjectFactory-960"><a href="#AstrologicalSubjectFactory-960"><span class="linenos"> 960</span></a><span class="sd">                (year, month, day, hour, minute, seconds) and optional DST flag.</span>
</span><span id="AstrologicalSubjectFactory-961"><a href="#AstrologicalSubjectFactory-961"><span class="linenos"> 961</span></a><span class="sd">            location (LocationData): Location data containing timezone information.</span>
</span><span id="AstrologicalSubjectFactory-962"><a href="#AstrologicalSubjectFactory-962"><span class="linenos"> 962</span></a>
</span><span id="AstrologicalSubjectFactory-963"><a href="#AstrologicalSubjectFactory-963"><span class="linenos"> 963</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory-964"><a href="#AstrologicalSubjectFactory-964"><span class="linenos"> 964</span></a><span class="sd">            KerykeionException: If DST ambiguity occurs during timezone transitions</span>
</span><span id="AstrologicalSubjectFactory-965"><a href="#AstrologicalSubjectFactory-965"><span class="linenos"> 965</span></a><span class="sd">                and is_dst parameter is not explicitly set to resolve the ambiguity.</span>
</span><span id="AstrologicalSubjectFactory-966"><a href="#AstrologicalSubjectFactory-966"><span class="linenos"> 966</span></a>
</span><span id="AstrologicalSubjectFactory-967"><a href="#AstrologicalSubjectFactory-967"><span class="linenos"> 967</span></a><span class="sd">        Side Effects:</span>
</span><span id="AstrologicalSubjectFactory-968"><a href="#AstrologicalSubjectFactory-968"><span class="linenos"> 968</span></a><span class="sd">            Updates data dictionary with:</span>
</span><span id="AstrologicalSubjectFactory-969"><a href="#AstrologicalSubjectFactory-969"><span class="linenos"> 969</span></a><span class="sd">            - iso_formatted_utc_datetime: ISO 8601 UTC timestamp</span>
</span><span id="AstrologicalSubjectFactory-970"><a href="#AstrologicalSubjectFactory-970"><span class="linenos"> 970</span></a><span class="sd">            - iso_formatted_local_datetime: ISO 8601 local timestamp</span>
</span><span id="AstrologicalSubjectFactory-971"><a href="#AstrologicalSubjectFactory-971"><span class="linenos"> 971</span></a><span class="sd">            - julian_day: Julian Day Number for astronomical calculations</span>
</span><span id="AstrologicalSubjectFactory-972"><a href="#AstrologicalSubjectFactory-972"><span class="linenos"> 972</span></a>
</span><span id="AstrologicalSubjectFactory-973"><a href="#AstrologicalSubjectFactory-973"><span class="linenos"> 973</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-974"><a href="#AstrologicalSubjectFactory-974"><span class="linenos"> 974</span></a><span class="sd">            During DST transitions, times may be ambiguous (fall back) or non-existent</span>
</span><span id="AstrologicalSubjectFactory-975"><a href="#AstrologicalSubjectFactory-975"><span class="linenos"> 975</span></a><span class="sd">            (spring forward). The method raises an exception for ambiguous times unless</span>
</span><span id="AstrologicalSubjectFactory-976"><a href="#AstrologicalSubjectFactory-976"><span class="linenos"> 976</span></a><span class="sd">            the is_dst parameter is explicitly set to True or False.</span>
</span><span id="AstrologicalSubjectFactory-977"><a href="#AstrologicalSubjectFactory-977"><span class="linenos"> 977</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-978"><a href="#AstrologicalSubjectFactory-978"><span class="linenos"> 978</span></a>        <span class="c1"># Convert local time to UTC</span>
</span><span id="AstrologicalSubjectFactory-979"><a href="#AstrologicalSubjectFactory-979"><span class="linenos"> 979</span></a>        <span class="n">local_timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">tz_str</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-980"><a href="#AstrologicalSubjectFactory-980"><span class="linenos"> 980</span></a>        <span class="n">naive_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-981"><a href="#AstrologicalSubjectFactory-981"><span class="linenos"> 981</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-982"><a href="#AstrologicalSubjectFactory-982"><span class="linenos"> 982</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;minute&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;seconds&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-983"><a href="#AstrologicalSubjectFactory-983"><span class="linenos"> 983</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-984"><a href="#AstrologicalSubjectFactory-984"><span class="linenos"> 984</span></a>
</span><span id="AstrologicalSubjectFactory-985"><a href="#AstrologicalSubjectFactory-985"><span class="linenos"> 985</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-986"><a href="#AstrologicalSubjectFactory-986"><span class="linenos"> 986</span></a>            <span class="n">local_datetime</span> <span class="o">=</span> <span class="n">local_timezone</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">naive_datetime</span><span class="p">,</span> <span class="n">is_dst</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_dst&quot;</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-987"><a href="#AstrologicalSubjectFactory-987"><span class="linenos"> 987</span></a>        <span class="k">except</span> <span class="n">pytz</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AmbiguousTimeError</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-988"><a href="#AstrologicalSubjectFactory-988"><span class="linenos"> 988</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-989"><a href="#AstrologicalSubjectFactory-989"><span class="linenos"> 989</span></a>                <span class="s2">&quot;Ambiguous time error! The time falls during a DST transition. &quot;</span>
</span><span id="AstrologicalSubjectFactory-990"><a href="#AstrologicalSubjectFactory-990"><span class="linenos"> 990</span></a>                <span class="s2">&quot;Please specify is_dst=True or is_dst=False to clarify.&quot;</span>
</span><span id="AstrologicalSubjectFactory-991"><a href="#AstrologicalSubjectFactory-991"><span class="linenos"> 991</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-992"><a href="#AstrologicalSubjectFactory-992"><span class="linenos"> 992</span></a>        <span class="k">except</span> <span class="n">pytz</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NonExistentTimeError</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-993"><a href="#AstrologicalSubjectFactory-993"><span class="linenos"> 993</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-994"><a href="#AstrologicalSubjectFactory-994"><span class="linenos"> 994</span></a>                <span class="s2">&quot;Non-existent time error! The time does not exist due to DST transition (spring forward). &quot;</span>
</span><span id="AstrologicalSubjectFactory-995"><a href="#AstrologicalSubjectFactory-995"><span class="linenos"> 995</span></a>                <span class="s2">&quot;Please specify a valid time.&quot;</span>
</span><span id="AstrologicalSubjectFactory-996"><a href="#AstrologicalSubjectFactory-996"><span class="linenos"> 996</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-997"><a href="#AstrologicalSubjectFactory-997"><span class="linenos"> 997</span></a>
</span><span id="AstrologicalSubjectFactory-998"><a href="#AstrologicalSubjectFactory-998"><span class="linenos"> 998</span></a>        <span class="c1"># Store formatted times</span>
</span><span id="AstrologicalSubjectFactory-999"><a href="#AstrologicalSubjectFactory-999"><span class="linenos"> 999</span></a>        <span class="n">utc_datetime</span> <span class="o">=</span> <span class="n">local_datetime</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1000"><a href="#AstrologicalSubjectFactory-1000"><span class="linenos">1000</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;iso_formatted_utc_datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utc_datetime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-1001"><a href="#AstrologicalSubjectFactory-1001"><span class="linenos">1001</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;iso_formatted_local_datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_datetime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-1002"><a href="#AstrologicalSubjectFactory-1002"><span class="linenos">1002</span></a>
</span><span id="AstrologicalSubjectFactory-1003"><a href="#AstrologicalSubjectFactory-1003"><span class="linenos">1003</span></a>        <span class="c1"># Calculate Julian day</span>
</span><span id="AstrologicalSubjectFactory-1004"><a href="#AstrologicalSubjectFactory-1004"><span class="linenos">1004</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime_to_julian</span><span class="p">(</span><span class="n">utc_datetime</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1005"><a href="#AstrologicalSubjectFactory-1005"><span class="linenos">1005</span></a>
</span><span id="AstrologicalSubjectFactory-1006"><a href="#AstrologicalSubjectFactory-1006"><span class="linenos">1006</span></a>
</span><span id="AstrologicalSubjectFactory-1007"><a href="#AstrologicalSubjectFactory-1007"><span class="linenos">1007</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AstrologicalSubjectFactory-1008"><a href="#AstrologicalSubjectFactory-1008"><span class="linenos">1008</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_houses</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]:</span>
</span><span id="AstrologicalSubjectFactory-1009"><a href="#AstrologicalSubjectFactory-1009"><span class="linenos">1009</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1010"><a href="#AstrologicalSubjectFactory-1010"><span class="linenos">1010</span></a><span class="sd">        Calculate house cusps and angular points (Ascendant, MC, etc.).</span>
</span><span id="AstrologicalSubjectFactory-1011"><a href="#AstrologicalSubjectFactory-1011"><span class="linenos">1011</span></a>
</span><span id="AstrologicalSubjectFactory-1012"><a href="#AstrologicalSubjectFactory-1012"><span class="linenos">1012</span></a><span class="sd">        Computes the 12 house cusps using the specified house system and calculates</span>
</span><span id="AstrologicalSubjectFactory-1013"><a href="#AstrologicalSubjectFactory-1013"><span class="linenos">1013</span></a><span class="sd">        the four main angles of the chart. Only calculates angular points that are</span>
</span><span id="AstrologicalSubjectFactory-1014"><a href="#AstrologicalSubjectFactory-1014"><span class="linenos">1014</span></a><span class="sd">        included in the active_points list for performance optimization.</span>
</span><span id="AstrologicalSubjectFactory-1015"><a href="#AstrologicalSubjectFactory-1015"><span class="linenos">1015</span></a>
</span><span id="AstrologicalSubjectFactory-1016"><a href="#AstrologicalSubjectFactory-1016"><span class="linenos">1016</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-1017"><a href="#AstrologicalSubjectFactory-1017"><span class="linenos">1017</span></a><span class="sd">            data (Dict[str, Any]): Calculation data dictionary containing configuration</span>
</span><span id="AstrologicalSubjectFactory-1018"><a href="#AstrologicalSubjectFactory-1018"><span class="linenos">1018</span></a><span class="sd">                and location information. Updated with calculated house and angle data.</span>
</span><span id="AstrologicalSubjectFactory-1019"><a href="#AstrologicalSubjectFactory-1019"><span class="linenos">1019</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]]): List of points to calculate.</span>
</span><span id="AstrologicalSubjectFactory-1020"><a href="#AstrologicalSubjectFactory-1020"><span class="linenos">1020</span></a><span class="sd">                If None, all points are calculated. Angular points not in this list</span>
</span><span id="AstrologicalSubjectFactory-1021"><a href="#AstrologicalSubjectFactory-1021"><span class="linenos">1021</span></a><span class="sd">                are skipped for performance.</span>
</span><span id="AstrologicalSubjectFactory-1022"><a href="#AstrologicalSubjectFactory-1022"><span class="linenos">1022</span></a>
</span><span id="AstrologicalSubjectFactory-1023"><a href="#AstrologicalSubjectFactory-1023"><span class="linenos">1023</span></a><span class="sd">        Side Effects:</span>
</span><span id="AstrologicalSubjectFactory-1024"><a href="#AstrologicalSubjectFactory-1024"><span class="linenos">1024</span></a><span class="sd">            Updates data dictionary with:</span>
</span><span id="AstrologicalSubjectFactory-1025"><a href="#AstrologicalSubjectFactory-1025"><span class="linenos">1025</span></a><span class="sd">            - House cusp objects: first_house through twelfth_house</span>
</span><span id="AstrologicalSubjectFactory-1026"><a href="#AstrologicalSubjectFactory-1026"><span class="linenos">1026</span></a><span class="sd">            - Angular points: ascendant, medium_coeli, descendant, imum_coeli</span>
</span><span id="AstrologicalSubjectFactory-1027"><a href="#AstrologicalSubjectFactory-1027"><span class="linenos">1027</span></a><span class="sd">            - houses_names_list: List of all house names</span>
</span><span id="AstrologicalSubjectFactory-1028"><a href="#AstrologicalSubjectFactory-1028"><span class="linenos">1028</span></a><span class="sd">            - _houses_degree_ut: Raw house cusp degrees for internal use</span>
</span><span id="AstrologicalSubjectFactory-1029"><a href="#AstrologicalSubjectFactory-1029"><span class="linenos">1029</span></a>
</span><span id="AstrologicalSubjectFactory-1030"><a href="#AstrologicalSubjectFactory-1030"><span class="linenos">1030</span></a><span class="sd">        House Systems Supported:</span>
</span><span id="AstrologicalSubjectFactory-1031"><a href="#AstrologicalSubjectFactory-1031"><span class="linenos">1031</span></a><span class="sd">            All systems supported by Swiss Ephemeris including Placidus, Koch,</span>
</span><span id="AstrologicalSubjectFactory-1032"><a href="#AstrologicalSubjectFactory-1032"><span class="linenos">1032</span></a><span class="sd">            Equal House, Whole Sign, Regiomontanus, Campanus, Topocentric, etc.</span>
</span><span id="AstrologicalSubjectFactory-1033"><a href="#AstrologicalSubjectFactory-1033"><span class="linenos">1033</span></a>
</span><span id="AstrologicalSubjectFactory-1034"><a href="#AstrologicalSubjectFactory-1034"><span class="linenos">1034</span></a><span class="sd">        Angular Points Calculated:</span>
</span><span id="AstrologicalSubjectFactory-1035"><a href="#AstrologicalSubjectFactory-1035"><span class="linenos">1035</span></a><span class="sd">            - Ascendant: Eastern horizon point (1st house cusp)</span>
</span><span id="AstrologicalSubjectFactory-1036"><a href="#AstrologicalSubjectFactory-1036"><span class="linenos">1036</span></a><span class="sd">            - Medium Coeli (Midheaven): Southern meridian point (10th house cusp)</span>
</span><span id="AstrologicalSubjectFactory-1037"><a href="#AstrologicalSubjectFactory-1037"><span class="linenos">1037</span></a><span class="sd">            - Descendant: Western horizon point (opposite Ascendant)</span>
</span><span id="AstrologicalSubjectFactory-1038"><a href="#AstrologicalSubjectFactory-1038"><span class="linenos">1038</span></a><span class="sd">            - Imum Coeli: Northern meridian point (opposite Medium Coeli)</span>
</span><span id="AstrologicalSubjectFactory-1039"><a href="#AstrologicalSubjectFactory-1039"><span class="linenos">1039</span></a>
</span><span id="AstrologicalSubjectFactory-1040"><a href="#AstrologicalSubjectFactory-1040"><span class="linenos">1040</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-1041"><a href="#AstrologicalSubjectFactory-1041"><span class="linenos">1041</span></a><span class="sd">            House calculations respect the zodiac type (Tropical/Sidereal) and use</span>
</span><span id="AstrologicalSubjectFactory-1042"><a href="#AstrologicalSubjectFactory-1042"><span class="linenos">1042</span></a><span class="sd">            the appropriate Swiss Ephemeris function. Angular points include house</span>
</span><span id="AstrologicalSubjectFactory-1043"><a href="#AstrologicalSubjectFactory-1043"><span class="linenos">1043</span></a><span class="sd">            position and retrograde status (always False for angles).</span>
</span><span id="AstrologicalSubjectFactory-1044"><a href="#AstrologicalSubjectFactory-1044"><span class="linenos">1044</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1045"><a href="#AstrologicalSubjectFactory-1045"><span class="linenos">1045</span></a>        <span class="c1"># Skip calculation if point is not in active_points</span>
</span><span id="AstrologicalSubjectFactory-1046"><a href="#AstrologicalSubjectFactory-1046"><span class="linenos">1046</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">should_calculate</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">AstrologicalPoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1047"><a href="#AstrologicalSubjectFactory-1047"><span class="linenos">1047</span></a>            <span class="k">return</span> <span class="ow">not</span> <span class="n">active_points</span> <span class="ow">or</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1048"><a href="#AstrologicalSubjectFactory-1048"><span class="linenos">1048</span></a>        <span class="c1"># Track which axial cusps are actually calculated</span>
</span><span id="AstrologicalSubjectFactory-1049"><a href="#AstrologicalSubjectFactory-1049"><span class="linenos">1049</span></a>        <span class="n">calculated_axial_cusps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AstrologicalSubjectFactory-1050"><a href="#AstrologicalSubjectFactory-1050"><span class="linenos">1050</span></a>
</span><span id="AstrologicalSubjectFactory-1051"><a href="#AstrologicalSubjectFactory-1051"><span class="linenos">1051</span></a>        <span class="c1"># Calculate houses based on zodiac type</span>
</span><span id="AstrologicalSubjectFactory-1052"><a href="#AstrologicalSubjectFactory-1052"><span class="linenos">1052</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sidereal&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1053"><a href="#AstrologicalSubjectFactory-1053"><span class="linenos">1053</span></a>            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1054"><a href="#AstrologicalSubjectFactory-1054"><span class="linenos">1054</span></a>                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1055"><a href="#AstrologicalSubjectFactory-1055"><span class="linenos">1055</span></a>                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1056"><a href="#AstrologicalSubjectFactory-1056"><span class="linenos">1056</span></a>                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1057"><a href="#AstrologicalSubjectFactory-1057"><span class="linenos">1057</span></a>                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]),</span>
</span><span id="AstrologicalSubjectFactory-1058"><a href="#AstrologicalSubjectFactory-1058"><span class="linenos">1058</span></a>                <span class="n">flags</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">FLG_SIDEREAL</span>
</span><span id="AstrologicalSubjectFactory-1059"><a href="#AstrologicalSubjectFactory-1059"><span class="linenos">1059</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1060"><a href="#AstrologicalSubjectFactory-1060"><span class="linenos">1060</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Tropical zodiac</span>
</span><span id="AstrologicalSubjectFactory-1061"><a href="#AstrologicalSubjectFactory-1061"><span class="linenos">1061</span></a>            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1062"><a href="#AstrologicalSubjectFactory-1062"><span class="linenos">1062</span></a>                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1063"><a href="#AstrologicalSubjectFactory-1063"><span class="linenos">1063</span></a>                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1064"><a href="#AstrologicalSubjectFactory-1064"><span class="linenos">1064</span></a>                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1065"><a href="#AstrologicalSubjectFactory-1065"><span class="linenos">1065</span></a>                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1066"><a href="#AstrologicalSubjectFactory-1066"><span class="linenos">1066</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1067"><a href="#AstrologicalSubjectFactory-1067"><span class="linenos">1067</span></a>
</span><span id="AstrologicalSubjectFactory-1068"><a href="#AstrologicalSubjectFactory-1068"><span class="linenos">1068</span></a>        <span class="c1"># Store house degrees</span>
</span><span id="AstrologicalSubjectFactory-1069"><a href="#AstrologicalSubjectFactory-1069"><span class="linenos">1069</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_houses_degree_ut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cusps</span>
</span><span id="AstrologicalSubjectFactory-1070"><a href="#AstrologicalSubjectFactory-1070"><span class="linenos">1070</span></a>
</span><span id="AstrologicalSubjectFactory-1071"><a href="#AstrologicalSubjectFactory-1071"><span class="linenos">1071</span></a>        <span class="c1"># Create house objects</span>
</span><span id="AstrologicalSubjectFactory-1072"><a href="#AstrologicalSubjectFactory-1072"><span class="linenos">1072</span></a>        <span class="n">point_type</span><span class="p">:</span> <span class="n">PointType</span> <span class="o">=</span> <span class="s2">&quot;House&quot;</span>
</span><span id="AstrologicalSubjectFactory-1073"><a href="#AstrologicalSubjectFactory-1073"><span class="linenos">1073</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;first_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;First_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1074"><a href="#AstrologicalSubjectFactory-1074"><span class="linenos">1074</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;second_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Second_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1075"><a href="#AstrologicalSubjectFactory-1075"><span class="linenos">1075</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;third_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Third_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1076"><a href="#AstrologicalSubjectFactory-1076"><span class="linenos">1076</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;fourth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;Fourth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1077"><a href="#AstrologicalSubjectFactory-1077"><span class="linenos">1077</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;fifth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;Fifth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1078"><a href="#AstrologicalSubjectFactory-1078"><span class="linenos">1078</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sixth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s2">&quot;Sixth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1079"><a href="#AstrologicalSubjectFactory-1079"><span class="linenos">1079</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;seventh_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="s2">&quot;Seventh_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1080"><a href="#AstrologicalSubjectFactory-1080"><span class="linenos">1080</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;eighth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="s2">&quot;Eighth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1081"><a href="#AstrologicalSubjectFactory-1081"><span class="linenos">1081</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ninth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="s2">&quot;Ninth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1082"><a href="#AstrologicalSubjectFactory-1082"><span class="linenos">1082</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tenth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="s2">&quot;Tenth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1083"><a href="#AstrologicalSubjectFactory-1083"><span class="linenos">1083</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;eleventh_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;Eleventh_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1084"><a href="#AstrologicalSubjectFactory-1084"><span class="linenos">1084</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;twelfth_house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">cusps</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="s2">&quot;Twelfth_House&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1085"><a href="#AstrologicalSubjectFactory-1085"><span class="linenos">1085</span></a>
</span><span id="AstrologicalSubjectFactory-1086"><a href="#AstrologicalSubjectFactory-1086"><span class="linenos">1086</span></a>        <span class="c1"># Store house names</span>
</span><span id="AstrologicalSubjectFactory-1087"><a href="#AstrologicalSubjectFactory-1087"><span class="linenos">1087</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_names_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_args</span><span class="p">(</span><span class="n">Houses</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-1088"><a href="#AstrologicalSubjectFactory-1088"><span class="linenos">1088</span></a>
</span><span id="AstrologicalSubjectFactory-1089"><a href="#AstrologicalSubjectFactory-1089"><span class="linenos">1089</span></a>        <span class="c1"># Calculate axis points</span>
</span><span id="AstrologicalSubjectFactory-1090"><a href="#AstrologicalSubjectFactory-1090"><span class="linenos">1090</span></a>        <span class="n">point_type</span> <span class="o">=</span> <span class="s2">&quot;AstrologicalPoint&quot;</span>
</span><span id="AstrologicalSubjectFactory-1091"><a href="#AstrologicalSubjectFactory-1091"><span class="linenos">1091</span></a>
</span><span id="AstrologicalSubjectFactory-1092"><a href="#AstrologicalSubjectFactory-1092"><span class="linenos">1092</span></a>        <span class="c1"># NOTE: Swiss Ephemeris does not provide direct speeds for angles (ASC/MC),</span>
</span><span id="AstrologicalSubjectFactory-1093"><a href="#AstrologicalSubjectFactory-1093"><span class="linenos">1093</span></a>        <span class="c1"># but in realt si muovono molto velocemente rispetto ai pianeti.</span>
</span><span id="AstrologicalSubjectFactory-1094"><a href="#AstrologicalSubjectFactory-1094"><span class="linenos">1094</span></a>        <span class="c1"># Per rappresentare questo in modo coerente, assegniamo ai quattro assi</span>
</span><span id="AstrologicalSubjectFactory-1095"><a href="#AstrologicalSubjectFactory-1095"><span class="linenos">1095</span></a>        <span class="c1"># una speed sintetica fissa, molto pi alta di quella planetaria tipica.</span>
</span><span id="AstrologicalSubjectFactory-1096"><a href="#AstrologicalSubjectFactory-1096"><span class="linenos">1096</span></a>        <span class="c1"># Questo permette a calculate_aspect_movement di considerarli sempre come</span>
</span><span id="AstrologicalSubjectFactory-1097"><a href="#AstrologicalSubjectFactory-1097"><span class="linenos">1097</span></a>        <span class="c1"># &quot;pi veloci&quot; rispetto ai pianeti quando serve.</span>
</span><span id="AstrologicalSubjectFactory-1098"><a href="#AstrologicalSubjectFactory-1098"><span class="linenos">1098</span></a>        <span class="n">axis_speed</span> <span class="o">=</span> <span class="mf">360.0</span>  <span class="c1"># gradi/giorno, valore simbolico ma coerente</span>
</span><span id="AstrologicalSubjectFactory-1099"><a href="#AstrologicalSubjectFactory-1099"><span class="linenos">1099</span></a>
</span><span id="AstrologicalSubjectFactory-1100"><a href="#AstrologicalSubjectFactory-1100"><span class="linenos">1100</span></a>        <span class="c1"># Calculate Ascendant if needed</span>
</span><span id="AstrologicalSubjectFactory-1101"><a href="#AstrologicalSubjectFactory-1101"><span class="linenos">1101</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1102"><a href="#AstrologicalSubjectFactory-1102"><span class="linenos">1102</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">axis_speed</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1103"><a href="#AstrologicalSubjectFactory-1103"><span class="linenos">1103</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_houses_degree_ut&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1104"><a href="#AstrologicalSubjectFactory-1104"><span class="linenos">1104</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1105"><a href="#AstrologicalSubjectFactory-1105"><span class="linenos">1105</span></a>            <span class="n">calculated_axial_cusps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1106"><a href="#AstrologicalSubjectFactory-1106"><span class="linenos">1106</span></a>
</span><span id="AstrologicalSubjectFactory-1107"><a href="#AstrologicalSubjectFactory-1107"><span class="linenos">1107</span></a>        <span class="c1"># Calculate Medium Coeli if needed</span>
</span><span id="AstrologicalSubjectFactory-1108"><a href="#AstrologicalSubjectFactory-1108"><span class="linenos">1108</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1109"><a href="#AstrologicalSubjectFactory-1109"><span class="linenos">1109</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;medium_coeli&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">axis_speed</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1110"><a href="#AstrologicalSubjectFactory-1110"><span class="linenos">1110</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;medium_coeli&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;medium_coeli&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_houses_degree_ut&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1111"><a href="#AstrologicalSubjectFactory-1111"><span class="linenos">1111</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;medium_coeli&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1112"><a href="#AstrologicalSubjectFactory-1112"><span class="linenos">1112</span></a>            <span class="n">calculated_axial_cusps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1113"><a href="#AstrologicalSubjectFactory-1113"><span class="linenos">1113</span></a>
</span><span id="AstrologicalSubjectFactory-1114"><a href="#AstrologicalSubjectFactory-1114"><span class="linenos">1114</span></a>        <span class="c1"># Calculate Descendant if needed</span>
</span><span id="AstrologicalSubjectFactory-1115"><a href="#AstrologicalSubjectFactory-1115"><span class="linenos">1115</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Descendant&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1116"><a href="#AstrologicalSubjectFactory-1116"><span class="linenos">1116</span></a>            <span class="n">dsc_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1117"><a href="#AstrologicalSubjectFactory-1117"><span class="linenos">1117</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;descendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">dsc_deg</span><span class="p">,</span> <span class="s2">&quot;Descendant&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">axis_speed</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1118"><a href="#AstrologicalSubjectFactory-1118"><span class="linenos">1118</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;descendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;descendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_houses_degree_ut&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1119"><a href="#AstrologicalSubjectFactory-1119"><span class="linenos">1119</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;descendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1120"><a href="#AstrologicalSubjectFactory-1120"><span class="linenos">1120</span></a>            <span class="n">calculated_axial_cusps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Descendant&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1121"><a href="#AstrologicalSubjectFactory-1121"><span class="linenos">1121</span></a>
</span><span id="AstrologicalSubjectFactory-1122"><a href="#AstrologicalSubjectFactory-1122"><span class="linenos">1122</span></a>        <span class="c1"># Calculate Imum Coeli if needed</span>
</span><span id="AstrologicalSubjectFactory-1123"><a href="#AstrologicalSubjectFactory-1123"><span class="linenos">1123</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Imum_Coeli&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1124"><a href="#AstrologicalSubjectFactory-1124"><span class="linenos">1124</span></a>            <span class="n">ic_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1125"><a href="#AstrologicalSubjectFactory-1125"><span class="linenos">1125</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;imum_coeli&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ic_deg</span><span class="p">,</span> <span class="s2">&quot;Imum_Coeli&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">axis_speed</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1126"><a href="#AstrologicalSubjectFactory-1126"><span class="linenos">1126</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;imum_coeli&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;imum_coeli&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_houses_degree_ut&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1127"><a href="#AstrologicalSubjectFactory-1127"><span class="linenos">1127</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;imum_coeli&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1128"><a href="#AstrologicalSubjectFactory-1128"><span class="linenos">1128</span></a>            <span class="n">calculated_axial_cusps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Imum_Coeli&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1129"><a href="#AstrologicalSubjectFactory-1129"><span class="linenos">1129</span></a>
</span><span id="AstrologicalSubjectFactory-1130"><a href="#AstrologicalSubjectFactory-1130"><span class="linenos">1130</span></a>        <span class="k">return</span> <span class="n">calculated_axial_cusps</span>
</span><span id="AstrologicalSubjectFactory-1131"><a href="#AstrologicalSubjectFactory-1131"><span class="linenos">1131</span></a>
</span><span id="AstrologicalSubjectFactory-1132"><a href="#AstrologicalSubjectFactory-1132"><span class="linenos">1132</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AstrologicalSubjectFactory-1133"><a href="#AstrologicalSubjectFactory-1133"><span class="linenos">1133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1134"><a href="#AstrologicalSubjectFactory-1134"><span class="linenos">1134</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1135"><a href="#AstrologicalSubjectFactory-1135"><span class="linenos">1135</span></a>        <span class="n">planet_name</span><span class="p">:</span> <span class="n">AstrologicalPoint</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1136"><a href="#AstrologicalSubjectFactory-1136"><span class="linenos">1136</span></a>        <span class="n">planet_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1137"><a href="#AstrologicalSubjectFactory-1137"><span class="linenos">1137</span></a>        <span class="n">julian_day</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1138"><a href="#AstrologicalSubjectFactory-1138"><span class="linenos">1138</span></a>        <span class="n">iflag</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1139"><a href="#AstrologicalSubjectFactory-1139"><span class="linenos">1139</span></a>        <span class="n">houses_degree_ut</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1140"><a href="#AstrologicalSubjectFactory-1140"><span class="linenos">1140</span></a>        <span class="n">point_type</span><span class="p">:</span> <span class="n">PointType</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1141"><a href="#AstrologicalSubjectFactory-1141"><span class="linenos">1141</span></a>        <span class="n">calculated_planets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1142"><a href="#AstrologicalSubjectFactory-1142"><span class="linenos">1142</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1143"><a href="#AstrologicalSubjectFactory-1143"><span class="linenos">1143</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1144"><a href="#AstrologicalSubjectFactory-1144"><span class="linenos">1144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1145"><a href="#AstrologicalSubjectFactory-1145"><span class="linenos">1145</span></a><span class="sd">        Calculate a single celestial body&#39;s position with comprehensive error handling.</span>
</span><span id="AstrologicalSubjectFactory-1146"><a href="#AstrologicalSubjectFactory-1146"><span class="linenos">1146</span></a>
</span><span id="AstrologicalSubjectFactory-1147"><a href="#AstrologicalSubjectFactory-1147"><span class="linenos">1147</span></a><span class="sd">        Computes the position of a single planet, asteroid, or other celestial object</span>
</span><span id="AstrologicalSubjectFactory-1148"><a href="#AstrologicalSubjectFactory-1148"><span class="linenos">1148</span></a><span class="sd">        using Swiss Ephemeris, creates a Kerykeion point object, determines house</span>
</span><span id="AstrologicalSubjectFactory-1149"><a href="#AstrologicalSubjectFactory-1149"><span class="linenos">1149</span></a><span class="sd">        position, and assesses retrograde status. Handles calculation errors gracefully</span>
</span><span id="AstrologicalSubjectFactory-1150"><a href="#AstrologicalSubjectFactory-1150"><span class="linenos">1150</span></a><span class="sd">        by logging and removing failed points from the active list.</span>
</span><span id="AstrologicalSubjectFactory-1151"><a href="#AstrologicalSubjectFactory-1151"><span class="linenos">1151</span></a>
</span><span id="AstrologicalSubjectFactory-1152"><a href="#AstrologicalSubjectFactory-1152"><span class="linenos">1152</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-1153"><a href="#AstrologicalSubjectFactory-1153"><span class="linenos">1153</span></a><span class="sd">            data (Dict[str, Any]): Main calculation data dictionary to store results.</span>
</span><span id="AstrologicalSubjectFactory-1154"><a href="#AstrologicalSubjectFactory-1154"><span class="linenos">1154</span></a><span class="sd">            planet_name (AstrologicalPoint): Name identifier for the celestial body.</span>
</span><span id="AstrologicalSubjectFactory-1155"><a href="#AstrologicalSubjectFactory-1155"><span class="linenos">1155</span></a><span class="sd">            planet_id (int): Swiss Ephemeris numerical identifier for the object.</span>
</span><span id="AstrologicalSubjectFactory-1156"><a href="#AstrologicalSubjectFactory-1156"><span class="linenos">1156</span></a><span class="sd">            julian_day (float): Julian Day Number for the calculation moment.</span>
</span><span id="AstrologicalSubjectFactory-1157"><a href="#AstrologicalSubjectFactory-1157"><span class="linenos">1157</span></a><span class="sd">            iflag (int): Swiss Ephemeris calculation flags (perspective, zodiac, etc.).</span>
</span><span id="AstrologicalSubjectFactory-1158"><a href="#AstrologicalSubjectFactory-1158"><span class="linenos">1158</span></a><span class="sd">            houses_degree_ut (List[float]): House cusp degrees for house determination.</span>
</span><span id="AstrologicalSubjectFactory-1159"><a href="#AstrologicalSubjectFactory-1159"><span class="linenos">1159</span></a><span class="sd">            point_type (PointType): Classification of the point type for the object.</span>
</span><span id="AstrologicalSubjectFactory-1160"><a href="#AstrologicalSubjectFactory-1160"><span class="linenos">1160</span></a><span class="sd">            calculated_planets (List[str]): Running list of successfully calculated objects.</span>
</span><span id="AstrologicalSubjectFactory-1161"><a href="#AstrologicalSubjectFactory-1161"><span class="linenos">1161</span></a><span class="sd">            active_points (List[AstrologicalPoint]): Active points list (modified on error).</span>
</span><span id="AstrologicalSubjectFactory-1162"><a href="#AstrologicalSubjectFactory-1162"><span class="linenos">1162</span></a>
</span><span id="AstrologicalSubjectFactory-1163"><a href="#AstrologicalSubjectFactory-1163"><span class="linenos">1163</span></a><span class="sd">        Side Effects:</span>
</span><span id="AstrologicalSubjectFactory-1164"><a href="#AstrologicalSubjectFactory-1164"><span class="linenos">1164</span></a><span class="sd">            - Adds calculated object to data dictionary using lowercase planet_name as key</span>
</span><span id="AstrologicalSubjectFactory-1165"><a href="#AstrologicalSubjectFactory-1165"><span class="linenos">1165</span></a><span class="sd">            - Appends planet_name to calculated_planets list on success</span>
</span><span id="AstrologicalSubjectFactory-1166"><a href="#AstrologicalSubjectFactory-1166"><span class="linenos">1166</span></a><span class="sd">            - Removes planet_name from active_points list on calculation failure</span>
</span><span id="AstrologicalSubjectFactory-1167"><a href="#AstrologicalSubjectFactory-1167"><span class="linenos">1167</span></a><span class="sd">            - Logs error messages for calculation failures</span>
</span><span id="AstrologicalSubjectFactory-1168"><a href="#AstrologicalSubjectFactory-1168"><span class="linenos">1168</span></a>
</span><span id="AstrologicalSubjectFactory-1169"><a href="#AstrologicalSubjectFactory-1169"><span class="linenos">1169</span></a><span class="sd">        Calculated Properties:</span>
</span><span id="AstrologicalSubjectFactory-1170"><a href="#AstrologicalSubjectFactory-1170"><span class="linenos">1170</span></a><span class="sd">            - Zodiacal position (longitude) in degrees</span>
</span><span id="AstrologicalSubjectFactory-1171"><a href="#AstrologicalSubjectFactory-1171"><span class="linenos">1171</span></a><span class="sd">            - House position based on house cusp positions</span>
</span><span id="AstrologicalSubjectFactory-1172"><a href="#AstrologicalSubjectFactory-1172"><span class="linenos">1172</span></a><span class="sd">            - Retrograde status based on velocity (negative = retrograde)</span>
</span><span id="AstrologicalSubjectFactory-1173"><a href="#AstrologicalSubjectFactory-1173"><span class="linenos">1173</span></a><span class="sd">            - Sign, degree, and minute components</span>
</span><span id="AstrologicalSubjectFactory-1174"><a href="#AstrologicalSubjectFactory-1174"><span class="linenos">1174</span></a>
</span><span id="AstrologicalSubjectFactory-1175"><a href="#AstrologicalSubjectFactory-1175"><span class="linenos">1175</span></a><span class="sd">        Error Handling:</span>
</span><span id="AstrologicalSubjectFactory-1176"><a href="#AstrologicalSubjectFactory-1176"><span class="linenos">1176</span></a><span class="sd">            If Swiss Ephemeris calculation fails (e.g., for distant asteroids outside</span>
</span><span id="AstrologicalSubjectFactory-1177"><a href="#AstrologicalSubjectFactory-1177"><span class="linenos">1177</span></a><span class="sd">            ephemeris range), the method logs the error and removes the object from</span>
</span><span id="AstrologicalSubjectFactory-1178"><a href="#AstrologicalSubjectFactory-1178"><span class="linenos">1178</span></a><span class="sd">            active_points to prevent cascade failures.</span>
</span><span id="AstrologicalSubjectFactory-1179"><a href="#AstrologicalSubjectFactory-1179"><span class="linenos">1179</span></a>
</span><span id="AstrologicalSubjectFactory-1180"><a href="#AstrologicalSubjectFactory-1180"><span class="linenos">1180</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-1181"><a href="#AstrologicalSubjectFactory-1181"><span class="linenos">1181</span></a><span class="sd">            The method uses the Swiss Ephemeris calc_ut function which returns position</span>
</span><span id="AstrologicalSubjectFactory-1182"><a href="#AstrologicalSubjectFactory-1182"><span class="linenos">1182</span></a><span class="sd">            and velocity data. Retrograde determination is based on the velocity</span>
</span><span id="AstrologicalSubjectFactory-1183"><a href="#AstrologicalSubjectFactory-1183"><span class="linenos">1183</span></a><span class="sd">            component being negative (element index 3).</span>
</span><span id="AstrologicalSubjectFactory-1184"><a href="#AstrologicalSubjectFactory-1184"><span class="linenos">1184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1185"><a href="#AstrologicalSubjectFactory-1185"><span class="linenos">1185</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1186"><a href="#AstrologicalSubjectFactory-1186"><span class="linenos">1186</span></a>            <span class="c1"># Calculate planet position using Swiss Ephemeris (ecliptic coordinates)</span>
</span><span id="AstrologicalSubjectFactory-1187"><a href="#AstrologicalSubjectFactory-1187"><span class="linenos">1187</span></a>            <span class="n">planet_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="n">planet_id</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1188"><a href="#AstrologicalSubjectFactory-1188"><span class="linenos">1188</span></a>
</span><span id="AstrologicalSubjectFactory-1189"><a href="#AstrologicalSubjectFactory-1189"><span class="linenos">1189</span></a>            <span class="c1"># Get declination from equatorial coordinates</span>
</span><span id="AstrologicalSubjectFactory-1190"><a href="#AstrologicalSubjectFactory-1190"><span class="linenos">1190</span></a>            <span class="n">planet_eq</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="n">planet_id</span><span class="p">,</span> <span class="n">iflag</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">FLG_EQUATORIAL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1191"><a href="#AstrologicalSubjectFactory-1191"><span class="linenos">1191</span></a>            <span class="n">declination</span> <span class="o">=</span> <span class="n">planet_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Declination from equatorial coordinates</span>
</span><span id="AstrologicalSubjectFactory-1192"><a href="#AstrologicalSubjectFactory-1192"><span class="linenos">1192</span></a>
</span><span id="AstrologicalSubjectFactory-1193"><a href="#AstrologicalSubjectFactory-1193"><span class="linenos">1193</span></a>            <span class="c1"># Create Kerykeion point from degree</span>
</span><span id="AstrologicalSubjectFactory-1194"><a href="#AstrologicalSubjectFactory-1194"><span class="linenos">1194</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">planet_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1195"><a href="#AstrologicalSubjectFactory-1195"><span class="linenos">1195</span></a>                <span class="n">planet_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">planet_name</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">planet_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">declination</span>
</span><span id="AstrologicalSubjectFactory-1196"><a href="#AstrologicalSubjectFactory-1196"><span class="linenos">1196</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1197"><a href="#AstrologicalSubjectFactory-1197"><span class="linenos">1197</span></a>
</span><span id="AstrologicalSubjectFactory-1198"><a href="#AstrologicalSubjectFactory-1198"><span class="linenos">1198</span></a>            <span class="c1"># Calculate house position</span>
</span><span id="AstrologicalSubjectFactory-1199"><a href="#AstrologicalSubjectFactory-1199"><span class="linenos">1199</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">planet_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">planet_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1200"><a href="#AstrologicalSubjectFactory-1200"><span class="linenos">1200</span></a>
</span><span id="AstrologicalSubjectFactory-1201"><a href="#AstrologicalSubjectFactory-1201"><span class="linenos">1201</span></a>            <span class="c1"># Determine if planet is retrograde</span>
</span><span id="AstrologicalSubjectFactory-1202"><a href="#AstrologicalSubjectFactory-1202"><span class="linenos">1202</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">planet_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">planet_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1203"><a href="#AstrologicalSubjectFactory-1203"><span class="linenos">1203</span></a>
</span><span id="AstrologicalSubjectFactory-1204"><a href="#AstrologicalSubjectFactory-1204"><span class="linenos">1204</span></a>            <span class="c1"># Track calculated planet</span>
</span><span id="AstrologicalSubjectFactory-1205"><a href="#AstrologicalSubjectFactory-1205"><span class="linenos">1205</span></a>            <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">planet_name</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1206"><a href="#AstrologicalSubjectFactory-1206"><span class="linenos">1206</span></a>
</span><span id="AstrologicalSubjectFactory-1207"><a href="#AstrologicalSubjectFactory-1207"><span class="linenos">1207</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1208"><a href="#AstrologicalSubjectFactory-1208"><span class="linenos">1208</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating </span><span class="si">{</span><span class="n">planet_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1209"><a href="#AstrologicalSubjectFactory-1209"><span class="linenos">1209</span></a>            <span class="k">if</span> <span class="n">planet_name</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1210"><a href="#AstrologicalSubjectFactory-1210"><span class="linenos">1210</span></a>                <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">planet_name</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1211"><a href="#AstrologicalSubjectFactory-1211"><span class="linenos">1211</span></a>
</span><span id="AstrologicalSubjectFactory-1212"><a href="#AstrologicalSubjectFactory-1212"><span class="linenos">1212</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AstrologicalSubjectFactory-1213"><a href="#AstrologicalSubjectFactory-1213"><span class="linenos">1213</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_planets</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span> <span class="n">calculated_axial_cusps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1214"><a href="#AstrologicalSubjectFactory-1214"><span class="linenos">1214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1215"><a href="#AstrologicalSubjectFactory-1215"><span class="linenos">1215</span></a><span class="sd">        Calculate positions for all requested celestial bodies and special points.</span>
</span><span id="AstrologicalSubjectFactory-1216"><a href="#AstrologicalSubjectFactory-1216"><span class="linenos">1216</span></a>
</span><span id="AstrologicalSubjectFactory-1217"><a href="#AstrologicalSubjectFactory-1217"><span class="linenos">1217</span></a><span class="sd">        This comprehensive method calculates positions for a wide range of astrological</span>
</span><span id="AstrologicalSubjectFactory-1218"><a href="#AstrologicalSubjectFactory-1218"><span class="linenos">1218</span></a><span class="sd">        points including traditional planets, lunar nodes, asteroids, trans-Neptunian</span>
</span><span id="AstrologicalSubjectFactory-1219"><a href="#AstrologicalSubjectFactory-1219"><span class="linenos">1219</span></a><span class="sd">        objects, fixed stars, Arabic parts, and specialized points like Vertex.</span>
</span><span id="AstrologicalSubjectFactory-1220"><a href="#AstrologicalSubjectFactory-1220"><span class="linenos">1220</span></a>
</span><span id="AstrologicalSubjectFactory-1221"><a href="#AstrologicalSubjectFactory-1221"><span class="linenos">1221</span></a><span class="sd">        The calculation is performed selectively based on the active_points list for</span>
</span><span id="AstrologicalSubjectFactory-1222"><a href="#AstrologicalSubjectFactory-1222"><span class="linenos">1222</span></a><span class="sd">        performance optimization. Some Arabic parts automatically activate their</span>
</span><span id="AstrologicalSubjectFactory-1223"><a href="#AstrologicalSubjectFactory-1223"><span class="linenos">1223</span></a><span class="sd">        prerequisite points if needed.</span>
</span><span id="AstrologicalSubjectFactory-1224"><a href="#AstrologicalSubjectFactory-1224"><span class="linenos">1224</span></a>
</span><span id="AstrologicalSubjectFactory-1225"><a href="#AstrologicalSubjectFactory-1225"><span class="linenos">1225</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-1226"><a href="#AstrologicalSubjectFactory-1226"><span class="linenos">1226</span></a><span class="sd">            data (Dict[str, Any]): Main calculation data dictionary. Updated with all</span>
</span><span id="AstrologicalSubjectFactory-1227"><a href="#AstrologicalSubjectFactory-1227"><span class="linenos">1227</span></a><span class="sd">                calculated planetary positions and related metadata.</span>
</span><span id="AstrologicalSubjectFactory-1228"><a href="#AstrologicalSubjectFactory-1228"><span class="linenos">1228</span></a><span class="sd">            active_points (List[AstrologicalPoint]): Mutable list of points to calculate.</span>
</span><span id="AstrologicalSubjectFactory-1229"><a href="#AstrologicalSubjectFactory-1229"><span class="linenos">1229</span></a><span class="sd">                Modified during execution to remove failed calculations and add</span>
</span><span id="AstrologicalSubjectFactory-1230"><a href="#AstrologicalSubjectFactory-1230"><span class="linenos">1230</span></a><span class="sd">                automatically required points for Arabic parts.</span>
</span><span id="AstrologicalSubjectFactory-1231"><a href="#AstrologicalSubjectFactory-1231"><span class="linenos">1231</span></a>
</span><span id="AstrologicalSubjectFactory-1232"><a href="#AstrologicalSubjectFactory-1232"><span class="linenos">1232</span></a><span class="sd">        Celestial Bodies Calculated:</span>
</span><span id="AstrologicalSubjectFactory-1233"><a href="#AstrologicalSubjectFactory-1233"><span class="linenos">1233</span></a><span class="sd">            Traditional Planets:</span>
</span><span id="AstrologicalSubjectFactory-1234"><a href="#AstrologicalSubjectFactory-1234"><span class="linenos">1234</span></a><span class="sd">                - Sun, Moon, Mercury, Venus, Mars, Jupiter, Saturn</span>
</span><span id="AstrologicalSubjectFactory-1235"><a href="#AstrologicalSubjectFactory-1235"><span class="linenos">1235</span></a><span class="sd">                - Uranus, Neptune, Pluto</span>
</span><span id="AstrologicalSubjectFactory-1236"><a href="#AstrologicalSubjectFactory-1236"><span class="linenos">1236</span></a>
</span><span id="AstrologicalSubjectFactory-1237"><a href="#AstrologicalSubjectFactory-1237"><span class="linenos">1237</span></a><span class="sd">            Lunar Nodes:</span>
</span><span id="AstrologicalSubjectFactory-1238"><a href="#AstrologicalSubjectFactory-1238"><span class="linenos">1238</span></a><span class="sd">                - Mean Node, True Node (North nodes)</span>
</span><span id="AstrologicalSubjectFactory-1239"><a href="#AstrologicalSubjectFactory-1239"><span class="linenos">1239</span></a><span class="sd">                - Mean South Node, True South Node (calculated as opposites)</span>
</span><span id="AstrologicalSubjectFactory-1240"><a href="#AstrologicalSubjectFactory-1240"><span class="linenos">1240</span></a>
</span><span id="AstrologicalSubjectFactory-1241"><a href="#AstrologicalSubjectFactory-1241"><span class="linenos">1241</span></a><span class="sd">            Lilith Points:</span>
</span><span id="AstrologicalSubjectFactory-1242"><a href="#AstrologicalSubjectFactory-1242"><span class="linenos">1242</span></a><span class="sd">                - Mean Lilith (Mean Black Moon Lilith)</span>
</span><span id="AstrologicalSubjectFactory-1243"><a href="#AstrologicalSubjectFactory-1243"><span class="linenos">1243</span></a><span class="sd">                - True Lilith (Osculating Black Moon Lilith)</span>
</span><span id="AstrologicalSubjectFactory-1244"><a href="#AstrologicalSubjectFactory-1244"><span class="linenos">1244</span></a>
</span><span id="AstrologicalSubjectFactory-1245"><a href="#AstrologicalSubjectFactory-1245"><span class="linenos">1245</span></a><span class="sd">            Asteroids:</span>
</span><span id="AstrologicalSubjectFactory-1246"><a href="#AstrologicalSubjectFactory-1246"><span class="linenos">1246</span></a><span class="sd">                - Ceres, Pallas, Juno, Vesta (main belt asteroids)</span>
</span><span id="AstrologicalSubjectFactory-1247"><a href="#AstrologicalSubjectFactory-1247"><span class="linenos">1247</span></a>
</span><span id="AstrologicalSubjectFactory-1248"><a href="#AstrologicalSubjectFactory-1248"><span class="linenos">1248</span></a><span class="sd">            Centaurs:</span>
</span><span id="AstrologicalSubjectFactory-1249"><a href="#AstrologicalSubjectFactory-1249"><span class="linenos">1249</span></a><span class="sd">                - Chiron, Pholus</span>
</span><span id="AstrologicalSubjectFactory-1250"><a href="#AstrologicalSubjectFactory-1250"><span class="linenos">1250</span></a>
</span><span id="AstrologicalSubjectFactory-1251"><a href="#AstrologicalSubjectFactory-1251"><span class="linenos">1251</span></a><span class="sd">            Trans-Neptunian Objects:</span>
</span><span id="AstrologicalSubjectFactory-1252"><a href="#AstrologicalSubjectFactory-1252"><span class="linenos">1252</span></a><span class="sd">                - Eris, Sedna, Haumea, Makemake</span>
</span><span id="AstrologicalSubjectFactory-1253"><a href="#AstrologicalSubjectFactory-1253"><span class="linenos">1253</span></a><span class="sd">                - Ixion, Orcus, Quaoar</span>
</span><span id="AstrologicalSubjectFactory-1254"><a href="#AstrologicalSubjectFactory-1254"><span class="linenos">1254</span></a>
</span><span id="AstrologicalSubjectFactory-1255"><a href="#AstrologicalSubjectFactory-1255"><span class="linenos">1255</span></a><span class="sd">            Fixed Stars:</span>
</span><span id="AstrologicalSubjectFactory-1256"><a href="#AstrologicalSubjectFactory-1256"><span class="linenos">1256</span></a><span class="sd">                - Regulus, Spica (examples, extensible)</span>
</span><span id="AstrologicalSubjectFactory-1257"><a href="#AstrologicalSubjectFactory-1257"><span class="linenos">1257</span></a>
</span><span id="AstrologicalSubjectFactory-1258"><a href="#AstrologicalSubjectFactory-1258"><span class="linenos">1258</span></a><span class="sd">            Arabic Parts (Lots):</span>
</span><span id="AstrologicalSubjectFactory-1259"><a href="#AstrologicalSubjectFactory-1259"><span class="linenos">1259</span></a><span class="sd">                - Pars Fortunae (Part of Fortune)</span>
</span><span id="AstrologicalSubjectFactory-1260"><a href="#AstrologicalSubjectFactory-1260"><span class="linenos">1260</span></a><span class="sd">                - Pars Spiritus (Part of Spirit)</span>
</span><span id="AstrologicalSubjectFactory-1261"><a href="#AstrologicalSubjectFactory-1261"><span class="linenos">1261</span></a><span class="sd">                - Pars Amoris (Part of Love/Eros)</span>
</span><span id="AstrologicalSubjectFactory-1262"><a href="#AstrologicalSubjectFactory-1262"><span class="linenos">1262</span></a><span class="sd">                - Pars Fidei (Part of Faith)</span>
</span><span id="AstrologicalSubjectFactory-1263"><a href="#AstrologicalSubjectFactory-1263"><span class="linenos">1263</span></a>
</span><span id="AstrologicalSubjectFactory-1264"><a href="#AstrologicalSubjectFactory-1264"><span class="linenos">1264</span></a><span class="sd">            Special Points:</span>
</span><span id="AstrologicalSubjectFactory-1265"><a href="#AstrologicalSubjectFactory-1265"><span class="linenos">1265</span></a><span class="sd">                - Earth (for heliocentric perspectives)</span>
</span><span id="AstrologicalSubjectFactory-1266"><a href="#AstrologicalSubjectFactory-1266"><span class="linenos">1266</span></a><span class="sd">                - Vertex and Anti-Vertex</span>
</span><span id="AstrologicalSubjectFactory-1267"><a href="#AstrologicalSubjectFactory-1267"><span class="linenos">1267</span></a>
</span><span id="AstrologicalSubjectFactory-1268"><a href="#AstrologicalSubjectFactory-1268"><span class="linenos">1268</span></a><span class="sd">        Side Effects:</span>
</span><span id="AstrologicalSubjectFactory-1269"><a href="#AstrologicalSubjectFactory-1269"><span class="linenos">1269</span></a><span class="sd">            - Updates data dictionary with all calculated positions</span>
</span><span id="AstrologicalSubjectFactory-1270"><a href="#AstrologicalSubjectFactory-1270"><span class="linenos">1270</span></a><span class="sd">            - Modifies active_points list by removing failed calculations</span>
</span><span id="AstrologicalSubjectFactory-1271"><a href="#AstrologicalSubjectFactory-1271"><span class="linenos">1271</span></a><span class="sd">            - Adds prerequisite points for Arabic parts calculations</span>
</span><span id="AstrologicalSubjectFactory-1272"><a href="#AstrologicalSubjectFactory-1272"><span class="linenos">1272</span></a><span class="sd">            - Updates data[&quot;active_points&quot;] with successfully calculated objects</span>
</span><span id="AstrologicalSubjectFactory-1273"><a href="#AstrologicalSubjectFactory-1273"><span class="linenos">1273</span></a>
</span><span id="AstrologicalSubjectFactory-1274"><a href="#AstrologicalSubjectFactory-1274"><span class="linenos">1274</span></a><span class="sd">        Error Handling:</span>
</span><span id="AstrologicalSubjectFactory-1275"><a href="#AstrologicalSubjectFactory-1275"><span class="linenos">1275</span></a><span class="sd">            Individual calculation failures (e.g., asteroids outside ephemeris range)</span>
</span><span id="AstrologicalSubjectFactory-1276"><a href="#AstrologicalSubjectFactory-1276"><span class="linenos">1276</span></a><span class="sd">            are handled gracefully with logging and removal from active_points.</span>
</span><span id="AstrologicalSubjectFactory-1277"><a href="#AstrologicalSubjectFactory-1277"><span class="linenos">1277</span></a><span class="sd">            This prevents cascade failures while maintaining calculation integrity.</span>
</span><span id="AstrologicalSubjectFactory-1278"><a href="#AstrologicalSubjectFactory-1278"><span class="linenos">1278</span></a>
</span><span id="AstrologicalSubjectFactory-1279"><a href="#AstrologicalSubjectFactory-1279"><span class="linenos">1279</span></a><span class="sd">        Arabic Parts Logic:</span>
</span><span id="AstrologicalSubjectFactory-1280"><a href="#AstrologicalSubjectFactory-1280"><span class="linenos">1280</span></a><span class="sd">            - Day/night birth detection based on Sun&#39;s house position</span>
</span><span id="AstrologicalSubjectFactory-1281"><a href="#AstrologicalSubjectFactory-1281"><span class="linenos">1281</span></a><span class="sd">            - Automatic activation of required base points (Sun, Moon, Ascendant, etc.)</span>
</span><span id="AstrologicalSubjectFactory-1282"><a href="#AstrologicalSubjectFactory-1282"><span class="linenos">1282</span></a><span class="sd">            - Classical formulae with day/night variations where applicable</span>
</span><span id="AstrologicalSubjectFactory-1283"><a href="#AstrologicalSubjectFactory-1283"><span class="linenos">1283</span></a><span class="sd">            - All parts marked as non-retrograde (conceptual points)</span>
</span><span id="AstrologicalSubjectFactory-1284"><a href="#AstrologicalSubjectFactory-1284"><span class="linenos">1284</span></a>
</span><span id="AstrologicalSubjectFactory-1285"><a href="#AstrologicalSubjectFactory-1285"><span class="linenos">1285</span></a><span class="sd">        Performance Notes:</span>
</span><span id="AstrologicalSubjectFactory-1286"><a href="#AstrologicalSubjectFactory-1286"><span class="linenos">1286</span></a><span class="sd">            - Only points in active_points are calculated (selective computation)</span>
</span><span id="AstrologicalSubjectFactory-1287"><a href="#AstrologicalSubjectFactory-1287"><span class="linenos">1287</span></a><span class="sd">            - Failed calculations are removed to prevent repeated attempts</span>
</span><span id="AstrologicalSubjectFactory-1288"><a href="#AstrologicalSubjectFactory-1288"><span class="linenos">1288</span></a><span class="sd">            - Some expensive calculations (like distant TNOs) may timeout</span>
</span><span id="AstrologicalSubjectFactory-1289"><a href="#AstrologicalSubjectFactory-1289"><span class="linenos">1289</span></a><span class="sd">            - Fixed stars use different calculation methods than planets</span>
</span><span id="AstrologicalSubjectFactory-1290"><a href="#AstrologicalSubjectFactory-1290"><span class="linenos">1290</span></a>
</span><span id="AstrologicalSubjectFactory-1291"><a href="#AstrologicalSubjectFactory-1291"><span class="linenos">1291</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory-1292"><a href="#AstrologicalSubjectFactory-1292"><span class="linenos">1292</span></a><span class="sd">            The method maintains a running list of successfully calculated planets</span>
</span><span id="AstrologicalSubjectFactory-1293"><a href="#AstrologicalSubjectFactory-1293"><span class="linenos">1293</span></a><span class="sd">            and updates the active_points list to reflect actual availability.</span>
</span><span id="AstrologicalSubjectFactory-1294"><a href="#AstrologicalSubjectFactory-1294"><span class="linenos">1294</span></a><span class="sd">            This ensures that dependent calculations and aspects only use valid data.</span>
</span><span id="AstrologicalSubjectFactory-1295"><a href="#AstrologicalSubjectFactory-1295"><span class="linenos">1295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1296"><a href="#AstrologicalSubjectFactory-1296"><span class="linenos">1296</span></a>        <span class="c1"># Skip calculation if point is not in active_points</span>
</span><span id="AstrologicalSubjectFactory-1297"><a href="#AstrologicalSubjectFactory-1297"><span class="linenos">1297</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">should_calculate</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">AstrologicalPoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1298"><a href="#AstrologicalSubjectFactory-1298"><span class="linenos">1298</span></a>            <span class="k">return</span> <span class="ow">not</span> <span class="n">active_points</span> <span class="ow">or</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1299"><a href="#AstrologicalSubjectFactory-1299"><span class="linenos">1299</span></a>
</span><span id="AstrologicalSubjectFactory-1300"><a href="#AstrologicalSubjectFactory-1300"><span class="linenos">1300</span></a>        <span class="n">point_type</span><span class="p">:</span> <span class="n">PointType</span> <span class="o">=</span> <span class="s2">&quot;AstrologicalPoint&quot;</span>
</span><span id="AstrologicalSubjectFactory-1301"><a href="#AstrologicalSubjectFactory-1301"><span class="linenos">1301</span></a>        <span class="n">julian_day</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1302"><a href="#AstrologicalSubjectFactory-1302"><span class="linenos">1302</span></a>        <span class="n">iflag</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_iflag&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1303"><a href="#AstrologicalSubjectFactory-1303"><span class="linenos">1303</span></a>        <span class="n">houses_degree_ut</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_houses_degree_ut&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1304"><a href="#AstrologicalSubjectFactory-1304"><span class="linenos">1304</span></a>
</span><span id="AstrologicalSubjectFactory-1305"><a href="#AstrologicalSubjectFactory-1305"><span class="linenos">1305</span></a>        <span class="c1"># Track which planets are actually calculated</span>
</span><span id="AstrologicalSubjectFactory-1306"><a href="#AstrologicalSubjectFactory-1306"><span class="linenos">1306</span></a>        <span class="n">calculated_planets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AstrologicalSubjectFactory-1307"><a href="#AstrologicalSubjectFactory-1307"><span class="linenos">1307</span></a>
</span><span id="AstrologicalSubjectFactory-1308"><a href="#AstrologicalSubjectFactory-1308"><span class="linenos">1308</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1309"><a href="#AstrologicalSubjectFactory-1309"><span class="linenos">1309</span></a>        <span class="c1"># MAIN PLANETS</span>
</span><span id="AstrologicalSubjectFactory-1310"><a href="#AstrologicalSubjectFactory-1310"><span class="linenos">1310</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1311"><a href="#AstrologicalSubjectFactory-1311"><span class="linenos">1311</span></a>
</span><span id="AstrologicalSubjectFactory-1312"><a href="#AstrologicalSubjectFactory-1312"><span class="linenos">1312</span></a>        <span class="c1"># Calculate Sun</span>
</span><span id="AstrologicalSubjectFactory-1313"><a href="#AstrologicalSubjectFactory-1313"><span class="linenos">1313</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Sun&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1314"><a href="#AstrologicalSubjectFactory-1314"><span class="linenos">1314</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1315"><a href="#AstrologicalSubjectFactory-1315"><span class="linenos">1315</span></a>
</span><span id="AstrologicalSubjectFactory-1316"><a href="#AstrologicalSubjectFactory-1316"><span class="linenos">1316</span></a>        <span class="c1"># Calculate Moon</span>
</span><span id="AstrologicalSubjectFactory-1317"><a href="#AstrologicalSubjectFactory-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Moon&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1318"><a href="#AstrologicalSubjectFactory-1318"><span class="linenos">1318</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1319"><a href="#AstrologicalSubjectFactory-1319"><span class="linenos">1319</span></a>
</span><span id="AstrologicalSubjectFactory-1320"><a href="#AstrologicalSubjectFactory-1320"><span class="linenos">1320</span></a>        <span class="c1"># Calculate Mercury</span>
</span><span id="AstrologicalSubjectFactory-1321"><a href="#AstrologicalSubjectFactory-1321"><span class="linenos">1321</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Mercury&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1322"><a href="#AstrologicalSubjectFactory-1322"><span class="linenos">1322</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Mercury&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1323"><a href="#AstrologicalSubjectFactory-1323"><span class="linenos">1323</span></a>
</span><span id="AstrologicalSubjectFactory-1324"><a href="#AstrologicalSubjectFactory-1324"><span class="linenos">1324</span></a>        <span class="c1"># Calculate Venus</span>
</span><span id="AstrologicalSubjectFactory-1325"><a href="#AstrologicalSubjectFactory-1325"><span class="linenos">1325</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Venus&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1326"><a href="#AstrologicalSubjectFactory-1326"><span class="linenos">1326</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Venus&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1327"><a href="#AstrologicalSubjectFactory-1327"><span class="linenos">1327</span></a>
</span><span id="AstrologicalSubjectFactory-1328"><a href="#AstrologicalSubjectFactory-1328"><span class="linenos">1328</span></a>        <span class="c1"># Calculate Mars</span>
</span><span id="AstrologicalSubjectFactory-1329"><a href="#AstrologicalSubjectFactory-1329"><span class="linenos">1329</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Mars&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1330"><a href="#AstrologicalSubjectFactory-1330"><span class="linenos">1330</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Mars&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1331"><a href="#AstrologicalSubjectFactory-1331"><span class="linenos">1331</span></a>
</span><span id="AstrologicalSubjectFactory-1332"><a href="#AstrologicalSubjectFactory-1332"><span class="linenos">1332</span></a>        <span class="c1"># Calculate Jupiter</span>
</span><span id="AstrologicalSubjectFactory-1333"><a href="#AstrologicalSubjectFactory-1333"><span class="linenos">1333</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Jupiter&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1334"><a href="#AstrologicalSubjectFactory-1334"><span class="linenos">1334</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Jupiter&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1335"><a href="#AstrologicalSubjectFactory-1335"><span class="linenos">1335</span></a>
</span><span id="AstrologicalSubjectFactory-1336"><a href="#AstrologicalSubjectFactory-1336"><span class="linenos">1336</span></a>        <span class="c1"># Calculate Saturn</span>
</span><span id="AstrologicalSubjectFactory-1337"><a href="#AstrologicalSubjectFactory-1337"><span class="linenos">1337</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Saturn&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1338"><a href="#AstrologicalSubjectFactory-1338"><span class="linenos">1338</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Saturn&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1339"><a href="#AstrologicalSubjectFactory-1339"><span class="linenos">1339</span></a>
</span><span id="AstrologicalSubjectFactory-1340"><a href="#AstrologicalSubjectFactory-1340"><span class="linenos">1340</span></a>        <span class="c1"># Calculate Uranus</span>
</span><span id="AstrologicalSubjectFactory-1341"><a href="#AstrologicalSubjectFactory-1341"><span class="linenos">1341</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Uranus&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1342"><a href="#AstrologicalSubjectFactory-1342"><span class="linenos">1342</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Uranus&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1343"><a href="#AstrologicalSubjectFactory-1343"><span class="linenos">1343</span></a>
</span><span id="AstrologicalSubjectFactory-1344"><a href="#AstrologicalSubjectFactory-1344"><span class="linenos">1344</span></a>        <span class="c1"># Calculate Neptune</span>
</span><span id="AstrologicalSubjectFactory-1345"><a href="#AstrologicalSubjectFactory-1345"><span class="linenos">1345</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Neptune&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1346"><a href="#AstrologicalSubjectFactory-1346"><span class="linenos">1346</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Neptune&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1347"><a href="#AstrologicalSubjectFactory-1347"><span class="linenos">1347</span></a>
</span><span id="AstrologicalSubjectFactory-1348"><a href="#AstrologicalSubjectFactory-1348"><span class="linenos">1348</span></a>        <span class="c1"># Calculate Pluto</span>
</span><span id="AstrologicalSubjectFactory-1349"><a href="#AstrologicalSubjectFactory-1349"><span class="linenos">1349</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pluto&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1350"><a href="#AstrologicalSubjectFactory-1350"><span class="linenos">1350</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Pluto&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1351"><a href="#AstrologicalSubjectFactory-1351"><span class="linenos">1351</span></a>
</span><span id="AstrologicalSubjectFactory-1352"><a href="#AstrologicalSubjectFactory-1352"><span class="linenos">1352</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1353"><a href="#AstrologicalSubjectFactory-1353"><span class="linenos">1353</span></a>        <span class="c1"># LUNAR NODES</span>
</span><span id="AstrologicalSubjectFactory-1354"><a href="#AstrologicalSubjectFactory-1354"><span class="linenos">1354</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1355"><a href="#AstrologicalSubjectFactory-1355"><span class="linenos">1355</span></a>
</span><span id="AstrologicalSubjectFactory-1356"><a href="#AstrologicalSubjectFactory-1356"><span class="linenos">1356</span></a>        <span class="c1"># Calculate Mean North Lunar Node</span>
</span><span id="AstrologicalSubjectFactory-1357"><a href="#AstrologicalSubjectFactory-1357"><span class="linenos">1357</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Mean_North_Lunar_Node&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1358"><a href="#AstrologicalSubjectFactory-1358"><span class="linenos">1358</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Mean_North_Lunar_Node&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1359"><a href="#AstrologicalSubjectFactory-1359"><span class="linenos">1359</span></a>            <span class="c1"># Get correct declination using equatorial coordinates</span>
</span><span id="AstrologicalSubjectFactory-1360"><a href="#AstrologicalSubjectFactory-1360"><span class="linenos">1360</span></a>            <span class="k">if</span> <span class="s2">&quot;mean_north_lunar_node&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1361"><a href="#AstrologicalSubjectFactory-1361"><span class="linenos">1361</span></a>                <span class="n">mean_north_lunar_node_eq</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">iflag</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">FLG_EQUATORIAL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1362"><a href="#AstrologicalSubjectFactory-1362"><span class="linenos">1362</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">declination</span> <span class="o">=</span> <span class="n">mean_north_lunar_node_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Declination from equatorial coordinates</span>
</span><span id="AstrologicalSubjectFactory-1363"><a href="#AstrologicalSubjectFactory-1363"><span class="linenos">1363</span></a>
</span><span id="AstrologicalSubjectFactory-1364"><a href="#AstrologicalSubjectFactory-1364"><span class="linenos">1364</span></a>        <span class="c1"># Calculate True North Lunar Node</span>
</span><span id="AstrologicalSubjectFactory-1365"><a href="#AstrologicalSubjectFactory-1365"><span class="linenos">1365</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;True_North_Lunar_Node&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1366"><a href="#AstrologicalSubjectFactory-1366"><span class="linenos">1366</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;True_North_Lunar_Node&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1367"><a href="#AstrologicalSubjectFactory-1367"><span class="linenos">1367</span></a>            <span class="c1"># Get correct declination using equatorial coordinates</span>
</span><span id="AstrologicalSubjectFactory-1368"><a href="#AstrologicalSubjectFactory-1368"><span class="linenos">1368</span></a>            <span class="k">if</span> <span class="s2">&quot;true_north_lunar_node&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1369"><a href="#AstrologicalSubjectFactory-1369"><span class="linenos">1369</span></a>                <span class="n">true_north_lunar_node_eq</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">iflag</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">FLG_EQUATORIAL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1370"><a href="#AstrologicalSubjectFactory-1370"><span class="linenos">1370</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">declination</span> <span class="o">=</span> <span class="n">true_north_lunar_node_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Declination from equatorial coordinates</span>
</span><span id="AstrologicalSubjectFactory-1371"><a href="#AstrologicalSubjectFactory-1371"><span class="linenos">1371</span></a>
</span><span id="AstrologicalSubjectFactory-1372"><a href="#AstrologicalSubjectFactory-1372"><span class="linenos">1372</span></a>        <span class="c1"># Calculate Mean South Lunar Node (opposite to Mean North Lunar Node)</span>
</span><span id="AstrologicalSubjectFactory-1373"><a href="#AstrologicalSubjectFactory-1373"><span class="linenos">1373</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Mean_South_Lunar_Node&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;mean_north_lunar_node&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1374"><a href="#AstrologicalSubjectFactory-1374"><span class="linenos">1374</span></a>            <span class="n">mean_south_lunar_node_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1375"><a href="#AstrologicalSubjectFactory-1375"><span class="linenos">1375</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_south_lunar_node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1376"><a href="#AstrologicalSubjectFactory-1376"><span class="linenos">1376</span></a>                <span class="n">mean_south_lunar_node_deg</span><span class="p">,</span> <span class="s2">&quot;Mean_South_Lunar_Node&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1377"><a href="#AstrologicalSubjectFactory-1377"><span class="linenos">1377</span></a>                <span class="n">speed</span><span class="o">=-</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1378"><a href="#AstrologicalSubjectFactory-1378"><span class="linenos">1378</span></a>                <span class="n">declination</span><span class="o">=-</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">declination</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">declination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AstrologicalSubjectFactory-1379"><a href="#AstrologicalSubjectFactory-1379"><span class="linenos">1379</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1380"><a href="#AstrologicalSubjectFactory-1380"><span class="linenos">1380</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_south_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">mean_south_lunar_node_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1381"><a href="#AstrologicalSubjectFactory-1381"><span class="linenos">1381</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_south_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span>
</span><span id="AstrologicalSubjectFactory-1382"><a href="#AstrologicalSubjectFactory-1382"><span class="linenos">1382</span></a>            <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Mean_South_Lunar_Node&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1383"><a href="#AstrologicalSubjectFactory-1383"><span class="linenos">1383</span></a>
</span><span id="AstrologicalSubjectFactory-1384"><a href="#AstrologicalSubjectFactory-1384"><span class="linenos">1384</span></a>        <span class="c1"># Calculate True South Lunar Node (opposite to True North Lunar Node)</span>
</span><span id="AstrologicalSubjectFactory-1385"><a href="#AstrologicalSubjectFactory-1385"><span class="linenos">1385</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;True_South_Lunar_Node&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;true_north_lunar_node&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1386"><a href="#AstrologicalSubjectFactory-1386"><span class="linenos">1386</span></a>            <span class="n">true_south_lunar_node_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1387"><a href="#AstrologicalSubjectFactory-1387"><span class="linenos">1387</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_south_lunar_node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1388"><a href="#AstrologicalSubjectFactory-1388"><span class="linenos">1388</span></a>                <span class="n">true_south_lunar_node_deg</span><span class="p">,</span> <span class="s2">&quot;True_South_Lunar_Node&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1389"><a href="#AstrologicalSubjectFactory-1389"><span class="linenos">1389</span></a>                <span class="n">speed</span><span class="o">=-</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1390"><a href="#AstrologicalSubjectFactory-1390"><span class="linenos">1390</span></a>                <span class="n">declination</span><span class="o">=-</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">declination</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">declination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AstrologicalSubjectFactory-1391"><a href="#AstrologicalSubjectFactory-1391"><span class="linenos">1391</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1392"><a href="#AstrologicalSubjectFactory-1392"><span class="linenos">1392</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_south_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">true_south_lunar_node_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1393"><a href="#AstrologicalSubjectFactory-1393"><span class="linenos">1393</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_south_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;true_north_lunar_node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span>
</span><span id="AstrologicalSubjectFactory-1394"><a href="#AstrologicalSubjectFactory-1394"><span class="linenos">1394</span></a>            <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;True_South_Lunar_Node&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1395"><a href="#AstrologicalSubjectFactory-1395"><span class="linenos">1395</span></a>
</span><span id="AstrologicalSubjectFactory-1396"><a href="#AstrologicalSubjectFactory-1396"><span class="linenos">1396</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1397"><a href="#AstrologicalSubjectFactory-1397"><span class="linenos">1397</span></a>        <span class="c1"># LILITH POINTS</span>
</span><span id="AstrologicalSubjectFactory-1398"><a href="#AstrologicalSubjectFactory-1398"><span class="linenos">1398</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1399"><a href="#AstrologicalSubjectFactory-1399"><span class="linenos">1399</span></a>
</span><span id="AstrologicalSubjectFactory-1400"><a href="#AstrologicalSubjectFactory-1400"><span class="linenos">1400</span></a>        <span class="c1"># Calculate Mean Lilith (Mean Black Moon)</span>
</span><span id="AstrologicalSubjectFactory-1401"><a href="#AstrologicalSubjectFactory-1401"><span class="linenos">1401</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Mean_Lilith&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1402"><a href="#AstrologicalSubjectFactory-1402"><span class="linenos">1402</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1403"><a href="#AstrologicalSubjectFactory-1403"><span class="linenos">1403</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Mean_Lilith&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1404"><a href="#AstrologicalSubjectFactory-1404"><span class="linenos">1404</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1405"><a href="#AstrologicalSubjectFactory-1405"><span class="linenos">1405</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1406"><a href="#AstrologicalSubjectFactory-1406"><span class="linenos">1406</span></a>
</span><span id="AstrologicalSubjectFactory-1407"><a href="#AstrologicalSubjectFactory-1407"><span class="linenos">1407</span></a>        <span class="c1"># Calculate True Lilith (Osculating Black Moon)</span>
</span><span id="AstrologicalSubjectFactory-1408"><a href="#AstrologicalSubjectFactory-1408"><span class="linenos">1408</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;True_Lilith&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1409"><a href="#AstrologicalSubjectFactory-1409"><span class="linenos">1409</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1410"><a href="#AstrologicalSubjectFactory-1410"><span class="linenos">1410</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;True_Lilith&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1411"><a href="#AstrologicalSubjectFactory-1411"><span class="linenos">1411</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1412"><a href="#AstrologicalSubjectFactory-1412"><span class="linenos">1412</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1413"><a href="#AstrologicalSubjectFactory-1413"><span class="linenos">1413</span></a>
</span><span id="AstrologicalSubjectFactory-1414"><a href="#AstrologicalSubjectFactory-1414"><span class="linenos">1414</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1415"><a href="#AstrologicalSubjectFactory-1415"><span class="linenos">1415</span></a>        <span class="c1"># SPECIAL POINTS</span>
</span><span id="AstrologicalSubjectFactory-1416"><a href="#AstrologicalSubjectFactory-1416"><span class="linenos">1416</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1417"><a href="#AstrologicalSubjectFactory-1417"><span class="linenos">1417</span></a>
</span><span id="AstrologicalSubjectFactory-1418"><a href="#AstrologicalSubjectFactory-1418"><span class="linenos">1418</span></a>        <span class="c1"># Calculate Earth - useful for heliocentric charts</span>
</span><span id="AstrologicalSubjectFactory-1419"><a href="#AstrologicalSubjectFactory-1419"><span class="linenos">1419</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Earth&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1420"><a href="#AstrologicalSubjectFactory-1420"><span class="linenos">1420</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1421"><a href="#AstrologicalSubjectFactory-1421"><span class="linenos">1421</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Earth&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1422"><a href="#AstrologicalSubjectFactory-1422"><span class="linenos">1422</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1423"><a href="#AstrologicalSubjectFactory-1423"><span class="linenos">1423</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1424"><a href="#AstrologicalSubjectFactory-1424"><span class="linenos">1424</span></a>
</span><span id="AstrologicalSubjectFactory-1425"><a href="#AstrologicalSubjectFactory-1425"><span class="linenos">1425</span></a>        <span class="c1"># Calculate Chiron</span>
</span><span id="AstrologicalSubjectFactory-1426"><a href="#AstrologicalSubjectFactory-1426"><span class="linenos">1426</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Chiron&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1427"><a href="#AstrologicalSubjectFactory-1427"><span class="linenos">1427</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1428"><a href="#AstrologicalSubjectFactory-1428"><span class="linenos">1428</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Chiron&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1429"><a href="#AstrologicalSubjectFactory-1429"><span class="linenos">1429</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1430"><a href="#AstrologicalSubjectFactory-1430"><span class="linenos">1430</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1431"><a href="#AstrologicalSubjectFactory-1431"><span class="linenos">1431</span></a>
</span><span id="AstrologicalSubjectFactory-1432"><a href="#AstrologicalSubjectFactory-1432"><span class="linenos">1432</span></a>        <span class="c1"># Calculate Pholus</span>
</span><span id="AstrologicalSubjectFactory-1433"><a href="#AstrologicalSubjectFactory-1433"><span class="linenos">1433</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pholus&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1434"><a href="#AstrologicalSubjectFactory-1434"><span class="linenos">1434</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1435"><a href="#AstrologicalSubjectFactory-1435"><span class="linenos">1435</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Pholus&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1436"><a href="#AstrologicalSubjectFactory-1436"><span class="linenos">1436</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1437"><a href="#AstrologicalSubjectFactory-1437"><span class="linenos">1437</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1438"><a href="#AstrologicalSubjectFactory-1438"><span class="linenos">1438</span></a>
</span><span id="AstrologicalSubjectFactory-1439"><a href="#AstrologicalSubjectFactory-1439"><span class="linenos">1439</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1440"><a href="#AstrologicalSubjectFactory-1440"><span class="linenos">1440</span></a>        <span class="c1"># ASTEROIDS</span>
</span><span id="AstrologicalSubjectFactory-1441"><a href="#AstrologicalSubjectFactory-1441"><span class="linenos">1441</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1442"><a href="#AstrologicalSubjectFactory-1442"><span class="linenos">1442</span></a>
</span><span id="AstrologicalSubjectFactory-1443"><a href="#AstrologicalSubjectFactory-1443"><span class="linenos">1443</span></a>        <span class="c1"># Calculate Ceres</span>
</span><span id="AstrologicalSubjectFactory-1444"><a href="#AstrologicalSubjectFactory-1444"><span class="linenos">1444</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Ceres&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1445"><a href="#AstrologicalSubjectFactory-1445"><span class="linenos">1445</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1446"><a href="#AstrologicalSubjectFactory-1446"><span class="linenos">1446</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Ceres&quot;</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1447"><a href="#AstrologicalSubjectFactory-1447"><span class="linenos">1447</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1448"><a href="#AstrologicalSubjectFactory-1448"><span class="linenos">1448</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1449"><a href="#AstrologicalSubjectFactory-1449"><span class="linenos">1449</span></a>
</span><span id="AstrologicalSubjectFactory-1450"><a href="#AstrologicalSubjectFactory-1450"><span class="linenos">1450</span></a>        <span class="c1"># Calculate Pallas</span>
</span><span id="AstrologicalSubjectFactory-1451"><a href="#AstrologicalSubjectFactory-1451"><span class="linenos">1451</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pallas&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1452"><a href="#AstrologicalSubjectFactory-1452"><span class="linenos">1452</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1453"><a href="#AstrologicalSubjectFactory-1453"><span class="linenos">1453</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Pallas&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1454"><a href="#AstrologicalSubjectFactory-1454"><span class="linenos">1454</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1455"><a href="#AstrologicalSubjectFactory-1455"><span class="linenos">1455</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1456"><a href="#AstrologicalSubjectFactory-1456"><span class="linenos">1456</span></a>
</span><span id="AstrologicalSubjectFactory-1457"><a href="#AstrologicalSubjectFactory-1457"><span class="linenos">1457</span></a>        <span class="c1"># Calculate Juno</span>
</span><span id="AstrologicalSubjectFactory-1458"><a href="#AstrologicalSubjectFactory-1458"><span class="linenos">1458</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Juno&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1459"><a href="#AstrologicalSubjectFactory-1459"><span class="linenos">1459</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1460"><a href="#AstrologicalSubjectFactory-1460"><span class="linenos">1460</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Juno&quot;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1461"><a href="#AstrologicalSubjectFactory-1461"><span class="linenos">1461</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1462"><a href="#AstrologicalSubjectFactory-1462"><span class="linenos">1462</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1463"><a href="#AstrologicalSubjectFactory-1463"><span class="linenos">1463</span></a>
</span><span id="AstrologicalSubjectFactory-1464"><a href="#AstrologicalSubjectFactory-1464"><span class="linenos">1464</span></a>        <span class="c1"># Calculate Vesta</span>
</span><span id="AstrologicalSubjectFactory-1465"><a href="#AstrologicalSubjectFactory-1465"><span class="linenos">1465</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Vesta&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1466"><a href="#AstrologicalSubjectFactory-1466"><span class="linenos">1466</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1467"><a href="#AstrologicalSubjectFactory-1467"><span class="linenos">1467</span></a>                <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Vesta&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1468"><a href="#AstrologicalSubjectFactory-1468"><span class="linenos">1468</span></a>                <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1469"><a href="#AstrologicalSubjectFactory-1469"><span class="linenos">1469</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1470"><a href="#AstrologicalSubjectFactory-1470"><span class="linenos">1470</span></a>
</span><span id="AstrologicalSubjectFactory-1471"><a href="#AstrologicalSubjectFactory-1471"><span class="linenos">1471</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1472"><a href="#AstrologicalSubjectFactory-1472"><span class="linenos">1472</span></a>        <span class="c1"># TRANS-NEPTUNIAN OBJECTS</span>
</span><span id="AstrologicalSubjectFactory-1473"><a href="#AstrologicalSubjectFactory-1473"><span class="linenos">1473</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1474"><a href="#AstrologicalSubjectFactory-1474"><span class="linenos">1474</span></a>
</span><span id="AstrologicalSubjectFactory-1475"><a href="#AstrologicalSubjectFactory-1475"><span class="linenos">1475</span></a>        <span class="c1"># For TNOs we compute ecliptic longitude for zodiac placement and</span>
</span><span id="AstrologicalSubjectFactory-1476"><a href="#AstrologicalSubjectFactory-1476"><span class="linenos">1476</span></a>        <span class="c1"># declination from equatorial coordinates, same as other bodies.</span>
</span><span id="AstrologicalSubjectFactory-1477"><a href="#AstrologicalSubjectFactory-1477"><span class="linenos">1477</span></a>
</span><span id="AstrologicalSubjectFactory-1478"><a href="#AstrologicalSubjectFactory-1478"><span class="linenos">1478</span></a>        <span class="c1"># Calculate Eris</span>
</span><span id="AstrologicalSubjectFactory-1479"><a href="#AstrologicalSubjectFactory-1479"><span class="linenos">1479</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Eris&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1480"><a href="#AstrologicalSubjectFactory-1480"><span class="linenos">1480</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1481"><a href="#AstrologicalSubjectFactory-1481"><span class="linenos">1481</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1482"><a href="#AstrologicalSubjectFactory-1482"><span class="linenos">1482</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Eris&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">136199</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1483"><a href="#AstrologicalSubjectFactory-1483"><span class="linenos">1483</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1484"><a href="#AstrologicalSubjectFactory-1484"><span class="linenos">1484</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1485"><a href="#AstrologicalSubjectFactory-1485"><span class="linenos">1485</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1486"><a href="#AstrologicalSubjectFactory-1486"><span class="linenos">1486</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Eris position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1487"><a href="#AstrologicalSubjectFactory-1487"><span class="linenos">1487</span></a>                <span class="k">if</span> <span class="s2">&quot;Eris&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1488"><a href="#AstrologicalSubjectFactory-1488"><span class="linenos">1488</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Eris&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1489"><a href="#AstrologicalSubjectFactory-1489"><span class="linenos">1489</span></a>
</span><span id="AstrologicalSubjectFactory-1490"><a href="#AstrologicalSubjectFactory-1490"><span class="linenos">1490</span></a>        <span class="c1"># Calculate Sedna</span>
</span><span id="AstrologicalSubjectFactory-1491"><a href="#AstrologicalSubjectFactory-1491"><span class="linenos">1491</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Sedna&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1492"><a href="#AstrologicalSubjectFactory-1492"><span class="linenos">1492</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1493"><a href="#AstrologicalSubjectFactory-1493"><span class="linenos">1493</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1494"><a href="#AstrologicalSubjectFactory-1494"><span class="linenos">1494</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Sedna&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">90377</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1495"><a href="#AstrologicalSubjectFactory-1495"><span class="linenos">1495</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1496"><a href="#AstrologicalSubjectFactory-1496"><span class="linenos">1496</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1497"><a href="#AstrologicalSubjectFactory-1497"><span class="linenos">1497</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1498"><a href="#AstrologicalSubjectFactory-1498"><span class="linenos">1498</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Sedna position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1499"><a href="#AstrologicalSubjectFactory-1499"><span class="linenos">1499</span></a>                <span class="k">if</span> <span class="s2">&quot;Sedna&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1500"><a href="#AstrologicalSubjectFactory-1500"><span class="linenos">1500</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Sedna&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1501"><a href="#AstrologicalSubjectFactory-1501"><span class="linenos">1501</span></a>
</span><span id="AstrologicalSubjectFactory-1502"><a href="#AstrologicalSubjectFactory-1502"><span class="linenos">1502</span></a>        <span class="c1"># Calculate Haumea</span>
</span><span id="AstrologicalSubjectFactory-1503"><a href="#AstrologicalSubjectFactory-1503"><span class="linenos">1503</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Haumea&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1504"><a href="#AstrologicalSubjectFactory-1504"><span class="linenos">1504</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1505"><a href="#AstrologicalSubjectFactory-1505"><span class="linenos">1505</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1506"><a href="#AstrologicalSubjectFactory-1506"><span class="linenos">1506</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Haumea&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">136108</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1507"><a href="#AstrologicalSubjectFactory-1507"><span class="linenos">1507</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1508"><a href="#AstrologicalSubjectFactory-1508"><span class="linenos">1508</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1509"><a href="#AstrologicalSubjectFactory-1509"><span class="linenos">1509</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1510"><a href="#AstrologicalSubjectFactory-1510"><span class="linenos">1510</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Haumea position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1511"><a href="#AstrologicalSubjectFactory-1511"><span class="linenos">1511</span></a>                <span class="k">if</span> <span class="s2">&quot;Haumea&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1512"><a href="#AstrologicalSubjectFactory-1512"><span class="linenos">1512</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Haumea&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1513"><a href="#AstrologicalSubjectFactory-1513"><span class="linenos">1513</span></a>
</span><span id="AstrologicalSubjectFactory-1514"><a href="#AstrologicalSubjectFactory-1514"><span class="linenos">1514</span></a>        <span class="c1"># Calculate Makemake</span>
</span><span id="AstrologicalSubjectFactory-1515"><a href="#AstrologicalSubjectFactory-1515"><span class="linenos">1515</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Makemake&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1516"><a href="#AstrologicalSubjectFactory-1516"><span class="linenos">1516</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1517"><a href="#AstrologicalSubjectFactory-1517"><span class="linenos">1517</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1518"><a href="#AstrologicalSubjectFactory-1518"><span class="linenos">1518</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Makemake&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">136472</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1519"><a href="#AstrologicalSubjectFactory-1519"><span class="linenos">1519</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1520"><a href="#AstrologicalSubjectFactory-1520"><span class="linenos">1520</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1521"><a href="#AstrologicalSubjectFactory-1521"><span class="linenos">1521</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1522"><a href="#AstrologicalSubjectFactory-1522"><span class="linenos">1522</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Makemake position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1523"><a href="#AstrologicalSubjectFactory-1523"><span class="linenos">1523</span></a>                <span class="k">if</span> <span class="s2">&quot;Makemake&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1524"><a href="#AstrologicalSubjectFactory-1524"><span class="linenos">1524</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Makemake&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1525"><a href="#AstrologicalSubjectFactory-1525"><span class="linenos">1525</span></a>
</span><span id="AstrologicalSubjectFactory-1526"><a href="#AstrologicalSubjectFactory-1526"><span class="linenos">1526</span></a>        <span class="c1"># Calculate Ixion</span>
</span><span id="AstrologicalSubjectFactory-1527"><a href="#AstrologicalSubjectFactory-1527"><span class="linenos">1527</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Ixion&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1528"><a href="#AstrologicalSubjectFactory-1528"><span class="linenos">1528</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1529"><a href="#AstrologicalSubjectFactory-1529"><span class="linenos">1529</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1530"><a href="#AstrologicalSubjectFactory-1530"><span class="linenos">1530</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Ixion&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">28978</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1531"><a href="#AstrologicalSubjectFactory-1531"><span class="linenos">1531</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1532"><a href="#AstrologicalSubjectFactory-1532"><span class="linenos">1532</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1533"><a href="#AstrologicalSubjectFactory-1533"><span class="linenos">1533</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1534"><a href="#AstrologicalSubjectFactory-1534"><span class="linenos">1534</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Ixion position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1535"><a href="#AstrologicalSubjectFactory-1535"><span class="linenos">1535</span></a>                <span class="k">if</span> <span class="s2">&quot;Ixion&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1536"><a href="#AstrologicalSubjectFactory-1536"><span class="linenos">1536</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Ixion&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1537"><a href="#AstrologicalSubjectFactory-1537"><span class="linenos">1537</span></a>
</span><span id="AstrologicalSubjectFactory-1538"><a href="#AstrologicalSubjectFactory-1538"><span class="linenos">1538</span></a>        <span class="c1"># Calculate Orcus</span>
</span><span id="AstrologicalSubjectFactory-1539"><a href="#AstrologicalSubjectFactory-1539"><span class="linenos">1539</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Orcus&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1540"><a href="#AstrologicalSubjectFactory-1540"><span class="linenos">1540</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1541"><a href="#AstrologicalSubjectFactory-1541"><span class="linenos">1541</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1542"><a href="#AstrologicalSubjectFactory-1542"><span class="linenos">1542</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Orcus&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">90482</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1543"><a href="#AstrologicalSubjectFactory-1543"><span class="linenos">1543</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1544"><a href="#AstrologicalSubjectFactory-1544"><span class="linenos">1544</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1545"><a href="#AstrologicalSubjectFactory-1545"><span class="linenos">1545</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1546"><a href="#AstrologicalSubjectFactory-1546"><span class="linenos">1546</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Orcus position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1547"><a href="#AstrologicalSubjectFactory-1547"><span class="linenos">1547</span></a>                <span class="k">if</span> <span class="s2">&quot;Orcus&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1548"><a href="#AstrologicalSubjectFactory-1548"><span class="linenos">1548</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Orcus&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1549"><a href="#AstrologicalSubjectFactory-1549"><span class="linenos">1549</span></a>
</span><span id="AstrologicalSubjectFactory-1550"><a href="#AstrologicalSubjectFactory-1550"><span class="linenos">1550</span></a>        <span class="c1"># Calculate Quaoar</span>
</span><span id="AstrologicalSubjectFactory-1551"><a href="#AstrologicalSubjectFactory-1551"><span class="linenos">1551</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Quaoar&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1552"><a href="#AstrologicalSubjectFactory-1552"><span class="linenos">1552</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1553"><a href="#AstrologicalSubjectFactory-1553"><span class="linenos">1553</span></a>                <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_single_planet</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1554"><a href="#AstrologicalSubjectFactory-1554"><span class="linenos">1554</span></a>                    <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Quaoar&quot;</span><span class="p">,</span> <span class="n">swe</span><span class="o">.</span><span class="n">AST_OFFSET</span> <span class="o">+</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory-1555"><a href="#AstrologicalSubjectFactory-1555"><span class="linenos">1555</span></a>                    <span class="n">houses_degree_ut</span><span class="p">,</span> <span class="n">point_type</span><span class="p">,</span> <span class="n">calculated_planets</span><span class="p">,</span> <span class="n">active_points</span>
</span><span id="AstrologicalSubjectFactory-1556"><a href="#AstrologicalSubjectFactory-1556"><span class="linenos">1556</span></a>                <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1557"><a href="#AstrologicalSubjectFactory-1557"><span class="linenos">1557</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1558"><a href="#AstrologicalSubjectFactory-1558"><span class="linenos">1558</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Quaoar position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1559"><a href="#AstrologicalSubjectFactory-1559"><span class="linenos">1559</span></a>                <span class="k">if</span> <span class="s2">&quot;Quaoar&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1560"><a href="#AstrologicalSubjectFactory-1560"><span class="linenos">1560</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Quaoar&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1561"><a href="#AstrologicalSubjectFactory-1561"><span class="linenos">1561</span></a>
</span><span id="AstrologicalSubjectFactory-1562"><a href="#AstrologicalSubjectFactory-1562"><span class="linenos">1562</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1563"><a href="#AstrologicalSubjectFactory-1563"><span class="linenos">1563</span></a>        <span class="c1"># FIXED STARS</span>
</span><span id="AstrologicalSubjectFactory-1564"><a href="#AstrologicalSubjectFactory-1564"><span class="linenos">1564</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1565"><a href="#AstrologicalSubjectFactory-1565"><span class="linenos">1565</span></a>
</span><span id="AstrologicalSubjectFactory-1566"><a href="#AstrologicalSubjectFactory-1566"><span class="linenos">1566</span></a>        <span class="c1"># Calculate Regulus (example fixed star)</span>
</span><span id="AstrologicalSubjectFactory-1567"><a href="#AstrologicalSubjectFactory-1567"><span class="linenos">1567</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Regulus&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1568"><a href="#AstrologicalSubjectFactory-1568"><span class="linenos">1568</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1569"><a href="#AstrologicalSubjectFactory-1569"><span class="linenos">1569</span></a>                <span class="n">star_name</span> <span class="o">=</span> <span class="s2">&quot;Regulus&quot;</span>
</span><span id="AstrologicalSubjectFactory-1570"><a href="#AstrologicalSubjectFactory-1570"><span class="linenos">1570</span></a>                <span class="c1"># Ecliptic longitude for zodiac placement</span>
</span><span id="AstrologicalSubjectFactory-1571"><a href="#AstrologicalSubjectFactory-1571"><span class="linenos">1571</span></a>                <span class="n">pos_ecl</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">fixstar_ut</span><span class="p">(</span><span class="n">star_name</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1572"><a href="#AstrologicalSubjectFactory-1572"><span class="linenos">1572</span></a>                <span class="n">regulus_deg</span> <span class="o">=</span> <span class="n">pos_ecl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1573"><a href="#AstrologicalSubjectFactory-1573"><span class="linenos">1573</span></a>                <span class="n">regulus_speed</span> <span class="o">=</span> <span class="n">pos_ecl</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_ecl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.0</span>  <span class="c1"># Fixed stars have very slow speed</span>
</span><span id="AstrologicalSubjectFactory-1574"><a href="#AstrologicalSubjectFactory-1574"><span class="linenos">1574</span></a>                <span class="c1"># Equatorial coordinates for true declination</span>
</span><span id="AstrologicalSubjectFactory-1575"><a href="#AstrologicalSubjectFactory-1575"><span class="linenos">1575</span></a>                <span class="n">pos_eq</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">fixstar_ut</span><span class="p">(</span><span class="n">star_name</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">FLG_EQUATORIAL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1576"><a href="#AstrologicalSubjectFactory-1576"><span class="linenos">1576</span></a>                <span class="n">regulus_dec</span> <span class="o">=</span> <span class="n">pos_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_eq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AstrologicalSubjectFactory-1577"><a href="#AstrologicalSubjectFactory-1577"><span class="linenos">1577</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;regulus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">regulus_deg</span><span class="p">,</span> <span class="s2">&quot;Regulus&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">regulus_speed</span><span class="p">,</span> <span class="n">declination</span><span class="o">=</span><span class="n">regulus_dec</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1578"><a href="#AstrologicalSubjectFactory-1578"><span class="linenos">1578</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;regulus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">regulus_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1579"><a href="#AstrologicalSubjectFactory-1579"><span class="linenos">1579</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;regulus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Fixed stars are never retrograde</span>
</span><span id="AstrologicalSubjectFactory-1580"><a href="#AstrologicalSubjectFactory-1580"><span class="linenos">1580</span></a>                <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Regulus&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1581"><a href="#AstrologicalSubjectFactory-1581"><span class="linenos">1581</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1582"><a href="#AstrologicalSubjectFactory-1582"><span class="linenos">1582</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Regulus position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1583"><a href="#AstrologicalSubjectFactory-1583"><span class="linenos">1583</span></a>                <span class="k">if</span> <span class="s2">&quot;Regulus&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1584"><a href="#AstrologicalSubjectFactory-1584"><span class="linenos">1584</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Regulus&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1585"><a href="#AstrologicalSubjectFactory-1585"><span class="linenos">1585</span></a>
</span><span id="AstrologicalSubjectFactory-1586"><a href="#AstrologicalSubjectFactory-1586"><span class="linenos">1586</span></a>        <span class="c1"># Calculate Spica (example fixed star)</span>
</span><span id="AstrologicalSubjectFactory-1587"><a href="#AstrologicalSubjectFactory-1587"><span class="linenos">1587</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Spica&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1588"><a href="#AstrologicalSubjectFactory-1588"><span class="linenos">1588</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1589"><a href="#AstrologicalSubjectFactory-1589"><span class="linenos">1589</span></a>                <span class="n">star_name</span> <span class="o">=</span> <span class="s2">&quot;Spica&quot;</span>
</span><span id="AstrologicalSubjectFactory-1590"><a href="#AstrologicalSubjectFactory-1590"><span class="linenos">1590</span></a>                <span class="c1"># Ecliptic longitude for zodiac placement</span>
</span><span id="AstrologicalSubjectFactory-1591"><a href="#AstrologicalSubjectFactory-1591"><span class="linenos">1591</span></a>                <span class="n">pos_ecl</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">fixstar_ut</span><span class="p">(</span><span class="n">star_name</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1592"><a href="#AstrologicalSubjectFactory-1592"><span class="linenos">1592</span></a>                <span class="n">spica_deg</span> <span class="o">=</span> <span class="n">pos_ecl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1593"><a href="#AstrologicalSubjectFactory-1593"><span class="linenos">1593</span></a>                <span class="n">spica_speed</span> <span class="o">=</span> <span class="n">pos_ecl</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_ecl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.0</span>  <span class="c1"># Fixed stars have very slow speed</span>
</span><span id="AstrologicalSubjectFactory-1594"><a href="#AstrologicalSubjectFactory-1594"><span class="linenos">1594</span></a>                <span class="c1"># Equatorial coordinates for true declination</span>
</span><span id="AstrologicalSubjectFactory-1595"><a href="#AstrologicalSubjectFactory-1595"><span class="linenos">1595</span></a>                <span class="n">pos_eq</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">fixstar_ut</span><span class="p">(</span><span class="n">star_name</span><span class="p">,</span> <span class="n">julian_day</span><span class="p">,</span> <span class="n">iflag</span> <span class="o">|</span> <span class="n">swe</span><span class="o">.</span><span class="n">FLG_EQUATORIAL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1596"><a href="#AstrologicalSubjectFactory-1596"><span class="linenos">1596</span></a>                <span class="n">spica_dec</span> <span class="o">=</span> <span class="n">pos_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_eq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="AstrologicalSubjectFactory-1597"><a href="#AstrologicalSubjectFactory-1597"><span class="linenos">1597</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spica&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">spica_deg</span><span class="p">,</span> <span class="s2">&quot;Spica&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">spica_speed</span><span class="p">,</span> <span class="n">declination</span><span class="o">=</span><span class="n">spica_dec</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1598"><a href="#AstrologicalSubjectFactory-1598"><span class="linenos">1598</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spica&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">spica_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1599"><a href="#AstrologicalSubjectFactory-1599"><span class="linenos">1599</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;spica&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Fixed stars are never retrograde</span>
</span><span id="AstrologicalSubjectFactory-1600"><a href="#AstrologicalSubjectFactory-1600"><span class="linenos">1600</span></a>                <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Spica&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1601"><a href="#AstrologicalSubjectFactory-1601"><span class="linenos">1601</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1602"><a href="#AstrologicalSubjectFactory-1602"><span class="linenos">1602</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not calculate Spica position: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1603"><a href="#AstrologicalSubjectFactory-1603"><span class="linenos">1603</span></a>                <span class="k">if</span> <span class="s2">&quot;Spica&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1604"><a href="#AstrologicalSubjectFactory-1604"><span class="linenos">1604</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Spica&quot;</span><span class="p">)</span>  <span class="c1"># Remove if not calculated</span>
</span><span id="AstrologicalSubjectFactory-1605"><a href="#AstrologicalSubjectFactory-1605"><span class="linenos">1605</span></a>
</span><span id="AstrologicalSubjectFactory-1606"><a href="#AstrologicalSubjectFactory-1606"><span class="linenos">1606</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1607"><a href="#AstrologicalSubjectFactory-1607"><span class="linenos">1607</span></a>        <span class="c1"># ARABIC PARTS / LOTS</span>
</span><span id="AstrologicalSubjectFactory-1608"><a href="#AstrologicalSubjectFactory-1608"><span class="linenos">1608</span></a>        <span class="c1"># ==================</span>
</span><span id="AstrologicalSubjectFactory-1609"><a href="#AstrologicalSubjectFactory-1609"><span class="linenos">1609</span></a>
</span><span id="AstrologicalSubjectFactory-1610"><a href="#AstrologicalSubjectFactory-1610"><span class="linenos">1610</span></a>        <span class="c1"># Calculate Pars Fortunae (Part of Fortune)</span>
</span><span id="AstrologicalSubjectFactory-1611"><a href="#AstrologicalSubjectFactory-1611"><span class="linenos">1611</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pars_Fortunae&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1612"><a href="#AstrologicalSubjectFactory-1612"><span class="linenos">1612</span></a>            <span class="c1"># Auto-activate required points with notification</span>
</span><span id="AstrologicalSubjectFactory-1613"><a href="#AstrologicalSubjectFactory-1613"><span class="linenos">1613</span></a>            <span class="n">pars_fortunae_required_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;Moon&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1614"><a href="#AstrologicalSubjectFactory-1614"><span class="linenos">1614</span></a>            <span class="n">missing_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">pars_fortunae_required_points</span> <span class="k">if</span> <span class="n">point</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1615"><a href="#AstrologicalSubjectFactory-1615"><span class="linenos">1615</span></a>            <span class="k">if</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1616"><a href="#AstrologicalSubjectFactory-1616"><span class="linenos">1616</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Automatically adding required points for Pars_Fortunae: </span><span class="si">{</span><span class="n">missing_points</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1617"><a href="#AstrologicalSubjectFactory-1617"><span class="linenos">1617</span></a>                <span class="n">active_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span> <span class="n">missing_points</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-1618"><a href="#AstrologicalSubjectFactory-1618"><span class="linenos">1618</span></a>                <span class="c1"># Recalculate the missing points</span>
</span><span id="AstrologicalSubjectFactory-1619"><a href="#AstrologicalSubjectFactory-1619"><span class="linenos">1619</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1620"><a href="#AstrologicalSubjectFactory-1620"><span class="linenos">1620</span></a>                    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Ascendant&quot;</span> <span class="ow">and</span> <span class="s2">&quot;ascendant&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1621"><a href="#AstrologicalSubjectFactory-1621"><span class="linenos">1621</span></a>                        <span class="c1"># Calculate Ascendant from houses data if needed</span>
</span><span id="AstrologicalSubjectFactory-1622"><a href="#AstrologicalSubjectFactory-1622"><span class="linenos">1622</span></a>                        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sidereal&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1623"><a href="#AstrologicalSubjectFactory-1623"><span class="linenos">1623</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1624"><a href="#AstrologicalSubjectFactory-1624"><span class="linenos">1624</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1625"><a href="#AstrologicalSubjectFactory-1625"><span class="linenos">1625</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1626"><a href="#AstrologicalSubjectFactory-1626"><span class="linenos">1626</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1627"><a href="#AstrologicalSubjectFactory-1627"><span class="linenos">1627</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]),</span>
</span><span id="AstrologicalSubjectFactory-1628"><a href="#AstrologicalSubjectFactory-1628"><span class="linenos">1628</span></a>                                <span class="n">flags</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">FLG_SIDEREAL</span>
</span><span id="AstrologicalSubjectFactory-1629"><a href="#AstrologicalSubjectFactory-1629"><span class="linenos">1629</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1630"><a href="#AstrologicalSubjectFactory-1630"><span class="linenos">1630</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1631"><a href="#AstrologicalSubjectFactory-1631"><span class="linenos">1631</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1632"><a href="#AstrologicalSubjectFactory-1632"><span class="linenos">1632</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1633"><a href="#AstrologicalSubjectFactory-1633"><span class="linenos">1633</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1634"><a href="#AstrologicalSubjectFactory-1634"><span class="linenos">1634</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1635"><a href="#AstrologicalSubjectFactory-1635"><span class="linenos">1635</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1636"><a href="#AstrologicalSubjectFactory-1636"><span class="linenos">1636</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1637"><a href="#AstrologicalSubjectFactory-1637"><span class="linenos">1637</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1638"><a href="#AstrologicalSubjectFactory-1638"><span class="linenos">1638</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1639"><a href="#AstrologicalSubjectFactory-1639"><span class="linenos">1639</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1640"><a href="#AstrologicalSubjectFactory-1640"><span class="linenos">1640</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="s2">&quot;sun&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1641"><a href="#AstrologicalSubjectFactory-1641"><span class="linenos">1641</span></a>                        <span class="n">sun_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1642"><a href="#AstrologicalSubjectFactory-1642"><span class="linenos">1642</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1643"><a href="#AstrologicalSubjectFactory-1643"><span class="linenos">1643</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1644"><a href="#AstrologicalSubjectFactory-1644"><span class="linenos">1644</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">sun_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1645"><a href="#AstrologicalSubjectFactory-1645"><span class="linenos">1645</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Moon&quot;</span> <span class="ow">and</span> <span class="s2">&quot;moon&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1646"><a href="#AstrologicalSubjectFactory-1646"><span class="linenos">1646</span></a>                        <span class="n">moon_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1647"><a href="#AstrologicalSubjectFactory-1647"><span class="linenos">1647</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1648"><a href="#AstrologicalSubjectFactory-1648"><span class="linenos">1648</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1649"><a href="#AstrologicalSubjectFactory-1649"><span class="linenos">1649</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">moon_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1650"><a href="#AstrologicalSubjectFactory-1650"><span class="linenos">1650</span></a>
</span><span id="AstrologicalSubjectFactory-1651"><a href="#AstrologicalSubjectFactory-1651"><span class="linenos">1651</span></a>            <span class="c1"># Check if required points are available</span>
</span><span id="AstrologicalSubjectFactory-1652"><a href="#AstrologicalSubjectFactory-1652"><span class="linenos">1652</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;sun&quot;</span><span class="p">,</span> <span class="s2">&quot;moon&quot;</span><span class="p">]):</span>
</span><span id="AstrologicalSubjectFactory-1653"><a href="#AstrologicalSubjectFactory-1653"><span class="linenos">1653</span></a>                <span class="c1"># Different calculation for day and night charts</span>
</span><span id="AstrologicalSubjectFactory-1654"><a href="#AstrologicalSubjectFactory-1654"><span class="linenos">1654</span></a>                <span class="c1"># Day birth (Sun above horizon): ASC + Moon - Sun</span>
</span><span id="AstrologicalSubjectFactory-1655"><a href="#AstrologicalSubjectFactory-1655"><span class="linenos">1655</span></a>                <span class="c1"># Night birth (Sun below horizon): ASC + Sun - Moon</span>
</span><span id="AstrologicalSubjectFactory-1656"><a href="#AstrologicalSubjectFactory-1656"><span class="linenos">1656</span></a>                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1657"><a href="#AstrologicalSubjectFactory-1657"><span class="linenos">1657</span></a>                    <span class="n">is_day_chart</span> <span class="o">=</span> <span class="n">get_house_number</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span>  <span class="c1"># Houses 1-6 are above horizon</span>
</span><span id="AstrologicalSubjectFactory-1658"><a href="#AstrologicalSubjectFactory-1658"><span class="linenos">1658</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1659"><a href="#AstrologicalSubjectFactory-1659"><span class="linenos">1659</span></a>                    <span class="n">is_day_chart</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Default to day chart if house is None</span>
</span><span id="AstrologicalSubjectFactory-1660"><a href="#AstrologicalSubjectFactory-1660"><span class="linenos">1660</span></a>
</span><span id="AstrologicalSubjectFactory-1661"><a href="#AstrologicalSubjectFactory-1661"><span class="linenos">1661</span></a>                <span class="k">if</span> <span class="n">is_day_chart</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1662"><a href="#AstrologicalSubjectFactory-1662"><span class="linenos">1662</span></a>                    <span class="n">fortune_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1663"><a href="#AstrologicalSubjectFactory-1663"><span class="linenos">1663</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1664"><a href="#AstrologicalSubjectFactory-1664"><span class="linenos">1664</span></a>                    <span class="n">fortune_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1665"><a href="#AstrologicalSubjectFactory-1665"><span class="linenos">1665</span></a>
</span><span id="AstrologicalSubjectFactory-1666"><a href="#AstrologicalSubjectFactory-1666"><span class="linenos">1666</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_fortunae&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">fortune_deg</span><span class="p">,</span> <span class="s2">&quot;Pars_Fortunae&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1667"><a href="#AstrologicalSubjectFactory-1667"><span class="linenos">1667</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_fortunae&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">fortune_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1668"><a href="#AstrologicalSubjectFactory-1668"><span class="linenos">1668</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_fortunae&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Parts are never retrograde</span>
</span><span id="AstrologicalSubjectFactory-1669"><a href="#AstrologicalSubjectFactory-1669"><span class="linenos">1669</span></a>                <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Pars_Fortunae&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1670"><a href="#AstrologicalSubjectFactory-1670"><span class="linenos">1670</span></a>
</span><span id="AstrologicalSubjectFactory-1671"><a href="#AstrologicalSubjectFactory-1671"><span class="linenos">1671</span></a>        <span class="c1"># Calculate Pars Spiritus (Part of Spirit)</span>
</span><span id="AstrologicalSubjectFactory-1672"><a href="#AstrologicalSubjectFactory-1672"><span class="linenos">1672</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pars_Spiritus&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1673"><a href="#AstrologicalSubjectFactory-1673"><span class="linenos">1673</span></a>            <span class="c1"># Auto-activate required points with notification</span>
</span><span id="AstrologicalSubjectFactory-1674"><a href="#AstrologicalSubjectFactory-1674"><span class="linenos">1674</span></a>            <span class="n">pars_spiritus_required_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;Moon&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1675"><a href="#AstrologicalSubjectFactory-1675"><span class="linenos">1675</span></a>            <span class="n">missing_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">pars_spiritus_required_points</span> <span class="k">if</span> <span class="n">point</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1676"><a href="#AstrologicalSubjectFactory-1676"><span class="linenos">1676</span></a>            <span class="k">if</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1677"><a href="#AstrologicalSubjectFactory-1677"><span class="linenos">1677</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Automatically adding required points for Pars_Spiritus: </span><span class="si">{</span><span class="n">missing_points</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1678"><a href="#AstrologicalSubjectFactory-1678"><span class="linenos">1678</span></a>                <span class="n">active_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span> <span class="n">missing_points</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-1679"><a href="#AstrologicalSubjectFactory-1679"><span class="linenos">1679</span></a>                <span class="c1"># Recalculate the missing points</span>
</span><span id="AstrologicalSubjectFactory-1680"><a href="#AstrologicalSubjectFactory-1680"><span class="linenos">1680</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1681"><a href="#AstrologicalSubjectFactory-1681"><span class="linenos">1681</span></a>                    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Ascendant&quot;</span> <span class="ow">and</span> <span class="s2">&quot;ascendant&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1682"><a href="#AstrologicalSubjectFactory-1682"><span class="linenos">1682</span></a>                        <span class="c1"># Calculate Ascendant from houses data if needed</span>
</span><span id="AstrologicalSubjectFactory-1683"><a href="#AstrologicalSubjectFactory-1683"><span class="linenos">1683</span></a>                        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sidereal&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1684"><a href="#AstrologicalSubjectFactory-1684"><span class="linenos">1684</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1685"><a href="#AstrologicalSubjectFactory-1685"><span class="linenos">1685</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1686"><a href="#AstrologicalSubjectFactory-1686"><span class="linenos">1686</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1687"><a href="#AstrologicalSubjectFactory-1687"><span class="linenos">1687</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1688"><a href="#AstrologicalSubjectFactory-1688"><span class="linenos">1688</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]),</span>
</span><span id="AstrologicalSubjectFactory-1689"><a href="#AstrologicalSubjectFactory-1689"><span class="linenos">1689</span></a>                                <span class="n">flags</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">FLG_SIDEREAL</span>
</span><span id="AstrologicalSubjectFactory-1690"><a href="#AstrologicalSubjectFactory-1690"><span class="linenos">1690</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1691"><a href="#AstrologicalSubjectFactory-1691"><span class="linenos">1691</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1692"><a href="#AstrologicalSubjectFactory-1692"><span class="linenos">1692</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1693"><a href="#AstrologicalSubjectFactory-1693"><span class="linenos">1693</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1694"><a href="#AstrologicalSubjectFactory-1694"><span class="linenos">1694</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1695"><a href="#AstrologicalSubjectFactory-1695"><span class="linenos">1695</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1696"><a href="#AstrologicalSubjectFactory-1696"><span class="linenos">1696</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1697"><a href="#AstrologicalSubjectFactory-1697"><span class="linenos">1697</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1698"><a href="#AstrologicalSubjectFactory-1698"><span class="linenos">1698</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1699"><a href="#AstrologicalSubjectFactory-1699"><span class="linenos">1699</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1700"><a href="#AstrologicalSubjectFactory-1700"><span class="linenos">1700</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1701"><a href="#AstrologicalSubjectFactory-1701"><span class="linenos">1701</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="s2">&quot;sun&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1702"><a href="#AstrologicalSubjectFactory-1702"><span class="linenos">1702</span></a>                        <span class="n">sun_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1703"><a href="#AstrologicalSubjectFactory-1703"><span class="linenos">1703</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1704"><a href="#AstrologicalSubjectFactory-1704"><span class="linenos">1704</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1705"><a href="#AstrologicalSubjectFactory-1705"><span class="linenos">1705</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">sun_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1706"><a href="#AstrologicalSubjectFactory-1706"><span class="linenos">1706</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Moon&quot;</span> <span class="ow">and</span> <span class="s2">&quot;moon&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1707"><a href="#AstrologicalSubjectFactory-1707"><span class="linenos">1707</span></a>                        <span class="n">moon_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1708"><a href="#AstrologicalSubjectFactory-1708"><span class="linenos">1708</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1709"><a href="#AstrologicalSubjectFactory-1709"><span class="linenos">1709</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">moon_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1710"><a href="#AstrologicalSubjectFactory-1710"><span class="linenos">1710</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">moon_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1711"><a href="#AstrologicalSubjectFactory-1711"><span class="linenos">1711</span></a>
</span><span id="AstrologicalSubjectFactory-1712"><a href="#AstrologicalSubjectFactory-1712"><span class="linenos">1712</span></a>            <span class="c1"># Check if required points are available</span>
</span><span id="AstrologicalSubjectFactory-1713"><a href="#AstrologicalSubjectFactory-1713"><span class="linenos">1713</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;sun&quot;</span><span class="p">,</span> <span class="s2">&quot;moon&quot;</span><span class="p">]):</span>
</span><span id="AstrologicalSubjectFactory-1714"><a href="#AstrologicalSubjectFactory-1714"><span class="linenos">1714</span></a>                <span class="c1"># Day birth: ASC + Sun - Moon</span>
</span><span id="AstrologicalSubjectFactory-1715"><a href="#AstrologicalSubjectFactory-1715"><span class="linenos">1715</span></a>                <span class="c1"># Night birth: ASC + Moon - Sun</span>
</span><span id="AstrologicalSubjectFactory-1716"><a href="#AstrologicalSubjectFactory-1716"><span class="linenos">1716</span></a>                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1717"><a href="#AstrologicalSubjectFactory-1717"><span class="linenos">1717</span></a>                    <span class="n">is_day_chart</span> <span class="o">=</span> <span class="n">get_house_number</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span>
</span><span id="AstrologicalSubjectFactory-1718"><a href="#AstrologicalSubjectFactory-1718"><span class="linenos">1718</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1719"><a href="#AstrologicalSubjectFactory-1719"><span class="linenos">1719</span></a>                    <span class="n">is_day_chart</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Default to day chart if house is None</span>
</span><span id="AstrologicalSubjectFactory-1720"><a href="#AstrologicalSubjectFactory-1720"><span class="linenos">1720</span></a>
</span><span id="AstrologicalSubjectFactory-1721"><a href="#AstrologicalSubjectFactory-1721"><span class="linenos">1721</span></a>                <span class="k">if</span> <span class="n">is_day_chart</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1722"><a href="#AstrologicalSubjectFactory-1722"><span class="linenos">1722</span></a>                    <span class="n">spirit_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1723"><a href="#AstrologicalSubjectFactory-1723"><span class="linenos">1723</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1724"><a href="#AstrologicalSubjectFactory-1724"><span class="linenos">1724</span></a>                    <span class="n">spirit_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1725"><a href="#AstrologicalSubjectFactory-1725"><span class="linenos">1725</span></a>
</span><span id="AstrologicalSubjectFactory-1726"><a href="#AstrologicalSubjectFactory-1726"><span class="linenos">1726</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_spiritus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">spirit_deg</span><span class="p">,</span> <span class="s2">&quot;Pars_Spiritus&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1727"><a href="#AstrologicalSubjectFactory-1727"><span class="linenos">1727</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_spiritus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">spirit_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1728"><a href="#AstrologicalSubjectFactory-1728"><span class="linenos">1728</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_spiritus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1729"><a href="#AstrologicalSubjectFactory-1729"><span class="linenos">1729</span></a>                <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Pars_Spiritus&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1730"><a href="#AstrologicalSubjectFactory-1730"><span class="linenos">1730</span></a>
</span><span id="AstrologicalSubjectFactory-1731"><a href="#AstrologicalSubjectFactory-1731"><span class="linenos">1731</span></a>        <span class="c1"># Calculate Pars Amoris (Part of Eros/Love)</span>
</span><span id="AstrologicalSubjectFactory-1732"><a href="#AstrologicalSubjectFactory-1732"><span class="linenos">1732</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pars_Amoris&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1733"><a href="#AstrologicalSubjectFactory-1733"><span class="linenos">1733</span></a>            <span class="c1"># Auto-activate required points with notification</span>
</span><span id="AstrologicalSubjectFactory-1734"><a href="#AstrologicalSubjectFactory-1734"><span class="linenos">1734</span></a>            <span class="n">pars_amoris_required_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Venus&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1735"><a href="#AstrologicalSubjectFactory-1735"><span class="linenos">1735</span></a>            <span class="n">missing_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">pars_amoris_required_points</span> <span class="k">if</span> <span class="n">point</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1736"><a href="#AstrologicalSubjectFactory-1736"><span class="linenos">1736</span></a>            <span class="k">if</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1737"><a href="#AstrologicalSubjectFactory-1737"><span class="linenos">1737</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Automatically adding required points for Pars_Amoris: </span><span class="si">{</span><span class="n">missing_points</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1738"><a href="#AstrologicalSubjectFactory-1738"><span class="linenos">1738</span></a>                <span class="n">active_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span> <span class="n">missing_points</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-1739"><a href="#AstrologicalSubjectFactory-1739"><span class="linenos">1739</span></a>                <span class="c1"># Recalculate the missing points</span>
</span><span id="AstrologicalSubjectFactory-1740"><a href="#AstrologicalSubjectFactory-1740"><span class="linenos">1740</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1741"><a href="#AstrologicalSubjectFactory-1741"><span class="linenos">1741</span></a>                    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Ascendant&quot;</span> <span class="ow">and</span> <span class="s2">&quot;ascendant&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1742"><a href="#AstrologicalSubjectFactory-1742"><span class="linenos">1742</span></a>                        <span class="c1"># Calculate Ascendant from houses data if needed</span>
</span><span id="AstrologicalSubjectFactory-1743"><a href="#AstrologicalSubjectFactory-1743"><span class="linenos">1743</span></a>                        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sidereal&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1744"><a href="#AstrologicalSubjectFactory-1744"><span class="linenos">1744</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1745"><a href="#AstrologicalSubjectFactory-1745"><span class="linenos">1745</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1746"><a href="#AstrologicalSubjectFactory-1746"><span class="linenos">1746</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1747"><a href="#AstrologicalSubjectFactory-1747"><span class="linenos">1747</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1748"><a href="#AstrologicalSubjectFactory-1748"><span class="linenos">1748</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]),</span>
</span><span id="AstrologicalSubjectFactory-1749"><a href="#AstrologicalSubjectFactory-1749"><span class="linenos">1749</span></a>                                <span class="n">flags</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">FLG_SIDEREAL</span>
</span><span id="AstrologicalSubjectFactory-1750"><a href="#AstrologicalSubjectFactory-1750"><span class="linenos">1750</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1751"><a href="#AstrologicalSubjectFactory-1751"><span class="linenos">1751</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1752"><a href="#AstrologicalSubjectFactory-1752"><span class="linenos">1752</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1753"><a href="#AstrologicalSubjectFactory-1753"><span class="linenos">1753</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1754"><a href="#AstrologicalSubjectFactory-1754"><span class="linenos">1754</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1755"><a href="#AstrologicalSubjectFactory-1755"><span class="linenos">1755</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1756"><a href="#AstrologicalSubjectFactory-1756"><span class="linenos">1756</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1757"><a href="#AstrologicalSubjectFactory-1757"><span class="linenos">1757</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1758"><a href="#AstrologicalSubjectFactory-1758"><span class="linenos">1758</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1759"><a href="#AstrologicalSubjectFactory-1759"><span class="linenos">1759</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1760"><a href="#AstrologicalSubjectFactory-1760"><span class="linenos">1760</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1761"><a href="#AstrologicalSubjectFactory-1761"><span class="linenos">1761</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="s2">&quot;sun&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1762"><a href="#AstrologicalSubjectFactory-1762"><span class="linenos">1762</span></a>                        <span class="n">sun_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1763"><a href="#AstrologicalSubjectFactory-1763"><span class="linenos">1763</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1764"><a href="#AstrologicalSubjectFactory-1764"><span class="linenos">1764</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">sun_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1765"><a href="#AstrologicalSubjectFactory-1765"><span class="linenos">1765</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">sun_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1766"><a href="#AstrologicalSubjectFactory-1766"><span class="linenos">1766</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Venus&quot;</span> <span class="ow">and</span> <span class="s2">&quot;venus&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1767"><a href="#AstrologicalSubjectFactory-1767"><span class="linenos">1767</span></a>                        <span class="n">venus_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1768"><a href="#AstrologicalSubjectFactory-1768"><span class="linenos">1768</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;venus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">venus_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Venus&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">venus_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">venus_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1769"><a href="#AstrologicalSubjectFactory-1769"><span class="linenos">1769</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;venus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">venus_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1770"><a href="#AstrologicalSubjectFactory-1770"><span class="linenos">1770</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;venus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">venus_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1771"><a href="#AstrologicalSubjectFactory-1771"><span class="linenos">1771</span></a>
</span><span id="AstrologicalSubjectFactory-1772"><a href="#AstrologicalSubjectFactory-1772"><span class="linenos">1772</span></a>            <span class="c1"># Check if required points are available</span>
</span><span id="AstrologicalSubjectFactory-1773"><a href="#AstrologicalSubjectFactory-1773"><span class="linenos">1773</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;venus&quot;</span><span class="p">,</span> <span class="s2">&quot;sun&quot;</span><span class="p">]):</span>
</span><span id="AstrologicalSubjectFactory-1774"><a href="#AstrologicalSubjectFactory-1774"><span class="linenos">1774</span></a>                <span class="c1"># ASC + Venus - Sun</span>
</span><span id="AstrologicalSubjectFactory-1775"><a href="#AstrologicalSubjectFactory-1775"><span class="linenos">1775</span></a>                <span class="n">amoris_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;venus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1776"><a href="#AstrologicalSubjectFactory-1776"><span class="linenos">1776</span></a>
</span><span id="AstrologicalSubjectFactory-1777"><a href="#AstrologicalSubjectFactory-1777"><span class="linenos">1777</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_amoris&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">amoris_deg</span><span class="p">,</span> <span class="s2">&quot;Pars_Amoris&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1778"><a href="#AstrologicalSubjectFactory-1778"><span class="linenos">1778</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_amoris&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">amoris_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1779"><a href="#AstrologicalSubjectFactory-1779"><span class="linenos">1779</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_amoris&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1780"><a href="#AstrologicalSubjectFactory-1780"><span class="linenos">1780</span></a>                <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Pars_Amoris&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1781"><a href="#AstrologicalSubjectFactory-1781"><span class="linenos">1781</span></a>
</span><span id="AstrologicalSubjectFactory-1782"><a href="#AstrologicalSubjectFactory-1782"><span class="linenos">1782</span></a>        <span class="c1"># Calculate Pars Fidei (Part of Faith)</span>
</span><span id="AstrologicalSubjectFactory-1783"><a href="#AstrologicalSubjectFactory-1783"><span class="linenos">1783</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Pars_Fidei&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1784"><a href="#AstrologicalSubjectFactory-1784"><span class="linenos">1784</span></a>            <span class="c1"># Auto-activate required points with notification</span>
</span><span id="AstrologicalSubjectFactory-1785"><a href="#AstrologicalSubjectFactory-1785"><span class="linenos">1785</span></a>            <span class="n">pars_fidei_required_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Jupiter&quot;</span><span class="p">,</span> <span class="s2">&quot;Saturn&quot;</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1786"><a href="#AstrologicalSubjectFactory-1786"><span class="linenos">1786</span></a>            <span class="n">missing_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">pars_fidei_required_points</span> <span class="k">if</span> <span class="n">point</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1787"><a href="#AstrologicalSubjectFactory-1787"><span class="linenos">1787</span></a>            <span class="k">if</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1788"><a href="#AstrologicalSubjectFactory-1788"><span class="linenos">1788</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Automatically adding required points for Pars_Fidei: </span><span class="si">{</span><span class="n">missing_points</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1789"><a href="#AstrologicalSubjectFactory-1789"><span class="linenos">1789</span></a>                <span class="n">active_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">],</span> <span class="n">missing_points</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory-1790"><a href="#AstrologicalSubjectFactory-1790"><span class="linenos">1790</span></a>                <span class="c1"># Recalculate the missing points</span>
</span><span id="AstrologicalSubjectFactory-1791"><a href="#AstrologicalSubjectFactory-1791"><span class="linenos">1791</span></a>                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">missing_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1792"><a href="#AstrologicalSubjectFactory-1792"><span class="linenos">1792</span></a>                    <span class="k">if</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Ascendant&quot;</span> <span class="ow">and</span> <span class="s2">&quot;ascendant&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1793"><a href="#AstrologicalSubjectFactory-1793"><span class="linenos">1793</span></a>                        <span class="c1"># Calculate Ascendant from houses data if needed</span>
</span><span id="AstrologicalSubjectFactory-1794"><a href="#AstrologicalSubjectFactory-1794"><span class="linenos">1794</span></a>                        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sidereal&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1795"><a href="#AstrologicalSubjectFactory-1795"><span class="linenos">1795</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1796"><a href="#AstrologicalSubjectFactory-1796"><span class="linenos">1796</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1797"><a href="#AstrologicalSubjectFactory-1797"><span class="linenos">1797</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1798"><a href="#AstrologicalSubjectFactory-1798"><span class="linenos">1798</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1799"><a href="#AstrologicalSubjectFactory-1799"><span class="linenos">1799</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]),</span>
</span><span id="AstrologicalSubjectFactory-1800"><a href="#AstrologicalSubjectFactory-1800"><span class="linenos">1800</span></a>                                <span class="n">flags</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">FLG_SIDEREAL</span>
</span><span id="AstrologicalSubjectFactory-1801"><a href="#AstrologicalSubjectFactory-1801"><span class="linenos">1801</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1802"><a href="#AstrologicalSubjectFactory-1802"><span class="linenos">1802</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1803"><a href="#AstrologicalSubjectFactory-1803"><span class="linenos">1803</span></a>                            <span class="n">cusps</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1804"><a href="#AstrologicalSubjectFactory-1804"><span class="linenos">1804</span></a>                                <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1805"><a href="#AstrologicalSubjectFactory-1805"><span class="linenos">1805</span></a>                                <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1806"><a href="#AstrologicalSubjectFactory-1806"><span class="linenos">1806</span></a>                                <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1807"><a href="#AstrologicalSubjectFactory-1807"><span class="linenos">1807</span></a>                                <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1808"><a href="#AstrologicalSubjectFactory-1808"><span class="linenos">1808</span></a>                            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1809"><a href="#AstrologicalSubjectFactory-1809"><span class="linenos">1809</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1810"><a href="#AstrologicalSubjectFactory-1810"><span class="linenos">1810</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">ascmc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1811"><a href="#AstrologicalSubjectFactory-1811"><span class="linenos">1811</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1812"><a href="#AstrologicalSubjectFactory-1812"><span class="linenos">1812</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Jupiter&quot;</span> <span class="ow">and</span> <span class="s2">&quot;jupiter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1813"><a href="#AstrologicalSubjectFactory-1813"><span class="linenos">1813</span></a>                        <span class="n">jupiter_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1814"><a href="#AstrologicalSubjectFactory-1814"><span class="linenos">1814</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jupiter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">jupiter_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Jupiter&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">jupiter_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">jupiter_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1815"><a href="#AstrologicalSubjectFactory-1815"><span class="linenos">1815</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jupiter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">jupiter_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1816"><a href="#AstrologicalSubjectFactory-1816"><span class="linenos">1816</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jupiter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">jupiter_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1817"><a href="#AstrologicalSubjectFactory-1817"><span class="linenos">1817</span></a>                    <span class="k">elif</span> <span class="n">point</span> <span class="o">==</span> <span class="s2">&quot;Saturn&quot;</span> <span class="ow">and</span> <span class="s2">&quot;saturn&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1818"><a href="#AstrologicalSubjectFactory-1818"><span class="linenos">1818</span></a>                        <span class="n">saturn_calc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">calc_ut</span><span class="p">(</span><span class="n">julian_day</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1819"><a href="#AstrologicalSubjectFactory-1819"><span class="linenos">1819</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;saturn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">saturn_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Saturn&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">saturn_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">declination</span><span class="o">=</span><span class="n">saturn_calc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1820"><a href="#AstrologicalSubjectFactory-1820"><span class="linenos">1820</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;saturn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">saturn_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1821"><a href="#AstrologicalSubjectFactory-1821"><span class="linenos">1821</span></a>                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;saturn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="n">saturn_calc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="AstrologicalSubjectFactory-1822"><a href="#AstrologicalSubjectFactory-1822"><span class="linenos">1822</span></a>
</span><span id="AstrologicalSubjectFactory-1823"><a href="#AstrologicalSubjectFactory-1823"><span class="linenos">1823</span></a>            <span class="c1"># Check if required points are available</span>
</span><span id="AstrologicalSubjectFactory-1824"><a href="#AstrologicalSubjectFactory-1824"><span class="linenos">1824</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;jupiter&quot;</span><span class="p">,</span> <span class="s2">&quot;saturn&quot;</span><span class="p">]):</span>
</span><span id="AstrologicalSubjectFactory-1825"><a href="#AstrologicalSubjectFactory-1825"><span class="linenos">1825</span></a>                <span class="c1"># ASC + Jupiter - Saturn</span>
</span><span id="AstrologicalSubjectFactory-1826"><a href="#AstrologicalSubjectFactory-1826"><span class="linenos">1826</span></a>                <span class="n">fidei_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ascendant&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;jupiter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;saturn&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1827"><a href="#AstrologicalSubjectFactory-1827"><span class="linenos">1827</span></a>
</span><span id="AstrologicalSubjectFactory-1828"><a href="#AstrologicalSubjectFactory-1828"><span class="linenos">1828</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_fidei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">fidei_deg</span><span class="p">,</span> <span class="s2">&quot;Pars_Fidei&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1829"><a href="#AstrologicalSubjectFactory-1829"><span class="linenos">1829</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_fidei&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">fidei_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1830"><a href="#AstrologicalSubjectFactory-1830"><span class="linenos">1830</span></a>                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pars_fidei&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1831"><a href="#AstrologicalSubjectFactory-1831"><span class="linenos">1831</span></a>                <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Pars_Fidei&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1832"><a href="#AstrologicalSubjectFactory-1832"><span class="linenos">1832</span></a>
</span><span id="AstrologicalSubjectFactory-1833"><a href="#AstrologicalSubjectFactory-1833"><span class="linenos">1833</span></a>        <span class="c1"># Calculate Vertex and/or Anti-Vertex</span>
</span><span id="AstrologicalSubjectFactory-1834"><a href="#AstrologicalSubjectFactory-1834"><span class="linenos">1834</span></a>        <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Vertex&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Anti_Vertex&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1835"><a href="#AstrologicalSubjectFactory-1835"><span class="linenos">1835</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1836"><a href="#AstrologicalSubjectFactory-1836"><span class="linenos">1836</span></a>                <span class="c1"># Vertex is at ascmc[3] in Swiss Ephemeris</span>
</span><span id="AstrologicalSubjectFactory-1837"><a href="#AstrologicalSubjectFactory-1837"><span class="linenos">1837</span></a>                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sidereal&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1838"><a href="#AstrologicalSubjectFactory-1838"><span class="linenos">1838</span></a>                    <span class="n">_</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses_ex</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1839"><a href="#AstrologicalSubjectFactory-1839"><span class="linenos">1839</span></a>                        <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1840"><a href="#AstrologicalSubjectFactory-1840"><span class="linenos">1840</span></a>                        <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1841"><a href="#AstrologicalSubjectFactory-1841"><span class="linenos">1841</span></a>                        <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1842"><a href="#AstrologicalSubjectFactory-1842"><span class="linenos">1842</span></a>                        <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">),</span>  <span class="c1"># Vertex works best with Vehlow system</span>
</span><span id="AstrologicalSubjectFactory-1843"><a href="#AstrologicalSubjectFactory-1843"><span class="linenos">1843</span></a>                        <span class="n">flags</span><span class="o">=</span><span class="n">swe</span><span class="o">.</span><span class="n">FLG_SIDEREAL</span>
</span><span id="AstrologicalSubjectFactory-1844"><a href="#AstrologicalSubjectFactory-1844"><span class="linenos">1844</span></a>                    <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1845"><a href="#AstrologicalSubjectFactory-1845"><span class="linenos">1845</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1846"><a href="#AstrologicalSubjectFactory-1846"><span class="linenos">1846</span></a>                    <span class="n">_</span><span class="p">,</span> <span class="n">ascmc</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory-1847"><a href="#AstrologicalSubjectFactory-1847"><span class="linenos">1847</span></a>                        <span class="n">tjdut</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;julian_day&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1848"><a href="#AstrologicalSubjectFactory-1848"><span class="linenos">1848</span></a>                        <span class="n">lat</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1849"><a href="#AstrologicalSubjectFactory-1849"><span class="linenos">1849</span></a>                        <span class="n">lon</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory-1850"><a href="#AstrologicalSubjectFactory-1850"><span class="linenos">1850</span></a>                        <span class="n">hsys</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1851"><a href="#AstrologicalSubjectFactory-1851"><span class="linenos">1851</span></a>                    <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1852"><a href="#AstrologicalSubjectFactory-1852"><span class="linenos">1852</span></a>
</span><span id="AstrologicalSubjectFactory-1853"><a href="#AstrologicalSubjectFactory-1853"><span class="linenos">1853</span></a>                <span class="n">vertex_deg</span> <span class="o">=</span> <span class="n">ascmc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="AstrologicalSubjectFactory-1854"><a href="#AstrologicalSubjectFactory-1854"><span class="linenos">1854</span></a>
</span><span id="AstrologicalSubjectFactory-1855"><a href="#AstrologicalSubjectFactory-1855"><span class="linenos">1855</span></a>                <span class="c1"># Calculate Vertex if requested</span>
</span><span id="AstrologicalSubjectFactory-1856"><a href="#AstrologicalSubjectFactory-1856"><span class="linenos">1856</span></a>                <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Vertex&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1857"><a href="#AstrologicalSubjectFactory-1857"><span class="linenos">1857</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vertex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">vertex_deg</span><span class="p">,</span> <span class="s2">&quot;Vertex&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1858"><a href="#AstrologicalSubjectFactory-1858"><span class="linenos">1858</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vertex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">vertex_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1859"><a href="#AstrologicalSubjectFactory-1859"><span class="linenos">1859</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;vertex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1860"><a href="#AstrologicalSubjectFactory-1860"><span class="linenos">1860</span></a>                    <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Vertex&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1861"><a href="#AstrologicalSubjectFactory-1861"><span class="linenos">1861</span></a>
</span><span id="AstrologicalSubjectFactory-1862"><a href="#AstrologicalSubjectFactory-1862"><span class="linenos">1862</span></a>                <span class="c1"># Calculate Anti-Vertex if requested</span>
</span><span id="AstrologicalSubjectFactory-1863"><a href="#AstrologicalSubjectFactory-1863"><span class="linenos">1863</span></a>                <span class="k">if</span> <span class="n">should_calculate</span><span class="p">(</span><span class="s2">&quot;Anti_Vertex&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory-1864"><a href="#AstrologicalSubjectFactory-1864"><span class="linenos">1864</span></a>                    <span class="n">anti_vertex_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="n">vertex_deg</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1865"><a href="#AstrologicalSubjectFactory-1865"><span class="linenos">1865</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;anti_vertex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">anti_vertex_deg</span><span class="p">,</span> <span class="s2">&quot;Anti_Vertex&quot;</span><span class="p">,</span> <span class="n">point_type</span><span class="o">=</span><span class="n">point_type</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1866"><a href="#AstrologicalSubjectFactory-1866"><span class="linenos">1866</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;anti_vertex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">house</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="n">anti_vertex_deg</span><span class="p">,</span> <span class="n">houses_degree_ut</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1867"><a href="#AstrologicalSubjectFactory-1867"><span class="linenos">1867</span></a>                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;anti_vertex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">retrograde</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory-1868"><a href="#AstrologicalSubjectFactory-1868"><span class="linenos">1868</span></a>                    <span class="n">calculated_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Anti_Vertex&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1869"><a href="#AstrologicalSubjectFactory-1869"><span class="linenos">1869</span></a>
</span><span id="AstrologicalSubjectFactory-1870"><a href="#AstrologicalSubjectFactory-1870"><span class="linenos">1870</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1871"><a href="#AstrologicalSubjectFactory-1871"><span class="linenos">1871</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not calculate Vertex/Anti-Vertex position, error: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1872"><a href="#AstrologicalSubjectFactory-1872"><span class="linenos">1872</span></a>                <span class="k">if</span> <span class="s2">&quot;Vertex&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1873"><a href="#AstrologicalSubjectFactory-1873"><span class="linenos">1873</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Vertex&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1874"><a href="#AstrologicalSubjectFactory-1874"><span class="linenos">1874</span></a>                <span class="k">if</span> <span class="s2">&quot;Anti_Vertex&quot;</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1875"><a href="#AstrologicalSubjectFactory-1875"><span class="linenos">1875</span></a>                    <span class="n">active_points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Anti_Vertex&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1876"><a href="#AstrologicalSubjectFactory-1876"><span class="linenos">1876</span></a>
</span><span id="AstrologicalSubjectFactory-1877"><a href="#AstrologicalSubjectFactory-1877"><span class="linenos">1877</span></a>        <span class="c1"># Store only the planets that were actually calculated</span>
</span><span id="AstrologicalSubjectFactory-1878"><a href="#AstrologicalSubjectFactory-1878"><span class="linenos">1878</span></a>        <span class="n">all_calculated_points</span> <span class="o">=</span> <span class="n">calculated_planets</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory-1879"><a href="#AstrologicalSubjectFactory-1879"><span class="linenos">1879</span></a>        <span class="k">if</span> <span class="n">calculated_axial_cusps</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1880"><a href="#AstrologicalSubjectFactory-1880"><span class="linenos">1880</span></a>            <span class="n">all_calculated_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">calculated_axial_cusps</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory-1881"><a href="#AstrologicalSubjectFactory-1881"><span class="linenos">1881</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;active_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_calculated_points</span>
</span><span id="AstrologicalSubjectFactory-1882"><a href="#AstrologicalSubjectFactory-1882"><span class="linenos">1882</span></a>
</span><span id="AstrologicalSubjectFactory-1883"><a href="#AstrologicalSubjectFactory-1883"><span class="linenos">1883</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AstrologicalSubjectFactory-1884"><a href="#AstrologicalSubjectFactory-1884"><span class="linenos">1884</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_day_of_week</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory-1885"><a href="#AstrologicalSubjectFactory-1885"><span class="linenos">1885</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1886"><a href="#AstrologicalSubjectFactory-1886"><span class="linenos">1886</span></a><span class="sd">        Calculate the day of the week for the given astronomical event.</span>
</span><span id="AstrologicalSubjectFactory-1887"><a href="#AstrologicalSubjectFactory-1887"><span class="linenos">1887</span></a>
</span><span id="AstrologicalSubjectFactory-1888"><a href="#AstrologicalSubjectFactory-1888"><span class="linenos">1888</span></a><span class="sd">        Determines the day of the week corresponding to the local datetime</span>
</span><span id="AstrologicalSubjectFactory-1889"><a href="#AstrologicalSubjectFactory-1889"><span class="linenos">1889</span></a><span class="sd">        using the standard library for consistency.</span>
</span><span id="AstrologicalSubjectFactory-1890"><a href="#AstrologicalSubjectFactory-1890"><span class="linenos">1890</span></a>
</span><span id="AstrologicalSubjectFactory-1891"><a href="#AstrologicalSubjectFactory-1891"><span class="linenos">1891</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory-1892"><a href="#AstrologicalSubjectFactory-1892"><span class="linenos">1892</span></a><span class="sd">            data (Dict[str, Any]): Calculation data dictionary containing</span>
</span><span id="AstrologicalSubjectFactory-1893"><a href="#AstrologicalSubjectFactory-1893"><span class="linenos">1893</span></a><span class="sd">                iso_formatted_local_datetime. Updated with the calculated day_of_week string.</span>
</span><span id="AstrologicalSubjectFactory-1894"><a href="#AstrologicalSubjectFactory-1894"><span class="linenos">1894</span></a>
</span><span id="AstrologicalSubjectFactory-1895"><a href="#AstrologicalSubjectFactory-1895"><span class="linenos">1895</span></a><span class="sd">        Side Effects:</span>
</span><span id="AstrologicalSubjectFactory-1896"><a href="#AstrologicalSubjectFactory-1896"><span class="linenos">1896</span></a><span class="sd">            Updates data dictionary with:</span>
</span><span id="AstrologicalSubjectFactory-1897"><a href="#AstrologicalSubjectFactory-1897"><span class="linenos">1897</span></a><span class="sd">            - day_of_week: Human-readable day name (e.g., &quot;Monday&quot;, &quot;Tuesday&quot;)</span>
</span><span id="AstrologicalSubjectFactory-1898"><a href="#AstrologicalSubjectFactory-1898"><span class="linenos">1898</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory-1899"><a href="#AstrologicalSubjectFactory-1899"><span class="linenos">1899</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;iso_formatted_local_datetime&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory-1900"><a href="#AstrologicalSubjectFactory-1900"><span class="linenos">1900</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Factory class for creating comprehensive astrological subjects.</p>

<p>This factory creates AstrologicalSubjectModel instances with complete astrological
information including planetary positions, house cusps, aspects, lunar phases, and
various specialized astrological points. It provides multiple class methods for
different initialization scenarios and supports both online and offline calculation modes.</p>

<p>The factory handles complex astrological calculations using the Swiss Ephemeris library,
supports multiple coordinate systems and house systems, and can automatically fetch
location data from online sources.</p>

<p>Supported Astrological Points:
    - Traditional Planets: Sun through Pluto
    - Lunar Nodes: Mean and True North/South Nodes
    - Lilith Points: Mean and True Black Moon
    - Asteroids: Ceres, Pallas, Juno, Vesta
    - Centaurs: Chiron, Pholus
    - Trans-Neptunian Objects: Eris, Sedna, Haumea, Makemake, Ixion, Orcus, Quaoar
    - Fixed Stars: Regulus, Spica (extensible)
    - Arabic Parts: Pars Fortunae, Pars Spiritus, Pars Amoris, Pars Fidei
    - Special Points: Vertex, Anti-Vertex, Earth (for heliocentric charts)
    - House Cusps: All 12 houses with configurable house systems
    - Angles: Ascendant, Medium Coeli, Descendant, Imum Coeli</p>

<p>Supported Features:
    - Multiple zodiac systems (Tropical/Sidereal with various ayanamshas)
    - Multiple house systems (Placidus, Koch, Equal, Whole Sign, etc.)
    - Multiple coordinate perspectives (Geocentric, Heliocentric, Topocentric)
    - Automatic timezone and coordinate resolution via GeoNames API
    - Lunar phase calculations
    - Day/night chart detection for Arabic parts
    - Performance optimization through selective point calculation
    - Comprehensive error handling and validation</p>

<p>Class Methods:
    from_birth_data: Create subject from standard birth data (most flexible)
    from_iso_utc_time: Create subject from ISO UTC timestamp
    from_current_time: Create subject for current moment</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="create-natal-chart">Create natal chart</h1>
      
      <p>subject = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
          ...     name="John Doe",
          ...     year=1990, month=6, day=15,
          ...     hour=14, minute=30,
          ...     city="Rome", nation="IT",
          ...     online=True
          ... )
      print(f"Sun: {subject.sun.sign} {subject.sun.abs_pos}")
      print(f"Active points: {len(subject.active_points)}")</p>

<pre><code>&gt;&gt;&gt; # Create chart for current time
&gt;&gt;&gt; now_subject = <a href="#AstrologicalSubjectFactory.from_current_time">AstrologicalSubjectFactory.from_current_time</a>(
...     name="Current Moment",
...     city="London", nation="GB"
... )
</code></pre>
      
      <p>Thread Safety:
          This factory is not thread-safe due to its use of the Swiss Ephemeris library
          which maintains global state. Use separate instances in multi-threaded applications
          or implement appropriate locking mechanisms.</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="AstrologicalSubjectFactory.from_birth_data" class="classattr">
                                        <input id="AstrologicalSubjectFactory.from_birth_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_birth_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Now&#39;</span>,</span><span class="param">	<span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">month</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">day</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">minute</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span> <span class="s1">&#39;Sidereal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tropical&#39;</span>,</span><span class="param">	<span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FAGAN_BRADLEY&#39;</span><span class="p">,</span> <span class="s1">&#39;LAHIRI&#39;</span><span class="p">,</span> <span class="s1">&#39;DELUCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMAN&#39;</span><span class="p">,</span> <span class="s1">&#39;USHASHASHI&#39;</span><span class="p">,</span> <span class="s1">&#39;KRISHNAMURTI&#39;</span><span class="p">,</span> <span class="s1">&#39;DJWHAL_KHUL&#39;</span><span class="p">,</span> <span class="s1">&#39;YUKTESHWAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JN_BHASIN&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER1&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER2&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER3&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_HUBER&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_ETPSC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALDEBARAN_15TAU&#39;</span><span class="p">,</span> <span class="s1">&#39;HIPPARCHOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SASSANIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;J2000&#39;</span><span class="p">,</span> <span class="s1">&#39;J1900&#39;</span><span class="p">,</span> <span class="s1">&#39;B1950&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span>,</span><span class="param">	<span class="n">perspective_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Apparent Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Heliocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Topocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;True Geocentric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Apparent Geocentric&#39;</span>,</span><span class="param">	<span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">is_dst</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">altitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubjectFactory.from_birth_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubjectFactory.from_birth_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubjectFactory.from_birth_data-423"><a href="#AstrologicalSubjectFactory.from_birth_data-423"><span class="linenos">423</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-424"><a href="#AstrologicalSubjectFactory.from_birth_data-424"><span class="linenos">424</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-425"><a href="#AstrologicalSubjectFactory.from_birth_data-425"><span class="linenos">425</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-426"><a href="#AstrologicalSubjectFactory.from_birth_data-426"><span class="linenos">426</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-427"><a href="#AstrologicalSubjectFactory.from_birth_data-427"><span class="linenos">427</span></a>        <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-428"><a href="#AstrologicalSubjectFactory.from_birth_data-428"><span class="linenos">428</span></a>        <span class="n">month</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-429"><a href="#AstrologicalSubjectFactory.from_birth_data-429"><span class="linenos">429</span></a>        <span class="n">day</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-430"><a href="#AstrologicalSubjectFactory.from_birth_data-430"><span class="linenos">430</span></a>        <span class="n">hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-431"><a href="#AstrologicalSubjectFactory.from_birth_data-431"><span class="linenos">431</span></a>        <span class="n">minute</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-432"><a href="#AstrologicalSubjectFactory.from_birth_data-432"><span class="linenos">432</span></a>        <span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-433"><a href="#AstrologicalSubjectFactory.from_birth_data-433"><span class="linenos">433</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-434"><a href="#AstrologicalSubjectFactory.from_birth_data-434"><span class="linenos">434</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-435"><a href="#AstrologicalSubjectFactory.from_birth_data-435"><span class="linenos">435</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-436"><a href="#AstrologicalSubjectFactory.from_birth_data-436"><span class="linenos">436</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-437"><a href="#AstrologicalSubjectFactory.from_birth_data-437"><span class="linenos">437</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-438"><a href="#AstrologicalSubjectFactory.from_birth_data-438"><span class="linenos">438</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-439"><a href="#AstrologicalSubjectFactory.from_birth_data-439"><span class="linenos">439</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-440"><a href="#AstrologicalSubjectFactory.from_birth_data-440"><span class="linenos">440</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-441"><a href="#AstrologicalSubjectFactory.from_birth_data-441"><span class="linenos">441</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-442"><a href="#AstrologicalSubjectFactory.from_birth_data-442"><span class="linenos">442</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-443"><a href="#AstrologicalSubjectFactory.from_birth_data-443"><span class="linenos">443</span></a>        <span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-444"><a href="#AstrologicalSubjectFactory.from_birth_data-444"><span class="linenos">444</span></a>        <span class="n">is_dst</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-445"><a href="#AstrologicalSubjectFactory.from_birth_data-445"><span class="linenos">445</span></a>        <span class="n">altitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-446"><a href="#AstrologicalSubjectFactory.from_birth_data-446"><span class="linenos">446</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-447"><a href="#AstrologicalSubjectFactory.from_birth_data-447"><span class="linenos">447</span></a>        <span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-448"><a href="#AstrologicalSubjectFactory.from_birth_data-448"><span class="linenos">448</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-449"><a href="#AstrologicalSubjectFactory.from_birth_data-449"><span class="linenos">449</span></a>        <span class="n">seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-450"><a href="#AstrologicalSubjectFactory.from_birth_data-450"><span class="linenos">450</span></a>        <span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-451"><a href="#AstrologicalSubjectFactory.from_birth_data-451"><span class="linenos">451</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-452"><a href="#AstrologicalSubjectFactory.from_birth_data-452"><span class="linenos">452</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-453"><a href="#AstrologicalSubjectFactory.from_birth_data-453"><span class="linenos">453</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-454"><a href="#AstrologicalSubjectFactory.from_birth_data-454"><span class="linenos">454</span></a><span class="sd">        Create an astrological subject from standard birth or event data.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-455"><a href="#AstrologicalSubjectFactory.from_birth_data-455"><span class="linenos">455</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-456"><a href="#AstrologicalSubjectFactory.from_birth_data-456"><span class="linenos">456</span></a><span class="sd">        This is the most flexible and commonly used factory method. It creates a complete</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-457"><a href="#AstrologicalSubjectFactory.from_birth_data-457"><span class="linenos">457</span></a><span class="sd">        astrological subject with planetary positions, house cusps, and specialized points</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-458"><a href="#AstrologicalSubjectFactory.from_birth_data-458"><span class="linenos">458</span></a><span class="sd">        for a specific date, time, and location. Supports both online location resolution</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-459"><a href="#AstrologicalSubjectFactory.from_birth_data-459"><span class="linenos">459</span></a><span class="sd">        and offline calculation modes.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-460"><a href="#AstrologicalSubjectFactory.from_birth_data-460"><span class="linenos">460</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-461"><a href="#AstrologicalSubjectFactory.from_birth_data-461"><span class="linenos">461</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-462"><a href="#AstrologicalSubjectFactory.from_birth_data-462"><span class="linenos">462</span></a><span class="sd">            name (str, optional): Name or identifier for the subject. Defaults to &quot;Now&quot;.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-463"><a href="#AstrologicalSubjectFactory.from_birth_data-463"><span class="linenos">463</span></a><span class="sd">            year (int, optional): Year of birth/event. Defaults to current year.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-464"><a href="#AstrologicalSubjectFactory.from_birth_data-464"><span class="linenos">464</span></a><span class="sd">            month (int, optional): Month of birth/event (1-12). Defaults to current month.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-465"><a href="#AstrologicalSubjectFactory.from_birth_data-465"><span class="linenos">465</span></a><span class="sd">            day (int, optional): Day of birth/event (1-31). Defaults to current day.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-466"><a href="#AstrologicalSubjectFactory.from_birth_data-466"><span class="linenos">466</span></a><span class="sd">            hour (int, optional): Hour of birth/event (0-23). Defaults to current hour.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-467"><a href="#AstrologicalSubjectFactory.from_birth_data-467"><span class="linenos">467</span></a><span class="sd">            minute (int, optional): Minute of birth/event (0-59). Defaults to current minute.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-468"><a href="#AstrologicalSubjectFactory.from_birth_data-468"><span class="linenos">468</span></a><span class="sd">            seconds (int, optional): Seconds of birth/event (0-59). Defaults to 0.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-469"><a href="#AstrologicalSubjectFactory.from_birth_data-469"><span class="linenos">469</span></a><span class="sd">            city (str, optional): City name for location lookup. Used with online=True.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-470"><a href="#AstrologicalSubjectFactory.from_birth_data-470"><span class="linenos">470</span></a><span class="sd">                Defaults to None (Greenwich if not specified).</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-471"><a href="#AstrologicalSubjectFactory.from_birth_data-471"><span class="linenos">471</span></a><span class="sd">            nation (str, optional): ISO country code (e.g., &#39;US&#39;, &#39;GB&#39;, &#39;IT&#39;). Used with</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-472"><a href="#AstrologicalSubjectFactory.from_birth_data-472"><span class="linenos">472</span></a><span class="sd">                online=True. Defaults to None (&#39;GB&#39; if not specified).</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-473"><a href="#AstrologicalSubjectFactory.from_birth_data-473"><span class="linenos">473</span></a><span class="sd">            lng (float, optional): Longitude in decimal degrees. East is positive, West</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-474"><a href="#AstrologicalSubjectFactory.from_birth_data-474"><span class="linenos">474</span></a><span class="sd">                is negative. If not provided and online=True, fetched from GeoNames.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-475"><a href="#AstrologicalSubjectFactory.from_birth_data-475"><span class="linenos">475</span></a><span class="sd">            lat (float, optional): Latitude in decimal degrees. North is positive, South</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-476"><a href="#AstrologicalSubjectFactory.from_birth_data-476"><span class="linenos">476</span></a><span class="sd">                is negative. If not provided and online=True, fetched from GeoNames.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-477"><a href="#AstrologicalSubjectFactory.from_birth_data-477"><span class="linenos">477</span></a><span class="sd">            tz_str (str, optional): IANA timezone identifier (e.g., &#39;Europe/London&#39;).</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-478"><a href="#AstrologicalSubjectFactory.from_birth_data-478"><span class="linenos">478</span></a><span class="sd">                If not provided and online=True, fetched from GeoNames.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-479"><a href="#AstrologicalSubjectFactory.from_birth_data-479"><span class="linenos">479</span></a><span class="sd">            geonames_username (str, optional): Username for GeoNames API. Required for</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-480"><a href="#AstrologicalSubjectFactory.from_birth_data-480"><span class="linenos">480</span></a><span class="sd">                online location lookup. Get one free at geonames.org.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-481"><a href="#AstrologicalSubjectFactory.from_birth_data-481"><span class="linenos">481</span></a><span class="sd">            online (bool, optional): Whether to fetch location data online. If False,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-482"><a href="#AstrologicalSubjectFactory.from_birth_data-482"><span class="linenos">482</span></a><span class="sd">                lng, lat, and tz_str must be provided. Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-483"><a href="#AstrologicalSubjectFactory.from_birth_data-483"><span class="linenos">483</span></a><span class="sd">            zodiac_type (ZodiacType, optional): Zodiac system - &#39;Tropical&#39; or &#39;Sidereal&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-484"><a href="#AstrologicalSubjectFactory.from_birth_data-484"><span class="linenos">484</span></a><span class="sd">                Defaults to &#39;Tropical&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-485"><a href="#AstrologicalSubjectFactory.from_birth_data-485"><span class="linenos">485</span></a><span class="sd">            sidereal_mode (SiderealMode, optional): Sidereal calculation mode (e.g.,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-486"><a href="#AstrologicalSubjectFactory.from_birth_data-486"><span class="linenos">486</span></a><span class="sd">                &#39;FAGAN_BRADLEY&#39;, &#39;LAHIRI&#39;). Only used with zodiac_type=&#39;Sidereal&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-487"><a href="#AstrologicalSubjectFactory.from_birth_data-487"><span class="linenos">487</span></a><span class="sd">            houses_system_identifier (HousesSystemIdentifier, optional): House system</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-488"><a href="#AstrologicalSubjectFactory.from_birth_data-488"><span class="linenos">488</span></a><span class="sd">                for cusp calculations (e.g., &#39;P&#39;=Placidus, &#39;K&#39;=Koch, &#39;E&#39;=Equal).</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-489"><a href="#AstrologicalSubjectFactory.from_birth_data-489"><span class="linenos">489</span></a><span class="sd">                Defaults to &#39;P&#39; (Placidus).</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-490"><a href="#AstrologicalSubjectFactory.from_birth_data-490"><span class="linenos">490</span></a><span class="sd">            perspective_type (PerspectiveType, optional): Calculation perspective:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-491"><a href="#AstrologicalSubjectFactory.from_birth_data-491"><span class="linenos">491</span></a><span class="sd">                - &#39;Apparent Geocentric&#39;: Standard geocentric with light-time correction</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-492"><a href="#AstrologicalSubjectFactory.from_birth_data-492"><span class="linenos">492</span></a><span class="sd">                - &#39;True Geocentric&#39;: Geometric geocentric positions</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-493"><a href="#AstrologicalSubjectFactory.from_birth_data-493"><span class="linenos">493</span></a><span class="sd">                - &#39;Heliocentric&#39;: Sun-centered coordinates</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-494"><a href="#AstrologicalSubjectFactory.from_birth_data-494"><span class="linenos">494</span></a><span class="sd">                - &#39;Topocentric&#39;: Earth surface perspective (requires altitude)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-495"><a href="#AstrologicalSubjectFactory.from_birth_data-495"><span class="linenos">495</span></a><span class="sd">                Defaults to &#39;Apparent Geocentric&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-496"><a href="#AstrologicalSubjectFactory.from_birth_data-496"><span class="linenos">496</span></a><span class="sd">            cache_expire_after_days (int, optional): Days to cache GeoNames data locally.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-497"><a href="#AstrologicalSubjectFactory.from_birth_data-497"><span class="linenos">497</span></a><span class="sd">                Defaults to 30.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-498"><a href="#AstrologicalSubjectFactory.from_birth_data-498"><span class="linenos">498</span></a><span class="sd">            is_dst (bool, optional): Daylight Saving Time flag for ambiguous times.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-499"><a href="#AstrologicalSubjectFactory.from_birth_data-499"><span class="linenos">499</span></a><span class="sd">                If None, pytz attempts automatic detection. Set explicitly for</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-500"><a href="#AstrologicalSubjectFactory.from_birth_data-500"><span class="linenos">500</span></a><span class="sd">                times during DST transitions.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-501"><a href="#AstrologicalSubjectFactory.from_birth_data-501"><span class="linenos">501</span></a><span class="sd">            altitude (float, optional): Altitude above sea level in meters. Used for</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-502"><a href="#AstrologicalSubjectFactory.from_birth_data-502"><span class="linenos">502</span></a><span class="sd">                topocentric calculations and atmospheric corrections. Defaults to None</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-503"><a href="#AstrologicalSubjectFactory.from_birth_data-503"><span class="linenos">503</span></a><span class="sd">                (sea level assumed).</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-504"><a href="#AstrologicalSubjectFactory.from_birth_data-504"><span class="linenos">504</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]], optional): List of astrological</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-505"><a href="#AstrologicalSubjectFactory.from_birth_data-505"><span class="linenos">505</span></a><span class="sd">                points to calculate. Omitting points can improve performance for</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-506"><a href="#AstrologicalSubjectFactory.from_birth_data-506"><span class="linenos">506</span></a><span class="sd">                specialized applications. If None, uses DEFAULT_ACTIVE_POINTS.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-507"><a href="#AstrologicalSubjectFactory.from_birth_data-507"><span class="linenos">507</span></a><span class="sd">            calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-508"><a href="#AstrologicalSubjectFactory.from_birth_data-508"><span class="linenos">508</span></a><span class="sd">                Requires Sun and Moon in active_points. Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-509"><a href="#AstrologicalSubjectFactory.from_birth_data-509"><span class="linenos">509</span></a><span class="sd">            suppress_geonames_warning (bool, optional): If True, suppresses the warning</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-510"><a href="#AstrologicalSubjectFactory.from_birth_data-510"><span class="linenos">510</span></a><span class="sd">                message when using the default GeoNames username. Useful for testing</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-511"><a href="#AstrologicalSubjectFactory.from_birth_data-511"><span class="linenos">511</span></a><span class="sd">                or automated processes. Defaults to False.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-512"><a href="#AstrologicalSubjectFactory.from_birth_data-512"><span class="linenos">512</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-513"><a href="#AstrologicalSubjectFactory.from_birth_data-513"><span class="linenos">513</span></a><span class="sd">        Returns:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-514"><a href="#AstrologicalSubjectFactory.from_birth_data-514"><span class="linenos">514</span></a><span class="sd">            AstrologicalSubjectModel: Complete astrological subject with calculated</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-515"><a href="#AstrologicalSubjectFactory.from_birth_data-515"><span class="linenos">515</span></a><span class="sd">                positions, houses, and metadata. Access planetary positions via</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-516"><a href="#AstrologicalSubjectFactory.from_birth_data-516"><span class="linenos">516</span></a><span class="sd">                attributes like .sun, .moon, .mercury, etc.</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-517"><a href="#AstrologicalSubjectFactory.from_birth_data-517"><span class="linenos">517</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-518"><a href="#AstrologicalSubjectFactory.from_birth_data-518"><span class="linenos">518</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-519"><a href="#AstrologicalSubjectFactory.from_birth_data-519"><span class="linenos">519</span></a><span class="sd">            KerykeionException:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-520"><a href="#AstrologicalSubjectFactory.from_birth_data-520"><span class="linenos">520</span></a><span class="sd">                - If offline mode is used without required location data</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-521"><a href="#AstrologicalSubjectFactory.from_birth_data-521"><span class="linenos">521</span></a><span class="sd">                - If invalid zodiac/sidereal mode combinations are specified</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-522"><a href="#AstrologicalSubjectFactory.from_birth_data-522"><span class="linenos">522</span></a><span class="sd">                - If GeoNames data is missing or invalid</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-523"><a href="#AstrologicalSubjectFactory.from_birth_data-523"><span class="linenos">523</span></a><span class="sd">                - If timezone localization fails (ambiguous DST times)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-524"><a href="#AstrologicalSubjectFactory.from_birth_data-524"><span class="linenos">524</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-525"><a href="#AstrologicalSubjectFactory.from_birth_data-525"><span class="linenos">525</span></a><span class="sd">        Examples:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-526"><a href="#AstrologicalSubjectFactory.from_birth_data-526"><span class="linenos">526</span></a><span class="sd">            &gt;&gt;&gt; # Basic natal chart with online location lookup</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-527"><a href="#AstrologicalSubjectFactory.from_birth_data-527"><span class="linenos">527</span></a><span class="sd">            &gt;&gt;&gt; chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-528"><a href="#AstrologicalSubjectFactory.from_birth_data-528"><span class="linenos">528</span></a><span class="sd">            ...     name=&quot;Jane Doe&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-529"><a href="#AstrologicalSubjectFactory.from_birth_data-529"><span class="linenos">529</span></a><span class="sd">            ...     year=1985, month=3, day=21,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-530"><a href="#AstrologicalSubjectFactory.from_birth_data-530"><span class="linenos">530</span></a><span class="sd">            ...     hour=15, minute=30,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-531"><a href="#AstrologicalSubjectFactory.from_birth_data-531"><span class="linenos">531</span></a><span class="sd">            ...     city=&quot;Paris&quot;, nation=&quot;FR&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-532"><a href="#AstrologicalSubjectFactory.from_birth_data-532"><span class="linenos">532</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-533"><a href="#AstrologicalSubjectFactory.from_birth_data-533"><span class="linenos">533</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-534"><a href="#AstrologicalSubjectFactory.from_birth_data-534"><span class="linenos">534</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-535"><a href="#AstrologicalSubjectFactory.from_birth_data-535"><span class="linenos">535</span></a><span class="sd">            &gt;&gt;&gt; # Offline calculation with manual coordinates</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-536"><a href="#AstrologicalSubjectFactory.from_birth_data-536"><span class="linenos">536</span></a><span class="sd">            &gt;&gt;&gt; chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-537"><a href="#AstrologicalSubjectFactory.from_birth_data-537"><span class="linenos">537</span></a><span class="sd">            ...     name=&quot;John Smith&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-538"><a href="#AstrologicalSubjectFactory.from_birth_data-538"><span class="linenos">538</span></a><span class="sd">            ...     year=1990, month=12, day=25,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-539"><a href="#AstrologicalSubjectFactory.from_birth_data-539"><span class="linenos">539</span></a><span class="sd">            ...     hour=0, minute=0,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-540"><a href="#AstrologicalSubjectFactory.from_birth_data-540"><span class="linenos">540</span></a><span class="sd">            ...     lng=-74.006, lat=40.7128, tz_str=&quot;America/New_York&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-541"><a href="#AstrologicalSubjectFactory.from_birth_data-541"><span class="linenos">541</span></a><span class="sd">            ...     online=False</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-542"><a href="#AstrologicalSubjectFactory.from_birth_data-542"><span class="linenos">542</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-543"><a href="#AstrologicalSubjectFactory.from_birth_data-543"><span class="linenos">543</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-544"><a href="#AstrologicalSubjectFactory.from_birth_data-544"><span class="linenos">544</span></a><span class="sd">            &gt;&gt;&gt; # Sidereal chart with specific points</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-545"><a href="#AstrologicalSubjectFactory.from_birth_data-545"><span class="linenos">545</span></a><span class="sd">            &gt;&gt;&gt; chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-546"><a href="#AstrologicalSubjectFactory.from_birth_data-546"><span class="linenos">546</span></a><span class="sd">            ...     name=&quot;Vedic Chart&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-547"><a href="#AstrologicalSubjectFactory.from_birth_data-547"><span class="linenos">547</span></a><span class="sd">            ...     year=2000, month=6, day=15, hour=12,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-548"><a href="#AstrologicalSubjectFactory.from_birth_data-548"><span class="linenos">548</span></a><span class="sd">            ...     city=&quot;Mumbai&quot;, nation=&quot;IN&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-549"><a href="#AstrologicalSubjectFactory.from_birth_data-549"><span class="linenos">549</span></a><span class="sd">            ...     zodiac_type=&quot;Sidereal&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-550"><a href="#AstrologicalSubjectFactory.from_birth_data-550"><span class="linenos">550</span></a><span class="sd">            ...     sidereal_mode=&quot;LAHIRI&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-551"><a href="#AstrologicalSubjectFactory.from_birth_data-551"><span class="linenos">551</span></a><span class="sd">            ...     active_points=[&quot;Sun&quot;, &quot;Moon&quot;, &quot;Mercury&quot;, &quot;Venus&quot;, &quot;Mars&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-552"><a href="#AstrologicalSubjectFactory.from_birth_data-552"><span class="linenos">552</span></a><span class="sd">            ...                   &quot;Jupiter&quot;, &quot;Saturn&quot;, &quot;Ascendant&quot;]</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-553"><a href="#AstrologicalSubjectFactory.from_birth_data-553"><span class="linenos">553</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-554"><a href="#AstrologicalSubjectFactory.from_birth_data-554"><span class="linenos">554</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-555"><a href="#AstrologicalSubjectFactory.from_birth_data-555"><span class="linenos">555</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-556"><a href="#AstrologicalSubjectFactory.from_birth_data-556"><span class="linenos">556</span></a><span class="sd">            - For high-precision calculations, consider providing seconds parameter</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-557"><a href="#AstrologicalSubjectFactory.from_birth_data-557"><span class="linenos">557</span></a><span class="sd">            - Use topocentric perspective for observer-specific calculations</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-558"><a href="#AstrologicalSubjectFactory.from_birth_data-558"><span class="linenos">558</span></a><span class="sd">            - Some Arabic parts automatically activate required base points</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-559"><a href="#AstrologicalSubjectFactory.from_birth_data-559"><span class="linenos">559</span></a><span class="sd">            - The method handles polar regions by adjusting extreme latitudes</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-560"><a href="#AstrologicalSubjectFactory.from_birth_data-560"><span class="linenos">560</span></a><span class="sd">            - Time zones are handled with full DST awareness via pytz</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-561"><a href="#AstrologicalSubjectFactory.from_birth_data-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-562"><a href="#AstrologicalSubjectFactory.from_birth_data-562"><span class="linenos">562</span></a>        <span class="c1"># Resolve time defaults using current time</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-563"><a href="#AstrologicalSubjectFactory.from_birth_data-563"><span class="linenos">563</span></a>        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">month</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">day</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">hour</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">minute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-564"><a href="#AstrologicalSubjectFactory.from_birth_data-564"><span class="linenos">564</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-565"><a href="#AstrologicalSubjectFactory.from_birth_data-565"><span class="linenos">565</span></a>            <span class="n">year</span> <span class="o">=</span> <span class="n">year</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">year</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-566"><a href="#AstrologicalSubjectFactory.from_birth_data-566"><span class="linenos">566</span></a>            <span class="n">month</span> <span class="o">=</span> <span class="n">month</span> <span class="k">if</span> <span class="n">month</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-567"><a href="#AstrologicalSubjectFactory.from_birth_data-567"><span class="linenos">567</span></a>            <span class="n">day</span> <span class="o">=</span> <span class="n">day</span> <span class="k">if</span> <span class="n">day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">day</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-568"><a href="#AstrologicalSubjectFactory.from_birth_data-568"><span class="linenos">568</span></a>            <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span> <span class="k">if</span> <span class="n">hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-569"><a href="#AstrologicalSubjectFactory.from_birth_data-569"><span class="linenos">569</span></a>            <span class="n">minute</span> <span class="o">=</span> <span class="n">minute</span> <span class="k">if</span> <span class="n">minute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-570"><a href="#AstrologicalSubjectFactory.from_birth_data-570"><span class="linenos">570</span></a>            <span class="n">seconds</span> <span class="o">=</span> <span class="n">seconds</span> <span class="k">if</span> <span class="n">seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">now</span><span class="o">.</span><span class="n">second</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-571"><a href="#AstrologicalSubjectFactory.from_birth_data-571"><span class="linenos">571</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-572"><a href="#AstrologicalSubjectFactory.from_birth_data-572"><span class="linenos">572</span></a>        <span class="c1"># Create a calculation data container</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-573"><a href="#AstrologicalSubjectFactory.from_birth_data-573"><span class="linenos">573</span></a>        <span class="n">calc_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-574"><a href="#AstrologicalSubjectFactory.from_birth_data-574"><span class="linenos">574</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-575"><a href="#AstrologicalSubjectFactory.from_birth_data-575"><span class="linenos">575</span></a>        <span class="c1"># Basic identity</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-576"><a href="#AstrologicalSubjectFactory.from_birth_data-576"><span class="linenos">576</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-577"><a href="#AstrologicalSubjectFactory.from_birth_data-577"><span class="linenos">577</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;json_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">())</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-578"><a href="#AstrologicalSubjectFactory.from_birth_data-578"><span class="linenos">578</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-579"><a href="#AstrologicalSubjectFactory.from_birth_data-579"><span class="linenos">579</span></a>        <span class="c1"># Create a deep copy of active points to avoid modifying the original list</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-580"><a href="#AstrologicalSubjectFactory.from_birth_data-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-581"><a href="#AstrologicalSubjectFactory.from_birth_data-581"><span class="linenos">581</span></a>            <span class="n">active_points_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-582"><a href="#AstrologicalSubjectFactory.from_birth_data-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-583"><a href="#AstrologicalSubjectFactory.from_birth_data-583"><span class="linenos">583</span></a>            <span class="n">active_points_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-584"><a href="#AstrologicalSubjectFactory.from_birth_data-584"><span class="linenos">584</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-585"><a href="#AstrologicalSubjectFactory.from_birth_data-585"><span class="linenos">585</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;active_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active_points_list</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-586"><a href="#AstrologicalSubjectFactory.from_birth_data-586"><span class="linenos">586</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-587"><a href="#AstrologicalSubjectFactory.from_birth_data-587"><span class="linenos">587</span></a>        <span class="c1"># Initialize configuration</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-588"><a href="#AstrologicalSubjectFactory.from_birth_data-588"><span class="linenos">588</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">ChartConfiguration</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-589"><a href="#AstrologicalSubjectFactory.from_birth_data-589"><span class="linenos">589</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-590"><a href="#AstrologicalSubjectFactory.from_birth_data-590"><span class="linenos">590</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-591"><a href="#AstrologicalSubjectFactory.from_birth_data-591"><span class="linenos">591</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-592"><a href="#AstrologicalSubjectFactory.from_birth_data-592"><span class="linenos">592</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-593"><a href="#AstrologicalSubjectFactory.from_birth_data-593"><span class="linenos">593</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-594"><a href="#AstrologicalSubjectFactory.from_birth_data-594"><span class="linenos">594</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-595"><a href="#AstrologicalSubjectFactory.from_birth_data-595"><span class="linenos">595</span></a>        <span class="c1"># Add configuration data to calculation data</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-596"><a href="#AstrologicalSubjectFactory.from_birth_data-596"><span class="linenos">596</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;zodiac_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">zodiac_type</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-597"><a href="#AstrologicalSubjectFactory.from_birth_data-597"><span class="linenos">597</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;sidereal_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sidereal_mode</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-598"><a href="#AstrologicalSubjectFactory.from_birth_data-598"><span class="linenos">598</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;houses_system_identifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">houses_system_identifier</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-599"><a href="#AstrologicalSubjectFactory.from_birth_data-599"><span class="linenos">599</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">perspective_type</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-600"><a href="#AstrologicalSubjectFactory.from_birth_data-600"><span class="linenos">600</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-601"><a href="#AstrologicalSubjectFactory.from_birth_data-601"><span class="linenos">601</span></a>        <span class="c1"># Set up geonames username if needed</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-602"><a href="#AstrologicalSubjectFactory.from_birth_data-602"><span class="linenos">602</span></a>        <span class="k">if</span> <span class="n">geonames_username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lat</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lng</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tz_str</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-603"><a href="#AstrologicalSubjectFactory.from_birth_data-603"><span class="linenos">603</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_geonames_warning</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-604"><a href="#AstrologicalSubjectFactory.from_birth_data-604"><span class="linenos">604</span></a>                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-605"><a href="#AstrologicalSubjectFactory.from_birth_data-605"><span class="linenos">605</span></a>            <span class="n">geonames_username</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-606"><a href="#AstrologicalSubjectFactory.from_birth_data-606"><span class="linenos">606</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-607"><a href="#AstrologicalSubjectFactory.from_birth_data-607"><span class="linenos">607</span></a>        <span class="c1"># Initialize location data</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-608"><a href="#AstrologicalSubjectFactory.from_birth_data-608"><span class="linenos">608</span></a>        <span class="n">location</span> <span class="o">=</span> <span class="n">LocationData</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-609"><a href="#AstrologicalSubjectFactory.from_birth_data-609"><span class="linenos">609</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span> <span class="ow">or</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-610"><a href="#AstrologicalSubjectFactory.from_birth_data-610"><span class="linenos">610</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span> <span class="ow">or</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-611"><a href="#AstrologicalSubjectFactory.from_birth_data-611"><span class="linenos">611</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">lat</span> <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">51.5074</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-612"><a href="#AstrologicalSubjectFactory.from_birth_data-612"><span class="linenos">612</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">lng</span> <span class="k">if</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-613"><a href="#AstrologicalSubjectFactory.from_birth_data-613"><span class="linenos">613</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span> <span class="ow">or</span> <span class="s2">&quot;Etc/GMT&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-614"><a href="#AstrologicalSubjectFactory.from_birth_data-614"><span class="linenos">614</span></a>            <span class="n">altitude</span><span class="o">=</span><span class="n">altitude</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-615"><a href="#AstrologicalSubjectFactory.from_birth_data-615"><span class="linenos">615</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-616"><a href="#AstrologicalSubjectFactory.from_birth_data-616"><span class="linenos">616</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-617"><a href="#AstrologicalSubjectFactory.from_birth_data-617"><span class="linenos">617</span></a>        <span class="c1"># If offline mode is requested but required data is missing, raise error</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-618"><a href="#AstrologicalSubjectFactory.from_birth_data-618"><span class="linenos">618</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tz_str</span> <span class="ow">or</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-619"><a href="#AstrologicalSubjectFactory.from_birth_data-619"><span class="linenos">619</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-620"><a href="#AstrologicalSubjectFactory.from_birth_data-620"><span class="linenos">620</span></a>                <span class="s2">&quot;For offline mode, you must provide timezone (tz_str) and coordinates (lat, lng)&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-621"><a href="#AstrologicalSubjectFactory.from_birth_data-621"><span class="linenos">621</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-622"><a href="#AstrologicalSubjectFactory.from_birth_data-622"><span class="linenos">622</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-623"><a href="#AstrologicalSubjectFactory.from_birth_data-623"><span class="linenos">623</span></a>        <span class="c1"># Fetch location data if needed</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-624"><a href="#AstrologicalSubjectFactory.from_birth_data-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tz_str</span> <span class="ow">or</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-625"><a href="#AstrologicalSubjectFactory.from_birth_data-625"><span class="linenos">625</span></a>            <span class="n">location</span><span class="o">.</span><span class="n">fetch_from_geonames</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-626"><a href="#AstrologicalSubjectFactory.from_birth_data-626"><span class="linenos">626</span></a>                <span class="n">username</span><span class="o">=</span><span class="n">geonames_username</span> <span class="ow">or</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-627"><a href="#AstrologicalSubjectFactory.from_birth_data-627"><span class="linenos">627</span></a>                <span class="n">cache_expire_after_days</span><span class="o">=</span><span class="n">cache_expire_after_days</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-628"><a href="#AstrologicalSubjectFactory.from_birth_data-628"><span class="linenos">628</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-629"><a href="#AstrologicalSubjectFactory.from_birth_data-629"><span class="linenos">629</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-630"><a href="#AstrologicalSubjectFactory.from_birth_data-630"><span class="linenos">630</span></a>        <span class="c1"># Prepare location for calculations</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-631"><a href="#AstrologicalSubjectFactory.from_birth_data-631"><span class="linenos">631</span></a>        <span class="n">location</span><span class="o">.</span><span class="n">prepare_for_calculation</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-632"><a href="#AstrologicalSubjectFactory.from_birth_data-632"><span class="linenos">632</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-633"><a href="#AstrologicalSubjectFactory.from_birth_data-633"><span class="linenos">633</span></a>        <span class="c1"># Add location data to calculation data</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-634"><a href="#AstrologicalSubjectFactory.from_birth_data-634"><span class="linenos">634</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">city</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-635"><a href="#AstrologicalSubjectFactory.from_birth_data-635"><span class="linenos">635</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;nation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">nation</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-636"><a href="#AstrologicalSubjectFactory.from_birth_data-636"><span class="linenos">636</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">lat</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-637"><a href="#AstrologicalSubjectFactory.from_birth_data-637"><span class="linenos">637</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">lng</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-638"><a href="#AstrologicalSubjectFactory.from_birth_data-638"><span class="linenos">638</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;tz_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">tz_str</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-639"><a href="#AstrologicalSubjectFactory.from_birth_data-639"><span class="linenos">639</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;altitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">altitude</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-640"><a href="#AstrologicalSubjectFactory.from_birth_data-640"><span class="linenos">640</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-641"><a href="#AstrologicalSubjectFactory.from_birth_data-641"><span class="linenos">641</span></a>        <span class="c1"># Store calculation parameters</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-642"><a href="#AstrologicalSubjectFactory.from_birth_data-642"><span class="linenos">642</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-643"><a href="#AstrologicalSubjectFactory.from_birth_data-643"><span class="linenos">643</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">month</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-644"><a href="#AstrologicalSubjectFactory.from_birth_data-644"><span class="linenos">644</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">day</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-645"><a href="#AstrologicalSubjectFactory.from_birth_data-645"><span class="linenos">645</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-646"><a href="#AstrologicalSubjectFactory.from_birth_data-646"><span class="linenos">646</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;minute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minute</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-647"><a href="#AstrologicalSubjectFactory.from_birth_data-647"><span class="linenos">647</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;seconds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seconds</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-648"><a href="#AstrologicalSubjectFactory.from_birth_data-648"><span class="linenos">648</span></a>        <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;is_dst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_dst</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-649"><a href="#AstrologicalSubjectFactory.from_birth_data-649"><span class="linenos">649</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-650"><a href="#AstrologicalSubjectFactory.from_birth_data-650"><span class="linenos">650</span></a>        <span class="c1"># Calculate time conversions</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-651"><a href="#AstrologicalSubjectFactory.from_birth_data-651"><span class="linenos">651</span></a>        <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_time_conversions</span><span class="p">(</span><span class="n">calc_data</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-652"><a href="#AstrologicalSubjectFactory.from_birth_data-652"><span class="linenos">652</span></a>        <span class="c1"># Initialize Swiss Ephemeris and calculate houses and planets with context manager</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-653"><a href="#AstrologicalSubjectFactory.from_birth_data-653"><span class="linenos">653</span></a>        <span class="n">ephe_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;sweph&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-654"><a href="#AstrologicalSubjectFactory.from_birth_data-654"><span class="linenos">654</span></a>        <span class="k">with</span> <span class="n">ephemeris_context</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-655"><a href="#AstrologicalSubjectFactory.from_birth_data-655"><span class="linenos">655</span></a>            <span class="n">ephe_path</span><span class="o">=</span><span class="n">ephe_path</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-656"><a href="#AstrologicalSubjectFactory.from_birth_data-656"><span class="linenos">656</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-657"><a href="#AstrologicalSubjectFactory.from_birth_data-657"><span class="linenos">657</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-658"><a href="#AstrologicalSubjectFactory.from_birth_data-658"><span class="linenos">658</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-659"><a href="#AstrologicalSubjectFactory.from_birth_data-659"><span class="linenos">659</span></a>            <span class="n">alt</span><span class="o">=</span><span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;altitude&quot;</span><span class="p">],</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-660"><a href="#AstrologicalSubjectFactory.from_birth_data-660"><span class="linenos">660</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">iflag</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-661"><a href="#AstrologicalSubjectFactory.from_birth_data-661"><span class="linenos">661</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;_iflag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iflag</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-662"><a href="#AstrologicalSubjectFactory.from_birth_data-662"><span class="linenos">662</span></a>            <span class="c1"># House system name (previously set in _setup_ephemeris)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-663"><a href="#AstrologicalSubjectFactory.from_birth_data-663"><span class="linenos">663</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;houses_system_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">house_name</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-664"><a href="#AstrologicalSubjectFactory.from_birth_data-664"><span class="linenos">664</span></a>                <span class="n">config</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-665"><a href="#AstrologicalSubjectFactory.from_birth_data-665"><span class="linenos">665</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-666"><a href="#AstrologicalSubjectFactory.from_birth_data-666"><span class="linenos">666</span></a>            <span class="n">calculated_axial_cusps</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_houses</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-667"><a href="#AstrologicalSubjectFactory.from_birth_data-667"><span class="linenos">667</span></a>                <span class="n">calc_data</span><span class="p">,</span> <span class="n">active_points_list</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-668"><a href="#AstrologicalSubjectFactory.from_birth_data-668"><span class="linenos">668</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-669"><a href="#AstrologicalSubjectFactory.from_birth_data-669"><span class="linenos">669</span></a>            <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_planets</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-670"><a href="#AstrologicalSubjectFactory.from_birth_data-670"><span class="linenos">670</span></a>                <span class="n">calc_data</span><span class="p">,</span> <span class="n">active_points_list</span><span class="p">,</span> <span class="n">calculated_axial_cusps</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-671"><a href="#AstrologicalSubjectFactory.from_birth_data-671"><span class="linenos">671</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-672"><a href="#AstrologicalSubjectFactory.from_birth_data-672"><span class="linenos">672</span></a>        <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">_calculate_day_of_week</span><span class="p">(</span><span class="n">calc_data</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-673"><a href="#AstrologicalSubjectFactory.from_birth_data-673"><span class="linenos">673</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-674"><a href="#AstrologicalSubjectFactory.from_birth_data-674"><span class="linenos">674</span></a>        <span class="c1"># Calculate lunar phase (optional - only if requested and Sun and Moon are available)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-675"><a href="#AstrologicalSubjectFactory.from_birth_data-675"><span class="linenos">675</span></a>        <span class="k">if</span> <span class="n">calculate_lunar_phase</span> <span class="ow">and</span> <span class="s2">&quot;moon&quot;</span> <span class="ow">in</span> <span class="n">calc_data</span> <span class="ow">and</span> <span class="s2">&quot;sun&quot;</span> <span class="ow">in</span> <span class="n">calc_data</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-676"><a href="#AstrologicalSubjectFactory.from_birth_data-676"><span class="linenos">676</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_moon_phase</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-677"><a href="#AstrologicalSubjectFactory.from_birth_data-677"><span class="linenos">677</span></a>                <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;moon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined,union-attr]</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-678"><a href="#AstrologicalSubjectFactory.from_birth_data-678"><span class="linenos">678</span></a>                <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;sun&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span>  <span class="c1"># type: ignore[attr-defined,union-attr]</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-679"><a href="#AstrologicalSubjectFactory.from_birth_data-679"><span class="linenos">679</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-680"><a href="#AstrologicalSubjectFactory.from_birth_data-680"><span class="linenos">680</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-681"><a href="#AstrologicalSubjectFactory.from_birth_data-681"><span class="linenos">681</span></a>            <span class="n">calc_data</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-682"><a href="#AstrologicalSubjectFactory.from_birth_data-682"><span class="linenos">682</span></a>
</span><span id="AstrologicalSubjectFactory.from_birth_data-683"><a href="#AstrologicalSubjectFactory.from_birth_data-683"><span class="linenos">683</span></a>        <span class="c1"># Create and return the AstrologicalSubjectModel</span>
</span><span id="AstrologicalSubjectFactory.from_birth_data-684"><a href="#AstrologicalSubjectFactory.from_birth_data-684"><span class="linenos">684</span></a>        <span class="k">return</span> <span class="n">AstrologicalSubjectModel</span><span class="p">(</span><span class="o">**</span><span class="n">calc_data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an astrological subject from standard birth or event data.</p>

<p>This is the most flexible and commonly used factory method. It creates a complete
astrological subject with planetary positions, house cusps, and specialized points
for a specific date, time, and location. Supports both online location resolution
and offline calculation modes.</p>

<p>Args:
    name (str, optional): Name or identifier for the subject. Defaults to "Now".
    year (int, optional): Year of birth/event. Defaults to current year.
    month (int, optional): Month of birth/event (1-12). Defaults to current month.
    day (int, optional): Day of birth/event (1-31). Defaults to current day.
    hour (int, optional): Hour of birth/event (0-23). Defaults to current hour.
    minute (int, optional): Minute of birth/event (0-59). Defaults to current minute.
    seconds (int, optional): Seconds of birth/event (0-59). Defaults to 0.
    city (str, optional): City name for location lookup. Used with online=True.
        Defaults to None (Greenwich if not specified).
    nation (str, optional): ISO country code (e.g., 'US', 'GB', 'IT'). Used with
        online=True. Defaults to None ('GB' if not specified).
    lng (float, optional): Longitude in decimal degrees. East is positive, West
        is negative. If not provided and online=True, fetched from GeoNames.
    lat (float, optional): Latitude in decimal degrees. North is positive, South
        is negative. If not provided and online=True, fetched from GeoNames.
    tz_str (str, optional): IANA timezone identifier (e.g., 'Europe/London').
        If not provided and online=True, fetched from GeoNames.
    geonames_username (str, optional): Username for GeoNames API. Required for
        online location lookup. Get one free at geonames.org.
    online (bool, optional): Whether to fetch location data online. If False,
        lng, lat, and tz_str must be provided. Defaults to True.
    zodiac_type (ZodiacType, optional): Zodiac system - 'Tropical' or 'Sidereal'.
        Defaults to 'Tropical'.
    sidereal_mode (SiderealMode, optional): Sidereal calculation mode (e.g.,
        'FAGAN_BRADLEY', 'LAHIRI'). Only used with zodiac_type='Sidereal'.
    houses_system_identifier (HousesSystemIdentifier, optional): House system
        for cusp calculations (e.g., 'P'=Placidus, 'K'=Koch, 'E'=Equal).
        Defaults to 'P' (Placidus).
    perspective_type (PerspectiveType, optional): Calculation perspective:
        - 'Apparent Geocentric': Standard geocentric with light-time correction
        - 'True Geocentric': Geometric geocentric positions
        - 'Heliocentric': Sun-centered coordinates
        - 'Topocentric': Earth surface perspective (requires altitude)
        Defaults to 'Apparent Geocentric'.
    cache_expire_after_days (int, optional): Days to cache GeoNames data locally.
        Defaults to 30.
    is_dst (bool, optional): Daylight Saving Time flag for ambiguous times.
        If None, pytz attempts automatic detection. Set explicitly for
        times during DST transitions.
    altitude (float, optional): Altitude above sea level in meters. Used for
        topocentric calculations and atmospheric corrections. Defaults to None
        (sea level assumed).
    active_points (Optional[List[AstrologicalPoint]], optional): List of astrological
        points to calculate. Omitting points can improve performance for
        specialized applications. If None, uses DEFAULT_ACTIVE_POINTS.
    calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.
        Requires Sun and Moon in active_points. Defaults to True.
    suppress_geonames_warning (bool, optional): If True, suppresses the warning
        message when using the default GeoNames username. Useful for testing
        or automated processes. Defaults to False.</p>

<p>Returns:
    AstrologicalSubjectModel: Complete astrological subject with calculated
        positions, houses, and metadata. Access planetary positions via
        attributes like .sun, .moon, .mercury, etc.</p>

<p>Raises:
    KerykeionException:
        - If offline mode is used without required location data
        - If invalid zodiac/sidereal mode combinations are specified
        - If GeoNames data is missing or invalid
        - If timezone localization fails (ambiguous DST times)</p>

<p>Examples:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="basic-natal-chart-with-online-location-lookup">Basic natal chart with online location lookup</h1>
      
      <p>chart = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
          ...     name="Jane Doe",
          ...     year=1985, month=3, day=21,
          ...     hour=15, minute=30,
          ...     city="Paris", nation="FR",
          ...     geonames_username="your_username"
          ... )</p>

<pre><code>&gt;&gt;&gt; # Offline calculation with manual coordinates
&gt;&gt;&gt; chart = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
...     name="John Smith",
...     year=1990, month=12, day=25,
...     hour=0, minute=0,
...     lng=-74.006, lat=40.7128, tz_str="America/New_York",
...     online=False
... )

&gt;&gt;&gt; # Sidereal chart with specific points
&gt;&gt;&gt; chart = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
...     name="Vedic Chart",
...     year=2000, month=6, day=15, hour=12,
...     city="Mumbai", nation="IN",
...     zodiac_type="Sidereal",
...     sidereal_mode="LAHIRI",
...     active_points=["Sun", "Moon", "Mercury", "Venus", "Mars",
...                   "Jupiter", "Saturn", "Ascendant"]
... )
</code></pre>
      
      <p>Note:
          - For high-precision calculations, consider providing seconds parameter
          - Use topocentric perspective for observer-specific calculations
          - Some Arabic parts automatically activate required base points
          - The method handles polar regions by adjusting extreme latitudes
          - Time zones are handled with full DST awareness via pytz</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="AstrologicalSubjectFactory.from_iso_utc_time" class="classattr">
                                        <input id="AstrologicalSubjectFactory.from_iso_utc_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_iso_utc_time</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">iso_utc_time</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Greenwich&#39;</span>,</span><span class="param">	<span class="n">nation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GB&#39;</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Etc/GMT&#39;</span>,</span><span class="param">	<span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">51.5074</span>,</span><span class="param">	<span class="n">geonames_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;century.boy&#39;</span>,</span><span class="param">	<span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span> <span class="s1">&#39;Sidereal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tropical&#39;</span>,</span><span class="param">	<span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FAGAN_BRADLEY&#39;</span><span class="p">,</span> <span class="s1">&#39;LAHIRI&#39;</span><span class="p">,</span> <span class="s1">&#39;DELUCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMAN&#39;</span><span class="p">,</span> <span class="s1">&#39;USHASHASHI&#39;</span><span class="p">,</span> <span class="s1">&#39;KRISHNAMURTI&#39;</span><span class="p">,</span> <span class="s1">&#39;DJWHAL_KHUL&#39;</span><span class="p">,</span> <span class="s1">&#39;YUKTESHWAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JN_BHASIN&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER1&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER2&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER3&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_HUBER&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_ETPSC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALDEBARAN_15TAU&#39;</span><span class="p">,</span> <span class="s1">&#39;HIPPARCHOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SASSANIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;J2000&#39;</span><span class="p">,</span> <span class="s1">&#39;J1900&#39;</span><span class="p">,</span> <span class="s1">&#39;B1950&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span>,</span><span class="param">	<span class="n">perspective_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Apparent Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Heliocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Topocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;True Geocentric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Apparent Geocentric&#39;</span>,</span><span class="param">	<span class="n">altitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubjectFactory.from_iso_utc_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubjectFactory.from_iso_utc_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubjectFactory.from_iso_utc_time-686"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-686"><span class="linenos">686</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-687"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-687"><span class="linenos">687</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_iso_utc_time</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-688"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-688"><span class="linenos">688</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-689"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-689"><span class="linenos">689</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-690"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-690"><span class="linenos">690</span></a>        <span class="n">iso_utc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-691"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-691"><span class="linenos">691</span></a>        <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-692"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-692"><span class="linenos">692</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-693"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-693"><span class="linenos">693</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/GMT&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-694"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-694"><span class="linenos">694</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-695"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-695"><span class="linenos">695</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-696"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-696"><span class="linenos">696</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">51.5074</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-697"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-697"><span class="linenos">697</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-698"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-698"><span class="linenos">698</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-699"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-699"><span class="linenos">699</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-700"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-700"><span class="linenos">700</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-701"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-701"><span class="linenos">701</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-702"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-702"><span class="linenos">702</span></a>        <span class="n">altitude</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-703"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-703"><span class="linenos">703</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-704"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-704"><span class="linenos">704</span></a>        <span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-705"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-705"><span class="linenos">705</span></a>        <span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-706"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-706"><span class="linenos">706</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-707"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-707"><span class="linenos">707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-708"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-708"><span class="linenos">708</span></a><span class="sd">        Create an astrological subject from an ISO formatted UTC timestamp.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-709"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-709"><span class="linenos">709</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-710"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-710"><span class="linenos">710</span></a><span class="sd">        This method is ideal for creating astrological subjects from standardized</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-711"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-711"><span class="linenos">711</span></a><span class="sd">        time formats, such as those stored in databases or received from APIs.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-712"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-712"><span class="linenos">712</span></a><span class="sd">        It automatically handles timezone conversion from UTC to the specified</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-713"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-713"><span class="linenos">713</span></a><span class="sd">        local timezone.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-714"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-714"><span class="linenos">714</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-715"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-715"><span class="linenos">715</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-716"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-716"><span class="linenos">716</span></a><span class="sd">            name (str): Name or identifier for the subject.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-717"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-717"><span class="linenos">717</span></a><span class="sd">            iso_utc_time (str): ISO 8601 formatted UTC timestamp. Supported formats:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-718"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-718"><span class="linenos">718</span></a><span class="sd">                - &quot;2023-06-15T14:30:00Z&quot; (with Z suffix)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-719"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-719"><span class="linenos">719</span></a><span class="sd">                - &quot;2023-06-15T14:30:00+00:00&quot; (with UTC offset)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-720"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-720"><span class="linenos">720</span></a><span class="sd">                - &quot;2023-06-15T14:30:00.123Z&quot; (with milliseconds)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-721"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-721"><span class="linenos">721</span></a><span class="sd">            city (str, optional): City name for location. Defaults to &quot;Greenwich&quot;.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-722"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-722"><span class="linenos">722</span></a><span class="sd">            nation (str, optional): ISO country code. Defaults to &quot;GB&quot;.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-723"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-723"><span class="linenos">723</span></a><span class="sd">            tz_str (str, optional): IANA timezone identifier for result conversion.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-724"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-724"><span class="linenos">724</span></a><span class="sd">                The ISO time is assumed to be in UTC and will be converted to this</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-725"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-725"><span class="linenos">725</span></a><span class="sd">                timezone. Defaults to &quot;Etc/GMT&quot;.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-726"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-726"><span class="linenos">726</span></a><span class="sd">            online (bool, optional): Whether to fetch coordinates online. If True,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-727"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-727"><span class="linenos">727</span></a><span class="sd">                coordinates are fetched via GeoNames API. Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-728"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-728"><span class="linenos">728</span></a><span class="sd">            lng (float, optional): Longitude in decimal degrees. Used when online=False</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-729"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-729"><span class="linenos">729</span></a><span class="sd">                or as fallback. Defaults to 0.0 (Greenwich).</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-730"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-730"><span class="linenos">730</span></a><span class="sd">            lat (float, optional): Latitude in decimal degrees. Used when online=False</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-731"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-731"><span class="linenos">731</span></a><span class="sd">                or as fallback. Defaults to 51.5074 (Greenwich).</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-732"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-732"><span class="linenos">732</span></a><span class="sd">            geonames_username (str, optional): GeoNames API username. Required when</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-733"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-733"><span class="linenos">733</span></a><span class="sd">                online=True. Defaults to DEFAULT_GEONAMES_USERNAME.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-734"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-734"><span class="linenos">734</span></a><span class="sd">            zodiac_type (ZodiacType, optional): Zodiac system. Defaults to &#39;Tropical&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-735"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-735"><span class="linenos">735</span></a><span class="sd">            sidereal_mode (SiderealMode, optional): Sidereal mode when zodiac_type</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-736"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-736"><span class="linenos">736</span></a><span class="sd">                is &#39;Sidereal&#39;. Defaults to None.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-737"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-737"><span class="linenos">737</span></a><span class="sd">            houses_system_identifier (HousesSystemIdentifier, optional): House system.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-738"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-738"><span class="linenos">738</span></a><span class="sd">                Defaults to &#39;P&#39; (Placidus).</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-739"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-739"><span class="linenos">739</span></a><span class="sd">            perspective_type (PerspectiveType, optional): Calculation perspective.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-740"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-740"><span class="linenos">740</span></a><span class="sd">                Defaults to &#39;Apparent Geocentric&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-741"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-741"><span class="linenos">741</span></a><span class="sd">            altitude (float, optional): Altitude in meters for topocentric calculations.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-742"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-742"><span class="linenos">742</span></a><span class="sd">                Defaults to None (sea level).</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-743"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-743"><span class="linenos">743</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]], optional): Points to calculate.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-744"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-744"><span class="linenos">744</span></a><span class="sd">                If None, uses DEFAULT_ACTIVE_POINTS.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-745"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-745"><span class="linenos">745</span></a><span class="sd">            calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-746"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-746"><span class="linenos">746</span></a><span class="sd">                Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-747"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-747"><span class="linenos">747</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-748"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-748"><span class="linenos">748</span></a><span class="sd">        Returns:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-749"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-749"><span class="linenos">749</span></a><span class="sd">            AstrologicalSubjectModel: Astrological subject with positions calculated</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-750"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-750"><span class="linenos">750</span></a><span class="sd">                for the specified UTC time converted to local timezone.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-751"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-751"><span class="linenos">751</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-752"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-752"><span class="linenos">752</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-753"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-753"><span class="linenos">753</span></a><span class="sd">            ValueError: If the ISO timestamp format is invalid or cannot be parsed.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-754"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-754"><span class="linenos">754</span></a><span class="sd">            KerykeionException: If location data cannot be fetched or is invalid.</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-755"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-755"><span class="linenos">755</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-756"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-756"><span class="linenos">756</span></a><span class="sd">        Examples:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-757"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-757"><span class="linenos">757</span></a><span class="sd">            &gt;&gt;&gt; # From API timestamp with online location lookup</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-758"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-758"><span class="linenos">758</span></a><span class="sd">            &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_iso_utc_time(</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-759"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-759"><span class="linenos">759</span></a><span class="sd">            ...     name=&quot;Event Chart&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-760"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-760"><span class="linenos">760</span></a><span class="sd">            ...     iso_utc_time=&quot;2023-12-25T12:00:00Z&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-761"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-761"><span class="linenos">761</span></a><span class="sd">            ...     city=&quot;Tokyo&quot;, nation=&quot;JP&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-762"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-762"><span class="linenos">762</span></a><span class="sd">            ...     tz_str=&quot;Asia/Tokyo&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-763"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-763"><span class="linenos">763</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-764"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-764"><span class="linenos">764</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-765"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-765"><span class="linenos">765</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-766"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-766"><span class="linenos">766</span></a><span class="sd">            &gt;&gt;&gt; # From database timestamp with manual coordinates</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-767"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-767"><span class="linenos">767</span></a><span class="sd">            &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_iso_utc_time(</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-768"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-768"><span class="linenos">768</span></a><span class="sd">            ...     name=&quot;Historical Event&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-769"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-769"><span class="linenos">769</span></a><span class="sd">            ...     iso_utc_time=&quot;1969-07-20T20:17:00Z&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-770"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-770"><span class="linenos">770</span></a><span class="sd">            ...     lng=-95.0969, lat=37.4419,  # Houston</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-771"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-771"><span class="linenos">771</span></a><span class="sd">            ...     tz_str=&quot;America/Chicago&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-772"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-772"><span class="linenos">772</span></a><span class="sd">            ...     online=False</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-773"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-773"><span class="linenos">773</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-774"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-774"><span class="linenos">774</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-775"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-775"><span class="linenos">775</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-776"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-776"><span class="linenos">776</span></a><span class="sd">            - The method assumes the input timestamp is in UTC</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-777"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-777"><span class="linenos">777</span></a><span class="sd">            - Local time conversion respects DST rules for the target timezone</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-778"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-778"><span class="linenos">778</span></a><span class="sd">            - Milliseconds in the timestamp are supported but truncated to seconds</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-779"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-779"><span class="linenos">779</span></a><span class="sd">            - When online=True, the city/nation parameters override lng/lat</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-780"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-780"><span class="linenos">780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-781"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-781"><span class="linenos">781</span></a>        <span class="c1"># Parse the ISO time</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-782"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-782"><span class="linenos">782</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_utc_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-783"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-783"><span class="linenos">783</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-784"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-784"><span class="linenos">784</span></a>        <span class="c1"># Get location data if online mode is enabled</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-785"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="n">online</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-786"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-786"><span class="linenos">786</span></a>            <span class="k">if</span> <span class="n">geonames_username</span> <span class="o">==</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-787"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-787"><span class="linenos">787</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_geonames_warning</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-788"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-788"><span class="linenos">788</span></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-789"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-789"><span class="linenos">789</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-790"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-790"><span class="linenos">790</span></a>            <span class="n">geonames</span> <span class="o">=</span> <span class="n">FetchGeonames</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-791"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-791"><span class="linenos">791</span></a>                <span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-792"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-792"><span class="linenos">792</span></a>                <span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-793"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-793"><span class="linenos">793</span></a>                <span class="n">username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-794"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-794"><span class="linenos">794</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-795"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-795"><span class="linenos">795</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-796"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-796"><span class="linenos">796</span></a>            <span class="n">city_data</span> <span class="o">=</span> <span class="n">geonames</span><span class="o">.</span><span class="n">get_serialized_data</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-797"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-797"><span class="linenos">797</span></a>            <span class="n">lng</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-798"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-798"><span class="linenos">798</span></a>            <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">])</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-799"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-799"><span class="linenos">799</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-800"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-800"><span class="linenos">800</span></a>        <span class="c1"># Convert UTC to local time</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-801"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-801"><span class="linenos">801</span></a>        <span class="n">local_time</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">tz_str</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-802"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-802"><span class="linenos">802</span></a>        <span class="n">local_datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">local_time</span><span class="p">)</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-803"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-803"><span class="linenos">803</span></a>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-804"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-804"><span class="linenos">804</span></a>        <span class="c1"># Create the subject with local time</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-805"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-805"><span class="linenos">805</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-806"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-806"><span class="linenos">806</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-807"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-807"><span class="linenos">807</span></a>            <span class="n">year</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-808"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-808"><span class="linenos">808</span></a>            <span class="n">month</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-809"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-809"><span class="linenos">809</span></a>            <span class="n">day</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-810"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-810"><span class="linenos">810</span></a>            <span class="n">hour</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-811"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-811"><span class="linenos">811</span></a>            <span class="n">minute</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-812"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-812"><span class="linenos">812</span></a>            <span class="n">seconds</span><span class="o">=</span><span class="n">local_datetime</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-813"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-813"><span class="linenos">813</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-814"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-814"><span class="linenos">814</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-815"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-815"><span class="linenos">815</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">lng</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-816"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-816"><span class="linenos">816</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-817"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-817"><span class="linenos">817</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-818"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-818"><span class="linenos">818</span></a>            <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Already fetched data if needed</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-819"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-819"><span class="linenos">819</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-820"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-820"><span class="linenos">820</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-821"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-821"><span class="linenos">821</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-822"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-822"><span class="linenos">822</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-823"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-823"><span class="linenos">823</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-824"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-824"><span class="linenos">824</span></a>            <span class="n">altitude</span><span class="o">=</span><span class="n">altitude</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-825"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-825"><span class="linenos">825</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-826"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-826"><span class="linenos">826</span></a>            <span class="n">calculate_lunar_phase</span><span class="o">=</span><span class="n">calculate_lunar_phase</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-827"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-827"><span class="linenos">827</span></a>            <span class="n">suppress_geonames_warning</span><span class="o">=</span><span class="n">suppress_geonames_warning</span>
</span><span id="AstrologicalSubjectFactory.from_iso_utc_time-828"><a href="#AstrologicalSubjectFactory.from_iso_utc_time-828"><span class="linenos">828</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an astrological subject from an ISO formatted UTC timestamp.</p>

<p>This method is ideal for creating astrological subjects from standardized
time formats, such as those stored in databases or received from APIs.
It automatically handles timezone conversion from UTC to the specified
local timezone.</p>

<p>Args:
    name (str): Name or identifier for the subject.
    iso_utc_time (str): ISO 8601 formatted UTC timestamp. Supported formats:
        - "2023-06-15T14:30:00Z" (with Z suffix)
        - "2023-06-15T14:30:00+00:00" (with UTC offset)
        - "2023-06-15T14:30:00.123Z" (with milliseconds)
    city (str, optional): City name for location. Defaults to "Greenwich".
    nation (str, optional): ISO country code. Defaults to "GB".
    tz_str (str, optional): IANA timezone identifier for result conversion.
        The ISO time is assumed to be in UTC and will be converted to this
        timezone. Defaults to "Etc/GMT".
    online (bool, optional): Whether to fetch coordinates online. If True,
        coordinates are fetched via GeoNames API. Defaults to True.
    lng (float, optional): Longitude in decimal degrees. Used when online=False
        or as fallback. Defaults to 0.0 (Greenwich).
    lat (float, optional): Latitude in decimal degrees. Used when online=False
        or as fallback. Defaults to 51.5074 (Greenwich).
    geonames_username (str, optional): GeoNames API username. Required when
        online=True. Defaults to DEFAULT_GEONAMES_USERNAME.
    zodiac_type (ZodiacType, optional): Zodiac system. Defaults to 'Tropical'.
    sidereal_mode (SiderealMode, optional): Sidereal mode when zodiac_type
        is 'Sidereal'. Defaults to None.
    houses_system_identifier (HousesSystemIdentifier, optional): House system.
        Defaults to 'P' (Placidus).
    perspective_type (PerspectiveType, optional): Calculation perspective.
        Defaults to 'Apparent Geocentric'.
    altitude (float, optional): Altitude in meters for topocentric calculations.
        Defaults to None (sea level).
    active_points (Optional[List[AstrologicalPoint]], optional): Points to calculate.
        If None, uses DEFAULT_ACTIVE_POINTS.
    calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.
        Defaults to True.</p>

<p>Returns:
    AstrologicalSubjectModel: Astrological subject with positions calculated
        for the specified UTC time converted to local timezone.</p>

<p>Raises:
    ValueError: If the ISO timestamp format is invalid or cannot be parsed.
    KerykeionException: If location data cannot be fetched or is invalid.</p>

<p>Examples:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="from-api-timestamp-with-online-location-lookup">From API timestamp with online location lookup</h1>
      
      <p>subject = <a href="#AstrologicalSubjectFactory.from_iso_utc_time">AstrologicalSubjectFactory.from_iso_utc_time</a>(
          ...     name="Event Chart",
          ...     iso_utc_time="2023-12-25T12:00:00Z",
          ...     city="Tokyo", nation="JP",
          ...     tz_str="Asia/Tokyo",
          ...     geonames_username="your_username"
          ... )</p>

<pre><code>&gt;&gt;&gt; # From database timestamp with manual coordinates
&gt;&gt;&gt; subject = <a href="#AstrologicalSubjectFactory.from_iso_utc_time">AstrologicalSubjectFactory.from_iso_utc_time</a>(
...     name="Historical Event",
...     iso_utc_time="1969-07-20T20:17:00Z",
...     lng=-95.0969, lat=37.4419,  # Houston
...     tz_str="America/Chicago",
...     online=False
... )
</code></pre>
      
      <p>Note:
          - The method assumes the input timestamp is in UTC
          - Local time conversion respects DST rules for the target timezone
          - Milliseconds in the timestamp are supported but truncated to seconds
          - When online=True, the city/nation parameters override lng/lat</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="AstrologicalSubjectFactory.from_current_time" class="classattr">
                                        <input id="AstrologicalSubjectFactory.from_current_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_current_time</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Now&#39;</span>,</span><span class="param">	<span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span> <span class="s1">&#39;Sidereal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tropical&#39;</span>,</span><span class="param">	<span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FAGAN_BRADLEY&#39;</span><span class="p">,</span> <span class="s1">&#39;LAHIRI&#39;</span><span class="p">,</span> <span class="s1">&#39;DELUCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMAN&#39;</span><span class="p">,</span> <span class="s1">&#39;USHASHASHI&#39;</span><span class="p">,</span> <span class="s1">&#39;KRISHNAMURTI&#39;</span><span class="p">,</span> <span class="s1">&#39;DJWHAL_KHUL&#39;</span><span class="p">,</span> <span class="s1">&#39;YUKTESHWAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JN_BHASIN&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER1&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER2&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER3&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_HUBER&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_ETPSC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALDEBARAN_15TAU&#39;</span><span class="p">,</span> <span class="s1">&#39;HIPPARCHOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SASSANIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;J2000&#39;</span><span class="p">,</span> <span class="s1">&#39;J1900&#39;</span><span class="p">,</span> <span class="s1">&#39;B1950&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span>,</span><span class="param">	<span class="n">perspective_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Apparent Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Heliocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Topocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;True Geocentric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Apparent Geocentric&#39;</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubjectFactory.from_current_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubjectFactory.from_current_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubjectFactory.from_current_time-830"><a href="#AstrologicalSubjectFactory.from_current_time-830"><span class="linenos">830</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-831"><a href="#AstrologicalSubjectFactory.from_current_time-831"><span class="linenos">831</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_current_time</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-832"><a href="#AstrologicalSubjectFactory.from_current_time-832"><span class="linenos">832</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-833"><a href="#AstrologicalSubjectFactory.from_current_time-833"><span class="linenos">833</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-834"><a href="#AstrologicalSubjectFactory.from_current_time-834"><span class="linenos">834</span></a>        <span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-835"><a href="#AstrologicalSubjectFactory.from_current_time-835"><span class="linenos">835</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-836"><a href="#AstrologicalSubjectFactory.from_current_time-836"><span class="linenos">836</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-837"><a href="#AstrologicalSubjectFactory.from_current_time-837"><span class="linenos">837</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-838"><a href="#AstrologicalSubjectFactory.from_current_time-838"><span class="linenos">838</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-839"><a href="#AstrologicalSubjectFactory.from_current_time-839"><span class="linenos">839</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-840"><a href="#AstrologicalSubjectFactory.from_current_time-840"><span class="linenos">840</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-841"><a href="#AstrologicalSubjectFactory.from_current_time-841"><span class="linenos">841</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-842"><a href="#AstrologicalSubjectFactory.from_current_time-842"><span class="linenos">842</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-843"><a href="#AstrologicalSubjectFactory.from_current_time-843"><span class="linenos">843</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-844"><a href="#AstrologicalSubjectFactory.from_current_time-844"><span class="linenos">844</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-845"><a href="#AstrologicalSubjectFactory.from_current_time-845"><span class="linenos">845</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-846"><a href="#AstrologicalSubjectFactory.from_current_time-846"><span class="linenos">846</span></a>        <span class="n">calculate_lunar_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-847"><a href="#AstrologicalSubjectFactory.from_current_time-847"><span class="linenos">847</span></a>        <span class="n">suppress_geonames_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-848"><a href="#AstrologicalSubjectFactory.from_current_time-848"><span class="linenos">848</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-849"><a href="#AstrologicalSubjectFactory.from_current_time-849"><span class="linenos">849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-850"><a href="#AstrologicalSubjectFactory.from_current_time-850"><span class="linenos">850</span></a><span class="sd">        Create an astrological subject for the current moment in time.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-851"><a href="#AstrologicalSubjectFactory.from_current_time-851"><span class="linenos">851</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-852"><a href="#AstrologicalSubjectFactory.from_current_time-852"><span class="linenos">852</span></a><span class="sd">        This convenience method creates a &quot;now&quot; chart, capturing the current</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-853"><a href="#AstrologicalSubjectFactory.from_current_time-853"><span class="linenos">853</span></a><span class="sd">        astrological conditions at the moment of execution. Useful for horary</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-854"><a href="#AstrologicalSubjectFactory.from_current_time-854"><span class="linenos">854</span></a><span class="sd">        astrology, electional astrology, or real-time astrological monitoring.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-855"><a href="#AstrologicalSubjectFactory.from_current_time-855"><span class="linenos">855</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-856"><a href="#AstrologicalSubjectFactory.from_current_time-856"><span class="linenos">856</span></a><span class="sd">        Args:</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-857"><a href="#AstrologicalSubjectFactory.from_current_time-857"><span class="linenos">857</span></a><span class="sd">            name (str, optional): Name for the current moment chart.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-858"><a href="#AstrologicalSubjectFactory.from_current_time-858"><span class="linenos">858</span></a><span class="sd">                Defaults to &quot;Now&quot;.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-859"><a href="#AstrologicalSubjectFactory.from_current_time-859"><span class="linenos">859</span></a><span class="sd">            city (str, optional): City name for location lookup. If not provided</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-860"><a href="#AstrologicalSubjectFactory.from_current_time-860"><span class="linenos">860</span></a><span class="sd">                and online=True, defaults to Greenwich.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-861"><a href="#AstrologicalSubjectFactory.from_current_time-861"><span class="linenos">861</span></a><span class="sd">            nation (str, optional): ISO country code. If not provided and</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-862"><a href="#AstrologicalSubjectFactory.from_current_time-862"><span class="linenos">862</span></a><span class="sd">                online=True, defaults to &#39;GB&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-863"><a href="#AstrologicalSubjectFactory.from_current_time-863"><span class="linenos">863</span></a><span class="sd">            lng (float, optional): Longitude in decimal degrees. If not provided</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-864"><a href="#AstrologicalSubjectFactory.from_current_time-864"><span class="linenos">864</span></a><span class="sd">                and online=True, fetched from GeoNames API.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-865"><a href="#AstrologicalSubjectFactory.from_current_time-865"><span class="linenos">865</span></a><span class="sd">            lat (float, optional): Latitude in decimal degrees. If not provided</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-866"><a href="#AstrologicalSubjectFactory.from_current_time-866"><span class="linenos">866</span></a><span class="sd">                and online=True, fetched from GeoNames API.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-867"><a href="#AstrologicalSubjectFactory.from_current_time-867"><span class="linenos">867</span></a><span class="sd">            tz_str (str, optional): IANA timezone identifier. If not provided</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-868"><a href="#AstrologicalSubjectFactory.from_current_time-868"><span class="linenos">868</span></a><span class="sd">                and online=True, fetched from GeoNames API.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-869"><a href="#AstrologicalSubjectFactory.from_current_time-869"><span class="linenos">869</span></a><span class="sd">            geonames_username (str, optional): GeoNames API username for location</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-870"><a href="#AstrologicalSubjectFactory.from_current_time-870"><span class="linenos">870</span></a><span class="sd">                lookup. Required when online=True and location is not fully specified.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-871"><a href="#AstrologicalSubjectFactory.from_current_time-871"><span class="linenos">871</span></a><span class="sd">            online (bool, optional): Whether to fetch location data online.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-872"><a href="#AstrologicalSubjectFactory.from_current_time-872"><span class="linenos">872</span></a><span class="sd">                Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-873"><a href="#AstrologicalSubjectFactory.from_current_time-873"><span class="linenos">873</span></a><span class="sd">            zodiac_type (ZodiacType, optional): Zodiac system to use.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-874"><a href="#AstrologicalSubjectFactory.from_current_time-874"><span class="linenos">874</span></a><span class="sd">                Defaults to &#39;Tropical&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-875"><a href="#AstrologicalSubjectFactory.from_current_time-875"><span class="linenos">875</span></a><span class="sd">            sidereal_mode (SiderealMode, optional): Sidereal calculation mode.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-876"><a href="#AstrologicalSubjectFactory.from_current_time-876"><span class="linenos">876</span></a><span class="sd">                Only used when zodiac_type is &#39;Sidereal&#39;. Defaults to None.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-877"><a href="#AstrologicalSubjectFactory.from_current_time-877"><span class="linenos">877</span></a><span class="sd">            houses_system_identifier (HousesSystemIdentifier, optional): House</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-878"><a href="#AstrologicalSubjectFactory.from_current_time-878"><span class="linenos">878</span></a><span class="sd">                system for calculations. Defaults to &#39;P&#39; (Placidus).</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-879"><a href="#AstrologicalSubjectFactory.from_current_time-879"><span class="linenos">879</span></a><span class="sd">            perspective_type (PerspectiveType, optional): Calculation perspective.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-880"><a href="#AstrologicalSubjectFactory.from_current_time-880"><span class="linenos">880</span></a><span class="sd">                Defaults to &#39;Apparent Geocentric&#39;.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-881"><a href="#AstrologicalSubjectFactory.from_current_time-881"><span class="linenos">881</span></a><span class="sd">            active_points (Optional[List[AstrologicalPoint]], optional): Astrological points</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-882"><a href="#AstrologicalSubjectFactory.from_current_time-882"><span class="linenos">882</span></a><span class="sd">                to calculate. If None, uses DEFAULT_ACTIVE_POINTS.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-883"><a href="#AstrologicalSubjectFactory.from_current_time-883"><span class="linenos">883</span></a><span class="sd">            calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-884"><a href="#AstrologicalSubjectFactory.from_current_time-884"><span class="linenos">884</span></a><span class="sd">                Defaults to True.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-885"><a href="#AstrologicalSubjectFactory.from_current_time-885"><span class="linenos">885</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-886"><a href="#AstrologicalSubjectFactory.from_current_time-886"><span class="linenos">886</span></a><span class="sd">        Returns:</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-887"><a href="#AstrologicalSubjectFactory.from_current_time-887"><span class="linenos">887</span></a><span class="sd">            AstrologicalSubjectModel: Astrological subject representing current</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-888"><a href="#AstrologicalSubjectFactory.from_current_time-888"><span class="linenos">888</span></a><span class="sd">                astrological conditions at the specified or default location.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-889"><a href="#AstrologicalSubjectFactory.from_current_time-889"><span class="linenos">889</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-890"><a href="#AstrologicalSubjectFactory.from_current_time-890"><span class="linenos">890</span></a><span class="sd">        Raises:</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-891"><a href="#AstrologicalSubjectFactory.from_current_time-891"><span class="linenos">891</span></a><span class="sd">            KerykeionException: If online location lookup fails or if offline mode</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-892"><a href="#AstrologicalSubjectFactory.from_current_time-892"><span class="linenos">892</span></a><span class="sd">                is used without sufficient location data.</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-893"><a href="#AstrologicalSubjectFactory.from_current_time-893"><span class="linenos">893</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-894"><a href="#AstrologicalSubjectFactory.from_current_time-894"><span class="linenos">894</span></a><span class="sd">        Examples:</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-895"><a href="#AstrologicalSubjectFactory.from_current_time-895"><span class="linenos">895</span></a><span class="sd">            &gt;&gt;&gt; # Current moment for your location</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-896"><a href="#AstrologicalSubjectFactory.from_current_time-896"><span class="linenos">896</span></a><span class="sd">            &gt;&gt;&gt; now_chart = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-897"><a href="#AstrologicalSubjectFactory.from_current_time-897"><span class="linenos">897</span></a><span class="sd">            ...     name=&quot;Current Transits&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-898"><a href="#AstrologicalSubjectFactory.from_current_time-898"><span class="linenos">898</span></a><span class="sd">            ...     city=&quot;New York&quot;, nation=&quot;US&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-899"><a href="#AstrologicalSubjectFactory.from_current_time-899"><span class="linenos">899</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-900"><a href="#AstrologicalSubjectFactory.from_current_time-900"><span class="linenos">900</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-901"><a href="#AstrologicalSubjectFactory.from_current_time-901"><span class="linenos">901</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-902"><a href="#AstrologicalSubjectFactory.from_current_time-902"><span class="linenos">902</span></a><span class="sd">            &gt;&gt;&gt; # Horary chart with specific coordinates</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-903"><a href="#AstrologicalSubjectFactory.from_current_time-903"><span class="linenos">903</span></a><span class="sd">            &gt;&gt;&gt; horary = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-904"><a href="#AstrologicalSubjectFactory.from_current_time-904"><span class="linenos">904</span></a><span class="sd">            ...     name=&quot;Horary Question&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-905"><a href="#AstrologicalSubjectFactory.from_current_time-905"><span class="linenos">905</span></a><span class="sd">            ...     lng=-0.1278, lat=51.5074,  # London</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-906"><a href="#AstrologicalSubjectFactory.from_current_time-906"><span class="linenos">906</span></a><span class="sd">            ...     tz_str=&quot;Europe/London&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-907"><a href="#AstrologicalSubjectFactory.from_current_time-907"><span class="linenos">907</span></a><span class="sd">            ...     online=False</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-908"><a href="#AstrologicalSubjectFactory.from_current_time-908"><span class="linenos">908</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-909"><a href="#AstrologicalSubjectFactory.from_current_time-909"><span class="linenos">909</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-910"><a href="#AstrologicalSubjectFactory.from_current_time-910"><span class="linenos">910</span></a><span class="sd">            &gt;&gt;&gt; # Current sidereal positions</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-911"><a href="#AstrologicalSubjectFactory.from_current_time-911"><span class="linenos">911</span></a><span class="sd">            &gt;&gt;&gt; sidereal_now = AstrologicalSubjectFactory.from_current_time(</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-912"><a href="#AstrologicalSubjectFactory.from_current_time-912"><span class="linenos">912</span></a><span class="sd">            ...     name=&quot;Sidereal Now&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-913"><a href="#AstrologicalSubjectFactory.from_current_time-913"><span class="linenos">913</span></a><span class="sd">            ...     city=&quot;Mumbai&quot;, nation=&quot;IN&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-914"><a href="#AstrologicalSubjectFactory.from_current_time-914"><span class="linenos">914</span></a><span class="sd">            ...     zodiac_type=&quot;Sidereal&quot;,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-915"><a href="#AstrologicalSubjectFactory.from_current_time-915"><span class="linenos">915</span></a><span class="sd">            ...     sidereal_mode=&quot;LAHIRI&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-916"><a href="#AstrologicalSubjectFactory.from_current_time-916"><span class="linenos">916</span></a><span class="sd">            ... )</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-917"><a href="#AstrologicalSubjectFactory.from_current_time-917"><span class="linenos">917</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-918"><a href="#AstrologicalSubjectFactory.from_current_time-918"><span class="linenos">918</span></a><span class="sd">        Note:</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-919"><a href="#AstrologicalSubjectFactory.from_current_time-919"><span class="linenos">919</span></a><span class="sd">            - The exact time is captured at method execution, including seconds</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-920"><a href="#AstrologicalSubjectFactory.from_current_time-920"><span class="linenos">920</span></a><span class="sd">            - For horary astrology, consider the moment of understanding the question</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-921"><a href="#AstrologicalSubjectFactory.from_current_time-921"><span class="linenos">921</span></a><span class="sd">            - System clock accuracy affects precision; ensure accurate system time</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-922"><a href="#AstrologicalSubjectFactory.from_current_time-922"><span class="linenos">922</span></a><span class="sd">            - Time zone detection is automatic when using online location lookup</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-923"><a href="#AstrologicalSubjectFactory.from_current_time-923"><span class="linenos">923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-924"><a href="#AstrologicalSubjectFactory.from_current_time-924"><span class="linenos">924</span></a>        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-925"><a href="#AstrologicalSubjectFactory.from_current_time-925"><span class="linenos">925</span></a>
</span><span id="AstrologicalSubjectFactory.from_current_time-926"><a href="#AstrologicalSubjectFactory.from_current_time-926"><span class="linenos">926</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-927"><a href="#AstrologicalSubjectFactory.from_current_time-927"><span class="linenos">927</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-928"><a href="#AstrologicalSubjectFactory.from_current_time-928"><span class="linenos">928</span></a>            <span class="n">year</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-929"><a href="#AstrologicalSubjectFactory.from_current_time-929"><span class="linenos">929</span></a>            <span class="n">month</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-930"><a href="#AstrologicalSubjectFactory.from_current_time-930"><span class="linenos">930</span></a>            <span class="n">day</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-931"><a href="#AstrologicalSubjectFactory.from_current_time-931"><span class="linenos">931</span></a>            <span class="n">hour</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-932"><a href="#AstrologicalSubjectFactory.from_current_time-932"><span class="linenos">932</span></a>            <span class="n">minute</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-933"><a href="#AstrologicalSubjectFactory.from_current_time-933"><span class="linenos">933</span></a>            <span class="n">seconds</span><span class="o">=</span><span class="n">now</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-934"><a href="#AstrologicalSubjectFactory.from_current_time-934"><span class="linenos">934</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-935"><a href="#AstrologicalSubjectFactory.from_current_time-935"><span class="linenos">935</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-936"><a href="#AstrologicalSubjectFactory.from_current_time-936"><span class="linenos">936</span></a>            <span class="n">lng</span><span class="o">=</span><span class="n">lng</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-937"><a href="#AstrologicalSubjectFactory.from_current_time-937"><span class="linenos">937</span></a>            <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-938"><a href="#AstrologicalSubjectFactory.from_current_time-938"><span class="linenos">938</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-939"><a href="#AstrologicalSubjectFactory.from_current_time-939"><span class="linenos">939</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-940"><a href="#AstrologicalSubjectFactory.from_current_time-940"><span class="linenos">940</span></a>            <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-941"><a href="#AstrologicalSubjectFactory.from_current_time-941"><span class="linenos">941</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-942"><a href="#AstrologicalSubjectFactory.from_current_time-942"><span class="linenos">942</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-943"><a href="#AstrologicalSubjectFactory.from_current_time-943"><span class="linenos">943</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-944"><a href="#AstrologicalSubjectFactory.from_current_time-944"><span class="linenos">944</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-945"><a href="#AstrologicalSubjectFactory.from_current_time-945"><span class="linenos">945</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-946"><a href="#AstrologicalSubjectFactory.from_current_time-946"><span class="linenos">946</span></a>            <span class="n">calculate_lunar_phase</span><span class="o">=</span><span class="n">calculate_lunar_phase</span><span class="p">,</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-947"><a href="#AstrologicalSubjectFactory.from_current_time-947"><span class="linenos">947</span></a>            <span class="n">suppress_geonames_warning</span><span class="o">=</span><span class="n">suppress_geonames_warning</span>
</span><span id="AstrologicalSubjectFactory.from_current_time-948"><a href="#AstrologicalSubjectFactory.from_current_time-948"><span class="linenos">948</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an astrological subject for the current moment in time.</p>

<p>This convenience method creates a "now" chart, capturing the current
astrological conditions at the moment of execution. Useful for horary
astrology, electional astrology, or real-time astrological monitoring.</p>

<p>Args:
    name (str, optional): Name for the current moment chart.
        Defaults to "Now".
    city (str, optional): City name for location lookup. If not provided
        and online=True, defaults to Greenwich.
    nation (str, optional): ISO country code. If not provided and
        online=True, defaults to 'GB'.
    lng (float, optional): Longitude in decimal degrees. If not provided
        and online=True, fetched from GeoNames API.
    lat (float, optional): Latitude in decimal degrees. If not provided
        and online=True, fetched from GeoNames API.
    tz_str (str, optional): IANA timezone identifier. If not provided
        and online=True, fetched from GeoNames API.
    geonames_username (str, optional): GeoNames API username for location
        lookup. Required when online=True and location is not fully specified.
    online (bool, optional): Whether to fetch location data online.
        Defaults to True.
    zodiac_type (ZodiacType, optional): Zodiac system to use.
        Defaults to 'Tropical'.
    sidereal_mode (SiderealMode, optional): Sidereal calculation mode.
        Only used when zodiac_type is 'Sidereal'. Defaults to None.
    houses_system_identifier (HousesSystemIdentifier, optional): House
        system for calculations. Defaults to 'P' (Placidus).
    perspective_type (PerspectiveType, optional): Calculation perspective.
        Defaults to 'Apparent Geocentric'.
    active_points (Optional[List[AstrologicalPoint]], optional): Astrological points
        to calculate. If None, uses DEFAULT_ACTIVE_POINTS.
    calculate_lunar_phase (bool, optional): Whether to calculate lunar phase.
        Defaults to True.</p>

<p>Returns:
    AstrologicalSubjectModel: Astrological subject representing current
        astrological conditions at the specified or default location.</p>

<p>Raises:
    KerykeionException: If online location lookup fails or if offline mode
        is used without sufficient location data.</p>

<p>Examples:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="current-moment-for-your-location">Current moment for your location</h1>
      
      <p>now_chart = <a href="#AstrologicalSubjectFactory.from_current_time">AstrologicalSubjectFactory.from_current_time</a>(
          ...     name="Current Transits",
          ...     city="New York", nation="US",
          ...     geonames_username="your_username"
          ... )</p>

<pre><code>&gt;&gt;&gt; # Horary chart with specific coordinates
&gt;&gt;&gt; horary = <a href="#AstrologicalSubjectFactory.from_current_time">AstrologicalSubjectFactory.from_current_time</a>(
...     name="Horary Question",
...     lng=-0.1278, lat=51.5074,  # London
...     tz_str="Europe/London",
...     online=False
... )

&gt;&gt;&gt; # Current sidereal positions
&gt;&gt;&gt; sidereal_now = <a href="#AstrologicalSubjectFactory.from_current_time">AstrologicalSubjectFactory.from_current_time</a>(
...     name="Sidereal Now",
...     city="Mumbai", nation="IN",
...     zodiac_type="Sidereal",
...     sidereal_mode="LAHIRI"
... )
</code></pre>
      
      <p>Note:
          - The exact time is captured at method execution, including seconds
          - For horary astrology, consider the moment of understanding the question
          - System clock accuracy affects precision; ensure accurate system time
          - Time zone detection is automatic when using online location lookup</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                </section>
                <section id="ChartDataFactory">
                            <input id="ChartDataFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ChartDataFactory</span>:

                <label class="view-source-button" for="ChartDataFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory-72"><a href="#ChartDataFactory-72"><span class="linenos"> 72</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChartDataFactory</span><span class="p">:</span>
</span><span id="ChartDataFactory-73"><a href="#ChartDataFactory-73"><span class="linenos"> 73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-74"><a href="#ChartDataFactory-74"><span class="linenos"> 74</span></a><span class="sd">    Factory class for creating comprehensive chart data models.</span>
</span><span id="ChartDataFactory-75"><a href="#ChartDataFactory-75"><span class="linenos"> 75</span></a>
</span><span id="ChartDataFactory-76"><a href="#ChartDataFactory-76"><span class="linenos"> 76</span></a><span class="sd">    This factory creates ChartDataModel instances containing all the pure data</span>
</span><span id="ChartDataFactory-77"><a href="#ChartDataFactory-77"><span class="linenos"> 77</span></a><span class="sd">    from astrological charts, including subjects, aspects, house comparisons,</span>
</span><span id="ChartDataFactory-78"><a href="#ChartDataFactory-78"><span class="linenos"> 78</span></a><span class="sd">    and analytical metrics. It provides the structured data equivalent of</span>
</span><span id="ChartDataFactory-79"><a href="#ChartDataFactory-79"><span class="linenos"> 79</span></a><span class="sd">    ChartDrawer&#39;s visual output.</span>
</span><span id="ChartDataFactory-80"><a href="#ChartDataFactory-80"><span class="linenos"> 80</span></a>
</span><span id="ChartDataFactory-81"><a href="#ChartDataFactory-81"><span class="linenos"> 81</span></a><span class="sd">    The factory handles all chart types and automatically includes relevant</span>
</span><span id="ChartDataFactory-82"><a href="#ChartDataFactory-82"><span class="linenos"> 82</span></a><span class="sd">    analyses based on chart type (e.g., house comparison for dual charts,</span>
</span><span id="ChartDataFactory-83"><a href="#ChartDataFactory-83"><span class="linenos"> 83</span></a><span class="sd">    relationship scoring for synastry charts).</span>
</span><span id="ChartDataFactory-84"><a href="#ChartDataFactory-84"><span class="linenos"> 84</span></a>
</span><span id="ChartDataFactory-85"><a href="#ChartDataFactory-85"><span class="linenos"> 85</span></a><span class="sd">    Example:</span>
</span><span id="ChartDataFactory-86"><a href="#ChartDataFactory-86"><span class="linenos"> 86</span></a><span class="sd">        &gt;&gt;&gt; # Create natal chart data</span>
</span><span id="ChartDataFactory-87"><a href="#ChartDataFactory-87"><span class="linenos"> 87</span></a><span class="sd">        &gt;&gt;&gt; john = AstrologicalSubjectFactory.from_birth_data(&quot;John&quot;, 1990, 1, 1, 12, 0, &quot;London&quot;, &quot;GB&quot;)</span>
</span><span id="ChartDataFactory-88"><a href="#ChartDataFactory-88"><span class="linenos"> 88</span></a><span class="sd">        &gt;&gt;&gt; natal_data = ChartDataFactory.create_chart_data(&quot;Natal&quot;, john)</span>
</span><span id="ChartDataFactory-89"><a href="#ChartDataFactory-89"><span class="linenos"> 89</span></a><span class="sd">        &gt;&gt;&gt; print(f&quot;Elements: Fire {natal_data.element_distribution.fire_percentage}%&quot;)</span>
</span><span id="ChartDataFactory-90"><a href="#ChartDataFactory-90"><span class="linenos"> 90</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="ChartDataFactory-91"><a href="#ChartDataFactory-91"><span class="linenos"> 91</span></a><span class="sd">        &gt;&gt;&gt; # Create synastry chart data</span>
</span><span id="ChartDataFactory-92"><a href="#ChartDataFactory-92"><span class="linenos"> 92</span></a><span class="sd">        &gt;&gt;&gt; jane = AstrologicalSubjectFactory.from_birth_data(&quot;Jane&quot;, 1992, 6, 15, 14, 30, &quot;Paris&quot;, &quot;FR&quot;)</span>
</span><span id="ChartDataFactory-93"><a href="#ChartDataFactory-93"><span class="linenos"> 93</span></a><span class="sd">        &gt;&gt;&gt; synastry_data = ChartDataFactory.create_chart_data(&quot;Synastry&quot;, john, jane)</span>
</span><span id="ChartDataFactory-94"><a href="#ChartDataFactory-94"><span class="linenos"> 94</span></a><span class="sd">        &gt;&gt;&gt; print(f&quot;Relationship score: {synastry_data.relationship_score.score_value}&quot;)</span>
</span><span id="ChartDataFactory-95"><a href="#ChartDataFactory-95"><span class="linenos"> 95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-96"><a href="#ChartDataFactory-96"><span class="linenos"> 96</span></a>
</span><span id="ChartDataFactory-97"><a href="#ChartDataFactory-97"><span class="linenos"> 97</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-98"><a href="#ChartDataFactory-98"><span class="linenos"> 98</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-99"><a href="#ChartDataFactory-99"><span class="linenos"> 99</span></a>        <span class="n">chart_type</span><span class="p">:</span> <span class="n">ChartType</span><span class="p">,</span>
</span><span id="ChartDataFactory-100"><a href="#ChartDataFactory-100"><span class="linenos">100</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="ChartDataFactory-101"><a href="#ChartDataFactory-101"><span class="linenos">101</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-102"><a href="#ChartDataFactory-102"><span class="linenos">102</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-103"><a href="#ChartDataFactory-103"><span class="linenos">103</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-104"><a href="#ChartDataFactory-104"><span class="linenos">104</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory-105"><a href="#ChartDataFactory-105"><span class="linenos">105</span></a>        <span class="n">include_relationship_score</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDataFactory-106"><a href="#ChartDataFactory-106"><span class="linenos">106</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-107"><a href="#ChartDataFactory-107"><span class="linenos">107</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-108"><a href="#ChartDataFactory-108"><span class="linenos">108</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-109"><a href="#ChartDataFactory-109"><span class="linenos">109</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-110"><a href="#ChartDataFactory-110"><span class="linenos">110</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-111"><a href="#ChartDataFactory-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-112"><a href="#ChartDataFactory-112"><span class="linenos">112</span></a><span class="sd">        Create comprehensive chart data for the specified chart type.</span>
</span><span id="ChartDataFactory-113"><a href="#ChartDataFactory-113"><span class="linenos">113</span></a>
</span><span id="ChartDataFactory-114"><a href="#ChartDataFactory-114"><span class="linenos">114</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-115"><a href="#ChartDataFactory-115"><span class="linenos">115</span></a><span class="sd">            chart_type: Type of chart to create data for</span>
</span><span id="ChartDataFactory-116"><a href="#ChartDataFactory-116"><span class="linenos">116</span></a><span class="sd">            first_subject: Primary astrological subject</span>
</span><span id="ChartDataFactory-117"><a href="#ChartDataFactory-117"><span class="linenos">117</span></a><span class="sd">            second_subject: Secondary subject (required for dual charts)</span>
</span><span id="ChartDataFactory-118"><a href="#ChartDataFactory-118"><span class="linenos">118</span></a><span class="sd">            active_points: Points to include in calculations (defaults to first_subject.active_points)</span>
</span><span id="ChartDataFactory-119"><a href="#ChartDataFactory-119"><span class="linenos">119</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-120"><a href="#ChartDataFactory-120"><span class="linenos">120</span></a><span class="sd">            include_house_comparison: Whether to include house comparison for dual charts</span>
</span><span id="ChartDataFactory-121"><a href="#ChartDataFactory-121"><span class="linenos">121</span></a><span class="sd">            include_relationship_score: Whether to include relationship scoring for synastry</span>
</span><span id="ChartDataFactory-122"><a href="#ChartDataFactory-122"><span class="linenos">122</span></a><span class="sd">            axis_orb_limit: Optional orb threshold for chart axes (applies only to single chart aspects)</span>
</span><span id="ChartDataFactory-123"><a href="#ChartDataFactory-123"><span class="linenos">123</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting (&quot;pure_count&quot; or &quot;weighted&quot;)</span>
</span><span id="ChartDataFactory-124"><a href="#ChartDataFactory-124"><span class="linenos">124</span></a><span class="sd">            custom_distribution_weights: Optional overrides for the distribution weights</span>
</span><span id="ChartDataFactory-125"><a href="#ChartDataFactory-125"><span class="linenos">125</span></a>
</span><span id="ChartDataFactory-126"><a href="#ChartDataFactory-126"><span class="linenos">126</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-127"><a href="#ChartDataFactory-127"><span class="linenos">127</span></a><span class="sd">            ChartDataModel: Comprehensive chart data model</span>
</span><span id="ChartDataFactory-128"><a href="#ChartDataFactory-128"><span class="linenos">128</span></a>
</span><span id="ChartDataFactory-129"><a href="#ChartDataFactory-129"><span class="linenos">129</span></a><span class="sd">        Raises:</span>
</span><span id="ChartDataFactory-130"><a href="#ChartDataFactory-130"><span class="linenos">130</span></a><span class="sd">            KerykeionException: If chart type requirements are not met</span>
</span><span id="ChartDataFactory-131"><a href="#ChartDataFactory-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-132"><a href="#ChartDataFactory-132"><span class="linenos">132</span></a>
</span><span id="ChartDataFactory-133"><a href="#ChartDataFactory-133"><span class="linenos">133</span></a>        <span class="c1"># Validate chart type requirements</span>
</span><span id="ChartDataFactory-134"><a href="#ChartDataFactory-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory-135"><a href="#ChartDataFactory-135"><span class="linenos">135</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second subject is required for </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory-136"><a href="#ChartDataFactory-136"><span class="linenos">136</span></a>
</span><span id="ChartDataFactory-137"><a href="#ChartDataFactory-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="ChartDataFactory-138"><a href="#ChartDataFactory-138"><span class="linenos">138</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;First subject must be a CompositeSubjectModel for Composite charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory-139"><a href="#ChartDataFactory-139"><span class="linenos">139</span></a>
</span><span id="ChartDataFactory-140"><a href="#ChartDataFactory-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Return&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">):</span>
</span><span id="ChartDataFactory-141"><a href="#ChartDataFactory-141"><span class="linenos">141</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Second subject must be a PlanetReturnModel for Return charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory-142"><a href="#ChartDataFactory-142"><span class="linenos">142</span></a>
</span><span id="ChartDataFactory-143"><a href="#ChartDataFactory-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">):</span>
</span><span id="ChartDataFactory-144"><a href="#ChartDataFactory-144"><span class="linenos">144</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;First subject must be a PlanetReturnModel for SingleReturnChart charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory-145"><a href="#ChartDataFactory-145"><span class="linenos">145</span></a>
</span><span id="ChartDataFactory-146"><a href="#ChartDataFactory-146"><span class="linenos">146</span></a>        <span class="c1"># Determine active points</span>
</span><span id="ChartDataFactory-147"><a href="#ChartDataFactory-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="ChartDataFactory-148"><a href="#ChartDataFactory-148"><span class="linenos">148</span></a>            <span class="n">effective_active_points</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDataFactory-149"><a href="#ChartDataFactory-149"><span class="linenos">149</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory-150"><a href="#ChartDataFactory-150"><span class="linenos">150</span></a>            <span class="n">effective_active_points</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-151"><a href="#ChartDataFactory-151"><span class="linenos">151</span></a>                <span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-152"><a href="#ChartDataFactory-152"><span class="linenos">152</span></a>                <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDataFactory-153"><a href="#ChartDataFactory-153"><span class="linenos">153</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-154"><a href="#ChartDataFactory-154"><span class="linenos">154</span></a>
</span><span id="ChartDataFactory-155"><a href="#ChartDataFactory-155"><span class="linenos">155</span></a>        <span class="c1"># For dual charts, further filter by second subject&#39;s active points</span>
</span><span id="ChartDataFactory-156"><a href="#ChartDataFactory-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory-157"><a href="#ChartDataFactory-157"><span class="linenos">157</span></a>            <span class="n">effective_active_points</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-158"><a href="#ChartDataFactory-158"><span class="linenos">158</span></a>                <span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-159"><a href="#ChartDataFactory-159"><span class="linenos">159</span></a>                <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDataFactory-160"><a href="#ChartDataFactory-160"><span class="linenos">160</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-161"><a href="#ChartDataFactory-161"><span class="linenos">161</span></a>
</span><span id="ChartDataFactory-162"><a href="#ChartDataFactory-162"><span class="linenos">162</span></a>        <span class="c1"># Calculate aspects based on chart type</span>
</span><span id="ChartDataFactory-163"><a href="#ChartDataFactory-163"><span class="linenos">163</span></a>        <span class="n">aspects_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SingleChartAspectsModel</span><span class="p">,</span> <span class="n">DualChartAspectsModel</span><span class="p">]</span>
</span><span id="ChartDataFactory-164"><a href="#ChartDataFactory-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDataFactory-165"><a href="#ChartDataFactory-165"><span class="linenos">165</span></a>            <span class="c1"># Single chart aspects</span>
</span><span id="ChartDataFactory-166"><a href="#ChartDataFactory-166"><span class="linenos">166</span></a>            <span class="n">aspects_model</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">single_chart_aspects</span><span class="p">(</span>
</span><span id="ChartDataFactory-167"><a href="#ChartDataFactory-167"><span class="linenos">167</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-168"><a href="#ChartDataFactory-168"><span class="linenos">168</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-169"><a href="#ChartDataFactory-169"><span class="linenos">169</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-170"><a href="#ChartDataFactory-170"><span class="linenos">170</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="ChartDataFactory-171"><a href="#ChartDataFactory-171"><span class="linenos">171</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-172"><a href="#ChartDataFactory-172"><span class="linenos">172</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory-173"><a href="#ChartDataFactory-173"><span class="linenos">173</span></a>            <span class="c1"># Dual chart aspects - second_subject is guaranteed to exist here due to validation above</span>
</span><span id="ChartDataFactory-174"><a href="#ChartDataFactory-174"><span class="linenos">174</span></a>            <span class="k">if</span> <span class="n">second_subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDataFactory-175"><a href="#ChartDataFactory-175"><span class="linenos">175</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second subject is required for </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory-176"><a href="#ChartDataFactory-176"><span class="linenos">176</span></a>
</span><span id="ChartDataFactory-177"><a href="#ChartDataFactory-177"><span class="linenos">177</span></a>            <span class="c1"># Determine if subjects are fixed based on chart type</span>
</span><span id="ChartDataFactory-178"><a href="#ChartDataFactory-178"><span class="linenos">178</span></a>            <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ChartDataFactory-179"><a href="#ChartDataFactory-179"><span class="linenos">179</span></a>            <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ChartDataFactory-180"><a href="#ChartDataFactory-180"><span class="linenos">180</span></a>
</span><span id="ChartDataFactory-181"><a href="#ChartDataFactory-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDataFactory-182"><a href="#ChartDataFactory-182"><span class="linenos">182</span></a>                <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDataFactory-183"><a href="#ChartDataFactory-183"><span class="linenos">183</span></a>                <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDataFactory-184"><a href="#ChartDataFactory-184"><span class="linenos">184</span></a>            <span class="k">elif</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDataFactory-185"><a href="#ChartDataFactory-185"><span class="linenos">185</span></a>                <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Natal chart is fixed</span>
</span><span id="ChartDataFactory-186"><a href="#ChartDataFactory-186"><span class="linenos">186</span></a>                <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Transit chart is moving</span>
</span><span id="ChartDataFactory-187"><a href="#ChartDataFactory-187"><span class="linenos">187</span></a>            <span class="k">elif</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDataFactory-188"><a href="#ChartDataFactory-188"><span class="linenos">188</span></a>                <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Natal chart is fixed</span>
</span><span id="ChartDataFactory-189"><a href="#ChartDataFactory-189"><span class="linenos">189</span></a>                <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Return chart is moving (like transits)</span>
</span><span id="ChartDataFactory-190"><a href="#ChartDataFactory-190"><span class="linenos">190</span></a>
</span><span id="ChartDataFactory-191"><a href="#ChartDataFactory-191"><span class="linenos">191</span></a>            <span class="n">aspects_model</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="ChartDataFactory-192"><a href="#ChartDataFactory-192"><span class="linenos">192</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-193"><a href="#ChartDataFactory-193"><span class="linenos">193</span></a>                <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-194"><a href="#ChartDataFactory-194"><span class="linenos">194</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-195"><a href="#ChartDataFactory-195"><span class="linenos">195</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-196"><a href="#ChartDataFactory-196"><span class="linenos">196</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="ChartDataFactory-197"><a href="#ChartDataFactory-197"><span class="linenos">197</span></a>                <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="n">first_subject_is_fixed</span><span class="p">,</span>
</span><span id="ChartDataFactory-198"><a href="#ChartDataFactory-198"><span class="linenos">198</span></a>                <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="n">second_subject_is_fixed</span><span class="p">,</span>
</span><span id="ChartDataFactory-199"><a href="#ChartDataFactory-199"><span class="linenos">199</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-200"><a href="#ChartDataFactory-200"><span class="linenos">200</span></a>
</span><span id="ChartDataFactory-201"><a href="#ChartDataFactory-201"><span class="linenos">201</span></a>        <span class="c1"># Calculate house comparison for dual charts</span>
</span><span id="ChartDataFactory-202"><a href="#ChartDataFactory-202"><span class="linenos">202</span></a>        <span class="n">house_comparison</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChartDataFactory-203"><a href="#ChartDataFactory-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="n">second_subject</span> <span class="ow">and</span> <span class="n">include_house_comparison</span> <span class="ow">and</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDataFactory-204"><a href="#ChartDataFactory-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)):</span>
</span><span id="ChartDataFactory-205"><a href="#ChartDataFactory-205"><span class="linenos">205</span></a>                <span class="n">house_comparison_factory</span> <span class="o">=</span> <span class="n">HouseComparisonFactory</span><span class="p">(</span>
</span><span id="ChartDataFactory-206"><a href="#ChartDataFactory-206"><span class="linenos">206</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-207"><a href="#ChartDataFactory-207"><span class="linenos">207</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-208"><a href="#ChartDataFactory-208"><span class="linenos">208</span></a>                    <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span>
</span><span id="ChartDataFactory-209"><a href="#ChartDataFactory-209"><span class="linenos">209</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory-210"><a href="#ChartDataFactory-210"><span class="linenos">210</span></a>                <span class="n">house_comparison</span> <span class="o">=</span> <span class="n">house_comparison_factory</span><span class="o">.</span><span class="n">get_house_comparison</span><span class="p">()</span>
</span><span id="ChartDataFactory-211"><a href="#ChartDataFactory-211"><span class="linenos">211</span></a>
</span><span id="ChartDataFactory-212"><a href="#ChartDataFactory-212"><span class="linenos">212</span></a>        <span class="c1"># Calculate relationship score for synastry</span>
</span><span id="ChartDataFactory-213"><a href="#ChartDataFactory-213"><span class="linenos">213</span></a>        <span class="n">relationship_score</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChartDataFactory-214"><a href="#ChartDataFactory-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span> <span class="ow">and</span> <span class="n">include_relationship_score</span> <span class="ow">and</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory-215"><a href="#ChartDataFactory-215"><span class="linenos">215</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ChartDataFactory-216"><a href="#ChartDataFactory-216"><span class="linenos">216</span></a>                <span class="n">relationship_score_factory</span> <span class="o">=</span> <span class="n">RelationshipScoreFactory</span><span class="p">(</span>
</span><span id="ChartDataFactory-217"><a href="#ChartDataFactory-217"><span class="linenos">217</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-218"><a href="#ChartDataFactory-218"><span class="linenos">218</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-219"><a href="#ChartDataFactory-219"><span class="linenos">219</span></a>                    <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="ChartDataFactory-220"><a href="#ChartDataFactory-220"><span class="linenos">220</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory-221"><a href="#ChartDataFactory-221"><span class="linenos">221</span></a>                <span class="n">relationship_score</span> <span class="o">=</span> <span class="n">relationship_score_factory</span><span class="o">.</span><span class="n">get_relationship_score</span><span class="p">()</span>
</span><span id="ChartDataFactory-222"><a href="#ChartDataFactory-222"><span class="linenos">222</span></a>
</span><span id="ChartDataFactory-223"><a href="#ChartDataFactory-223"><span class="linenos">223</span></a>        <span class="c1"># Calculate element and quality distributions</span>
</span><span id="ChartDataFactory-224"><a href="#ChartDataFactory-224"><span class="linenos">224</span></a>        <span class="n">available_planets_setting_dicts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDataFactory-225"><a href="#ChartDataFactory-225"><span class="linenos">225</span></a>        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span><span class="p">:</span>
</span><span id="ChartDataFactory-226"><a href="#ChartDataFactory-226"><span class="linenos">226</span></a>            <span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">effective_active_points</span><span class="p">:</span>
</span><span id="ChartDataFactory-227"><a href="#ChartDataFactory-227"><span class="linenos">227</span></a>                <span class="n">body_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="ChartDataFactory-228"><a href="#ChartDataFactory-228"><span class="linenos">228</span></a>                <span class="n">body_dict</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDataFactory-229"><a href="#ChartDataFactory-229"><span class="linenos">229</span></a>                <span class="n">available_planets_setting_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body_dict</span><span class="p">)</span>
</span><span id="ChartDataFactory-230"><a href="#ChartDataFactory-230"><span class="linenos">230</span></a>
</span><span id="ChartDataFactory-231"><a href="#ChartDataFactory-231"><span class="linenos">231</span></a>        <span class="c1"># Convert to models for type safety</span>
</span><span id="ChartDataFactory-232"><a href="#ChartDataFactory-232"><span class="linenos">232</span></a>        <span class="n">available_planets_setting</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KerykeionSettingsCelestialPointModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDataFactory-233"><a href="#ChartDataFactory-233"><span class="linenos">233</span></a>            <span class="n">KerykeionSettingsCelestialPointModel</span><span class="p">(</span><span class="o">**</span><span class="n">body</span><span class="p">)</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">available_planets_setting_dicts</span>  <span class="c1"># type: ignore</span>
</span><span id="ChartDataFactory-234"><a href="#ChartDataFactory-234"><span class="linenos">234</span></a>        <span class="p">]</span>
</span><span id="ChartDataFactory-235"><a href="#ChartDataFactory-235"><span class="linenos">235</span></a>
</span><span id="ChartDataFactory-236"><a href="#ChartDataFactory-236"><span class="linenos">236</span></a>        <span class="n">celestial_points_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">available_planets_setting</span><span class="p">]</span>
</span><span id="ChartDataFactory-237"><a href="#ChartDataFactory-237"><span class="linenos">237</span></a>
</span><span id="ChartDataFactory-238"><a href="#ChartDataFactory-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span> <span class="ow">and</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory-239"><a href="#ChartDataFactory-239"><span class="linenos">239</span></a>            <span class="c1"># Calculate combined element/quality points for synastry</span>
</span><span id="ChartDataFactory-240"><a href="#ChartDataFactory-240"><span class="linenos">240</span></a>            <span class="c1"># Type narrowing: ensure both subjects are AstrologicalSubjectModel for synastry</span>
</span><span id="ChartDataFactory-241"><a href="#ChartDataFactory-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ChartDataFactory-242"><a href="#ChartDataFactory-242"><span class="linenos">242</span></a>                <span class="n">element_totals</span> <span class="o">=</span> <span class="n">calculate_synastry_element_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-243"><a href="#ChartDataFactory-243"><span class="linenos">243</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory-244"><a href="#ChartDataFactory-244"><span class="linenos">244</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory-245"><a href="#ChartDataFactory-245"><span class="linenos">245</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-246"><a href="#ChartDataFactory-246"><span class="linenos">246</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-247"><a href="#ChartDataFactory-247"><span class="linenos">247</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-248"><a href="#ChartDataFactory-248"><span class="linenos">248</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-249"><a href="#ChartDataFactory-249"><span class="linenos">249</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory-250"><a href="#ChartDataFactory-250"><span class="linenos">250</span></a>                <span class="n">quality_totals</span> <span class="o">=</span> <span class="n">calculate_synastry_quality_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-251"><a href="#ChartDataFactory-251"><span class="linenos">251</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory-252"><a href="#ChartDataFactory-252"><span class="linenos">252</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory-253"><a href="#ChartDataFactory-253"><span class="linenos">253</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-254"><a href="#ChartDataFactory-254"><span class="linenos">254</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-255"><a href="#ChartDataFactory-255"><span class="linenos">255</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-256"><a href="#ChartDataFactory-256"><span class="linenos">256</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-257"><a href="#ChartDataFactory-257"><span class="linenos">257</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory-258"><a href="#ChartDataFactory-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory-259"><a href="#ChartDataFactory-259"><span class="linenos">259</span></a>                <span class="c1"># Fallback to single chart calculation for incompatible types</span>
</span><span id="ChartDataFactory-260"><a href="#ChartDataFactory-260"><span class="linenos">260</span></a>                <span class="n">element_totals</span> <span class="o">=</span> <span class="n">calculate_element_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-261"><a href="#ChartDataFactory-261"><span class="linenos">261</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory-262"><a href="#ChartDataFactory-262"><span class="linenos">262</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory-263"><a href="#ChartDataFactory-263"><span class="linenos">263</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-264"><a href="#ChartDataFactory-264"><span class="linenos">264</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-265"><a href="#ChartDataFactory-265"><span class="linenos">265</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-266"><a href="#ChartDataFactory-266"><span class="linenos">266</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory-267"><a href="#ChartDataFactory-267"><span class="linenos">267</span></a>                <span class="n">quality_totals</span> <span class="o">=</span> <span class="n">calculate_quality_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-268"><a href="#ChartDataFactory-268"><span class="linenos">268</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory-269"><a href="#ChartDataFactory-269"><span class="linenos">269</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory-270"><a href="#ChartDataFactory-270"><span class="linenos">270</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-271"><a href="#ChartDataFactory-271"><span class="linenos">271</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-272"><a href="#ChartDataFactory-272"><span class="linenos">272</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-273"><a href="#ChartDataFactory-273"><span class="linenos">273</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory-274"><a href="#ChartDataFactory-274"><span class="linenos">274</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory-275"><a href="#ChartDataFactory-275"><span class="linenos">275</span></a>            <span class="c1"># Calculate element/quality points for single chart</span>
</span><span id="ChartDataFactory-276"><a href="#ChartDataFactory-276"><span class="linenos">276</span></a>            <span class="n">element_totals</span> <span class="o">=</span> <span class="n">calculate_element_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-277"><a href="#ChartDataFactory-277"><span class="linenos">277</span></a>                <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory-278"><a href="#ChartDataFactory-278"><span class="linenos">278</span></a>                <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory-279"><a href="#ChartDataFactory-279"><span class="linenos">279</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-280"><a href="#ChartDataFactory-280"><span class="linenos">280</span></a>                <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-281"><a href="#ChartDataFactory-281"><span class="linenos">281</span></a>                <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-282"><a href="#ChartDataFactory-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-283"><a href="#ChartDataFactory-283"><span class="linenos">283</span></a>            <span class="n">quality_totals</span> <span class="o">=</span> <span class="n">calculate_quality_points</span><span class="p">(</span>
</span><span id="ChartDataFactory-284"><a href="#ChartDataFactory-284"><span class="linenos">284</span></a>                <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory-285"><a href="#ChartDataFactory-285"><span class="linenos">285</span></a>                <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory-286"><a href="#ChartDataFactory-286"><span class="linenos">286</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-287"><a href="#ChartDataFactory-287"><span class="linenos">287</span></a>                <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-288"><a href="#ChartDataFactory-288"><span class="linenos">288</span></a>                <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-289"><a href="#ChartDataFactory-289"><span class="linenos">289</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-290"><a href="#ChartDataFactory-290"><span class="linenos">290</span></a>
</span><span id="ChartDataFactory-291"><a href="#ChartDataFactory-291"><span class="linenos">291</span></a>        <span class="c1"># Calculate percentages</span>
</span><span id="ChartDataFactory-292"><a href="#ChartDataFactory-292"><span class="linenos">292</span></a>        <span class="n">total_elements</span> <span class="o">=</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">]</span>
</span><span id="ChartDataFactory-293"><a href="#ChartDataFactory-293"><span class="linenos">293</span></a>        <span class="n">element_percentages</span> <span class="o">=</span> <span class="n">distribute_percentages_to_100</span><span class="p">(</span><span class="n">element_totals</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_elements</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;fire&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;earth&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ChartDataFactory-294"><a href="#ChartDataFactory-294"><span class="linenos">294</span></a>        <span class="n">element_distribution</span> <span class="o">=</span> <span class="n">ElementDistributionModel</span><span class="p">(</span>
</span><span id="ChartDataFactory-295"><a href="#ChartDataFactory-295"><span class="linenos">295</span></a>            <span class="n">fire</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-296"><a href="#ChartDataFactory-296"><span class="linenos">296</span></a>            <span class="n">earth</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-297"><a href="#ChartDataFactory-297"><span class="linenos">297</span></a>            <span class="n">air</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-298"><a href="#ChartDataFactory-298"><span class="linenos">298</span></a>            <span class="n">water</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-299"><a href="#ChartDataFactory-299"><span class="linenos">299</span></a>            <span class="n">fire_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-300"><a href="#ChartDataFactory-300"><span class="linenos">300</span></a>            <span class="n">earth_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-301"><a href="#ChartDataFactory-301"><span class="linenos">301</span></a>            <span class="n">air_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-302"><a href="#ChartDataFactory-302"><span class="linenos">302</span></a>            <span class="n">water_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-303"><a href="#ChartDataFactory-303"><span class="linenos">303</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-304"><a href="#ChartDataFactory-304"><span class="linenos">304</span></a>
</span><span id="ChartDataFactory-305"><a href="#ChartDataFactory-305"><span class="linenos">305</span></a>        <span class="n">total_qualities</span> <span class="o">=</span> <span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">]</span>
</span><span id="ChartDataFactory-306"><a href="#ChartDataFactory-306"><span class="linenos">306</span></a>        <span class="n">quality_percentages</span> <span class="o">=</span> <span class="n">distribute_percentages_to_100</span><span class="p">(</span><span class="n">quality_totals</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_qualities</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;cardinal&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;mutable&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ChartDataFactory-307"><a href="#ChartDataFactory-307"><span class="linenos">307</span></a>        <span class="n">quality_distribution</span> <span class="o">=</span> <span class="n">QualityDistributionModel</span><span class="p">(</span>
</span><span id="ChartDataFactory-308"><a href="#ChartDataFactory-308"><span class="linenos">308</span></a>            <span class="n">cardinal</span><span class="o">=</span><span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-309"><a href="#ChartDataFactory-309"><span class="linenos">309</span></a>            <span class="n">fixed</span><span class="o">=</span><span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-310"><a href="#ChartDataFactory-310"><span class="linenos">310</span></a>            <span class="n">mutable</span><span class="o">=</span><span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-311"><a href="#ChartDataFactory-311"><span class="linenos">311</span></a>            <span class="n">cardinal_percentage</span><span class="o">=</span><span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-312"><a href="#ChartDataFactory-312"><span class="linenos">312</span></a>            <span class="n">fixed_percentage</span><span class="o">=</span><span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-313"><a href="#ChartDataFactory-313"><span class="linenos">313</span></a>            <span class="n">mutable_percentage</span><span class="o">=</span><span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory-314"><a href="#ChartDataFactory-314"><span class="linenos">314</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-315"><a href="#ChartDataFactory-315"><span class="linenos">315</span></a>
</span><span id="ChartDataFactory-316"><a href="#ChartDataFactory-316"><span class="linenos">316</span></a>        <span class="c1"># Create and return the appropriate chart data model</span>
</span><span id="ChartDataFactory-317"><a href="#ChartDataFactory-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDataFactory-318"><a href="#ChartDataFactory-318"><span class="linenos">318</span></a>            <span class="c1"># Single chart data model - cast types since they&#39;re already validated</span>
</span><span id="ChartDataFactory-319"><a href="#ChartDataFactory-319"><span class="linenos">319</span></a>            <span class="k">return</span> <span class="n">SingleChartDataModel</span><span class="p">(</span>
</span><span id="ChartDataFactory-320"><a href="#ChartDataFactory-320"><span class="linenos">320</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">],</span> <span class="n">chart_type</span><span class="p">),</span>
</span><span id="ChartDataFactory-321"><a href="#ChartDataFactory-321"><span class="linenos">321</span></a>                <span class="n">subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-322"><a href="#ChartDataFactory-322"><span class="linenos">322</span></a>                <span class="n">aspects</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">SingleChartAspectsModel</span><span class="p">,</span> <span class="n">aspects_model</span><span class="p">)</span><span class="o">.</span><span class="n">aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-323"><a href="#ChartDataFactory-323"><span class="linenos">323</span></a>                <span class="n">element_distribution</span><span class="o">=</span><span class="n">element_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory-324"><a href="#ChartDataFactory-324"><span class="linenos">324</span></a>                <span class="n">quality_distribution</span><span class="o">=</span><span class="n">quality_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory-325"><a href="#ChartDataFactory-325"><span class="linenos">325</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-326"><a href="#ChartDataFactory-326"><span class="linenos">326</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-327"><a href="#ChartDataFactory-327"><span class="linenos">327</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-328"><a href="#ChartDataFactory-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory-329"><a href="#ChartDataFactory-329"><span class="linenos">329</span></a>            <span class="c1"># Dual chart data model - cast types since they&#39;re already validated</span>
</span><span id="ChartDataFactory-330"><a href="#ChartDataFactory-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="n">second_subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDataFactory-331"><a href="#ChartDataFactory-331"><span class="linenos">331</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second subject is required for </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory-332"><a href="#ChartDataFactory-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="n">DualChartDataModel</span><span class="p">(</span>
</span><span id="ChartDataFactory-333"><a href="#ChartDataFactory-333"><span class="linenos">333</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">],</span> <span class="n">chart_type</span><span class="p">),</span>
</span><span id="ChartDataFactory-334"><a href="#ChartDataFactory-334"><span class="linenos">334</span></a>                <span class="n">first_subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-335"><a href="#ChartDataFactory-335"><span class="linenos">335</span></a>                <span class="n">second_subject</span><span class="o">=</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-336"><a href="#ChartDataFactory-336"><span class="linenos">336</span></a>                <span class="n">aspects</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">DualChartAspectsModel</span><span class="p">,</span> <span class="n">aspects_model</span><span class="p">)</span><span class="o">.</span><span class="n">aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-337"><a href="#ChartDataFactory-337"><span class="linenos">337</span></a>                <span class="n">house_comparison</span><span class="o">=</span><span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory-338"><a href="#ChartDataFactory-338"><span class="linenos">338</span></a>                <span class="n">relationship_score</span><span class="o">=</span><span class="n">relationship_score</span><span class="p">,</span>
</span><span id="ChartDataFactory-339"><a href="#ChartDataFactory-339"><span class="linenos">339</span></a>                <span class="n">element_distribution</span><span class="o">=</span><span class="n">element_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory-340"><a href="#ChartDataFactory-340"><span class="linenos">340</span></a>                <span class="n">quality_distribution</span><span class="o">=</span><span class="n">quality_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory-341"><a href="#ChartDataFactory-341"><span class="linenos">341</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-342"><a href="#ChartDataFactory-342"><span class="linenos">342</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-343"><a href="#ChartDataFactory-343"><span class="linenos">343</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory-344"><a href="#ChartDataFactory-344"><span class="linenos">344</span></a>
</span><span id="ChartDataFactory-345"><a href="#ChartDataFactory-345"><span class="linenos">345</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-346"><a href="#ChartDataFactory-346"><span class="linenos">346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_natal_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-347"><a href="#ChartDataFactory-347"><span class="linenos">347</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="ChartDataFactory-348"><a href="#ChartDataFactory-348"><span class="linenos">348</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-349"><a href="#ChartDataFactory-349"><span class="linenos">349</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-350"><a href="#ChartDataFactory-350"><span class="linenos">350</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-351"><a href="#ChartDataFactory-351"><span class="linenos">351</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-352"><a href="#ChartDataFactory-352"><span class="linenos">352</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-353"><a href="#ChartDataFactory-353"><span class="linenos">353</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-354"><a href="#ChartDataFactory-354"><span class="linenos">354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-355"><a href="#ChartDataFactory-355"><span class="linenos">355</span></a><span class="sd">        Convenience method for creating natal chart data.</span>
</span><span id="ChartDataFactory-356"><a href="#ChartDataFactory-356"><span class="linenos">356</span></a>
</span><span id="ChartDataFactory-357"><a href="#ChartDataFactory-357"><span class="linenos">357</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-358"><a href="#ChartDataFactory-358"><span class="linenos">358</span></a><span class="sd">            subject: Astrological subject</span>
</span><span id="ChartDataFactory-359"><a href="#ChartDataFactory-359"><span class="linenos">359</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory-360"><a href="#ChartDataFactory-360"><span class="linenos">360</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-361"><a href="#ChartDataFactory-361"><span class="linenos">361</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory-362"><a href="#ChartDataFactory-362"><span class="linenos">362</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory-363"><a href="#ChartDataFactory-363"><span class="linenos">363</span></a>
</span><span id="ChartDataFactory-364"><a href="#ChartDataFactory-364"><span class="linenos">364</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-365"><a href="#ChartDataFactory-365"><span class="linenos">365</span></a><span class="sd">            ChartDataModel: Natal chart data</span>
</span><span id="ChartDataFactory-366"><a href="#ChartDataFactory-366"><span class="linenos">366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-367"><a href="#ChartDataFactory-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-368"><a href="#ChartDataFactory-368"><span class="linenos">368</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-369"><a href="#ChartDataFactory-369"><span class="linenos">369</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-370"><a href="#ChartDataFactory-370"><span class="linenos">370</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-371"><a href="#ChartDataFactory-371"><span class="linenos">371</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-372"><a href="#ChartDataFactory-372"><span class="linenos">372</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-373"><a href="#ChartDataFactory-373"><span class="linenos">373</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-374"><a href="#ChartDataFactory-374"><span class="linenos">374</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-375"><a href="#ChartDataFactory-375"><span class="linenos">375</span></a>
</span><span id="ChartDataFactory-376"><a href="#ChartDataFactory-376"><span class="linenos">376</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-377"><a href="#ChartDataFactory-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_synastry_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-378"><a href="#ChartDataFactory-378"><span class="linenos">378</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-379"><a href="#ChartDataFactory-379"><span class="linenos">379</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-380"><a href="#ChartDataFactory-380"><span class="linenos">380</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-381"><a href="#ChartDataFactory-381"><span class="linenos">381</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-382"><a href="#ChartDataFactory-382"><span class="linenos">382</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory-383"><a href="#ChartDataFactory-383"><span class="linenos">383</span></a>        <span class="n">include_relationship_score</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory-384"><a href="#ChartDataFactory-384"><span class="linenos">384</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-385"><a href="#ChartDataFactory-385"><span class="linenos">385</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-386"><a href="#ChartDataFactory-386"><span class="linenos">386</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-387"><a href="#ChartDataFactory-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-388"><a href="#ChartDataFactory-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-389"><a href="#ChartDataFactory-389"><span class="linenos">389</span></a><span class="sd">        Convenience method for creating synastry chart data.</span>
</span><span id="ChartDataFactory-390"><a href="#ChartDataFactory-390"><span class="linenos">390</span></a>
</span><span id="ChartDataFactory-391"><a href="#ChartDataFactory-391"><span class="linenos">391</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-392"><a href="#ChartDataFactory-392"><span class="linenos">392</span></a><span class="sd">            first_subject: First astrological subject</span>
</span><span id="ChartDataFactory-393"><a href="#ChartDataFactory-393"><span class="linenos">393</span></a><span class="sd">            second_subject: Second astrological subject</span>
</span><span id="ChartDataFactory-394"><a href="#ChartDataFactory-394"><span class="linenos">394</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory-395"><a href="#ChartDataFactory-395"><span class="linenos">395</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-396"><a href="#ChartDataFactory-396"><span class="linenos">396</span></a><span class="sd">            include_house_comparison: Whether to include house comparison</span>
</span><span id="ChartDataFactory-397"><a href="#ChartDataFactory-397"><span class="linenos">397</span></a><span class="sd">            include_relationship_score: Whether to include relationship scoring</span>
</span><span id="ChartDataFactory-398"><a href="#ChartDataFactory-398"><span class="linenos">398</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory-399"><a href="#ChartDataFactory-399"><span class="linenos">399</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory-400"><a href="#ChartDataFactory-400"><span class="linenos">400</span></a>
</span><span id="ChartDataFactory-401"><a href="#ChartDataFactory-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-402"><a href="#ChartDataFactory-402"><span class="linenos">402</span></a><span class="sd">            ChartDataModel: Synastry chart data</span>
</span><span id="ChartDataFactory-403"><a href="#ChartDataFactory-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-404"><a href="#ChartDataFactory-404"><span class="linenos">404</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-405"><a href="#ChartDataFactory-405"><span class="linenos">405</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-406"><a href="#ChartDataFactory-406"><span class="linenos">406</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Synastry&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-407"><a href="#ChartDataFactory-407"><span class="linenos">407</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-408"><a href="#ChartDataFactory-408"><span class="linenos">408</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-409"><a href="#ChartDataFactory-409"><span class="linenos">409</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-410"><a href="#ChartDataFactory-410"><span class="linenos">410</span></a>            <span class="n">include_house_comparison</span><span class="o">=</span><span class="n">include_house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory-411"><a href="#ChartDataFactory-411"><span class="linenos">411</span></a>            <span class="n">include_relationship_score</span><span class="o">=</span><span class="n">include_relationship_score</span><span class="p">,</span>
</span><span id="ChartDataFactory-412"><a href="#ChartDataFactory-412"><span class="linenos">412</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-413"><a href="#ChartDataFactory-413"><span class="linenos">413</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-414"><a href="#ChartDataFactory-414"><span class="linenos">414</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-415"><a href="#ChartDataFactory-415"><span class="linenos">415</span></a>
</span><span id="ChartDataFactory-416"><a href="#ChartDataFactory-416"><span class="linenos">416</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-417"><a href="#ChartDataFactory-417"><span class="linenos">417</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_transit_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-418"><a href="#ChartDataFactory-418"><span class="linenos">418</span></a>        <span class="n">natal_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-419"><a href="#ChartDataFactory-419"><span class="linenos">419</span></a>        <span class="n">transit_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-420"><a href="#ChartDataFactory-420"><span class="linenos">420</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-421"><a href="#ChartDataFactory-421"><span class="linenos">421</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-422"><a href="#ChartDataFactory-422"><span class="linenos">422</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory-423"><a href="#ChartDataFactory-423"><span class="linenos">423</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-424"><a href="#ChartDataFactory-424"><span class="linenos">424</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-425"><a href="#ChartDataFactory-425"><span class="linenos">425</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-426"><a href="#ChartDataFactory-426"><span class="linenos">426</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-427"><a href="#ChartDataFactory-427"><span class="linenos">427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-428"><a href="#ChartDataFactory-428"><span class="linenos">428</span></a><span class="sd">        Convenience method for creating transit chart data.</span>
</span><span id="ChartDataFactory-429"><a href="#ChartDataFactory-429"><span class="linenos">429</span></a>
</span><span id="ChartDataFactory-430"><a href="#ChartDataFactory-430"><span class="linenos">430</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-431"><a href="#ChartDataFactory-431"><span class="linenos">431</span></a><span class="sd">            natal_subject: Natal astrological subject</span>
</span><span id="ChartDataFactory-432"><a href="#ChartDataFactory-432"><span class="linenos">432</span></a><span class="sd">            transit_subject: Transit astrological subject</span>
</span><span id="ChartDataFactory-433"><a href="#ChartDataFactory-433"><span class="linenos">433</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory-434"><a href="#ChartDataFactory-434"><span class="linenos">434</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-435"><a href="#ChartDataFactory-435"><span class="linenos">435</span></a><span class="sd">            include_house_comparison: Whether to include house comparison</span>
</span><span id="ChartDataFactory-436"><a href="#ChartDataFactory-436"><span class="linenos">436</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory-437"><a href="#ChartDataFactory-437"><span class="linenos">437</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory-438"><a href="#ChartDataFactory-438"><span class="linenos">438</span></a>
</span><span id="ChartDataFactory-439"><a href="#ChartDataFactory-439"><span class="linenos">439</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-440"><a href="#ChartDataFactory-440"><span class="linenos">440</span></a><span class="sd">            ChartDataModel: Transit chart data</span>
</span><span id="ChartDataFactory-441"><a href="#ChartDataFactory-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-442"><a href="#ChartDataFactory-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-443"><a href="#ChartDataFactory-443"><span class="linenos">443</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">natal_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-444"><a href="#ChartDataFactory-444"><span class="linenos">444</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-445"><a href="#ChartDataFactory-445"><span class="linenos">445</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">transit_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-446"><a href="#ChartDataFactory-446"><span class="linenos">446</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-447"><a href="#ChartDataFactory-447"><span class="linenos">447</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-448"><a href="#ChartDataFactory-448"><span class="linenos">448</span></a>            <span class="n">include_house_comparison</span><span class="o">=</span><span class="n">include_house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory-449"><a href="#ChartDataFactory-449"><span class="linenos">449</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-450"><a href="#ChartDataFactory-450"><span class="linenos">450</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-451"><a href="#ChartDataFactory-451"><span class="linenos">451</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-452"><a href="#ChartDataFactory-452"><span class="linenos">452</span></a>
</span><span id="ChartDataFactory-453"><a href="#ChartDataFactory-453"><span class="linenos">453</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-454"><a href="#ChartDataFactory-454"><span class="linenos">454</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_composite_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-455"><a href="#ChartDataFactory-455"><span class="linenos">455</span></a>        <span class="n">composite_subject</span><span class="p">:</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-456"><a href="#ChartDataFactory-456"><span class="linenos">456</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-457"><a href="#ChartDataFactory-457"><span class="linenos">457</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-458"><a href="#ChartDataFactory-458"><span class="linenos">458</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-459"><a href="#ChartDataFactory-459"><span class="linenos">459</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-460"><a href="#ChartDataFactory-460"><span class="linenos">460</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-461"><a href="#ChartDataFactory-461"><span class="linenos">461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-462"><a href="#ChartDataFactory-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-463"><a href="#ChartDataFactory-463"><span class="linenos">463</span></a><span class="sd">        Convenience method for creating composite chart data.</span>
</span><span id="ChartDataFactory-464"><a href="#ChartDataFactory-464"><span class="linenos">464</span></a>
</span><span id="ChartDataFactory-465"><a href="#ChartDataFactory-465"><span class="linenos">465</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-466"><a href="#ChartDataFactory-466"><span class="linenos">466</span></a><span class="sd">            composite_subject: Composite astrological subject</span>
</span><span id="ChartDataFactory-467"><a href="#ChartDataFactory-467"><span class="linenos">467</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory-468"><a href="#ChartDataFactory-468"><span class="linenos">468</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-469"><a href="#ChartDataFactory-469"><span class="linenos">469</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory-470"><a href="#ChartDataFactory-470"><span class="linenos">470</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory-471"><a href="#ChartDataFactory-471"><span class="linenos">471</span></a>
</span><span id="ChartDataFactory-472"><a href="#ChartDataFactory-472"><span class="linenos">472</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-473"><a href="#ChartDataFactory-473"><span class="linenos">473</span></a><span class="sd">            ChartDataModel: Composite chart data</span>
</span><span id="ChartDataFactory-474"><a href="#ChartDataFactory-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-475"><a href="#ChartDataFactory-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-476"><a href="#ChartDataFactory-476"><span class="linenos">476</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">composite_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-477"><a href="#ChartDataFactory-477"><span class="linenos">477</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Composite&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-478"><a href="#ChartDataFactory-478"><span class="linenos">478</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-479"><a href="#ChartDataFactory-479"><span class="linenos">479</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-480"><a href="#ChartDataFactory-480"><span class="linenos">480</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-481"><a href="#ChartDataFactory-481"><span class="linenos">481</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-482"><a href="#ChartDataFactory-482"><span class="linenos">482</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-483"><a href="#ChartDataFactory-483"><span class="linenos">483</span></a>
</span><span id="ChartDataFactory-484"><a href="#ChartDataFactory-484"><span class="linenos">484</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-485"><a href="#ChartDataFactory-485"><span class="linenos">485</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_return_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-486"><a href="#ChartDataFactory-486"><span class="linenos">486</span></a>        <span class="n">natal_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-487"><a href="#ChartDataFactory-487"><span class="linenos">487</span></a>        <span class="n">return_subject</span><span class="p">:</span> <span class="n">PlanetReturnModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-488"><a href="#ChartDataFactory-488"><span class="linenos">488</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-489"><a href="#ChartDataFactory-489"><span class="linenos">489</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-490"><a href="#ChartDataFactory-490"><span class="linenos">490</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory-491"><a href="#ChartDataFactory-491"><span class="linenos">491</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-492"><a href="#ChartDataFactory-492"><span class="linenos">492</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-493"><a href="#ChartDataFactory-493"><span class="linenos">493</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-494"><a href="#ChartDataFactory-494"><span class="linenos">494</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-495"><a href="#ChartDataFactory-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-496"><a href="#ChartDataFactory-496"><span class="linenos">496</span></a><span class="sd">        Convenience method for creating planetary return chart data.</span>
</span><span id="ChartDataFactory-497"><a href="#ChartDataFactory-497"><span class="linenos">497</span></a>
</span><span id="ChartDataFactory-498"><a href="#ChartDataFactory-498"><span class="linenos">498</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-499"><a href="#ChartDataFactory-499"><span class="linenos">499</span></a><span class="sd">            natal_subject: Natal astrological subject</span>
</span><span id="ChartDataFactory-500"><a href="#ChartDataFactory-500"><span class="linenos">500</span></a><span class="sd">            return_subject: Planetary return subject</span>
</span><span id="ChartDataFactory-501"><a href="#ChartDataFactory-501"><span class="linenos">501</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory-502"><a href="#ChartDataFactory-502"><span class="linenos">502</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-503"><a href="#ChartDataFactory-503"><span class="linenos">503</span></a><span class="sd">            include_house_comparison: Whether to include house comparison</span>
</span><span id="ChartDataFactory-504"><a href="#ChartDataFactory-504"><span class="linenos">504</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory-505"><a href="#ChartDataFactory-505"><span class="linenos">505</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory-506"><a href="#ChartDataFactory-506"><span class="linenos">506</span></a>
</span><span id="ChartDataFactory-507"><a href="#ChartDataFactory-507"><span class="linenos">507</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-508"><a href="#ChartDataFactory-508"><span class="linenos">508</span></a><span class="sd">            ChartDataModel: Return chart data</span>
</span><span id="ChartDataFactory-509"><a href="#ChartDataFactory-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-510"><a href="#ChartDataFactory-510"><span class="linenos">510</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-511"><a href="#ChartDataFactory-511"><span class="linenos">511</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">natal_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-512"><a href="#ChartDataFactory-512"><span class="linenos">512</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;DualReturnChart&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-513"><a href="#ChartDataFactory-513"><span class="linenos">513</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">return_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-514"><a href="#ChartDataFactory-514"><span class="linenos">514</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-515"><a href="#ChartDataFactory-515"><span class="linenos">515</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-516"><a href="#ChartDataFactory-516"><span class="linenos">516</span></a>            <span class="n">include_house_comparison</span><span class="o">=</span><span class="n">include_house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory-517"><a href="#ChartDataFactory-517"><span class="linenos">517</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-518"><a href="#ChartDataFactory-518"><span class="linenos">518</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-519"><a href="#ChartDataFactory-519"><span class="linenos">519</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory-520"><a href="#ChartDataFactory-520"><span class="linenos">520</span></a>
</span><span id="ChartDataFactory-521"><a href="#ChartDataFactory-521"><span class="linenos">521</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory-522"><a href="#ChartDataFactory-522"><span class="linenos">522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_single_wheel_return_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-523"><a href="#ChartDataFactory-523"><span class="linenos">523</span></a>        <span class="n">return_subject</span><span class="p">:</span> <span class="n">PlanetReturnModel</span><span class="p">,</span>
</span><span id="ChartDataFactory-524"><a href="#ChartDataFactory-524"><span class="linenos">524</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-525"><a href="#ChartDataFactory-525"><span class="linenos">525</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory-526"><a href="#ChartDataFactory-526"><span class="linenos">526</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory-527"><a href="#ChartDataFactory-527"><span class="linenos">527</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-528"><a href="#ChartDataFactory-528"><span class="linenos">528</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory-529"><a href="#ChartDataFactory-529"><span class="linenos">529</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory-530"><a href="#ChartDataFactory-530"><span class="linenos">530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-531"><a href="#ChartDataFactory-531"><span class="linenos">531</span></a><span class="sd">        Convenience method for creating single wheel planetary return chart data.</span>
</span><span id="ChartDataFactory-532"><a href="#ChartDataFactory-532"><span class="linenos">532</span></a>
</span><span id="ChartDataFactory-533"><a href="#ChartDataFactory-533"><span class="linenos">533</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory-534"><a href="#ChartDataFactory-534"><span class="linenos">534</span></a><span class="sd">            return_subject: Planetary return subject</span>
</span><span id="ChartDataFactory-535"><a href="#ChartDataFactory-535"><span class="linenos">535</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory-536"><a href="#ChartDataFactory-536"><span class="linenos">536</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory-537"><a href="#ChartDataFactory-537"><span class="linenos">537</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory-538"><a href="#ChartDataFactory-538"><span class="linenos">538</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory-539"><a href="#ChartDataFactory-539"><span class="linenos">539</span></a>
</span><span id="ChartDataFactory-540"><a href="#ChartDataFactory-540"><span class="linenos">540</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory-541"><a href="#ChartDataFactory-541"><span class="linenos">541</span></a><span class="sd">            ChartDataModel: Single wheel return chart data</span>
</span><span id="ChartDataFactory-542"><a href="#ChartDataFactory-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory-543"><a href="#ChartDataFactory-543"><span class="linenos">543</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory-544"><a href="#ChartDataFactory-544"><span class="linenos">544</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">return_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory-545"><a href="#ChartDataFactory-545"><span class="linenos">545</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory-546"><a href="#ChartDataFactory-546"><span class="linenos">546</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory-547"><a href="#ChartDataFactory-547"><span class="linenos">547</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory-548"><a href="#ChartDataFactory-548"><span class="linenos">548</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory-549"><a href="#ChartDataFactory-549"><span class="linenos">549</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory-550"><a href="#ChartDataFactory-550"><span class="linenos">550</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Factory class for creating comprehensive chart data models.</p>

<p>This factory creates ChartDataModel instances containing all the pure data
from astrological charts, including subjects, aspects, house comparisons,
and analytical metrics. It provides the structured data equivalent of
ChartDrawer's visual output.</p>

<p>The factory handles all chart types and automatically includes relevant
analyses based on chart type (e.g., house comparison for dual charts,
relationship scoring for synastry charts).</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="create-natal-chart-data">Create natal chart data</h1>
      
      <p>john = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("John", 1990, 1, 1, 12, 0, "London", "GB")
      natal_data = <a href="#ChartDataFactory.create_chart_data">ChartDataFactory.create_chart_data</a>("Natal", john)
      print(f"Elements: Fire {natal_data.element_distribution.fire_percentage}%")</p>
      
      <h1 id="create-synastry-chart-data">Create synastry chart data</h1>
      
      <p>jane = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("Jane", 1992, 6, 15, 14, 30, "Paris", "FR")
      synastry_data = <a href="#ChartDataFactory.create_chart_data">ChartDataFactory.create_chart_data</a>("Synastry", john, jane)
      print(f"Relationship score: {synastry_data.relationship_score.score_value}")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="ChartDataFactory.create_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Natal&#39;</span><span class="p">,</span> <span class="s1">&#39;Synastry&#39;</span><span class="p">,</span> <span class="s1">&#39;Transit&#39;</span><span class="p">,</span> <span class="s1">&#39;Composite&#39;</span><span class="p">,</span> <span class="s1">&#39;DualReturnChart&#39;</span><span class="p">,</span> <span class="s1">&#39;SingleReturnChart&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_relationship_score</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_chart_data-97"><a href="#ChartDataFactory.create_chart_data-97"><span class="linenos"> 97</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_chart_data-98"><a href="#ChartDataFactory.create_chart_data-98"><span class="linenos"> 98</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-99"><a href="#ChartDataFactory.create_chart_data-99"><span class="linenos"> 99</span></a>        <span class="n">chart_type</span><span class="p">:</span> <span class="n">ChartType</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-100"><a href="#ChartDataFactory.create_chart_data-100"><span class="linenos">100</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-101"><a href="#ChartDataFactory.create_chart_data-101"><span class="linenos">101</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-102"><a href="#ChartDataFactory.create_chart_data-102"><span class="linenos">102</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-103"><a href="#ChartDataFactory.create_chart_data-103"><span class="linenos">103</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-104"><a href="#ChartDataFactory.create_chart_data-104"><span class="linenos">104</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-105"><a href="#ChartDataFactory.create_chart_data-105"><span class="linenos">105</span></a>        <span class="n">include_relationship_score</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-106"><a href="#ChartDataFactory.create_chart_data-106"><span class="linenos">106</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-107"><a href="#ChartDataFactory.create_chart_data-107"><span class="linenos">107</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-108"><a href="#ChartDataFactory.create_chart_data-108"><span class="linenos">108</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-109"><a href="#ChartDataFactory.create_chart_data-109"><span class="linenos">109</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-110"><a href="#ChartDataFactory.create_chart_data-110"><span class="linenos">110</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-111"><a href="#ChartDataFactory.create_chart_data-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_chart_data-112"><a href="#ChartDataFactory.create_chart_data-112"><span class="linenos">112</span></a><span class="sd">        Create comprehensive chart data for the specified chart type.</span>
</span><span id="ChartDataFactory.create_chart_data-113"><a href="#ChartDataFactory.create_chart_data-113"><span class="linenos">113</span></a>
</span><span id="ChartDataFactory.create_chart_data-114"><a href="#ChartDataFactory.create_chart_data-114"><span class="linenos">114</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_chart_data-115"><a href="#ChartDataFactory.create_chart_data-115"><span class="linenos">115</span></a><span class="sd">            chart_type: Type of chart to create data for</span>
</span><span id="ChartDataFactory.create_chart_data-116"><a href="#ChartDataFactory.create_chart_data-116"><span class="linenos">116</span></a><span class="sd">            first_subject: Primary astrological subject</span>
</span><span id="ChartDataFactory.create_chart_data-117"><a href="#ChartDataFactory.create_chart_data-117"><span class="linenos">117</span></a><span class="sd">            second_subject: Secondary subject (required for dual charts)</span>
</span><span id="ChartDataFactory.create_chart_data-118"><a href="#ChartDataFactory.create_chart_data-118"><span class="linenos">118</span></a><span class="sd">            active_points: Points to include in calculations (defaults to first_subject.active_points)</span>
</span><span id="ChartDataFactory.create_chart_data-119"><a href="#ChartDataFactory.create_chart_data-119"><span class="linenos">119</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_chart_data-120"><a href="#ChartDataFactory.create_chart_data-120"><span class="linenos">120</span></a><span class="sd">            include_house_comparison: Whether to include house comparison for dual charts</span>
</span><span id="ChartDataFactory.create_chart_data-121"><a href="#ChartDataFactory.create_chart_data-121"><span class="linenos">121</span></a><span class="sd">            include_relationship_score: Whether to include relationship scoring for synastry</span>
</span><span id="ChartDataFactory.create_chart_data-122"><a href="#ChartDataFactory.create_chart_data-122"><span class="linenos">122</span></a><span class="sd">            axis_orb_limit: Optional orb threshold for chart axes (applies only to single chart aspects)</span>
</span><span id="ChartDataFactory.create_chart_data-123"><a href="#ChartDataFactory.create_chart_data-123"><span class="linenos">123</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting (&quot;pure_count&quot; or &quot;weighted&quot;)</span>
</span><span id="ChartDataFactory.create_chart_data-124"><a href="#ChartDataFactory.create_chart_data-124"><span class="linenos">124</span></a><span class="sd">            custom_distribution_weights: Optional overrides for the distribution weights</span>
</span><span id="ChartDataFactory.create_chart_data-125"><a href="#ChartDataFactory.create_chart_data-125"><span class="linenos">125</span></a>
</span><span id="ChartDataFactory.create_chart_data-126"><a href="#ChartDataFactory.create_chart_data-126"><span class="linenos">126</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_chart_data-127"><a href="#ChartDataFactory.create_chart_data-127"><span class="linenos">127</span></a><span class="sd">            ChartDataModel: Comprehensive chart data model</span>
</span><span id="ChartDataFactory.create_chart_data-128"><a href="#ChartDataFactory.create_chart_data-128"><span class="linenos">128</span></a>
</span><span id="ChartDataFactory.create_chart_data-129"><a href="#ChartDataFactory.create_chart_data-129"><span class="linenos">129</span></a><span class="sd">        Raises:</span>
</span><span id="ChartDataFactory.create_chart_data-130"><a href="#ChartDataFactory.create_chart_data-130"><span class="linenos">130</span></a><span class="sd">            KerykeionException: If chart type requirements are not met</span>
</span><span id="ChartDataFactory.create_chart_data-131"><a href="#ChartDataFactory.create_chart_data-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_chart_data-132"><a href="#ChartDataFactory.create_chart_data-132"><span class="linenos">132</span></a>
</span><span id="ChartDataFactory.create_chart_data-133"><a href="#ChartDataFactory.create_chart_data-133"><span class="linenos">133</span></a>        <span class="c1"># Validate chart type requirements</span>
</span><span id="ChartDataFactory.create_chart_data-134"><a href="#ChartDataFactory.create_chart_data-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-135"><a href="#ChartDataFactory.create_chart_data-135"><span class="linenos">135</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second subject is required for </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-136"><a href="#ChartDataFactory.create_chart_data-136"><span class="linenos">136</span></a>
</span><span id="ChartDataFactory.create_chart_data-137"><a href="#ChartDataFactory.create_chart_data-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="ChartDataFactory.create_chart_data-138"><a href="#ChartDataFactory.create_chart_data-138"><span class="linenos">138</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;First subject must be a CompositeSubjectModel for Composite charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-139"><a href="#ChartDataFactory.create_chart_data-139"><span class="linenos">139</span></a>
</span><span id="ChartDataFactory.create_chart_data-140"><a href="#ChartDataFactory.create_chart_data-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Return&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">):</span>
</span><span id="ChartDataFactory.create_chart_data-141"><a href="#ChartDataFactory.create_chart_data-141"><span class="linenos">141</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Second subject must be a PlanetReturnModel for Return charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-142"><a href="#ChartDataFactory.create_chart_data-142"><span class="linenos">142</span></a>
</span><span id="ChartDataFactory.create_chart_data-143"><a href="#ChartDataFactory.create_chart_data-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">):</span>
</span><span id="ChartDataFactory.create_chart_data-144"><a href="#ChartDataFactory.create_chart_data-144"><span class="linenos">144</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;First subject must be a PlanetReturnModel for SingleReturnChart charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-145"><a href="#ChartDataFactory.create_chart_data-145"><span class="linenos">145</span></a>
</span><span id="ChartDataFactory.create_chart_data-146"><a href="#ChartDataFactory.create_chart_data-146"><span class="linenos">146</span></a>        <span class="c1"># Determine active points</span>
</span><span id="ChartDataFactory.create_chart_data-147"><a href="#ChartDataFactory.create_chart_data-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-148"><a href="#ChartDataFactory.create_chart_data-148"><span class="linenos">148</span></a>            <span class="n">effective_active_points</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDataFactory.create_chart_data-149"><a href="#ChartDataFactory.create_chart_data-149"><span class="linenos">149</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-150"><a href="#ChartDataFactory.create_chart_data-150"><span class="linenos">150</span></a>            <span class="n">effective_active_points</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-151"><a href="#ChartDataFactory.create_chart_data-151"><span class="linenos">151</span></a>                <span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-152"><a href="#ChartDataFactory.create_chart_data-152"><span class="linenos">152</span></a>                <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDataFactory.create_chart_data-153"><a href="#ChartDataFactory.create_chart_data-153"><span class="linenos">153</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-154"><a href="#ChartDataFactory.create_chart_data-154"><span class="linenos">154</span></a>
</span><span id="ChartDataFactory.create_chart_data-155"><a href="#ChartDataFactory.create_chart_data-155"><span class="linenos">155</span></a>        <span class="c1"># For dual charts, further filter by second subject&#39;s active points</span>
</span><span id="ChartDataFactory.create_chart_data-156"><a href="#ChartDataFactory.create_chart_data-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-157"><a href="#ChartDataFactory.create_chart_data-157"><span class="linenos">157</span></a>            <span class="n">effective_active_points</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-158"><a href="#ChartDataFactory.create_chart_data-158"><span class="linenos">158</span></a>                <span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-159"><a href="#ChartDataFactory.create_chart_data-159"><span class="linenos">159</span></a>                <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDataFactory.create_chart_data-160"><a href="#ChartDataFactory.create_chart_data-160"><span class="linenos">160</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-161"><a href="#ChartDataFactory.create_chart_data-161"><span class="linenos">161</span></a>
</span><span id="ChartDataFactory.create_chart_data-162"><a href="#ChartDataFactory.create_chart_data-162"><span class="linenos">162</span></a>        <span class="c1"># Calculate aspects based on chart type</span>
</span><span id="ChartDataFactory.create_chart_data-163"><a href="#ChartDataFactory.create_chart_data-163"><span class="linenos">163</span></a>        <span class="n">aspects_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SingleChartAspectsModel</span><span class="p">,</span> <span class="n">DualChartAspectsModel</span><span class="p">]</span>
</span><span id="ChartDataFactory.create_chart_data-164"><a href="#ChartDataFactory.create_chart_data-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDataFactory.create_chart_data-165"><a href="#ChartDataFactory.create_chart_data-165"><span class="linenos">165</span></a>            <span class="c1"># Single chart aspects</span>
</span><span id="ChartDataFactory.create_chart_data-166"><a href="#ChartDataFactory.create_chart_data-166"><span class="linenos">166</span></a>            <span class="n">aspects_model</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">single_chart_aspects</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-167"><a href="#ChartDataFactory.create_chart_data-167"><span class="linenos">167</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-168"><a href="#ChartDataFactory.create_chart_data-168"><span class="linenos">168</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-169"><a href="#ChartDataFactory.create_chart_data-169"><span class="linenos">169</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-170"><a href="#ChartDataFactory.create_chart_data-170"><span class="linenos">170</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-171"><a href="#ChartDataFactory.create_chart_data-171"><span class="linenos">171</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-172"><a href="#ChartDataFactory.create_chart_data-172"><span class="linenos">172</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-173"><a href="#ChartDataFactory.create_chart_data-173"><span class="linenos">173</span></a>            <span class="c1"># Dual chart aspects - second_subject is guaranteed to exist here due to validation above</span>
</span><span id="ChartDataFactory.create_chart_data-174"><a href="#ChartDataFactory.create_chart_data-174"><span class="linenos">174</span></a>            <span class="k">if</span> <span class="n">second_subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-175"><a href="#ChartDataFactory.create_chart_data-175"><span class="linenos">175</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second subject is required for </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-176"><a href="#ChartDataFactory.create_chart_data-176"><span class="linenos">176</span></a>
</span><span id="ChartDataFactory.create_chart_data-177"><a href="#ChartDataFactory.create_chart_data-177"><span class="linenos">177</span></a>            <span class="c1"># Determine if subjects are fixed based on chart type</span>
</span><span id="ChartDataFactory.create_chart_data-178"><a href="#ChartDataFactory.create_chart_data-178"><span class="linenos">178</span></a>            <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ChartDataFactory.create_chart_data-179"><a href="#ChartDataFactory.create_chart_data-179"><span class="linenos">179</span></a>            <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ChartDataFactory.create_chart_data-180"><a href="#ChartDataFactory.create_chart_data-180"><span class="linenos">180</span></a>
</span><span id="ChartDataFactory.create_chart_data-181"><a href="#ChartDataFactory.create_chart_data-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-182"><a href="#ChartDataFactory.create_chart_data-182"><span class="linenos">182</span></a>                <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDataFactory.create_chart_data-183"><a href="#ChartDataFactory.create_chart_data-183"><span class="linenos">183</span></a>                <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDataFactory.create_chart_data-184"><a href="#ChartDataFactory.create_chart_data-184"><span class="linenos">184</span></a>            <span class="k">elif</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-185"><a href="#ChartDataFactory.create_chart_data-185"><span class="linenos">185</span></a>                <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Natal chart is fixed</span>
</span><span id="ChartDataFactory.create_chart_data-186"><a href="#ChartDataFactory.create_chart_data-186"><span class="linenos">186</span></a>                <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Transit chart is moving</span>
</span><span id="ChartDataFactory.create_chart_data-187"><a href="#ChartDataFactory.create_chart_data-187"><span class="linenos">187</span></a>            <span class="k">elif</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-188"><a href="#ChartDataFactory.create_chart_data-188"><span class="linenos">188</span></a>                <span class="n">first_subject_is_fixed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Natal chart is fixed</span>
</span><span id="ChartDataFactory.create_chart_data-189"><a href="#ChartDataFactory.create_chart_data-189"><span class="linenos">189</span></a>                <span class="n">second_subject_is_fixed</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Return chart is moving (like transits)</span>
</span><span id="ChartDataFactory.create_chart_data-190"><a href="#ChartDataFactory.create_chart_data-190"><span class="linenos">190</span></a>
</span><span id="ChartDataFactory.create_chart_data-191"><a href="#ChartDataFactory.create_chart_data-191"><span class="linenos">191</span></a>            <span class="n">aspects_model</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-192"><a href="#ChartDataFactory.create_chart_data-192"><span class="linenos">192</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-193"><a href="#ChartDataFactory.create_chart_data-193"><span class="linenos">193</span></a>                <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-194"><a href="#ChartDataFactory.create_chart_data-194"><span class="linenos">194</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-195"><a href="#ChartDataFactory.create_chart_data-195"><span class="linenos">195</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-196"><a href="#ChartDataFactory.create_chart_data-196"><span class="linenos">196</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-197"><a href="#ChartDataFactory.create_chart_data-197"><span class="linenos">197</span></a>                <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="n">first_subject_is_fixed</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-198"><a href="#ChartDataFactory.create_chart_data-198"><span class="linenos">198</span></a>                <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="n">second_subject_is_fixed</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-199"><a href="#ChartDataFactory.create_chart_data-199"><span class="linenos">199</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-200"><a href="#ChartDataFactory.create_chart_data-200"><span class="linenos">200</span></a>
</span><span id="ChartDataFactory.create_chart_data-201"><a href="#ChartDataFactory.create_chart_data-201"><span class="linenos">201</span></a>        <span class="c1"># Calculate house comparison for dual charts</span>
</span><span id="ChartDataFactory.create_chart_data-202"><a href="#ChartDataFactory.create_chart_data-202"><span class="linenos">202</span></a>        <span class="n">house_comparison</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChartDataFactory.create_chart_data-203"><a href="#ChartDataFactory.create_chart_data-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="n">second_subject</span> <span class="ow">and</span> <span class="n">include_house_comparison</span> <span class="ow">and</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDataFactory.create_chart_data-204"><a href="#ChartDataFactory.create_chart_data-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)):</span>
</span><span id="ChartDataFactory.create_chart_data-205"><a href="#ChartDataFactory.create_chart_data-205"><span class="linenos">205</span></a>                <span class="n">house_comparison_factory</span> <span class="o">=</span> <span class="n">HouseComparisonFactory</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-206"><a href="#ChartDataFactory.create_chart_data-206"><span class="linenos">206</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-207"><a href="#ChartDataFactory.create_chart_data-207"><span class="linenos">207</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-208"><a href="#ChartDataFactory.create_chart_data-208"><span class="linenos">208</span></a>                    <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span>
</span><span id="ChartDataFactory.create_chart_data-209"><a href="#ChartDataFactory.create_chart_data-209"><span class="linenos">209</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-210"><a href="#ChartDataFactory.create_chart_data-210"><span class="linenos">210</span></a>                <span class="n">house_comparison</span> <span class="o">=</span> <span class="n">house_comparison_factory</span><span class="o">.</span><span class="n">get_house_comparison</span><span class="p">()</span>
</span><span id="ChartDataFactory.create_chart_data-211"><a href="#ChartDataFactory.create_chart_data-211"><span class="linenos">211</span></a>
</span><span id="ChartDataFactory.create_chart_data-212"><a href="#ChartDataFactory.create_chart_data-212"><span class="linenos">212</span></a>        <span class="c1"># Calculate relationship score for synastry</span>
</span><span id="ChartDataFactory.create_chart_data-213"><a href="#ChartDataFactory.create_chart_data-213"><span class="linenos">213</span></a>        <span class="n">relationship_score</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChartDataFactory.create_chart_data-214"><a href="#ChartDataFactory.create_chart_data-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span> <span class="ow">and</span> <span class="n">include_relationship_score</span> <span class="ow">and</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-215"><a href="#ChartDataFactory.create_chart_data-215"><span class="linenos">215</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ChartDataFactory.create_chart_data-216"><a href="#ChartDataFactory.create_chart_data-216"><span class="linenos">216</span></a>                <span class="n">relationship_score_factory</span> <span class="o">=</span> <span class="n">RelationshipScoreFactory</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-217"><a href="#ChartDataFactory.create_chart_data-217"><span class="linenos">217</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-218"><a href="#ChartDataFactory.create_chart_data-218"><span class="linenos">218</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-219"><a href="#ChartDataFactory.create_chart_data-219"><span class="linenos">219</span></a>                    <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-220"><a href="#ChartDataFactory.create_chart_data-220"><span class="linenos">220</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-221"><a href="#ChartDataFactory.create_chart_data-221"><span class="linenos">221</span></a>                <span class="n">relationship_score</span> <span class="o">=</span> <span class="n">relationship_score_factory</span><span class="o">.</span><span class="n">get_relationship_score</span><span class="p">()</span>
</span><span id="ChartDataFactory.create_chart_data-222"><a href="#ChartDataFactory.create_chart_data-222"><span class="linenos">222</span></a>
</span><span id="ChartDataFactory.create_chart_data-223"><a href="#ChartDataFactory.create_chart_data-223"><span class="linenos">223</span></a>        <span class="c1"># Calculate element and quality distributions</span>
</span><span id="ChartDataFactory.create_chart_data-224"><a href="#ChartDataFactory.create_chart_data-224"><span class="linenos">224</span></a>        <span class="n">available_planets_setting_dicts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDataFactory.create_chart_data-225"><a href="#ChartDataFactory.create_chart_data-225"><span class="linenos">225</span></a>        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-226"><a href="#ChartDataFactory.create_chart_data-226"><span class="linenos">226</span></a>            <span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">effective_active_points</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-227"><a href="#ChartDataFactory.create_chart_data-227"><span class="linenos">227</span></a>                <span class="n">body_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-228"><a href="#ChartDataFactory.create_chart_data-228"><span class="linenos">228</span></a>                <span class="n">body_dict</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDataFactory.create_chart_data-229"><a href="#ChartDataFactory.create_chart_data-229"><span class="linenos">229</span></a>                <span class="n">available_planets_setting_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body_dict</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-230"><a href="#ChartDataFactory.create_chart_data-230"><span class="linenos">230</span></a>
</span><span id="ChartDataFactory.create_chart_data-231"><a href="#ChartDataFactory.create_chart_data-231"><span class="linenos">231</span></a>        <span class="c1"># Convert to models for type safety</span>
</span><span id="ChartDataFactory.create_chart_data-232"><a href="#ChartDataFactory.create_chart_data-232"><span class="linenos">232</span></a>        <span class="n">available_planets_setting</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KerykeionSettingsCelestialPointModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDataFactory.create_chart_data-233"><a href="#ChartDataFactory.create_chart_data-233"><span class="linenos">233</span></a>            <span class="n">KerykeionSettingsCelestialPointModel</span><span class="p">(</span><span class="o">**</span><span class="n">body</span><span class="p">)</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">available_planets_setting_dicts</span>  <span class="c1"># type: ignore</span>
</span><span id="ChartDataFactory.create_chart_data-234"><a href="#ChartDataFactory.create_chart_data-234"><span class="linenos">234</span></a>        <span class="p">]</span>
</span><span id="ChartDataFactory.create_chart_data-235"><a href="#ChartDataFactory.create_chart_data-235"><span class="linenos">235</span></a>
</span><span id="ChartDataFactory.create_chart_data-236"><a href="#ChartDataFactory.create_chart_data-236"><span class="linenos">236</span></a>        <span class="n">celestial_points_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">available_planets_setting</span><span class="p">]</span>
</span><span id="ChartDataFactory.create_chart_data-237"><a href="#ChartDataFactory.create_chart_data-237"><span class="linenos">237</span></a>
</span><span id="ChartDataFactory.create_chart_data-238"><a href="#ChartDataFactory.create_chart_data-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span> <span class="ow">and</span> <span class="n">second_subject</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-239"><a href="#ChartDataFactory.create_chart_data-239"><span class="linenos">239</span></a>            <span class="c1"># Calculate combined element/quality points for synastry</span>
</span><span id="ChartDataFactory.create_chart_data-240"><a href="#ChartDataFactory.create_chart_data-240"><span class="linenos">240</span></a>            <span class="c1"># Type narrowing: ensure both subjects are AstrologicalSubjectModel for synastry</span>
</span><span id="ChartDataFactory.create_chart_data-241"><a href="#ChartDataFactory.create_chart_data-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ChartDataFactory.create_chart_data-242"><a href="#ChartDataFactory.create_chart_data-242"><span class="linenos">242</span></a>                <span class="n">element_totals</span> <span class="o">=</span> <span class="n">calculate_synastry_element_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-243"><a href="#ChartDataFactory.create_chart_data-243"><span class="linenos">243</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-244"><a href="#ChartDataFactory.create_chart_data-244"><span class="linenos">244</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-245"><a href="#ChartDataFactory.create_chart_data-245"><span class="linenos">245</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-246"><a href="#ChartDataFactory.create_chart_data-246"><span class="linenos">246</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-247"><a href="#ChartDataFactory.create_chart_data-247"><span class="linenos">247</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-248"><a href="#ChartDataFactory.create_chart_data-248"><span class="linenos">248</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-249"><a href="#ChartDataFactory.create_chart_data-249"><span class="linenos">249</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-250"><a href="#ChartDataFactory.create_chart_data-250"><span class="linenos">250</span></a>                <span class="n">quality_totals</span> <span class="o">=</span> <span class="n">calculate_synastry_quality_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-251"><a href="#ChartDataFactory.create_chart_data-251"><span class="linenos">251</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-252"><a href="#ChartDataFactory.create_chart_data-252"><span class="linenos">252</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-253"><a href="#ChartDataFactory.create_chart_data-253"><span class="linenos">253</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-254"><a href="#ChartDataFactory.create_chart_data-254"><span class="linenos">254</span></a>                    <span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-255"><a href="#ChartDataFactory.create_chart_data-255"><span class="linenos">255</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-256"><a href="#ChartDataFactory.create_chart_data-256"><span class="linenos">256</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-257"><a href="#ChartDataFactory.create_chart_data-257"><span class="linenos">257</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-258"><a href="#ChartDataFactory.create_chart_data-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-259"><a href="#ChartDataFactory.create_chart_data-259"><span class="linenos">259</span></a>                <span class="c1"># Fallback to single chart calculation for incompatible types</span>
</span><span id="ChartDataFactory.create_chart_data-260"><a href="#ChartDataFactory.create_chart_data-260"><span class="linenos">260</span></a>                <span class="n">element_totals</span> <span class="o">=</span> <span class="n">calculate_element_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-261"><a href="#ChartDataFactory.create_chart_data-261"><span class="linenos">261</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-262"><a href="#ChartDataFactory.create_chart_data-262"><span class="linenos">262</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-263"><a href="#ChartDataFactory.create_chart_data-263"><span class="linenos">263</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-264"><a href="#ChartDataFactory.create_chart_data-264"><span class="linenos">264</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-265"><a href="#ChartDataFactory.create_chart_data-265"><span class="linenos">265</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-266"><a href="#ChartDataFactory.create_chart_data-266"><span class="linenos">266</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-267"><a href="#ChartDataFactory.create_chart_data-267"><span class="linenos">267</span></a>                <span class="n">quality_totals</span> <span class="o">=</span> <span class="n">calculate_quality_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-268"><a href="#ChartDataFactory.create_chart_data-268"><span class="linenos">268</span></a>                    <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-269"><a href="#ChartDataFactory.create_chart_data-269"><span class="linenos">269</span></a>                    <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-270"><a href="#ChartDataFactory.create_chart_data-270"><span class="linenos">270</span></a>                    <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-271"><a href="#ChartDataFactory.create_chart_data-271"><span class="linenos">271</span></a>                    <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-272"><a href="#ChartDataFactory.create_chart_data-272"><span class="linenos">272</span></a>                    <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-273"><a href="#ChartDataFactory.create_chart_data-273"><span class="linenos">273</span></a>                <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-274"><a href="#ChartDataFactory.create_chart_data-274"><span class="linenos">274</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-275"><a href="#ChartDataFactory.create_chart_data-275"><span class="linenos">275</span></a>            <span class="c1"># Calculate element/quality points for single chart</span>
</span><span id="ChartDataFactory.create_chart_data-276"><a href="#ChartDataFactory.create_chart_data-276"><span class="linenos">276</span></a>            <span class="n">element_totals</span> <span class="o">=</span> <span class="n">calculate_element_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-277"><a href="#ChartDataFactory.create_chart_data-277"><span class="linenos">277</span></a>                <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-278"><a href="#ChartDataFactory.create_chart_data-278"><span class="linenos">278</span></a>                <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-279"><a href="#ChartDataFactory.create_chart_data-279"><span class="linenos">279</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-280"><a href="#ChartDataFactory.create_chart_data-280"><span class="linenos">280</span></a>                <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-281"><a href="#ChartDataFactory.create_chart_data-281"><span class="linenos">281</span></a>                <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-282"><a href="#ChartDataFactory.create_chart_data-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-283"><a href="#ChartDataFactory.create_chart_data-283"><span class="linenos">283</span></a>            <span class="n">quality_totals</span> <span class="o">=</span> <span class="n">calculate_quality_points</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-284"><a href="#ChartDataFactory.create_chart_data-284"><span class="linenos">284</span></a>                <span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-285"><a href="#ChartDataFactory.create_chart_data-285"><span class="linenos">285</span></a>                <span class="n">celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-286"><a href="#ChartDataFactory.create_chart_data-286"><span class="linenos">286</span></a>                <span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-287"><a href="#ChartDataFactory.create_chart_data-287"><span class="linenos">287</span></a>                <span class="n">method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-288"><a href="#ChartDataFactory.create_chart_data-288"><span class="linenos">288</span></a>                <span class="n">custom_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-289"><a href="#ChartDataFactory.create_chart_data-289"><span class="linenos">289</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-290"><a href="#ChartDataFactory.create_chart_data-290"><span class="linenos">290</span></a>
</span><span id="ChartDataFactory.create_chart_data-291"><a href="#ChartDataFactory.create_chart_data-291"><span class="linenos">291</span></a>        <span class="c1"># Calculate percentages</span>
</span><span id="ChartDataFactory.create_chart_data-292"><a href="#ChartDataFactory.create_chart_data-292"><span class="linenos">292</span></a>        <span class="n">total_elements</span> <span class="o">=</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">]</span>
</span><span id="ChartDataFactory.create_chart_data-293"><a href="#ChartDataFactory.create_chart_data-293"><span class="linenos">293</span></a>        <span class="n">element_percentages</span> <span class="o">=</span> <span class="n">distribute_percentages_to_100</span><span class="p">(</span><span class="n">element_totals</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_elements</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;fire&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;earth&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ChartDataFactory.create_chart_data-294"><a href="#ChartDataFactory.create_chart_data-294"><span class="linenos">294</span></a>        <span class="n">element_distribution</span> <span class="o">=</span> <span class="n">ElementDistributionModel</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-295"><a href="#ChartDataFactory.create_chart_data-295"><span class="linenos">295</span></a>            <span class="n">fire</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-296"><a href="#ChartDataFactory.create_chart_data-296"><span class="linenos">296</span></a>            <span class="n">earth</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-297"><a href="#ChartDataFactory.create_chart_data-297"><span class="linenos">297</span></a>            <span class="n">air</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-298"><a href="#ChartDataFactory.create_chart_data-298"><span class="linenos">298</span></a>            <span class="n">water</span><span class="o">=</span><span class="n">element_totals</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-299"><a href="#ChartDataFactory.create_chart_data-299"><span class="linenos">299</span></a>            <span class="n">fire_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-300"><a href="#ChartDataFactory.create_chart_data-300"><span class="linenos">300</span></a>            <span class="n">earth_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-301"><a href="#ChartDataFactory.create_chart_data-301"><span class="linenos">301</span></a>            <span class="n">air_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-302"><a href="#ChartDataFactory.create_chart_data-302"><span class="linenos">302</span></a>            <span class="n">water_percentage</span><span class="o">=</span><span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-303"><a href="#ChartDataFactory.create_chart_data-303"><span class="linenos">303</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-304"><a href="#ChartDataFactory.create_chart_data-304"><span class="linenos">304</span></a>
</span><span id="ChartDataFactory.create_chart_data-305"><a href="#ChartDataFactory.create_chart_data-305"><span class="linenos">305</span></a>        <span class="n">total_qualities</span> <span class="o">=</span> <span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">]</span>
</span><span id="ChartDataFactory.create_chart_data-306"><a href="#ChartDataFactory.create_chart_data-306"><span class="linenos">306</span></a>        <span class="n">quality_percentages</span> <span class="o">=</span> <span class="n">distribute_percentages_to_100</span><span class="p">(</span><span class="n">quality_totals</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_qualities</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;cardinal&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;mutable&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ChartDataFactory.create_chart_data-307"><a href="#ChartDataFactory.create_chart_data-307"><span class="linenos">307</span></a>        <span class="n">quality_distribution</span> <span class="o">=</span> <span class="n">QualityDistributionModel</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-308"><a href="#ChartDataFactory.create_chart_data-308"><span class="linenos">308</span></a>            <span class="n">cardinal</span><span class="o">=</span><span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-309"><a href="#ChartDataFactory.create_chart_data-309"><span class="linenos">309</span></a>            <span class="n">fixed</span><span class="o">=</span><span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-310"><a href="#ChartDataFactory.create_chart_data-310"><span class="linenos">310</span></a>            <span class="n">mutable</span><span class="o">=</span><span class="n">quality_totals</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-311"><a href="#ChartDataFactory.create_chart_data-311"><span class="linenos">311</span></a>            <span class="n">cardinal_percentage</span><span class="o">=</span><span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-312"><a href="#ChartDataFactory.create_chart_data-312"><span class="linenos">312</span></a>            <span class="n">fixed_percentage</span><span class="o">=</span><span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-313"><a href="#ChartDataFactory.create_chart_data-313"><span class="linenos">313</span></a>            <span class="n">mutable_percentage</span><span class="o">=</span><span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_chart_data-314"><a href="#ChartDataFactory.create_chart_data-314"><span class="linenos">314</span></a>        <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-315"><a href="#ChartDataFactory.create_chart_data-315"><span class="linenos">315</span></a>
</span><span id="ChartDataFactory.create_chart_data-316"><a href="#ChartDataFactory.create_chart_data-316"><span class="linenos">316</span></a>        <span class="c1"># Create and return the appropriate chart data model</span>
</span><span id="ChartDataFactory.create_chart_data-317"><a href="#ChartDataFactory.create_chart_data-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDataFactory.create_chart_data-318"><a href="#ChartDataFactory.create_chart_data-318"><span class="linenos">318</span></a>            <span class="c1"># Single chart data model - cast types since they&#39;re already validated</span>
</span><span id="ChartDataFactory.create_chart_data-319"><a href="#ChartDataFactory.create_chart_data-319"><span class="linenos">319</span></a>            <span class="k">return</span> <span class="n">SingleChartDataModel</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-320"><a href="#ChartDataFactory.create_chart_data-320"><span class="linenos">320</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">],</span> <span class="n">chart_type</span><span class="p">),</span>
</span><span id="ChartDataFactory.create_chart_data-321"><a href="#ChartDataFactory.create_chart_data-321"><span class="linenos">321</span></a>                <span class="n">subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-322"><a href="#ChartDataFactory.create_chart_data-322"><span class="linenos">322</span></a>                <span class="n">aspects</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">SingleChartAspectsModel</span><span class="p">,</span> <span class="n">aspects_model</span><span class="p">)</span><span class="o">.</span><span class="n">aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-323"><a href="#ChartDataFactory.create_chart_data-323"><span class="linenos">323</span></a>                <span class="n">element_distribution</span><span class="o">=</span><span class="n">element_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-324"><a href="#ChartDataFactory.create_chart_data-324"><span class="linenos">324</span></a>                <span class="n">quality_distribution</span><span class="o">=</span><span class="n">quality_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-325"><a href="#ChartDataFactory.create_chart_data-325"><span class="linenos">325</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-326"><a href="#ChartDataFactory.create_chart_data-326"><span class="linenos">326</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-327"><a href="#ChartDataFactory.create_chart_data-327"><span class="linenos">327</span></a>            <span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-328"><a href="#ChartDataFactory.create_chart_data-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-329"><a href="#ChartDataFactory.create_chart_data-329"><span class="linenos">329</span></a>            <span class="c1"># Dual chart data model - cast types since they&#39;re already validated</span>
</span><span id="ChartDataFactory.create_chart_data-330"><a href="#ChartDataFactory.create_chart_data-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="n">second_subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_chart_data-331"><a href="#ChartDataFactory.create_chart_data-331"><span class="linenos">331</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second subject is required for </span><span class="si">{</span><span class="n">chart_type</span><span class="si">}</span><span class="s2"> charts.&quot;</span><span class="p">)</span>
</span><span id="ChartDataFactory.create_chart_data-332"><a href="#ChartDataFactory.create_chart_data-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="n">DualChartDataModel</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_chart_data-333"><a href="#ChartDataFactory.create_chart_data-333"><span class="linenos">333</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">],</span> <span class="n">chart_type</span><span class="p">),</span>
</span><span id="ChartDataFactory.create_chart_data-334"><a href="#ChartDataFactory.create_chart_data-334"><span class="linenos">334</span></a>                <span class="n">first_subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-335"><a href="#ChartDataFactory.create_chart_data-335"><span class="linenos">335</span></a>                <span class="n">second_subject</span><span class="o">=</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-336"><a href="#ChartDataFactory.create_chart_data-336"><span class="linenos">336</span></a>                <span class="n">aspects</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">DualChartAspectsModel</span><span class="p">,</span> <span class="n">aspects_model</span><span class="p">)</span><span class="o">.</span><span class="n">aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-337"><a href="#ChartDataFactory.create_chart_data-337"><span class="linenos">337</span></a>                <span class="n">house_comparison</span><span class="o">=</span><span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-338"><a href="#ChartDataFactory.create_chart_data-338"><span class="linenos">338</span></a>                <span class="n">relationship_score</span><span class="o">=</span><span class="n">relationship_score</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-339"><a href="#ChartDataFactory.create_chart_data-339"><span class="linenos">339</span></a>                <span class="n">element_distribution</span><span class="o">=</span><span class="n">element_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-340"><a href="#ChartDataFactory.create_chart_data-340"><span class="linenos">340</span></a>                <span class="n">quality_distribution</span><span class="o">=</span><span class="n">quality_distribution</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-341"><a href="#ChartDataFactory.create_chart_data-341"><span class="linenos">341</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">effective_active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-342"><a href="#ChartDataFactory.create_chart_data-342"><span class="linenos">342</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_chart_data-343"><a href="#ChartDataFactory.create_chart_data-343"><span class="linenos">343</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create comprehensive chart data for the specified chart type.</p>

<p>Args:
    chart_type: Type of chart to create data for
    first_subject: Primary astrological subject
    second_subject: Secondary subject (required for dual charts)
    active_points: Points to include in calculations (defaults to first_subject.active_points)
    active_aspects: Aspect types and orbs to use
    include_house_comparison: Whether to include house comparison for dual charts
    include_relationship_score: Whether to include relationship scoring for synastry
    axis_orb_limit: Optional orb threshold for chart axes (applies only to single chart aspects)
    distribution_method: Strategy for element/modality weighting ("pure_count" or "weighted")
    custom_distribution_weights: Optional overrides for the distribution weights</p>

<p>Returns:
    ChartDataModel: Comprehensive chart data model</p>

<p>Raises:
    KerykeionException: If chart type requirements are not met</p>
</div>


                            </div>
                            <div id="ChartDataFactory.create_natal_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_natal_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_natal_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_natal_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_natal_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_natal_chart_data-345"><a href="#ChartDataFactory.create_natal_chart_data-345"><span class="linenos">345</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_natal_chart_data-346"><a href="#ChartDataFactory.create_natal_chart_data-346"><span class="linenos">346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_natal_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_natal_chart_data-347"><a href="#ChartDataFactory.create_natal_chart_data-347"><span class="linenos">347</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="ChartDataFactory.create_natal_chart_data-348"><a href="#ChartDataFactory.create_natal_chart_data-348"><span class="linenos">348</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-349"><a href="#ChartDataFactory.create_natal_chart_data-349"><span class="linenos">349</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-350"><a href="#ChartDataFactory.create_natal_chart_data-350"><span class="linenos">350</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-351"><a href="#ChartDataFactory.create_natal_chart_data-351"><span class="linenos">351</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-352"><a href="#ChartDataFactory.create_natal_chart_data-352"><span class="linenos">352</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-353"><a href="#ChartDataFactory.create_natal_chart_data-353"><span class="linenos">353</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_natal_chart_data-354"><a href="#ChartDataFactory.create_natal_chart_data-354"><span class="linenos">354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_natal_chart_data-355"><a href="#ChartDataFactory.create_natal_chart_data-355"><span class="linenos">355</span></a><span class="sd">        Convenience method for creating natal chart data.</span>
</span><span id="ChartDataFactory.create_natal_chart_data-356"><a href="#ChartDataFactory.create_natal_chart_data-356"><span class="linenos">356</span></a>
</span><span id="ChartDataFactory.create_natal_chart_data-357"><a href="#ChartDataFactory.create_natal_chart_data-357"><span class="linenos">357</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_natal_chart_data-358"><a href="#ChartDataFactory.create_natal_chart_data-358"><span class="linenos">358</span></a><span class="sd">            subject: Astrological subject</span>
</span><span id="ChartDataFactory.create_natal_chart_data-359"><a href="#ChartDataFactory.create_natal_chart_data-359"><span class="linenos">359</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory.create_natal_chart_data-360"><a href="#ChartDataFactory.create_natal_chart_data-360"><span class="linenos">360</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_natal_chart_data-361"><a href="#ChartDataFactory.create_natal_chart_data-361"><span class="linenos">361</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory.create_natal_chart_data-362"><a href="#ChartDataFactory.create_natal_chart_data-362"><span class="linenos">362</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory.create_natal_chart_data-363"><a href="#ChartDataFactory.create_natal_chart_data-363"><span class="linenos">363</span></a>
</span><span id="ChartDataFactory.create_natal_chart_data-364"><a href="#ChartDataFactory.create_natal_chart_data-364"><span class="linenos">364</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_natal_chart_data-365"><a href="#ChartDataFactory.create_natal_chart_data-365"><span class="linenos">365</span></a><span class="sd">            ChartDataModel: Natal chart data</span>
</span><span id="ChartDataFactory.create_natal_chart_data-366"><a href="#ChartDataFactory.create_natal_chart_data-366"><span class="linenos">366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_natal_chart_data-367"><a href="#ChartDataFactory.create_natal_chart_data-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_natal_chart_data-368"><a href="#ChartDataFactory.create_natal_chart_data-368"><span class="linenos">368</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-369"><a href="#ChartDataFactory.create_natal_chart_data-369"><span class="linenos">369</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-370"><a href="#ChartDataFactory.create_natal_chart_data-370"><span class="linenos">370</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-371"><a href="#ChartDataFactory.create_natal_chart_data-371"><span class="linenos">371</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-372"><a href="#ChartDataFactory.create_natal_chart_data-372"><span class="linenos">372</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-373"><a href="#ChartDataFactory.create_natal_chart_data-373"><span class="linenos">373</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_natal_chart_data-374"><a href="#ChartDataFactory.create_natal_chart_data-374"><span class="linenos">374</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience method for creating natal chart data.</p>

<p>Args:
    subject: Astrological subject
    active_points: Points to include in calculations
    active_aspects: Aspect types and orbs to use
    distribution_method: Strategy for element/modality weighting
    custom_distribution_weights: Optional overrides for distribution weights</p>

<p>Returns:
    ChartDataModel: Natal chart data</p>
</div>


                            </div>
                            <div id="ChartDataFactory.create_synastry_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_synastry_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_synastry_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_relationship_score</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_synastry_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_synastry_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_synastry_chart_data-376"><a href="#ChartDataFactory.create_synastry_chart_data-376"><span class="linenos">376</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-377"><a href="#ChartDataFactory.create_synastry_chart_data-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_synastry_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-378"><a href="#ChartDataFactory.create_synastry_chart_data-378"><span class="linenos">378</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-379"><a href="#ChartDataFactory.create_synastry_chart_data-379"><span class="linenos">379</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-380"><a href="#ChartDataFactory.create_synastry_chart_data-380"><span class="linenos">380</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-381"><a href="#ChartDataFactory.create_synastry_chart_data-381"><span class="linenos">381</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-382"><a href="#ChartDataFactory.create_synastry_chart_data-382"><span class="linenos">382</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-383"><a href="#ChartDataFactory.create_synastry_chart_data-383"><span class="linenos">383</span></a>        <span class="n">include_relationship_score</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-384"><a href="#ChartDataFactory.create_synastry_chart_data-384"><span class="linenos">384</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-385"><a href="#ChartDataFactory.create_synastry_chart_data-385"><span class="linenos">385</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-386"><a href="#ChartDataFactory.create_synastry_chart_data-386"><span class="linenos">386</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-387"><a href="#ChartDataFactory.create_synastry_chart_data-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-388"><a href="#ChartDataFactory.create_synastry_chart_data-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-389"><a href="#ChartDataFactory.create_synastry_chart_data-389"><span class="linenos">389</span></a><span class="sd">        Convenience method for creating synastry chart data.</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-390"><a href="#ChartDataFactory.create_synastry_chart_data-390"><span class="linenos">390</span></a>
</span><span id="ChartDataFactory.create_synastry_chart_data-391"><a href="#ChartDataFactory.create_synastry_chart_data-391"><span class="linenos">391</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-392"><a href="#ChartDataFactory.create_synastry_chart_data-392"><span class="linenos">392</span></a><span class="sd">            first_subject: First astrological subject</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-393"><a href="#ChartDataFactory.create_synastry_chart_data-393"><span class="linenos">393</span></a><span class="sd">            second_subject: Second astrological subject</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-394"><a href="#ChartDataFactory.create_synastry_chart_data-394"><span class="linenos">394</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-395"><a href="#ChartDataFactory.create_synastry_chart_data-395"><span class="linenos">395</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-396"><a href="#ChartDataFactory.create_synastry_chart_data-396"><span class="linenos">396</span></a><span class="sd">            include_house_comparison: Whether to include house comparison</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-397"><a href="#ChartDataFactory.create_synastry_chart_data-397"><span class="linenos">397</span></a><span class="sd">            include_relationship_score: Whether to include relationship scoring</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-398"><a href="#ChartDataFactory.create_synastry_chart_data-398"><span class="linenos">398</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-399"><a href="#ChartDataFactory.create_synastry_chart_data-399"><span class="linenos">399</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-400"><a href="#ChartDataFactory.create_synastry_chart_data-400"><span class="linenos">400</span></a>
</span><span id="ChartDataFactory.create_synastry_chart_data-401"><a href="#ChartDataFactory.create_synastry_chart_data-401"><span class="linenos">401</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-402"><a href="#ChartDataFactory.create_synastry_chart_data-402"><span class="linenos">402</span></a><span class="sd">            ChartDataModel: Synastry chart data</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-403"><a href="#ChartDataFactory.create_synastry_chart_data-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-404"><a href="#ChartDataFactory.create_synastry_chart_data-404"><span class="linenos">404</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-405"><a href="#ChartDataFactory.create_synastry_chart_data-405"><span class="linenos">405</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-406"><a href="#ChartDataFactory.create_synastry_chart_data-406"><span class="linenos">406</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Synastry&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-407"><a href="#ChartDataFactory.create_synastry_chart_data-407"><span class="linenos">407</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-408"><a href="#ChartDataFactory.create_synastry_chart_data-408"><span class="linenos">408</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-409"><a href="#ChartDataFactory.create_synastry_chart_data-409"><span class="linenos">409</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-410"><a href="#ChartDataFactory.create_synastry_chart_data-410"><span class="linenos">410</span></a>            <span class="n">include_house_comparison</span><span class="o">=</span><span class="n">include_house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-411"><a href="#ChartDataFactory.create_synastry_chart_data-411"><span class="linenos">411</span></a>            <span class="n">include_relationship_score</span><span class="o">=</span><span class="n">include_relationship_score</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-412"><a href="#ChartDataFactory.create_synastry_chart_data-412"><span class="linenos">412</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-413"><a href="#ChartDataFactory.create_synastry_chart_data-413"><span class="linenos">413</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_synastry_chart_data-414"><a href="#ChartDataFactory.create_synastry_chart_data-414"><span class="linenos">414</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience method for creating synastry chart data.</p>

<p>Args:
    first_subject: First astrological subject
    second_subject: Second astrological subject
    active_points: Points to include in calculations
    active_aspects: Aspect types and orbs to use
    include_house_comparison: Whether to include house comparison
    include_relationship_score: Whether to include relationship scoring
    distribution_method: Strategy for element/modality weighting
    custom_distribution_weights: Optional overrides for distribution weights</p>

<p>Returns:
    ChartDataModel: Synastry chart data</p>
</div>


                            </div>
                            <div id="ChartDataFactory.create_transit_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_transit_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_transit_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">natal_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">transit_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_transit_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_transit_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_transit_chart_data-416"><a href="#ChartDataFactory.create_transit_chart_data-416"><span class="linenos">416</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_transit_chart_data-417"><a href="#ChartDataFactory.create_transit_chart_data-417"><span class="linenos">417</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_transit_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_transit_chart_data-418"><a href="#ChartDataFactory.create_transit_chart_data-418"><span class="linenos">418</span></a>        <span class="n">natal_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-419"><a href="#ChartDataFactory.create_transit_chart_data-419"><span class="linenos">419</span></a>        <span class="n">transit_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-420"><a href="#ChartDataFactory.create_transit_chart_data-420"><span class="linenos">420</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-421"><a href="#ChartDataFactory.create_transit_chart_data-421"><span class="linenos">421</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-422"><a href="#ChartDataFactory.create_transit_chart_data-422"><span class="linenos">422</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-423"><a href="#ChartDataFactory.create_transit_chart_data-423"><span class="linenos">423</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-424"><a href="#ChartDataFactory.create_transit_chart_data-424"><span class="linenos">424</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-425"><a href="#ChartDataFactory.create_transit_chart_data-425"><span class="linenos">425</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-426"><a href="#ChartDataFactory.create_transit_chart_data-426"><span class="linenos">426</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_transit_chart_data-427"><a href="#ChartDataFactory.create_transit_chart_data-427"><span class="linenos">427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_transit_chart_data-428"><a href="#ChartDataFactory.create_transit_chart_data-428"><span class="linenos">428</span></a><span class="sd">        Convenience method for creating transit chart data.</span>
</span><span id="ChartDataFactory.create_transit_chart_data-429"><a href="#ChartDataFactory.create_transit_chart_data-429"><span class="linenos">429</span></a>
</span><span id="ChartDataFactory.create_transit_chart_data-430"><a href="#ChartDataFactory.create_transit_chart_data-430"><span class="linenos">430</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_transit_chart_data-431"><a href="#ChartDataFactory.create_transit_chart_data-431"><span class="linenos">431</span></a><span class="sd">            natal_subject: Natal astrological subject</span>
</span><span id="ChartDataFactory.create_transit_chart_data-432"><a href="#ChartDataFactory.create_transit_chart_data-432"><span class="linenos">432</span></a><span class="sd">            transit_subject: Transit astrological subject</span>
</span><span id="ChartDataFactory.create_transit_chart_data-433"><a href="#ChartDataFactory.create_transit_chart_data-433"><span class="linenos">433</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory.create_transit_chart_data-434"><a href="#ChartDataFactory.create_transit_chart_data-434"><span class="linenos">434</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_transit_chart_data-435"><a href="#ChartDataFactory.create_transit_chart_data-435"><span class="linenos">435</span></a><span class="sd">            include_house_comparison: Whether to include house comparison</span>
</span><span id="ChartDataFactory.create_transit_chart_data-436"><a href="#ChartDataFactory.create_transit_chart_data-436"><span class="linenos">436</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory.create_transit_chart_data-437"><a href="#ChartDataFactory.create_transit_chart_data-437"><span class="linenos">437</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory.create_transit_chart_data-438"><a href="#ChartDataFactory.create_transit_chart_data-438"><span class="linenos">438</span></a>
</span><span id="ChartDataFactory.create_transit_chart_data-439"><a href="#ChartDataFactory.create_transit_chart_data-439"><span class="linenos">439</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_transit_chart_data-440"><a href="#ChartDataFactory.create_transit_chart_data-440"><span class="linenos">440</span></a><span class="sd">            ChartDataModel: Transit chart data</span>
</span><span id="ChartDataFactory.create_transit_chart_data-441"><a href="#ChartDataFactory.create_transit_chart_data-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_transit_chart_data-442"><a href="#ChartDataFactory.create_transit_chart_data-442"><span class="linenos">442</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_transit_chart_data-443"><a href="#ChartDataFactory.create_transit_chart_data-443"><span class="linenos">443</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">natal_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-444"><a href="#ChartDataFactory.create_transit_chart_data-444"><span class="linenos">444</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-445"><a href="#ChartDataFactory.create_transit_chart_data-445"><span class="linenos">445</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">transit_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-446"><a href="#ChartDataFactory.create_transit_chart_data-446"><span class="linenos">446</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-447"><a href="#ChartDataFactory.create_transit_chart_data-447"><span class="linenos">447</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-448"><a href="#ChartDataFactory.create_transit_chart_data-448"><span class="linenos">448</span></a>            <span class="n">include_house_comparison</span><span class="o">=</span><span class="n">include_house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-449"><a href="#ChartDataFactory.create_transit_chart_data-449"><span class="linenos">449</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-450"><a href="#ChartDataFactory.create_transit_chart_data-450"><span class="linenos">450</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_transit_chart_data-451"><a href="#ChartDataFactory.create_transit_chart_data-451"><span class="linenos">451</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience method for creating transit chart data.</p>

<p>Args:
    natal_subject: Natal astrological subject
    transit_subject: Transit astrological subject
    active_points: Points to include in calculations
    active_aspects: Aspect types and orbs to use
    include_house_comparison: Whether to include house comparison
    distribution_method: Strategy for element/modality weighting
    custom_distribution_weights: Optional overrides for distribution weights</p>

<p>Returns:
    ChartDataModel: Transit chart data</p>
</div>


                            </div>
                            <div id="ChartDataFactory.create_composite_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_composite_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_composite_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">composite_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_composite_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_composite_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_composite_chart_data-453"><a href="#ChartDataFactory.create_composite_chart_data-453"><span class="linenos">453</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_composite_chart_data-454"><a href="#ChartDataFactory.create_composite_chart_data-454"><span class="linenos">454</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_composite_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_composite_chart_data-455"><a href="#ChartDataFactory.create_composite_chart_data-455"><span class="linenos">455</span></a>        <span class="n">composite_subject</span><span class="p">:</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-456"><a href="#ChartDataFactory.create_composite_chart_data-456"><span class="linenos">456</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-457"><a href="#ChartDataFactory.create_composite_chart_data-457"><span class="linenos">457</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-458"><a href="#ChartDataFactory.create_composite_chart_data-458"><span class="linenos">458</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-459"><a href="#ChartDataFactory.create_composite_chart_data-459"><span class="linenos">459</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-460"><a href="#ChartDataFactory.create_composite_chart_data-460"><span class="linenos">460</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-461"><a href="#ChartDataFactory.create_composite_chart_data-461"><span class="linenos">461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_composite_chart_data-462"><a href="#ChartDataFactory.create_composite_chart_data-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_composite_chart_data-463"><a href="#ChartDataFactory.create_composite_chart_data-463"><span class="linenos">463</span></a><span class="sd">        Convenience method for creating composite chart data.</span>
</span><span id="ChartDataFactory.create_composite_chart_data-464"><a href="#ChartDataFactory.create_composite_chart_data-464"><span class="linenos">464</span></a>
</span><span id="ChartDataFactory.create_composite_chart_data-465"><a href="#ChartDataFactory.create_composite_chart_data-465"><span class="linenos">465</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_composite_chart_data-466"><a href="#ChartDataFactory.create_composite_chart_data-466"><span class="linenos">466</span></a><span class="sd">            composite_subject: Composite astrological subject</span>
</span><span id="ChartDataFactory.create_composite_chart_data-467"><a href="#ChartDataFactory.create_composite_chart_data-467"><span class="linenos">467</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory.create_composite_chart_data-468"><a href="#ChartDataFactory.create_composite_chart_data-468"><span class="linenos">468</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_composite_chart_data-469"><a href="#ChartDataFactory.create_composite_chart_data-469"><span class="linenos">469</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory.create_composite_chart_data-470"><a href="#ChartDataFactory.create_composite_chart_data-470"><span class="linenos">470</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory.create_composite_chart_data-471"><a href="#ChartDataFactory.create_composite_chart_data-471"><span class="linenos">471</span></a>
</span><span id="ChartDataFactory.create_composite_chart_data-472"><a href="#ChartDataFactory.create_composite_chart_data-472"><span class="linenos">472</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_composite_chart_data-473"><a href="#ChartDataFactory.create_composite_chart_data-473"><span class="linenos">473</span></a><span class="sd">            ChartDataModel: Composite chart data</span>
</span><span id="ChartDataFactory.create_composite_chart_data-474"><a href="#ChartDataFactory.create_composite_chart_data-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_composite_chart_data-475"><a href="#ChartDataFactory.create_composite_chart_data-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_composite_chart_data-476"><a href="#ChartDataFactory.create_composite_chart_data-476"><span class="linenos">476</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">composite_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-477"><a href="#ChartDataFactory.create_composite_chart_data-477"><span class="linenos">477</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;Composite&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-478"><a href="#ChartDataFactory.create_composite_chart_data-478"><span class="linenos">478</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-479"><a href="#ChartDataFactory.create_composite_chart_data-479"><span class="linenos">479</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-480"><a href="#ChartDataFactory.create_composite_chart_data-480"><span class="linenos">480</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-481"><a href="#ChartDataFactory.create_composite_chart_data-481"><span class="linenos">481</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_composite_chart_data-482"><a href="#ChartDataFactory.create_composite_chart_data-482"><span class="linenos">482</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience method for creating composite chart data.</p>

<p>Args:
    composite_subject: Composite astrological subject
    active_points: Points to include in calculations
    active_aspects: Aspect types and orbs to use
    distribution_method: Strategy for element/modality weighting
    custom_distribution_weights: Optional overrides for distribution weights</p>

<p>Returns:
    ChartDataModel: Composite chart data</p>
</div>


                            </div>
                            <div id="ChartDataFactory.create_return_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_return_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_return_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">natal_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">return_subject</span><span class="p">:</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_return_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_return_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_return_chart_data-484"><a href="#ChartDataFactory.create_return_chart_data-484"><span class="linenos">484</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_return_chart_data-485"><a href="#ChartDataFactory.create_return_chart_data-485"><span class="linenos">485</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_return_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_return_chart_data-486"><a href="#ChartDataFactory.create_return_chart_data-486"><span class="linenos">486</span></a>        <span class="n">natal_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-487"><a href="#ChartDataFactory.create_return_chart_data-487"><span class="linenos">487</span></a>        <span class="n">return_subject</span><span class="p">:</span> <span class="n">PlanetReturnModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-488"><a href="#ChartDataFactory.create_return_chart_data-488"><span class="linenos">488</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-489"><a href="#ChartDataFactory.create_return_chart_data-489"><span class="linenos">489</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-490"><a href="#ChartDataFactory.create_return_chart_data-490"><span class="linenos">490</span></a>        <span class="n">include_house_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-491"><a href="#ChartDataFactory.create_return_chart_data-491"><span class="linenos">491</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-492"><a href="#ChartDataFactory.create_return_chart_data-492"><span class="linenos">492</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-493"><a href="#ChartDataFactory.create_return_chart_data-493"><span class="linenos">493</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-494"><a href="#ChartDataFactory.create_return_chart_data-494"><span class="linenos">494</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_return_chart_data-495"><a href="#ChartDataFactory.create_return_chart_data-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_return_chart_data-496"><a href="#ChartDataFactory.create_return_chart_data-496"><span class="linenos">496</span></a><span class="sd">        Convenience method for creating planetary return chart data.</span>
</span><span id="ChartDataFactory.create_return_chart_data-497"><a href="#ChartDataFactory.create_return_chart_data-497"><span class="linenos">497</span></a>
</span><span id="ChartDataFactory.create_return_chart_data-498"><a href="#ChartDataFactory.create_return_chart_data-498"><span class="linenos">498</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_return_chart_data-499"><a href="#ChartDataFactory.create_return_chart_data-499"><span class="linenos">499</span></a><span class="sd">            natal_subject: Natal astrological subject</span>
</span><span id="ChartDataFactory.create_return_chart_data-500"><a href="#ChartDataFactory.create_return_chart_data-500"><span class="linenos">500</span></a><span class="sd">            return_subject: Planetary return subject</span>
</span><span id="ChartDataFactory.create_return_chart_data-501"><a href="#ChartDataFactory.create_return_chart_data-501"><span class="linenos">501</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory.create_return_chart_data-502"><a href="#ChartDataFactory.create_return_chart_data-502"><span class="linenos">502</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_return_chart_data-503"><a href="#ChartDataFactory.create_return_chart_data-503"><span class="linenos">503</span></a><span class="sd">            include_house_comparison: Whether to include house comparison</span>
</span><span id="ChartDataFactory.create_return_chart_data-504"><a href="#ChartDataFactory.create_return_chart_data-504"><span class="linenos">504</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory.create_return_chart_data-505"><a href="#ChartDataFactory.create_return_chart_data-505"><span class="linenos">505</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory.create_return_chart_data-506"><a href="#ChartDataFactory.create_return_chart_data-506"><span class="linenos">506</span></a>
</span><span id="ChartDataFactory.create_return_chart_data-507"><a href="#ChartDataFactory.create_return_chart_data-507"><span class="linenos">507</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_return_chart_data-508"><a href="#ChartDataFactory.create_return_chart_data-508"><span class="linenos">508</span></a><span class="sd">            ChartDataModel: Return chart data</span>
</span><span id="ChartDataFactory.create_return_chart_data-509"><a href="#ChartDataFactory.create_return_chart_data-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_return_chart_data-510"><a href="#ChartDataFactory.create_return_chart_data-510"><span class="linenos">510</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_return_chart_data-511"><a href="#ChartDataFactory.create_return_chart_data-511"><span class="linenos">511</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">natal_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-512"><a href="#ChartDataFactory.create_return_chart_data-512"><span class="linenos">512</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;DualReturnChart&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-513"><a href="#ChartDataFactory.create_return_chart_data-513"><span class="linenos">513</span></a>            <span class="n">second_subject</span><span class="o">=</span><span class="n">return_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-514"><a href="#ChartDataFactory.create_return_chart_data-514"><span class="linenos">514</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-515"><a href="#ChartDataFactory.create_return_chart_data-515"><span class="linenos">515</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-516"><a href="#ChartDataFactory.create_return_chart_data-516"><span class="linenos">516</span></a>            <span class="n">include_house_comparison</span><span class="o">=</span><span class="n">include_house_comparison</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-517"><a href="#ChartDataFactory.create_return_chart_data-517"><span class="linenos">517</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-518"><a href="#ChartDataFactory.create_return_chart_data-518"><span class="linenos">518</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_return_chart_data-519"><a href="#ChartDataFactory.create_return_chart_data-519"><span class="linenos">519</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience method for creating planetary return chart data.</p>

<p>Args:
    natal_subject: Natal astrological subject
    return_subject: Planetary return subject
    active_points: Points to include in calculations
    active_aspects: Aspect types and orbs to use
    include_house_comparison: Whether to include house comparison
    distribution_method: Strategy for element/modality weighting
    custom_distribution_weights: Optional overrides for distribution weights</p>

<p>Returns:
    ChartDataModel: Return chart data</p>
</div>


                            </div>
                            <div id="ChartDataFactory.create_single_wheel_return_chart_data" class="classattr">
                                        <input id="ChartDataFactory.create_single_wheel_return_chart_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_single_wheel_return_chart_data</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">return_subject</span><span class="p">:</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">distribution_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;pure_count&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;weighted&#39;</span>,</span><span class="param">	<span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChartDataFactory.create_single_wheel_return_chart_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDataFactory.create_single_wheel_return_chart_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDataFactory.create_single_wheel_return_chart_data-521"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-521"><span class="linenos">521</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-522"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-522"><span class="linenos">522</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_single_wheel_return_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-523"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-523"><span class="linenos">523</span></a>        <span class="n">return_subject</span><span class="p">:</span> <span class="n">PlanetReturnModel</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-524"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-524"><span class="linenos">524</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-525"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-525"><span class="linenos">525</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-526"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-526"><span class="linenos">526</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-527"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-527"><span class="linenos">527</span></a>        <span class="n">distribution_method</span><span class="p">:</span> <span class="n">ElementQualityDistributionMethod</span> <span class="o">=</span> <span class="s2">&quot;weighted&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-528"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-528"><span class="linenos">528</span></a>        <span class="n">custom_distribution_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-529"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-529"><span class="linenos">529</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartDataModel</span><span class="p">:</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-530"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-530"><span class="linenos">530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-531"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-531"><span class="linenos">531</span></a><span class="sd">        Convenience method for creating single wheel planetary return chart data.</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-532"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-532"><span class="linenos">532</span></a>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-533"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-533"><span class="linenos">533</span></a><span class="sd">        Args:</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-534"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-534"><span class="linenos">534</span></a><span class="sd">            return_subject: Planetary return subject</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-535"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-535"><span class="linenos">535</span></a><span class="sd">            active_points: Points to include in calculations</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-536"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-536"><span class="linenos">536</span></a><span class="sd">            active_aspects: Aspect types and orbs to use</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-537"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-537"><span class="linenos">537</span></a><span class="sd">            distribution_method: Strategy for element/modality weighting</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-538"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-538"><span class="linenos">538</span></a><span class="sd">            custom_distribution_weights: Optional overrides for distribution weights</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-539"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-539"><span class="linenos">539</span></a>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-540"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-540"><span class="linenos">540</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-541"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-541"><span class="linenos">541</span></a><span class="sd">            ChartDataModel: Single wheel return chart data</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-542"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-543"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-543"><span class="linenos">543</span></a>        <span class="k">return</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_chart_data</span><span class="p">(</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-544"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-544"><span class="linenos">544</span></a>            <span class="n">first_subject</span><span class="o">=</span><span class="n">return_subject</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-545"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-545"><span class="linenos">545</span></a>            <span class="n">chart_type</span><span class="o">=</span><span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-546"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-546"><span class="linenos">546</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-547"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-547"><span class="linenos">547</span></a>            <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-548"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-548"><span class="linenos">548</span></a>            <span class="n">distribution_method</span><span class="o">=</span><span class="n">distribution_method</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-549"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-549"><span class="linenos">549</span></a>            <span class="n">custom_distribution_weights</span><span class="o">=</span><span class="n">custom_distribution_weights</span><span class="p">,</span>
</span><span id="ChartDataFactory.create_single_wheel_return_chart_data-550"><a href="#ChartDataFactory.create_single_wheel_return_chart_data-550"><span class="linenos">550</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convenience method for creating single wheel planetary return chart data.</p>

<p>Args:
    return_subject: Planetary return subject
    active_points: Points to include in calculations
    active_aspects: Aspect types and orbs to use
    distribution_method: Strategy for element/modality weighting
    custom_distribution_weights: Optional overrides for distribution weights</p>

<p>Returns:
    ChartDataModel: Single wheel return chart data</p>
</div>


                            </div>
                </section>
                <section id="ChartDataModel">
                    <div class="attr variable">
            <span class="name">ChartDataModel</span>        =
<input id="ChartDataModel-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="ChartDataModel-view-value"></label><span class="default_value">typing.Union[<a href="#SingleChartDataModel">SingleChartDataModel</a>, <a href="#DualChartDataModel">DualChartDataModel</a>]</span>

        
    </div>
    <a class="headerlink" href="#ChartDataModel"></a>
    
    

                </section>
                <section id="SingleChartDataModel">
                            <input id="SingleChartDataModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SingleChartDataModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.SubscriptableBaseModel</span>):

                <label class="view-source-button" for="SingleChartDataModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SingleChartDataModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SingleChartDataModel-525"><a href="#SingleChartDataModel-525"><span class="linenos">525</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SingleChartDataModel</span><span class="p">(</span><span class="n">SubscriptableBaseModel</span><span class="p">):</span>
</span><span id="SingleChartDataModel-526"><a href="#SingleChartDataModel-526"><span class="linenos">526</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SingleChartDataModel-527"><a href="#SingleChartDataModel-527"><span class="linenos">527</span></a><span class="sd">    Chart data model for single-subject astrological charts.</span>
</span><span id="SingleChartDataModel-528"><a href="#SingleChartDataModel-528"><span class="linenos">528</span></a>
</span><span id="SingleChartDataModel-529"><a href="#SingleChartDataModel-529"><span class="linenos">529</span></a><span class="sd">    This model contains all pure data from single-subject charts including planetary</span>
</span><span id="SingleChartDataModel-530"><a href="#SingleChartDataModel-530"><span class="linenos">530</span></a><span class="sd">    positions, internal aspects, element/quality distributions, and location data.</span>
</span><span id="SingleChartDataModel-531"><a href="#SingleChartDataModel-531"><span class="linenos">531</span></a><span class="sd">    Used for chart types that analyze a single astrological subject.</span>
</span><span id="SingleChartDataModel-532"><a href="#SingleChartDataModel-532"><span class="linenos">532</span></a>
</span><span id="SingleChartDataModel-533"><a href="#SingleChartDataModel-533"><span class="linenos">533</span></a><span class="sd">    Supported chart types:</span>
</span><span id="SingleChartDataModel-534"><a href="#SingleChartDataModel-534"><span class="linenos">534</span></a><span class="sd">    - Natal: Birth chart with internal planetary aspects</span>
</span><span id="SingleChartDataModel-535"><a href="#SingleChartDataModel-535"><span class="linenos">535</span></a><span class="sd">    - Composite: Midpoint relationship chart with internal aspects</span>
</span><span id="SingleChartDataModel-536"><a href="#SingleChartDataModel-536"><span class="linenos">536</span></a><span class="sd">    - SingleReturnChart: Single planetary return with internal aspects</span>
</span><span id="SingleChartDataModel-537"><a href="#SingleChartDataModel-537"><span class="linenos">537</span></a>
</span><span id="SingleChartDataModel-538"><a href="#SingleChartDataModel-538"><span class="linenos">538</span></a><span class="sd">    Attributes:</span>
</span><span id="SingleChartDataModel-539"><a href="#SingleChartDataModel-539"><span class="linenos">539</span></a><span class="sd">        chart_type: Type of single chart (Natal, Composite, SingleReturnChart)</span>
</span><span id="SingleChartDataModel-540"><a href="#SingleChartDataModel-540"><span class="linenos">540</span></a><span class="sd">        subject: The astrological subject being analyzed</span>
</span><span id="SingleChartDataModel-541"><a href="#SingleChartDataModel-541"><span class="linenos">541</span></a><span class="sd">        aspects: Internal aspects within the chart</span>
</span><span id="SingleChartDataModel-542"><a href="#SingleChartDataModel-542"><span class="linenos">542</span></a><span class="sd">        element_distribution: Distribution of elemental energies</span>
</span><span id="SingleChartDataModel-543"><a href="#SingleChartDataModel-543"><span class="linenos">543</span></a><span class="sd">        quality_distribution: Distribution of modal qualities</span>
</span><span id="SingleChartDataModel-544"><a href="#SingleChartDataModel-544"><span class="linenos">544</span></a><span class="sd">        active_points: Celestial points included in calculations</span>
</span><span id="SingleChartDataModel-545"><a href="#SingleChartDataModel-545"><span class="linenos">545</span></a><span class="sd">        active_aspects: Aspect types and orb settings used</span>
</span><span id="SingleChartDataModel-546"><a href="#SingleChartDataModel-546"><span class="linenos">546</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SingleChartDataModel-547"><a href="#SingleChartDataModel-547"><span class="linenos">547</span></a>
</span><span id="SingleChartDataModel-548"><a href="#SingleChartDataModel-548"><span class="linenos">548</span></a>    <span class="c1"># Chart identification</span>
</span><span id="SingleChartDataModel-549"><a href="#SingleChartDataModel-549"><span class="linenos">549</span></a>    <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]</span>
</span><span id="SingleChartDataModel-550"><a href="#SingleChartDataModel-550"><span class="linenos">550</span></a>
</span><span id="SingleChartDataModel-551"><a href="#SingleChartDataModel-551"><span class="linenos">551</span></a>    <span class="c1"># Single chart subject</span>
</span><span id="SingleChartDataModel-552"><a href="#SingleChartDataModel-552"><span class="linenos">552</span></a>    <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;CompositeSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">]</span>
</span><span id="SingleChartDataModel-553"><a href="#SingleChartDataModel-553"><span class="linenos">553</span></a>
</span><span id="SingleChartDataModel-554"><a href="#SingleChartDataModel-554"><span class="linenos">554</span></a>    <span class="c1"># Internal aspects analysis</span>
</span><span id="SingleChartDataModel-555"><a href="#SingleChartDataModel-555"><span class="linenos">555</span></a>    <span class="n">aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AspectModel</span><span class="p">]</span>
</span><span id="SingleChartDataModel-556"><a href="#SingleChartDataModel-556"><span class="linenos">556</span></a>
</span><span id="SingleChartDataModel-557"><a href="#SingleChartDataModel-557"><span class="linenos">557</span></a>    <span class="c1"># Element and quality distributions</span>
</span><span id="SingleChartDataModel-558"><a href="#SingleChartDataModel-558"><span class="linenos">558</span></a>    <span class="n">element_distribution</span><span class="p">:</span> <span class="s2">&quot;ElementDistributionModel&quot;</span>
</span><span id="SingleChartDataModel-559"><a href="#SingleChartDataModel-559"><span class="linenos">559</span></a>    <span class="n">quality_distribution</span><span class="p">:</span> <span class="s2">&quot;QualityDistributionModel&quot;</span>
</span><span id="SingleChartDataModel-560"><a href="#SingleChartDataModel-560"><span class="linenos">560</span></a>
</span><span id="SingleChartDataModel-561"><a href="#SingleChartDataModel-561"><span class="linenos">561</span></a>    <span class="c1"># Configuration and metadata</span>
</span><span id="SingleChartDataModel-562"><a href="#SingleChartDataModel-562"><span class="linenos">562</span></a>    <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span>
</span><span id="SingleChartDataModel-563"><a href="#SingleChartDataModel-563"><span class="linenos">563</span></a>    <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ActiveAspect&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Chart data model for single-subject astrological charts.</p>

<p>This model contains all pure data from single-subject charts including planetary
positions, internal aspects, element/quality distributions, and location data.
Used for chart types that analyze a single astrological subject.</p>

<p>Supported chart types:</p>

<ul>
<li>Natal: Birth chart with internal planetary aspects</li>
<li>Composite: Midpoint relationship chart with internal aspects</li>
<li>SingleReturnChart: Single planetary return with internal aspects</li>
</ul>

<p>Attributes:
    chart_type: Type of single chart (Natal, Composite, SingleReturnChart)
    subject: The astrological subject being analyzed
    aspects: Internal aspects within the chart
    element_distribution: Distribution of elemental energies
    quality_distribution: Distribution of modal qualities
    active_points: Celestial points included in calculations
    active_aspects: Aspect types and orb settings used</p>
</div>


                            <div id="SingleChartDataModel.chart_type" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_type</span><span class="annotation">: Literal[&#39;Natal&#39;, &#39;Composite&#39;, &#39;SingleReturnChart&#39;]</span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.chart_type"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.subject" class="classattr">
                                <div class="attr variable">
            <span class="name">subject</span><span class="annotation">: Union[kerykeion.schemas.kr_models.AstrologicalSubjectModel, kerykeion.schemas.kr_models.CompositeSubjectModel, <a href="#PlanetReturnModel">PlanetReturnModel</a>]</span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.subject"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects</span><span class="annotation">: List[kerykeion.schemas.kr_models.AspectModel]</span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.aspects"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.element_distribution" class="classattr">
                                <div class="attr variable">
            <span class="name">element_distribution</span><span class="annotation">: <a href="#ElementDistributionModel">ElementDistributionModel</a></span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.element_distribution"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.quality_distribution" class="classattr">
                                <div class="attr variable">
            <span class="name">quality_distribution</span><span class="annotation">: <a href="#QualityDistributionModel">QualityDistributionModel</a></span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.quality_distribution"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span><span class="annotation">: List[Literal[&#39;Sun&#39;, &#39;Moon&#39;, &#39;Mercury&#39;, &#39;Venus&#39;, &#39;Mars&#39;, &#39;Jupiter&#39;, &#39;Saturn&#39;, &#39;Uranus&#39;, &#39;Neptune&#39;, &#39;Pluto&#39;, &#39;Mean_North_Lunar_Node&#39;, &#39;True_North_Lunar_Node&#39;, &#39;Mean_South_Lunar_Node&#39;, &#39;True_South_Lunar_Node&#39;, &#39;Chiron&#39;, &#39;Mean_Lilith&#39;, &#39;True_Lilith&#39;, &#39;Earth&#39;, &#39;Pholus&#39;, &#39;Ceres&#39;, &#39;Pallas&#39;, &#39;Juno&#39;, &#39;Vesta&#39;, &#39;Eris&#39;, &#39;Sedna&#39;, &#39;Haumea&#39;, &#39;Makemake&#39;, &#39;Ixion&#39;, &#39;Orcus&#39;, &#39;Quaoar&#39;, &#39;Regulus&#39;, &#39;Spica&#39;, &#39;Pars_Fortunae&#39;, &#39;Pars_Spiritus&#39;, &#39;Pars_Amoris&#39;, &#39;Pars_Fidei&#39;, &#39;Vertex&#39;, &#39;Anti_Vertex&#39;, &#39;Ascendant&#39;, &#39;Medium_Coeli&#39;, &#39;Descendant&#39;, &#39;Imum_Coeli&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.active_points"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span><span class="annotation">: List[kerykeion.schemas.kr_models.ActiveAspect]</span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.active_aspects"></a>
    
    

                            </div>
                            <div id="SingleChartDataModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#SingleChartDataModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="DualChartDataModel">
                            <input id="DualChartDataModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DualChartDataModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.SubscriptableBaseModel</span>):

                <label class="view-source-button" for="DualChartDataModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DualChartDataModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DualChartDataModel-566"><a href="#DualChartDataModel-566"><span class="linenos">566</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DualChartDataModel</span><span class="p">(</span><span class="n">SubscriptableBaseModel</span><span class="p">):</span>
</span><span id="DualChartDataModel-567"><a href="#DualChartDataModel-567"><span class="linenos">567</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DualChartDataModel-568"><a href="#DualChartDataModel-568"><span class="linenos">568</span></a><span class="sd">    Chart data model for dual-subject astrological charts.</span>
</span><span id="DualChartDataModel-569"><a href="#DualChartDataModel-569"><span class="linenos">569</span></a>
</span><span id="DualChartDataModel-570"><a href="#DualChartDataModel-570"><span class="linenos">570</span></a><span class="sd">    This model contains all pure data from dual-subject charts including both subjects,</span>
</span><span id="DualChartDataModel-571"><a href="#DualChartDataModel-571"><span class="linenos">571</span></a><span class="sd">    inter-chart aspects, house comparisons, relationship analysis, and combined</span>
</span><span id="DualChartDataModel-572"><a href="#DualChartDataModel-572"><span class="linenos">572</span></a><span class="sd">    element/quality distributions. Used for chart types that compare or overlay</span>
</span><span id="DualChartDataModel-573"><a href="#DualChartDataModel-573"><span class="linenos">573</span></a><span class="sd">    two astrological subjects.</span>
</span><span id="DualChartDataModel-574"><a href="#DualChartDataModel-574"><span class="linenos">574</span></a>
</span><span id="DualChartDataModel-575"><a href="#DualChartDataModel-575"><span class="linenos">575</span></a><span class="sd">    Supported chart types:</span>
</span><span id="DualChartDataModel-576"><a href="#DualChartDataModel-576"><span class="linenos">576</span></a><span class="sd">    - Transit: Natal chart with current planetary transits</span>
</span><span id="DualChartDataModel-577"><a href="#DualChartDataModel-577"><span class="linenos">577</span></a><span class="sd">    - Synastry: Relationship compatibility between two people</span>
</span><span id="DualChartDataModel-578"><a href="#DualChartDataModel-578"><span class="linenos">578</span></a><span class="sd">    - Return: Natal chart with planetary return comparison</span>
</span><span id="DualChartDataModel-579"><a href="#DualChartDataModel-579"><span class="linenos">579</span></a>
</span><span id="DualChartDataModel-580"><a href="#DualChartDataModel-580"><span class="linenos">580</span></a><span class="sd">    Attributes:</span>
</span><span id="DualChartDataModel-581"><a href="#DualChartDataModel-581"><span class="linenos">581</span></a><span class="sd">        chart_type: Type of dual chart (Transit, Synastry, Return)</span>
</span><span id="DualChartDataModel-582"><a href="#DualChartDataModel-582"><span class="linenos">582</span></a><span class="sd">        first_subject: Primary astrological subject (natal, base chart)</span>
</span><span id="DualChartDataModel-583"><a href="#DualChartDataModel-583"><span class="linenos">583</span></a><span class="sd">        second_subject: Secondary astrological subject (transit, partner, return)</span>
</span><span id="DualChartDataModel-584"><a href="#DualChartDataModel-584"><span class="linenos">584</span></a><span class="sd">        aspects: Inter-chart aspects between the two subjects</span>
</span><span id="DualChartDataModel-585"><a href="#DualChartDataModel-585"><span class="linenos">585</span></a><span class="sd">        house_comparison: House overlay analysis between subjects</span>
</span><span id="DualChartDataModel-586"><a href="#DualChartDataModel-586"><span class="linenos">586</span></a><span class="sd">        relationship_score: Compatibility scoring (synastry only)</span>
</span><span id="DualChartDataModel-587"><a href="#DualChartDataModel-587"><span class="linenos">587</span></a><span class="sd">        element_distribution: Combined elemental distribution</span>
</span><span id="DualChartDataModel-588"><a href="#DualChartDataModel-588"><span class="linenos">588</span></a><span class="sd">        quality_distribution: Combined modal distribution</span>
</span><span id="DualChartDataModel-589"><a href="#DualChartDataModel-589"><span class="linenos">589</span></a><span class="sd">        active_points: Celestial points included in calculations</span>
</span><span id="DualChartDataModel-590"><a href="#DualChartDataModel-590"><span class="linenos">590</span></a><span class="sd">        active_aspects: Aspect types and orb settings used</span>
</span><span id="DualChartDataModel-591"><a href="#DualChartDataModel-591"><span class="linenos">591</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DualChartDataModel-592"><a href="#DualChartDataModel-592"><span class="linenos">592</span></a>
</span><span id="DualChartDataModel-593"><a href="#DualChartDataModel-593"><span class="linenos">593</span></a>    <span class="c1"># Chart identification</span>
</span><span id="DualChartDataModel-594"><a href="#DualChartDataModel-594"><span class="linenos">594</span></a>    <span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]</span>
</span><span id="DualChartDataModel-595"><a href="#DualChartDataModel-595"><span class="linenos">595</span></a>
</span><span id="DualChartDataModel-596"><a href="#DualChartDataModel-596"><span class="linenos">596</span></a>    <span class="c1"># Dual chart subjects</span>
</span><span id="DualChartDataModel-597"><a href="#DualChartDataModel-597"><span class="linenos">597</span></a>    <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;CompositeSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">]</span>
</span><span id="DualChartDataModel-598"><a href="#DualChartDataModel-598"><span class="linenos">598</span></a>    <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">]</span>
</span><span id="DualChartDataModel-599"><a href="#DualChartDataModel-599"><span class="linenos">599</span></a>
</span><span id="DualChartDataModel-600"><a href="#DualChartDataModel-600"><span class="linenos">600</span></a>    <span class="c1"># Inter-chart aspects analysis</span>
</span><span id="DualChartDataModel-601"><a href="#DualChartDataModel-601"><span class="linenos">601</span></a>    <span class="n">aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AspectModel</span><span class="p">]</span>
</span><span id="DualChartDataModel-602"><a href="#DualChartDataModel-602"><span class="linenos">602</span></a>
</span><span id="DualChartDataModel-603"><a href="#DualChartDataModel-603"><span class="linenos">603</span></a>    <span class="c1"># House comparison analysis</span>
</span><span id="DualChartDataModel-604"><a href="#DualChartDataModel-604"><span class="linenos">604</span></a>    <span class="n">house_comparison</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;HouseComparisonModel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DualChartDataModel-605"><a href="#DualChartDataModel-605"><span class="linenos">605</span></a>
</span><span id="DualChartDataModel-606"><a href="#DualChartDataModel-606"><span class="linenos">606</span></a>    <span class="c1"># Relationship analysis (synastry only)</span>
</span><span id="DualChartDataModel-607"><a href="#DualChartDataModel-607"><span class="linenos">607</span></a>    <span class="n">relationship_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;RelationshipScoreModel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DualChartDataModel-608"><a href="#DualChartDataModel-608"><span class="linenos">608</span></a>
</span><span id="DualChartDataModel-609"><a href="#DualChartDataModel-609"><span class="linenos">609</span></a>    <span class="c1"># Combined element and quality distributions</span>
</span><span id="DualChartDataModel-610"><a href="#DualChartDataModel-610"><span class="linenos">610</span></a>    <span class="n">element_distribution</span><span class="p">:</span> <span class="s2">&quot;ElementDistributionModel&quot;</span>
</span><span id="DualChartDataModel-611"><a href="#DualChartDataModel-611"><span class="linenos">611</span></a>    <span class="n">quality_distribution</span><span class="p">:</span> <span class="s2">&quot;QualityDistributionModel&quot;</span>
</span><span id="DualChartDataModel-612"><a href="#DualChartDataModel-612"><span class="linenos">612</span></a>
</span><span id="DualChartDataModel-613"><a href="#DualChartDataModel-613"><span class="linenos">613</span></a>    <span class="c1"># Configuration and metadata</span>
</span><span id="DualChartDataModel-614"><a href="#DualChartDataModel-614"><span class="linenos">614</span></a>    <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span>
</span><span id="DualChartDataModel-615"><a href="#DualChartDataModel-615"><span class="linenos">615</span></a>    <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;ActiveAspect&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Chart data model for dual-subject astrological charts.</p>

<p>This model contains all pure data from dual-subject charts including both subjects,
inter-chart aspects, house comparisons, relationship analysis, and combined
element/quality distributions. Used for chart types that compare or overlay
two astrological subjects.</p>

<p>Supported chart types:</p>

<ul>
<li>Transit: Natal chart with current planetary transits</li>
<li>Synastry: Relationship compatibility between two people</li>
<li>Return: Natal chart with planetary return comparison</li>
</ul>

<p>Attributes:
    chart_type: Type of dual chart (Transit, Synastry, Return)
    first_subject: Primary astrological subject (natal, base chart)
    second_subject: Secondary astrological subject (transit, partner, return)
    aspects: Inter-chart aspects between the two subjects
    house_comparison: House overlay analysis between subjects
    relationship_score: Compatibility scoring (synastry only)
    element_distribution: Combined elemental distribution
    quality_distribution: Combined modal distribution
    active_points: Celestial points included in calculations
    active_aspects: Aspect types and orb settings used</p>
</div>


                            <div id="DualChartDataModel.chart_type" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_type</span><span class="annotation">: Literal[&#39;Transit&#39;, &#39;Synastry&#39;, &#39;DualReturnChart&#39;]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.chart_type"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.first_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">first_subject</span><span class="annotation">: Union[kerykeion.schemas.kr_models.AstrologicalSubjectModel, kerykeion.schemas.kr_models.CompositeSubjectModel, <a href="#PlanetReturnModel">PlanetReturnModel</a>]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.first_subject"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.second_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">second_subject</span><span class="annotation">: Union[kerykeion.schemas.kr_models.AstrologicalSubjectModel, <a href="#PlanetReturnModel">PlanetReturnModel</a>]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.second_subject"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects</span><span class="annotation">: List[kerykeion.schemas.kr_models.AspectModel]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.aspects"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.house_comparison" class="classattr">
                                <div class="attr variable">
            <span class="name">house_comparison</span><span class="annotation">: Optional[<a href="#HouseComparisonModel">HouseComparisonModel</a>]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.house_comparison"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.relationship_score" class="classattr">
                                <div class="attr variable">
            <span class="name">relationship_score</span><span class="annotation">: Optional[kerykeion.schemas.kr_models.RelationshipScoreModel]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.relationship_score"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.element_distribution" class="classattr">
                                <div class="attr variable">
            <span class="name">element_distribution</span><span class="annotation">: <a href="#ElementDistributionModel">ElementDistributionModel</a></span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.element_distribution"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.quality_distribution" class="classattr">
                                <div class="attr variable">
            <span class="name">quality_distribution</span><span class="annotation">: <a href="#QualityDistributionModel">QualityDistributionModel</a></span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.quality_distribution"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span><span class="annotation">: List[Literal[&#39;Sun&#39;, &#39;Moon&#39;, &#39;Mercury&#39;, &#39;Venus&#39;, &#39;Mars&#39;, &#39;Jupiter&#39;, &#39;Saturn&#39;, &#39;Uranus&#39;, &#39;Neptune&#39;, &#39;Pluto&#39;, &#39;Mean_North_Lunar_Node&#39;, &#39;True_North_Lunar_Node&#39;, &#39;Mean_South_Lunar_Node&#39;, &#39;True_South_Lunar_Node&#39;, &#39;Chiron&#39;, &#39;Mean_Lilith&#39;, &#39;True_Lilith&#39;, &#39;Earth&#39;, &#39;Pholus&#39;, &#39;Ceres&#39;, &#39;Pallas&#39;, &#39;Juno&#39;, &#39;Vesta&#39;, &#39;Eris&#39;, &#39;Sedna&#39;, &#39;Haumea&#39;, &#39;Makemake&#39;, &#39;Ixion&#39;, &#39;Orcus&#39;, &#39;Quaoar&#39;, &#39;Regulus&#39;, &#39;Spica&#39;, &#39;Pars_Fortunae&#39;, &#39;Pars_Spiritus&#39;, &#39;Pars_Amoris&#39;, &#39;Pars_Fidei&#39;, &#39;Vertex&#39;, &#39;Anti_Vertex&#39;, &#39;Ascendant&#39;, &#39;Medium_Coeli&#39;, &#39;Descendant&#39;, &#39;Imum_Coeli&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.active_points"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span><span class="annotation">: List[kerykeion.schemas.kr_models.ActiveAspect]</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.active_aspects"></a>
    
    

                            </div>
                            <div id="DualChartDataModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#DualChartDataModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="ElementDistributionModel">
                            <input id="ElementDistributionModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ElementDistributionModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.SubscriptableBaseModel</span>):

                <label class="view-source-button" for="ElementDistributionModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ElementDistributionModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ElementDistributionModel-481"><a href="#ElementDistributionModel-481"><span class="linenos">481</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ElementDistributionModel</span><span class="p">(</span><span class="n">SubscriptableBaseModel</span><span class="p">):</span>
</span><span id="ElementDistributionModel-482"><a href="#ElementDistributionModel-482"><span class="linenos">482</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ElementDistributionModel-483"><a href="#ElementDistributionModel-483"><span class="linenos">483</span></a><span class="sd">    Model representing element distribution in a chart.</span>
</span><span id="ElementDistributionModel-484"><a href="#ElementDistributionModel-484"><span class="linenos">484</span></a>
</span><span id="ElementDistributionModel-485"><a href="#ElementDistributionModel-485"><span class="linenos">485</span></a><span class="sd">    Attributes:</span>
</span><span id="ElementDistributionModel-486"><a href="#ElementDistributionModel-486"><span class="linenos">486</span></a><span class="sd">        fire: Fire element points total</span>
</span><span id="ElementDistributionModel-487"><a href="#ElementDistributionModel-487"><span class="linenos">487</span></a><span class="sd">        earth: Earth element points total</span>
</span><span id="ElementDistributionModel-488"><a href="#ElementDistributionModel-488"><span class="linenos">488</span></a><span class="sd">        air: Air element points total</span>
</span><span id="ElementDistributionModel-489"><a href="#ElementDistributionModel-489"><span class="linenos">489</span></a><span class="sd">        water: Water element points total</span>
</span><span id="ElementDistributionModel-490"><a href="#ElementDistributionModel-490"><span class="linenos">490</span></a><span class="sd">        fire_percentage: Fire element percentage</span>
</span><span id="ElementDistributionModel-491"><a href="#ElementDistributionModel-491"><span class="linenos">491</span></a><span class="sd">        earth_percentage: Earth element percentage</span>
</span><span id="ElementDistributionModel-492"><a href="#ElementDistributionModel-492"><span class="linenos">492</span></a><span class="sd">        air_percentage: Air element percentage</span>
</span><span id="ElementDistributionModel-493"><a href="#ElementDistributionModel-493"><span class="linenos">493</span></a><span class="sd">        water_percentage: Water element percentage</span>
</span><span id="ElementDistributionModel-494"><a href="#ElementDistributionModel-494"><span class="linenos">494</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ElementDistributionModel-495"><a href="#ElementDistributionModel-495"><span class="linenos">495</span></a>    <span class="n">fire</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ElementDistributionModel-496"><a href="#ElementDistributionModel-496"><span class="linenos">496</span></a>    <span class="n">earth</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ElementDistributionModel-497"><a href="#ElementDistributionModel-497"><span class="linenos">497</span></a>    <span class="n">air</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ElementDistributionModel-498"><a href="#ElementDistributionModel-498"><span class="linenos">498</span></a>    <span class="n">water</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ElementDistributionModel-499"><a href="#ElementDistributionModel-499"><span class="linenos">499</span></a>    <span class="n">fire_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ElementDistributionModel-500"><a href="#ElementDistributionModel-500"><span class="linenos">500</span></a>    <span class="n">earth_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ElementDistributionModel-501"><a href="#ElementDistributionModel-501"><span class="linenos">501</span></a>    <span class="n">air_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ElementDistributionModel-502"><a href="#ElementDistributionModel-502"><span class="linenos">502</span></a>    <span class="n">water_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span></pre></div>


            <div class="docstring"><p>Model representing element distribution in a chart.</p>

<p>Attributes:
    fire: Fire element points total
    earth: Earth element points total
    air: Air element points total
    water: Water element points total
    fire_percentage: Fire element percentage
    earth_percentage: Earth element percentage
    air_percentage: Air element percentage
    water_percentage: Water element percentage</p>
</div>


                            <div id="ElementDistributionModel.fire" class="classattr">
                                <div class="attr variable">
            <span class="name">fire</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.fire"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.earth" class="classattr">
                                <div class="attr variable">
            <span class="name">earth</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.earth"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.air" class="classattr">
                                <div class="attr variable">
            <span class="name">air</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.air"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.water" class="classattr">
                                <div class="attr variable">
            <span class="name">water</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.water"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.fire_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">fire_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.fire_percentage"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.earth_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">earth_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.earth_percentage"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.air_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">air_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.air_percentage"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.water_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">water_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.water_percentage"></a>
    
    

                            </div>
                            <div id="ElementDistributionModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#ElementDistributionModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="QualityDistributionModel">
                            <input id="QualityDistributionModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">QualityDistributionModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.SubscriptableBaseModel</span>):

                <label class="view-source-button" for="QualityDistributionModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QualityDistributionModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QualityDistributionModel-505"><a href="#QualityDistributionModel-505"><span class="linenos">505</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QualityDistributionModel</span><span class="p">(</span><span class="n">SubscriptableBaseModel</span><span class="p">):</span>
</span><span id="QualityDistributionModel-506"><a href="#QualityDistributionModel-506"><span class="linenos">506</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QualityDistributionModel-507"><a href="#QualityDistributionModel-507"><span class="linenos">507</span></a><span class="sd">    Model representing quality distribution in a chart.</span>
</span><span id="QualityDistributionModel-508"><a href="#QualityDistributionModel-508"><span class="linenos">508</span></a>
</span><span id="QualityDistributionModel-509"><a href="#QualityDistributionModel-509"><span class="linenos">509</span></a><span class="sd">    Attributes:</span>
</span><span id="QualityDistributionModel-510"><a href="#QualityDistributionModel-510"><span class="linenos">510</span></a><span class="sd">        cardinal: Cardinal quality points total</span>
</span><span id="QualityDistributionModel-511"><a href="#QualityDistributionModel-511"><span class="linenos">511</span></a><span class="sd">        fixed: Fixed quality points total</span>
</span><span id="QualityDistributionModel-512"><a href="#QualityDistributionModel-512"><span class="linenos">512</span></a><span class="sd">        mutable: Mutable quality points total</span>
</span><span id="QualityDistributionModel-513"><a href="#QualityDistributionModel-513"><span class="linenos">513</span></a><span class="sd">        cardinal_percentage: Cardinal quality percentage</span>
</span><span id="QualityDistributionModel-514"><a href="#QualityDistributionModel-514"><span class="linenos">514</span></a><span class="sd">        fixed_percentage: Fixed quality percentage</span>
</span><span id="QualityDistributionModel-515"><a href="#QualityDistributionModel-515"><span class="linenos">515</span></a><span class="sd">        mutable_percentage: Mutable quality percentage</span>
</span><span id="QualityDistributionModel-516"><a href="#QualityDistributionModel-516"><span class="linenos">516</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="QualityDistributionModel-517"><a href="#QualityDistributionModel-517"><span class="linenos">517</span></a>    <span class="n">cardinal</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="QualityDistributionModel-518"><a href="#QualityDistributionModel-518"><span class="linenos">518</span></a>    <span class="n">fixed</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="QualityDistributionModel-519"><a href="#QualityDistributionModel-519"><span class="linenos">519</span></a>    <span class="n">mutable</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="QualityDistributionModel-520"><a href="#QualityDistributionModel-520"><span class="linenos">520</span></a>    <span class="n">cardinal_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="QualityDistributionModel-521"><a href="#QualityDistributionModel-521"><span class="linenos">521</span></a>    <span class="n">fixed_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="QualityDistributionModel-522"><a href="#QualityDistributionModel-522"><span class="linenos">522</span></a>    <span class="n">mutable_percentage</span><span class="p">:</span> <span class="nb">int</span>
</span></pre></div>


            <div class="docstring"><p>Model representing quality distribution in a chart.</p>

<p>Attributes:
    cardinal: Cardinal quality points total
    fixed: Fixed quality points total
    mutable: Mutable quality points total
    cardinal_percentage: Cardinal quality percentage
    fixed_percentage: Fixed quality percentage
    mutable_percentage: Mutable quality percentage</p>
</div>


                            <div id="QualityDistributionModel.cardinal" class="classattr">
                                <div class="attr variable">
            <span class="name">cardinal</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.cardinal"></a>
    
    

                            </div>
                            <div id="QualityDistributionModel.fixed" class="classattr">
                                <div class="attr variable">
            <span class="name">fixed</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.fixed"></a>
    
    

                            </div>
                            <div id="QualityDistributionModel.mutable" class="classattr">
                                <div class="attr variable">
            <span class="name">mutable</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.mutable"></a>
    
    

                            </div>
                            <div id="QualityDistributionModel.cardinal_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">cardinal_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.cardinal_percentage"></a>
    
    

                            </div>
                            <div id="QualityDistributionModel.fixed_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">fixed_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.fixed_percentage"></a>
    
    

                            </div>
                            <div id="QualityDistributionModel.mutable_percentage" class="classattr">
                                <div class="attr variable">
            <span class="name">mutable_percentage</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.mutable_percentage"></a>
    
    

                            </div>
                            <div id="QualityDistributionModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#QualityDistributionModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="ChartDrawer">
                            <input id="ChartDrawer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ChartDrawer</span>:

                <label class="view-source-button" for="ChartDrawer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer-87"><a href="#ChartDrawer-87"><span class="linenos">  87</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChartDrawer</span><span class="p">:</span>
</span><span id="ChartDrawer-88"><a href="#ChartDrawer-88"><span class="linenos">  88</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-89"><a href="#ChartDrawer-89"><span class="linenos">  89</span></a><span class="sd">    ChartDrawer generates astrological chart visualizations as SVG files from pre-computed chart data.</span>
</span><span id="ChartDrawer-90"><a href="#ChartDrawer-90"><span class="linenos">  90</span></a>
</span><span id="ChartDrawer-91"><a href="#ChartDrawer-91"><span class="linenos">  91</span></a><span class="sd">    This class is designed for pure visualization and requires chart data to be pre-computed using</span>
</span><span id="ChartDrawer-92"><a href="#ChartDrawer-92"><span class="linenos">  92</span></a><span class="sd">    ChartDataFactory. This separation ensures clean architecture where ChartDataFactory handles</span>
</span><span id="ChartDrawer-93"><a href="#ChartDrawer-93"><span class="linenos">  93</span></a><span class="sd">    all calculations (aspects, element/quality distributions, subjects) while ChartDrawer focuses</span>
</span><span id="ChartDrawer-94"><a href="#ChartDrawer-94"><span class="linenos">  94</span></a><span class="sd">    solely on rendering SVG visualizations.</span>
</span><span id="ChartDrawer-95"><a href="#ChartDrawer-95"><span class="linenos">  95</span></a>
</span><span id="ChartDrawer-96"><a href="#ChartDrawer-96"><span class="linenos">  96</span></a><span class="sd">    ChartDrawer supports creating full chart SVGs, wheel-only SVGs, and aspect-grid-only SVGs</span>
</span><span id="ChartDrawer-97"><a href="#ChartDrawer-97"><span class="linenos">  97</span></a><span class="sd">    for various chart types including Natal, Transit, Synastry, and Composite.</span>
</span><span id="ChartDrawer-98"><a href="#ChartDrawer-98"><span class="linenos">  98</span></a><span class="sd">    Charts are rendered using XML templates and drawing utilities, with customizable themes,</span>
</span><span id="ChartDrawer-99"><a href="#ChartDrawer-99"><span class="linenos">  99</span></a><span class="sd">    language, and visual settings.</span>
</span><span id="ChartDrawer-100"><a href="#ChartDrawer-100"><span class="linenos"> 100</span></a>
</span><span id="ChartDrawer-101"><a href="#ChartDrawer-101"><span class="linenos"> 101</span></a><span class="sd">    The generated SVG files are optimized for web use and can be saved to any specified</span>
</span><span id="ChartDrawer-102"><a href="#ChartDrawer-102"><span class="linenos"> 102</span></a><span class="sd">    destination path using the save_svg method.</span>
</span><span id="ChartDrawer-103"><a href="#ChartDrawer-103"><span class="linenos"> 103</span></a>
</span><span id="ChartDrawer-104"><a href="#ChartDrawer-104"><span class="linenos"> 104</span></a><span class="sd">    NOTE:</span>
</span><span id="ChartDrawer-105"><a href="#ChartDrawer-105"><span class="linenos"> 105</span></a><span class="sd">        The generated SVG files are optimized for web use, opening in browsers. If you want to</span>
</span><span id="ChartDrawer-106"><a href="#ChartDrawer-106"><span class="linenos"> 106</span></a><span class="sd">        use them in other applications, you might need to adjust the SVG settings or styles.</span>
</span><span id="ChartDrawer-107"><a href="#ChartDrawer-107"><span class="linenos"> 107</span></a>
</span><span id="ChartDrawer-108"><a href="#ChartDrawer-108"><span class="linenos"> 108</span></a><span class="sd">    Args:</span>
</span><span id="ChartDrawer-109"><a href="#ChartDrawer-109"><span class="linenos"> 109</span></a><span class="sd">        chart_data (ChartDataModel):</span>
</span><span id="ChartDrawer-110"><a href="#ChartDrawer-110"><span class="linenos"> 110</span></a><span class="sd">            Pre-computed chart data from ChartDataFactory containing all subjects, aspects,</span>
</span><span id="ChartDrawer-111"><a href="#ChartDrawer-111"><span class="linenos"> 111</span></a><span class="sd">            element/quality distributions, and other analytical data. This is the ONLY source</span>
</span><span id="ChartDrawer-112"><a href="#ChartDrawer-112"><span class="linenos"> 112</span></a><span class="sd">            of chart information - no calculations are performed by ChartDrawer.</span>
</span><span id="ChartDrawer-113"><a href="#ChartDrawer-113"><span class="linenos"> 113</span></a><span class="sd">        theme (KerykeionChartTheme, optional):</span>
</span><span id="ChartDrawer-114"><a href="#ChartDrawer-114"><span class="linenos"> 114</span></a><span class="sd">            CSS theme for the chart. If None, no default styles are applied. Defaults to &#39;classic&#39;.</span>
</span><span id="ChartDrawer-115"><a href="#ChartDrawer-115"><span class="linenos"> 115</span></a><span class="sd">        double_chart_aspect_grid_type (Literal[&#39;list&#39;, &#39;table&#39;], optional):</span>
</span><span id="ChartDrawer-116"><a href="#ChartDrawer-116"><span class="linenos"> 116</span></a><span class="sd">            Specifies rendering style for double-chart aspect grids. Defaults to &#39;list&#39;.</span>
</span><span id="ChartDrawer-117"><a href="#ChartDrawer-117"><span class="linenos"> 117</span></a><span class="sd">        chart_language (KerykeionChartLanguage, optional):</span>
</span><span id="ChartDrawer-118"><a href="#ChartDrawer-118"><span class="linenos"> 118</span></a><span class="sd">            Language code for chart labels. Defaults to &#39;EN&#39;.</span>
</span><span id="ChartDrawer-119"><a href="#ChartDrawer-119"><span class="linenos"> 119</span></a><span class="sd">        language_pack (dict | None, optional):</span>
</span><span id="ChartDrawer-120"><a href="#ChartDrawer-120"><span class="linenos"> 120</span></a><span class="sd">            Additional translations merged over the bundled defaults for the</span>
</span><span id="ChartDrawer-121"><a href="#ChartDrawer-121"><span class="linenos"> 121</span></a><span class="sd">            selected language. Useful to introduce new languages or override</span>
</span><span id="ChartDrawer-122"><a href="#ChartDrawer-122"><span class="linenos"> 122</span></a><span class="sd">            existing labels.</span>
</span><span id="ChartDrawer-123"><a href="#ChartDrawer-123"><span class="linenos"> 123</span></a><span class="sd">        transparent_background (bool, optional):</span>
</span><span id="ChartDrawer-124"><a href="#ChartDrawer-124"><span class="linenos"> 124</span></a><span class="sd">            Whether to use a transparent background instead of the theme color. Defaults to False.</span>
</span><span id="ChartDrawer-125"><a href="#ChartDrawer-125"><span class="linenos"> 125</span></a>
</span><span id="ChartDrawer-126"><a href="#ChartDrawer-126"><span class="linenos"> 126</span></a><span class="sd">    Public Methods:</span>
</span><span id="ChartDrawer-127"><a href="#ChartDrawer-127"><span class="linenos"> 127</span></a><span class="sd">        makeTemplate(minify=False, remove_css_variables=False) -&gt; str:</span>
</span><span id="ChartDrawer-128"><a href="#ChartDrawer-128"><span class="linenos"> 128</span></a><span class="sd">            Render the full chart SVG as a string without writing to disk. Use `minify=True`</span>
</span><span id="ChartDrawer-129"><a href="#ChartDrawer-129"><span class="linenos"> 129</span></a><span class="sd">            to remove whitespace and quotes, and `remove_css_variables=True` to embed CSS vars.</span>
</span><span id="ChartDrawer-130"><a href="#ChartDrawer-130"><span class="linenos"> 130</span></a>
</span><span id="ChartDrawer-131"><a href="#ChartDrawer-131"><span class="linenos"> 131</span></a><span class="sd">        save_svg(output_path=None, filename=None, minify=False, remove_css_variables=False) -&gt; None:</span>
</span><span id="ChartDrawer-132"><a href="#ChartDrawer-132"><span class="linenos"> 132</span></a><span class="sd">            Generate and write the full chart SVG file to the specified path.</span>
</span><span id="ChartDrawer-133"><a href="#ChartDrawer-133"><span class="linenos"> 133</span></a><span class="sd">            If output_path is None, saves to the user&#39;s home directory.</span>
</span><span id="ChartDrawer-134"><a href="#ChartDrawer-134"><span class="linenos"> 134</span></a><span class="sd">            If filename is None, uses default pattern: &#39;{subject.name} - {chart_type} Chart.svg&#39;.</span>
</span><span id="ChartDrawer-135"><a href="#ChartDrawer-135"><span class="linenos"> 135</span></a>
</span><span id="ChartDrawer-136"><a href="#ChartDrawer-136"><span class="linenos"> 136</span></a><span class="sd">        makeWheelOnlyTemplate(minify=False, remove_css_variables=False) -&gt; str:</span>
</span><span id="ChartDrawer-137"><a href="#ChartDrawer-137"><span class="linenos"> 137</span></a><span class="sd">            Render only the chart wheel (no aspect grid) as an SVG string.</span>
</span><span id="ChartDrawer-138"><a href="#ChartDrawer-138"><span class="linenos"> 138</span></a>
</span><span id="ChartDrawer-139"><a href="#ChartDrawer-139"><span class="linenos"> 139</span></a><span class="sd">        save_wheel_only_svg_file(output_path=None, filename=None, minify=False, remove_css_variables=False) -&gt; None:</span>
</span><span id="ChartDrawer-140"><a href="#ChartDrawer-140"><span class="linenos"> 140</span></a><span class="sd">            Generate and write the wheel-only SVG file to the specified path.</span>
</span><span id="ChartDrawer-141"><a href="#ChartDrawer-141"><span class="linenos"> 141</span></a><span class="sd">            If output_path is None, saves to the user&#39;s home directory.</span>
</span><span id="ChartDrawer-142"><a href="#ChartDrawer-142"><span class="linenos"> 142</span></a><span class="sd">            If filename is None, uses default pattern: &#39;{subject.name} - {chart_type} Chart - Wheel Only.svg&#39;.</span>
</span><span id="ChartDrawer-143"><a href="#ChartDrawer-143"><span class="linenos"> 143</span></a>
</span><span id="ChartDrawer-144"><a href="#ChartDrawer-144"><span class="linenos"> 144</span></a><span class="sd">        makeAspectGridOnlyTemplate(minify=False, remove_css_variables=False) -&gt; str:</span>
</span><span id="ChartDrawer-145"><a href="#ChartDrawer-145"><span class="linenos"> 145</span></a><span class="sd">            Render only the aspect grid as an SVG string.</span>
</span><span id="ChartDrawer-146"><a href="#ChartDrawer-146"><span class="linenos"> 146</span></a>
</span><span id="ChartDrawer-147"><a href="#ChartDrawer-147"><span class="linenos"> 147</span></a><span class="sd">        save_aspect_grid_only_svg_file(output_path=None, filename=None, minify=False, remove_css_variables=False) -&gt; None:</span>
</span><span id="ChartDrawer-148"><a href="#ChartDrawer-148"><span class="linenos"> 148</span></a><span class="sd">            Generate and write the aspect-grid-only SVG file to the specified path.</span>
</span><span id="ChartDrawer-149"><a href="#ChartDrawer-149"><span class="linenos"> 149</span></a><span class="sd">            If output_path is None, saves to the user&#39;s home directory.</span>
</span><span id="ChartDrawer-150"><a href="#ChartDrawer-150"><span class="linenos"> 150</span></a><span class="sd">            If filename is None, uses default pattern: &#39;{subject.name} - {chart_type} Chart - Aspect Grid Only.svg&#39;.</span>
</span><span id="ChartDrawer-151"><a href="#ChartDrawer-151"><span class="linenos"> 151</span></a>
</span><span id="ChartDrawer-152"><a href="#ChartDrawer-152"><span class="linenos"> 152</span></a><span class="sd">    Example:</span>
</span><span id="ChartDrawer-153"><a href="#ChartDrawer-153"><span class="linenos"> 153</span></a><span class="sd">        &gt;&gt;&gt; from kerykeion.astrological_subject_factory import AstrologicalSubjectFactory</span>
</span><span id="ChartDrawer-154"><a href="#ChartDrawer-154"><span class="linenos"> 154</span></a><span class="sd">        &gt;&gt;&gt; from kerykeion.chart_data_factory import ChartDataFactory</span>
</span><span id="ChartDrawer-155"><a href="#ChartDrawer-155"><span class="linenos"> 155</span></a><span class="sd">        &gt;&gt;&gt; from kerykeion.charts.chart_drawer import ChartDrawer</span>
</span><span id="ChartDrawer-156"><a href="#ChartDrawer-156"><span class="linenos"> 156</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="ChartDrawer-157"><a href="#ChartDrawer-157"><span class="linenos"> 157</span></a><span class="sd">        &gt;&gt;&gt; # Step 1: Create subject</span>
</span><span id="ChartDrawer-158"><a href="#ChartDrawer-158"><span class="linenos"> 158</span></a><span class="sd">        &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_birth_data(&quot;John&quot;, 1990, 1, 1, 12, 0, &quot;London&quot;, &quot;GB&quot;)</span>
</span><span id="ChartDrawer-159"><a href="#ChartDrawer-159"><span class="linenos"> 159</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="ChartDrawer-160"><a href="#ChartDrawer-160"><span class="linenos"> 160</span></a><span class="sd">        &gt;&gt;&gt; # Step 2: Pre-compute chart data</span>
</span><span id="ChartDrawer-161"><a href="#ChartDrawer-161"><span class="linenos"> 161</span></a><span class="sd">        &gt;&gt;&gt; chart_data = ChartDataFactory.create_natal_chart_data(subject)</span>
</span><span id="ChartDrawer-162"><a href="#ChartDrawer-162"><span class="linenos"> 162</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="ChartDrawer-163"><a href="#ChartDrawer-163"><span class="linenos"> 163</span></a><span class="sd">        &gt;&gt;&gt; # Step 3: Create visualization</span>
</span><span id="ChartDrawer-164"><a href="#ChartDrawer-164"><span class="linenos"> 164</span></a><span class="sd">        &gt;&gt;&gt; chart_drawer = ChartDrawer(chart_data=chart_data, theme=&quot;classic&quot;)</span>
</span><span id="ChartDrawer-165"><a href="#ChartDrawer-165"><span class="linenos"> 165</span></a><span class="sd">        &gt;&gt;&gt; chart_drawer.save_svg()  # Saves to home directory with default filename</span>
</span><span id="ChartDrawer-166"><a href="#ChartDrawer-166"><span class="linenos"> 166</span></a><span class="sd">        &gt;&gt;&gt; # Or specify custom path and filename:</span>
</span><span id="ChartDrawer-167"><a href="#ChartDrawer-167"><span class="linenos"> 167</span></a><span class="sd">        &gt;&gt;&gt; chart_drawer.save_svg(&quot;/path/to/output/directory&quot;, &quot;my_custom_chart&quot;)</span>
</span><span id="ChartDrawer-168"><a href="#ChartDrawer-168"><span class="linenos"> 168</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-169"><a href="#ChartDrawer-169"><span class="linenos"> 169</span></a>
</span><span id="ChartDrawer-170"><a href="#ChartDrawer-170"><span class="linenos"> 170</span></a>    <span class="c1"># Constants</span>
</span><span id="ChartDrawer-171"><a href="#ChartDrawer-171"><span class="linenos"> 171</span></a>
</span><span id="ChartDrawer-172"><a href="#ChartDrawer-172"><span class="linenos"> 172</span></a>    <span class="n">_DEFAULT_HEIGHT</span> <span class="o">=</span> <span class="mi">550</span>
</span><span id="ChartDrawer-173"><a href="#ChartDrawer-173"><span class="linenos"> 173</span></a>    <span class="n">_DEFAULT_FULL_WIDTH</span> <span class="o">=</span> <span class="mi">1250</span>
</span><span id="ChartDrawer-174"><a href="#ChartDrawer-174"><span class="linenos"> 174</span></a>    <span class="n">_DEFAULT_SYNASTRY_WIDTH</span> <span class="o">=</span> <span class="mi">1570</span>
</span><span id="ChartDrawer-175"><a href="#ChartDrawer-175"><span class="linenos"> 175</span></a>    <span class="n">_DEFAULT_NATAL_WIDTH</span> <span class="o">=</span> <span class="mi">870</span>
</span><span id="ChartDrawer-176"><a href="#ChartDrawer-176"><span class="linenos"> 176</span></a>    <span class="n">_DEFAULT_FULL_WIDTH_WITH_TABLE</span> <span class="o">=</span> <span class="mi">1250</span>
</span><span id="ChartDrawer-177"><a href="#ChartDrawer-177"><span class="linenos"> 177</span></a>    <span class="n">_DEFAULT_ULTRA_WIDE_WIDTH</span> <span class="o">=</span> <span class="mi">1320</span>
</span><span id="ChartDrawer-178"><a href="#ChartDrawer-178"><span class="linenos"> 178</span></a>
</span><span id="ChartDrawer-179"><a href="#ChartDrawer-179"><span class="linenos"> 179</span></a>    <span class="n">_VERTICAL_PADDING_TOP</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="ChartDrawer-180"><a href="#ChartDrawer-180"><span class="linenos"> 180</span></a>    <span class="n">_VERTICAL_PADDING_BOTTOM</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="ChartDrawer-181"><a href="#ChartDrawer-181"><span class="linenos"> 181</span></a>    <span class="n">_TITLE_SPACING</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="ChartDrawer-182"><a href="#ChartDrawer-182"><span class="linenos"> 182</span></a>
</span><span id="ChartDrawer-183"><a href="#ChartDrawer-183"><span class="linenos"> 183</span></a>    <span class="n">_ASPECT_LIST_ASPECTS_PER_COLUMN</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="ChartDrawer-184"><a href="#ChartDrawer-184"><span class="linenos"> 184</span></a>    <span class="n">_ASPECT_LIST_COLUMN_WIDTH</span> <span class="o">=</span> <span class="mi">105</span>
</span><span id="ChartDrawer-185"><a href="#ChartDrawer-185"><span class="linenos"> 185</span></a>
</span><span id="ChartDrawer-186"><a href="#ChartDrawer-186"><span class="linenos"> 186</span></a>    <span class="n">_BASE_VERTICAL_OFFSETS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ChartDrawer-187"><a href="#ChartDrawer-187"><span class="linenos"> 187</span></a>        <span class="s2">&quot;wheel&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="ChartDrawer-188"><a href="#ChartDrawer-188"><span class="linenos"> 188</span></a>        <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-189"><a href="#ChartDrawer-189"><span class="linenos"> 189</span></a>        <span class="s2">&quot;aspect_grid&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="ChartDrawer-190"><a href="#ChartDrawer-190"><span class="linenos"> 190</span></a>        <span class="s2">&quot;aspect_list&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="ChartDrawer-191"><a href="#ChartDrawer-191"><span class="linenos"> 191</span></a>        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-192"><a href="#ChartDrawer-192"><span class="linenos"> 192</span></a>        <span class="s2">&quot;elements&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-193"><a href="#ChartDrawer-193"><span class="linenos"> 193</span></a>        <span class="s2">&quot;qualities&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-194"><a href="#ChartDrawer-194"><span class="linenos"> 194</span></a>        <span class="s2">&quot;lunar_phase&quot;</span><span class="p">:</span> <span class="mi">518</span><span class="p">,</span>
</span><span id="ChartDrawer-195"><a href="#ChartDrawer-195"><span class="linenos"> 195</span></a>        <span class="s2">&quot;bottom_left&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-196"><a href="#ChartDrawer-196"><span class="linenos"> 196</span></a>    <span class="p">}</span>
</span><span id="ChartDrawer-197"><a href="#ChartDrawer-197"><span class="linenos"> 197</span></a>    <span class="n">_MAX_TOP_SHIFT</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="ChartDrawer-198"><a href="#ChartDrawer-198"><span class="linenos"> 198</span></a>    <span class="n">_TOP_SHIFT_FACTOR</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="ChartDrawer-199"><a href="#ChartDrawer-199"><span class="linenos"> 199</span></a>    <span class="n">_ROW_HEIGHT</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="ChartDrawer-200"><a href="#ChartDrawer-200"><span class="linenos"> 200</span></a>
</span><span id="ChartDrawer-201"><a href="#ChartDrawer-201"><span class="linenos"> 201</span></a>    <span class="n">_BASIC_CHART_VIEWBOX</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0 0 </span><span class="si">{</span><span class="n">_DEFAULT_NATAL_WIDTH</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_DEFAULT_HEIGHT</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-202"><a href="#ChartDrawer-202"><span class="linenos"> 202</span></a>    <span class="n">_WIDE_CHART_VIEWBOX</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0 0 </span><span class="si">{</span><span class="n">_DEFAULT_FULL_WIDTH</span><span class="si">}</span><span class="s2"> 546.0&quot;</span>
</span><span id="ChartDrawer-203"><a href="#ChartDrawer-203"><span class="linenos"> 203</span></a>    <span class="n">_ULTRA_WIDE_CHART_VIEWBOX</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0 0 </span><span class="si">{</span><span class="n">_DEFAULT_ULTRA_WIDE_WIDTH</span><span class="si">}</span><span class="s2"> 546.0&quot;</span>
</span><span id="ChartDrawer-204"><a href="#ChartDrawer-204"><span class="linenos"> 204</span></a>    <span class="n">_TRANSIT_CHART_WITH_TABLE_VIWBOX</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0 0 </span><span class="si">{</span><span class="n">_DEFAULT_FULL_WIDTH_WITH_TABLE</span><span class="si">}</span><span class="s2"> 546.0&quot;</span>
</span><span id="ChartDrawer-205"><a href="#ChartDrawer-205"><span class="linenos"> 205</span></a>
</span><span id="ChartDrawer-206"><a href="#ChartDrawer-206"><span class="linenos"> 206</span></a>    <span class="c1"># Set at init</span>
</span><span id="ChartDrawer-207"><a href="#ChartDrawer-207"><span class="linenos"> 207</span></a>    <span class="n">first_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">]</span>
</span><span id="ChartDrawer-208"><a href="#ChartDrawer-208"><span class="linenos"> 208</span></a>    <span class="n">second_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="ChartDrawer-209"><a href="#ChartDrawer-209"><span class="linenos"> 209</span></a>    <span class="n">chart_type</span><span class="p">:</span> <span class="n">ChartType</span>
</span><span id="ChartDrawer-210"><a href="#ChartDrawer-210"><span class="linenos"> 210</span></a>    <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="ChartDrawer-211"><a href="#ChartDrawer-211"><span class="linenos"> 211</span></a>    <span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-212"><a href="#ChartDrawer-212"><span class="linenos"> 212</span></a>    <span class="n">chart_language</span><span class="p">:</span> <span class="n">KerykeionChartLanguage</span>
</span><span id="ChartDrawer-213"><a href="#ChartDrawer-213"><span class="linenos"> 213</span></a>    <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span>
</span><span id="ChartDrawer-214"><a href="#ChartDrawer-214"><span class="linenos"> 214</span></a>    <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span>
</span><span id="ChartDrawer-215"><a href="#ChartDrawer-215"><span class="linenos"> 215</span></a>    <span class="n">transparent_background</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="ChartDrawer-216"><a href="#ChartDrawer-216"><span class="linenos"> 216</span></a>    <span class="n">external_view</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="ChartDrawer-217"><a href="#ChartDrawer-217"><span class="linenos"> 217</span></a>    <span class="n">show_house_position_comparison</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="ChartDrawer-218"><a href="#ChartDrawer-218"><span class="linenos"> 218</span></a>    <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="ChartDrawer-219"><a href="#ChartDrawer-219"><span class="linenos"> 219</span></a>    <span class="n">_language_model</span><span class="p">:</span> <span class="n">KerykeionLanguageModel</span>
</span><span id="ChartDrawer-220"><a href="#ChartDrawer-220"><span class="linenos"> 220</span></a>    <span class="n">_fallback_language_model</span><span class="p">:</span> <span class="n">KerykeionLanguageModel</span>
</span><span id="ChartDrawer-221"><a href="#ChartDrawer-221"><span class="linenos"> 221</span></a>
</span><span id="ChartDrawer-222"><a href="#ChartDrawer-222"><span class="linenos"> 222</span></a>    <span class="c1"># Internal properties</span>
</span><span id="ChartDrawer-223"><a href="#ChartDrawer-223"><span class="linenos"> 223</span></a>    <span class="n">fire</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-224"><a href="#ChartDrawer-224"><span class="linenos"> 224</span></a>    <span class="n">earth</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-225"><a href="#ChartDrawer-225"><span class="linenos"> 225</span></a>    <span class="n">air</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-226"><a href="#ChartDrawer-226"><span class="linenos"> 226</span></a>    <span class="n">water</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-227"><a href="#ChartDrawer-227"><span class="linenos"> 227</span></a>    <span class="n">first_circle_radius</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-228"><a href="#ChartDrawer-228"><span class="linenos"> 228</span></a>    <span class="n">second_circle_radius</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-229"><a href="#ChartDrawer-229"><span class="linenos"> 229</span></a>    <span class="n">third_circle_radius</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-230"><a href="#ChartDrawer-230"><span class="linenos"> 230</span></a>    <span class="n">width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="ChartDrawer-231"><a href="#ChartDrawer-231"><span class="linenos"> 231</span></a>    <span class="n">language_settings</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ChartDrawer-232"><a href="#ChartDrawer-232"><span class="linenos"> 232</span></a>    <span class="n">chart_colors_settings</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ChartDrawer-233"><a href="#ChartDrawer-233"><span class="linenos"> 233</span></a>    <span class="n">planets_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="ChartDrawer-234"><a href="#ChartDrawer-234"><span class="linenos"> 234</span></a>    <span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span><span id="ChartDrawer-235"><a href="#ChartDrawer-235"><span class="linenos"> 235</span></a>    <span class="n">available_planets_setting</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">KerykeionSettingsCelestialPointModel</span><span class="p">]</span>
</span><span id="ChartDrawer-236"><a href="#ChartDrawer-236"><span class="linenos"> 236</span></a>    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-237"><a href="#ChartDrawer-237"><span class="linenos"> 237</span></a>    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ChartDrawer-238"><a href="#ChartDrawer-238"><span class="linenos"> 238</span></a>    <span class="n">geolat</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-239"><a href="#ChartDrawer-239"><span class="linenos"> 239</span></a>    <span class="n">geolon</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="ChartDrawer-240"><a href="#ChartDrawer-240"><span class="linenos"> 240</span></a>    <span class="n">template</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ChartDrawer-241"><a href="#ChartDrawer-241"><span class="linenos"> 241</span></a>
</span><span id="ChartDrawer-242"><a href="#ChartDrawer-242"><span class="linenos"> 242</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ChartDrawer-243"><a href="#ChartDrawer-243"><span class="linenos"> 243</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-244"><a href="#ChartDrawer-244"><span class="linenos"> 244</span></a>        <span class="n">chart_data</span><span class="p">:</span> <span class="s2">&quot;ChartDataModel&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-245"><a href="#ChartDrawer-245"><span class="linenos"> 245</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDrawer-246"><a href="#ChartDrawer-246"><span class="linenos"> 246</span></a>        <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;classic&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-247"><a href="#ChartDrawer-247"><span class="linenos"> 247</span></a>        <span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-248"><a href="#ChartDrawer-248"><span class="linenos"> 248</span></a>        <span class="n">chart_language</span><span class="p">:</span> <span class="n">KerykeionChartLanguage</span> <span class="o">=</span> <span class="s2">&quot;EN&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-249"><a href="#ChartDrawer-249"><span class="linenos"> 249</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDrawer-250"><a href="#ChartDrawer-250"><span class="linenos"> 250</span></a>        <span class="n">external_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-251"><a href="#ChartDrawer-251"><span class="linenos"> 251</span></a>        <span class="n">transparent_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-252"><a href="#ChartDrawer-252"><span class="linenos"> 252</span></a>        <span class="n">colors_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_COLORS</span><span class="p">,</span>
</span><span id="ChartDrawer-253"><a href="#ChartDrawer-253"><span class="linenos"> 253</span></a>        <span class="n">celestial_points_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span><span class="p">,</span>
</span><span id="ChartDrawer-254"><a href="#ChartDrawer-254"><span class="linenos"> 254</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_ASPECTS_SETTINGS</span><span class="p">,</span>
</span><span id="ChartDrawer-255"><a href="#ChartDrawer-255"><span class="linenos"> 255</span></a>        <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDrawer-256"><a href="#ChartDrawer-256"><span class="linenos"> 256</span></a>        <span class="n">show_house_position_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-257"><a href="#ChartDrawer-257"><span class="linenos"> 257</span></a>        <span class="n">show_cusp_position_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-258"><a href="#ChartDrawer-258"><span class="linenos"> 258</span></a>        <span class="n">auto_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-259"><a href="#ChartDrawer-259"><span class="linenos"> 259</span></a>        <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="ChartDrawer-260"><a href="#ChartDrawer-260"><span class="linenos"> 260</span></a>        <span class="n">show_degree_indicators</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-261"><a href="#ChartDrawer-261"><span class="linenos"> 261</span></a>        <span class="n">show_aspect_icons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-262"><a href="#ChartDrawer-262"><span class="linenos"> 262</span></a>    <span class="p">):</span>
</span><span id="ChartDrawer-263"><a href="#ChartDrawer-263"><span class="linenos"> 263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-264"><a href="#ChartDrawer-264"><span class="linenos"> 264</span></a><span class="sd">        Initialize the chart visualizer with pre-computed chart data.</span>
</span><span id="ChartDrawer-265"><a href="#ChartDrawer-265"><span class="linenos"> 265</span></a>
</span><span id="ChartDrawer-266"><a href="#ChartDrawer-266"><span class="linenos"> 266</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-267"><a href="#ChartDrawer-267"><span class="linenos"> 267</span></a><span class="sd">            chart_data (ChartDataModel):</span>
</span><span id="ChartDrawer-268"><a href="#ChartDrawer-268"><span class="linenos"> 268</span></a><span class="sd">                Pre-computed chart data from ChartDataFactory containing all subjects,</span>
</span><span id="ChartDrawer-269"><a href="#ChartDrawer-269"><span class="linenos"> 269</span></a><span class="sd">                aspects, element/quality distributions, and other analytical data.</span>
</span><span id="ChartDrawer-270"><a href="#ChartDrawer-270"><span class="linenos"> 270</span></a><span class="sd">            theme (KerykeionChartTheme or None, optional):</span>
</span><span id="ChartDrawer-271"><a href="#ChartDrawer-271"><span class="linenos"> 271</span></a><span class="sd">                CSS theme to apply; None for default styling.</span>
</span><span id="ChartDrawer-272"><a href="#ChartDrawer-272"><span class="linenos"> 272</span></a><span class="sd">            double_chart_aspect_grid_type (Literal[&#39;list&#39;,&#39;table&#39;], optional):</span>
</span><span id="ChartDrawer-273"><a href="#ChartDrawer-273"><span class="linenos"> 273</span></a><span class="sd">                Layout style for double-chart aspect grids (&#39;list&#39; or &#39;table&#39;).</span>
</span><span id="ChartDrawer-274"><a href="#ChartDrawer-274"><span class="linenos"> 274</span></a><span class="sd">            chart_language (KerykeionChartLanguage, optional):</span>
</span><span id="ChartDrawer-275"><a href="#ChartDrawer-275"><span class="linenos"> 275</span></a><span class="sd">                Language code for chart labels (e.g., &#39;EN&#39;, &#39;IT&#39;).</span>
</span><span id="ChartDrawer-276"><a href="#ChartDrawer-276"><span class="linenos"> 276</span></a><span class="sd">            language_pack (dict | None, optional):</span>
</span><span id="ChartDrawer-277"><a href="#ChartDrawer-277"><span class="linenos"> 277</span></a><span class="sd">                Additional translations merged over the bundled defaults for the</span>
</span><span id="ChartDrawer-278"><a href="#ChartDrawer-278"><span class="linenos"> 278</span></a><span class="sd">                selected language. Useful to introduce new languages or override</span>
</span><span id="ChartDrawer-279"><a href="#ChartDrawer-279"><span class="linenos"> 279</span></a><span class="sd">                existing labels.</span>
</span><span id="ChartDrawer-280"><a href="#ChartDrawer-280"><span class="linenos"> 280</span></a><span class="sd">            external_view (bool, optional):</span>
</span><span id="ChartDrawer-281"><a href="#ChartDrawer-281"><span class="linenos"> 281</span></a><span class="sd">                Whether to use external visualization (planets on outer ring) for single-subject charts. Defaults to False.</span>
</span><span id="ChartDrawer-282"><a href="#ChartDrawer-282"><span class="linenos"> 282</span></a><span class="sd">            transparent_background (bool, optional):</span>
</span><span id="ChartDrawer-283"><a href="#ChartDrawer-283"><span class="linenos"> 283</span></a><span class="sd">                Whether to use a transparent background instead of the theme color. Defaults to False.</span>
</span><span id="ChartDrawer-284"><a href="#ChartDrawer-284"><span class="linenos"> 284</span></a><span class="sd">            custom_title (str or None, optional):</span>
</span><span id="ChartDrawer-285"><a href="#ChartDrawer-285"><span class="linenos"> 285</span></a><span class="sd">                Custom title for the chart. If None, the default title will be used based on chart type. Defaults to None.</span>
</span><span id="ChartDrawer-286"><a href="#ChartDrawer-286"><span class="linenos"> 286</span></a><span class="sd">            show_house_position_comparison (bool, optional):</span>
</span><span id="ChartDrawer-287"><a href="#ChartDrawer-287"><span class="linenos"> 287</span></a><span class="sd">                Whether to render the house position comparison grid (when supported by the chart type).</span>
</span><span id="ChartDrawer-288"><a href="#ChartDrawer-288"><span class="linenos"> 288</span></a><span class="sd">                Defaults to True. Set to False to hide the table and reclaim horizontal space.</span>
</span><span id="ChartDrawer-289"><a href="#ChartDrawer-289"><span class="linenos"> 289</span></a><span class="sd">            show_cusp_position_comparison (bool, optional):</span>
</span><span id="ChartDrawer-290"><a href="#ChartDrawer-290"><span class="linenos"> 290</span></a><span class="sd">                Whether to render the cusp position comparison grid alongside or in place of the house comparison.</span>
</span><span id="ChartDrawer-291"><a href="#ChartDrawer-291"><span class="linenos"> 291</span></a><span class="sd">                Defaults to False so cusp tables are only shown when explicitly requested.</span>
</span><span id="ChartDrawer-292"><a href="#ChartDrawer-292"><span class="linenos"> 292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-293"><a href="#ChartDrawer-293"><span class="linenos"> 293</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer-294"><a href="#ChartDrawer-294"><span class="linenos"> 294</span></a>        <span class="c1"># COMMON INITIALIZATION</span>
</span><span id="ChartDrawer-295"><a href="#ChartDrawer-295"><span class="linenos"> 295</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer-296"><a href="#ChartDrawer-296"><span class="linenos"> 296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span> <span class="o">=</span> <span class="n">chart_language</span>
</span><span id="ChartDrawer-297"><a href="#ChartDrawer-297"><span class="linenos"> 297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">=</span> <span class="n">double_chart_aspect_grid_type</span>
</span><span id="ChartDrawer-298"><a href="#ChartDrawer-298"><span class="linenos"> 298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transparent_background</span> <span class="o">=</span> <span class="n">transparent_background</span>
</span><span id="ChartDrawer-299"><a href="#ChartDrawer-299"><span class="linenos"> 299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span> <span class="o">=</span> <span class="n">external_view</span>
</span><span id="ChartDrawer-300"><a href="#ChartDrawer-300"><span class="linenos"> 300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">colors_settings</span><span class="p">)</span>
</span><span id="ChartDrawer-301"><a href="#ChartDrawer-301"><span class="linenos"> 301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">celestial_points_settings</span><span class="p">]</span>
</span><span id="ChartDrawer-302"><a href="#ChartDrawer-302"><span class="linenos"> 302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span> <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">aspects_settings</span><span class="p">]</span>
</span><span id="ChartDrawer-303"><a href="#ChartDrawer-303"><span class="linenos"> 303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_title</span> <span class="o">=</span> <span class="n">custom_title</span>
</span><span id="ChartDrawer-304"><a href="#ChartDrawer-304"><span class="linenos"> 304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="o">=</span> <span class="n">show_house_position_comparison</span>
</span><span id="ChartDrawer-305"><a href="#ChartDrawer-305"><span class="linenos"> 305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span> <span class="o">=</span> <span class="n">show_cusp_position_comparison</span>
</span><span id="ChartDrawer-306"><a href="#ChartDrawer-306"><span class="linenos"> 306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span> <span class="o">=</span> <span class="n">show_degree_indicators</span>
</span><span id="ChartDrawer-307"><a href="#ChartDrawer-307"><span class="linenos"> 307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_aspect_icons</span> <span class="o">=</span> <span class="n">show_aspect_icons</span>
</span><span id="ChartDrawer-308"><a href="#ChartDrawer-308"><span class="linenos"> 308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_size</span> <span class="o">=</span> <span class="n">auto_size</span>
</span><span id="ChartDrawer-309"><a href="#ChartDrawer-309"><span class="linenos"> 309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_padding</span> <span class="o">=</span> <span class="n">padding</span>
</span><span id="ChartDrawer-310"><a href="#ChartDrawer-310"><span class="linenos"> 310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BASE_VERTICAL_OFFSETS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ChartDrawer-311"><a href="#ChartDrawer-311"><span class="linenos"> 311</span></a>
</span><span id="ChartDrawer-312"><a href="#ChartDrawer-312"><span class="linenos"> 312</span></a>        <span class="c1"># Extract data from ChartDataModel</span>
</span><span id="ChartDrawer-313"><a href="#ChartDrawer-313"><span class="linenos"> 313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_data</span> <span class="o">=</span> <span class="n">chart_data</span>
</span><span id="ChartDrawer-314"><a href="#ChartDrawer-314"><span class="linenos"> 314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer-315"><a href="#ChartDrawer-315"><span class="linenos"> 315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDrawer-316"><a href="#ChartDrawer-316"><span class="linenos"> 316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">active_aspects</span>
</span><span id="ChartDrawer-317"><a href="#ChartDrawer-317"><span class="linenos"> 317</span></a>
</span><span id="ChartDrawer-318"><a href="#ChartDrawer-318"><span class="linenos"> 318</span></a>        <span class="c1"># Extract subjects based on chart type</span>
</span><span id="ChartDrawer-319"><a href="#ChartDrawer-319"><span class="linenos"> 319</span></a>        <span class="k">if</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDrawer-320"><a href="#ChartDrawer-320"><span class="linenos"> 320</span></a>            <span class="c1"># SingleChartDataModel</span>
</span><span id="ChartDrawer-321"><a href="#ChartDrawer-321"><span class="linenos"> 321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="s1">&#39;subject&#39;</span><span class="p">)</span>
</span><span id="ChartDrawer-322"><a href="#ChartDrawer-322"><span class="linenos"> 322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChartDrawer-323"><a href="#ChartDrawer-323"><span class="linenos"> 323</span></a>
</span><span id="ChartDrawer-324"><a href="#ChartDrawer-324"><span class="linenos"> 324</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># DualChartDataModel for Transit, Synastry, DualReturnChart</span>
</span><span id="ChartDrawer-325"><a href="#ChartDrawer-325"><span class="linenos"> 325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="s1">&#39;first_subject&#39;</span><span class="p">)</span>
</span><span id="ChartDrawer-326"><a href="#ChartDrawer-326"><span class="linenos"> 326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="s1">&#39;second_subject&#39;</span><span class="p">)</span>
</span><span id="ChartDrawer-327"><a href="#ChartDrawer-327"><span class="linenos"> 327</span></a>
</span><span id="ChartDrawer-328"><a href="#ChartDrawer-328"><span class="linenos"> 328</span></a>        <span class="c1"># Load settings</span>
</span><span id="ChartDrawer-329"><a href="#ChartDrawer-329"><span class="linenos"> 329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_language_settings</span><span class="p">(</span><span class="n">language_pack</span><span class="p">)</span>
</span><span id="ChartDrawer-330"><a href="#ChartDrawer-330"><span class="linenos"> 330</span></a>
</span><span id="ChartDrawer-331"><a href="#ChartDrawer-331"><span class="linenos"> 331</span></a>        <span class="c1"># Default radius for all charts</span>
</span><span id="ChartDrawer-332"><a href="#ChartDrawer-332"><span class="linenos"> 332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">=</span> <span class="mi">240</span>
</span><span id="ChartDrawer-333"><a href="#ChartDrawer-333"><span class="linenos"> 333</span></a>
</span><span id="ChartDrawer-334"><a href="#ChartDrawer-334"><span class="linenos"> 334</span></a>        <span class="c1"># Configure available planets from chart data</span>
</span><span id="ChartDrawer-335"><a href="#ChartDrawer-335"><span class="linenos"> 335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-336"><a href="#ChartDrawer-336"><span class="linenos"> 336</span></a>        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">:</span>
</span><span id="ChartDrawer-337"><a href="#ChartDrawer-337"><span class="linenos"> 337</span></a>            <span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="ChartDrawer-338"><a href="#ChartDrawer-338"><span class="linenos"> 338</span></a>                <span class="n">body</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDrawer-339"><a href="#ChartDrawer-339"><span class="linenos"> 339</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-340"><a href="#ChartDrawer-340"><span class="linenos"> 340</span></a>
</span><span id="ChartDrawer-341"><a href="#ChartDrawer-341"><span class="linenos"> 341</span></a>        <span class="n">active_points_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">)</span>
</span><span id="ChartDrawer-342"><a href="#ChartDrawer-342"><span class="linenos"> 342</span></a>        <span class="k">if</span> <span class="n">active_points_count</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
</span><span id="ChartDrawer-343"><a href="#ChartDrawer-343"><span class="linenos"> 343</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ChartDrawer-344"><a href="#ChartDrawer-344"><span class="linenos"> 344</span></a>                <span class="s2">&quot;ChartDrawer detected </span><span class="si">%s</span><span class="s2"> active celestial points; rendering may look crowded beyond 24.&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-345"><a href="#ChartDrawer-345"><span class="linenos"> 345</span></a>                <span class="n">active_points_count</span><span class="p">,</span>
</span><span id="ChartDrawer-346"><a href="#ChartDrawer-346"><span class="linenos"> 346</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-347"><a href="#ChartDrawer-347"><span class="linenos"> 347</span></a>
</span><span id="ChartDrawer-348"><a href="#ChartDrawer-348"><span class="linenos"> 348</span></a>        <span class="c1"># Set available celestial points</span>
</span><span id="ChartDrawer-349"><a href="#ChartDrawer-349"><span class="linenos"> 349</span></a>        <span class="n">available_celestial_points_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">]</span>
</span><span id="ChartDrawer-350"><a href="#ChartDrawer-350"><span class="linenos"> 350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_subject_points</span><span class="p">(</span>
</span><span id="ChartDrawer-351"><a href="#ChartDrawer-351"><span class="linenos"> 351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span>
</span><span id="ChartDrawer-352"><a href="#ChartDrawer-352"><span class="linenos"> 352</span></a>            <span class="n">available_celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDrawer-353"><a href="#ChartDrawer-353"><span class="linenos"> 353</span></a>        <span class="p">)</span>
</span><span id="ChartDrawer-354"><a href="#ChartDrawer-354"><span class="linenos"> 354</span></a>
</span><span id="ChartDrawer-355"><a href="#ChartDrawer-355"><span class="linenos"> 355</span></a>        <span class="c1"># Collect secondary subject points for dual charts using the same active set</span>
</span><span id="ChartDrawer-356"><a href="#ChartDrawer-356"><span class="linenos"> 356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KerykeionPointModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-357"><a href="#ChartDrawer-357"><span class="linenos"> 357</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-358"><a href="#ChartDrawer-358"><span class="linenos"> 358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_subject_points</span><span class="p">(</span>
</span><span id="ChartDrawer-359"><a href="#ChartDrawer-359"><span class="linenos"> 359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span>
</span><span id="ChartDrawer-360"><a href="#ChartDrawer-360"><span class="linenos"> 360</span></a>                <span class="n">available_celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDrawer-361"><a href="#ChartDrawer-361"><span class="linenos"> 361</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-362"><a href="#ChartDrawer-362"><span class="linenos"> 362</span></a>
</span><span id="ChartDrawer-363"><a href="#ChartDrawer-363"><span class="linenos"> 363</span></a>        <span class="c1"># ------------------------</span>
</span><span id="ChartDrawer-364"><a href="#ChartDrawer-364"><span class="linenos"> 364</span></a>        <span class="c1"># CHART TYPE SPECIFIC SETUP FROM CHART DATA</span>
</span><span id="ChartDrawer-365"><a href="#ChartDrawer-365"><span class="linenos"> 365</span></a>        <span class="c1"># ------------------------</span>
</span><span id="ChartDrawer-366"><a href="#ChartDrawer-366"><span class="linenos"> 366</span></a>
</span><span id="ChartDrawer-367"><a href="#ChartDrawer-367"><span class="linenos"> 367</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-368"><a href="#ChartDrawer-368"><span class="linenos"> 368</span></a>            <span class="c1"># --- NATAL CHART SETUP ---</span>
</span><span id="ChartDrawer-369"><a href="#ChartDrawer-369"><span class="linenos"> 369</span></a>
</span><span id="ChartDrawer-370"><a href="#ChartDrawer-370"><span class="linenos"> 370</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer-371"><a href="#ChartDrawer-371"><span class="linenos"> 371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer-372"><a href="#ChartDrawer-372"><span class="linenos"> 372</span></a>
</span><span id="ChartDrawer-373"><a href="#ChartDrawer-373"><span class="linenos"> 373</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer-374"><a href="#ChartDrawer-374"><span class="linenos"> 374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-375"><a href="#ChartDrawer-375"><span class="linenos"> 375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span>
</span><span id="ChartDrawer-376"><a href="#ChartDrawer-376"><span class="linenos"> 376</span></a>
</span><span id="ChartDrawer-377"><a href="#ChartDrawer-377"><span class="linenos"> 377</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer-378"><a href="#ChartDrawer-378"><span class="linenos"> 378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer-379"><a href="#ChartDrawer-379"><span class="linenos"> 379</span></a>
</span><span id="ChartDrawer-380"><a href="#ChartDrawer-380"><span class="linenos"> 380</span></a>            <span class="c1"># Circle radii - depends on external_view</span>
</span><span id="ChartDrawer-381"><a href="#ChartDrawer-381"><span class="linenos"> 381</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">:</span>
</span><span id="ChartDrawer-382"><a href="#ChartDrawer-382"><span class="linenos"> 382</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">56</span>
</span><span id="ChartDrawer-383"><a href="#ChartDrawer-383"><span class="linenos"> 383</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">92</span>
</span><span id="ChartDrawer-384"><a href="#ChartDrawer-384"><span class="linenos"> 384</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">112</span>
</span><span id="ChartDrawer-385"><a href="#ChartDrawer-385"><span class="linenos"> 385</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-386"><a href="#ChartDrawer-386"><span class="linenos"> 386</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer-387"><a href="#ChartDrawer-387"><span class="linenos"> 387</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-388"><a href="#ChartDrawer-388"><span class="linenos"> 388</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer-389"><a href="#ChartDrawer-389"><span class="linenos"> 389</span></a>
</span><span id="ChartDrawer-390"><a href="#ChartDrawer-390"><span class="linenos"> 390</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-391"><a href="#ChartDrawer-391"><span class="linenos"> 391</span></a>            <span class="c1"># --- COMPOSITE CHART SETUP ---</span>
</span><span id="ChartDrawer-392"><a href="#ChartDrawer-392"><span class="linenos"> 392</span></a>
</span><span id="ChartDrawer-393"><a href="#ChartDrawer-393"><span class="linenos"> 393</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer-394"><a href="#ChartDrawer-394"><span class="linenos"> 394</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer-395"><a href="#ChartDrawer-395"><span class="linenos"> 395</span></a>
</span><span id="ChartDrawer-396"><a href="#ChartDrawer-396"><span class="linenos"> 396</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer-397"><a href="#ChartDrawer-397"><span class="linenos"> 397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-398"><a href="#ChartDrawer-398"><span class="linenos"> 398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span>
</span><span id="ChartDrawer-399"><a href="#ChartDrawer-399"><span class="linenos"> 399</span></a>
</span><span id="ChartDrawer-400"><a href="#ChartDrawer-400"><span class="linenos"> 400</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer-401"><a href="#ChartDrawer-401"><span class="linenos"> 401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer-402"><a href="#ChartDrawer-402"><span class="linenos"> 402</span></a>
</span><span id="ChartDrawer-403"><a href="#ChartDrawer-403"><span class="linenos"> 403</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer-404"><a href="#ChartDrawer-404"><span class="linenos"> 404</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer-405"><a href="#ChartDrawer-405"><span class="linenos"> 405</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-406"><a href="#ChartDrawer-406"><span class="linenos"> 406</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer-407"><a href="#ChartDrawer-407"><span class="linenos"> 407</span></a>
</span><span id="ChartDrawer-408"><a href="#ChartDrawer-408"><span class="linenos"> 408</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-409"><a href="#ChartDrawer-409"><span class="linenos"> 409</span></a>            <span class="c1"># --- TRANSIT CHART SETUP ---</span>
</span><span id="ChartDrawer-410"><a href="#ChartDrawer-410"><span class="linenos"> 410</span></a>
</span><span id="ChartDrawer-411"><a href="#ChartDrawer-411"><span class="linenos"> 411</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer-412"><a href="#ChartDrawer-412"><span class="linenos"> 412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer-413"><a href="#ChartDrawer-413"><span class="linenos"> 413</span></a>
</span><span id="ChartDrawer-414"><a href="#ChartDrawer-414"><span class="linenos"> 414</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer-415"><a href="#ChartDrawer-415"><span class="linenos"> 415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-416"><a href="#ChartDrawer-416"><span class="linenos"> 416</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-417"><a href="#ChartDrawer-417"><span class="linenos"> 417</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH_WITH_TABLE</span>
</span><span id="ChartDrawer-418"><a href="#ChartDrawer-418"><span class="linenos"> 418</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-419"><a href="#ChartDrawer-419"><span class="linenos"> 419</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH</span>
</span><span id="ChartDrawer-420"><a href="#ChartDrawer-420"><span class="linenos"> 420</span></a>
</span><span id="ChartDrawer-421"><a href="#ChartDrawer-421"><span class="linenos"> 421</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer-422"><a href="#ChartDrawer-422"><span class="linenos"> 422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer-423"><a href="#ChartDrawer-423"><span class="linenos"> 423</span></a>
</span><span id="ChartDrawer-424"><a href="#ChartDrawer-424"><span class="linenos"> 424</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer-425"><a href="#ChartDrawer-425"><span class="linenos"> 425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer-426"><a href="#ChartDrawer-426"><span class="linenos"> 426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-427"><a href="#ChartDrawer-427"><span class="linenos"> 427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer-428"><a href="#ChartDrawer-428"><span class="linenos"> 428</span></a>
</span><span id="ChartDrawer-429"><a href="#ChartDrawer-429"><span class="linenos"> 429</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-430"><a href="#ChartDrawer-430"><span class="linenos"> 430</span></a>            <span class="c1"># --- SYNASTRY CHART SETUP ---</span>
</span><span id="ChartDrawer-431"><a href="#ChartDrawer-431"><span class="linenos"> 431</span></a>
</span><span id="ChartDrawer-432"><a href="#ChartDrawer-432"><span class="linenos"> 432</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer-433"><a href="#ChartDrawer-433"><span class="linenos"> 433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer-434"><a href="#ChartDrawer-434"><span class="linenos"> 434</span></a>
</span><span id="ChartDrawer-435"><a href="#ChartDrawer-435"><span class="linenos"> 435</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer-436"><a href="#ChartDrawer-436"><span class="linenos"> 436</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-437"><a href="#ChartDrawer-437"><span class="linenos"> 437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_SYNASTRY_WIDTH</span>
</span><span id="ChartDrawer-438"><a href="#ChartDrawer-438"><span class="linenos"> 438</span></a>
</span><span id="ChartDrawer-439"><a href="#ChartDrawer-439"><span class="linenos"> 439</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer-440"><a href="#ChartDrawer-440"><span class="linenos"> 440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer-441"><a href="#ChartDrawer-441"><span class="linenos"> 441</span></a>
</span><span id="ChartDrawer-442"><a href="#ChartDrawer-442"><span class="linenos"> 442</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer-443"><a href="#ChartDrawer-443"><span class="linenos"> 443</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer-444"><a href="#ChartDrawer-444"><span class="linenos"> 444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-445"><a href="#ChartDrawer-445"><span class="linenos"> 445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer-446"><a href="#ChartDrawer-446"><span class="linenos"> 446</span></a>
</span><span id="ChartDrawer-447"><a href="#ChartDrawer-447"><span class="linenos"> 447</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-448"><a href="#ChartDrawer-448"><span class="linenos"> 448</span></a>            <span class="c1"># --- RETURN CHART SETUP ---</span>
</span><span id="ChartDrawer-449"><a href="#ChartDrawer-449"><span class="linenos"> 449</span></a>
</span><span id="ChartDrawer-450"><a href="#ChartDrawer-450"><span class="linenos"> 450</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer-451"><a href="#ChartDrawer-451"><span class="linenos"> 451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer-452"><a href="#ChartDrawer-452"><span class="linenos"> 452</span></a>
</span><span id="ChartDrawer-453"><a href="#ChartDrawer-453"><span class="linenos"> 453</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer-454"><a href="#ChartDrawer-454"><span class="linenos"> 454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-455"><a href="#ChartDrawer-455"><span class="linenos"> 455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_ULTRA_WIDE_WIDTH</span>
</span><span id="ChartDrawer-456"><a href="#ChartDrawer-456"><span class="linenos"> 456</span></a>
</span><span id="ChartDrawer-457"><a href="#ChartDrawer-457"><span class="linenos"> 457</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer-458"><a href="#ChartDrawer-458"><span class="linenos"> 458</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer-459"><a href="#ChartDrawer-459"><span class="linenos"> 459</span></a>
</span><span id="ChartDrawer-460"><a href="#ChartDrawer-460"><span class="linenos"> 460</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer-461"><a href="#ChartDrawer-461"><span class="linenos"> 461</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer-462"><a href="#ChartDrawer-462"><span class="linenos"> 462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-463"><a href="#ChartDrawer-463"><span class="linenos"> 463</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer-464"><a href="#ChartDrawer-464"><span class="linenos"> 464</span></a>
</span><span id="ChartDrawer-465"><a href="#ChartDrawer-465"><span class="linenos"> 465</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-466"><a href="#ChartDrawer-466"><span class="linenos"> 466</span></a>            <span class="c1"># --- SINGLE WHEEL RETURN CHART SETUP ---</span>
</span><span id="ChartDrawer-467"><a href="#ChartDrawer-467"><span class="linenos"> 467</span></a>
</span><span id="ChartDrawer-468"><a href="#ChartDrawer-468"><span class="linenos"> 468</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer-469"><a href="#ChartDrawer-469"><span class="linenos"> 469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer-470"><a href="#ChartDrawer-470"><span class="linenos"> 470</span></a>
</span><span id="ChartDrawer-471"><a href="#ChartDrawer-471"><span class="linenos"> 471</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer-472"><a href="#ChartDrawer-472"><span class="linenos"> 472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-473"><a href="#ChartDrawer-473"><span class="linenos"> 473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span>
</span><span id="ChartDrawer-474"><a href="#ChartDrawer-474"><span class="linenos"> 474</span></a>
</span><span id="ChartDrawer-475"><a href="#ChartDrawer-475"><span class="linenos"> 475</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer-476"><a href="#ChartDrawer-476"><span class="linenos"> 476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer-477"><a href="#ChartDrawer-477"><span class="linenos"> 477</span></a>
</span><span id="ChartDrawer-478"><a href="#ChartDrawer-478"><span class="linenos"> 478</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer-479"><a href="#ChartDrawer-479"><span class="linenos"> 479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer-480"><a href="#ChartDrawer-480"><span class="linenos"> 480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-481"><a href="#ChartDrawer-481"><span class="linenos"> 481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer-482"><a href="#ChartDrawer-482"><span class="linenos"> 482</span></a>
</span><span id="ChartDrawer-483"><a href="#ChartDrawer-483"><span class="linenos"> 483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_house_comparison_width_override</span><span class="p">()</span>
</span><span id="ChartDrawer-484"><a href="#ChartDrawer-484"><span class="linenos"> 484</span></a>
</span><span id="ChartDrawer-485"><a href="#ChartDrawer-485"><span class="linenos"> 485</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer-486"><a href="#ChartDrawer-486"><span class="linenos"> 486</span></a>        <span class="c1"># FINAL COMMON SETUP FROM CHART DATA</span>
</span><span id="ChartDrawer-487"><a href="#ChartDrawer-487"><span class="linenos"> 487</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer-488"><a href="#ChartDrawer-488"><span class="linenos"> 488</span></a>
</span><span id="ChartDrawer-489"><a href="#ChartDrawer-489"><span class="linenos"> 489</span></a>        <span class="c1"># Extract pre-computed element and quality distributions</span>
</span><span id="ChartDrawer-490"><a href="#ChartDrawer-490"><span class="linenos"> 490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fire</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">fire</span>
</span><span id="ChartDrawer-491"><a href="#ChartDrawer-491"><span class="linenos"> 491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">earth</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">earth</span>
</span><span id="ChartDrawer-492"><a href="#ChartDrawer-492"><span class="linenos"> 492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">air</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">air</span>
</span><span id="ChartDrawer-493"><a href="#ChartDrawer-493"><span class="linenos"> 493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">water</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">water</span>
</span><span id="ChartDrawer-494"><a href="#ChartDrawer-494"><span class="linenos"> 494</span></a>
</span><span id="ChartDrawer-495"><a href="#ChartDrawer-495"><span class="linenos"> 495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cardinal</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">quality_distribution</span><span class="o">.</span><span class="n">cardinal</span>
</span><span id="ChartDrawer-496"><a href="#ChartDrawer-496"><span class="linenos"> 496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">quality_distribution</span><span class="o">.</span><span class="n">fixed</span>
</span><span id="ChartDrawer-497"><a href="#ChartDrawer-497"><span class="linenos"> 497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">quality_distribution</span><span class="o">.</span><span class="n">mutable</span>
</span><span id="ChartDrawer-498"><a href="#ChartDrawer-498"><span class="linenos"> 498</span></a>
</span><span id="ChartDrawer-499"><a href="#ChartDrawer-499"><span class="linenos"> 499</span></a>        <span class="c1"># Set up theme</span>
</span><span id="ChartDrawer-500"><a href="#ChartDrawer-500"><span class="linenos"> 500</span></a>        <span class="k">if</span> <span class="n">theme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">KerykeionChartTheme</span><span class="p">)</span> <span class="ow">and</span> <span class="n">theme</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-501"><a href="#ChartDrawer-501"><span class="linenos"> 501</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Theme </span><span class="si">{</span><span class="n">theme</span><span class="si">}</span><span class="s2"> is not available. Set None for default theme.&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-502"><a href="#ChartDrawer-502"><span class="linenos"> 502</span></a>
</span><span id="ChartDrawer-503"><a href="#ChartDrawer-503"><span class="linenos"> 503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_up_theme</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
</span><span id="ChartDrawer-504"><a href="#ChartDrawer-504"><span class="linenos"> 504</span></a>
</span><span id="ChartDrawer-505"><a href="#ChartDrawer-505"><span class="linenos"> 505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_dynamic_height_adjustment</span><span class="p">()</span>
</span><span id="ChartDrawer-506"><a href="#ChartDrawer-506"><span class="linenos"> 506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_height_for_extended_aspect_columns</span><span class="p">()</span>
</span><span id="ChartDrawer-507"><a href="#ChartDrawer-507"><span class="linenos"> 507</span></a>        <span class="c1"># Reconcile width with the updated layout once height adjustments are known.</span>
</span><span id="ChartDrawer-508"><a href="#ChartDrawer-508"><span class="linenos"> 508</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_size</span><span class="p">:</span>
</span><span id="ChartDrawer-509"><a href="#ChartDrawer-509"><span class="linenos"> 509</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_width_to_content</span><span class="p">()</span>
</span><span id="ChartDrawer-510"><a href="#ChartDrawer-510"><span class="linenos"> 510</span></a>
</span><span id="ChartDrawer-511"><a href="#ChartDrawer-511"><span class="linenos"> 511</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_count_active_planets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChartDrawer-512"><a href="#ChartDrawer-512"><span class="linenos"> 512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return number of active celestial points in the current chart.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-513"><a href="#ChartDrawer-513"><span class="linenos"> 513</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_active&quot;</span><span class="p">)])</span>
</span><span id="ChartDrawer-514"><a href="#ChartDrawer-514"><span class="linenos"> 514</span></a>
</span><span id="ChartDrawer-515"><a href="#ChartDrawer-515"><span class="linenos"> 515</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_dynamic_height_adjustment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-516"><a href="#ChartDrawer-516"><span class="linenos"> 516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust chart height and vertical offsets based on active points.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-517"><a href="#ChartDrawer-517"><span class="linenos"> 517</span></a>        <span class="n">active_points_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_active_planets</span><span class="p">()</span>
</span><span id="ChartDrawer-518"><a href="#ChartDrawer-518"><span class="linenos"> 518</span></a>
</span><span id="ChartDrawer-519"><a href="#ChartDrawer-519"><span class="linenos"> 519</span></a>        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BASE_VERTICAL_OFFSETS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ChartDrawer-520"><a href="#ChartDrawer-520"><span class="linenos"> 520</span></a>
</span><span id="ChartDrawer-521"><a href="#ChartDrawer-521"><span class="linenos"> 521</span></a>        <span class="n">minimum_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer-522"><a href="#ChartDrawer-522"><span class="linenos"> 522</span></a>
</span><span id="ChartDrawer-523"><a href="#ChartDrawer-523"><span class="linenos"> 523</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-524"><a href="#ChartDrawer-524"><span class="linenos"> 524</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_synastry_height_adjustment</span><span class="p">(</span>
</span><span id="ChartDrawer-525"><a href="#ChartDrawer-525"><span class="linenos"> 525</span></a>                <span class="n">active_points_count</span><span class="o">=</span><span class="n">active_points_count</span><span class="p">,</span>
</span><span id="ChartDrawer-526"><a href="#ChartDrawer-526"><span class="linenos"> 526</span></a>                <span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">,</span>
</span><span id="ChartDrawer-527"><a href="#ChartDrawer-527"><span class="linenos"> 527</span></a>                <span class="n">minimum_height</span><span class="o">=</span><span class="n">minimum_height</span><span class="p">,</span>
</span><span id="ChartDrawer-528"><a href="#ChartDrawer-528"><span class="linenos"> 528</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-529"><a href="#ChartDrawer-529"><span class="linenos"> 529</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-530"><a href="#ChartDrawer-530"><span class="linenos"> 530</span></a>
</span><span id="ChartDrawer-531"><a href="#ChartDrawer-531"><span class="linenos"> 531</span></a>        <span class="k">if</span> <span class="n">active_points_count</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="ChartDrawer-532"><a href="#ChartDrawer-532"><span class="linenos"> 532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">minimum_height</span><span class="p">)</span>
</span><span id="ChartDrawer-533"><a href="#ChartDrawer-533"><span class="linenos"> 533</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span> <span class="o">=</span> <span class="n">offsets</span>
</span><span id="ChartDrawer-534"><a href="#ChartDrawer-534"><span class="linenos"> 534</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-535"><a href="#ChartDrawer-535"><span class="linenos"> 535</span></a>
</span><span id="ChartDrawer-536"><a href="#ChartDrawer-536"><span class="linenos"> 536</span></a>        <span class="n">extra_points</span> <span class="o">=</span> <span class="n">active_points_count</span> <span class="o">-</span> <span class="mi">20</span>
</span><span id="ChartDrawer-537"><a href="#ChartDrawer-537"><span class="linenos"> 537</span></a>        <span class="n">extra_height</span> <span class="o">=</span> <span class="n">extra_points</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ROW_HEIGHT</span>
</span><span id="ChartDrawer-538"><a href="#ChartDrawer-538"><span class="linenos"> 538</span></a>
</span><span id="ChartDrawer-539"><a href="#ChartDrawer-539"><span class="linenos"> 539</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">minimum_height</span> <span class="o">+</span> <span class="n">extra_height</span><span class="p">)</span>
</span><span id="ChartDrawer-540"><a href="#ChartDrawer-540"><span class="linenos"> 540</span></a>
</span><span id="ChartDrawer-541"><a href="#ChartDrawer-541"><span class="linenos"> 541</span></a>        <span class="n">delta_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">minimum_height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ChartDrawer-542"><a href="#ChartDrawer-542"><span class="linenos"> 542</span></a>
</span><span id="ChartDrawer-543"><a href="#ChartDrawer-543"><span class="linenos"> 543</span></a>        <span class="c1"># Anchor wheel, aspect grid/list, and lunar phase to the bottom</span>
</span><span id="ChartDrawer-544"><a href="#ChartDrawer-544"><span class="linenos"> 544</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;wheel&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-545"><a href="#ChartDrawer-545"><span class="linenos"> 545</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_grid&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-546"><a href="#ChartDrawer-546"><span class="linenos"> 546</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_list&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-547"><a href="#ChartDrawer-547"><span class="linenos"> 547</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-548"><a href="#ChartDrawer-548"><span class="linenos"> 548</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;bottom_left&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-549"><a href="#ChartDrawer-549"><span class="linenos"> 549</span></a>
</span><span id="ChartDrawer-550"><a href="#ChartDrawer-550"><span class="linenos"> 550</span></a>        <span class="c1"># Smooth top offsets to keep breathing room near the title and grids</span>
</span><span id="ChartDrawer-551"><a href="#ChartDrawer-551"><span class="linenos"> 551</span></a>        <span class="n">shift</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">extra_points</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TOP_SHIFT_FACTOR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_TOP_SHIFT</span><span class="p">)</span>
</span><span id="ChartDrawer-552"><a href="#ChartDrawer-552"><span class="linenos"> 552</span></a>        <span class="n">top_shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="ChartDrawer-553"><a href="#ChartDrawer-553"><span class="linenos"> 553</span></a>
</span><span id="ChartDrawer-554"><a href="#ChartDrawer-554"><span class="linenos"> 554</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shift</span>
</span><span id="ChartDrawer-555"><a href="#ChartDrawer-555"><span class="linenos"> 555</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top_shift</span>
</span><span id="ChartDrawer-556"><a href="#ChartDrawer-556"><span class="linenos"> 556</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top_shift</span>
</span><span id="ChartDrawer-557"><a href="#ChartDrawer-557"><span class="linenos"> 557</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;qualities&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top_shift</span>
</span><span id="ChartDrawer-558"><a href="#ChartDrawer-558"><span class="linenos"> 558</span></a>
</span><span id="ChartDrawer-559"><a href="#ChartDrawer-559"><span class="linenos"> 559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span> <span class="o">=</span> <span class="n">offsets</span>
</span><span id="ChartDrawer-560"><a href="#ChartDrawer-560"><span class="linenos"> 560</span></a>
</span><span id="ChartDrawer-561"><a href="#ChartDrawer-561"><span class="linenos"> 561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_adjust_height_for_extended_aspect_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-562"><a href="#ChartDrawer-562"><span class="linenos"> 562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure tall aspect columns fit within the SVG for double-chart lists.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-563"><a href="#ChartDrawer-563"><span class="linenos"> 563</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">!=</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-564"><a href="#ChartDrawer-564"><span class="linenos"> 564</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-565"><a href="#ChartDrawer-565"><span class="linenos"> 565</span></a>
</span><span id="ChartDrawer-566"><a href="#ChartDrawer-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-567"><a href="#ChartDrawer-567"><span class="linenos"> 567</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-568"><a href="#ChartDrawer-568"><span class="linenos"> 568</span></a>
</span><span id="ChartDrawer-569"><a href="#ChartDrawer-569"><span class="linenos"> 569</span></a>        <span class="n">total_aspects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;aspects_list&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ChartDrawer-570"><a href="#ChartDrawer-570"><span class="linenos"> 570</span></a>        <span class="k">if</span> <span class="n">total_aspects</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ChartDrawer-571"><a href="#ChartDrawer-571"><span class="linenos"> 571</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-572"><a href="#ChartDrawer-572"><span class="linenos"> 572</span></a>
</span><span id="ChartDrawer-573"><a href="#ChartDrawer-573"><span class="linenos"> 573</span></a>        <span class="n">aspects_per_column</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="ChartDrawer-574"><a href="#ChartDrawer-574"><span class="linenos"> 574</span></a>        <span class="n">extended_column_start</span> <span class="o">=</span> <span class="mi">11</span>  <span class="c1"># Zero-based column index where tall columns begin</span>
</span><span id="ChartDrawer-575"><a href="#ChartDrawer-575"><span class="linenos"> 575</span></a>        <span class="n">base_capacity</span> <span class="o">=</span> <span class="n">aspects_per_column</span> <span class="o">*</span> <span class="n">extended_column_start</span>
</span><span id="ChartDrawer-576"><a href="#ChartDrawer-576"><span class="linenos"> 576</span></a>
</span><span id="ChartDrawer-577"><a href="#ChartDrawer-577"><span class="linenos"> 577</span></a>        <span class="k">if</span> <span class="n">total_aspects</span> <span class="o">&lt;=</span> <span class="n">base_capacity</span><span class="p">:</span>
</span><span id="ChartDrawer-578"><a href="#ChartDrawer-578"><span class="linenos"> 578</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-579"><a href="#ChartDrawer-579"><span class="linenos"> 579</span></a>
</span><span id="ChartDrawer-580"><a href="#ChartDrawer-580"><span class="linenos"> 580</span></a>        <span class="n">translate_y</span> <span class="o">=</span> <span class="mi">273</span>
</span><span id="ChartDrawer-581"><a href="#ChartDrawer-581"><span class="linenos"> 581</span></a>        <span class="n">bottom_padding</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="ChartDrawer-582"><a href="#ChartDrawer-582"><span class="linenos"> 582</span></a>        <span class="n">title_clearance</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="ChartDrawer-583"><a href="#ChartDrawer-583"><span class="linenos"> 583</span></a>        <span class="n">line_height</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="ChartDrawer-584"><a href="#ChartDrawer-584"><span class="linenos"> 584</span></a>        <span class="n">baseline_index</span> <span class="o">=</span> <span class="n">aspects_per_column</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ChartDrawer-585"><a href="#ChartDrawer-585"><span class="linenos"> 585</span></a>        <span class="n">top_limit_index</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="o">-</span><span class="n">translate_y</span> <span class="o">+</span> <span class="n">title_clearance</span><span class="p">)</span> <span class="o">/</span> <span class="n">line_height</span><span class="p">)</span>
</span><span id="ChartDrawer-586"><a href="#ChartDrawer-586"><span class="linenos"> 586</span></a>        <span class="n">max_capacity_by_top</span> <span class="o">=</span> <span class="n">baseline_index</span> <span class="o">-</span> <span class="n">top_limit_index</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ChartDrawer-587"><a href="#ChartDrawer-587"><span class="linenos"> 587</span></a>
</span><span id="ChartDrawer-588"><a href="#ChartDrawer-588"><span class="linenos"> 588</span></a>        <span class="k">if</span> <span class="n">max_capacity_by_top</span> <span class="o">&lt;=</span> <span class="n">aspects_per_column</span><span class="p">:</span>
</span><span id="ChartDrawer-589"><a href="#ChartDrawer-589"><span class="linenos"> 589</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-590"><a href="#ChartDrawer-590"><span class="linenos"> 590</span></a>
</span><span id="ChartDrawer-591"><a href="#ChartDrawer-591"><span class="linenos"> 591</span></a>        <span class="n">target_capacity</span> <span class="o">=</span> <span class="n">max_capacity_by_top</span>
</span><span id="ChartDrawer-592"><a href="#ChartDrawer-592"><span class="linenos"> 592</span></a>        <span class="n">required_available_height</span> <span class="o">=</span> <span class="n">target_capacity</span> <span class="o">*</span> <span class="n">line_height</span>
</span><span id="ChartDrawer-593"><a href="#ChartDrawer-593"><span class="linenos"> 593</span></a>        <span class="n">required_height</span> <span class="o">=</span> <span class="n">translate_y</span> <span class="o">+</span> <span class="n">bottom_padding</span> <span class="o">+</span> <span class="n">required_available_height</span>
</span><span id="ChartDrawer-594"><a href="#ChartDrawer-594"><span class="linenos"> 594</span></a>
</span><span id="ChartDrawer-595"><a href="#ChartDrawer-595"><span class="linenos"> 595</span></a>        <span class="k">if</span> <span class="n">required_height</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
</span><span id="ChartDrawer-596"><a href="#ChartDrawer-596"><span class="linenos"> 596</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-597"><a href="#ChartDrawer-597"><span class="linenos"> 597</span></a>
</span><span id="ChartDrawer-598"><a href="#ChartDrawer-598"><span class="linenos"> 598</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="n">required_height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
</span><span id="ChartDrawer-599"><a href="#ChartDrawer-599"><span class="linenos"> 599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">required_height</span>
</span><span id="ChartDrawer-600"><a href="#ChartDrawer-600"><span class="linenos"> 600</span></a>
</span><span id="ChartDrawer-601"><a href="#ChartDrawer-601"><span class="linenos"> 601</span></a>        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span>
</span><span id="ChartDrawer-602"><a href="#ChartDrawer-602"><span class="linenos"> 602</span></a>        <span class="c1"># Keep bottom-anchored groups aligned after changing the overall height.</span>
</span><span id="ChartDrawer-603"><a href="#ChartDrawer-603"><span class="linenos"> 603</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;wheel&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="ChartDrawer-604"><a href="#ChartDrawer-604"><span class="linenos"> 604</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_grid&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="ChartDrawer-605"><a href="#ChartDrawer-605"><span class="linenos"> 605</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_list&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="ChartDrawer-606"><a href="#ChartDrawer-606"><span class="linenos"> 606</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="ChartDrawer-607"><a href="#ChartDrawer-607"><span class="linenos"> 607</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;bottom_left&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="ChartDrawer-608"><a href="#ChartDrawer-608"><span class="linenos"> 608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span> <span class="o">=</span> <span class="n">offsets</span>
</span><span id="ChartDrawer-609"><a href="#ChartDrawer-609"><span class="linenos"> 609</span></a>
</span><span id="ChartDrawer-610"><a href="#ChartDrawer-610"><span class="linenos"> 610</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_synastry_height_adjustment</span><span class="p">(</span>
</span><span id="ChartDrawer-611"><a href="#ChartDrawer-611"><span class="linenos"> 611</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-612"><a href="#ChartDrawer-612"><span class="linenos"> 612</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDrawer-613"><a href="#ChartDrawer-613"><span class="linenos"> 613</span></a>        <span class="n">active_points_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ChartDrawer-614"><a href="#ChartDrawer-614"><span class="linenos"> 614</span></a>        <span class="n">offsets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="ChartDrawer-615"><a href="#ChartDrawer-615"><span class="linenos"> 615</span></a>        <span class="n">minimum_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ChartDrawer-616"><a href="#ChartDrawer-616"><span class="linenos"> 616</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-617"><a href="#ChartDrawer-617"><span class="linenos"> 617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Specialised dynamic height handling for Synastry charts.</span>
</span><span id="ChartDrawer-618"><a href="#ChartDrawer-618"><span class="linenos"> 618</span></a>
</span><span id="ChartDrawer-619"><a href="#ChartDrawer-619"><span class="linenos"> 619</span></a><span class="sd">        With the planet grids locked to a single column, every additional active</span>
</span><span id="ChartDrawer-620"><a href="#ChartDrawer-620"><span class="linenos"> 620</span></a><span class="sd">        point extends multiple tables vertically (planets, houses, comparisons).</span>
</span><span id="ChartDrawer-621"><a href="#ChartDrawer-621"><span class="linenos"> 621</span></a><span class="sd">        We therefore scale the height using the actual line spacing used by those</span>
</span><span id="ChartDrawer-622"><a href="#ChartDrawer-622"><span class="linenos"> 622</span></a><span class="sd">        tables (14px) and keep the bottom anchored elements aligned.</span>
</span><span id="ChartDrawer-623"><a href="#ChartDrawer-623"><span class="linenos"> 623</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-624"><a href="#ChartDrawer-624"><span class="linenos"> 624</span></a>        <span class="n">base_rows</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># Up to 16 active points fit without extra height</span>
</span><span id="ChartDrawer-625"><a href="#ChartDrawer-625"><span class="linenos"> 625</span></a>        <span class="n">extra_rows</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">active_points_count</span> <span class="o">-</span> <span class="n">base_rows</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ChartDrawer-626"><a href="#ChartDrawer-626"><span class="linenos"> 626</span></a>
</span><span id="ChartDrawer-627"><a href="#ChartDrawer-627"><span class="linenos"> 627</span></a>        <span class="n">synastry_row_height</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="ChartDrawer-628"><a href="#ChartDrawer-628"><span class="linenos"> 628</span></a>        <span class="n">comparison_padding_per_row</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Keeps house comparison grids within view.</span>
</span><span id="ChartDrawer-629"><a href="#ChartDrawer-629"><span class="linenos"> 629</span></a>        <span class="n">extra_height</span> <span class="o">=</span> <span class="n">extra_rows</span> <span class="o">*</span> <span class="p">(</span><span class="n">synastry_row_height</span> <span class="o">+</span> <span class="n">comparison_padding_per_row</span><span class="p">)</span>
</span><span id="ChartDrawer-630"><a href="#ChartDrawer-630"><span class="linenos"> 630</span></a>
</span><span id="ChartDrawer-631"><a href="#ChartDrawer-631"><span class="linenos"> 631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">minimum_height</span> <span class="o">+</span> <span class="n">extra_height</span><span class="p">)</span>
</span><span id="ChartDrawer-632"><a href="#ChartDrawer-632"><span class="linenos"> 632</span></a>
</span><span id="ChartDrawer-633"><a href="#ChartDrawer-633"><span class="linenos"> 633</span></a>        <span class="n">delta_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">minimum_height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ChartDrawer-634"><a href="#ChartDrawer-634"><span class="linenos"> 634</span></a>
</span><span id="ChartDrawer-635"><a href="#ChartDrawer-635"><span class="linenos"> 635</span></a>        <span class="c1"># Move title up for synastry charts</span>
</span><span id="ChartDrawer-636"><a href="#ChartDrawer-636"><span class="linenos"> 636</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="ChartDrawer-637"><a href="#ChartDrawer-637"><span class="linenos"> 637</span></a>
</span><span id="ChartDrawer-638"><a href="#ChartDrawer-638"><span class="linenos"> 638</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;wheel&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-639"><a href="#ChartDrawer-639"><span class="linenos"> 639</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_grid&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-640"><a href="#ChartDrawer-640"><span class="linenos"> 640</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_list&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-641"><a href="#ChartDrawer-641"><span class="linenos"> 641</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-642"><a href="#ChartDrawer-642"><span class="linenos"> 642</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;bottom_left&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_height</span>
</span><span id="ChartDrawer-643"><a href="#ChartDrawer-643"><span class="linenos"> 643</span></a>
</span><span id="ChartDrawer-644"><a href="#ChartDrawer-644"><span class="linenos"> 644</span></a>        <span class="n">row_height_ratio</span> <span class="o">=</span> <span class="n">synastry_row_height</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ROW_HEIGHT</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ChartDrawer-645"><a href="#ChartDrawer-645"><span class="linenos"> 645</span></a>        <span class="n">synastry_top_shift_factor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ChartDrawer-646"><a href="#ChartDrawer-646"><span class="linenos"> 646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_TOP_SHIFT_FACTOR</span><span class="p">,</span>
</span><span id="ChartDrawer-647"><a href="#ChartDrawer-647"><span class="linenos"> 647</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_TOP_SHIFT_FACTOR</span> <span class="o">*</span> <span class="n">row_height_ratio</span><span class="p">)),</span>
</span><span id="ChartDrawer-648"><a href="#ChartDrawer-648"><span class="linenos"> 648</span></a>        <span class="p">)</span>
</span><span id="ChartDrawer-649"><a href="#ChartDrawer-649"><span class="linenos"> 649</span></a>        <span class="n">shift</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">extra_rows</span> <span class="o">*</span> <span class="n">synastry_top_shift_factor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_TOP_SHIFT</span><span class="p">)</span>
</span><span id="ChartDrawer-650"><a href="#ChartDrawer-650"><span class="linenos"> 650</span></a>
</span><span id="ChartDrawer-651"><a href="#ChartDrawer-651"><span class="linenos"> 651</span></a>        <span class="n">base_grid_padding</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-652"><a href="#ChartDrawer-652"><span class="linenos"> 652</span></a>        <span class="n">grid_padding_per_row</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="ChartDrawer-653"><a href="#ChartDrawer-653"><span class="linenos"> 653</span></a>        <span class="n">base_header_padding</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="ChartDrawer-654"><a href="#ChartDrawer-654"><span class="linenos"> 654</span></a>        <span class="n">header_padding_per_row</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="ChartDrawer-655"><a href="#ChartDrawer-655"><span class="linenos"> 655</span></a>        <span class="n">min_title_to_grid_gap</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer-656"><a href="#ChartDrawer-656"><span class="linenos"> 656</span></a>
</span><span id="ChartDrawer-657"><a href="#ChartDrawer-657"><span class="linenos"> 657</span></a>        <span class="n">grid_shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">base_grid_padding</span> <span class="o">+</span> <span class="p">(</span><span class="n">extra_rows</span> <span class="o">*</span> <span class="n">grid_padding_per_row</span><span class="p">)</span>
</span><span id="ChartDrawer-658"><a href="#ChartDrawer-658"><span class="linenos"> 658</span></a>        <span class="n">grid_shift</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">grid_shift</span><span class="p">,</span> <span class="n">shift</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_TOP_SHIFT</span><span class="p">)</span>
</span><span id="ChartDrawer-659"><a href="#ChartDrawer-659"><span class="linenos"> 659</span></a>
</span><span id="ChartDrawer-660"><a href="#ChartDrawer-660"><span class="linenos"> 660</span></a>        <span class="n">top_shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">shift</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_header_padding</span> <span class="o">+</span> <span class="p">(</span><span class="n">extra_rows</span> <span class="o">*</span> <span class="n">header_padding_per_row</span><span class="p">)</span>
</span><span id="ChartDrawer-661"><a href="#ChartDrawer-661"><span class="linenos"> 661</span></a>
</span><span id="ChartDrawer-662"><a href="#ChartDrawer-662"><span class="linenos"> 662</span></a>        <span class="n">max_allowed_shift</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_TOP_SHIFT</span>
</span><span id="ChartDrawer-663"><a href="#ChartDrawer-663"><span class="linenos"> 663</span></a>        <span class="n">missing_gap</span> <span class="o">=</span> <span class="n">min_title_to_grid_gap</span> <span class="o">-</span> <span class="p">(</span><span class="n">grid_shift</span> <span class="o">-</span> <span class="n">top_shift</span><span class="p">)</span>
</span><span id="ChartDrawer-664"><a href="#ChartDrawer-664"><span class="linenos"> 664</span></a>        <span class="n">grid_shift</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">grid_shift</span> <span class="o">+</span> <span class="n">missing_gap</span><span class="p">,</span> <span class="n">max_allowed_shift</span><span class="p">)</span>
</span><span id="ChartDrawer-665"><a href="#ChartDrawer-665"><span class="linenos"> 665</span></a>        <span class="k">if</span> <span class="n">grid_shift</span> <span class="o">-</span> <span class="n">top_shift</span> <span class="o">&lt;</span> <span class="n">min_title_to_grid_gap</span><span class="p">:</span>
</span><span id="ChartDrawer-666"><a href="#ChartDrawer-666"><span class="linenos"> 666</span></a>            <span class="n">top_shift</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid_shift</span> <span class="o">-</span> <span class="n">min_title_to_grid_gap</span><span class="p">)</span>
</span><span id="ChartDrawer-667"><a href="#ChartDrawer-667"><span class="linenos"> 667</span></a>
</span><span id="ChartDrawer-668"><a href="#ChartDrawer-668"><span class="linenos"> 668</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">grid_shift</span>
</span><span id="ChartDrawer-669"><a href="#ChartDrawer-669"><span class="linenos"> 669</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top_shift</span>
</span><span id="ChartDrawer-670"><a href="#ChartDrawer-670"><span class="linenos"> 670</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top_shift</span>
</span><span id="ChartDrawer-671"><a href="#ChartDrawer-671"><span class="linenos"> 671</span></a>        <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;qualities&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">top_shift</span>
</span><span id="ChartDrawer-672"><a href="#ChartDrawer-672"><span class="linenos"> 672</span></a>
</span><span id="ChartDrawer-673"><a href="#ChartDrawer-673"><span class="linenos"> 673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span> <span class="o">=</span> <span class="n">offsets</span>
</span><span id="ChartDrawer-674"><a href="#ChartDrawer-674"><span class="linenos"> 674</span></a>
</span><span id="ChartDrawer-675"><a href="#ChartDrawer-675"><span class="linenos"> 675</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_collect_subject_points</span><span class="p">(</span>
</span><span id="ChartDrawer-676"><a href="#ChartDrawer-676"><span class="linenos"> 676</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-677"><a href="#ChartDrawer-677"><span class="linenos"> 677</span></a>        <span class="n">subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">],</span>
</span><span id="ChartDrawer-678"><a href="#ChartDrawer-678"><span class="linenos"> 678</span></a>        <span class="n">point_attribute_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="ChartDrawer-679"><a href="#ChartDrawer-679"><span class="linenos"> 679</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">KerykeionPointModel</span><span class="p">]:</span>
</span><span id="ChartDrawer-680"><a href="#ChartDrawer-680"><span class="linenos"> 680</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect ordered active celestial points for a subject.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-681"><a href="#ChartDrawer-681"><span class="linenos"> 681</span></a>
</span><span id="ChartDrawer-682"><a href="#ChartDrawer-682"><span class="linenos"> 682</span></a>        <span class="n">collected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KerykeionPointModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-683"><a href="#ChartDrawer-683"><span class="linenos"> 683</span></a>
</span><span id="ChartDrawer-684"><a href="#ChartDrawer-684"><span class="linenos"> 684</span></a>        <span class="k">for</span> <span class="n">raw_name</span> <span class="ow">in</span> <span class="n">point_attribute_names</span><span class="p">:</span>
</span><span id="ChartDrawer-685"><a href="#ChartDrawer-685"><span class="linenos"> 685</span></a>            <span class="n">attr_name</span> <span class="o">=</span> <span class="n">raw_name</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">raw_name</span><span class="p">)</span> <span class="k">else</span> <span class="n">raw_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="ChartDrawer-686"><a href="#ChartDrawer-686"><span class="linenos"> 686</span></a>            <span class="n">point</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ChartDrawer-687"><a href="#ChartDrawer-687"><span class="linenos"> 687</span></a>            <span class="k">if</span> <span class="n">point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-688"><a href="#ChartDrawer-688"><span class="linenos"> 688</span></a>                <span class="k">continue</span>
</span><span id="ChartDrawer-689"><a href="#ChartDrawer-689"><span class="linenos"> 689</span></a>            <span class="n">collected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="ChartDrawer-690"><a href="#ChartDrawer-690"><span class="linenos"> 690</span></a>
</span><span id="ChartDrawer-691"><a href="#ChartDrawer-691"><span class="linenos"> 691</span></a>        <span class="k">return</span> <span class="n">collected</span>
</span><span id="ChartDrawer-692"><a href="#ChartDrawer-692"><span class="linenos"> 692</span></a>
</span><span id="ChartDrawer-693"><a href="#ChartDrawer-693"><span class="linenos"> 693</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_house_comparison_width_override</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-694"><a href="#ChartDrawer-694"><span class="linenos"> 694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shrink chart width when the optional house comparison grid is hidden.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-695"><a href="#ChartDrawer-695"><span class="linenos"> 695</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-696"><a href="#ChartDrawer-696"><span class="linenos"> 696</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-697"><a href="#ChartDrawer-697"><span class="linenos"> 697</span></a>
</span><span id="ChartDrawer-698"><a href="#ChartDrawer-698"><span class="linenos"> 698</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-699"><a href="#ChartDrawer-699"><span class="linenos"> 699</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH</span>
</span><span id="ChartDrawer-700"><a href="#ChartDrawer-700"><span class="linenos"> 700</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-701"><a href="#ChartDrawer-701"><span class="linenos"> 701</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH_WITH_TABLE</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH</span>
</span><span id="ChartDrawer-702"><a href="#ChartDrawer-702"><span class="linenos"> 702</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-703"><a href="#ChartDrawer-703"><span class="linenos"> 703</span></a>            <span class="c1"># Transit charts already use the compact width unless the aspect grid table is requested.</span>
</span><span id="ChartDrawer-704"><a href="#ChartDrawer-704"><span class="linenos"> 704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH_WITH_TABLE</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH</span>
</span><span id="ChartDrawer-705"><a href="#ChartDrawer-705"><span class="linenos"> 705</span></a>
</span><span id="ChartDrawer-706"><a href="#ChartDrawer-706"><span class="linenos"> 706</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_dynamic_viewbox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer-707"><a href="#ChartDrawer-707"><span class="linenos"> 707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the viewBox string based on current width/height with vertical padding.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-708"><a href="#ChartDrawer-708"><span class="linenos"> 708</span></a>        <span class="n">min_y</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_VERTICAL_PADDING_TOP</span>
</span><span id="ChartDrawer-709"><a href="#ChartDrawer-709"><span class="linenos"> 709</span></a>        <span class="n">viewbox_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VERTICAL_PADDING_TOP</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VERTICAL_PADDING_BOTTOM</span>
</span><span id="ChartDrawer-710"><a href="#ChartDrawer-710"><span class="linenos"> 710</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;0 </span><span class="si">{</span><span class="n">min_y</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">viewbox_height</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-711"><a href="#ChartDrawer-711"><span class="linenos"> 711</span></a>
</span><span id="ChartDrawer-712"><a href="#ChartDrawer-712"><span class="linenos"> 712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_wheel_only_viewbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer-713"><a href="#ChartDrawer-713"><span class="linenos"> 713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a tight viewBox for the wheel-only template.</span>
</span><span id="ChartDrawer-714"><a href="#ChartDrawer-714"><span class="linenos"> 714</span></a>
</span><span id="ChartDrawer-715"><a href="#ChartDrawer-715"><span class="linenos"> 715</span></a><span class="sd">        The wheel is drawn inside a group translated by (100, 50) and has</span>
</span><span id="ChartDrawer-716"><a href="#ChartDrawer-716"><span class="linenos"> 716</span></a><span class="sd">        diameter 2 * main_radius. We add a small margin around it.</span>
</span><span id="ChartDrawer-717"><a href="#ChartDrawer-717"><span class="linenos"> 717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-718"><a href="#ChartDrawer-718"><span class="linenos"> 718</span></a>        <span class="n">left</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">margin</span>
</span><span id="ChartDrawer-719"><a href="#ChartDrawer-719"><span class="linenos"> 719</span></a>        <span class="n">top</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">-</span> <span class="n">margin</span>
</span><span id="ChartDrawer-720"><a href="#ChartDrawer-720"><span class="linenos"> 720</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">margin</span><span class="p">)</span>
</span><span id="ChartDrawer-721"><a href="#ChartDrawer-721"><span class="linenos"> 721</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">margin</span><span class="p">)</span>
</span><span id="ChartDrawer-722"><a href="#ChartDrawer-722"><span class="linenos"> 722</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">top</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-723"><a href="#ChartDrawer-723"><span class="linenos"> 723</span></a>
</span><span id="ChartDrawer-724"><a href="#ChartDrawer-724"><span class="linenos"> 724</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_grid_only_viewbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer-725"><a href="#ChartDrawer-725"><span class="linenos"> 725</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute a tight viewBox for the Aspect Grid Only SVG.</span>
</span><span id="ChartDrawer-726"><a href="#ChartDrawer-726"><span class="linenos"> 726</span></a>
</span><span id="ChartDrawer-727"><a href="#ChartDrawer-727"><span class="linenos"> 727</span></a><span class="sd">        The grid is rendered using fixed origins and box size:</span>
</span><span id="ChartDrawer-728"><a href="#ChartDrawer-728"><span class="linenos"> 728</span></a><span class="sd">        - For Transit/Synastry/DualReturn charts, `draw_transit_aspect_grid`</span>
</span><span id="ChartDrawer-729"><a href="#ChartDrawer-729"><span class="linenos"> 729</span></a><span class="sd">          uses `x_indent=50`, `y_indent=250`, `box_size=14` and draws:</span>
</span><span id="ChartDrawer-730"><a href="#ChartDrawer-730"><span class="linenos"> 730</span></a><span class="sd">             a header row to the right of `x_indent`</span>
</span><span id="ChartDrawer-731"><a href="#ChartDrawer-731"><span class="linenos"> 731</span></a><span class="sd">             a left header column at `x_indent - box_size`</span>
</span><span id="ChartDrawer-732"><a href="#ChartDrawer-732"><span class="linenos"> 732</span></a><span class="sd">             an NxN grid of cells above `y_indent`</span>
</span><span id="ChartDrawer-733"><a href="#ChartDrawer-733"><span class="linenos"> 733</span></a>
</span><span id="ChartDrawer-734"><a href="#ChartDrawer-734"><span class="linenos"> 734</span></a><span class="sd">        - For Natal/Composite/SingleReturn charts, `draw_aspect_grid` uses</span>
</span><span id="ChartDrawer-735"><a href="#ChartDrawer-735"><span class="linenos"> 735</span></a><span class="sd">          `x_start=50`, `y_start=250`, `box_size=14` and draws a triangular grid</span>
</span><span id="ChartDrawer-736"><a href="#ChartDrawer-736"><span class="linenos"> 736</span></a><span class="sd">          that extends to the right (x) and upwards (y).</span>
</span><span id="ChartDrawer-737"><a href="#ChartDrawer-737"><span class="linenos"> 737</span></a>
</span><span id="ChartDrawer-738"><a href="#ChartDrawer-738"><span class="linenos"> 738</span></a><span class="sd">        This function mirrors that geometry to return a snug viewBox around the</span>
</span><span id="ChartDrawer-739"><a href="#ChartDrawer-739"><span class="linenos"> 739</span></a><span class="sd">        content, with a small configurable `margin`.</span>
</span><span id="ChartDrawer-740"><a href="#ChartDrawer-740"><span class="linenos"> 740</span></a>
</span><span id="ChartDrawer-741"><a href="#ChartDrawer-741"><span class="linenos"> 741</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-742"><a href="#ChartDrawer-742"><span class="linenos"> 742</span></a><span class="sd">            margin: Extra pixels to add on each side of the computed bounds.</span>
</span><span id="ChartDrawer-743"><a href="#ChartDrawer-743"><span class="linenos"> 743</span></a>
</span><span id="ChartDrawer-744"><a href="#ChartDrawer-744"><span class="linenos"> 744</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-745"><a href="#ChartDrawer-745"><span class="linenos"> 745</span></a><span class="sd">            A string &quot;minX minY width height&quot; suitable for the SVG `viewBox`.</span>
</span><span id="ChartDrawer-746"><a href="#ChartDrawer-746"><span class="linenos"> 746</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-747"><a href="#ChartDrawer-747"><span class="linenos"> 747</span></a>        <span class="c1"># Must match defaults used in the renderers</span>
</span><span id="ChartDrawer-748"><a href="#ChartDrawer-748"><span class="linenos"> 748</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="ChartDrawer-749"><a href="#ChartDrawer-749"><span class="linenos"> 749</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="mi">250</span>
</span><span id="ChartDrawer-750"><a href="#ChartDrawer-750"><span class="linenos"> 750</span></a>        <span class="n">box</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="ChartDrawer-751"><a href="#ChartDrawer-751"><span class="linenos"> 751</span></a>
</span><span id="ChartDrawer-752"><a href="#ChartDrawer-752"><span class="linenos"> 752</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_active&quot;</span><span class="p">)]),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ChartDrawer-753"><a href="#ChartDrawer-753"><span class="linenos"> 753</span></a>
</span><span id="ChartDrawer-754"><a href="#ChartDrawer-754"><span class="linenos"> 754</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-755"><a href="#ChartDrawer-755"><span class="linenos"> 755</span></a>            <span class="c1"># Full NN grid</span>
</span><span id="ChartDrawer-756"><a href="#ChartDrawer-756"><span class="linenos"> 756</span></a>            <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">box</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span>
</span><span id="ChartDrawer-757"><a href="#ChartDrawer-757"><span class="linenos"> 757</span></a>            <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">box</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span>
</span><span id="ChartDrawer-758"><a href="#ChartDrawer-758"><span class="linenos"> 758</span></a>            <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">box</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span>
</span><span id="ChartDrawer-759"><a href="#ChartDrawer-759"><span class="linenos"> 759</span></a>            <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span>
</span><span id="ChartDrawer-760"><a href="#ChartDrawer-760"><span class="linenos"> 760</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-761"><a href="#ChartDrawer-761"><span class="linenos"> 761</span></a>            <span class="c1"># Triangular grid (no extra left column)</span>
</span><span id="ChartDrawer-762"><a href="#ChartDrawer-762"><span class="linenos"> 762</span></a>            <span class="n">left</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">margin</span>
</span><span id="ChartDrawer-763"><a href="#ChartDrawer-763"><span class="linenos"> 763</span></a>            <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">box</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">margin</span>
</span><span id="ChartDrawer-764"><a href="#ChartDrawer-764"><span class="linenos"> 764</span></a>            <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">box</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span>
</span><span id="ChartDrawer-765"><a href="#ChartDrawer-765"><span class="linenos"> 765</span></a>            <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="p">)</span> <span class="o">+</span> <span class="n">margin</span>
</span><span id="ChartDrawer-766"><a href="#ChartDrawer-766"><span class="linenos"> 766</span></a>
</span><span id="ChartDrawer-767"><a href="#ChartDrawer-767"><span class="linenos"> 767</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">))</span>
</span><span id="ChartDrawer-768"><a href="#ChartDrawer-768"><span class="linenos"> 768</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span><span class="p">))</span>
</span><span id="ChartDrawer-769"><a href="#ChartDrawer-769"><span class="linenos"> 769</span></a>
</span><span id="ChartDrawer-770"><a href="#ChartDrawer-770"><span class="linenos"> 770</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">left</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">top</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-771"><a href="#ChartDrawer-771"><span class="linenos"> 771</span></a>
</span><span id="ChartDrawer-772"><a href="#ChartDrawer-772"><span class="linenos"> 772</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_estimate_required_width_full</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChartDrawer-773"><a href="#ChartDrawer-773"><span class="linenos"> 773</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate minimal width to contain all rendered groups for the full chart.</span>
</span><span id="ChartDrawer-774"><a href="#ChartDrawer-774"><span class="linenos"> 774</span></a>
</span><span id="ChartDrawer-775"><a href="#ChartDrawer-775"><span class="linenos"> 775</span></a><span class="sd">        The calculation is heuristic and mirrors the default x positions used in</span>
</span><span id="ChartDrawer-776"><a href="#ChartDrawer-776"><span class="linenos"> 776</span></a><span class="sd">        the SVG templates and drawing utilities. We keep a conservative padding.</span>
</span><span id="ChartDrawer-777"><a href="#ChartDrawer-777"><span class="linenos"> 777</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-778"><a href="#ChartDrawer-778"><span class="linenos"> 778</span></a>        <span class="c1"># Wheel footprint (translate(100,50) + diameter of 2*radius)</span>
</span><span id="ChartDrawer-779"><a href="#ChartDrawer-779"><span class="linenos"> 779</span></a>        <span class="n">wheel_right</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">)</span>
</span><span id="ChartDrawer-780"><a href="#ChartDrawer-780"><span class="linenos"> 780</span></a>        <span class="n">extents</span> <span class="o">=</span> <span class="p">[</span><span class="n">wheel_right</span><span class="p">]</span>
</span><span id="ChartDrawer-781"><a href="#ChartDrawer-781"><span class="linenos"> 781</span></a>
</span><span id="ChartDrawer-782"><a href="#ChartDrawer-782"><span class="linenos"> 782</span></a>        <span class="n">n_active</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_count_active_planets</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ChartDrawer-783"><a href="#ChartDrawer-783"><span class="linenos"> 783</span></a>
</span><span id="ChartDrawer-784"><a href="#ChartDrawer-784"><span class="linenos"> 784</span></a>        <span class="c1"># Common grids present on many chart types</span>
</span><span id="ChartDrawer-785"><a href="#ChartDrawer-785"><span class="linenos"> 785</span></a>        <span class="n">main_planet_grid_right</span> <span class="o">=</span> <span class="mi">645</span> <span class="o">+</span> <span class="mi">80</span>
</span><span id="ChartDrawer-786"><a href="#ChartDrawer-786"><span class="linenos"> 786</span></a>        <span class="n">main_houses_grid_right</span> <span class="o">=</span> <span class="mi">750</span> <span class="o">+</span> <span class="mi">120</span>
</span><span id="ChartDrawer-787"><a href="#ChartDrawer-787"><span class="linenos"> 787</span></a>        <span class="n">extents</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">main_planet_grid_right</span><span class="p">,</span> <span class="n">main_houses_grid_right</span><span class="p">])</span>
</span><span id="ChartDrawer-788"><a href="#ChartDrawer-788"><span class="linenos"> 788</span></a>
</span><span id="ChartDrawer-789"><a href="#ChartDrawer-789"><span class="linenos"> 789</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-790"><a href="#ChartDrawer-790"><span class="linenos"> 790</span></a>            <span class="c1"># Triangular aspect grid at x_start=540, width ~ 14 * n_active</span>
</span><span id="ChartDrawer-791"><a href="#ChartDrawer-791"><span class="linenos"> 791</span></a>            <span class="n">aspect_grid_right</span> <span class="o">=</span> <span class="mi">560</span> <span class="o">+</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">n_active</span>
</span><span id="ChartDrawer-792"><a href="#ChartDrawer-792"><span class="linenos"> 792</span></a>            <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect_grid_right</span><span class="p">)</span>
</span><span id="ChartDrawer-793"><a href="#ChartDrawer-793"><span class="linenos"> 793</span></a>
</span><span id="ChartDrawer-794"><a href="#ChartDrawer-794"><span class="linenos"> 794</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-795"><a href="#ChartDrawer-795"><span class="linenos"> 795</span></a>            <span class="c1"># Double-chart aspects placement</span>
</span><span id="ChartDrawer-796"><a href="#ChartDrawer-796"><span class="linenos"> 796</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-797"><a href="#ChartDrawer-797"><span class="linenos"> 797</span></a>                <span class="n">total_aspects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;aspects_list&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ChartDrawer-798"><a href="#ChartDrawer-798"><span class="linenos"> 798</span></a>                <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_double_chart_aspect_columns</span><span class="p">(</span><span class="n">total_aspects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="ChartDrawer-799"><a href="#ChartDrawer-799"><span class="linenos"> 799</span></a>                <span class="n">columns</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ChartDrawer-800"><a href="#ChartDrawer-800"><span class="linenos"> 800</span></a>                <span class="n">aspect_list_right</span> <span class="o">=</span> <span class="mi">565</span> <span class="o">+</span> <span class="p">(</span><span class="n">columns</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ASPECT_LIST_COLUMN_WIDTH</span><span class="p">)</span>
</span><span id="ChartDrawer-801"><a href="#ChartDrawer-801"><span class="linenos"> 801</span></a>                <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect_list_right</span><span class="p">)</span>
</span><span id="ChartDrawer-802"><a href="#ChartDrawer-802"><span class="linenos"> 802</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-803"><a href="#ChartDrawer-803"><span class="linenos"> 803</span></a>                <span class="c1"># Grid table placed with x_indent ~550, width ~ 14px per cell across n_active+1</span>
</span><span id="ChartDrawer-804"><a href="#ChartDrawer-804"><span class="linenos"> 804</span></a>                <span class="n">aspect_grid_table_right</span> <span class="o">=</span> <span class="mi">550</span> <span class="o">+</span> <span class="p">(</span><span class="mi">14</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_active</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="ChartDrawer-805"><a href="#ChartDrawer-805"><span class="linenos"> 805</span></a>                <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aspect_grid_table_right</span><span class="p">)</span>
</span><span id="ChartDrawer-806"><a href="#ChartDrawer-806"><span class="linenos"> 806</span></a>
</span><span id="ChartDrawer-807"><a href="#ChartDrawer-807"><span class="linenos"> 807</span></a>            <span class="c1"># Secondary grids</span>
</span><span id="ChartDrawer-808"><a href="#ChartDrawer-808"><span class="linenos"> 808</span></a>            <span class="n">secondary_planet_grid_right</span> <span class="o">=</span> <span class="mi">910</span> <span class="o">+</span> <span class="mi">80</span>
</span><span id="ChartDrawer-809"><a href="#ChartDrawer-809"><span class="linenos"> 809</span></a>            <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">secondary_planet_grid_right</span><span class="p">)</span>
</span><span id="ChartDrawer-810"><a href="#ChartDrawer-810"><span class="linenos"> 810</span></a>
</span><span id="ChartDrawer-811"><a href="#ChartDrawer-811"><span class="linenos"> 811</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-812"><a href="#ChartDrawer-812"><span class="linenos"> 812</span></a>                <span class="c1"># Secondary houses grid default x ~ 1015</span>
</span><span id="ChartDrawer-813"><a href="#ChartDrawer-813"><span class="linenos"> 813</span></a>                <span class="n">secondary_houses_grid_right</span> <span class="o">=</span> <span class="mi">1015</span> <span class="o">+</span> <span class="mi">120</span>
</span><span id="ChartDrawer-814"><a href="#ChartDrawer-814"><span class="linenos"> 814</span></a>                <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">secondary_houses_grid_right</span><span class="p">)</span>
</span><span id="ChartDrawer-815"><a href="#ChartDrawer-815"><span class="linenos"> 815</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-816"><a href="#ChartDrawer-816"><span class="linenos"> 816</span></a>                    <span class="n">point_column_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="s2">&quot;Point&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-817"><a href="#ChartDrawer-817"><span class="linenos"> 817</span></a>                    <span class="n">first_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-818"><a href="#ChartDrawer-818"><span class="linenos"> 818</span></a>                    <span class="n">second_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-819"><a href="#ChartDrawer-819"><span class="linenos"> 819</span></a>
</span><span id="ChartDrawer-820"><a href="#ChartDrawer-820"><span class="linenos"> 820</span></a>                    <span class="n">first_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-821"><a href="#ChartDrawer-821"><span class="linenos"> 821</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_subject_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-822"><a href="#ChartDrawer-822"><span class="linenos"> 822</span></a>                        <span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-823"><a href="#ChartDrawer-823"><span class="linenos"> 823</span></a>                        <span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-824"><a href="#ChartDrawer-824"><span class="linenos"> 824</span></a>                    <span class="p">]</span>
</span><span id="ChartDrawer-825"><a href="#ChartDrawer-825"><span class="linenos"> 825</span></a>                    <span class="n">second_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-826"><a href="#ChartDrawer-826"><span class="linenos"> 826</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">second_subject_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-827"><a href="#ChartDrawer-827"><span class="linenos"> 827</span></a>                        <span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-828"><a href="#ChartDrawer-828"><span class="linenos"> 828</span></a>                        <span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-829"><a href="#ChartDrawer-829"><span class="linenos"> 829</span></a>                    <span class="p">]</span>
</span><span id="ChartDrawer-830"><a href="#ChartDrawer-830"><span class="linenos"> 830</span></a>
</span><span id="ChartDrawer-831"><a href="#ChartDrawer-831"><span class="linenos"> 831</span></a>                    <span class="n">first_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-832"><a href="#ChartDrawer-832"><span class="linenos"> 832</span></a>                        <span class="n">column_labels</span><span class="o">=</span><span class="n">first_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-833"><a href="#ChartDrawer-833"><span class="linenos"> 833</span></a>                        <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-834"><a href="#ChartDrawer-834"><span class="linenos"> 834</span></a>                        <span class="n">include_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-835"><a href="#ChartDrawer-835"><span class="linenos"> 835</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-836"><a href="#ChartDrawer-836"><span class="linenos"> 836</span></a>                    <span class="n">second_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-837"><a href="#ChartDrawer-837"><span class="linenos"> 837</span></a>                        <span class="n">column_labels</span><span class="o">=</span><span class="n">second_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-838"><a href="#ChartDrawer-838"><span class="linenos"> 838</span></a>                        <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-839"><a href="#ChartDrawer-839"><span class="linenos"> 839</span></a>                        <span class="n">include_title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-840"><a href="#ChartDrawer-840"><span class="linenos"> 840</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-841"><a href="#ChartDrawer-841"><span class="linenos"> 841</span></a>
</span><span id="ChartDrawer-842"><a href="#ChartDrawer-842"><span class="linenos"> 842</span></a>                    <span class="n">first_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1090</span> <span class="o">+</span> <span class="n">first_grid_width</span>
</span><span id="ChartDrawer-843"><a href="#ChartDrawer-843"><span class="linenos"> 843</span></a>                    <span class="n">second_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1290</span> <span class="o">+</span> <span class="n">second_grid_width</span>
</span><span id="ChartDrawer-844"><a href="#ChartDrawer-844"><span class="linenos"> 844</span></a>                    <span class="n">extents</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">first_house_comparison_grid_right</span><span class="p">,</span> <span class="n">second_house_comparison_grid_right</span><span class="p">])</span>
</span><span id="ChartDrawer-845"><a href="#ChartDrawer-845"><span class="linenos"> 845</span></a>
</span><span id="ChartDrawer-846"><a href="#ChartDrawer-846"><span class="linenos"> 846</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-847"><a href="#ChartDrawer-847"><span class="linenos"> 847</span></a>                        <span class="c1"># Cusp comparison block positioned to the right of both point grids.</span>
</span><span id="ChartDrawer-848"><a href="#ChartDrawer-848"><span class="linenos"> 848</span></a>                        <span class="c1"># In Synastry we render two cusp grids side by side; reserve</span>
</span><span id="ChartDrawer-849"><a href="#ChartDrawer-849"><span class="linenos"> 849</span></a>                        <span class="c1"># enough horizontal space for both tables plus a small gap.</span>
</span><span id="ChartDrawer-850"><a href="#ChartDrawer-850"><span class="linenos"> 850</span></a>                        <span class="n">max_house_comparison_right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ChartDrawer-851"><a href="#ChartDrawer-851"><span class="linenos"> 851</span></a>                            <span class="n">first_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-852"><a href="#ChartDrawer-852"><span class="linenos"> 852</span></a>                            <span class="n">second_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-853"><a href="#ChartDrawer-853"><span class="linenos"> 853</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-854"><a href="#ChartDrawer-854"><span class="linenos"> 854</span></a>                        <span class="n">cusp_grid_width</span> <span class="o">=</span> <span class="mf">160.0</span>
</span><span id="ChartDrawer-855"><a href="#ChartDrawer-855"><span class="linenos"> 855</span></a>                        <span class="n">inter_cusp_gap</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-856"><a href="#ChartDrawer-856"><span class="linenos"> 856</span></a>                        <span class="n">cusp_block_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">cusp_grid_width</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">inter_cusp_gap</span>
</span><span id="ChartDrawer-857"><a href="#ChartDrawer-857"><span class="linenos"> 857</span></a>                        <span class="c1"># Place cusp block slightly to the right of the house comparison tables</span>
</span><span id="ChartDrawer-858"><a href="#ChartDrawer-858"><span class="linenos"> 858</span></a>                        <span class="c1"># and ensure the overall SVG width comfortably contains it, including</span>
</span><span id="ChartDrawer-859"><a href="#ChartDrawer-859"><span class="linenos"> 859</span></a>                        <span class="c1"># the rightmost text of the second cusp table.</span>
</span><span id="ChartDrawer-860"><a href="#ChartDrawer-860"><span class="linenos"> 860</span></a>                        <span class="n">extra_cusp_margin</span> <span class="o">=</span> <span class="mf">45.0</span>
</span><span id="ChartDrawer-861"><a href="#ChartDrawer-861"><span class="linenos"> 861</span></a>                        <span class="n">cusp_block_right</span> <span class="o">=</span> <span class="n">max_house_comparison_right</span> <span class="o">+</span> <span class="mf">50.0</span> <span class="o">+</span> <span class="n">cusp_block_width</span> <span class="o">+</span> <span class="n">extra_cusp_margin</span>
</span><span id="ChartDrawer-862"><a href="#ChartDrawer-862"><span class="linenos"> 862</span></a>                        <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cusp_block_right</span><span class="p">)</span>
</span><span id="ChartDrawer-863"><a href="#ChartDrawer-863"><span class="linenos"> 863</span></a>
</span><span id="ChartDrawer-864"><a href="#ChartDrawer-864"><span class="linenos"> 864</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-865"><a href="#ChartDrawer-865"><span class="linenos"> 865</span></a>                <span class="c1"># House comparison grid at x ~ 1030</span>
</span><span id="ChartDrawer-866"><a href="#ChartDrawer-866"><span class="linenos"> 866</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-867"><a href="#ChartDrawer-867"><span class="linenos"> 867</span></a>                    <span class="n">transit_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-868"><a href="#ChartDrawer-868"><span class="linenos"> 868</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;transit_point&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit Point&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-869"><a href="#ChartDrawer-869"><span class="linenos"> 869</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house_position&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-870"><a href="#ChartDrawer-870"><span class="linenos"> 870</span></a>                    <span class="p">]</span>
</span><span id="ChartDrawer-871"><a href="#ChartDrawer-871"><span class="linenos"> 871</span></a>                    <span class="n">transit_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-872"><a href="#ChartDrawer-872"><span class="linenos"> 872</span></a>                        <span class="n">column_labels</span><span class="o">=</span><span class="n">transit_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-873"><a href="#ChartDrawer-873"><span class="linenos"> 873</span></a>                        <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-874"><a href="#ChartDrawer-874"><span class="linenos"> 874</span></a>                        <span class="n">include_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-875"><a href="#ChartDrawer-875"><span class="linenos"> 875</span></a>                        <span class="n">minimum_width</span><span class="o">=</span><span class="mf">170.0</span><span class="p">,</span>
</span><span id="ChartDrawer-876"><a href="#ChartDrawer-876"><span class="linenos"> 876</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-877"><a href="#ChartDrawer-877"><span class="linenos"> 877</span></a>                    <span class="n">house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">980</span> <span class="o">+</span> <span class="n">transit_grid_width</span>
</span><span id="ChartDrawer-878"><a href="#ChartDrawer-878"><span class="linenos"> 878</span></a>
</span><span id="ChartDrawer-879"><a href="#ChartDrawer-879"><span class="linenos"> 879</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-880"><a href="#ChartDrawer-880"><span class="linenos"> 880</span></a>                        <span class="c1"># Classic layout: house comparison grid at x=980</span>
</span><span id="ChartDrawer-881"><a href="#ChartDrawer-881"><span class="linenos"> 881</span></a>                        <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">house_comparison_grid_right</span><span class="p">)</span>
</span><span id="ChartDrawer-882"><a href="#ChartDrawer-882"><span class="linenos"> 882</span></a>
</span><span id="ChartDrawer-883"><a href="#ChartDrawer-883"><span class="linenos"> 883</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-884"><a href="#ChartDrawer-884"><span class="linenos"> 884</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-885"><a href="#ChartDrawer-885"><span class="linenos"> 885</span></a>                            <span class="c1"># Both grids visible: cusp table rendered to the right</span>
</span><span id="ChartDrawer-886"><a href="#ChartDrawer-886"><span class="linenos"> 886</span></a>                            <span class="n">cusp_block_width</span> <span class="o">=</span> <span class="mf">260.0</span>
</span><span id="ChartDrawer-887"><a href="#ChartDrawer-887"><span class="linenos"> 887</span></a>                            <span class="n">cusp_block_right</span> <span class="o">=</span> <span class="n">house_comparison_grid_right</span> <span class="o">+</span> <span class="mf">40.0</span> <span class="o">+</span> <span class="n">cusp_block_width</span>
</span><span id="ChartDrawer-888"><a href="#ChartDrawer-888"><span class="linenos"> 888</span></a>                            <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cusp_block_right</span><span class="p">)</span>
</span><span id="ChartDrawer-889"><a href="#ChartDrawer-889"><span class="linenos"> 889</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-890"><a href="#ChartDrawer-890"><span class="linenos"> 890</span></a>                            <span class="c1"># Cusp-only: cusp table occupies the house grid slot at x=980</span>
</span><span id="ChartDrawer-891"><a href="#ChartDrawer-891"><span class="linenos"> 891</span></a>                            <span class="n">cusp_only_right</span> <span class="o">=</span> <span class="n">house_comparison_grid_right</span>
</span><span id="ChartDrawer-892"><a href="#ChartDrawer-892"><span class="linenos"> 892</span></a>                            <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cusp_only_right</span><span class="p">)</span>
</span><span id="ChartDrawer-893"><a href="#ChartDrawer-893"><span class="linenos"> 893</span></a>
</span><span id="ChartDrawer-894"><a href="#ChartDrawer-894"><span class="linenos"> 894</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-895"><a href="#ChartDrawer-895"><span class="linenos"> 895</span></a>                <span class="c1"># House and cusp comparison grids laid out similarly to Synastry.</span>
</span><span id="ChartDrawer-896"><a href="#ChartDrawer-896"><span class="linenos"> 896</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-897"><a href="#ChartDrawer-897"><span class="linenos"> 897</span></a>                    <span class="c1"># Use localized labels for the natal subject and the return.</span>
</span><span id="ChartDrawer-898"><a href="#ChartDrawer-898"><span class="linenos"> 898</span></a>                    <span class="n">first_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-899"><a href="#ChartDrawer-899"><span class="linenos"> 899</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s2">&quot;return_type&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-900"><a href="#ChartDrawer-900"><span class="linenos"> 900</span></a>                        <span class="n">second_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;solar_return&quot;</span><span class="p">,</span> <span class="s2">&quot;Solar Return&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-901"><a href="#ChartDrawer-901"><span class="linenos"> 901</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-902"><a href="#ChartDrawer-902"><span class="linenos"> 902</span></a>                        <span class="n">second_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_return&quot;</span><span class="p">,</span> <span class="s2">&quot;Lunar Return&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-903"><a href="#ChartDrawer-903"><span class="linenos"> 903</span></a>                    <span class="n">point_column_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="s2">&quot;Point&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-904"><a href="#ChartDrawer-904"><span class="linenos"> 904</span></a>
</span><span id="ChartDrawer-905"><a href="#ChartDrawer-905"><span class="linenos"> 905</span></a>                    <span class="n">first_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-906"><a href="#ChartDrawer-906"><span class="linenos"> 906</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_subject_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-907"><a href="#ChartDrawer-907"><span class="linenos"> 907</span></a>                        <span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-908"><a href="#ChartDrawer-908"><span class="linenos"> 908</span></a>                        <span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-909"><a href="#ChartDrawer-909"><span class="linenos"> 909</span></a>                    <span class="p">]</span>
</span><span id="ChartDrawer-910"><a href="#ChartDrawer-910"><span class="linenos"> 910</span></a>                    <span class="n">second_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-911"><a href="#ChartDrawer-911"><span class="linenos"> 911</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">second_subject_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-912"><a href="#ChartDrawer-912"><span class="linenos"> 912</span></a>                        <span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-913"><a href="#ChartDrawer-913"><span class="linenos"> 913</span></a>                        <span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-914"><a href="#ChartDrawer-914"><span class="linenos"> 914</span></a>                    <span class="p">]</span>
</span><span id="ChartDrawer-915"><a href="#ChartDrawer-915"><span class="linenos"> 915</span></a>
</span><span id="ChartDrawer-916"><a href="#ChartDrawer-916"><span class="linenos"> 916</span></a>                    <span class="n">first_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-917"><a href="#ChartDrawer-917"><span class="linenos"> 917</span></a>                        <span class="n">column_labels</span><span class="o">=</span><span class="n">first_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-918"><a href="#ChartDrawer-918"><span class="linenos"> 918</span></a>                        <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-919"><a href="#ChartDrawer-919"><span class="linenos"> 919</span></a>                        <span class="n">include_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-920"><a href="#ChartDrawer-920"><span class="linenos"> 920</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-921"><a href="#ChartDrawer-921"><span class="linenos"> 921</span></a>                    <span class="n">second_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-922"><a href="#ChartDrawer-922"><span class="linenos"> 922</span></a>                        <span class="n">column_labels</span><span class="o">=</span><span class="n">second_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-923"><a href="#ChartDrawer-923"><span class="linenos"> 923</span></a>                        <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-924"><a href="#ChartDrawer-924"><span class="linenos"> 924</span></a>                        <span class="n">include_title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-925"><a href="#ChartDrawer-925"><span class="linenos"> 925</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-926"><a href="#ChartDrawer-926"><span class="linenos"> 926</span></a>
</span><span id="ChartDrawer-927"><a href="#ChartDrawer-927"><span class="linenos"> 927</span></a>                    <span class="n">first_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1090</span> <span class="o">+</span> <span class="n">first_grid_width</span>
</span><span id="ChartDrawer-928"><a href="#ChartDrawer-928"><span class="linenos"> 928</span></a>                    <span class="n">second_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1290</span> <span class="o">+</span> <span class="n">second_grid_width</span>
</span><span id="ChartDrawer-929"><a href="#ChartDrawer-929"><span class="linenos"> 929</span></a>                    <span class="n">extents</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">first_house_comparison_grid_right</span><span class="p">,</span> <span class="n">second_house_comparison_grid_right</span><span class="p">])</span>
</span><span id="ChartDrawer-930"><a href="#ChartDrawer-930"><span class="linenos"> 930</span></a>
</span><span id="ChartDrawer-931"><a href="#ChartDrawer-931"><span class="linenos"> 931</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-932"><a href="#ChartDrawer-932"><span class="linenos"> 932</span></a>                        <span class="c1"># Cusp comparison block positioned to the right of both house grids.</span>
</span><span id="ChartDrawer-933"><a href="#ChartDrawer-933"><span class="linenos"> 933</span></a>                        <span class="n">max_house_comparison_right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ChartDrawer-934"><a href="#ChartDrawer-934"><span class="linenos"> 934</span></a>                            <span class="n">first_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-935"><a href="#ChartDrawer-935"><span class="linenos"> 935</span></a>                            <span class="n">second_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-936"><a href="#ChartDrawer-936"><span class="linenos"> 936</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-937"><a href="#ChartDrawer-937"><span class="linenos"> 937</span></a>                        <span class="n">cusp_grid_width</span> <span class="o">=</span> <span class="mf">160.0</span>
</span><span id="ChartDrawer-938"><a href="#ChartDrawer-938"><span class="linenos"> 938</span></a>                        <span class="n">inter_cusp_gap</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-939"><a href="#ChartDrawer-939"><span class="linenos"> 939</span></a>                        <span class="n">cusp_block_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">cusp_grid_width</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">inter_cusp_gap</span>
</span><span id="ChartDrawer-940"><a href="#ChartDrawer-940"><span class="linenos"> 940</span></a>                        <span class="n">extra_cusp_margin</span> <span class="o">=</span> <span class="mf">45.0</span>
</span><span id="ChartDrawer-941"><a href="#ChartDrawer-941"><span class="linenos"> 941</span></a>                        <span class="n">cusp_block_right</span> <span class="o">=</span> <span class="n">max_house_comparison_right</span> <span class="o">+</span> <span class="mf">50.0</span> <span class="o">+</span> <span class="n">cusp_block_width</span> <span class="o">+</span> <span class="n">extra_cusp_margin</span>
</span><span id="ChartDrawer-942"><a href="#ChartDrawer-942"><span class="linenos"> 942</span></a>                        <span class="n">extents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cusp_block_right</span><span class="p">)</span>
</span><span id="ChartDrawer-943"><a href="#ChartDrawer-943"><span class="linenos"> 943</span></a>
</span><span id="ChartDrawer-944"><a href="#ChartDrawer-944"><span class="linenos"> 944</span></a>        <span class="c1"># Conservative safety padding</span>
</span><span id="ChartDrawer-945"><a href="#ChartDrawer-945"><span class="linenos"> 945</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">extents</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding</span><span class="p">)</span>
</span><span id="ChartDrawer-946"><a href="#ChartDrawer-946"><span class="linenos"> 946</span></a>
</span><span id="ChartDrawer-947"><a href="#ChartDrawer-947"><span class="linenos"> 947</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_double_chart_aspect_columns</span><span class="p">(</span>
</span><span id="ChartDrawer-948"><a href="#ChartDrawer-948"><span class="linenos"> 948</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-949"><a href="#ChartDrawer-949"><span class="linenos"> 949</span></a>        <span class="n">total_aspects</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ChartDrawer-950"><a href="#ChartDrawer-950"><span class="linenos"> 950</span></a>        <span class="n">chart_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="ChartDrawer-951"><a href="#ChartDrawer-951"><span class="linenos"> 951</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChartDrawer-952"><a href="#ChartDrawer-952"><span class="linenos"> 952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return how many columns the double-chart aspect list needs.</span>
</span><span id="ChartDrawer-953"><a href="#ChartDrawer-953"><span class="linenos"> 953</span></a>
</span><span id="ChartDrawer-954"><a href="#ChartDrawer-954"><span class="linenos"> 954</span></a><span class="sd">        The first 11 columns follow the legacy 14-rows layout. Starting from the</span>
</span><span id="ChartDrawer-955"><a href="#ChartDrawer-955"><span class="linenos"> 955</span></a><span class="sd">        12th column we can fit more rows thanks to the taller chart height that</span>
</span><span id="ChartDrawer-956"><a href="#ChartDrawer-956"><span class="linenos"> 956</span></a><span class="sd">        gets computed earlier, so we re-use the same capacity as the SVG builder.</span>
</span><span id="ChartDrawer-957"><a href="#ChartDrawer-957"><span class="linenos"> 957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-958"><a href="#ChartDrawer-958"><span class="linenos"> 958</span></a>        <span class="k">if</span> <span class="n">total_aspects</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ChartDrawer-959"><a href="#ChartDrawer-959"><span class="linenos"> 959</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="ChartDrawer-960"><a href="#ChartDrawer-960"><span class="linenos"> 960</span></a>
</span><span id="ChartDrawer-961"><a href="#ChartDrawer-961"><span class="linenos"> 961</span></a>        <span class="n">per_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ASPECT_LIST_ASPECTS_PER_COLUMN</span>
</span><span id="ChartDrawer-962"><a href="#ChartDrawer-962"><span class="linenos"> 962</span></a>        <span class="n">extended_start</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 0-based index where tall columns begin</span>
</span><span id="ChartDrawer-963"><a href="#ChartDrawer-963"><span class="linenos"> 963</span></a>        <span class="n">base_capacity</span> <span class="o">=</span> <span class="n">per_column</span> <span class="o">*</span> <span class="n">extended_start</span>
</span><span id="ChartDrawer-964"><a href="#ChartDrawer-964"><span class="linenos"> 964</span></a>
</span><span id="ChartDrawer-965"><a href="#ChartDrawer-965"><span class="linenos"> 965</span></a>        <span class="n">full_height_capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_full_height_column_capacity</span><span class="p">(</span><span class="n">chart_height</span><span class="p">)</span>
</span><span id="ChartDrawer-966"><a href="#ChartDrawer-966"><span class="linenos"> 966</span></a>
</span><span id="ChartDrawer-967"><a href="#ChartDrawer-967"><span class="linenos"> 967</span></a>        <span class="k">if</span> <span class="n">total_aspects</span> <span class="o">&lt;=</span> <span class="n">base_capacity</span><span class="p">:</span>
</span><span id="ChartDrawer-968"><a href="#ChartDrawer-968"><span class="linenos"> 968</span></a>            <span class="k">return</span> <span class="n">ceil</span><span class="p">(</span><span class="n">total_aspects</span> <span class="o">/</span> <span class="n">per_column</span><span class="p">)</span>
</span><span id="ChartDrawer-969"><a href="#ChartDrawer-969"><span class="linenos"> 969</span></a>
</span><span id="ChartDrawer-970"><a href="#ChartDrawer-970"><span class="linenos"> 970</span></a>        <span class="n">remaining</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_aspects</span> <span class="o">-</span> <span class="n">base_capacity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ChartDrawer-971"><a href="#ChartDrawer-971"><span class="linenos"> 971</span></a>        <span class="n">extra_columns</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">remaining</span> <span class="o">/</span> <span class="n">full_height_capacity</span><span class="p">)</span> <span class="k">if</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ChartDrawer-972"><a href="#ChartDrawer-972"><span class="linenos"> 972</span></a>        <span class="k">return</span> <span class="n">extended_start</span> <span class="o">+</span> <span class="n">extra_columns</span>
</span><span id="ChartDrawer-973"><a href="#ChartDrawer-973"><span class="linenos"> 973</span></a>
</span><span id="ChartDrawer-974"><a href="#ChartDrawer-974"><span class="linenos"> 974</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_full_height_column_capacity</span><span class="p">(</span>
</span><span id="ChartDrawer-975"><a href="#ChartDrawer-975"><span class="linenos"> 975</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-976"><a href="#ChartDrawer-976"><span class="linenos"> 976</span></a>        <span class="n">chart_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="ChartDrawer-977"><a href="#ChartDrawer-977"><span class="linenos"> 977</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChartDrawer-978"><a href="#ChartDrawer-978"><span class="linenos"> 978</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the row capacity for columns that use the tall layout.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-979"><a href="#ChartDrawer-979"><span class="linenos"> 979</span></a>        <span class="n">per_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ASPECT_LIST_ASPECTS_PER_COLUMN</span>
</span><span id="ChartDrawer-980"><a href="#ChartDrawer-980"><span class="linenos"> 980</span></a>
</span><span id="ChartDrawer-981"><a href="#ChartDrawer-981"><span class="linenos"> 981</span></a>        <span class="k">if</span> <span class="n">chart_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-982"><a href="#ChartDrawer-982"><span class="linenos"> 982</span></a>            <span class="k">return</span> <span class="n">per_column</span>
</span><span id="ChartDrawer-983"><a href="#ChartDrawer-983"><span class="linenos"> 983</span></a>
</span><span id="ChartDrawer-984"><a href="#ChartDrawer-984"><span class="linenos"> 984</span></a>        <span class="n">translate_y</span> <span class="o">=</span> <span class="mi">273</span>
</span><span id="ChartDrawer-985"><a href="#ChartDrawer-985"><span class="linenos"> 985</span></a>        <span class="n">bottom_padding</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="ChartDrawer-986"><a href="#ChartDrawer-986"><span class="linenos"> 986</span></a>        <span class="n">title_clearance</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="ChartDrawer-987"><a href="#ChartDrawer-987"><span class="linenos"> 987</span></a>        <span class="n">line_height</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="ChartDrawer-988"><a href="#ChartDrawer-988"><span class="linenos"> 988</span></a>        <span class="n">baseline_index</span> <span class="o">=</span> <span class="n">per_column</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ChartDrawer-989"><a href="#ChartDrawer-989"><span class="linenos"> 989</span></a>        <span class="n">top_limit_index</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="o">-</span><span class="n">translate_y</span> <span class="o">+</span> <span class="n">title_clearance</span><span class="p">)</span> <span class="o">/</span> <span class="n">line_height</span><span class="p">)</span>
</span><span id="ChartDrawer-990"><a href="#ChartDrawer-990"><span class="linenos"> 990</span></a>        <span class="n">max_capacity_by_top</span> <span class="o">=</span> <span class="n">baseline_index</span> <span class="o">-</span> <span class="n">top_limit_index</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ChartDrawer-991"><a href="#ChartDrawer-991"><span class="linenos"> 991</span></a>
</span><span id="ChartDrawer-992"><a href="#ChartDrawer-992"><span class="linenos"> 992</span></a>        <span class="n">available_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">chart_height</span> <span class="o">-</span> <span class="n">translate_y</span> <span class="o">-</span> <span class="n">bottom_padding</span><span class="p">,</span> <span class="n">line_height</span><span class="p">)</span>
</span><span id="ChartDrawer-993"><a href="#ChartDrawer-993"><span class="linenos"> 993</span></a>        <span class="n">allowed_capacity</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">per_column</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">available_height</span> <span class="o">//</span> <span class="n">line_height</span><span class="p">))</span>
</span><span id="ChartDrawer-994"><a href="#ChartDrawer-994"><span class="linenos"> 994</span></a>
</span><span id="ChartDrawer-995"><a href="#ChartDrawer-995"><span class="linenos"> 995</span></a>        <span class="c1"># Respect both the physical height of the SVG and the visual limit</span>
</span><span id="ChartDrawer-996"><a href="#ChartDrawer-996"><span class="linenos"> 996</span></a>        <span class="c1"># imposed by the title area.</span>
</span><span id="ChartDrawer-997"><a href="#ChartDrawer-997"><span class="linenos"> 997</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">per_column</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">allowed_capacity</span><span class="p">,</span> <span class="n">max_capacity_by_top</span><span class="p">))</span>
</span><span id="ChartDrawer-998"><a href="#ChartDrawer-998"><span class="linenos"> 998</span></a>
</span><span id="ChartDrawer-999"><a href="#ChartDrawer-999"><span class="linenos"> 999</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_estimate_text_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ChartDrawer-1000"><a href="#ChartDrawer-1000"><span class="linenos">1000</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Very rough text width estimation in pixels based on font size.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1001"><a href="#ChartDrawer-1001"><span class="linenos">1001</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
</span><span id="ChartDrawer-1002"><a href="#ChartDrawer-1002"><span class="linenos">1002</span></a>            <span class="k">return</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1003"><a href="#ChartDrawer-1003"><span class="linenos">1003</span></a>        <span class="n">average_char_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">font_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span>
</span><span id="ChartDrawer-1004"><a href="#ChartDrawer-1004"><span class="linenos">1004</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">font_size</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">average_char_width</span><span class="p">)</span>
</span><span id="ChartDrawer-1005"><a href="#ChartDrawer-1005"><span class="linenos">1005</span></a>
</span><span id="ChartDrawer-1006"><a href="#ChartDrawer-1006"><span class="linenos">1006</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_active_point_display_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ChartDrawer-1007"><a href="#ChartDrawer-1007"><span class="linenos">1007</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return localized labels for the currently active celestial points.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1008"><a href="#ChartDrawer-1008"><span class="linenos">1008</span></a>        <span class="n">language_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ChartDrawer-1009"><a href="#ChartDrawer-1009"><span class="linenos">1009</span></a>        <span class="n">fallback_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ChartDrawer-1010"><a href="#ChartDrawer-1010"><span class="linenos">1010</span></a>
</span><span id="ChartDrawer-1011"><a href="#ChartDrawer-1011"><span class="linenos">1011</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_language_model&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-1012"><a href="#ChartDrawer-1012"><span class="linenos">1012</span></a>            <span class="n">language_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span><span id="ChartDrawer-1013"><a href="#ChartDrawer-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_fallback_language_model&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-1014"><a href="#ChartDrawer-1014"><span class="linenos">1014</span></a>            <span class="n">fallback_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span><span id="ChartDrawer-1015"><a href="#ChartDrawer-1015"><span class="linenos">1015</span></a>
</span><span id="ChartDrawer-1016"><a href="#ChartDrawer-1016"><span class="linenos">1016</span></a>        <span class="n">display_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-1017"><a href="#ChartDrawer-1017"><span class="linenos">1017</span></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="ChartDrawer-1018"><a href="#ChartDrawer-1018"><span class="linenos">1018</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="ChartDrawer-1019"><a href="#ChartDrawer-1019"><span class="linenos">1019</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">language_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fallback_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span>
</span><span id="ChartDrawer-1020"><a href="#ChartDrawer-1020"><span class="linenos">1020</span></a>            <span class="n">display_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
</span><span id="ChartDrawer-1021"><a href="#ChartDrawer-1021"><span class="linenos">1021</span></a>        <span class="k">return</span> <span class="n">display_names</span>
</span><span id="ChartDrawer-1022"><a href="#ChartDrawer-1022"><span class="linenos">1022</span></a>
</span><span id="ChartDrawer-1023"><a href="#ChartDrawer-1023"><span class="linenos">1023</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-1024"><a href="#ChartDrawer-1024"><span class="linenos">1024</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-1025"><a href="#ChartDrawer-1025"><span class="linenos">1025</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDrawer-1026"><a href="#ChartDrawer-1026"><span class="linenos">1026</span></a>        <span class="n">column_labels</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="ChartDrawer-1027"><a href="#ChartDrawer-1027"><span class="linenos">1027</span></a>        <span class="n">include_radix_column</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ChartDrawer-1028"><a href="#ChartDrawer-1028"><span class="linenos">1028</span></a>        <span class="n">include_title</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ChartDrawer-1029"><a href="#ChartDrawer-1029"><span class="linenos">1029</span></a>        <span class="n">minimum_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">250.0</span><span class="p">,</span>
</span><span id="ChartDrawer-1030"><a href="#ChartDrawer-1030"><span class="linenos">1030</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChartDrawer-1031"><a href="#ChartDrawer-1031"><span class="linenos">1031</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1032"><a href="#ChartDrawer-1032"><span class="linenos">1032</span></a><span class="sd">        Approximate the rendered width for a house comparison grid in the current locale.</span>
</span><span id="ChartDrawer-1033"><a href="#ChartDrawer-1033"><span class="linenos">1033</span></a>
</span><span id="ChartDrawer-1034"><a href="#ChartDrawer-1034"><span class="linenos">1034</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1035"><a href="#ChartDrawer-1035"><span class="linenos">1035</span></a><span class="sd">            column_labels: Ordered labels for the header row.</span>
</span><span id="ChartDrawer-1036"><a href="#ChartDrawer-1036"><span class="linenos">1036</span></a><span class="sd">            include_radix_column: Whether a third numeric column is rendered.</span>
</span><span id="ChartDrawer-1037"><a href="#ChartDrawer-1037"><span class="linenos">1037</span></a><span class="sd">            include_title: Include the localized title in the width estimation.</span>
</span><span id="ChartDrawer-1038"><a href="#ChartDrawer-1038"><span class="linenos">1038</span></a><span class="sd">            minimum_width: Absolute lower bound to prevent extreme shrinking.</span>
</span><span id="ChartDrawer-1039"><a href="#ChartDrawer-1039"><span class="linenos">1039</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1040"><a href="#ChartDrawer-1040"><span class="linenos">1040</span></a>        <span class="n">font_size_body</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="ChartDrawer-1041"><a href="#ChartDrawer-1041"><span class="linenos">1041</span></a>        <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="ChartDrawer-1042"><a href="#ChartDrawer-1042"><span class="linenos">1042</span></a>        <span class="n">minimum_grid_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">minimum_width</span><span class="p">)</span>
</span><span id="ChartDrawer-1043"><a href="#ChartDrawer-1043"><span class="linenos">1043</span></a>
</span><span id="ChartDrawer-1044"><a href="#ChartDrawer-1044"><span class="linenos">1044</span></a>        <span class="n">active_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_active_point_display_names</span><span class="p">()</span>
</span><span id="ChartDrawer-1045"><a href="#ChartDrawer-1045"><span class="linenos">1045</span></a>        <span class="n">max_name_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ChartDrawer-1046"><a href="#ChartDrawer-1046"><span class="linenos">1046</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate_text_width</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">font_size_body</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">active_names</span><span class="p">),</span>
</span><span id="ChartDrawer-1047"><a href="#ChartDrawer-1047"><span class="linenos">1047</span></a>            <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate_text_width</span><span class="p">(</span><span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="n">font_size_body</span><span class="p">),</span>
</span><span id="ChartDrawer-1048"><a href="#ChartDrawer-1048"><span class="linenos">1048</span></a>        <span class="p">)</span>
</span><span id="ChartDrawer-1049"><a href="#ChartDrawer-1049"><span class="linenos">1049</span></a>        <span class="n">width_candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-1050"><a href="#ChartDrawer-1050"><span class="linenos">1050</span></a>
</span><span id="ChartDrawer-1051"><a href="#ChartDrawer-1051"><span class="linenos">1051</span></a>        <span class="n">name_start</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="ChartDrawer-1052"><a href="#ChartDrawer-1052"><span class="linenos">1052</span></a>        <span class="n">width_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_start</span> <span class="o">+</span> <span class="n">max_name_width</span><span class="p">)</span>
</span><span id="ChartDrawer-1053"><a href="#ChartDrawer-1053"><span class="linenos">1053</span></a>
</span><span id="ChartDrawer-1054"><a href="#ChartDrawer-1054"><span class="linenos">1054</span></a>        <span class="n">value_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">]</span>
</span><span id="ChartDrawer-1055"><a href="#ChartDrawer-1055"><span class="linenos">1055</span></a>        <span class="k">if</span> <span class="n">include_radix_column</span><span class="p">:</span>
</span><span id="ChartDrawer-1056"><a href="#ChartDrawer-1056"><span class="linenos">1056</span></a>            <span class="n">value_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span>
</span><span id="ChartDrawer-1057"><a href="#ChartDrawer-1057"><span class="linenos">1057</span></a>        <span class="n">value_samples</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;12&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1058"><a href="#ChartDrawer-1058"><span class="linenos">1058</span></a>        <span class="n">max_value_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate_text_width</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">font_size_body</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">value_samples</span><span class="p">))</span>
</span><span id="ChartDrawer-1059"><a href="#ChartDrawer-1059"><span class="linenos">1059</span></a>        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">value_offsets</span><span class="p">:</span>
</span><span id="ChartDrawer-1060"><a href="#ChartDrawer-1060"><span class="linenos">1060</span></a>            <span class="n">width_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">max_value_width</span><span class="p">)</span>
</span><span id="ChartDrawer-1061"><a href="#ChartDrawer-1061"><span class="linenos">1061</span></a>
</span><span id="ChartDrawer-1062"><a href="#ChartDrawer-1062"><span class="linenos">1062</span></a>        <span class="n">header_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">77</span><span class="p">]</span>
</span><span id="ChartDrawer-1063"><a href="#ChartDrawer-1063"><span class="linenos">1063</span></a>        <span class="k">if</span> <span class="n">include_radix_column</span><span class="p">:</span>
</span><span id="ChartDrawer-1064"><a href="#ChartDrawer-1064"><span class="linenos">1064</span></a>            <span class="n">header_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
</span><span id="ChartDrawer-1065"><a href="#ChartDrawer-1065"><span class="linenos">1065</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header_offsets</span><span class="p">):</span>
</span><span id="ChartDrawer-1066"><a href="#ChartDrawer-1066"><span class="linenos">1066</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">column_labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_labels</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1067"><a href="#ChartDrawer-1067"><span class="linenos">1067</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
</span><span id="ChartDrawer-1068"><a href="#ChartDrawer-1068"><span class="linenos">1068</span></a>                <span class="k">continue</span>
</span><span id="ChartDrawer-1069"><a href="#ChartDrawer-1069"><span class="linenos">1069</span></a>            <span class="n">width_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_text_width</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">font_size_body</span><span class="p">))</span>
</span><span id="ChartDrawer-1070"><a href="#ChartDrawer-1070"><span class="linenos">1070</span></a>
</span><span id="ChartDrawer-1071"><a href="#ChartDrawer-1071"><span class="linenos">1071</span></a>        <span class="k">if</span> <span class="n">include_title</span><span class="p">:</span>
</span><span id="ChartDrawer-1072"><a href="#ChartDrawer-1072"><span class="linenos">1072</span></a>            <span class="n">title_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;House Position Comparison&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1073"><a href="#ChartDrawer-1073"><span class="linenos">1073</span></a>            <span class="n">width_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_estimate_text_width</span><span class="p">(</span><span class="n">title_label</span><span class="p">,</span> <span class="n">font_size_title</span><span class="p">))</span>
</span><span id="ChartDrawer-1074"><a href="#ChartDrawer-1074"><span class="linenos">1074</span></a>
</span><span id="ChartDrawer-1075"><a href="#ChartDrawer-1075"><span class="linenos">1075</span></a>        <span class="n">grid_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width_candidates</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">minimum_grid_width</span><span class="p">)</span>
</span><span id="ChartDrawer-1076"><a href="#ChartDrawer-1076"><span class="linenos">1076</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">grid_width</span><span class="p">,</span> <span class="n">minimum_grid_width</span><span class="p">))</span>
</span><span id="ChartDrawer-1077"><a href="#ChartDrawer-1077"><span class="linenos">1077</span></a>
</span><span id="ChartDrawer-1078"><a href="#ChartDrawer-1078"><span class="linenos">1078</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_minimum_width_for_chart_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChartDrawer-1079"><a href="#ChartDrawer-1079"><span class="linenos">1079</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Baseline width to avoid compressing core groups too tightly.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1080"><a href="#ChartDrawer-1080"><span class="linenos">1080</span></a>        <span class="n">wheel_right</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">)</span>
</span><span id="ChartDrawer-1081"><a href="#ChartDrawer-1081"><span class="linenos">1081</span></a>        <span class="n">baseline</span> <span class="o">=</span> <span class="n">wheel_right</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding</span>
</span><span id="ChartDrawer-1082"><a href="#ChartDrawer-1082"><span class="linenos">1082</span></a>
</span><span id="ChartDrawer-1083"><a href="#ChartDrawer-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">):</span>
</span><span id="ChartDrawer-1084"><a href="#ChartDrawer-1084"><span class="linenos">1084</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">baseline</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span><span class="p">)</span>
</span><span id="ChartDrawer-1085"><a href="#ChartDrawer-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1086"><a href="#ChartDrawer-1086"><span class="linenos">1086</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">baseline</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_SYNASTRY_WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ChartDrawer-1087"><a href="#ChartDrawer-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1088"><a href="#ChartDrawer-1088"><span class="linenos">1088</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">baseline</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_ULTRA_WIDE_WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ChartDrawer-1089"><a href="#ChartDrawer-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1090"><a href="#ChartDrawer-1090"><span class="linenos">1090</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">baseline</span><span class="p">),</span> <span class="mi">450</span><span class="p">)</span>
</span><span id="ChartDrawer-1091"><a href="#ChartDrawer-1091"><span class="linenos">1091</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">baseline</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span><span class="p">)</span>
</span><span id="ChartDrawer-1092"><a href="#ChartDrawer-1092"><span class="linenos">1092</span></a>
</span><span id="ChartDrawer-1093"><a href="#ChartDrawer-1093"><span class="linenos">1093</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_width_to_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1094"><a href="#ChartDrawer-1094"><span class="linenos">1094</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resize the chart width so the farthest element fits comfortably.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1095"><a href="#ChartDrawer-1095"><span class="linenos">1095</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ChartDrawer-1096"><a href="#ChartDrawer-1096"><span class="linenos">1096</span></a>            <span class="n">required_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_required_width_full</span><span class="p">()</span>
</span><span id="ChartDrawer-1097"><a href="#ChartDrawer-1097"><span class="linenos">1097</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ChartDrawer-1098"><a href="#ChartDrawer-1098"><span class="linenos">1098</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Auto-size width calculation failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="ChartDrawer-1099"><a href="#ChartDrawer-1099"><span class="linenos">1099</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-1100"><a href="#ChartDrawer-1100"><span class="linenos">1100</span></a>
</span><span id="ChartDrawer-1101"><a href="#ChartDrawer-1101"><span class="linenos">1101</span></a>        <span class="n">minimum_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_width_for_chart_type</span><span class="p">()</span>
</span><span id="ChartDrawer-1102"><a href="#ChartDrawer-1102"><span class="linenos">1102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">required_width</span><span class="p">,</span> <span class="n">minimum_width</span><span class="p">)</span>
</span><span id="ChartDrawer-1103"><a href="#ChartDrawer-1103"><span class="linenos">1103</span></a>
</span><span id="ChartDrawer-1104"><a href="#ChartDrawer-1104"><span class="linenos">1104</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_location_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="ChartDrawer-1105"><a href="#ChartDrawer-1105"><span class="linenos">1105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1106"><a href="#ChartDrawer-1106"><span class="linenos">1106</span></a><span class="sd">        Determine location information based on chart type and subjects.</span>
</span><span id="ChartDrawer-1107"><a href="#ChartDrawer-1107"><span class="linenos">1107</span></a>
</span><span id="ChartDrawer-1108"><a href="#ChartDrawer-1108"><span class="linenos">1108</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1109"><a href="#ChartDrawer-1109"><span class="linenos">1109</span></a><span class="sd">            tuple: (location_name, latitude, longitude)</span>
</span><span id="ChartDrawer-1110"><a href="#ChartDrawer-1110"><span class="linenos">1110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1111"><a href="#ChartDrawer-1111"><span class="linenos">1111</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1112"><a href="#ChartDrawer-1112"><span class="linenos">1112</span></a>            <span class="c1"># For composite charts, use average location of the two composite subjects</span>
</span><span id="ChartDrawer-1113"><a href="#ChartDrawer-1113"><span class="linenos">1113</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="ChartDrawer-1114"><a href="#ChartDrawer-1114"><span class="linenos">1114</span></a>                <span class="n">location_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1115"><a href="#ChartDrawer-1115"><span class="linenos">1115</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">lat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ChartDrawer-1116"><a href="#ChartDrawer-1116"><span class="linenos">1116</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">lng</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">lng</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ChartDrawer-1117"><a href="#ChartDrawer-1117"><span class="linenos">1117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1118"><a href="#ChartDrawer-1118"><span class="linenos">1118</span></a>                <span class="c1"># Fallback to first subject location</span>
</span><span id="ChartDrawer-1119"><a href="#ChartDrawer-1119"><span class="linenos">1119</span></a>                <span class="n">location_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">city</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="ChartDrawer-1120"><a href="#ChartDrawer-1120"><span class="linenos">1120</span></a>                <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lat</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1121"><a href="#ChartDrawer-1121"><span class="linenos">1121</span></a>                <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lng</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1122"><a href="#ChartDrawer-1122"><span class="linenos">1122</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">:</span>
</span><span id="ChartDrawer-1123"><a href="#ChartDrawer-1123"><span class="linenos">1123</span></a>            <span class="c1"># Use location from the second subject (transit/return)</span>
</span><span id="ChartDrawer-1124"><a href="#ChartDrawer-1124"><span class="linenos">1124</span></a>            <span class="n">location_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">city</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="ChartDrawer-1125"><a href="#ChartDrawer-1125"><span class="linenos">1125</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lat</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1126"><a href="#ChartDrawer-1126"><span class="linenos">1126</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lng</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1127"><a href="#ChartDrawer-1127"><span class="linenos">1127</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1128"><a href="#ChartDrawer-1128"><span class="linenos">1128</span></a>            <span class="c1"># Use location from the first subject</span>
</span><span id="ChartDrawer-1129"><a href="#ChartDrawer-1129"><span class="linenos">1129</span></a>            <span class="n">location_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">city</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="ChartDrawer-1130"><a href="#ChartDrawer-1130"><span class="linenos">1130</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lat</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1131"><a href="#ChartDrawer-1131"><span class="linenos">1131</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lng</span> <span class="ow">or</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-1132"><a href="#ChartDrawer-1132"><span class="linenos">1132</span></a>
</span><span id="ChartDrawer-1133"><a href="#ChartDrawer-1133"><span class="linenos">1133</span></a>        <span class="k">return</span> <span class="n">location_name</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span>
</span><span id="ChartDrawer-1134"><a href="#ChartDrawer-1134"><span class="linenos">1134</span></a>
</span><span id="ChartDrawer-1135"><a href="#ChartDrawer-1135"><span class="linenos">1135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_up_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1136"><a href="#ChartDrawer-1136"><span class="linenos">1136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1137"><a href="#ChartDrawer-1137"><span class="linenos">1137</span></a><span class="sd">        Load and apply a CSS theme for the chart visualization.</span>
</span><span id="ChartDrawer-1138"><a href="#ChartDrawer-1138"><span class="linenos">1138</span></a>
</span><span id="ChartDrawer-1139"><a href="#ChartDrawer-1139"><span class="linenos">1139</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1140"><a href="#ChartDrawer-1140"><span class="linenos">1140</span></a><span class="sd">            theme (KerykeionChartTheme or None): Name of the theme to apply. If None, no CSS is applied.</span>
</span><span id="ChartDrawer-1141"><a href="#ChartDrawer-1141"><span class="linenos">1141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1142"><a href="#ChartDrawer-1142"><span class="linenos">1142</span></a>        <span class="k">if</span> <span class="n">theme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1143"><a href="#ChartDrawer-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">color_style_tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1144"><a href="#ChartDrawer-1144"><span class="linenos">1144</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer-1145"><a href="#ChartDrawer-1145"><span class="linenos">1145</span></a>
</span><span id="ChartDrawer-1146"><a href="#ChartDrawer-1146"><span class="linenos">1146</span></a>        <span class="n">theme_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;themes&quot;</span>
</span><span id="ChartDrawer-1147"><a href="#ChartDrawer-1147"><span class="linenos">1147</span></a>
</span><span id="ChartDrawer-1148"><a href="#ChartDrawer-1148"><span class="linenos">1148</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">theme_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">theme</span><span class="si">}</span><span class="s2">.css&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer-1149"><a href="#ChartDrawer-1149"><span class="linenos">1149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">color_style_tag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ChartDrawer-1150"><a href="#ChartDrawer-1150"><span class="linenos">1150</span></a>
</span><span id="ChartDrawer-1151"><a href="#ChartDrawer-1151"><span class="linenos">1151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_language_settings</span><span class="p">(</span>
</span><span id="ChartDrawer-1152"><a href="#ChartDrawer-1152"><span class="linenos">1152</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer-1153"><a href="#ChartDrawer-1153"><span class="linenos">1153</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
</span><span id="ChartDrawer-1154"><a href="#ChartDrawer-1154"><span class="linenos">1154</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1155"><a href="#ChartDrawer-1155"><span class="linenos">1155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve language models for the requested chart language.&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1156"><a href="#ChartDrawer-1156"><span class="linenos">1156</span></a>        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">language_pack</span><span class="p">)}</span> <span class="k">if</span> <span class="n">language_pack</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="ChartDrawer-1157"><a href="#ChartDrawer-1157"><span class="linenos">1157</span></a>        <span class="n">languages</span> <span class="o">=</span> <span class="n">load_language_settings</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
</span><span id="ChartDrawer-1158"><a href="#ChartDrawer-1158"><span class="linenos">1158</span></a>
</span><span id="ChartDrawer-1159"><a href="#ChartDrawer-1159"><span class="linenos">1159</span></a>        <span class="n">fallback_data</span> <span class="o">=</span> <span class="n">languages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EN&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1160"><a href="#ChartDrawer-1160"><span class="linenos">1160</span></a>        <span class="k">if</span> <span class="n">fallback_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1161"><a href="#ChartDrawer-1161"><span class="linenos">1161</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;English translations are missing from LANGUAGE_SETTINGS.&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1162"><a href="#ChartDrawer-1162"><span class="linenos">1162</span></a>
</span><span id="ChartDrawer-1163"><a href="#ChartDrawer-1163"><span class="linenos">1163</span></a>        <span class="n">base_data</span> <span class="o">=</span> <span class="n">languages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span><span class="p">,</span> <span class="n">fallback_data</span><span class="p">)</span>
</span><span id="ChartDrawer-1164"><a href="#ChartDrawer-1164"><span class="linenos">1164</span></a>        <span class="n">selected_model</span> <span class="o">=</span> <span class="n">KerykeionLanguageModel</span><span class="p">(</span><span class="o">**</span><span class="n">base_data</span><span class="p">)</span>
</span><span id="ChartDrawer-1165"><a href="#ChartDrawer-1165"><span class="linenos">1165</span></a>        <span class="n">fallback_model</span> <span class="o">=</span> <span class="n">KerykeionLanguageModel</span><span class="p">(</span><span class="o">**</span><span class="n">fallback_data</span><span class="p">)</span>
</span><span id="ChartDrawer-1166"><a href="#ChartDrawer-1166"><span class="linenos">1166</span></a>
</span><span id="ChartDrawer-1167"><a href="#ChartDrawer-1167"><span class="linenos">1167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_language_model</span> <span class="o">=</span> <span class="n">fallback_model</span>
</span><span id="ChartDrawer-1168"><a href="#ChartDrawer-1168"><span class="linenos">1168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span> <span class="o">=</span> <span class="n">selected_model</span>
</span><span id="ChartDrawer-1169"><a href="#ChartDrawer-1169"><span class="linenos">1169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_language_dict</span> <span class="o">=</span> <span class="n">fallback_model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span><span id="ChartDrawer-1170"><a href="#ChartDrawer-1170"><span class="linenos">1170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_language_dict</span> <span class="o">=</span> <span class="n">selected_model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span><span id="ChartDrawer-1171"><a href="#ChartDrawer-1171"><span class="linenos">1171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_language_dict</span>  <span class="c1"># Backward compatibility</span>
</span><span id="ChartDrawer-1172"><a href="#ChartDrawer-1172"><span class="linenos">1172</span></a>
</span><span id="ChartDrawer-1173"><a href="#ChartDrawer-1173"><span class="linenos">1173</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="ChartDrawer-1174"><a href="#ChartDrawer-1174"><span class="linenos">1174</span></a>        <span class="n">fallback_value</span> <span class="o">=</span> <span class="n">get_translations</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">language_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fallback_language_dict</span><span class="p">)</span>
</span><span id="ChartDrawer-1175"><a href="#ChartDrawer-1175"><span class="linenos">1175</span></a>        <span class="k">return</span> <span class="n">get_translations</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">fallback_value</span><span class="p">,</span> <span class="n">language_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_dict</span><span class="p">)</span>
</span><span id="ChartDrawer-1176"><a href="#ChartDrawer-1176"><span class="linenos">1176</span></a>
</span><span id="ChartDrawer-1177"><a href="#ChartDrawer-1177"><span class="linenos">1177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_draw_zodiac_circle_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
</span><span id="ChartDrawer-1178"><a href="#ChartDrawer-1178"><span class="linenos">1178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1179"><a href="#ChartDrawer-1179"><span class="linenos">1179</span></a><span class="sd">        Draw zodiac circle slices for each sign.</span>
</span><span id="ChartDrawer-1180"><a href="#ChartDrawer-1180"><span class="linenos">1180</span></a>
</span><span id="ChartDrawer-1181"><a href="#ChartDrawer-1181"><span class="linenos">1181</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1182"><a href="#ChartDrawer-1182"><span class="linenos">1182</span></a><span class="sd">            r (float): Outer radius of the zodiac ring.</span>
</span><span id="ChartDrawer-1183"><a href="#ChartDrawer-1183"><span class="linenos">1183</span></a>
</span><span id="ChartDrawer-1184"><a href="#ChartDrawer-1184"><span class="linenos">1184</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1185"><a href="#ChartDrawer-1185"><span class="linenos">1185</span></a><span class="sd">            str: Concatenated SVG elements for zodiac slices.</span>
</span><span id="ChartDrawer-1186"><a href="#ChartDrawer-1186"><span class="linenos">1186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1187"><a href="#ChartDrawer-1187"><span class="linenos">1187</span></a>        <span class="n">sings</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">Sign</span><span class="p">)</span>
</span><span id="ChartDrawer-1188"><a href="#ChartDrawer-1188"><span class="linenos">1188</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1189"><a href="#ChartDrawer-1189"><span class="linenos">1189</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sing</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sings</span><span class="p">):</span>
</span><span id="ChartDrawer-1190"><a href="#ChartDrawer-1190"><span class="linenos">1190</span></a>            <span class="n">output</span> <span class="o">+=</span> <span class="n">draw_zodiac_slice</span><span class="p">(</span>
</span><span id="ChartDrawer-1191"><a href="#ChartDrawer-1191"><span class="linenos">1191</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1192"><a href="#ChartDrawer-1192"><span class="linenos">1192</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1193"><a href="#ChartDrawer-1193"><span class="linenos">1193</span></a>                <span class="n">seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1194"><a href="#ChartDrawer-1194"><span class="linenos">1194</span></a>                <span class="n">num</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="ChartDrawer-1195"><a href="#ChartDrawer-1195"><span class="linenos">1195</span></a>                <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
</span><span id="ChartDrawer-1196"><a href="#ChartDrawer-1196"><span class="linenos">1196</span></a>                <span class="n">style</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fill:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;zodiac_bg_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">; fill-opacity: 0.5;&#39;</span><span class="p">,</span>
</span><span id="ChartDrawer-1197"><a href="#ChartDrawer-1197"><span class="linenos">1197</span></a>                <span class="nb">type</span><span class="o">=</span><span class="n">sing</span><span class="p">,</span>
</span><span id="ChartDrawer-1198"><a href="#ChartDrawer-1198"><span class="linenos">1198</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1199"><a href="#ChartDrawer-1199"><span class="linenos">1199</span></a>
</span><span id="ChartDrawer-1200"><a href="#ChartDrawer-1200"><span class="linenos">1200</span></a>        <span class="k">return</span> <span class="n">output</span>
</span><span id="ChartDrawer-1201"><a href="#ChartDrawer-1201"><span class="linenos">1201</span></a>
</span><span id="ChartDrawer-1202"><a href="#ChartDrawer-1202"><span class="linenos">1202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_draw_all_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ar</span><span class="p">):</span>
</span><span id="ChartDrawer-1203"><a href="#ChartDrawer-1203"><span class="linenos">1203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1204"><a href="#ChartDrawer-1204"><span class="linenos">1204</span></a><span class="sd">        Render SVG lines for all aspects in the chart.</span>
</span><span id="ChartDrawer-1205"><a href="#ChartDrawer-1205"><span class="linenos">1205</span></a>
</span><span id="ChartDrawer-1206"><a href="#ChartDrawer-1206"><span class="linenos">1206</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1207"><a href="#ChartDrawer-1207"><span class="linenos">1207</span></a><span class="sd">            r (float): Radius at which aspect lines originate.</span>
</span><span id="ChartDrawer-1208"><a href="#ChartDrawer-1208"><span class="linenos">1208</span></a><span class="sd">            ar (float): Radius at which aspect lines terminate.</span>
</span><span id="ChartDrawer-1209"><a href="#ChartDrawer-1209"><span class="linenos">1209</span></a>
</span><span id="ChartDrawer-1210"><a href="#ChartDrawer-1210"><span class="linenos">1210</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1211"><a href="#ChartDrawer-1211"><span class="linenos">1211</span></a><span class="sd">            str: SVG markup for all aspect lines.</span>
</span><span id="ChartDrawer-1212"><a href="#ChartDrawer-1212"><span class="linenos">1212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1213"><a href="#ChartDrawer-1213"><span class="linenos">1213</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1214"><a href="#ChartDrawer-1214"><span class="linenos">1214</span></a>        <span class="c1"># Track rendered icon positions (x, y, aspect_degrees) to avoid overlapping symbols of same type</span>
</span><span id="ChartDrawer-1215"><a href="#ChartDrawer-1215"><span class="linenos">1215</span></a>        <span class="n">rendered_icon_positions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-1216"><a href="#ChartDrawer-1216"><span class="linenos">1216</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">:</span>
</span><span id="ChartDrawer-1217"><a href="#ChartDrawer-1217"><span class="linenos">1217</span></a>            <span class="n">aspect_name</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1218"><a href="#ChartDrawer-1218"><span class="linenos">1218</span></a>            <span class="n">aspect_color</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">aspect_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ChartDrawer-1219"><a href="#ChartDrawer-1219"><span class="linenos">1219</span></a>            <span class="k">if</span> <span class="n">aspect_color</span><span class="p">:</span>
</span><span id="ChartDrawer-1220"><a href="#ChartDrawer-1220"><span class="linenos">1220</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">draw_aspect_line</span><span class="p">(</span>
</span><span id="ChartDrawer-1221"><a href="#ChartDrawer-1221"><span class="linenos">1221</span></a>                    <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
</span><span id="ChartDrawer-1222"><a href="#ChartDrawer-1222"><span class="linenos">1222</span></a>                    <span class="n">ar</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span>
</span><span id="ChartDrawer-1223"><a href="#ChartDrawer-1223"><span class="linenos">1223</span></a>                    <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
</span><span id="ChartDrawer-1224"><a href="#ChartDrawer-1224"><span class="linenos">1224</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">aspect_color</span><span class="p">,</span>
</span><span id="ChartDrawer-1225"><a href="#ChartDrawer-1225"><span class="linenos">1225</span></a>                    <span class="n">seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1226"><a href="#ChartDrawer-1226"><span class="linenos">1226</span></a>                    <span class="n">show_aspect_icon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_aspect_icons</span><span class="p">,</span>
</span><span id="ChartDrawer-1227"><a href="#ChartDrawer-1227"><span class="linenos">1227</span></a>                    <span class="n">rendered_icon_positions</span><span class="o">=</span><span class="n">rendered_icon_positions</span><span class="p">,</span>
</span><span id="ChartDrawer-1228"><a href="#ChartDrawer-1228"><span class="linenos">1228</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1229"><a href="#ChartDrawer-1229"><span class="linenos">1229</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="ChartDrawer-1230"><a href="#ChartDrawer-1230"><span class="linenos">1230</span></a>
</span><span id="ChartDrawer-1231"><a href="#ChartDrawer-1231"><span class="linenos">1231</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_draw_all_transit_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ar</span><span class="p">):</span>
</span><span id="ChartDrawer-1232"><a href="#ChartDrawer-1232"><span class="linenos">1232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1233"><a href="#ChartDrawer-1233"><span class="linenos">1233</span></a><span class="sd">        Render SVG lines for all transit aspects in the chart.</span>
</span><span id="ChartDrawer-1234"><a href="#ChartDrawer-1234"><span class="linenos">1234</span></a>
</span><span id="ChartDrawer-1235"><a href="#ChartDrawer-1235"><span class="linenos">1235</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1236"><a href="#ChartDrawer-1236"><span class="linenos">1236</span></a><span class="sd">            r (float): Radius at which transit aspect lines originate.</span>
</span><span id="ChartDrawer-1237"><a href="#ChartDrawer-1237"><span class="linenos">1237</span></a><span class="sd">            ar (float): Radius at which transit aspect lines terminate.</span>
</span><span id="ChartDrawer-1238"><a href="#ChartDrawer-1238"><span class="linenos">1238</span></a>
</span><span id="ChartDrawer-1239"><a href="#ChartDrawer-1239"><span class="linenos">1239</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1240"><a href="#ChartDrawer-1240"><span class="linenos">1240</span></a><span class="sd">            str: SVG markup for all transit aspect lines.</span>
</span><span id="ChartDrawer-1241"><a href="#ChartDrawer-1241"><span class="linenos">1241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1242"><a href="#ChartDrawer-1242"><span class="linenos">1242</span></a>        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1243"><a href="#ChartDrawer-1243"><span class="linenos">1243</span></a>        <span class="c1"># Track rendered icon positions (x, y, aspect_degrees) to avoid overlapping symbols of same type</span>
</span><span id="ChartDrawer-1244"><a href="#ChartDrawer-1244"><span class="linenos">1244</span></a>        <span class="n">rendered_icon_positions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer-1245"><a href="#ChartDrawer-1245"><span class="linenos">1245</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">:</span>
</span><span id="ChartDrawer-1246"><a href="#ChartDrawer-1246"><span class="linenos">1246</span></a>            <span class="n">aspect_name</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1247"><a href="#ChartDrawer-1247"><span class="linenos">1247</span></a>            <span class="n">aspect_color</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">aspect_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ChartDrawer-1248"><a href="#ChartDrawer-1248"><span class="linenos">1248</span></a>            <span class="k">if</span> <span class="n">aspect_color</span><span class="p">:</span>
</span><span id="ChartDrawer-1249"><a href="#ChartDrawer-1249"><span class="linenos">1249</span></a>                <span class="n">out</span> <span class="o">+=</span> <span class="n">draw_aspect_line</span><span class="p">(</span>
</span><span id="ChartDrawer-1250"><a href="#ChartDrawer-1250"><span class="linenos">1250</span></a>                    <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
</span><span id="ChartDrawer-1251"><a href="#ChartDrawer-1251"><span class="linenos">1251</span></a>                    <span class="n">ar</span><span class="o">=</span><span class="n">ar</span><span class="p">,</span>
</span><span id="ChartDrawer-1252"><a href="#ChartDrawer-1252"><span class="linenos">1252</span></a>                    <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
</span><span id="ChartDrawer-1253"><a href="#ChartDrawer-1253"><span class="linenos">1253</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">aspect_color</span><span class="p">,</span>
</span><span id="ChartDrawer-1254"><a href="#ChartDrawer-1254"><span class="linenos">1254</span></a>                    <span class="n">seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1255"><a href="#ChartDrawer-1255"><span class="linenos">1255</span></a>                    <span class="n">show_aspect_icon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_aspect_icons</span><span class="p">,</span>
</span><span id="ChartDrawer-1256"><a href="#ChartDrawer-1256"><span class="linenos">1256</span></a>                    <span class="n">rendered_icon_positions</span><span class="o">=</span><span class="n">rendered_icon_positions</span><span class="p">,</span>
</span><span id="ChartDrawer-1257"><a href="#ChartDrawer-1257"><span class="linenos">1257</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1258"><a href="#ChartDrawer-1258"><span class="linenos">1258</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="ChartDrawer-1259"><a href="#ChartDrawer-1259"><span class="linenos">1259</span></a>
</span><span id="ChartDrawer-1260"><a href="#ChartDrawer-1260"><span class="linenos">1260</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">ellipsis_symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">truncate_at_space</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer-1261"><a href="#ChartDrawer-1261"><span class="linenos">1261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1262"><a href="#ChartDrawer-1262"><span class="linenos">1262</span></a><span class="sd">        Truncate a name if it&#39;s too long, preserving readability.</span>
</span><span id="ChartDrawer-1263"><a href="#ChartDrawer-1263"><span class="linenos">1263</span></a>
</span><span id="ChartDrawer-1264"><a href="#ChartDrawer-1264"><span class="linenos">1264</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1265"><a href="#ChartDrawer-1265"><span class="linenos">1265</span></a><span class="sd">            name (str): The name to truncate</span>
</span><span id="ChartDrawer-1266"><a href="#ChartDrawer-1266"><span class="linenos">1266</span></a><span class="sd">            max_length (int): Maximum allowed length</span>
</span><span id="ChartDrawer-1267"><a href="#ChartDrawer-1267"><span class="linenos">1267</span></a>
</span><span id="ChartDrawer-1268"><a href="#ChartDrawer-1268"><span class="linenos">1268</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1269"><a href="#ChartDrawer-1269"><span class="linenos">1269</span></a><span class="sd">            str: Truncated name with ellipsis if needed</span>
</span><span id="ChartDrawer-1270"><a href="#ChartDrawer-1270"><span class="linenos">1270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1271"><a href="#ChartDrawer-1271"><span class="linenos">1271</span></a>        <span class="k">if</span> <span class="n">truncate_at_space</span><span class="p">:</span>
</span><span id="ChartDrawer-1272"><a href="#ChartDrawer-1272"><span class="linenos">1272</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ChartDrawer-1273"><a href="#ChartDrawer-1273"><span class="linenos">1273</span></a>
</span><span id="ChartDrawer-1274"><a href="#ChartDrawer-1274"><span class="linenos">1274</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_length</span><span class="p">:</span>
</span><span id="ChartDrawer-1275"><a href="#ChartDrawer-1275"><span class="linenos">1275</span></a>            <span class="k">return</span> <span class="n">name</span>
</span><span id="ChartDrawer-1276"><a href="#ChartDrawer-1276"><span class="linenos">1276</span></a>
</span><span id="ChartDrawer-1277"><a href="#ChartDrawer-1277"><span class="linenos">1277</span></a>        <span class="k">return</span> <span class="n">name</span><span class="p">[:</span><span class="n">max_length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ellipsis_symbol</span>
</span><span id="ChartDrawer-1278"><a href="#ChartDrawer-1278"><span class="linenos">1278</span></a>
</span><span id="ChartDrawer-1279"><a href="#ChartDrawer-1279"><span class="linenos">1279</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_chart_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom_title_override</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer-1280"><a href="#ChartDrawer-1280"><span class="linenos">1280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1281"><a href="#ChartDrawer-1281"><span class="linenos">1281</span></a><span class="sd">        Generate the chart title based on chart type and custom title settings.</span>
</span><span id="ChartDrawer-1282"><a href="#ChartDrawer-1282"><span class="linenos">1282</span></a>
</span><span id="ChartDrawer-1283"><a href="#ChartDrawer-1283"><span class="linenos">1283</span></a><span class="sd">        If a custom title is provided, it will be used. Otherwise, generates the</span>
</span><span id="ChartDrawer-1284"><a href="#ChartDrawer-1284"><span class="linenos">1284</span></a><span class="sd">        appropriate default title based on the chart type and subjects.</span>
</span><span id="ChartDrawer-1285"><a href="#ChartDrawer-1285"><span class="linenos">1285</span></a>
</span><span id="ChartDrawer-1286"><a href="#ChartDrawer-1286"><span class="linenos">1286</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1287"><a href="#ChartDrawer-1287"><span class="linenos">1287</span></a><span class="sd">            custom_title_override (str | None): Explicit override supplied at render time.</span>
</span><span id="ChartDrawer-1288"><a href="#ChartDrawer-1288"><span class="linenos">1288</span></a>
</span><span id="ChartDrawer-1289"><a href="#ChartDrawer-1289"><span class="linenos">1289</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1290"><a href="#ChartDrawer-1290"><span class="linenos">1290</span></a><span class="sd">            str: The chart title to display (max ~40 characters).</span>
</span><span id="ChartDrawer-1291"><a href="#ChartDrawer-1291"><span class="linenos">1291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1292"><a href="#ChartDrawer-1292"><span class="linenos">1292</span></a>        <span class="c1"># If a kwarg override is provided, use it</span>
</span><span id="ChartDrawer-1293"><a href="#ChartDrawer-1293"><span class="linenos">1293</span></a>        <span class="k">if</span> <span class="n">custom_title_override</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1294"><a href="#ChartDrawer-1294"><span class="linenos">1294</span></a>            <span class="k">return</span> <span class="n">custom_title_override</span>
</span><span id="ChartDrawer-1295"><a href="#ChartDrawer-1295"><span class="linenos">1295</span></a>
</span><span id="ChartDrawer-1296"><a href="#ChartDrawer-1296"><span class="linenos">1296</span></a>        <span class="c1"># If custom title is provided at initialization, use it</span>
</span><span id="ChartDrawer-1297"><a href="#ChartDrawer-1297"><span class="linenos">1297</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1298"><a href="#ChartDrawer-1298"><span class="linenos">1298</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_title</span>
</span><span id="ChartDrawer-1299"><a href="#ChartDrawer-1299"><span class="linenos">1299</span></a>
</span><span id="ChartDrawer-1300"><a href="#ChartDrawer-1300"><span class="linenos">1300</span></a>        <span class="c1"># Generate default title based on chart type</span>
</span><span id="ChartDrawer-1301"><a href="#ChartDrawer-1301"><span class="linenos">1301</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1302"><a href="#ChartDrawer-1302"><span class="linenos">1302</span></a>            <span class="n">natal_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;birth_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1303"><a href="#ChartDrawer-1303"><span class="linenos">1303</span></a>            <span class="n">truncated_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1304"><a href="#ChartDrawer-1304"><span class="linenos">1304</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">truncated_name</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">natal_label</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-1305"><a href="#ChartDrawer-1305"><span class="linenos">1305</span></a>
</span><span id="ChartDrawer-1306"><a href="#ChartDrawer-1306"><span class="linenos">1306</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1307"><a href="#ChartDrawer-1307"><span class="linenos">1307</span></a>            <span class="n">composite_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;composite_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1308"><a href="#ChartDrawer-1308"><span class="linenos">1308</span></a>            <span class="n">and_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;and_word&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1309"><a href="#ChartDrawer-1309"><span class="linenos">1309</span></a>            <span class="n">name1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1310"><a href="#ChartDrawer-1310"><span class="linenos">1310</span></a>            <span class="n">name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1311"><a href="#ChartDrawer-1311"><span class="linenos">1311</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">composite_label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">and_word</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1312"><a href="#ChartDrawer-1312"><span class="linenos">1312</span></a>
</span><span id="ChartDrawer-1313"><a href="#ChartDrawer-1313"><span class="linenos">1313</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1314"><a href="#ChartDrawer-1314"><span class="linenos">1314</span></a>            <span class="n">transit_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;transits&quot;</span><span class="p">,</span> <span class="s2">&quot;Transits&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1315"><a href="#ChartDrawer-1315"><span class="linenos">1315</span></a>            <span class="n">date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1316"><a href="#ChartDrawer-1316"><span class="linenos">1316</span></a>            <span class="n">date_str</span> <span class="o">=</span> <span class="n">date_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1317"><a href="#ChartDrawer-1317"><span class="linenos">1317</span></a>            <span class="n">truncated_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1318"><a href="#ChartDrawer-1318"><span class="linenos">1318</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">transit_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1319"><a href="#ChartDrawer-1319"><span class="linenos">1319</span></a>
</span><span id="ChartDrawer-1320"><a href="#ChartDrawer-1320"><span class="linenos">1320</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1321"><a href="#ChartDrawer-1321"><span class="linenos">1321</span></a>            <span class="n">synastry_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;synastry_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1322"><a href="#ChartDrawer-1322"><span class="linenos">1322</span></a>            <span class="n">and_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;and_word&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1323"><a href="#ChartDrawer-1323"><span class="linenos">1323</span></a>            <span class="n">name1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1324"><a href="#ChartDrawer-1324"><span class="linenos">1324</span></a>            <span class="n">name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1325"><a href="#ChartDrawer-1325"><span class="linenos">1325</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">synastry_label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">name1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">and_word</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name2</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1326"><a href="#ChartDrawer-1326"><span class="linenos">1326</span></a>
</span><span id="ChartDrawer-1327"><a href="#ChartDrawer-1327"><span class="linenos">1327</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1328"><a href="#ChartDrawer-1328"><span class="linenos">1328</span></a>            <span class="n">return_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1329"><a href="#ChartDrawer-1329"><span class="linenos">1329</span></a>            <span class="n">year</span> <span class="o">=</span> <span class="n">return_datetime</span><span class="o">.</span><span class="n">year</span>
</span><span id="ChartDrawer-1330"><a href="#ChartDrawer-1330"><span class="linenos">1330</span></a>            <span class="n">month_year</span> <span class="o">=</span> <span class="n">return_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1331"><a href="#ChartDrawer-1331"><span class="linenos">1331</span></a>            <span class="n">truncated_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1332"><a href="#ChartDrawer-1332"><span class="linenos">1332</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1333"><a href="#ChartDrawer-1333"><span class="linenos">1333</span></a>                <span class="n">solar_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;solar_return&quot;</span><span class="p">,</span> <span class="s2">&quot;Solar&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1334"><a href="#ChartDrawer-1334"><span class="linenos">1334</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">solar_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1335"><a href="#ChartDrawer-1335"><span class="linenos">1335</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1336"><a href="#ChartDrawer-1336"><span class="linenos">1336</span></a>                <span class="n">lunar_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_return&quot;</span><span class="p">,</span> <span class="s2">&quot;Lunar&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1337"><a href="#ChartDrawer-1337"><span class="linenos">1337</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">lunar_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">month_year</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1338"><a href="#ChartDrawer-1338"><span class="linenos">1338</span></a>
</span><span id="ChartDrawer-1339"><a href="#ChartDrawer-1339"><span class="linenos">1339</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1340"><a href="#ChartDrawer-1340"><span class="linenos">1340</span></a>            <span class="n">return_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1341"><a href="#ChartDrawer-1341"><span class="linenos">1341</span></a>            <span class="n">year</span> <span class="o">=</span> <span class="n">return_datetime</span><span class="o">.</span><span class="n">year</span>
</span><span id="ChartDrawer-1342"><a href="#ChartDrawer-1342"><span class="linenos">1342</span></a>            <span class="n">month_year</span> <span class="o">=</span> <span class="n">return_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1343"><a href="#ChartDrawer-1343"><span class="linenos">1343</span></a>            <span class="n">truncated_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1344"><a href="#ChartDrawer-1344"><span class="linenos">1344</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1345"><a href="#ChartDrawer-1345"><span class="linenos">1345</span></a>                <span class="n">solar_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;solar_return&quot;</span><span class="p">,</span> <span class="s2">&quot;Solar&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1346"><a href="#ChartDrawer-1346"><span class="linenos">1346</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">solar_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1347"><a href="#ChartDrawer-1347"><span class="linenos">1347</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1348"><a href="#ChartDrawer-1348"><span class="linenos">1348</span></a>                <span class="n">lunar_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_return&quot;</span><span class="p">,</span> <span class="s2">&quot;Lunar&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1349"><a href="#ChartDrawer-1349"><span class="linenos">1349</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">lunar_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">month_year</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1350"><a href="#ChartDrawer-1350"><span class="linenos">1350</span></a>
</span><span id="ChartDrawer-1351"><a href="#ChartDrawer-1351"><span class="linenos">1351</span></a>        <span class="c1"># Fallback for unknown chart types</span>
</span><span id="ChartDrawer-1352"><a href="#ChartDrawer-1352"><span class="linenos">1352</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1353"><a href="#ChartDrawer-1353"><span class="linenos">1353</span></a>
</span><span id="ChartDrawer-1354"><a href="#ChartDrawer-1354"><span class="linenos">1354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_template_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChartTemplateModel</span><span class="p">:</span>
</span><span id="ChartDrawer-1355"><a href="#ChartDrawer-1355"><span class="linenos">1355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1356"><a href="#ChartDrawer-1356"><span class="linenos">1356</span></a><span class="sd">        Assemble chart data and rendering instructions into a template dictionary.</span>
</span><span id="ChartDrawer-1357"><a href="#ChartDrawer-1357"><span class="linenos">1357</span></a>
</span><span id="ChartDrawer-1358"><a href="#ChartDrawer-1358"><span class="linenos">1358</span></a><span class="sd">        Gathers styling, dimensions, and SVG fragments for chart components based on</span>
</span><span id="ChartDrawer-1359"><a href="#ChartDrawer-1359"><span class="linenos">1359</span></a><span class="sd">        chart type and subjects.</span>
</span><span id="ChartDrawer-1360"><a href="#ChartDrawer-1360"><span class="linenos">1360</span></a>
</span><span id="ChartDrawer-1361"><a href="#ChartDrawer-1361"><span class="linenos">1361</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-1362"><a href="#ChartDrawer-1362"><span class="linenos">1362</span></a><span class="sd">            custom_title (str | None): Optional runtime override for the chart title.</span>
</span><span id="ChartDrawer-1363"><a href="#ChartDrawer-1363"><span class="linenos">1363</span></a>
</span><span id="ChartDrawer-1364"><a href="#ChartDrawer-1364"><span class="linenos">1364</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-1365"><a href="#ChartDrawer-1365"><span class="linenos">1365</span></a><span class="sd">            ChartTemplateModel: Populated structure of template variables.</span>
</span><span id="ChartDrawer-1366"><a href="#ChartDrawer-1366"><span class="linenos">1366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-1367"><a href="#ChartDrawer-1367"><span class="linenos">1367</span></a>        <span class="c1"># Initialize template dictionary</span>
</span><span id="ChartDrawer-1368"><a href="#ChartDrawer-1368"><span class="linenos">1368</span></a>        <span class="n">template_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ChartDrawer-1369"><a href="#ChartDrawer-1369"><span class="linenos">1369</span></a>
</span><span id="ChartDrawer-1370"><a href="#ChartDrawer-1370"><span class="linenos">1370</span></a>        <span class="c1"># -------------------------------------#</span>
</span><span id="ChartDrawer-1371"><a href="#ChartDrawer-1371"><span class="linenos">1371</span></a>        <span class="c1">#  COMMON SETTINGS FOR ALL CHART TYPES #</span>
</span><span id="ChartDrawer-1372"><a href="#ChartDrawer-1372"><span class="linenos">1372</span></a>        <span class="c1"># -------------------------------------#</span>
</span><span id="ChartDrawer-1373"><a href="#ChartDrawer-1373"><span class="linenos">1373</span></a>
</span><span id="ChartDrawer-1374"><a href="#ChartDrawer-1374"><span class="linenos">1374</span></a>        <span class="c1"># Set the color style tag and basic dimensions</span>
</span><span id="ChartDrawer-1375"><a href="#ChartDrawer-1375"><span class="linenos">1375</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;color_style_tag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_style_tag</span>
</span><span id="ChartDrawer-1376"><a href="#ChartDrawer-1376"><span class="linenos">1376</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;chart_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
</span><span id="ChartDrawer-1377"><a href="#ChartDrawer-1377"><span class="linenos">1377</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;chart_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
</span><span id="ChartDrawer-1378"><a href="#ChartDrawer-1378"><span class="linenos">1378</span></a>
</span><span id="ChartDrawer-1379"><a href="#ChartDrawer-1379"><span class="linenos">1379</span></a>        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span>
</span><span id="ChartDrawer-1380"><a href="#ChartDrawer-1380"><span class="linenos">1380</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;full_wheel_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;wheel&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1381"><a href="#ChartDrawer-1381"><span class="linenos">1381</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;houses_and_planets_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1382"><a href="#ChartDrawer-1382"><span class="linenos">1382</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;aspect_grid_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_grid&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1383"><a href="#ChartDrawer-1383"><span class="linenos">1383</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;aspect_list_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;aspect_list&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1384"><a href="#ChartDrawer-1384"><span class="linenos">1384</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;title_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1385"><a href="#ChartDrawer-1385"><span class="linenos">1385</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;elements_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1386"><a href="#ChartDrawer-1386"><span class="linenos">1386</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;qualities_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;qualities&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1387"><a href="#ChartDrawer-1387"><span class="linenos">1387</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;lunar_phase_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1388"><a href="#ChartDrawer-1388"><span class="linenos">1388</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="s2">&quot;bottom_left&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1389"><a href="#ChartDrawer-1389"><span class="linenos">1389</span></a>
</span><span id="ChartDrawer-1390"><a href="#ChartDrawer-1390"><span class="linenos">1390</span></a>        <span class="c1"># Set paper colors</span>
</span><span id="ChartDrawer-1391"><a href="#ChartDrawer-1391"><span class="linenos">1391</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;paper_color_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1392"><a href="#ChartDrawer-1392"><span class="linenos">1392</span></a>
</span><span id="ChartDrawer-1393"><a href="#ChartDrawer-1393"><span class="linenos">1393</span></a>        <span class="c1"># Set background color based on transparent_background setting</span>
</span><span id="ChartDrawer-1394"><a href="#ChartDrawer-1394"><span class="linenos">1394</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transparent_background</span><span class="p">:</span>
</span><span id="ChartDrawer-1395"><a href="#ChartDrawer-1395"><span class="linenos">1395</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;transparent&quot;</span>
</span><span id="ChartDrawer-1396"><a href="#ChartDrawer-1396"><span class="linenos">1396</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1397"><a href="#ChartDrawer-1397"><span class="linenos">1397</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1398"><a href="#ChartDrawer-1398"><span class="linenos">1398</span></a>
</span><span id="ChartDrawer-1399"><a href="#ChartDrawer-1399"><span class="linenos">1399</span></a>        <span class="c1"># Set planet colors - initialize all possible colors first with defaults</span>
</span><span id="ChartDrawer-1400"><a href="#ChartDrawer-1400"><span class="linenos">1400</span></a>        <span class="n">default_color</span> <span class="o">=</span> <span class="s2">&quot;#000000&quot;</span>  <span class="c1"># Default black color for unused planets</span>
</span><span id="ChartDrawer-1401"><a href="#ChartDrawer-1401"><span class="linenos">1401</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">42</span><span class="p">):</span>  <span class="c1"># Support all 42 celestial points (0-41)</span>
</span><span id="ChartDrawer-1402"><a href="#ChartDrawer-1402"><span class="linenos">1402</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;planets_color_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_color</span>
</span><span id="ChartDrawer-1403"><a href="#ChartDrawer-1403"><span class="linenos">1403</span></a>
</span><span id="ChartDrawer-1404"><a href="#ChartDrawer-1404"><span class="linenos">1404</span></a>        <span class="c1"># Override with actual colors from settings</span>
</span><span id="ChartDrawer-1405"><a href="#ChartDrawer-1405"><span class="linenos">1405</span></a>        <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">:</span>
</span><span id="ChartDrawer-1406"><a href="#ChartDrawer-1406"><span class="linenos">1406</span></a>            <span class="n">planet_id</span> <span class="o">=</span> <span class="n">planet</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1407"><a href="#ChartDrawer-1407"><span class="linenos">1407</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;planets_color_</span><span class="si">{</span><span class="n">planet_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">planet</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1408"><a href="#ChartDrawer-1408"><span class="linenos">1408</span></a>
</span><span id="ChartDrawer-1409"><a href="#ChartDrawer-1409"><span class="linenos">1409</span></a>        <span class="c1"># Set zodiac colors</span>
</span><span id="ChartDrawer-1410"><a href="#ChartDrawer-1410"><span class="linenos">1410</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
</span><span id="ChartDrawer-1411"><a href="#ChartDrawer-1411"><span class="linenos">1411</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;zodiac_color_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;zodiac_icon_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1412"><a href="#ChartDrawer-1412"><span class="linenos">1412</span></a>
</span><span id="ChartDrawer-1413"><a href="#ChartDrawer-1413"><span class="linenos">1413</span></a>        <span class="c1"># Set orb colors</span>
</span><span id="ChartDrawer-1414"><a href="#ChartDrawer-1414"><span class="linenos">1414</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span>
</span><span id="ChartDrawer-1415"><a href="#ChartDrawer-1415"><span class="linenos">1415</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;orb_color_</span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;degree&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1416"><a href="#ChartDrawer-1416"><span class="linenos">1416</span></a>
</span><span id="ChartDrawer-1417"><a href="#ChartDrawer-1417"><span class="linenos">1417</span></a>        <span class="c1"># Draw zodiac circle slices</span>
</span><span id="ChartDrawer-1418"><a href="#ChartDrawer-1418"><span class="linenos">1418</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeZodiac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_zodiac_circle_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">)</span>
</span><span id="ChartDrawer-1419"><a href="#ChartDrawer-1419"><span class="linenos">1419</span></a>
</span><span id="ChartDrawer-1420"><a href="#ChartDrawer-1420"><span class="linenos">1420</span></a>        <span class="c1"># Calculate element percentages</span>
</span><span id="ChartDrawer-1421"><a href="#ChartDrawer-1421"><span class="linenos">1421</span></a>        <span class="n">total_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fire</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">water</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">earth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">air</span>
</span><span id="ChartDrawer-1422"><a href="#ChartDrawer-1422"><span class="linenos">1422</span></a>        <span class="n">element_values</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fire&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fire</span><span class="p">,</span> <span class="s2">&quot;earth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">earth</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">air</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">water</span><span class="p">}</span>
</span><span id="ChartDrawer-1423"><a href="#ChartDrawer-1423"><span class="linenos">1423</span></a>        <span class="n">element_percentages</span> <span class="o">=</span> <span class="n">distribute_percentages_to_100</span><span class="p">(</span><span class="n">element_values</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_elements</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;fire&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;earth&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ChartDrawer-1424"><a href="#ChartDrawer-1424"><span class="linenos">1424</span></a>        <span class="n">fire_percentage</span> <span class="o">=</span> <span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;fire&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1425"><a href="#ChartDrawer-1425"><span class="linenos">1425</span></a>        <span class="n">earth_percentage</span> <span class="o">=</span> <span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;earth&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1426"><a href="#ChartDrawer-1426"><span class="linenos">1426</span></a>        <span class="n">air_percentage</span> <span class="o">=</span> <span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1427"><a href="#ChartDrawer-1427"><span class="linenos">1427</span></a>        <span class="n">water_percentage</span> <span class="o">=</span> <span class="n">element_percentages</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1428"><a href="#ChartDrawer-1428"><span class="linenos">1428</span></a>
</span><span id="ChartDrawer-1429"><a href="#ChartDrawer-1429"><span class="linenos">1429</span></a>        <span class="c1"># Element Percentages</span>
</span><span id="ChartDrawer-1430"><a href="#ChartDrawer-1430"><span class="linenos">1430</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;elements_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;elements&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Elements&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="ChartDrawer-1431"><a href="#ChartDrawer-1431"><span class="linenos">1431</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;fire_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;fire&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fire&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">fire_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1432"><a href="#ChartDrawer-1432"><span class="linenos">1432</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;earth_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;earth&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Earth&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">earth_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1433"><a href="#ChartDrawer-1433"><span class="linenos">1433</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;air_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;air&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Air&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">air_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1434"><a href="#ChartDrawer-1434"><span class="linenos">1434</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;water_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;water&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Water&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">water_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1435"><a href="#ChartDrawer-1435"><span class="linenos">1435</span></a>
</span><span id="ChartDrawer-1436"><a href="#ChartDrawer-1436"><span class="linenos">1436</span></a>
</span><span id="ChartDrawer-1437"><a href="#ChartDrawer-1437"><span class="linenos">1437</span></a>        <span class="c1"># Qualities Percentages</span>
</span><span id="ChartDrawer-1438"><a href="#ChartDrawer-1438"><span class="linenos">1438</span></a>        <span class="n">total_qualities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cardinal</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span>
</span><span id="ChartDrawer-1439"><a href="#ChartDrawer-1439"><span class="linenos">1439</span></a>        <span class="n">quality_values</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cardinal&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cardinal</span><span class="p">,</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span><span class="p">,</span> <span class="s2">&quot;mutable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span><span class="p">}</span>
</span><span id="ChartDrawer-1440"><a href="#ChartDrawer-1440"><span class="linenos">1440</span></a>        <span class="n">quality_percentages</span> <span class="o">=</span> <span class="n">distribute_percentages_to_100</span><span class="p">(</span><span class="n">quality_values</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_qualities</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;cardinal&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;mutable&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ChartDrawer-1441"><a href="#ChartDrawer-1441"><span class="linenos">1441</span></a>        <span class="n">cardinal_percentage</span> <span class="o">=</span> <span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;cardinal&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1442"><a href="#ChartDrawer-1442"><span class="linenos">1442</span></a>        <span class="n">fixed_percentage</span> <span class="o">=</span> <span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1443"><a href="#ChartDrawer-1443"><span class="linenos">1443</span></a>        <span class="n">mutable_percentage</span> <span class="o">=</span> <span class="n">quality_percentages</span><span class="p">[</span><span class="s2">&quot;mutable&quot;</span><span class="p">]</span>
</span><span id="ChartDrawer-1444"><a href="#ChartDrawer-1444"><span class="linenos">1444</span></a>
</span><span id="ChartDrawer-1445"><a href="#ChartDrawer-1445"><span class="linenos">1445</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;qualities_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;qualities&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Qualities&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="ChartDrawer-1446"><a href="#ChartDrawer-1446"><span class="linenos">1446</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;cardinal_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;cardinal&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Cardinal&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cardinal_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1447"><a href="#ChartDrawer-1447"><span class="linenos">1447</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;fixed_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Fixed&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">fixed_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1448"><a href="#ChartDrawer-1448"><span class="linenos">1448</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;mutable_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;mutable&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mutable&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">mutable_percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span id="ChartDrawer-1449"><a href="#ChartDrawer-1449"><span class="linenos">1449</span></a>
</span><span id="ChartDrawer-1450"><a href="#ChartDrawer-1450"><span class="linenos">1450</span></a>        <span class="c1"># Get houses list for main subject</span>
</span><span id="ChartDrawer-1451"><a href="#ChartDrawer-1451"><span class="linenos">1451</span></a>        <span class="n">first_subject_houses_list</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">)</span>
</span><span id="ChartDrawer-1452"><a href="#ChartDrawer-1452"><span class="linenos">1452</span></a>
</span><span id="ChartDrawer-1453"><a href="#ChartDrawer-1453"><span class="linenos">1453</span></a>        <span class="c1"># Chart title</span>
</span><span id="ChartDrawer-1454"><a href="#ChartDrawer-1454"><span class="linenos">1454</span></a>        <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;stringTitle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_chart_title</span><span class="p">(</span><span class="n">custom_title_override</span><span class="o">=</span><span class="n">custom_title</span><span class="p">)</span>
</span><span id="ChartDrawer-1455"><a href="#ChartDrawer-1455"><span class="linenos">1455</span></a>
</span><span id="ChartDrawer-1456"><a href="#ChartDrawer-1456"><span class="linenos">1456</span></a>        <span class="c1"># ------------------------------- #</span>
</span><span id="ChartDrawer-1457"><a href="#ChartDrawer-1457"><span class="linenos">1457</span></a>        <span class="c1">#  CHART TYPE SPECIFIC SETTINGS   #</span>
</span><span id="ChartDrawer-1458"><a href="#ChartDrawer-1458"><span class="linenos">1458</span></a>        <span class="c1"># ------------------------------- #</span>
</span><span id="ChartDrawer-1459"><a href="#ChartDrawer-1459"><span class="linenos">1459</span></a>
</span><span id="ChartDrawer-1460"><a href="#ChartDrawer-1460"><span class="linenos">1460</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1461"><a href="#ChartDrawer-1461"><span class="linenos">1461</span></a>            <span class="c1"># Set viewbox dynamically</span>
</span><span id="ChartDrawer-1462"><a href="#ChartDrawer-1462"><span class="linenos">1462</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;viewbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-1463"><a href="#ChartDrawer-1463"><span class="linenos">1463</span></a>
</span><span id="ChartDrawer-1464"><a href="#ChartDrawer-1464"><span class="linenos">1464</span></a>            <span class="c1"># Rings and circles</span>
</span><span id="ChartDrawer-1465"><a href="#ChartDrawer-1465"><span class="linenos">1465</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;transitRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1466"><a href="#ChartDrawer-1466"><span class="linenos">1466</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;degreeRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_degree_ring</span><span class="p">(</span>
</span><span id="ChartDrawer-1467"><a href="#ChartDrawer-1467"><span class="linenos">1467</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1468"><a href="#ChartDrawer-1468"><span class="linenos">1468</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1469"><a href="#ChartDrawer-1469"><span class="linenos">1469</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1470"><a href="#ChartDrawer-1470"><span class="linenos">1470</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1471"><a href="#ChartDrawer-1471"><span class="linenos">1471</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1472"><a href="#ChartDrawer-1472"><span class="linenos">1472</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_background_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1473"><a href="#ChartDrawer-1473"><span class="linenos">1473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1474"><a href="#ChartDrawer-1474"><span class="linenos">1474</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1475"><a href="#ChartDrawer-1475"><span class="linenos">1475</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1476"><a href="#ChartDrawer-1476"><span class="linenos">1476</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1477"><a href="#ChartDrawer-1477"><span class="linenos">1477</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;first_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_first_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1478"><a href="#ChartDrawer-1478"><span class="linenos">1478</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1479"><a href="#ChartDrawer-1479"><span class="linenos">1479</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_2&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1480"><a href="#ChartDrawer-1480"><span class="linenos">1480</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1481"><a href="#ChartDrawer-1481"><span class="linenos">1481</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1482"><a href="#ChartDrawer-1482"><span class="linenos">1482</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1483"><a href="#ChartDrawer-1483"><span class="linenos">1483</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;second_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_second_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1484"><a href="#ChartDrawer-1484"><span class="linenos">1484</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1485"><a href="#ChartDrawer-1485"><span class="linenos">1485</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1486"><a href="#ChartDrawer-1486"><span class="linenos">1486</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1487"><a href="#ChartDrawer-1487"><span class="linenos">1487</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1488"><a href="#ChartDrawer-1488"><span class="linenos">1488</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1489"><a href="#ChartDrawer-1489"><span class="linenos">1489</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1490"><a href="#ChartDrawer-1490"><span class="linenos">1490</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;third_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_third_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1491"><a href="#ChartDrawer-1491"><span class="linenos">1491</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1492"><a href="#ChartDrawer-1492"><span class="linenos">1492</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1493"><a href="#ChartDrawer-1493"><span class="linenos">1493</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1494"><a href="#ChartDrawer-1494"><span class="linenos">1494</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1495"><a href="#ChartDrawer-1495"><span class="linenos">1495</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1496"><a href="#ChartDrawer-1496"><span class="linenos">1496</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1497"><a href="#ChartDrawer-1497"><span class="linenos">1497</span></a>
</span><span id="ChartDrawer-1498"><a href="#ChartDrawer-1498"><span class="linenos">1498</span></a>            <span class="c1"># Aspects</span>
</span><span id="ChartDrawer-1499"><a href="#ChartDrawer-1499"><span class="linenos">1499</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1500"><a href="#ChartDrawer-1500"><span class="linenos">1500</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1501"><a href="#ChartDrawer-1501"><span class="linenos">1501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1502"><a href="#ChartDrawer-1502"><span class="linenos">1502</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-1503"><a href="#ChartDrawer-1503"><span class="linenos">1503</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1504"><a href="#ChartDrawer-1504"><span class="linenos">1504</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1505"><a href="#ChartDrawer-1505"><span class="linenos">1505</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_all_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">)</span>
</span><span id="ChartDrawer-1506"><a href="#ChartDrawer-1506"><span class="linenos">1506</span></a>
</span><span id="ChartDrawer-1507"><a href="#ChartDrawer-1507"><span class="linenos">1507</span></a>            <span class="c1"># Top left section</span>
</span><span id="ChartDrawer-1508"><a href="#ChartDrawer-1508"><span class="linenos">1508</span></a>            <span class="n">latitude_string</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1509"><a href="#ChartDrawer-1509"><span class="linenos">1509</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span>
</span><span id="ChartDrawer-1510"><a href="#ChartDrawer-1510"><span class="linenos">1510</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1511"><a href="#ChartDrawer-1511"><span class="linenos">1511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south&quot;</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1512"><a href="#ChartDrawer-1512"><span class="linenos">1512</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1513"><a href="#ChartDrawer-1513"><span class="linenos">1513</span></a>            <span class="n">longitude_string</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1514"><a href="#ChartDrawer-1514"><span class="linenos">1514</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span><span class="p">,</span>
</span><span id="ChartDrawer-1515"><a href="#ChartDrawer-1515"><span class="linenos">1515</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;East&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1516"><a href="#ChartDrawer-1516"><span class="linenos">1516</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1517"><a href="#ChartDrawer-1517"><span class="linenos">1517</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1518"><a href="#ChartDrawer-1518"><span class="linenos">1518</span></a>
</span><span id="ChartDrawer-1519"><a href="#ChartDrawer-1519"><span class="linenos">1519</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Location&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">:&#39;</span>
</span><span id="ChartDrawer-1520"><a href="#ChartDrawer-1520"><span class="linenos">1520</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">nation</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1521"><a href="#ChartDrawer-1521"><span class="linenos">1521</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">latitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1522"><a href="#ChartDrawer-1522"><span class="linenos">1522</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1523"><a href="#ChartDrawer-1523"><span class="linenos">1523</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1524"><a href="#ChartDrawer-1524"><span class="linenos">1524</span></a>            <span class="n">localized_weekday</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span>
</span><span id="ChartDrawer-1525"><a href="#ChartDrawer-1525"><span class="linenos">1525</span></a>                <span class="sa">f</span><span class="s2">&quot;weekdays.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">day_of_week</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-1526"><a href="#ChartDrawer-1526"><span class="linenos">1526</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">day_of_week</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1527"><a href="#ChartDrawer-1527"><span class="linenos">1527</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1528"><a href="#ChartDrawer-1528"><span class="linenos">1528</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Day of Week&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">localized_weekday</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1529"><a href="#ChartDrawer-1529"><span class="linenos">1529</span></a>
</span><span id="ChartDrawer-1530"><a href="#ChartDrawer-1530"><span class="linenos">1530</span></a>            <span class="c1"># Bottom left section</span>
</span><span id="ChartDrawer-1531"><a href="#ChartDrawer-1531"><span class="linenos">1531</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">==</span> <span class="s2">&quot;Tropical&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1532"><a href="#ChartDrawer-1532"><span class="linenos">1532</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;zodiac&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Zodiac&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Tropical&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1533"><a href="#ChartDrawer-1533"><span class="linenos">1533</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1534"><a href="#ChartDrawer-1534"><span class="linenos">1534</span></a>                <span class="n">mode_const</span> <span class="o">=</span> <span class="s2">&quot;SIDM_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1535"><a href="#ChartDrawer-1535"><span class="linenos">1535</span></a>                <span class="n">mode_name</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">swe</span><span class="p">,</span> <span class="n">mode_const</span><span class="p">))</span>
</span><span id="ChartDrawer-1536"><a href="#ChartDrawer-1536"><span class="linenos">1536</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;ayanamsa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ayanamsa&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mode_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1537"><a href="#ChartDrawer-1537"><span class="linenos">1537</span></a>
</span><span id="ChartDrawer-1538"><a href="#ChartDrawer-1538"><span class="linenos">1538</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zodiac_info</span>
</span><span id="ChartDrawer-1539"><a href="#ChartDrawer-1539"><span class="linenos">1539</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1540"><a href="#ChartDrawer-1540"><span class="linenos">1540</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;domification&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Domification&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="ChartDrawer-1541"><a href="#ChartDrawer-1541"><span class="linenos">1541</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses_system_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1542"><a href="#ChartDrawer-1542"><span class="linenos">1542</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1543"><a href="#ChartDrawer-1543"><span class="linenos">1543</span></a>
</span><span id="ChartDrawer-1544"><a href="#ChartDrawer-1544"><span class="linenos">1544</span></a>            <span class="c1"># Lunar phase information (optional)</span>
</span><span id="ChartDrawer-1545"><a href="#ChartDrawer-1545"><span class="linenos">1545</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1546"><a href="#ChartDrawer-1546"><span class="linenos">1546</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1547"><a href="#ChartDrawer-1547"><span class="linenos">1547</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunation_day&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunation Day&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: &#39;</span>
</span><span id="ChartDrawer-1548"><a href="#ChartDrawer-1548"><span class="linenos">1548</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;moon_phase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-1549"><a href="#ChartDrawer-1549"><span class="linenos">1549</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1550"><a href="#ChartDrawer-1550"><span class="linenos">1550</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1551"><a href="#ChartDrawer-1551"><span class="linenos">1551</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunar Phase&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: &#39;</span>
</span><span id="ChartDrawer-1552"><a href="#ChartDrawer-1552"><span class="linenos">1552</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-1553"><a href="#ChartDrawer-1553"><span class="linenos">1553</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1554"><a href="#ChartDrawer-1554"><span class="linenos">1554</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1555"><a href="#ChartDrawer-1555"><span class="linenos">1555</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1556"><a href="#ChartDrawer-1556"><span class="linenos">1556</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1557"><a href="#ChartDrawer-1557"><span class="linenos">1557</span></a>
</span><span id="ChartDrawer-1558"><a href="#ChartDrawer-1558"><span class="linenos">1558</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1559"><a href="#ChartDrawer-1559"><span class="linenos">1559</span></a>                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Perspective&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: &#39;</span>
</span><span id="ChartDrawer-1560"><a href="#ChartDrawer-1560"><span class="linenos">1560</span></a>                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-1561"><a href="#ChartDrawer-1561"><span class="linenos">1561</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1562"><a href="#ChartDrawer-1562"><span class="linenos">1562</span></a>
</span><span id="ChartDrawer-1563"><a href="#ChartDrawer-1563"><span class="linenos">1563</span></a>            <span class="c1"># Moon phase section calculations</span>
</span><span id="ChartDrawer-1564"><a href="#ChartDrawer-1564"><span class="linenos">1564</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1565"><a href="#ChartDrawer-1565"><span class="linenos">1565</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeLunarPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="p">[</span><span class="s2">&quot;degrees_between_s_m&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">)</span>
</span><span id="ChartDrawer-1566"><a href="#ChartDrawer-1566"><span class="linenos">1566</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1567"><a href="#ChartDrawer-1567"><span class="linenos">1567</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1568"><a href="#ChartDrawer-1568"><span class="linenos">1568</span></a>
</span><span id="ChartDrawer-1569"><a href="#ChartDrawer-1569"><span class="linenos">1569</span></a>            <span class="c1"># Houses and planet drawing</span>
</span><span id="ChartDrawer-1570"><a href="#ChartDrawer-1570"><span class="linenos">1570</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1571"><a href="#ChartDrawer-1571"><span class="linenos">1571</span></a>                <span class="n">main_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1572"><a href="#ChartDrawer-1572"><span class="linenos">1572</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1573"><a href="#ChartDrawer-1573"><span class="linenos">1573</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1574"><a href="#ChartDrawer-1574"><span class="linenos">1574</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1575"><a href="#ChartDrawer-1575"><span class="linenos">1575</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1576"><a href="#ChartDrawer-1576"><span class="linenos">1576</span></a>
</span><span id="ChartDrawer-1577"><a href="#ChartDrawer-1577"><span class="linenos">1577</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_houses_cusps_and_text_number</span><span class="p">(</span>
</span><span id="ChartDrawer-1578"><a href="#ChartDrawer-1578"><span class="linenos">1578</span></a>                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1579"><a href="#ChartDrawer-1579"><span class="linenos">1579</span></a>                <span class="n">first_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1580"><a href="#ChartDrawer-1580"><span class="linenos">1580</span></a>                <span class="n">standard_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_radix_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1581"><a href="#ChartDrawer-1581"><span class="linenos">1581</span></a>                <span class="n">first_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1582"><a href="#ChartDrawer-1582"><span class="linenos">1582</span></a>                <span class="n">tenth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1583"><a href="#ChartDrawer-1583"><span class="linenos">1583</span></a>                <span class="n">seventh_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1584"><a href="#ChartDrawer-1584"><span class="linenos">1584</span></a>                <span class="n">fourth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1585"><a href="#ChartDrawer-1585"><span class="linenos">1585</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1586"><a href="#ChartDrawer-1586"><span class="linenos">1586</span></a>                <span class="n">c3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1587"><a href="#ChartDrawer-1587"><span class="linenos">1587</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1588"><a href="#ChartDrawer-1588"><span class="linenos">1588</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-1589"><a href="#ChartDrawer-1589"><span class="linenos">1589</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1590"><a href="#ChartDrawer-1590"><span class="linenos">1590</span></a>
</span><span id="ChartDrawer-1591"><a href="#ChartDrawer-1591"><span class="linenos">1591</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makePlanets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_planets</span><span class="p">(</span>
</span><span id="ChartDrawer-1592"><a href="#ChartDrawer-1592"><span class="linenos">1592</span></a>                <span class="n">available_planets_setting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-1593"><a href="#ChartDrawer-1593"><span class="linenos">1593</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1594"><a href="#ChartDrawer-1594"><span class="linenos">1594</span></a>                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1595"><a href="#ChartDrawer-1595"><span class="linenos">1595</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1596"><a href="#ChartDrawer-1596"><span class="linenos">1596</span></a>                <span class="n">third_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1597"><a href="#ChartDrawer-1597"><span class="linenos">1597</span></a>                <span class="n">main_subject_first_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1598"><a href="#ChartDrawer-1598"><span class="linenos">1598</span></a>                <span class="n">main_subject_seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1599"><a href="#ChartDrawer-1599"><span class="linenos">1599</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-1600"><a href="#ChartDrawer-1600"><span class="linenos">1600</span></a>                <span class="n">first_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1601"><a href="#ChartDrawer-1601"><span class="linenos">1601</span></a>                <span class="n">show_degree_indicators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span><span class="p">,</span>
</span><span id="ChartDrawer-1602"><a href="#ChartDrawer-1602"><span class="linenos">1602</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1603"><a href="#ChartDrawer-1603"><span class="linenos">1603</span></a>
</span><span id="ChartDrawer-1604"><a href="#ChartDrawer-1604"><span class="linenos">1604</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1605"><a href="#ChartDrawer-1605"><span class="linenos">1605</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;planets_and_house&quot;</span><span class="p">,</span> <span class="s2">&quot;Points for&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1606"><a href="#ChartDrawer-1606"><span class="linenos">1606</span></a>                <span class="n">subject_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="ChartDrawer-1607"><a href="#ChartDrawer-1607"><span class="linenos">1607</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1608"><a href="#ChartDrawer-1608"><span class="linenos">1608</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1609"><a href="#ChartDrawer-1609"><span class="linenos">1609</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1610"><a href="#ChartDrawer-1610"><span class="linenos">1610</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1611"><a href="#ChartDrawer-1611"><span class="linenos">1611</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1612"><a href="#ChartDrawer-1612"><span class="linenos">1612</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1613"><a href="#ChartDrawer-1613"><span class="linenos">1613</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1614"><a href="#ChartDrawer-1614"><span class="linenos">1614</span></a>
</span><span id="ChartDrawer-1615"><a href="#ChartDrawer-1615"><span class="linenos">1615</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1616"><a href="#ChartDrawer-1616"><span class="linenos">1616</span></a>            <span class="c1"># Set viewbox dynamically</span>
</span><span id="ChartDrawer-1617"><a href="#ChartDrawer-1617"><span class="linenos">1617</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;viewbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-1618"><a href="#ChartDrawer-1618"><span class="linenos">1618</span></a>
</span><span id="ChartDrawer-1619"><a href="#ChartDrawer-1619"><span class="linenos">1619</span></a>            <span class="c1"># Rings and circles</span>
</span><span id="ChartDrawer-1620"><a href="#ChartDrawer-1620"><span class="linenos">1620</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;transitRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1621"><a href="#ChartDrawer-1621"><span class="linenos">1621</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;degreeRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_degree_ring</span><span class="p">(</span>
</span><span id="ChartDrawer-1622"><a href="#ChartDrawer-1622"><span class="linenos">1622</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1623"><a href="#ChartDrawer-1623"><span class="linenos">1623</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1624"><a href="#ChartDrawer-1624"><span class="linenos">1624</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1625"><a href="#ChartDrawer-1625"><span class="linenos">1625</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1626"><a href="#ChartDrawer-1626"><span class="linenos">1626</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1627"><a href="#ChartDrawer-1627"><span class="linenos">1627</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_background_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1628"><a href="#ChartDrawer-1628"><span class="linenos">1628</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1629"><a href="#ChartDrawer-1629"><span class="linenos">1629</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1630"><a href="#ChartDrawer-1630"><span class="linenos">1630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1631"><a href="#ChartDrawer-1631"><span class="linenos">1631</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1632"><a href="#ChartDrawer-1632"><span class="linenos">1632</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;first_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_first_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1633"><a href="#ChartDrawer-1633"><span class="linenos">1633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1634"><a href="#ChartDrawer-1634"><span class="linenos">1634</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_2&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1635"><a href="#ChartDrawer-1635"><span class="linenos">1635</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1636"><a href="#ChartDrawer-1636"><span class="linenos">1636</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1637"><a href="#ChartDrawer-1637"><span class="linenos">1637</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1638"><a href="#ChartDrawer-1638"><span class="linenos">1638</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;second_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_second_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1639"><a href="#ChartDrawer-1639"><span class="linenos">1639</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1640"><a href="#ChartDrawer-1640"><span class="linenos">1640</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1641"><a href="#ChartDrawer-1641"><span class="linenos">1641</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1642"><a href="#ChartDrawer-1642"><span class="linenos">1642</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1643"><a href="#ChartDrawer-1643"><span class="linenos">1643</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1644"><a href="#ChartDrawer-1644"><span class="linenos">1644</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1645"><a href="#ChartDrawer-1645"><span class="linenos">1645</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;third_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_third_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1646"><a href="#ChartDrawer-1646"><span class="linenos">1646</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1647"><a href="#ChartDrawer-1647"><span class="linenos">1647</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1648"><a href="#ChartDrawer-1648"><span class="linenos">1648</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1649"><a href="#ChartDrawer-1649"><span class="linenos">1649</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1650"><a href="#ChartDrawer-1650"><span class="linenos">1650</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1651"><a href="#ChartDrawer-1651"><span class="linenos">1651</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1652"><a href="#ChartDrawer-1652"><span class="linenos">1652</span></a>
</span><span id="ChartDrawer-1653"><a href="#ChartDrawer-1653"><span class="linenos">1653</span></a>            <span class="c1"># Aspects</span>
</span><span id="ChartDrawer-1654"><a href="#ChartDrawer-1654"><span class="linenos">1654</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1655"><a href="#ChartDrawer-1655"><span class="linenos">1655</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1656"><a href="#ChartDrawer-1656"><span class="linenos">1656</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1657"><a href="#ChartDrawer-1657"><span class="linenos">1657</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-1658"><a href="#ChartDrawer-1658"><span class="linenos">1658</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1659"><a href="#ChartDrawer-1659"><span class="linenos">1659</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1660"><a href="#ChartDrawer-1660"><span class="linenos">1660</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_all_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">)</span>
</span><span id="ChartDrawer-1661"><a href="#ChartDrawer-1661"><span class="linenos">1661</span></a>
</span><span id="ChartDrawer-1662"><a href="#ChartDrawer-1662"><span class="linenos">1662</span></a>            <span class="c1"># Top left section</span>
</span><span id="ChartDrawer-1663"><a href="#ChartDrawer-1663"><span class="linenos">1663</span></a>            <span class="c1"># First subject</span>
</span><span id="ChartDrawer-1664"><a href="#ChartDrawer-1664"><span class="linenos">1664</span></a>            <span class="n">latitude</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1665"><a href="#ChartDrawer-1665"><span class="linenos">1665</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1666"><a href="#ChartDrawer-1666"><span class="linenos">1666</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1667"><a href="#ChartDrawer-1667"><span class="linenos">1667</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1668"><a href="#ChartDrawer-1668"><span class="linenos">1668</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1669"><a href="#ChartDrawer-1669"><span class="linenos">1669</span></a>            <span class="n">longitude</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1670"><a href="#ChartDrawer-1670"><span class="linenos">1670</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1671"><a href="#ChartDrawer-1671"><span class="linenos">1671</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1672"><a href="#ChartDrawer-1672"><span class="linenos">1672</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1673"><a href="#ChartDrawer-1673"><span class="linenos">1673</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1674"><a href="#ChartDrawer-1674"><span class="linenos">1674</span></a>
</span><span id="ChartDrawer-1675"><a href="#ChartDrawer-1675"><span class="linenos">1675</span></a>            <span class="c1"># Second subject</span>
</span><span id="ChartDrawer-1676"><a href="#ChartDrawer-1676"><span class="linenos">1676</span></a>            <span class="n">latitude_string</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1677"><a href="#ChartDrawer-1677"><span class="linenos">1677</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1678"><a href="#ChartDrawer-1678"><span class="linenos">1678</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1679"><a href="#ChartDrawer-1679"><span class="linenos">1679</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1680"><a href="#ChartDrawer-1680"><span class="linenos">1680</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1681"><a href="#ChartDrawer-1681"><span class="linenos">1681</span></a>            <span class="n">longitude_string</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1682"><a href="#ChartDrawer-1682"><span class="linenos">1682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1683"><a href="#ChartDrawer-1683"><span class="linenos">1683</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1684"><a href="#ChartDrawer-1684"><span class="linenos">1684</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1685"><a href="#ChartDrawer-1685"><span class="linenos">1685</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1686"><a href="#ChartDrawer-1686"><span class="linenos">1686</span></a>
</span><span id="ChartDrawer-1687"><a href="#ChartDrawer-1687"><span class="linenos">1687</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1688"><a href="#ChartDrawer-1688"><span class="linenos">1688</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1689"><a href="#ChartDrawer-1689"><span class="linenos">1689</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1690"><a href="#ChartDrawer-1690"><span class="linenos">1690</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1691"><a href="#ChartDrawer-1691"><span class="linenos">1691</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1692"><a href="#ChartDrawer-1692"><span class="linenos">1692</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">latitude_string</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1693"><a href="#ChartDrawer-1693"><span class="linenos">1693</span></a>
</span><span id="ChartDrawer-1694"><a href="#ChartDrawer-1694"><span class="linenos">1694</span></a>            <span class="c1"># Bottom left section</span>
</span><span id="ChartDrawer-1695"><a href="#ChartDrawer-1695"><span class="linenos">1695</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">==</span> <span class="s2">&quot;Tropical&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1696"><a href="#ChartDrawer-1696"><span class="linenos">1696</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;zodiac&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Zodiac&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Tropical&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1697"><a href="#ChartDrawer-1697"><span class="linenos">1697</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1698"><a href="#ChartDrawer-1698"><span class="linenos">1698</span></a>                <span class="n">mode_const</span> <span class="o">=</span> <span class="s2">&quot;SIDM_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1699"><a href="#ChartDrawer-1699"><span class="linenos">1699</span></a>                <span class="n">mode_name</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">swe</span><span class="p">,</span> <span class="n">mode_const</span><span class="p">))</span>
</span><span id="ChartDrawer-1700"><a href="#ChartDrawer-1700"><span class="linenos">1700</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;ayanamsa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ayanamsa&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mode_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1701"><a href="#ChartDrawer-1701"><span class="linenos">1701</span></a>
</span><span id="ChartDrawer-1702"><a href="#ChartDrawer-1702"><span class="linenos">1702</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zodiac_info</span>
</span><span id="ChartDrawer-1703"><a href="#ChartDrawer-1703"><span class="linenos">1703</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses_system_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Houses&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1704"><a href="#ChartDrawer-1704"><span class="linenos">1704</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Perspective&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">perspective_type</span><span class="si">}</span><span class="s1">&#39;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1705"><a href="#ChartDrawer-1705"><span class="linenos">1705</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;composite_chart&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Composite Chart&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;midpoints&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Midpoints&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-1706"><a href="#ChartDrawer-1706"><span class="linenos">1706</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1707"><a href="#ChartDrawer-1707"><span class="linenos">1707</span></a>
</span><span id="ChartDrawer-1708"><a href="#ChartDrawer-1708"><span class="linenos">1708</span></a>            <span class="c1"># Moon phase section calculations</span>
</span><span id="ChartDrawer-1709"><a href="#ChartDrawer-1709"><span class="linenos">1709</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1710"><a href="#ChartDrawer-1710"><span class="linenos">1710</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeLunarPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="p">[</span><span class="s2">&quot;degrees_between_s_m&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">)</span>
</span><span id="ChartDrawer-1711"><a href="#ChartDrawer-1711"><span class="linenos">1711</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1712"><a href="#ChartDrawer-1712"><span class="linenos">1712</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1713"><a href="#ChartDrawer-1713"><span class="linenos">1713</span></a>
</span><span id="ChartDrawer-1714"><a href="#ChartDrawer-1714"><span class="linenos">1714</span></a>            <span class="c1"># Houses and planet drawing</span>
</span><span id="ChartDrawer-1715"><a href="#ChartDrawer-1715"><span class="linenos">1715</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1716"><a href="#ChartDrawer-1716"><span class="linenos">1716</span></a>                <span class="n">main_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1717"><a href="#ChartDrawer-1717"><span class="linenos">1717</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1718"><a href="#ChartDrawer-1718"><span class="linenos">1718</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1719"><a href="#ChartDrawer-1719"><span class="linenos">1719</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1720"><a href="#ChartDrawer-1720"><span class="linenos">1720</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1721"><a href="#ChartDrawer-1721"><span class="linenos">1721</span></a>
</span><span id="ChartDrawer-1722"><a href="#ChartDrawer-1722"><span class="linenos">1722</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_houses_cusps_and_text_number</span><span class="p">(</span>
</span><span id="ChartDrawer-1723"><a href="#ChartDrawer-1723"><span class="linenos">1723</span></a>                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1724"><a href="#ChartDrawer-1724"><span class="linenos">1724</span></a>                <span class="n">first_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1725"><a href="#ChartDrawer-1725"><span class="linenos">1725</span></a>                <span class="n">standard_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_radix_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1726"><a href="#ChartDrawer-1726"><span class="linenos">1726</span></a>                <span class="n">first_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1727"><a href="#ChartDrawer-1727"><span class="linenos">1727</span></a>                <span class="n">tenth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1728"><a href="#ChartDrawer-1728"><span class="linenos">1728</span></a>                <span class="n">seventh_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1729"><a href="#ChartDrawer-1729"><span class="linenos">1729</span></a>                <span class="n">fourth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1730"><a href="#ChartDrawer-1730"><span class="linenos">1730</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1731"><a href="#ChartDrawer-1731"><span class="linenos">1731</span></a>                <span class="n">c3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1732"><a href="#ChartDrawer-1732"><span class="linenos">1732</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1733"><a href="#ChartDrawer-1733"><span class="linenos">1733</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-1734"><a href="#ChartDrawer-1734"><span class="linenos">1734</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1735"><a href="#ChartDrawer-1735"><span class="linenos">1735</span></a>
</span><span id="ChartDrawer-1736"><a href="#ChartDrawer-1736"><span class="linenos">1736</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makePlanets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_planets</span><span class="p">(</span>
</span><span id="ChartDrawer-1737"><a href="#ChartDrawer-1737"><span class="linenos">1737</span></a>                <span class="n">available_planets_setting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-1738"><a href="#ChartDrawer-1738"><span class="linenos">1738</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1739"><a href="#ChartDrawer-1739"><span class="linenos">1739</span></a>                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1740"><a href="#ChartDrawer-1740"><span class="linenos">1740</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1741"><a href="#ChartDrawer-1741"><span class="linenos">1741</span></a>                <span class="n">third_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1742"><a href="#ChartDrawer-1742"><span class="linenos">1742</span></a>                <span class="n">main_subject_first_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1743"><a href="#ChartDrawer-1743"><span class="linenos">1743</span></a>                <span class="n">main_subject_seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1744"><a href="#ChartDrawer-1744"><span class="linenos">1744</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-1745"><a href="#ChartDrawer-1745"><span class="linenos">1745</span></a>                <span class="n">first_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1746"><a href="#ChartDrawer-1746"><span class="linenos">1746</span></a>                <span class="n">show_degree_indicators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span><span class="p">,</span>
</span><span id="ChartDrawer-1747"><a href="#ChartDrawer-1747"><span class="linenos">1747</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1748"><a href="#ChartDrawer-1748"><span class="linenos">1748</span></a>
</span><span id="ChartDrawer-1749"><a href="#ChartDrawer-1749"><span class="linenos">1749</span></a>            <span class="n">subject_name</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1750"><a href="#ChartDrawer-1750"><span class="linenos">1750</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1751"><a href="#ChartDrawer-1751"><span class="linenos">1751</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;and_word&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="ChartDrawer-1752"><a href="#ChartDrawer-1752"><span class="linenos">1752</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1753"><a href="#ChartDrawer-1753"><span class="linenos">1753</span></a>            <span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1754"><a href="#ChartDrawer-1754"><span class="linenos">1754</span></a>
</span><span id="ChartDrawer-1755"><a href="#ChartDrawer-1755"><span class="linenos">1755</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1756"><a href="#ChartDrawer-1756"><span class="linenos">1756</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;planets_and_house&quot;</span><span class="p">,</span> <span class="s2">&quot;Points for&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1757"><a href="#ChartDrawer-1757"><span class="linenos">1757</span></a>                <span class="n">subject_name</span><span class="o">=</span><span class="n">subject_name</span><span class="p">,</span>
</span><span id="ChartDrawer-1758"><a href="#ChartDrawer-1758"><span class="linenos">1758</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1759"><a href="#ChartDrawer-1759"><span class="linenos">1759</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1760"><a href="#ChartDrawer-1760"><span class="linenos">1760</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1761"><a href="#ChartDrawer-1761"><span class="linenos">1761</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1762"><a href="#ChartDrawer-1762"><span class="linenos">1762</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1763"><a href="#ChartDrawer-1763"><span class="linenos">1763</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1764"><a href="#ChartDrawer-1764"><span class="linenos">1764</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1765"><a href="#ChartDrawer-1765"><span class="linenos">1765</span></a>
</span><span id="ChartDrawer-1766"><a href="#ChartDrawer-1766"><span class="linenos">1766</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1767"><a href="#ChartDrawer-1767"><span class="linenos">1767</span></a>
</span><span id="ChartDrawer-1768"><a href="#ChartDrawer-1768"><span class="linenos">1768</span></a>            <span class="c1"># Transit has no Element Percentages</span>
</span><span id="ChartDrawer-1769"><a href="#ChartDrawer-1769"><span class="linenos">1769</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;elements_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1770"><a href="#ChartDrawer-1770"><span class="linenos">1770</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;fire_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1771"><a href="#ChartDrawer-1771"><span class="linenos">1771</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;earth_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1772"><a href="#ChartDrawer-1772"><span class="linenos">1772</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;air_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1773"><a href="#ChartDrawer-1773"><span class="linenos">1773</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;water_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1774"><a href="#ChartDrawer-1774"><span class="linenos">1774</span></a>
</span><span id="ChartDrawer-1775"><a href="#ChartDrawer-1775"><span class="linenos">1775</span></a>            <span class="c1"># Transit has no Qualities Percentages</span>
</span><span id="ChartDrawer-1776"><a href="#ChartDrawer-1776"><span class="linenos">1776</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;qualities_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1777"><a href="#ChartDrawer-1777"><span class="linenos">1777</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;cardinal_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1778"><a href="#ChartDrawer-1778"><span class="linenos">1778</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;fixed_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1779"><a href="#ChartDrawer-1779"><span class="linenos">1779</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;mutable_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1780"><a href="#ChartDrawer-1780"><span class="linenos">1780</span></a>
</span><span id="ChartDrawer-1781"><a href="#ChartDrawer-1781"><span class="linenos">1781</span></a>            <span class="c1"># Set viewbox dynamically</span>
</span><span id="ChartDrawer-1782"><a href="#ChartDrawer-1782"><span class="linenos">1782</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;viewbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-1783"><a href="#ChartDrawer-1783"><span class="linenos">1783</span></a>
</span><span id="ChartDrawer-1784"><a href="#ChartDrawer-1784"><span class="linenos">1784</span></a>            <span class="c1"># Get houses list for secondary subject</span>
</span><span id="ChartDrawer-1785"><a href="#ChartDrawer-1785"><span class="linenos">1785</span></a>            <span class="n">second_subject_houses_list</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1786"><a href="#ChartDrawer-1786"><span class="linenos">1786</span></a>
</span><span id="ChartDrawer-1787"><a href="#ChartDrawer-1787"><span class="linenos">1787</span></a>            <span class="c1"># Rings and circles</span>
</span><span id="ChartDrawer-1788"><a href="#ChartDrawer-1788"><span class="linenos">1788</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;transitRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_ring</span><span class="p">(</span>
</span><span id="ChartDrawer-1789"><a href="#ChartDrawer-1789"><span class="linenos">1789</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1790"><a href="#ChartDrawer-1790"><span class="linenos">1790</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1791"><a href="#ChartDrawer-1791"><span class="linenos">1791</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_3&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1792"><a href="#ChartDrawer-1792"><span class="linenos">1792</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1793"><a href="#ChartDrawer-1793"><span class="linenos">1793</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;degreeRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_ring_degree_steps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">)</span>
</span><span id="ChartDrawer-1794"><a href="#ChartDrawer-1794"><span class="linenos">1794</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_background_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1795"><a href="#ChartDrawer-1795"><span class="linenos">1795</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1796"><a href="#ChartDrawer-1796"><span class="linenos">1796</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1797"><a href="#ChartDrawer-1797"><span class="linenos">1797</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1798"><a href="#ChartDrawer-1798"><span class="linenos">1798</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1799"><a href="#ChartDrawer-1799"><span class="linenos">1799</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;first_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_first_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1800"><a href="#ChartDrawer-1800"><span class="linenos">1800</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1801"><a href="#ChartDrawer-1801"><span class="linenos">1801</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_2&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1802"><a href="#ChartDrawer-1802"><span class="linenos">1802</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1803"><a href="#ChartDrawer-1803"><span class="linenos">1803</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1804"><a href="#ChartDrawer-1804"><span class="linenos">1804</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;second_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_second_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1805"><a href="#ChartDrawer-1805"><span class="linenos">1805</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1806"><a href="#ChartDrawer-1806"><span class="linenos">1806</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1807"><a href="#ChartDrawer-1807"><span class="linenos">1807</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1808"><a href="#ChartDrawer-1808"><span class="linenos">1808</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1809"><a href="#ChartDrawer-1809"><span class="linenos">1809</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1810"><a href="#ChartDrawer-1810"><span class="linenos">1810</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;third_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_third_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-1811"><a href="#ChartDrawer-1811"><span class="linenos">1811</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1812"><a href="#ChartDrawer-1812"><span class="linenos">1812</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1813"><a href="#ChartDrawer-1813"><span class="linenos">1813</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1814"><a href="#ChartDrawer-1814"><span class="linenos">1814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1815"><a href="#ChartDrawer-1815"><span class="linenos">1815</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1816"><a href="#ChartDrawer-1816"><span class="linenos">1816</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1817"><a href="#ChartDrawer-1817"><span class="linenos">1817</span></a>
</span><span id="ChartDrawer-1818"><a href="#ChartDrawer-1818"><span class="linenos">1818</span></a>            <span class="c1"># Aspects</span>
</span><span id="ChartDrawer-1819"><a href="#ChartDrawer-1819"><span class="linenos">1819</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1820"><a href="#ChartDrawer-1820"><span class="linenos">1820</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;transit_aspects&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Transit Aspects&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-1821"><a href="#ChartDrawer-1821"><span class="linenos">1821</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1822"><a href="#ChartDrawer-1822"><span class="linenos">1822</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_aspect_list</span><span class="p">(</span>
</span><span id="ChartDrawer-1823"><a href="#ChartDrawer-1823"><span class="linenos">1823</span></a>                    <span class="n">title</span><span class="p">,</span>
</span><span id="ChartDrawer-1824"><a href="#ChartDrawer-1824"><span class="linenos">1824</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1825"><a href="#ChartDrawer-1825"><span class="linenos">1825</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">,</span>
</span><span id="ChartDrawer-1826"><a href="#ChartDrawer-1826"><span class="linenos">1826</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">,</span>
</span><span id="ChartDrawer-1827"><a href="#ChartDrawer-1827"><span class="linenos">1827</span></a>                    <span class="n">chart_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
</span><span id="ChartDrawer-1828"><a href="#ChartDrawer-1828"><span class="linenos">1828</span></a>                <span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1829"><a href="#ChartDrawer-1829"><span class="linenos">1829</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1830"><a href="#ChartDrawer-1830"><span class="linenos">1830</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1831"><a href="#ChartDrawer-1831"><span class="linenos">1831</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1832"><a href="#ChartDrawer-1832"><span class="linenos">1832</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1833"><a href="#ChartDrawer-1833"><span class="linenos">1833</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-1834"><a href="#ChartDrawer-1834"><span class="linenos">1834</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1835"><a href="#ChartDrawer-1835"><span class="linenos">1835</span></a>                    <span class="mi">600</span><span class="p">,</span>
</span><span id="ChartDrawer-1836"><a href="#ChartDrawer-1836"><span class="linenos">1836</span></a>                    <span class="mi">520</span><span class="p">,</span>
</span><span id="ChartDrawer-1837"><a href="#ChartDrawer-1837"><span class="linenos">1837</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1838"><a href="#ChartDrawer-1838"><span class="linenos">1838</span></a>
</span><span id="ChartDrawer-1839"><a href="#ChartDrawer-1839"><span class="linenos">1839</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_all_transit_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">-</span> <span class="mi">160</span><span class="p">)</span>
</span><span id="ChartDrawer-1840"><a href="#ChartDrawer-1840"><span class="linenos">1840</span></a>
</span><span id="ChartDrawer-1841"><a href="#ChartDrawer-1841"><span class="linenos">1841</span></a>            <span class="c1"># Top left section (clear separation of Natal vs Transit details)</span>
</span><span id="ChartDrawer-1842"><a href="#ChartDrawer-1842"><span class="linenos">1842</span></a>            <span class="n">natal_latitude_string</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1843"><a href="#ChartDrawer-1843"><span class="linenos">1843</span></a>                <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1844"><a href="#ChartDrawer-1844"><span class="linenos">1844</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1845"><a href="#ChartDrawer-1845"><span class="linenos">1845</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1846"><a href="#ChartDrawer-1846"><span class="linenos">1846</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1847"><a href="#ChartDrawer-1847"><span class="linenos">1847</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1848"><a href="#ChartDrawer-1848"><span class="linenos">1848</span></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ChartDrawer-1849"><a href="#ChartDrawer-1849"><span class="linenos">1849</span></a>                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1850"><a href="#ChartDrawer-1850"><span class="linenos">1850</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1851"><a href="#ChartDrawer-1851"><span class="linenos">1851</span></a>            <span class="n">natal_longitude_string</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1852"><a href="#ChartDrawer-1852"><span class="linenos">1852</span></a>                <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1853"><a href="#ChartDrawer-1853"><span class="linenos">1853</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1854"><a href="#ChartDrawer-1854"><span class="linenos">1854</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1855"><a href="#ChartDrawer-1855"><span class="linenos">1855</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1856"><a href="#ChartDrawer-1856"><span class="linenos">1856</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1857"><a href="#ChartDrawer-1857"><span class="linenos">1857</span></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ChartDrawer-1858"><a href="#ChartDrawer-1858"><span class="linenos">1858</span></a>                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1859"><a href="#ChartDrawer-1859"><span class="linenos">1859</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1860"><a href="#ChartDrawer-1860"><span class="linenos">1860</span></a>
</span><span id="ChartDrawer-1861"><a href="#ChartDrawer-1861"><span class="linenos">1861</span></a>            <span class="n">transit_latitude_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1862"><a href="#ChartDrawer-1862"><span class="linenos">1862</span></a>            <span class="n">transit_longitude_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1863"><a href="#ChartDrawer-1863"><span class="linenos">1863</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1864"><a href="#ChartDrawer-1864"><span class="linenos">1864</span></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1865"><a href="#ChartDrawer-1865"><span class="linenos">1865</span></a>                    <span class="n">transit_latitude_string</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1866"><a href="#ChartDrawer-1866"><span class="linenos">1866</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1867"><a href="#ChartDrawer-1867"><span class="linenos">1867</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1868"><a href="#ChartDrawer-1868"><span class="linenos">1868</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1869"><a href="#ChartDrawer-1869"><span class="linenos">1869</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-1870"><a href="#ChartDrawer-1870"><span class="linenos">1870</span></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1871"><a href="#ChartDrawer-1871"><span class="linenos">1871</span></a>                    <span class="n">transit_longitude_string</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span>
</span><span id="ChartDrawer-1872"><a href="#ChartDrawer-1872"><span class="linenos">1872</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1873"><a href="#ChartDrawer-1873"><span class="linenos">1873</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1874"><a href="#ChartDrawer-1874"><span class="linenos">1874</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west_letter&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1875"><a href="#ChartDrawer-1875"><span class="linenos">1875</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-1876"><a href="#ChartDrawer-1876"><span class="linenos">1876</span></a>
</span><span id="ChartDrawer-1877"><a href="#ChartDrawer-1877"><span class="linenos">1877</span></a>            <span class="n">natal_dt</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1878"><a href="#ChartDrawer-1878"><span class="linenos">1878</span></a>            <span class="n">natal_place</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">format_location_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">nation</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1879"><a href="#ChartDrawer-1879"><span class="linenos">1879</span></a>            <span class="n">transit_dt</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1880"><a href="#ChartDrawer-1880"><span class="linenos">1880</span></a>                <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1881"><a href="#ChartDrawer-1881"><span class="linenos">1881</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s2">&quot;iso_formatted_local_datetime&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ChartDrawer-1882"><a href="#ChartDrawer-1882"><span class="linenos">1882</span></a>                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1883"><a href="#ChartDrawer-1883"><span class="linenos">1883</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1884"><a href="#ChartDrawer-1884"><span class="linenos">1884</span></a>            <span class="n">transit_place</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1885"><a href="#ChartDrawer-1885"><span class="linenos">1885</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">format_location_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">nation</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-1886"><a href="#ChartDrawer-1886"><span class="linenos">1886</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ChartDrawer-1887"><a href="#ChartDrawer-1887"><span class="linenos">1887</span></a>                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1888"><a href="#ChartDrawer-1888"><span class="linenos">1888</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1889"><a href="#ChartDrawer-1889"><span class="linenos">1889</span></a>
</span><span id="ChartDrawer-1890"><a href="#ChartDrawer-1890"><span class="linenos">1890</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;chart_info_natal_label&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Natal&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">natal_dt</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1891"><a href="#ChartDrawer-1891"><span class="linenos">1891</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">natal_place</span>
</span><span id="ChartDrawer-1892"><a href="#ChartDrawer-1892"><span class="linenos">1892</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">natal_latitude_string</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">natal_longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1893"><a href="#ChartDrawer-1893"><span class="linenos">1893</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;chart_info_transit_label&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Transit&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">transit_dt</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1894"><a href="#ChartDrawer-1894"><span class="linenos">1894</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transit_place</span>
</span><span id="ChartDrawer-1895"><a href="#ChartDrawer-1895"><span class="linenos">1895</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">transit_latitude_string</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">transit_longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1896"><a href="#ChartDrawer-1896"><span class="linenos">1896</span></a>
</span><span id="ChartDrawer-1897"><a href="#ChartDrawer-1897"><span class="linenos">1897</span></a>            <span class="c1"># Bottom left section</span>
</span><span id="ChartDrawer-1898"><a href="#ChartDrawer-1898"><span class="linenos">1898</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">==</span> <span class="s2">&quot;Tropical&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-1899"><a href="#ChartDrawer-1899"><span class="linenos">1899</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;zodiac&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Zodiac&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Tropical&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1900"><a href="#ChartDrawer-1900"><span class="linenos">1900</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1901"><a href="#ChartDrawer-1901"><span class="linenos">1901</span></a>                <span class="n">mode_const</span> <span class="o">=</span> <span class="s2">&quot;SIDM_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1902"><a href="#ChartDrawer-1902"><span class="linenos">1902</span></a>                <span class="n">mode_name</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">swe</span><span class="p">,</span> <span class="n">mode_const</span><span class="p">))</span>
</span><span id="ChartDrawer-1903"><a href="#ChartDrawer-1903"><span class="linenos">1903</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;ayanamsa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ayanamsa&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mode_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1904"><a href="#ChartDrawer-1904"><span class="linenos">1904</span></a>
</span><span id="ChartDrawer-1905"><a href="#ChartDrawer-1905"><span class="linenos">1905</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zodiac_info</span>
</span><span id="ChartDrawer-1906"><a href="#ChartDrawer-1906"><span class="linenos">1906</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;domification&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Domification&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses_system_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1907"><a href="#ChartDrawer-1907"><span class="linenos">1907</span></a>
</span><span id="ChartDrawer-1908"><a href="#ChartDrawer-1908"><span class="linenos">1908</span></a>            <span class="c1"># Lunar phase information from second object (Transit) (optional)</span>
</span><span id="ChartDrawer-1909"><a href="#ChartDrawer-1909"><span class="linenos">1909</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;lunar_phase&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-1910"><a href="#ChartDrawer-1910"><span class="linenos">1910</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1911"><a href="#ChartDrawer-1911"><span class="linenos">1911</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;Transit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Transit&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="ChartDrawer-1912"><a href="#ChartDrawer-1912"><span class="linenos">1912</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;lunation_day&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Lunation Day&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="ChartDrawer-1913"><a href="#ChartDrawer-1913"><span class="linenos">1913</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;moon_phase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1914"><a href="#ChartDrawer-1914"><span class="linenos">1914</span></a>                <span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1915"><a href="#ChartDrawer-1915"><span class="linenos">1915</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ChartDrawer-1916"><a href="#ChartDrawer-1916"><span class="linenos">1916</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;Transit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Transit&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="ChartDrawer-1917"><a href="#ChartDrawer-1917"><span class="linenos">1917</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;lunar_phase&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Lunar Phase&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="ChartDrawer-1918"><a href="#ChartDrawer-1918"><span class="linenos">1918</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-1919"><a href="#ChartDrawer-1919"><span class="linenos">1919</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-1920"><a href="#ChartDrawer-1920"><span class="linenos">1920</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1921"><a href="#ChartDrawer-1921"><span class="linenos">1921</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1922"><a href="#ChartDrawer-1922"><span class="linenos">1922</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1923"><a href="#ChartDrawer-1923"><span class="linenos">1923</span></a>
</span><span id="ChartDrawer-1924"><a href="#ChartDrawer-1924"><span class="linenos">1924</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Perspective&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-1925"><a href="#ChartDrawer-1925"><span class="linenos">1925</span></a>
</span><span id="ChartDrawer-1926"><a href="#ChartDrawer-1926"><span class="linenos">1926</span></a>            <span class="c1"># Moon phase section calculations - use transit subject data only</span>
</span><span id="ChartDrawer-1927"><a href="#ChartDrawer-1927"><span class="linenos">1927</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s2">&quot;lunar_phase&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ChartDrawer-1928"><a href="#ChartDrawer-1928"><span class="linenos">1928</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeLunarPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="p">[</span><span class="s2">&quot;degrees_between_s_m&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">)</span>
</span><span id="ChartDrawer-1929"><a href="#ChartDrawer-1929"><span class="linenos">1929</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-1930"><a href="#ChartDrawer-1930"><span class="linenos">1930</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1931"><a href="#ChartDrawer-1931"><span class="linenos">1931</span></a>
</span><span id="ChartDrawer-1932"><a href="#ChartDrawer-1932"><span class="linenos">1932</span></a>            <span class="c1"># Houses and planet drawing</span>
</span><span id="ChartDrawer-1933"><a href="#ChartDrawer-1933"><span class="linenos">1933</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1934"><a href="#ChartDrawer-1934"><span class="linenos">1934</span></a>                <span class="n">main_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1935"><a href="#ChartDrawer-1935"><span class="linenos">1935</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1936"><a href="#ChartDrawer-1936"><span class="linenos">1936</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-1937"><a href="#ChartDrawer-1937"><span class="linenos">1937</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1938"><a href="#ChartDrawer-1938"><span class="linenos">1938</span></a>            <span class="c1"># template_dict[&quot;makeSecondaryHousesGrid&quot;] = draw_secondary_house_grid(</span>
</span><span id="ChartDrawer-1939"><a href="#ChartDrawer-1939"><span class="linenos">1939</span></a>            <span class="c1">#     secondary_subject_houses_list=second_subject_houses_list,</span>
</span><span id="ChartDrawer-1940"><a href="#ChartDrawer-1940"><span class="linenos">1940</span></a>            <span class="c1">#     text_color=self.chart_colors_settings[&quot;paper_0&quot;],</span>
</span><span id="ChartDrawer-1941"><a href="#ChartDrawer-1941"><span class="linenos">1941</span></a>            <span class="c1">#     house_cusp_generale_name_label=self._translate(&quot;cusp&quot;, &quot;Cusp&quot;),</span>
</span><span id="ChartDrawer-1942"><a href="#ChartDrawer-1942"><span class="linenos">1942</span></a>            <span class="c1"># )</span>
</span><span id="ChartDrawer-1943"><a href="#ChartDrawer-1943"><span class="linenos">1943</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-1944"><a href="#ChartDrawer-1944"><span class="linenos">1944</span></a>
</span><span id="ChartDrawer-1945"><a href="#ChartDrawer-1945"><span class="linenos">1945</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_houses_cusps_and_text_number</span><span class="p">(</span>
</span><span id="ChartDrawer-1946"><a href="#ChartDrawer-1946"><span class="linenos">1946</span></a>                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1947"><a href="#ChartDrawer-1947"><span class="linenos">1947</span></a>                <span class="n">first_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1948"><a href="#ChartDrawer-1948"><span class="linenos">1948</span></a>                <span class="n">standard_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_radix_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1949"><a href="#ChartDrawer-1949"><span class="linenos">1949</span></a>                <span class="n">first_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1950"><a href="#ChartDrawer-1950"><span class="linenos">1950</span></a>                <span class="n">tenth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1951"><a href="#ChartDrawer-1951"><span class="linenos">1951</span></a>                <span class="n">seventh_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1952"><a href="#ChartDrawer-1952"><span class="linenos">1952</span></a>                <span class="n">fourth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1953"><a href="#ChartDrawer-1953"><span class="linenos">1953</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1954"><a href="#ChartDrawer-1954"><span class="linenos">1954</span></a>                <span class="n">c3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1955"><a href="#ChartDrawer-1955"><span class="linenos">1955</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1956"><a href="#ChartDrawer-1956"><span class="linenos">1956</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-1957"><a href="#ChartDrawer-1957"><span class="linenos">1957</span></a>                <span class="n">second_subject_houses_list</span><span class="o">=</span><span class="n">second_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-1958"><a href="#ChartDrawer-1958"><span class="linenos">1958</span></a>                <span class="n">transit_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_transit_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1959"><a href="#ChartDrawer-1959"><span class="linenos">1959</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1960"><a href="#ChartDrawer-1960"><span class="linenos">1960</span></a>
</span><span id="ChartDrawer-1961"><a href="#ChartDrawer-1961"><span class="linenos">1961</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makePlanets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_planets</span><span class="p">(</span>
</span><span id="ChartDrawer-1962"><a href="#ChartDrawer-1962"><span class="linenos">1962</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1963"><a href="#ChartDrawer-1963"><span class="linenos">1963</span></a>                <span class="n">available_planets_setting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-1964"><a href="#ChartDrawer-1964"><span class="linenos">1964</span></a>                <span class="n">second_subject_available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1965"><a href="#ChartDrawer-1965"><span class="linenos">1965</span></a>                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1966"><a href="#ChartDrawer-1966"><span class="linenos">1966</span></a>                <span class="n">main_subject_first_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1967"><a href="#ChartDrawer-1967"><span class="linenos">1967</span></a>                <span class="n">main_subject_seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-1968"><a href="#ChartDrawer-1968"><span class="linenos">1968</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1969"><a href="#ChartDrawer-1969"><span class="linenos">1969</span></a>                <span class="n">third_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1970"><a href="#ChartDrawer-1970"><span class="linenos">1970</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-1971"><a href="#ChartDrawer-1971"><span class="linenos">1971</span></a>                <span class="n">second_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-1972"><a href="#ChartDrawer-1972"><span class="linenos">1972</span></a>                <span class="n">show_degree_indicators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span><span class="p">,</span>
</span><span id="ChartDrawer-1973"><a href="#ChartDrawer-1973"><span class="linenos">1973</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1974"><a href="#ChartDrawer-1974"><span class="linenos">1974</span></a>
</span><span id="ChartDrawer-1975"><a href="#ChartDrawer-1975"><span class="linenos">1975</span></a>            <span class="c1"># Planet grids</span>
</span><span id="ChartDrawer-1976"><a href="#ChartDrawer-1976"><span class="linenos">1976</span></a>            <span class="n">first_name_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-1977"><a href="#ChartDrawer-1977"><span class="linenos">1977</span></a>            <span class="n">transit_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-1978"><a href="#ChartDrawer-1978"><span class="linenos">1978</span></a>            <span class="n">first_return_grid_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;inner_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Inner Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ChartDrawer-1979"><a href="#ChartDrawer-1979"><span class="linenos">1979</span></a>            <span class="n">second_return_grid_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">transit_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;outer_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Outer Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ChartDrawer-1980"><a href="#ChartDrawer-1980"><span class="linenos">1980</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1981"><a href="#ChartDrawer-1981"><span class="linenos">1981</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-1982"><a href="#ChartDrawer-1982"><span class="linenos">1982</span></a>                <span class="n">subject_name</span><span class="o">=</span><span class="n">first_return_grid_title</span><span class="p">,</span>
</span><span id="ChartDrawer-1983"><a href="#ChartDrawer-1983"><span class="linenos">1983</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1984"><a href="#ChartDrawer-1984"><span class="linenos">1984</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1985"><a href="#ChartDrawer-1985"><span class="linenos">1985</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1986"><a href="#ChartDrawer-1986"><span class="linenos">1986</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1987"><a href="#ChartDrawer-1987"><span class="linenos">1987</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1988"><a href="#ChartDrawer-1988"><span class="linenos">1988</span></a>
</span><span id="ChartDrawer-1989"><a href="#ChartDrawer-1989"><span class="linenos">1989</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_secondary_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-1990"><a href="#ChartDrawer-1990"><span class="linenos">1990</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-1991"><a href="#ChartDrawer-1991"><span class="linenos">1991</span></a>                <span class="n">second_subject_name</span><span class="o">=</span><span class="n">second_return_grid_title</span><span class="p">,</span>
</span><span id="ChartDrawer-1992"><a href="#ChartDrawer-1992"><span class="linenos">1992</span></a>                <span class="n">second_subject_available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1993"><a href="#ChartDrawer-1993"><span class="linenos">1993</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-1994"><a href="#ChartDrawer-1994"><span class="linenos">1994</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-1995"><a href="#ChartDrawer-1995"><span class="linenos">1995</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-1996"><a href="#ChartDrawer-1996"><span class="linenos">1996</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-1997"><a href="#ChartDrawer-1997"><span class="linenos">1997</span></a>
</span><span id="ChartDrawer-1998"><a href="#ChartDrawer-1998"><span class="linenos">1998</span></a>            <span class="c1"># House comparison grid</span>
</span><span id="ChartDrawer-1999"><a href="#ChartDrawer-1999"><span class="linenos">1999</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2000"><a href="#ChartDrawer-2000"><span class="linenos">2000</span></a>                <span class="n">house_comparison_factory</span> <span class="o">=</span> <span class="n">HouseComparisonFactory</span><span class="p">(</span>
</span><span id="ChartDrawer-2001"><a href="#ChartDrawer-2001"><span class="linenos">2001</span></a>                    <span class="n">first_subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2002"><a href="#ChartDrawer-2002"><span class="linenos">2002</span></a>                    <span class="n">second_subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2003"><a href="#ChartDrawer-2003"><span class="linenos">2003</span></a>                    <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2004"><a href="#ChartDrawer-2004"><span class="linenos">2004</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-2005"><a href="#ChartDrawer-2005"><span class="linenos">2005</span></a>                <span class="n">house_comparison</span> <span class="o">=</span> <span class="n">house_comparison_factory</span><span class="o">.</span><span class="n">get_house_comparison</span><span class="p">()</span>
</span><span id="ChartDrawer-2006"><a href="#ChartDrawer-2006"><span class="linenos">2006</span></a>
</span><span id="ChartDrawer-2007"><a href="#ChartDrawer-2007"><span class="linenos">2007</span></a>                <span class="n">house_comparison_svg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2008"><a href="#ChartDrawer-2008"><span class="linenos">2008</span></a>
</span><span id="ChartDrawer-2009"><a href="#ChartDrawer-2009"><span class="linenos">2009</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2010"><a href="#ChartDrawer-2010"><span class="linenos">2010</span></a>                    <span class="n">house_comparison_svg</span> <span class="o">=</span> <span class="n">draw_single_house_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2011"><a href="#ChartDrawer-2011"><span class="linenos">2011</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2012"><a href="#ChartDrawer-2012"><span class="linenos">2012</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2013"><a href="#ChartDrawer-2013"><span class="linenos">2013</span></a>                        <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2014"><a href="#ChartDrawer-2014"><span class="linenos">2014</span></a>                        <span class="n">points_owner_subject_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># The second subject is the Transit</span>
</span><span id="ChartDrawer-2015"><a href="#ChartDrawer-2015"><span class="linenos">2015</span></a>                        <span class="n">house_position_comparison_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;House Position Comparison&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2016"><a href="#ChartDrawer-2016"><span class="linenos">2016</span></a>                        <span class="n">return_point_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;transit_point&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit Point&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2017"><a href="#ChartDrawer-2017"><span class="linenos">2017</span></a>                        <span class="n">natal_house_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house_position&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2018"><a href="#ChartDrawer-2018"><span class="linenos">2018</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="mi">980</span><span class="p">,</span>
</span><span id="ChartDrawer-2019"><a href="#ChartDrawer-2019"><span class="linenos">2019</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2020"><a href="#ChartDrawer-2020"><span class="linenos">2020</span></a>
</span><span id="ChartDrawer-2021"><a href="#ChartDrawer-2021"><span class="linenos">2021</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2022"><a href="#ChartDrawer-2022"><span class="linenos">2022</span></a>                    <span class="c1"># When only the cusp comparison is visible, reuse the house grid slot</span>
</span><span id="ChartDrawer-2023"><a href="#ChartDrawer-2023"><span class="linenos">2023</span></a>                    <span class="c1"># so the layout remains compact. When both are visible, place the cusp</span>
</span><span id="ChartDrawer-2024"><a href="#ChartDrawer-2024"><span class="linenos">2024</span></a>                    <span class="c1"># table to the right of the house comparison grid.</span>
</span><span id="ChartDrawer-2025"><a href="#ChartDrawer-2025"><span class="linenos">2025</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2026"><a href="#ChartDrawer-2026"><span class="linenos">2026</span></a>                        <span class="c1"># Classic dual-grid layout: house at x=980, cusp at a fixed offset.</span>
</span><span id="ChartDrawer-2027"><a href="#ChartDrawer-2027"><span class="linenos">2027</span></a>                        <span class="c1"># Fixed position alignment: 980 (start) + ~200 (table width + gap) = 1180</span>
</span><span id="ChartDrawer-2028"><a href="#ChartDrawer-2028"><span class="linenos">2028</span></a>                        <span class="n">cusp_x_position</span> <span class="o">=</span> <span class="mi">1180</span>
</span><span id="ChartDrawer-2029"><a href="#ChartDrawer-2029"><span class="linenos">2029</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2030"><a href="#ChartDrawer-2030"><span class="linenos">2030</span></a>                        <span class="c1"># Cusp-only layout: occupy the house comparison slot directly.</span>
</span><span id="ChartDrawer-2031"><a href="#ChartDrawer-2031"><span class="linenos">2031</span></a>                        <span class="n">cusp_x_position</span> <span class="o">=</span> <span class="mi">980</span>
</span><span id="ChartDrawer-2032"><a href="#ChartDrawer-2032"><span class="linenos">2032</span></a>
</span><span id="ChartDrawer-2033"><a href="#ChartDrawer-2033"><span class="linenos">2033</span></a>                    <span class="n">cusp_grid</span> <span class="o">=</span> <span class="n">draw_single_cusp_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2034"><a href="#ChartDrawer-2034"><span class="linenos">2034</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2035"><a href="#ChartDrawer-2035"><span class="linenos">2035</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2036"><a href="#ChartDrawer-2036"><span class="linenos">2036</span></a>                        <span class="n">cusps_owner_subject_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Transit cusps in natal houses</span>
</span><span id="ChartDrawer-2037"><a href="#ChartDrawer-2037"><span class="linenos">2037</span></a>                        <span class="n">cusp_position_comparison_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp Position Comparison&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2038"><a href="#ChartDrawer-2038"><span class="linenos">2038</span></a>                        <span class="n">owner_cusp_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;transit_cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2039"><a href="#ChartDrawer-2039"><span class="linenos">2039</span></a>                        <span class="n">projected_house_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;natal_house&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2040"><a href="#ChartDrawer-2040"><span class="linenos">2040</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cusp_x_position</span><span class="p">),</span>
</span><span id="ChartDrawer-2041"><a href="#ChartDrawer-2041"><span class="linenos">2041</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2042"><a href="#ChartDrawer-2042"><span class="linenos">2042</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2043"><a href="#ChartDrawer-2043"><span class="linenos">2043</span></a>                    <span class="n">house_comparison_svg</span> <span class="o">+=</span> <span class="n">cusp_grid</span>
</span><span id="ChartDrawer-2044"><a href="#ChartDrawer-2044"><span class="linenos">2044</span></a>
</span><span id="ChartDrawer-2045"><a href="#ChartDrawer-2045"><span class="linenos">2045</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">house_comparison_svg</span>
</span><span id="ChartDrawer-2046"><a href="#ChartDrawer-2046"><span class="linenos">2046</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2047"><a href="#ChartDrawer-2047"><span class="linenos">2047</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2048"><a href="#ChartDrawer-2048"><span class="linenos">2048</span></a>
</span><span id="ChartDrawer-2049"><a href="#ChartDrawer-2049"><span class="linenos">2049</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2050"><a href="#ChartDrawer-2050"><span class="linenos">2050</span></a>            <span class="c1"># Set viewbox dynamically</span>
</span><span id="ChartDrawer-2051"><a href="#ChartDrawer-2051"><span class="linenos">2051</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;viewbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-2052"><a href="#ChartDrawer-2052"><span class="linenos">2052</span></a>
</span><span id="ChartDrawer-2053"><a href="#ChartDrawer-2053"><span class="linenos">2053</span></a>            <span class="c1"># Get houses list for secondary subject</span>
</span><span id="ChartDrawer-2054"><a href="#ChartDrawer-2054"><span class="linenos">2054</span></a>            <span class="n">second_subject_houses_list</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2055"><a href="#ChartDrawer-2055"><span class="linenos">2055</span></a>
</span><span id="ChartDrawer-2056"><a href="#ChartDrawer-2056"><span class="linenos">2056</span></a>            <span class="c1"># Rings and circles</span>
</span><span id="ChartDrawer-2057"><a href="#ChartDrawer-2057"><span class="linenos">2057</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;transitRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_ring</span><span class="p">(</span>
</span><span id="ChartDrawer-2058"><a href="#ChartDrawer-2058"><span class="linenos">2058</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2059"><a href="#ChartDrawer-2059"><span class="linenos">2059</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2060"><a href="#ChartDrawer-2060"><span class="linenos">2060</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_3&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2061"><a href="#ChartDrawer-2061"><span class="linenos">2061</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2062"><a href="#ChartDrawer-2062"><span class="linenos">2062</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;degreeRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_ring_degree_steps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">)</span>
</span><span id="ChartDrawer-2063"><a href="#ChartDrawer-2063"><span class="linenos">2063</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_background_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2064"><a href="#ChartDrawer-2064"><span class="linenos">2064</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2065"><a href="#ChartDrawer-2065"><span class="linenos">2065</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2066"><a href="#ChartDrawer-2066"><span class="linenos">2066</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2067"><a href="#ChartDrawer-2067"><span class="linenos">2067</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2068"><a href="#ChartDrawer-2068"><span class="linenos">2068</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;first_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_first_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2069"><a href="#ChartDrawer-2069"><span class="linenos">2069</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2070"><a href="#ChartDrawer-2070"><span class="linenos">2070</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_2&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2071"><a href="#ChartDrawer-2071"><span class="linenos">2071</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2072"><a href="#ChartDrawer-2072"><span class="linenos">2072</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2073"><a href="#ChartDrawer-2073"><span class="linenos">2073</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;second_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_second_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2074"><a href="#ChartDrawer-2074"><span class="linenos">2074</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2075"><a href="#ChartDrawer-2075"><span class="linenos">2075</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2076"><a href="#ChartDrawer-2076"><span class="linenos">2076</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2077"><a href="#ChartDrawer-2077"><span class="linenos">2077</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2078"><a href="#ChartDrawer-2078"><span class="linenos">2078</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2079"><a href="#ChartDrawer-2079"><span class="linenos">2079</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;third_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_third_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2080"><a href="#ChartDrawer-2080"><span class="linenos">2080</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2081"><a href="#ChartDrawer-2081"><span class="linenos">2081</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2082"><a href="#ChartDrawer-2082"><span class="linenos">2082</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2083"><a href="#ChartDrawer-2083"><span class="linenos">2083</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2084"><a href="#ChartDrawer-2084"><span class="linenos">2084</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2085"><a href="#ChartDrawer-2085"><span class="linenos">2085</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2086"><a href="#ChartDrawer-2086"><span class="linenos">2086</span></a>
</span><span id="ChartDrawer-2087"><a href="#ChartDrawer-2087"><span class="linenos">2087</span></a>            <span class="c1"># Aspects</span>
</span><span id="ChartDrawer-2088"><a href="#ChartDrawer-2088"><span class="linenos">2088</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2089"><a href="#ChartDrawer-2089"><span class="linenos">2089</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2090"><a href="#ChartDrawer-2090"><span class="linenos">2090</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_aspect_list</span><span class="p">(</span>
</span><span id="ChartDrawer-2091"><a href="#ChartDrawer-2091"><span class="linenos">2091</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;synastry_aspects&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Synastry Aspects&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-2092"><a href="#ChartDrawer-2092"><span class="linenos">2092</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2093"><a href="#ChartDrawer-2093"><span class="linenos">2093</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2094"><a href="#ChartDrawer-2094"><span class="linenos">2094</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2095"><a href="#ChartDrawer-2095"><span class="linenos">2095</span></a>                    <span class="n">chart_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
</span><span id="ChartDrawer-2096"><a href="#ChartDrawer-2096"><span class="linenos">2096</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-2097"><a href="#ChartDrawer-2097"><span class="linenos">2097</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2098"><a href="#ChartDrawer-2098"><span class="linenos">2098</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2099"><a href="#ChartDrawer-2099"><span class="linenos">2099</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2100"><a href="#ChartDrawer-2100"><span class="linenos">2100</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2101"><a href="#ChartDrawer-2101"><span class="linenos">2101</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2102"><a href="#ChartDrawer-2102"><span class="linenos">2102</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2103"><a href="#ChartDrawer-2103"><span class="linenos">2103</span></a>                    <span class="mi">550</span><span class="p">,</span>
</span><span id="ChartDrawer-2104"><a href="#ChartDrawer-2104"><span class="linenos">2104</span></a>                    <span class="mi">450</span><span class="p">,</span>
</span><span id="ChartDrawer-2105"><a href="#ChartDrawer-2105"><span class="linenos">2105</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-2106"><a href="#ChartDrawer-2106"><span class="linenos">2106</span></a>
</span><span id="ChartDrawer-2107"><a href="#ChartDrawer-2107"><span class="linenos">2107</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_all_transit_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">-</span> <span class="mi">160</span><span class="p">)</span>
</span><span id="ChartDrawer-2108"><a href="#ChartDrawer-2108"><span class="linenos">2108</span></a>
</span><span id="ChartDrawer-2109"><a href="#ChartDrawer-2109"><span class="linenos">2109</span></a>            <span class="c1"># Top left section</span>
</span><span id="ChartDrawer-2110"><a href="#ChartDrawer-2110"><span class="linenos">2110</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="ChartDrawer-2111"><a href="#ChartDrawer-2111"><span class="linenos">2111</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">nation</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2112"><a href="#ChartDrawer-2112"><span class="linenos">2112</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2113"><a href="#ChartDrawer-2113"><span class="linenos">2113</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2114"><a href="#ChartDrawer-2114"><span class="linenos">2114</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">nation</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2115"><a href="#ChartDrawer-2115"><span class="linenos">2115</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2116"><a href="#ChartDrawer-2116"><span class="linenos">2116</span></a>
</span><span id="ChartDrawer-2117"><a href="#ChartDrawer-2117"><span class="linenos">2117</span></a>            <span class="c1"># Bottom left section</span>
</span><span id="ChartDrawer-2118"><a href="#ChartDrawer-2118"><span class="linenos">2118</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">==</span> <span class="s2">&quot;Tropical&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2119"><a href="#ChartDrawer-2119"><span class="linenos">2119</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;zodiac&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Zodiac&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Tropical&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2120"><a href="#ChartDrawer-2120"><span class="linenos">2120</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2121"><a href="#ChartDrawer-2121"><span class="linenos">2121</span></a>                <span class="n">mode_const</span> <span class="o">=</span> <span class="s2">&quot;SIDM_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2122"><a href="#ChartDrawer-2122"><span class="linenos">2122</span></a>                <span class="n">mode_name</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">swe</span><span class="p">,</span> <span class="n">mode_const</span><span class="p">))</span>
</span><span id="ChartDrawer-2123"><a href="#ChartDrawer-2123"><span class="linenos">2123</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;ayanamsa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ayanamsa&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mode_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2124"><a href="#ChartDrawer-2124"><span class="linenos">2124</span></a>
</span><span id="ChartDrawer-2125"><a href="#ChartDrawer-2125"><span class="linenos">2125</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2126"><a href="#ChartDrawer-2126"><span class="linenos">2126</span></a>            <span class="c1"># FIXME!</span>
</span><span id="ChartDrawer-2127"><a href="#ChartDrawer-2127"><span class="linenos">2127</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># f&quot;Compatibility Score: {16}/44&quot; # type: ignore</span>
</span><span id="ChartDrawer-2128"><a href="#ChartDrawer-2128"><span class="linenos">2128</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zodiac_info</span>
</span><span id="ChartDrawer-2129"><a href="#ChartDrawer-2129"><span class="linenos">2129</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses_system_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Houses&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2130"><a href="#ChartDrawer-2130"><span class="linenos">2130</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Perspective&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2131"><a href="#ChartDrawer-2131"><span class="linenos">2131</span></a>
</span><span id="ChartDrawer-2132"><a href="#ChartDrawer-2132"><span class="linenos">2132</span></a>            <span class="c1"># Moon phase section calculations</span>
</span><span id="ChartDrawer-2133"><a href="#ChartDrawer-2133"><span class="linenos">2133</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2134"><a href="#ChartDrawer-2134"><span class="linenos">2134</span></a>
</span><span id="ChartDrawer-2135"><a href="#ChartDrawer-2135"><span class="linenos">2135</span></a>            <span class="c1"># Houses and planet drawing</span>
</span><span id="ChartDrawer-2136"><a href="#ChartDrawer-2136"><span class="linenos">2136</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2137"><a href="#ChartDrawer-2137"><span class="linenos">2137</span></a>                <span class="n">main_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2138"><a href="#ChartDrawer-2138"><span class="linenos">2138</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2139"><a href="#ChartDrawer-2139"><span class="linenos">2139</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2140"><a href="#ChartDrawer-2140"><span class="linenos">2140</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2141"><a href="#ChartDrawer-2141"><span class="linenos">2141</span></a>
</span><span id="ChartDrawer-2142"><a href="#ChartDrawer-2142"><span class="linenos">2142</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_secondary_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2143"><a href="#ChartDrawer-2143"><span class="linenos">2143</span></a>                <span class="n">secondary_subject_houses_list</span><span class="o">=</span><span class="n">second_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2144"><a href="#ChartDrawer-2144"><span class="linenos">2144</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2145"><a href="#ChartDrawer-2145"><span class="linenos">2145</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2146"><a href="#ChartDrawer-2146"><span class="linenos">2146</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2147"><a href="#ChartDrawer-2147"><span class="linenos">2147</span></a>
</span><span id="ChartDrawer-2148"><a href="#ChartDrawer-2148"><span class="linenos">2148</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_houses_cusps_and_text_number</span><span class="p">(</span>
</span><span id="ChartDrawer-2149"><a href="#ChartDrawer-2149"><span class="linenos">2149</span></a>                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2150"><a href="#ChartDrawer-2150"><span class="linenos">2150</span></a>                <span class="n">first_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2151"><a href="#ChartDrawer-2151"><span class="linenos">2151</span></a>                <span class="n">standard_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_radix_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2152"><a href="#ChartDrawer-2152"><span class="linenos">2152</span></a>                <span class="n">first_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2153"><a href="#ChartDrawer-2153"><span class="linenos">2153</span></a>                <span class="n">tenth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2154"><a href="#ChartDrawer-2154"><span class="linenos">2154</span></a>                <span class="n">seventh_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2155"><a href="#ChartDrawer-2155"><span class="linenos">2155</span></a>                <span class="n">fourth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2156"><a href="#ChartDrawer-2156"><span class="linenos">2156</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2157"><a href="#ChartDrawer-2157"><span class="linenos">2157</span></a>                <span class="n">c3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2158"><a href="#ChartDrawer-2158"><span class="linenos">2158</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2159"><a href="#ChartDrawer-2159"><span class="linenos">2159</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-2160"><a href="#ChartDrawer-2160"><span class="linenos">2160</span></a>                <span class="n">second_subject_houses_list</span><span class="o">=</span><span class="n">second_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2161"><a href="#ChartDrawer-2161"><span class="linenos">2161</span></a>                <span class="n">transit_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_transit_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2162"><a href="#ChartDrawer-2162"><span class="linenos">2162</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2163"><a href="#ChartDrawer-2163"><span class="linenos">2163</span></a>
</span><span id="ChartDrawer-2164"><a href="#ChartDrawer-2164"><span class="linenos">2164</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makePlanets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_planets</span><span class="p">(</span>
</span><span id="ChartDrawer-2165"><a href="#ChartDrawer-2165"><span class="linenos">2165</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2166"><a href="#ChartDrawer-2166"><span class="linenos">2166</span></a>                <span class="n">available_planets_setting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2167"><a href="#ChartDrawer-2167"><span class="linenos">2167</span></a>                <span class="n">second_subject_available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2168"><a href="#ChartDrawer-2168"><span class="linenos">2168</span></a>                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2169"><a href="#ChartDrawer-2169"><span class="linenos">2169</span></a>                <span class="n">main_subject_first_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2170"><a href="#ChartDrawer-2170"><span class="linenos">2170</span></a>                <span class="n">main_subject_seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2171"><a href="#ChartDrawer-2171"><span class="linenos">2171</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2172"><a href="#ChartDrawer-2172"><span class="linenos">2172</span></a>                <span class="n">third_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2173"><a href="#ChartDrawer-2173"><span class="linenos">2173</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-2174"><a href="#ChartDrawer-2174"><span class="linenos">2174</span></a>                <span class="n">second_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2175"><a href="#ChartDrawer-2175"><span class="linenos">2175</span></a>                <span class="n">show_degree_indicators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span><span class="p">,</span>
</span><span id="ChartDrawer-2176"><a href="#ChartDrawer-2176"><span class="linenos">2176</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2177"><a href="#ChartDrawer-2177"><span class="linenos">2177</span></a>
</span><span id="ChartDrawer-2178"><a href="#ChartDrawer-2178"><span class="linenos">2178</span></a>            <span class="c1"># Planet grid</span>
</span><span id="ChartDrawer-2179"><a href="#ChartDrawer-2179"><span class="linenos">2179</span></a>            <span class="n">first_name_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-2180"><a href="#ChartDrawer-2180"><span class="linenos">2180</span></a>            <span class="n">second_name_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-2181"><a href="#ChartDrawer-2181"><span class="linenos">2181</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2182"><a href="#ChartDrawer-2182"><span class="linenos">2182</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2183"><a href="#ChartDrawer-2183"><span class="linenos">2183</span></a>                <span class="n">subject_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;inner_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Inner Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2184"><a href="#ChartDrawer-2184"><span class="linenos">2184</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2185"><a href="#ChartDrawer-2185"><span class="linenos">2185</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2186"><a href="#ChartDrawer-2186"><span class="linenos">2186</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2187"><a href="#ChartDrawer-2187"><span class="linenos">2187</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2188"><a href="#ChartDrawer-2188"><span class="linenos">2188</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2189"><a href="#ChartDrawer-2189"><span class="linenos">2189</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_secondary_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2190"><a href="#ChartDrawer-2190"><span class="linenos">2190</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2191"><a href="#ChartDrawer-2191"><span class="linenos">2191</span></a>                <span class="n">second_subject_name</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">second_name_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;outer_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Outer Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2192"><a href="#ChartDrawer-2192"><span class="linenos">2192</span></a>                <span class="n">second_subject_available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2193"><a href="#ChartDrawer-2193"><span class="linenos">2193</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2194"><a href="#ChartDrawer-2194"><span class="linenos">2194</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2195"><a href="#ChartDrawer-2195"><span class="linenos">2195</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2196"><a href="#ChartDrawer-2196"><span class="linenos">2196</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2197"><a href="#ChartDrawer-2197"><span class="linenos">2197</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2198"><a href="#ChartDrawer-2198"><span class="linenos">2198</span></a>                <span class="n">house_comparison_factory</span> <span class="o">=</span> <span class="n">HouseComparisonFactory</span><span class="p">(</span>
</span><span id="ChartDrawer-2199"><a href="#ChartDrawer-2199"><span class="linenos">2199</span></a>                    <span class="n">first_subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2200"><a href="#ChartDrawer-2200"><span class="linenos">2200</span></a>                    <span class="n">second_subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2201"><a href="#ChartDrawer-2201"><span class="linenos">2201</span></a>                    <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2202"><a href="#ChartDrawer-2202"><span class="linenos">2202</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-2203"><a href="#ChartDrawer-2203"><span class="linenos">2203</span></a>                <span class="n">house_comparison</span> <span class="o">=</span> <span class="n">house_comparison_factory</span><span class="o">.</span><span class="n">get_house_comparison</span><span class="p">()</span>
</span><span id="ChartDrawer-2204"><a href="#ChartDrawer-2204"><span class="linenos">2204</span></a>
</span><span id="ChartDrawer-2205"><a href="#ChartDrawer-2205"><span class="linenos">2205</span></a>                <span class="n">first_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-2206"><a href="#ChartDrawer-2206"><span class="linenos">2206</span></a>                <span class="n">second_subject_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="ChartDrawer-2207"><a href="#ChartDrawer-2207"><span class="linenos">2207</span></a>                <span class="n">point_column_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="s2">&quot;Point&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2208"><a href="#ChartDrawer-2208"><span class="linenos">2208</span></a>                <span class="n">comparison_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;House Position Comparison&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2209"><a href="#ChartDrawer-2209"><span class="linenos">2209</span></a>
</span><span id="ChartDrawer-2210"><a href="#ChartDrawer-2210"><span class="linenos">2210</span></a>                <span class="n">house_comparison_svg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2211"><a href="#ChartDrawer-2211"><span class="linenos">2211</span></a>
</span><span id="ChartDrawer-2212"><a href="#ChartDrawer-2212"><span class="linenos">2212</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2213"><a href="#ChartDrawer-2213"><span class="linenos">2213</span></a>                    <span class="n">first_subject_grid</span> <span class="o">=</span> <span class="n">draw_house_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2214"><a href="#ChartDrawer-2214"><span class="linenos">2214</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2215"><a href="#ChartDrawer-2215"><span class="linenos">2215</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2216"><a href="#ChartDrawer-2216"><span class="linenos">2216</span></a>                        <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2217"><a href="#ChartDrawer-2217"><span class="linenos">2217</span></a>                        <span class="n">points_owner_subject_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ChartDrawer-2218"><a href="#ChartDrawer-2218"><span class="linenos">2218</span></a>                        <span class="n">house_position_comparison_label</span><span class="o">=</span><span class="n">comparison_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2219"><a href="#ChartDrawer-2219"><span class="linenos">2219</span></a>                        <span class="n">return_point_label</span><span class="o">=</span><span class="n">first_subject_label</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">point_column_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2220"><a href="#ChartDrawer-2220"><span class="linenos">2220</span></a>                        <span class="n">return_label</span><span class="o">=</span><span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2221"><a href="#ChartDrawer-2221"><span class="linenos">2221</span></a>                        <span class="n">radix_label</span><span class="o">=</span><span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2222"><a href="#ChartDrawer-2222"><span class="linenos">2222</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="mi">1090</span><span class="p">,</span>
</span><span id="ChartDrawer-2223"><a href="#ChartDrawer-2223"><span class="linenos">2223</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2224"><a href="#ChartDrawer-2224"><span class="linenos">2224</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2225"><a href="#ChartDrawer-2225"><span class="linenos">2225</span></a>
</span><span id="ChartDrawer-2226"><a href="#ChartDrawer-2226"><span class="linenos">2226</span></a>                    <span class="n">second_subject_grid</span> <span class="o">=</span> <span class="n">draw_house_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2227"><a href="#ChartDrawer-2227"><span class="linenos">2227</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2228"><a href="#ChartDrawer-2228"><span class="linenos">2228</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2229"><a href="#ChartDrawer-2229"><span class="linenos">2229</span></a>                        <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2230"><a href="#ChartDrawer-2230"><span class="linenos">2230</span></a>                        <span class="n">points_owner_subject_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ChartDrawer-2231"><a href="#ChartDrawer-2231"><span class="linenos">2231</span></a>                        <span class="n">house_position_comparison_label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2232"><a href="#ChartDrawer-2232"><span class="linenos">2232</span></a>                        <span class="n">return_point_label</span><span class="o">=</span><span class="n">second_subject_label</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">point_column_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2233"><a href="#ChartDrawer-2233"><span class="linenos">2233</span></a>                        <span class="n">return_label</span><span class="o">=</span><span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2234"><a href="#ChartDrawer-2234"><span class="linenos">2234</span></a>                        <span class="n">radix_label</span><span class="o">=</span><span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2235"><a href="#ChartDrawer-2235"><span class="linenos">2235</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="mi">1290</span><span class="p">,</span>
</span><span id="ChartDrawer-2236"><a href="#ChartDrawer-2236"><span class="linenos">2236</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2237"><a href="#ChartDrawer-2237"><span class="linenos">2237</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2238"><a href="#ChartDrawer-2238"><span class="linenos">2238</span></a>
</span><span id="ChartDrawer-2239"><a href="#ChartDrawer-2239"><span class="linenos">2239</span></a>                    <span class="n">house_comparison_svg</span> <span class="o">=</span> <span class="n">first_subject_grid</span> <span class="o">+</span> <span class="n">second_subject_grid</span>
</span><span id="ChartDrawer-2240"><a href="#ChartDrawer-2240"><span class="linenos">2240</span></a>
</span><span id="ChartDrawer-2241"><a href="#ChartDrawer-2241"><span class="linenos">2241</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2242"><a href="#ChartDrawer-2242"><span class="linenos">2242</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2243"><a href="#ChartDrawer-2243"><span class="linenos">2243</span></a>                        <span class="c1"># Estimate house comparison grid widths to place cusp comparison at the far right</span>
</span><span id="ChartDrawer-2244"><a href="#ChartDrawer-2244"><span class="linenos">2244</span></a>                        <span class="n">first_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-2245"><a href="#ChartDrawer-2245"><span class="linenos">2245</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_subject_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2246"><a href="#ChartDrawer-2246"><span class="linenos">2246</span></a>                            <span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2247"><a href="#ChartDrawer-2247"><span class="linenos">2247</span></a>                            <span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2248"><a href="#ChartDrawer-2248"><span class="linenos">2248</span></a>                        <span class="p">]</span>
</span><span id="ChartDrawer-2249"><a href="#ChartDrawer-2249"><span class="linenos">2249</span></a>                        <span class="n">second_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-2250"><a href="#ChartDrawer-2250"><span class="linenos">2250</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">second_subject_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2251"><a href="#ChartDrawer-2251"><span class="linenos">2251</span></a>                            <span class="n">second_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2252"><a href="#ChartDrawer-2252"><span class="linenos">2252</span></a>                            <span class="n">first_subject_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2253"><a href="#ChartDrawer-2253"><span class="linenos">2253</span></a>                        <span class="p">]</span>
</span><span id="ChartDrawer-2254"><a href="#ChartDrawer-2254"><span class="linenos">2254</span></a>
</span><span id="ChartDrawer-2255"><a href="#ChartDrawer-2255"><span class="linenos">2255</span></a>                        <span class="n">first_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-2256"><a href="#ChartDrawer-2256"><span class="linenos">2256</span></a>                            <span class="n">column_labels</span><span class="o">=</span><span class="n">first_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-2257"><a href="#ChartDrawer-2257"><span class="linenos">2257</span></a>                            <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-2258"><a href="#ChartDrawer-2258"><span class="linenos">2258</span></a>                            <span class="n">include_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-2259"><a href="#ChartDrawer-2259"><span class="linenos">2259</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-2260"><a href="#ChartDrawer-2260"><span class="linenos">2260</span></a>                        <span class="n">second_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-2261"><a href="#ChartDrawer-2261"><span class="linenos">2261</span></a>                            <span class="n">column_labels</span><span class="o">=</span><span class="n">second_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-2262"><a href="#ChartDrawer-2262"><span class="linenos">2262</span></a>                            <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-2263"><a href="#ChartDrawer-2263"><span class="linenos">2263</span></a>                            <span class="n">include_title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-2264"><a href="#ChartDrawer-2264"><span class="linenos">2264</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-2265"><a href="#ChartDrawer-2265"><span class="linenos">2265</span></a>
</span><span id="ChartDrawer-2266"><a href="#ChartDrawer-2266"><span class="linenos">2266</span></a>                        <span class="n">first_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">first_grid_width</span>
</span><span id="ChartDrawer-2267"><a href="#ChartDrawer-2267"><span class="linenos">2267</span></a>                        <span class="n">second_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1190</span> <span class="o">+</span> <span class="n">second_grid_width</span>
</span><span id="ChartDrawer-2268"><a href="#ChartDrawer-2268"><span class="linenos">2268</span></a>                        <span class="n">max_house_comparison_right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ChartDrawer-2269"><a href="#ChartDrawer-2269"><span class="linenos">2269</span></a>                            <span class="n">first_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-2270"><a href="#ChartDrawer-2270"><span class="linenos">2270</span></a>                            <span class="n">second_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-2271"><a href="#ChartDrawer-2271"><span class="linenos">2271</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-2272"><a href="#ChartDrawer-2272"><span class="linenos">2272</span></a>                        <span class="n">cusp_x_position</span> <span class="o">=</span> <span class="n">max_house_comparison_right</span> <span class="o">+</span> <span class="mf">50.0</span>
</span><span id="ChartDrawer-2273"><a href="#ChartDrawer-2273"><span class="linenos">2273</span></a>
</span><span id="ChartDrawer-2274"><a href="#ChartDrawer-2274"><span class="linenos">2274</span></a>                        <span class="c1"># Place cusp comparison grids for Synastry side by side on the far right,</span>
</span><span id="ChartDrawer-2275"><a href="#ChartDrawer-2275"><span class="linenos">2275</span></a>                        <span class="c1"># keeping them as close together as possible and slightly shifted left.</span>
</span><span id="ChartDrawer-2276"><a href="#ChartDrawer-2276"><span class="linenos">2276</span></a>                        <span class="n">cusp_grid_width</span> <span class="o">=</span> <span class="mf">160.0</span>
</span><span id="ChartDrawer-2277"><a href="#ChartDrawer-2277"><span class="linenos">2277</span></a>                        <span class="n">inter_cusp_gap</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-2278"><a href="#ChartDrawer-2278"><span class="linenos">2278</span></a>                        <span class="n">first_cusp_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cusp_x_position</span><span class="p">)</span>
</span><span id="ChartDrawer-2279"><a href="#ChartDrawer-2279"><span class="linenos">2279</span></a>                        <span class="n">second_cusp_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cusp_x_position</span> <span class="o">+</span> <span class="n">cusp_grid_width</span> <span class="o">+</span> <span class="n">inter_cusp_gap</span><span class="p">)</span>
</span><span id="ChartDrawer-2280"><a href="#ChartDrawer-2280"><span class="linenos">2280</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2281"><a href="#ChartDrawer-2281"><span class="linenos">2281</span></a>                        <span class="c1"># Cusp-only layout: reuse the house comparison slots at x=1090 and x=1290.</span>
</span><span id="ChartDrawer-2282"><a href="#ChartDrawer-2282"><span class="linenos">2282</span></a>                        <span class="n">first_cusp_x</span> <span class="o">=</span> <span class="mi">1090</span>
</span><span id="ChartDrawer-2283"><a href="#ChartDrawer-2283"><span class="linenos">2283</span></a>                        <span class="n">second_cusp_x</span> <span class="o">=</span> <span class="mi">1290</span>
</span><span id="ChartDrawer-2284"><a href="#ChartDrawer-2284"><span class="linenos">2284</span></a>
</span><span id="ChartDrawer-2285"><a href="#ChartDrawer-2285"><span class="linenos">2285</span></a>                    <span class="n">first_cusp_grid</span> <span class="o">=</span> <span class="n">draw_cusp_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2286"><a href="#ChartDrawer-2286"><span class="linenos">2286</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2287"><a href="#ChartDrawer-2287"><span class="linenos">2287</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2288"><a href="#ChartDrawer-2288"><span class="linenos">2288</span></a>                        <span class="n">cusps_owner_subject_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ChartDrawer-2289"><a href="#ChartDrawer-2289"><span class="linenos">2289</span></a>                        <span class="n">cusp_position_comparison_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp Position Comparison&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2290"><a href="#ChartDrawer-2290"><span class="linenos">2290</span></a>                        <span class="n">owner_cusp_label</span><span class="o">=</span><span class="n">first_subject_label</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2291"><a href="#ChartDrawer-2291"><span class="linenos">2291</span></a>                        <span class="n">projected_house_label</span><span class="o">=</span><span class="n">second_subject_label</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house&quot;</span><span class="p">,</span> <span class="s2">&quot;House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2292"><a href="#ChartDrawer-2292"><span class="linenos">2292</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="n">first_cusp_x</span><span class="p">,</span>
</span><span id="ChartDrawer-2293"><a href="#ChartDrawer-2293"><span class="linenos">2293</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2294"><a href="#ChartDrawer-2294"><span class="linenos">2294</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2295"><a href="#ChartDrawer-2295"><span class="linenos">2295</span></a>
</span><span id="ChartDrawer-2296"><a href="#ChartDrawer-2296"><span class="linenos">2296</span></a>                    <span class="n">second_cusp_grid</span> <span class="o">=</span> <span class="n">draw_cusp_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2297"><a href="#ChartDrawer-2297"><span class="linenos">2297</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2298"><a href="#ChartDrawer-2298"><span class="linenos">2298</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2299"><a href="#ChartDrawer-2299"><span class="linenos">2299</span></a>                        <span class="n">cusps_owner_subject_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ChartDrawer-2300"><a href="#ChartDrawer-2300"><span class="linenos">2300</span></a>                        <span class="n">cusp_position_comparison_label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2301"><a href="#ChartDrawer-2301"><span class="linenos">2301</span></a>                        <span class="n">owner_cusp_label</span><span class="o">=</span><span class="n">second_subject_label</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2302"><a href="#ChartDrawer-2302"><span class="linenos">2302</span></a>                        <span class="n">projected_house_label</span><span class="o">=</span><span class="n">first_subject_label</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house&quot;</span><span class="p">,</span> <span class="s2">&quot;House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2303"><a href="#ChartDrawer-2303"><span class="linenos">2303</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="n">second_cusp_x</span><span class="p">,</span>
</span><span id="ChartDrawer-2304"><a href="#ChartDrawer-2304"><span class="linenos">2304</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2305"><a href="#ChartDrawer-2305"><span class="linenos">2305</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2306"><a href="#ChartDrawer-2306"><span class="linenos">2306</span></a>
</span><span id="ChartDrawer-2307"><a href="#ChartDrawer-2307"><span class="linenos">2307</span></a>                    <span class="n">house_comparison_svg</span> <span class="o">+=</span> <span class="n">first_cusp_grid</span> <span class="o">+</span> <span class="n">second_cusp_grid</span>
</span><span id="ChartDrawer-2308"><a href="#ChartDrawer-2308"><span class="linenos">2308</span></a>
</span><span id="ChartDrawer-2309"><a href="#ChartDrawer-2309"><span class="linenos">2309</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">house_comparison_svg</span>
</span><span id="ChartDrawer-2310"><a href="#ChartDrawer-2310"><span class="linenos">2310</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2311"><a href="#ChartDrawer-2311"><span class="linenos">2311</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2312"><a href="#ChartDrawer-2312"><span class="linenos">2312</span></a>
</span><span id="ChartDrawer-2313"><a href="#ChartDrawer-2313"><span class="linenos">2313</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2314"><a href="#ChartDrawer-2314"><span class="linenos">2314</span></a>            <span class="c1"># Set viewbox dynamically</span>
</span><span id="ChartDrawer-2315"><a href="#ChartDrawer-2315"><span class="linenos">2315</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;viewbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-2316"><a href="#ChartDrawer-2316"><span class="linenos">2316</span></a>
</span><span id="ChartDrawer-2317"><a href="#ChartDrawer-2317"><span class="linenos">2317</span></a>            <span class="c1"># Get houses list for secondary subject</span>
</span><span id="ChartDrawer-2318"><a href="#ChartDrawer-2318"><span class="linenos">2318</span></a>            <span class="n">second_subject_houses_list</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2319"><a href="#ChartDrawer-2319"><span class="linenos">2319</span></a>
</span><span id="ChartDrawer-2320"><a href="#ChartDrawer-2320"><span class="linenos">2320</span></a>            <span class="c1"># Rings and circles</span>
</span><span id="ChartDrawer-2321"><a href="#ChartDrawer-2321"><span class="linenos">2321</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;transitRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_ring</span><span class="p">(</span>
</span><span id="ChartDrawer-2322"><a href="#ChartDrawer-2322"><span class="linenos">2322</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2323"><a href="#ChartDrawer-2323"><span class="linenos">2323</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2324"><a href="#ChartDrawer-2324"><span class="linenos">2324</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_3&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2325"><a href="#ChartDrawer-2325"><span class="linenos">2325</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2326"><a href="#ChartDrawer-2326"><span class="linenos">2326</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;degreeRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_ring_degree_steps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">)</span>
</span><span id="ChartDrawer-2327"><a href="#ChartDrawer-2327"><span class="linenos">2327</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_background_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2328"><a href="#ChartDrawer-2328"><span class="linenos">2328</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2329"><a href="#ChartDrawer-2329"><span class="linenos">2329</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2330"><a href="#ChartDrawer-2330"><span class="linenos">2330</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2331"><a href="#ChartDrawer-2331"><span class="linenos">2331</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2332"><a href="#ChartDrawer-2332"><span class="linenos">2332</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;first_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_first_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2333"><a href="#ChartDrawer-2333"><span class="linenos">2333</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2334"><a href="#ChartDrawer-2334"><span class="linenos">2334</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_2&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2335"><a href="#ChartDrawer-2335"><span class="linenos">2335</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2336"><a href="#ChartDrawer-2336"><span class="linenos">2336</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2337"><a href="#ChartDrawer-2337"><span class="linenos">2337</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;second_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_second_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2338"><a href="#ChartDrawer-2338"><span class="linenos">2338</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2339"><a href="#ChartDrawer-2339"><span class="linenos">2339</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2340"><a href="#ChartDrawer-2340"><span class="linenos">2340</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2341"><a href="#ChartDrawer-2341"><span class="linenos">2341</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2342"><a href="#ChartDrawer-2342"><span class="linenos">2342</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2343"><a href="#ChartDrawer-2343"><span class="linenos">2343</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;third_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_third_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2344"><a href="#ChartDrawer-2344"><span class="linenos">2344</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2345"><a href="#ChartDrawer-2345"><span class="linenos">2345</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_transit_ring_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2346"><a href="#ChartDrawer-2346"><span class="linenos">2346</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2347"><a href="#ChartDrawer-2347"><span class="linenos">2347</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2348"><a href="#ChartDrawer-2348"><span class="linenos">2348</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2349"><a href="#ChartDrawer-2349"><span class="linenos">2349</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2350"><a href="#ChartDrawer-2350"><span class="linenos">2350</span></a>
</span><span id="ChartDrawer-2351"><a href="#ChartDrawer-2351"><span class="linenos">2351</span></a>            <span class="c1"># Aspects</span>
</span><span id="ChartDrawer-2352"><a href="#ChartDrawer-2352"><span class="linenos">2352</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2353"><a href="#ChartDrawer-2353"><span class="linenos">2353</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;return_aspects&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal to Return Aspects&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2354"><a href="#ChartDrawer-2354"><span class="linenos">2354</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2355"><a href="#ChartDrawer-2355"><span class="linenos">2355</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_aspect_list</span><span class="p">(</span>
</span><span id="ChartDrawer-2356"><a href="#ChartDrawer-2356"><span class="linenos">2356</span></a>                    <span class="n">title</span><span class="p">,</span>
</span><span id="ChartDrawer-2357"><a href="#ChartDrawer-2357"><span class="linenos">2357</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2358"><a href="#ChartDrawer-2358"><span class="linenos">2358</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">,</span>
</span><span id="ChartDrawer-2359"><a href="#ChartDrawer-2359"><span class="linenos">2359</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">,</span>
</span><span id="ChartDrawer-2360"><a href="#ChartDrawer-2360"><span class="linenos">2360</span></a>                    <span class="n">max_columns</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
</span><span id="ChartDrawer-2361"><a href="#ChartDrawer-2361"><span class="linenos">2361</span></a>                    <span class="n">chart_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
</span><span id="ChartDrawer-2362"><a href="#ChartDrawer-2362"><span class="linenos">2362</span></a>                <span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2363"><a href="#ChartDrawer-2363"><span class="linenos">2363</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2364"><a href="#ChartDrawer-2364"><span class="linenos">2364</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2365"><a href="#ChartDrawer-2365"><span class="linenos">2365</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_transit_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2366"><a href="#ChartDrawer-2366"><span class="linenos">2366</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2367"><a href="#ChartDrawer-2367"><span class="linenos">2367</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2368"><a href="#ChartDrawer-2368"><span class="linenos">2368</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2369"><a href="#ChartDrawer-2369"><span class="linenos">2369</span></a>                    <span class="mi">550</span><span class="p">,</span>
</span><span id="ChartDrawer-2370"><a href="#ChartDrawer-2370"><span class="linenos">2370</span></a>                    <span class="mi">450</span><span class="p">,</span>
</span><span id="ChartDrawer-2371"><a href="#ChartDrawer-2371"><span class="linenos">2371</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-2372"><a href="#ChartDrawer-2372"><span class="linenos">2372</span></a>
</span><span id="ChartDrawer-2373"><a href="#ChartDrawer-2373"><span class="linenos">2373</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_all_transit_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">-</span> <span class="mi">160</span><span class="p">)</span>
</span><span id="ChartDrawer-2374"><a href="#ChartDrawer-2374"><span class="linenos">2374</span></a>
</span><span id="ChartDrawer-2375"><a href="#ChartDrawer-2375"><span class="linenos">2375</span></a>
</span><span id="ChartDrawer-2376"><a href="#ChartDrawer-2376"><span class="linenos">2376</span></a>            <span class="c1"># Top left section</span>
</span><span id="ChartDrawer-2377"><a href="#ChartDrawer-2377"><span class="linenos">2377</span></a>            <span class="c1"># Subject</span>
</span><span id="ChartDrawer-2378"><a href="#ChartDrawer-2378"><span class="linenos">2378</span></a>            <span class="n">latitude_string</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south&quot;</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2379"><a href="#ChartDrawer-2379"><span class="linenos">2379</span></a>            <span class="n">longitude_string</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;East&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2380"><a href="#ChartDrawer-2380"><span class="linenos">2380</span></a>
</span><span id="ChartDrawer-2381"><a href="#ChartDrawer-2381"><span class="linenos">2381</span></a>            <span class="c1"># Return</span>
</span><span id="ChartDrawer-2382"><a href="#ChartDrawer-2382"><span class="linenos">2382</span></a>            <span class="n">return_latitude_string</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south&quot;</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2383"><a href="#ChartDrawer-2383"><span class="linenos">2383</span></a>            <span class="n">return_longitude_string</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;East&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2384"><a href="#ChartDrawer-2384"><span class="linenos">2384</span></a>
</span><span id="ChartDrawer-2385"><a href="#ChartDrawer-2385"><span class="linenos">2385</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2386"><a href="#ChartDrawer-2386"><span class="linenos">2386</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;solar_return&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Solar Return&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="ChartDrawer-2387"><a href="#ChartDrawer-2387"><span class="linenos">2387</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2388"><a href="#ChartDrawer-2388"><span class="linenos">2388</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;lunar_return&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Lunar Return&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="ChartDrawer-2389"><a href="#ChartDrawer-2389"><span class="linenos">2389</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2390"><a href="#ChartDrawer-2390"><span class="linenos">2390</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">return_latitude_string</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">return_longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2391"><a href="#ChartDrawer-2391"><span class="linenos">2391</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2392"><a href="#ChartDrawer-2392"><span class="linenos">2392</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2393"><a href="#ChartDrawer-2393"><span class="linenos">2393</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">latitude_string</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2394"><a href="#ChartDrawer-2394"><span class="linenos">2394</span></a>
</span><span id="ChartDrawer-2395"><a href="#ChartDrawer-2395"><span class="linenos">2395</span></a>            <span class="c1"># Bottom left section</span>
</span><span id="ChartDrawer-2396"><a href="#ChartDrawer-2396"><span class="linenos">2396</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">==</span> <span class="s2">&quot;Tropical&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2397"><a href="#ChartDrawer-2397"><span class="linenos">2397</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;zodiac&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Zodiac&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Tropical&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2398"><a href="#ChartDrawer-2398"><span class="linenos">2398</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2399"><a href="#ChartDrawer-2399"><span class="linenos">2399</span></a>                <span class="n">mode_const</span> <span class="o">=</span> <span class="s2">&quot;SIDM_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2400"><a href="#ChartDrawer-2400"><span class="linenos">2400</span></a>                <span class="n">mode_name</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">swe</span><span class="p">,</span> <span class="n">mode_const</span><span class="p">))</span>
</span><span id="ChartDrawer-2401"><a href="#ChartDrawer-2401"><span class="linenos">2401</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;ayanamsa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ayanamsa&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mode_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2402"><a href="#ChartDrawer-2402"><span class="linenos">2402</span></a>
</span><span id="ChartDrawer-2403"><a href="#ChartDrawer-2403"><span class="linenos">2403</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zodiac_info</span>
</span><span id="ChartDrawer-2404"><a href="#ChartDrawer-2404"><span class="linenos">2404</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;domification&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Domification&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses_system_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2405"><a href="#ChartDrawer-2405"><span class="linenos">2405</span></a>
</span><span id="ChartDrawer-2406"><a href="#ChartDrawer-2406"><span class="linenos">2406</span></a>            <span class="c1"># Lunar phase information (optional)</span>
</span><span id="ChartDrawer-2407"><a href="#ChartDrawer-2407"><span class="linenos">2407</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2408"><a href="#ChartDrawer-2408"><span class="linenos">2408</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunation_day&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunation Day&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;moon_phase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2409"><a href="#ChartDrawer-2409"><span class="linenos">2409</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunar Phase&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2410"><a href="#ChartDrawer-2410"><span class="linenos">2410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2411"><a href="#ChartDrawer-2411"><span class="linenos">2411</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2412"><a href="#ChartDrawer-2412"><span class="linenos">2412</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2413"><a href="#ChartDrawer-2413"><span class="linenos">2413</span></a>
</span><span id="ChartDrawer-2414"><a href="#ChartDrawer-2414"><span class="linenos">2414</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Perspective&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2415"><a href="#ChartDrawer-2415"><span class="linenos">2415</span></a>
</span><span id="ChartDrawer-2416"><a href="#ChartDrawer-2416"><span class="linenos">2416</span></a>            <span class="c1"># Moon phase section calculations</span>
</span><span id="ChartDrawer-2417"><a href="#ChartDrawer-2417"><span class="linenos">2417</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2418"><a href="#ChartDrawer-2418"><span class="linenos">2418</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeLunarPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="p">[</span><span class="s2">&quot;degrees_between_s_m&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">)</span>
</span><span id="ChartDrawer-2419"><a href="#ChartDrawer-2419"><span class="linenos">2419</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2420"><a href="#ChartDrawer-2420"><span class="linenos">2420</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2421"><a href="#ChartDrawer-2421"><span class="linenos">2421</span></a>
</span><span id="ChartDrawer-2422"><a href="#ChartDrawer-2422"><span class="linenos">2422</span></a>            <span class="c1"># Houses and planet drawing</span>
</span><span id="ChartDrawer-2423"><a href="#ChartDrawer-2423"><span class="linenos">2423</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2424"><a href="#ChartDrawer-2424"><span class="linenos">2424</span></a>                <span class="n">main_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2425"><a href="#ChartDrawer-2425"><span class="linenos">2425</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2426"><a href="#ChartDrawer-2426"><span class="linenos">2426</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2427"><a href="#ChartDrawer-2427"><span class="linenos">2427</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2428"><a href="#ChartDrawer-2428"><span class="linenos">2428</span></a>
</span><span id="ChartDrawer-2429"><a href="#ChartDrawer-2429"><span class="linenos">2429</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_secondary_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2430"><a href="#ChartDrawer-2430"><span class="linenos">2430</span></a>                <span class="n">secondary_subject_houses_list</span><span class="o">=</span><span class="n">second_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2431"><a href="#ChartDrawer-2431"><span class="linenos">2431</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2432"><a href="#ChartDrawer-2432"><span class="linenos">2432</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2433"><a href="#ChartDrawer-2433"><span class="linenos">2433</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2434"><a href="#ChartDrawer-2434"><span class="linenos">2434</span></a>
</span><span id="ChartDrawer-2435"><a href="#ChartDrawer-2435"><span class="linenos">2435</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_houses_cusps_and_text_number</span><span class="p">(</span>
</span><span id="ChartDrawer-2436"><a href="#ChartDrawer-2436"><span class="linenos">2436</span></a>                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2437"><a href="#ChartDrawer-2437"><span class="linenos">2437</span></a>                <span class="n">first_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2438"><a href="#ChartDrawer-2438"><span class="linenos">2438</span></a>                <span class="n">standard_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_radix_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2439"><a href="#ChartDrawer-2439"><span class="linenos">2439</span></a>                <span class="n">first_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2440"><a href="#ChartDrawer-2440"><span class="linenos">2440</span></a>                <span class="n">tenth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2441"><a href="#ChartDrawer-2441"><span class="linenos">2441</span></a>                <span class="n">seventh_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2442"><a href="#ChartDrawer-2442"><span class="linenos">2442</span></a>                <span class="n">fourth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2443"><a href="#ChartDrawer-2443"><span class="linenos">2443</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2444"><a href="#ChartDrawer-2444"><span class="linenos">2444</span></a>                <span class="n">c3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2445"><a href="#ChartDrawer-2445"><span class="linenos">2445</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2446"><a href="#ChartDrawer-2446"><span class="linenos">2446</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-2447"><a href="#ChartDrawer-2447"><span class="linenos">2447</span></a>                <span class="n">second_subject_houses_list</span><span class="o">=</span><span class="n">second_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2448"><a href="#ChartDrawer-2448"><span class="linenos">2448</span></a>                <span class="n">transit_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_transit_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2449"><a href="#ChartDrawer-2449"><span class="linenos">2449</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2450"><a href="#ChartDrawer-2450"><span class="linenos">2450</span></a>
</span><span id="ChartDrawer-2451"><a href="#ChartDrawer-2451"><span class="linenos">2451</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makePlanets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_planets</span><span class="p">(</span>
</span><span id="ChartDrawer-2452"><a href="#ChartDrawer-2452"><span class="linenos">2452</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2453"><a href="#ChartDrawer-2453"><span class="linenos">2453</span></a>                <span class="n">available_planets_setting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2454"><a href="#ChartDrawer-2454"><span class="linenos">2454</span></a>                <span class="n">second_subject_available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2455"><a href="#ChartDrawer-2455"><span class="linenos">2455</span></a>                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2456"><a href="#ChartDrawer-2456"><span class="linenos">2456</span></a>                <span class="n">main_subject_first_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2457"><a href="#ChartDrawer-2457"><span class="linenos">2457</span></a>                <span class="n">main_subject_seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2458"><a href="#ChartDrawer-2458"><span class="linenos">2458</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2459"><a href="#ChartDrawer-2459"><span class="linenos">2459</span></a>                <span class="n">third_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2460"><a href="#ChartDrawer-2460"><span class="linenos">2460</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-2461"><a href="#ChartDrawer-2461"><span class="linenos">2461</span></a>                <span class="n">second_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2462"><a href="#ChartDrawer-2462"><span class="linenos">2462</span></a>                <span class="n">show_degree_indicators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span><span class="p">,</span>
</span><span id="ChartDrawer-2463"><a href="#ChartDrawer-2463"><span class="linenos">2463</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2464"><a href="#ChartDrawer-2464"><span class="linenos">2464</span></a>
</span><span id="ChartDrawer-2465"><a href="#ChartDrawer-2465"><span class="linenos">2465</span></a>            <span class="c1"># Planet grid</span>
</span><span id="ChartDrawer-2466"><a href="#ChartDrawer-2466"><span class="linenos">2466</span></a>            <span class="n">first_name_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChartDrawer-2467"><a href="#ChartDrawer-2467"><span class="linenos">2467</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2468"><a href="#ChartDrawer-2468"><span class="linenos">2468</span></a>                <span class="n">first_return_grid_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;inner_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Inner Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ChartDrawer-2469"><a href="#ChartDrawer-2469"><span class="linenos">2469</span></a>                <span class="n">second_return_grid_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;solar_return&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Solar Return&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;outer_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Outer Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ChartDrawer-2470"><a href="#ChartDrawer-2470"><span class="linenos">2470</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2471"><a href="#ChartDrawer-2471"><span class="linenos">2471</span></a>                <span class="n">first_return_grid_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;inner_wheel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Inner Wheel&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ChartDrawer-2472"><a href="#ChartDrawer-2472"><span class="linenos">2472</span></a>                <span class="n">second_return_grid_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_return&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunar Return&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;outer_wheel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Outer Wheel&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="ChartDrawer-2473"><a href="#ChartDrawer-2473"><span class="linenos">2473</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2474"><a href="#ChartDrawer-2474"><span class="linenos">2474</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2475"><a href="#ChartDrawer-2475"><span class="linenos">2475</span></a>                <span class="n">subject_name</span><span class="o">=</span><span class="n">first_return_grid_title</span><span class="p">,</span>
</span><span id="ChartDrawer-2476"><a href="#ChartDrawer-2476"><span class="linenos">2476</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2477"><a href="#ChartDrawer-2477"><span class="linenos">2477</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2478"><a href="#ChartDrawer-2478"><span class="linenos">2478</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2479"><a href="#ChartDrawer-2479"><span class="linenos">2479</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2480"><a href="#ChartDrawer-2480"><span class="linenos">2480</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2481"><a href="#ChartDrawer-2481"><span class="linenos">2481</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_secondary_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2482"><a href="#ChartDrawer-2482"><span class="linenos">2482</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2483"><a href="#ChartDrawer-2483"><span class="linenos">2483</span></a>                <span class="n">second_subject_name</span><span class="o">=</span><span class="n">second_return_grid_title</span><span class="p">,</span>
</span><span id="ChartDrawer-2484"><a href="#ChartDrawer-2484"><span class="linenos">2484</span></a>                <span class="n">second_subject_available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2485"><a href="#ChartDrawer-2485"><span class="linenos">2485</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2486"><a href="#ChartDrawer-2486"><span class="linenos">2486</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2487"><a href="#ChartDrawer-2487"><span class="linenos">2487</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2488"><a href="#ChartDrawer-2488"><span class="linenos">2488</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2489"><a href="#ChartDrawer-2489"><span class="linenos">2489</span></a>
</span><span id="ChartDrawer-2490"><a href="#ChartDrawer-2490"><span class="linenos">2490</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2491"><a href="#ChartDrawer-2491"><span class="linenos">2491</span></a>                <span class="n">house_comparison_factory</span> <span class="o">=</span> <span class="n">HouseComparisonFactory</span><span class="p">(</span>
</span><span id="ChartDrawer-2492"><a href="#ChartDrawer-2492"><span class="linenos">2492</span></a>                    <span class="n">first_subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2493"><a href="#ChartDrawer-2493"><span class="linenos">2493</span></a>                    <span class="n">second_subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer-2494"><a href="#ChartDrawer-2494"><span class="linenos">2494</span></a>                    <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2495"><a href="#ChartDrawer-2495"><span class="linenos">2495</span></a>                <span class="p">)</span>
</span><span id="ChartDrawer-2496"><a href="#ChartDrawer-2496"><span class="linenos">2496</span></a>                <span class="n">house_comparison</span> <span class="o">=</span> <span class="n">house_comparison_factory</span><span class="o">.</span><span class="n">get_house_comparison</span><span class="p">()</span>
</span><span id="ChartDrawer-2497"><a href="#ChartDrawer-2497"><span class="linenos">2497</span></a>
</span><span id="ChartDrawer-2498"><a href="#ChartDrawer-2498"><span class="linenos">2498</span></a>                <span class="c1"># Use generic, localized labels (Natal vs Return) so the DualReturn</span>
</span><span id="ChartDrawer-2499"><a href="#ChartDrawer-2499"><span class="linenos">2499</span></a>                <span class="c1"># comparison layout mirrors the Synastry layout.</span>
</span><span id="ChartDrawer-2500"><a href="#ChartDrawer-2500"><span class="linenos">2500</span></a>                <span class="n">natal_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Natal&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2501"><a href="#ChartDrawer-2501"><span class="linenos">2501</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s2">&quot;return_type&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2502"><a href="#ChartDrawer-2502"><span class="linenos">2502</span></a>                    <span class="n">return_label_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;Return&quot;</span><span class="p">,</span> <span class="s2">&quot;Return&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2503"><a href="#ChartDrawer-2503"><span class="linenos">2503</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2504"><a href="#ChartDrawer-2504"><span class="linenos">2504</span></a>                    <span class="n">return_label_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;Return&quot;</span><span class="p">,</span> <span class="s2">&quot;Return&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2505"><a href="#ChartDrawer-2505"><span class="linenos">2505</span></a>                <span class="n">point_column_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="s2">&quot;Point&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2506"><a href="#ChartDrawer-2506"><span class="linenos">2506</span></a>
</span><span id="ChartDrawer-2507"><a href="#ChartDrawer-2507"><span class="linenos">2507</span></a>                <span class="n">house_comparison_svg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2508"><a href="#ChartDrawer-2508"><span class="linenos">2508</span></a>
</span><span id="ChartDrawer-2509"><a href="#ChartDrawer-2509"><span class="linenos">2509</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2510"><a href="#ChartDrawer-2510"><span class="linenos">2510</span></a>                    <span class="c1"># Two house comparison grids side by side, like Synastry.</span>
</span><span id="ChartDrawer-2511"><a href="#ChartDrawer-2511"><span class="linenos">2511</span></a>                    <span class="n">first_house_grid</span> <span class="o">=</span> <span class="n">draw_house_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2512"><a href="#ChartDrawer-2512"><span class="linenos">2512</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2513"><a href="#ChartDrawer-2513"><span class="linenos">2513</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2514"><a href="#ChartDrawer-2514"><span class="linenos">2514</span></a>                        <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2515"><a href="#ChartDrawer-2515"><span class="linenos">2515</span></a>                        <span class="n">points_owner_subject_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ChartDrawer-2516"><a href="#ChartDrawer-2516"><span class="linenos">2516</span></a>                        <span class="n">house_position_comparison_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;House Position Comparison&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2517"><a href="#ChartDrawer-2517"><span class="linenos">2517</span></a>                        <span class="n">return_point_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">natal_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2518"><a href="#ChartDrawer-2518"><span class="linenos">2518</span></a>                        <span class="n">return_label</span><span class="o">=</span><span class="n">natal_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2519"><a href="#ChartDrawer-2519"><span class="linenos">2519</span></a>                        <span class="n">radix_label</span><span class="o">=</span><span class="n">return_label_text</span><span class="p">,</span>
</span><span id="ChartDrawer-2520"><a href="#ChartDrawer-2520"><span class="linenos">2520</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="mi">1090</span><span class="p">,</span>
</span><span id="ChartDrawer-2521"><a href="#ChartDrawer-2521"><span class="linenos">2521</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2522"><a href="#ChartDrawer-2522"><span class="linenos">2522</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2523"><a href="#ChartDrawer-2523"><span class="linenos">2523</span></a>
</span><span id="ChartDrawer-2524"><a href="#ChartDrawer-2524"><span class="linenos">2524</span></a>                    <span class="n">second_house_grid</span> <span class="o">=</span> <span class="n">draw_house_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2525"><a href="#ChartDrawer-2525"><span class="linenos">2525</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2526"><a href="#ChartDrawer-2526"><span class="linenos">2526</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2527"><a href="#ChartDrawer-2527"><span class="linenos">2527</span></a>                        <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2528"><a href="#ChartDrawer-2528"><span class="linenos">2528</span></a>                        <span class="n">points_owner_subject_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ChartDrawer-2529"><a href="#ChartDrawer-2529"><span class="linenos">2529</span></a>                        <span class="n">house_position_comparison_label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2530"><a href="#ChartDrawer-2530"><span class="linenos">2530</span></a>                        <span class="n">return_point_label</span><span class="o">=</span><span class="n">point_column_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2531"><a href="#ChartDrawer-2531"><span class="linenos">2531</span></a>                        <span class="n">return_label</span><span class="o">=</span><span class="n">return_label_text</span><span class="p">,</span>
</span><span id="ChartDrawer-2532"><a href="#ChartDrawer-2532"><span class="linenos">2532</span></a>                        <span class="n">radix_label</span><span class="o">=</span><span class="n">natal_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2533"><a href="#ChartDrawer-2533"><span class="linenos">2533</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="mi">1290</span><span class="p">,</span>
</span><span id="ChartDrawer-2534"><a href="#ChartDrawer-2534"><span class="linenos">2534</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2535"><a href="#ChartDrawer-2535"><span class="linenos">2535</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2536"><a href="#ChartDrawer-2536"><span class="linenos">2536</span></a>
</span><span id="ChartDrawer-2537"><a href="#ChartDrawer-2537"><span class="linenos">2537</span></a>                    <span class="n">house_comparison_svg</span> <span class="o">=</span> <span class="n">first_house_grid</span> <span class="o">+</span> <span class="n">second_house_grid</span>
</span><span id="ChartDrawer-2538"><a href="#ChartDrawer-2538"><span class="linenos">2538</span></a>
</span><span id="ChartDrawer-2539"><a href="#ChartDrawer-2539"><span class="linenos">2539</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2540"><a href="#ChartDrawer-2540"><span class="linenos">2540</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span><span class="p">:</span>
</span><span id="ChartDrawer-2541"><a href="#ChartDrawer-2541"><span class="linenos">2541</span></a>                        <span class="c1"># Match the Synastry spacing: estimate widths to place cusp</span>
</span><span id="ChartDrawer-2542"><a href="#ChartDrawer-2542"><span class="linenos">2542</span></a>                        <span class="c1"># comparison grids immediately to the right of both house grids.</span>
</span><span id="ChartDrawer-2543"><a href="#ChartDrawer-2543"><span class="linenos">2543</span></a>                        <span class="n">first_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-2544"><a href="#ChartDrawer-2544"><span class="linenos">2544</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">natal_label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2545"><a href="#ChartDrawer-2545"><span class="linenos">2545</span></a>                            <span class="n">natal_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2546"><a href="#ChartDrawer-2546"><span class="linenos">2546</span></a>                            <span class="n">return_label_text</span><span class="p">,</span>
</span><span id="ChartDrawer-2547"><a href="#ChartDrawer-2547"><span class="linenos">2547</span></a>                        <span class="p">]</span>
</span><span id="ChartDrawer-2548"><a href="#ChartDrawer-2548"><span class="linenos">2548</span></a>                        <span class="n">second_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ChartDrawer-2549"><a href="#ChartDrawer-2549"><span class="linenos">2549</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">return_label_text</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_column_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2550"><a href="#ChartDrawer-2550"><span class="linenos">2550</span></a>                            <span class="n">return_label_text</span><span class="p">,</span>
</span><span id="ChartDrawer-2551"><a href="#ChartDrawer-2551"><span class="linenos">2551</span></a>                            <span class="n">natal_label</span><span class="p">,</span>
</span><span id="ChartDrawer-2552"><a href="#ChartDrawer-2552"><span class="linenos">2552</span></a>                        <span class="p">]</span>
</span><span id="ChartDrawer-2553"><a href="#ChartDrawer-2553"><span class="linenos">2553</span></a>
</span><span id="ChartDrawer-2554"><a href="#ChartDrawer-2554"><span class="linenos">2554</span></a>                        <span class="n">first_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-2555"><a href="#ChartDrawer-2555"><span class="linenos">2555</span></a>                            <span class="n">column_labels</span><span class="o">=</span><span class="n">first_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-2556"><a href="#ChartDrawer-2556"><span class="linenos">2556</span></a>                            <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-2557"><a href="#ChartDrawer-2557"><span class="linenos">2557</span></a>                            <span class="n">include_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-2558"><a href="#ChartDrawer-2558"><span class="linenos">2558</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-2559"><a href="#ChartDrawer-2559"><span class="linenos">2559</span></a>                        <span class="n">second_grid_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_house_comparison_grid_width</span><span class="p">(</span>
</span><span id="ChartDrawer-2560"><a href="#ChartDrawer-2560"><span class="linenos">2560</span></a>                            <span class="n">column_labels</span><span class="o">=</span><span class="n">second_columns</span><span class="p">,</span>
</span><span id="ChartDrawer-2561"><a href="#ChartDrawer-2561"><span class="linenos">2561</span></a>                            <span class="n">include_radix_column</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer-2562"><a href="#ChartDrawer-2562"><span class="linenos">2562</span></a>                            <span class="n">include_title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer-2563"><a href="#ChartDrawer-2563"><span class="linenos">2563</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-2564"><a href="#ChartDrawer-2564"><span class="linenos">2564</span></a>
</span><span id="ChartDrawer-2565"><a href="#ChartDrawer-2565"><span class="linenos">2565</span></a>                        <span class="n">first_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">first_grid_width</span>
</span><span id="ChartDrawer-2566"><a href="#ChartDrawer-2566"><span class="linenos">2566</span></a>                        <span class="n">second_house_comparison_grid_right</span> <span class="o">=</span> <span class="mi">1190</span> <span class="o">+</span> <span class="n">second_grid_width</span>
</span><span id="ChartDrawer-2567"><a href="#ChartDrawer-2567"><span class="linenos">2567</span></a>                        <span class="n">max_house_comparison_right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ChartDrawer-2568"><a href="#ChartDrawer-2568"><span class="linenos">2568</span></a>                            <span class="n">first_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-2569"><a href="#ChartDrawer-2569"><span class="linenos">2569</span></a>                            <span class="n">second_house_comparison_grid_right</span><span class="p">,</span>
</span><span id="ChartDrawer-2570"><a href="#ChartDrawer-2570"><span class="linenos">2570</span></a>                        <span class="p">)</span>
</span><span id="ChartDrawer-2571"><a href="#ChartDrawer-2571"><span class="linenos">2571</span></a>                        <span class="n">cusp_x_position</span> <span class="o">=</span> <span class="n">max_house_comparison_right</span> <span class="o">+</span> <span class="mf">50.0</span>
</span><span id="ChartDrawer-2572"><a href="#ChartDrawer-2572"><span class="linenos">2572</span></a>
</span><span id="ChartDrawer-2573"><a href="#ChartDrawer-2573"><span class="linenos">2573</span></a>                        <span class="n">cusp_grid_width</span> <span class="o">=</span> <span class="mf">160.0</span>
</span><span id="ChartDrawer-2574"><a href="#ChartDrawer-2574"><span class="linenos">2574</span></a>                        <span class="n">inter_cusp_gap</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="ChartDrawer-2575"><a href="#ChartDrawer-2575"><span class="linenos">2575</span></a>                        <span class="n">first_cusp_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cusp_x_position</span><span class="p">)</span>
</span><span id="ChartDrawer-2576"><a href="#ChartDrawer-2576"><span class="linenos">2576</span></a>                        <span class="n">second_cusp_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cusp_x_position</span> <span class="o">+</span> <span class="n">cusp_grid_width</span> <span class="o">+</span> <span class="n">inter_cusp_gap</span><span class="p">)</span>
</span><span id="ChartDrawer-2577"><a href="#ChartDrawer-2577"><span class="linenos">2577</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2578"><a href="#ChartDrawer-2578"><span class="linenos">2578</span></a>                        <span class="c1"># Cusp-only layout: reuse the house comparison slots at x=1090 and x=1290.</span>
</span><span id="ChartDrawer-2579"><a href="#ChartDrawer-2579"><span class="linenos">2579</span></a>                        <span class="n">first_cusp_x</span> <span class="o">=</span> <span class="mi">1090</span>
</span><span id="ChartDrawer-2580"><a href="#ChartDrawer-2580"><span class="linenos">2580</span></a>                        <span class="n">second_cusp_x</span> <span class="o">=</span> <span class="mi">1290</span>
</span><span id="ChartDrawer-2581"><a href="#ChartDrawer-2581"><span class="linenos">2581</span></a>
</span><span id="ChartDrawer-2582"><a href="#ChartDrawer-2582"><span class="linenos">2582</span></a>                    <span class="n">first_cusp_grid</span> <span class="o">=</span> <span class="n">draw_cusp_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2583"><a href="#ChartDrawer-2583"><span class="linenos">2583</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2584"><a href="#ChartDrawer-2584"><span class="linenos">2584</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2585"><a href="#ChartDrawer-2585"><span class="linenos">2585</span></a>                        <span class="n">cusps_owner_subject_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ChartDrawer-2586"><a href="#ChartDrawer-2586"><span class="linenos">2586</span></a>                        <span class="n">cusp_position_comparison_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp_position_comparison&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp Position Comparison&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2587"><a href="#ChartDrawer-2587"><span class="linenos">2587</span></a>                        <span class="n">owner_cusp_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">natal_label</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2588"><a href="#ChartDrawer-2588"><span class="linenos">2588</span></a>                        <span class="n">projected_house_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;Return&quot;</span><span class="p">,</span> <span class="s2">&quot;Return&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house&quot;</span><span class="p">,</span> <span class="s2">&quot;House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2589"><a href="#ChartDrawer-2589"><span class="linenos">2589</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="n">first_cusp_x</span><span class="p">,</span>
</span><span id="ChartDrawer-2590"><a href="#ChartDrawer-2590"><span class="linenos">2590</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2591"><a href="#ChartDrawer-2591"><span class="linenos">2591</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2592"><a href="#ChartDrawer-2592"><span class="linenos">2592</span></a>
</span><span id="ChartDrawer-2593"><a href="#ChartDrawer-2593"><span class="linenos">2593</span></a>                    <span class="n">second_cusp_grid</span> <span class="o">=</span> <span class="n">draw_cusp_comparison_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2594"><a href="#ChartDrawer-2594"><span class="linenos">2594</span></a>                        <span class="n">house_comparison</span><span class="p">,</span>
</span><span id="ChartDrawer-2595"><a href="#ChartDrawer-2595"><span class="linenos">2595</span></a>                        <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2596"><a href="#ChartDrawer-2596"><span class="linenos">2596</span></a>                        <span class="n">cusps_owner_subject_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="ChartDrawer-2597"><a href="#ChartDrawer-2597"><span class="linenos">2597</span></a>                        <span class="n">cusp_position_comparison_label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2598"><a href="#ChartDrawer-2598"><span class="linenos">2598</span></a>                        <span class="n">owner_cusp_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;return_cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Return Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2599"><a href="#ChartDrawer-2599"><span class="linenos">2599</span></a>                        <span class="n">projected_house_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">natal_label</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;house&quot;</span><span class="p">,</span> <span class="s2">&quot;House&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2600"><a href="#ChartDrawer-2600"><span class="linenos">2600</span></a>                        <span class="n">x_position</span><span class="o">=</span><span class="n">second_cusp_x</span><span class="p">,</span>
</span><span id="ChartDrawer-2601"><a href="#ChartDrawer-2601"><span class="linenos">2601</span></a>                        <span class="n">y_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ChartDrawer-2602"><a href="#ChartDrawer-2602"><span class="linenos">2602</span></a>                    <span class="p">)</span>
</span><span id="ChartDrawer-2603"><a href="#ChartDrawer-2603"><span class="linenos">2603</span></a>
</span><span id="ChartDrawer-2604"><a href="#ChartDrawer-2604"><span class="linenos">2604</span></a>                    <span class="n">house_comparison_svg</span> <span class="o">+=</span> <span class="n">first_cusp_grid</span> <span class="o">+</span> <span class="n">second_cusp_grid</span>
</span><span id="ChartDrawer-2605"><a href="#ChartDrawer-2605"><span class="linenos">2605</span></a>
</span><span id="ChartDrawer-2606"><a href="#ChartDrawer-2606"><span class="linenos">2606</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">house_comparison_svg</span>
</span><span id="ChartDrawer-2607"><a href="#ChartDrawer-2607"><span class="linenos">2607</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2608"><a href="#ChartDrawer-2608"><span class="linenos">2608</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2609"><a href="#ChartDrawer-2609"><span class="linenos">2609</span></a>
</span><span id="ChartDrawer-2610"><a href="#ChartDrawer-2610"><span class="linenos">2610</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2611"><a href="#ChartDrawer-2611"><span class="linenos">2611</span></a>            <span class="c1"># Set viewbox dynamically</span>
</span><span id="ChartDrawer-2612"><a href="#ChartDrawer-2612"><span class="linenos">2612</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;viewbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-2613"><a href="#ChartDrawer-2613"><span class="linenos">2613</span></a>
</span><span id="ChartDrawer-2614"><a href="#ChartDrawer-2614"><span class="linenos">2614</span></a>            <span class="c1"># Rings and circles</span>
</span><span id="ChartDrawer-2615"><a href="#ChartDrawer-2615"><span class="linenos">2615</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;transitRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2616"><a href="#ChartDrawer-2616"><span class="linenos">2616</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;degreeRing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_degree_ring</span><span class="p">(</span>
</span><span id="ChartDrawer-2617"><a href="#ChartDrawer-2617"><span class="linenos">2617</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2618"><a href="#ChartDrawer-2618"><span class="linenos">2618</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2619"><a href="#ChartDrawer-2619"><span class="linenos">2619</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2620"><a href="#ChartDrawer-2620"><span class="linenos">2620</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2621"><a href="#ChartDrawer-2621"><span class="linenos">2621</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2622"><a href="#ChartDrawer-2622"><span class="linenos">2622</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;background_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_background_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2623"><a href="#ChartDrawer-2623"><span class="linenos">2623</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2624"><a href="#ChartDrawer-2624"><span class="linenos">2624</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2625"><a href="#ChartDrawer-2625"><span class="linenos">2625</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2626"><a href="#ChartDrawer-2626"><span class="linenos">2626</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2627"><a href="#ChartDrawer-2627"><span class="linenos">2627</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;first_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_first_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2628"><a href="#ChartDrawer-2628"><span class="linenos">2628</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2629"><a href="#ChartDrawer-2629"><span class="linenos">2629</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_2&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2630"><a href="#ChartDrawer-2630"><span class="linenos">2630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2631"><a href="#ChartDrawer-2631"><span class="linenos">2631</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2632"><a href="#ChartDrawer-2632"><span class="linenos">2632</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2633"><a href="#ChartDrawer-2633"><span class="linenos">2633</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;second_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_second_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2634"><a href="#ChartDrawer-2634"><span class="linenos">2634</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2635"><a href="#ChartDrawer-2635"><span class="linenos">2635</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2636"><a href="#ChartDrawer-2636"><span class="linenos">2636</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2637"><a href="#ChartDrawer-2637"><span class="linenos">2637</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2638"><a href="#ChartDrawer-2638"><span class="linenos">2638</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2639"><a href="#ChartDrawer-2639"><span class="linenos">2639</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2640"><a href="#ChartDrawer-2640"><span class="linenos">2640</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;third_circle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_third_circle</span><span class="p">(</span>
</span><span id="ChartDrawer-2641"><a href="#ChartDrawer-2641"><span class="linenos">2641</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2642"><a href="#ChartDrawer-2642"><span class="linenos">2642</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;zodiac_radix_ring_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2643"><a href="#ChartDrawer-2643"><span class="linenos">2643</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_1&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2644"><a href="#ChartDrawer-2644"><span class="linenos">2644</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2645"><a href="#ChartDrawer-2645"><span class="linenos">2645</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2646"><a href="#ChartDrawer-2646"><span class="linenos">2646</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2647"><a href="#ChartDrawer-2647"><span class="linenos">2647</span></a>
</span><span id="ChartDrawer-2648"><a href="#ChartDrawer-2648"><span class="linenos">2648</span></a>            <span class="c1"># Aspects</span>
</span><span id="ChartDrawer-2649"><a href="#ChartDrawer-2649"><span class="linenos">2649</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeDoubleChartAspectList&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2650"><a href="#ChartDrawer-2650"><span class="linenos">2650</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2651"><a href="#ChartDrawer-2651"><span class="linenos">2651</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2652"><a href="#ChartDrawer-2652"><span class="linenos">2652</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2653"><a href="#ChartDrawer-2653"><span class="linenos">2653</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2654"><a href="#ChartDrawer-2654"><span class="linenos">2654</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2655"><a href="#ChartDrawer-2655"><span class="linenos">2655</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeAspects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_all_aspects_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">)</span>
</span><span id="ChartDrawer-2656"><a href="#ChartDrawer-2656"><span class="linenos">2656</span></a>
</span><span id="ChartDrawer-2657"><a href="#ChartDrawer-2657"><span class="linenos">2657</span></a>            <span class="c1"># Top left section</span>
</span><span id="ChartDrawer-2658"><a href="#ChartDrawer-2658"><span class="linenos">2658</span></a>            <span class="n">latitude_string</span> <span class="o">=</span> <span class="n">convert_latitude_coordinate_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;North&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;south&quot;</span><span class="p">,</span> <span class="s2">&quot;South&quot;</span><span class="p">))</span>
</span><span id="ChartDrawer-2659"><a href="#ChartDrawer-2659"><span class="linenos">2659</span></a>            <span class="n">longitude_string</span> <span class="o">=</span> <span class="n">convert_longitude_coordinate_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geolon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;East&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;west&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">))</span>
</span><span id="ChartDrawer-2660"><a href="#ChartDrawer-2660"><span class="linenos">2660</span></a>
</span><span id="ChartDrawer-2661"><a href="#ChartDrawer-2661"><span class="linenos">2661</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Info&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">:&#39;</span>
</span><span id="ChartDrawer-2662"><a href="#ChartDrawer-2662"><span class="linenos">2662</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_datetime_with_timezone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2663"><a href="#ChartDrawer-2663"><span class="linenos">2663</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">nation</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2664"><a href="#ChartDrawer-2664"><span class="linenos">2664</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">latitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2665"><a href="#ChartDrawer-2665"><span class="linenos">2665</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">longitude_string</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2666"><a href="#ChartDrawer-2666"><span class="linenos">2666</span></a>
</span><span id="ChartDrawer-2667"><a href="#ChartDrawer-2667"><span class="linenos">2667</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2668"><a href="#ChartDrawer-2668"><span class="linenos">2668</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;solar_return&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Solar Return&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2669"><a href="#ChartDrawer-2669"><span class="linenos">2669</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2670"><a href="#ChartDrawer-2670"><span class="linenos">2670</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;top_left_5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Type&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;lunar_return&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Lunar Return&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2671"><a href="#ChartDrawer-2671"><span class="linenos">2671</span></a>
</span><span id="ChartDrawer-2672"><a href="#ChartDrawer-2672"><span class="linenos">2672</span></a>            <span class="c1"># Bottom left section</span>
</span><span id="ChartDrawer-2673"><a href="#ChartDrawer-2673"><span class="linenos">2673</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">==</span> <span class="s2">&quot;Tropical&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2674"><a href="#ChartDrawer-2674"><span class="linenos">2674</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;zodiac&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Zodiac&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;tropical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Tropical&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2675"><a href="#ChartDrawer-2675"><span class="linenos">2675</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2676"><a href="#ChartDrawer-2676"><span class="linenos">2676</span></a>                <span class="n">mode_const</span> <span class="o">=</span> <span class="s2">&quot;SIDM_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="c1"># type: ignore</span>
</span><span id="ChartDrawer-2677"><a href="#ChartDrawer-2677"><span class="linenos">2677</span></a>                <span class="n">mode_name</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">get_ayanamsa_name</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">swe</span><span class="p">,</span> <span class="n">mode_const</span><span class="p">))</span>
</span><span id="ChartDrawer-2678"><a href="#ChartDrawer-2678"><span class="linenos">2678</span></a>                <span class="n">zodiac_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;ayanamsa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ayanamsa&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mode_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2679"><a href="#ChartDrawer-2679"><span class="linenos">2679</span></a>
</span><span id="ChartDrawer-2680"><a href="#ChartDrawer-2680"><span class="linenos">2680</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zodiac_info</span>
</span><span id="ChartDrawer-2681"><a href="#ChartDrawer-2681"><span class="linenos">2681</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses_system_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s1">&#39;houses&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Houses&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ChartDrawer-2682"><a href="#ChartDrawer-2682"><span class="linenos">2682</span></a>
</span><span id="ChartDrawer-2683"><a href="#ChartDrawer-2683"><span class="linenos">2683</span></a>            <span class="c1"># Lunar phase information (optional)</span>
</span><span id="ChartDrawer-2684"><a href="#ChartDrawer-2684"><span class="linenos">2684</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2685"><a href="#ChartDrawer-2685"><span class="linenos">2685</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunation_day&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunation Day&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;moon_phase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2686"><a href="#ChartDrawer-2686"><span class="linenos">2686</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;lunar_phase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lunar Phase&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2687"><a href="#ChartDrawer-2687"><span class="linenos">2687</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2688"><a href="#ChartDrawer-2688"><span class="linenos">2688</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2689"><a href="#ChartDrawer-2689"><span class="linenos">2689</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2690"><a href="#ChartDrawer-2690"><span class="linenos">2690</span></a>
</span><span id="ChartDrawer-2691"><a href="#ChartDrawer-2691"><span class="linenos">2691</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;bottom_left_4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;perspective_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Perspective&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ChartDrawer-2692"><a href="#ChartDrawer-2692"><span class="linenos">2692</span></a>
</span><span id="ChartDrawer-2693"><a href="#ChartDrawer-2693"><span class="linenos">2693</span></a>            <span class="c1"># Moon phase section calculations</span>
</span><span id="ChartDrawer-2694"><a href="#ChartDrawer-2694"><span class="linenos">2694</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2695"><a href="#ChartDrawer-2695"><span class="linenos">2695</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">makeLunarPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">lunar_phase</span><span class="p">[</span><span class="s2">&quot;degrees_between_s_m&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">)</span>
</span><span id="ChartDrawer-2696"><a href="#ChartDrawer-2696"><span class="linenos">2696</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2697"><a href="#ChartDrawer-2697"><span class="linenos">2697</span></a>                <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeLunarPhase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2698"><a href="#ChartDrawer-2698"><span class="linenos">2698</span></a>
</span><span id="ChartDrawer-2699"><a href="#ChartDrawer-2699"><span class="linenos">2699</span></a>            <span class="c1"># Houses and planet drawing</span>
</span><span id="ChartDrawer-2700"><a href="#ChartDrawer-2700"><span class="linenos">2700</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_house_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2701"><a href="#ChartDrawer-2701"><span class="linenos">2701</span></a>                <span class="n">main_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2702"><a href="#ChartDrawer-2702"><span class="linenos">2702</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2703"><a href="#ChartDrawer-2703"><span class="linenos">2703</span></a>                <span class="n">house_cusp_generale_name_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;cusp&quot;</span><span class="p">,</span> <span class="s2">&quot;Cusp&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2704"><a href="#ChartDrawer-2704"><span class="linenos">2704</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2705"><a href="#ChartDrawer-2705"><span class="linenos">2705</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryHousesGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2706"><a href="#ChartDrawer-2706"><span class="linenos">2706</span></a>
</span><span id="ChartDrawer-2707"><a href="#ChartDrawer-2707"><span class="linenos">2707</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_houses_cusps_and_text_number</span><span class="p">(</span>
</span><span id="ChartDrawer-2708"><a href="#ChartDrawer-2708"><span class="linenos">2708</span></a>                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2709"><a href="#ChartDrawer-2709"><span class="linenos">2709</span></a>                <span class="n">first_subject_houses_list</span><span class="o">=</span><span class="n">first_subject_houses_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2710"><a href="#ChartDrawer-2710"><span class="linenos">2710</span></a>                <span class="n">standard_house_cusp_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;houses_radix_line&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2711"><a href="#ChartDrawer-2711"><span class="linenos">2711</span></a>                <span class="n">first_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2712"><a href="#ChartDrawer-2712"><span class="linenos">2712</span></a>                <span class="n">tenth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2713"><a href="#ChartDrawer-2713"><span class="linenos">2713</span></a>                <span class="n">seventh_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">14</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2714"><a href="#ChartDrawer-2714"><span class="linenos">2714</span></a>                <span class="n">fourth_house_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">[</span><span class="mi">15</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2715"><a href="#ChartDrawer-2715"><span class="linenos">2715</span></a>                <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2716"><a href="#ChartDrawer-2716"><span class="linenos">2716</span></a>                <span class="n">c3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2717"><a href="#ChartDrawer-2717"><span class="linenos">2717</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2718"><a href="#ChartDrawer-2718"><span class="linenos">2718</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-2719"><a href="#ChartDrawer-2719"><span class="linenos">2719</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2720"><a href="#ChartDrawer-2720"><span class="linenos">2720</span></a>
</span><span id="ChartDrawer-2721"><a href="#ChartDrawer-2721"><span class="linenos">2721</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makePlanets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_planets</span><span class="p">(</span>
</span><span id="ChartDrawer-2722"><a href="#ChartDrawer-2722"><span class="linenos">2722</span></a>                <span class="n">available_planets_setting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2723"><a href="#ChartDrawer-2723"><span class="linenos">2723</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2724"><a href="#ChartDrawer-2724"><span class="linenos">2724</span></a>                <span class="n">radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2725"><a href="#ChartDrawer-2725"><span class="linenos">2725</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2726"><a href="#ChartDrawer-2726"><span class="linenos">2726</span></a>                <span class="n">third_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2727"><a href="#ChartDrawer-2727"><span class="linenos">2727</span></a>                <span class="n">main_subject_first_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">first_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2728"><a href="#ChartDrawer-2728"><span class="linenos">2728</span></a>                <span class="n">main_subject_seventh_house_degree_ut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">seventh_house</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="ChartDrawer-2729"><a href="#ChartDrawer-2729"><span class="linenos">2729</span></a>                <span class="n">external_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="ChartDrawer-2730"><a href="#ChartDrawer-2730"><span class="linenos">2730</span></a>                <span class="n">first_circle_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span><span class="p">,</span>
</span><span id="ChartDrawer-2731"><a href="#ChartDrawer-2731"><span class="linenos">2731</span></a>                <span class="n">show_degree_indicators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span><span class="p">,</span>
</span><span id="ChartDrawer-2732"><a href="#ChartDrawer-2732"><span class="linenos">2732</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2733"><a href="#ChartDrawer-2733"><span class="linenos">2733</span></a>
</span><span id="ChartDrawer-2734"><a href="#ChartDrawer-2734"><span class="linenos">2734</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeMainPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_main_planet_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2735"><a href="#ChartDrawer-2735"><span class="linenos">2735</span></a>                <span class="n">planets_and_houses_grid_title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="s2">&quot;planets_and_house&quot;</span><span class="p">,</span> <span class="s2">&quot;Points for&quot;</span><span class="p">),</span>
</span><span id="ChartDrawer-2736"><a href="#ChartDrawer-2736"><span class="linenos">2736</span></a>                <span class="n">subject_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="ChartDrawer-2737"><a href="#ChartDrawer-2737"><span class="linenos">2737</span></a>                <span class="n">available_kerykeion_celestial_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2738"><a href="#ChartDrawer-2738"><span class="linenos">2738</span></a>                <span class="n">chart_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">,</span>
</span><span id="ChartDrawer-2739"><a href="#ChartDrawer-2739"><span class="linenos">2739</span></a>                <span class="n">text_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2740"><a href="#ChartDrawer-2740"><span class="linenos">2740</span></a>                <span class="n">celestial_point_language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_language_model</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">,</span>
</span><span id="ChartDrawer-2741"><a href="#ChartDrawer-2741"><span class="linenos">2741</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2742"><a href="#ChartDrawer-2742"><span class="linenos">2742</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeSecondaryPlanetGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2743"><a href="#ChartDrawer-2743"><span class="linenos">2743</span></a>            <span class="n">template_dict</span><span class="p">[</span><span class="s2">&quot;makeHouseComparisonGrid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer-2744"><a href="#ChartDrawer-2744"><span class="linenos">2744</span></a>
</span><span id="ChartDrawer-2745"><a href="#ChartDrawer-2745"><span class="linenos">2745</span></a>        <span class="k">return</span> <span class="n">ChartTemplateModel</span><span class="p">(</span><span class="o">**</span><span class="n">template_dict</span><span class="p">)</span>
</span><span id="ChartDrawer-2746"><a href="#ChartDrawer-2746"><span class="linenos">2746</span></a>
</span><span id="ChartDrawer-2747"><a href="#ChartDrawer-2747"><span class="linenos">2747</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_svg_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer-2748"><a href="#ChartDrawer-2748"><span class="linenos">2748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2749"><a href="#ChartDrawer-2749"><span class="linenos">2749</span></a><span class="sd">        Render the full chart SVG as a string.</span>
</span><span id="ChartDrawer-2750"><a href="#ChartDrawer-2750"><span class="linenos">2750</span></a>
</span><span id="ChartDrawer-2751"><a href="#ChartDrawer-2751"><span class="linenos">2751</span></a><span class="sd">        Reads the XML template, substitutes variables, and optionally inlines CSS</span>
</span><span id="ChartDrawer-2752"><a href="#ChartDrawer-2752"><span class="linenos">2752</span></a><span class="sd">        variables and minifies the output.</span>
</span><span id="ChartDrawer-2753"><a href="#ChartDrawer-2753"><span class="linenos">2753</span></a>
</span><span id="ChartDrawer-2754"><a href="#ChartDrawer-2754"><span class="linenos">2754</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-2755"><a href="#ChartDrawer-2755"><span class="linenos">2755</span></a><span class="sd">            minify (bool): Remove whitespace and quotes for compactness.</span>
</span><span id="ChartDrawer-2756"><a href="#ChartDrawer-2756"><span class="linenos">2756</span></a><span class="sd">            remove_css_variables (bool): Embed CSS variable definitions.</span>
</span><span id="ChartDrawer-2757"><a href="#ChartDrawer-2757"><span class="linenos">2757</span></a><span class="sd">            custom_title (str or None): Optional override for the SVG title.</span>
</span><span id="ChartDrawer-2758"><a href="#ChartDrawer-2758"><span class="linenos">2758</span></a>
</span><span id="ChartDrawer-2759"><a href="#ChartDrawer-2759"><span class="linenos">2759</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-2760"><a href="#ChartDrawer-2760"><span class="linenos">2760</span></a><span class="sd">            str: SVG markup as a string.</span>
</span><span id="ChartDrawer-2761"><a href="#ChartDrawer-2761"><span class="linenos">2761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2762"><a href="#ChartDrawer-2762"><span class="linenos">2762</span></a>        <span class="n">td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dictionary</span><span class="p">(</span><span class="n">custom_title</span><span class="o">=</span><span class="n">custom_title</span><span class="p">)</span>
</span><span id="ChartDrawer-2763"><a href="#ChartDrawer-2763"><span class="linenos">2763</span></a>
</span><span id="ChartDrawer-2764"><a href="#ChartDrawer-2764"><span class="linenos">2764</span></a>        <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
</span><span id="ChartDrawer-2765"><a href="#ChartDrawer-2765"><span class="linenos">2765</span></a>        <span class="n">xml_svg</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;chart.xml&quot;</span>
</span><span id="ChartDrawer-2766"><a href="#ChartDrawer-2766"><span class="linenos">2766</span></a>
</span><span id="ChartDrawer-2767"><a href="#ChartDrawer-2767"><span class="linenos">2767</span></a>        <span class="c1"># read template</span>
</span><span id="ChartDrawer-2768"><a href="#ChartDrawer-2768"><span class="linenos">2768</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xml_svg</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer-2769"><a href="#ChartDrawer-2769"><span class="linenos">2769</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
</span><span id="ChartDrawer-2770"><a href="#ChartDrawer-2770"><span class="linenos">2770</span></a>
</span><span id="ChartDrawer-2771"><a href="#ChartDrawer-2771"><span class="linenos">2771</span></a>        <span class="c1"># return filename</span>
</span><span id="ChartDrawer-2772"><a href="#ChartDrawer-2772"><span class="linenos">2772</span></a>
</span><span id="ChartDrawer-2773"><a href="#ChartDrawer-2773"><span class="linenos">2773</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Template dictionary includes </span><span class="si">%s</span><span class="s2"> fields&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()))</span>
</span><span id="ChartDrawer-2774"><a href="#ChartDrawer-2774"><span class="linenos">2774</span></a>
</span><span id="ChartDrawer-2775"><a href="#ChartDrawer-2775"><span class="linenos">2775</span></a>        <span class="k">if</span> <span class="n">remove_css_variables</span><span class="p">:</span>
</span><span id="ChartDrawer-2776"><a href="#ChartDrawer-2776"><span class="linenos">2776</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">inline_css_variables_in_svg</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer-2777"><a href="#ChartDrawer-2777"><span class="linenos">2777</span></a>
</span><span id="ChartDrawer-2778"><a href="#ChartDrawer-2778"><span class="linenos">2778</span></a>        <span class="k">if</span> <span class="n">minify</span><span class="p">:</span>
</span><span id="ChartDrawer-2779"><a href="#ChartDrawer-2779"><span class="linenos">2779</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">scourString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2780"><a href="#ChartDrawer-2780"><span class="linenos">2780</span></a>
</span><span id="ChartDrawer-2781"><a href="#ChartDrawer-2781"><span class="linenos">2781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2782"><a href="#ChartDrawer-2782"><span class="linenos">2782</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2783"><a href="#ChartDrawer-2783"><span class="linenos">2783</span></a>
</span><span id="ChartDrawer-2784"><a href="#ChartDrawer-2784"><span class="linenos">2784</span></a>        <span class="k">return</span> <span class="n">template</span>
</span><span id="ChartDrawer-2785"><a href="#ChartDrawer-2785"><span class="linenos">2785</span></a>
</span><span id="ChartDrawer-2786"><a href="#ChartDrawer-2786"><span class="linenos">2786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_svg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ChartDrawer-2787"><a href="#ChartDrawer-2787"><span class="linenos">2787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2788"><a href="#ChartDrawer-2788"><span class="linenos">2788</span></a><span class="sd">        Generate and save the full chart SVG to disk.</span>
</span><span id="ChartDrawer-2789"><a href="#ChartDrawer-2789"><span class="linenos">2789</span></a>
</span><span id="ChartDrawer-2790"><a href="#ChartDrawer-2790"><span class="linenos">2790</span></a><span class="sd">        Calls generate_svg_string to render the SVG, then writes a file named</span>
</span><span id="ChartDrawer-2791"><a href="#ChartDrawer-2791"><span class="linenos">2791</span></a><span class="sd">        &quot;{subject.name} - {chart_type} Chart.svg&quot; in the specified output directory.</span>
</span><span id="ChartDrawer-2792"><a href="#ChartDrawer-2792"><span class="linenos">2792</span></a>
</span><span id="ChartDrawer-2793"><a href="#ChartDrawer-2793"><span class="linenos">2793</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-2794"><a href="#ChartDrawer-2794"><span class="linenos">2794</span></a><span class="sd">            output_path (str, Path, or None): Directory path where the SVG file will be saved.</span>
</span><span id="ChartDrawer-2795"><a href="#ChartDrawer-2795"><span class="linenos">2795</span></a><span class="sd">                If None, defaults to the user&#39;s home directory.</span>
</span><span id="ChartDrawer-2796"><a href="#ChartDrawer-2796"><span class="linenos">2796</span></a><span class="sd">            filename (str or None): Custom filename for the SVG file (without extension).</span>
</span><span id="ChartDrawer-2797"><a href="#ChartDrawer-2797"><span class="linenos">2797</span></a><span class="sd">                If None, uses the default pattern: &quot;{subject.name} - {chart_type} Chart&quot;.</span>
</span><span id="ChartDrawer-2798"><a href="#ChartDrawer-2798"><span class="linenos">2798</span></a><span class="sd">            minify (bool): Pass-through to generate_svg_string for compact output.</span>
</span><span id="ChartDrawer-2799"><a href="#ChartDrawer-2799"><span class="linenos">2799</span></a><span class="sd">            remove_css_variables (bool): Pass-through to generate_svg_string to embed CSS variables.</span>
</span><span id="ChartDrawer-2800"><a href="#ChartDrawer-2800"><span class="linenos">2800</span></a><span class="sd">            custom_title (str or None): Optional override for the SVG title.</span>
</span><span id="ChartDrawer-2801"><a href="#ChartDrawer-2801"><span class="linenos">2801</span></a>
</span><span id="ChartDrawer-2802"><a href="#ChartDrawer-2802"><span class="linenos">2802</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-2803"><a href="#ChartDrawer-2803"><span class="linenos">2803</span></a><span class="sd">            None</span>
</span><span id="ChartDrawer-2804"><a href="#ChartDrawer-2804"><span class="linenos">2804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2805"><a href="#ChartDrawer-2805"><span class="linenos">2805</span></a>
</span><span id="ChartDrawer-2806"><a href="#ChartDrawer-2806"><span class="linenos">2806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">,</span> <span class="n">custom_title</span><span class="o">=</span><span class="n">custom_title</span><span class="p">)</span>
</span><span id="ChartDrawer-2807"><a href="#ChartDrawer-2807"><span class="linenos">2807</span></a>
</span><span id="ChartDrawer-2808"><a href="#ChartDrawer-2808"><span class="linenos">2808</span></a>        <span class="c1"># Convert output_path to Path object, default to home directory</span>
</span><span id="ChartDrawer-2809"><a href="#ChartDrawer-2809"><span class="linenos">2809</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="ChartDrawer-2810"><a href="#ChartDrawer-2810"><span class="linenos">2810</span></a>
</span><span id="ChartDrawer-2811"><a href="#ChartDrawer-2811"><span class="linenos">2811</span></a>        <span class="c1"># Determine filename</span>
</span><span id="ChartDrawer-2812"><a href="#ChartDrawer-2812"><span class="linenos">2812</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2813"><a href="#ChartDrawer-2813"><span class="linenos">2813</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.svg&quot;</span>
</span><span id="ChartDrawer-2814"><a href="#ChartDrawer-2814"><span class="linenos">2814</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2815"><a href="#ChartDrawer-2815"><span class="linenos">2815</span></a>            <span class="c1"># Use default filename pattern</span>
</span><span id="ChartDrawer-2816"><a href="#ChartDrawer-2816"><span class="linenos">2816</span></a>            <span class="n">chart_type_for_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer-2817"><a href="#ChartDrawer-2817"><span class="linenos">2817</span></a>
</span><span id="ChartDrawer-2818"><a href="#ChartDrawer-2818"><span class="linenos">2818</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Lunar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2819"><a href="#ChartDrawer-2819"><span class="linenos">2819</span></a>                <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Lunar Return.svg&quot;</span>
</span><span id="ChartDrawer-2820"><a href="#ChartDrawer-2820"><span class="linenos">2820</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer-2821"><a href="#ChartDrawer-2821"><span class="linenos">2821</span></a>                <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Solar Return.svg&quot;</span>
</span><span id="ChartDrawer-2822"><a href="#ChartDrawer-2822"><span class="linenos">2822</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2823"><a href="#ChartDrawer-2823"><span class="linenos">2823</span></a>                <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart.svg&quot;</span>
</span><span id="ChartDrawer-2824"><a href="#ChartDrawer-2824"><span class="linenos">2824</span></a>
</span><span id="ChartDrawer-2825"><a href="#ChartDrawer-2825"><span class="linenos">2825</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chartname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
</span><span id="ChartDrawer-2826"><a href="#ChartDrawer-2826"><span class="linenos">2826</span></a>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer-2827"><a href="#ChartDrawer-2827"><span class="linenos">2827</span></a>
</span><span id="ChartDrawer-2828"><a href="#ChartDrawer-2828"><span class="linenos">2828</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG Generated Correctly in: </span><span class="si">{</span><span class="n">chartname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2829"><a href="#ChartDrawer-2829"><span class="linenos">2829</span></a>
</span><span id="ChartDrawer-2830"><a href="#ChartDrawer-2830"><span class="linenos">2830</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_wheel_only_svg_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer-2831"><a href="#ChartDrawer-2831"><span class="linenos">2831</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2832"><a href="#ChartDrawer-2832"><span class="linenos">2832</span></a><span class="sd">        Render the wheel-only chart SVG as a string.</span>
</span><span id="ChartDrawer-2833"><a href="#ChartDrawer-2833"><span class="linenos">2833</span></a>
</span><span id="ChartDrawer-2834"><a href="#ChartDrawer-2834"><span class="linenos">2834</span></a><span class="sd">        Reads the wheel-only XML template, substitutes chart data, and applies optional</span>
</span><span id="ChartDrawer-2835"><a href="#ChartDrawer-2835"><span class="linenos">2835</span></a><span class="sd">        CSS inlining and minification.</span>
</span><span id="ChartDrawer-2836"><a href="#ChartDrawer-2836"><span class="linenos">2836</span></a>
</span><span id="ChartDrawer-2837"><a href="#ChartDrawer-2837"><span class="linenos">2837</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-2838"><a href="#ChartDrawer-2838"><span class="linenos">2838</span></a><span class="sd">            minify (bool): Remove whitespace and quotes for compactness.</span>
</span><span id="ChartDrawer-2839"><a href="#ChartDrawer-2839"><span class="linenos">2839</span></a><span class="sd">            remove_css_variables (bool): Embed CSS variable definitions.</span>
</span><span id="ChartDrawer-2840"><a href="#ChartDrawer-2840"><span class="linenos">2840</span></a>
</span><span id="ChartDrawer-2841"><a href="#ChartDrawer-2841"><span class="linenos">2841</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-2842"><a href="#ChartDrawer-2842"><span class="linenos">2842</span></a><span class="sd">            str: SVG markup for the chart wheel only.</span>
</span><span id="ChartDrawer-2843"><a href="#ChartDrawer-2843"><span class="linenos">2843</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2844"><a href="#ChartDrawer-2844"><span class="linenos">2844</span></a>
</span><span id="ChartDrawer-2845"><a href="#ChartDrawer-2845"><span class="linenos">2845</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="ChartDrawer-2846"><a href="#ChartDrawer-2846"><span class="linenos">2846</span></a>            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;wheel_only.xml&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2847"><a href="#ChartDrawer-2847"><span class="linenos">2847</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2848"><a href="#ChartDrawer-2848"><span class="linenos">2848</span></a>            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2849"><a href="#ChartDrawer-2849"><span class="linenos">2849</span></a>            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2850"><a href="#ChartDrawer-2850"><span class="linenos">2850</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer-2851"><a href="#ChartDrawer-2851"><span class="linenos">2851</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ChartDrawer-2852"><a href="#ChartDrawer-2852"><span class="linenos">2852</span></a>
</span><span id="ChartDrawer-2853"><a href="#ChartDrawer-2853"><span class="linenos">2853</span></a>        <span class="n">template_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dictionary</span><span class="p">()</span>
</span><span id="ChartDrawer-2854"><a href="#ChartDrawer-2854"><span class="linenos">2854</span></a>        <span class="c1"># Use a compact viewBox specific for the wheel-only rendering</span>
</span><span id="ChartDrawer-2855"><a href="#ChartDrawer-2855"><span class="linenos">2855</span></a>        <span class="n">wheel_viewbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wheel_only_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-2856"><a href="#ChartDrawer-2856"><span class="linenos">2856</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">({</span><span class="o">**</span><span class="n">template_dict</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="s2">&quot;viewbox&quot;</span><span class="p">:</span> <span class="n">wheel_viewbox</span><span class="p">})</span>
</span><span id="ChartDrawer-2857"><a href="#ChartDrawer-2857"><span class="linenos">2857</span></a>
</span><span id="ChartDrawer-2858"><a href="#ChartDrawer-2858"><span class="linenos">2858</span></a>        <span class="k">if</span> <span class="n">remove_css_variables</span><span class="p">:</span>
</span><span id="ChartDrawer-2859"><a href="#ChartDrawer-2859"><span class="linenos">2859</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">inline_css_variables_in_svg</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer-2860"><a href="#ChartDrawer-2860"><span class="linenos">2860</span></a>
</span><span id="ChartDrawer-2861"><a href="#ChartDrawer-2861"><span class="linenos">2861</span></a>        <span class="k">if</span> <span class="n">minify</span><span class="p">:</span>
</span><span id="ChartDrawer-2862"><a href="#ChartDrawer-2862"><span class="linenos">2862</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">scourString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2863"><a href="#ChartDrawer-2863"><span class="linenos">2863</span></a>
</span><span id="ChartDrawer-2864"><a href="#ChartDrawer-2864"><span class="linenos">2864</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2865"><a href="#ChartDrawer-2865"><span class="linenos">2865</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2866"><a href="#ChartDrawer-2866"><span class="linenos">2866</span></a>
</span><span id="ChartDrawer-2867"><a href="#ChartDrawer-2867"><span class="linenos">2867</span></a>        <span class="k">return</span> <span class="n">template</span>
</span><span id="ChartDrawer-2868"><a href="#ChartDrawer-2868"><span class="linenos">2868</span></a>
</span><span id="ChartDrawer-2869"><a href="#ChartDrawer-2869"><span class="linenos">2869</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_wheel_only_svg_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer-2870"><a href="#ChartDrawer-2870"><span class="linenos">2870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2871"><a href="#ChartDrawer-2871"><span class="linenos">2871</span></a><span class="sd">        Generate and save wheel-only chart SVG to disk.</span>
</span><span id="ChartDrawer-2872"><a href="#ChartDrawer-2872"><span class="linenos">2872</span></a>
</span><span id="ChartDrawer-2873"><a href="#ChartDrawer-2873"><span class="linenos">2873</span></a><span class="sd">        Calls generate_wheel_only_svg_string and writes a file named</span>
</span><span id="ChartDrawer-2874"><a href="#ChartDrawer-2874"><span class="linenos">2874</span></a><span class="sd">        &quot;{subject.name} - {chart_type} Chart - Wheel Only.svg&quot; in the specified output directory.</span>
</span><span id="ChartDrawer-2875"><a href="#ChartDrawer-2875"><span class="linenos">2875</span></a>
</span><span id="ChartDrawer-2876"><a href="#ChartDrawer-2876"><span class="linenos">2876</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-2877"><a href="#ChartDrawer-2877"><span class="linenos">2877</span></a><span class="sd">            output_path (str, Path, or None): Directory path where the SVG file will be saved.</span>
</span><span id="ChartDrawer-2878"><a href="#ChartDrawer-2878"><span class="linenos">2878</span></a><span class="sd">                If None, defaults to the user&#39;s home directory.</span>
</span><span id="ChartDrawer-2879"><a href="#ChartDrawer-2879"><span class="linenos">2879</span></a><span class="sd">            filename (str or None): Custom filename for the SVG file (without extension).</span>
</span><span id="ChartDrawer-2880"><a href="#ChartDrawer-2880"><span class="linenos">2880</span></a><span class="sd">                If None, uses the default pattern: &quot;{subject.name} - {chart_type} Chart - Wheel Only&quot;.</span>
</span><span id="ChartDrawer-2881"><a href="#ChartDrawer-2881"><span class="linenos">2881</span></a><span class="sd">            minify (bool): Pass-through to generate_wheel_only_svg_string for compact output.</span>
</span><span id="ChartDrawer-2882"><a href="#ChartDrawer-2882"><span class="linenos">2882</span></a><span class="sd">            remove_css_variables (bool): Pass-through to generate_wheel_only_svg_string to embed CSS variables.</span>
</span><span id="ChartDrawer-2883"><a href="#ChartDrawer-2883"><span class="linenos">2883</span></a>
</span><span id="ChartDrawer-2884"><a href="#ChartDrawer-2884"><span class="linenos">2884</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-2885"><a href="#ChartDrawer-2885"><span class="linenos">2885</span></a><span class="sd">            None</span>
</span><span id="ChartDrawer-2886"><a href="#ChartDrawer-2886"><span class="linenos">2886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2887"><a href="#ChartDrawer-2887"><span class="linenos">2887</span></a>
</span><span id="ChartDrawer-2888"><a href="#ChartDrawer-2888"><span class="linenos">2888</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_wheel_only_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">)</span>
</span><span id="ChartDrawer-2889"><a href="#ChartDrawer-2889"><span class="linenos">2889</span></a>
</span><span id="ChartDrawer-2890"><a href="#ChartDrawer-2890"><span class="linenos">2890</span></a>        <span class="c1"># Convert output_path to Path object, default to home directory</span>
</span><span id="ChartDrawer-2891"><a href="#ChartDrawer-2891"><span class="linenos">2891</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="ChartDrawer-2892"><a href="#ChartDrawer-2892"><span class="linenos">2892</span></a>
</span><span id="ChartDrawer-2893"><a href="#ChartDrawer-2893"><span class="linenos">2893</span></a>        <span class="c1"># Determine filename</span>
</span><span id="ChartDrawer-2894"><a href="#ChartDrawer-2894"><span class="linenos">2894</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2895"><a href="#ChartDrawer-2895"><span class="linenos">2895</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.svg&quot;</span>
</span><span id="ChartDrawer-2896"><a href="#ChartDrawer-2896"><span class="linenos">2896</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2897"><a href="#ChartDrawer-2897"><span class="linenos">2897</span></a>            <span class="c1"># Use default filename pattern</span>
</span><span id="ChartDrawer-2898"><a href="#ChartDrawer-2898"><span class="linenos">2898</span></a>            <span class="n">chart_type_for_filename</span> <span class="o">=</span> <span class="s2">&quot;ExternalNatal&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer-2899"><a href="#ChartDrawer-2899"><span class="linenos">2899</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Wheel Only.svg&quot;</span>
</span><span id="ChartDrawer-2900"><a href="#ChartDrawer-2900"><span class="linenos">2900</span></a>
</span><span id="ChartDrawer-2901"><a href="#ChartDrawer-2901"><span class="linenos">2901</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chartname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
</span><span id="ChartDrawer-2902"><a href="#ChartDrawer-2902"><span class="linenos">2902</span></a>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer-2903"><a href="#ChartDrawer-2903"><span class="linenos">2903</span></a>
</span><span id="ChartDrawer-2904"><a href="#ChartDrawer-2904"><span class="linenos">2904</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG Generated Correctly in: </span><span class="si">{</span><span class="n">chartname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2905"><a href="#ChartDrawer-2905"><span class="linenos">2905</span></a>
</span><span id="ChartDrawer-2906"><a href="#ChartDrawer-2906"><span class="linenos">2906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_aspect_grid_only_svg_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer-2907"><a href="#ChartDrawer-2907"><span class="linenos">2907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2908"><a href="#ChartDrawer-2908"><span class="linenos">2908</span></a><span class="sd">        Render the aspect-grid-only chart SVG as a string.</span>
</span><span id="ChartDrawer-2909"><a href="#ChartDrawer-2909"><span class="linenos">2909</span></a>
</span><span id="ChartDrawer-2910"><a href="#ChartDrawer-2910"><span class="linenos">2910</span></a><span class="sd">        Reads the aspect-grid XML template, generates the aspect grid based on chart type,</span>
</span><span id="ChartDrawer-2911"><a href="#ChartDrawer-2911"><span class="linenos">2911</span></a><span class="sd">        and applies optional CSS inlining and minification.</span>
</span><span id="ChartDrawer-2912"><a href="#ChartDrawer-2912"><span class="linenos">2912</span></a>
</span><span id="ChartDrawer-2913"><a href="#ChartDrawer-2913"><span class="linenos">2913</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-2914"><a href="#ChartDrawer-2914"><span class="linenos">2914</span></a><span class="sd">            minify (bool): Remove whitespace and quotes for compactness.</span>
</span><span id="ChartDrawer-2915"><a href="#ChartDrawer-2915"><span class="linenos">2915</span></a><span class="sd">            remove_css_variables (bool): Embed CSS variable definitions.</span>
</span><span id="ChartDrawer-2916"><a href="#ChartDrawer-2916"><span class="linenos">2916</span></a>
</span><span id="ChartDrawer-2917"><a href="#ChartDrawer-2917"><span class="linenos">2917</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-2918"><a href="#ChartDrawer-2918"><span class="linenos">2918</span></a><span class="sd">            str: SVG markup for the aspect grid only.</span>
</span><span id="ChartDrawer-2919"><a href="#ChartDrawer-2919"><span class="linenos">2919</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2920"><a href="#ChartDrawer-2920"><span class="linenos">2920</span></a>
</span><span id="ChartDrawer-2921"><a href="#ChartDrawer-2921"><span class="linenos">2921</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="ChartDrawer-2922"><a href="#ChartDrawer-2922"><span class="linenos">2922</span></a>            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;aspect_grid_only.xml&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2923"><a href="#ChartDrawer-2923"><span class="linenos">2923</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2924"><a href="#ChartDrawer-2924"><span class="linenos">2924</span></a>            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2925"><a href="#ChartDrawer-2925"><span class="linenos">2925</span></a>            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer-2926"><a href="#ChartDrawer-2926"><span class="linenos">2926</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer-2927"><a href="#ChartDrawer-2927"><span class="linenos">2927</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ChartDrawer-2928"><a href="#ChartDrawer-2928"><span class="linenos">2928</span></a>
</span><span id="ChartDrawer-2929"><a href="#ChartDrawer-2929"><span class="linenos">2929</span></a>        <span class="n">template_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dictionary</span><span class="p">()</span>
</span><span id="ChartDrawer-2930"><a href="#ChartDrawer-2930"><span class="linenos">2930</span></a>
</span><span id="ChartDrawer-2931"><a href="#ChartDrawer-2931"><span class="linenos">2931</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDrawer-2932"><a href="#ChartDrawer-2932"><span class="linenos">2932</span></a>            <span class="n">aspects_grid</span> <span class="o">=</span> <span class="n">draw_transit_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2933"><a href="#ChartDrawer-2933"><span class="linenos">2933</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2934"><a href="#ChartDrawer-2934"><span class="linenos">2934</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2935"><a href="#ChartDrawer-2935"><span class="linenos">2935</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2936"><a href="#ChartDrawer-2936"><span class="linenos">2936</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2937"><a href="#ChartDrawer-2937"><span class="linenos">2937</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2938"><a href="#ChartDrawer-2938"><span class="linenos">2938</span></a>            <span class="n">aspects_grid</span> <span class="o">=</span> <span class="n">draw_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer-2939"><a href="#ChartDrawer-2939"><span class="linenos">2939</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer-2940"><a href="#ChartDrawer-2940"><span class="linenos">2940</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer-2941"><a href="#ChartDrawer-2941"><span class="linenos">2941</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer-2942"><a href="#ChartDrawer-2942"><span class="linenos">2942</span></a>                <span class="n">x_start</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="ChartDrawer-2943"><a href="#ChartDrawer-2943"><span class="linenos">2943</span></a>                <span class="n">y_start</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
</span><span id="ChartDrawer-2944"><a href="#ChartDrawer-2944"><span class="linenos">2944</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer-2945"><a href="#ChartDrawer-2945"><span class="linenos">2945</span></a>
</span><span id="ChartDrawer-2946"><a href="#ChartDrawer-2946"><span class="linenos">2946</span></a>        <span class="c1"># Use a compact, known-good viewBox that frames the grid</span>
</span><span id="ChartDrawer-2947"><a href="#ChartDrawer-2947"><span class="linenos">2947</span></a>        <span class="n">viewbox_override</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_only_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer-2948"><a href="#ChartDrawer-2948"><span class="linenos">2948</span></a>
</span><span id="ChartDrawer-2949"><a href="#ChartDrawer-2949"><span class="linenos">2949</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">({</span><span class="o">**</span><span class="n">template_dict</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">:</span> <span class="n">aspects_grid</span><span class="p">,</span> <span class="s2">&quot;viewbox&quot;</span><span class="p">:</span> <span class="n">viewbox_override</span><span class="p">})</span>
</span><span id="ChartDrawer-2950"><a href="#ChartDrawer-2950"><span class="linenos">2950</span></a>
</span><span id="ChartDrawer-2951"><a href="#ChartDrawer-2951"><span class="linenos">2951</span></a>        <span class="k">if</span> <span class="n">remove_css_variables</span><span class="p">:</span>
</span><span id="ChartDrawer-2952"><a href="#ChartDrawer-2952"><span class="linenos">2952</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">inline_css_variables_in_svg</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer-2953"><a href="#ChartDrawer-2953"><span class="linenos">2953</span></a>
</span><span id="ChartDrawer-2954"><a href="#ChartDrawer-2954"><span class="linenos">2954</span></a>        <span class="k">if</span> <span class="n">minify</span><span class="p">:</span>
</span><span id="ChartDrawer-2955"><a href="#ChartDrawer-2955"><span class="linenos">2955</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">scourString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2956"><a href="#ChartDrawer-2956"><span class="linenos">2956</span></a>
</span><span id="ChartDrawer-2957"><a href="#ChartDrawer-2957"><span class="linenos">2957</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2958"><a href="#ChartDrawer-2958"><span class="linenos">2958</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer-2959"><a href="#ChartDrawer-2959"><span class="linenos">2959</span></a>
</span><span id="ChartDrawer-2960"><a href="#ChartDrawer-2960"><span class="linenos">2960</span></a>        <span class="k">return</span> <span class="n">template</span>
</span><span id="ChartDrawer-2961"><a href="#ChartDrawer-2961"><span class="linenos">2961</span></a>
</span><span id="ChartDrawer-2962"><a href="#ChartDrawer-2962"><span class="linenos">2962</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_aspect_grid_only_svg_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer-2963"><a href="#ChartDrawer-2963"><span class="linenos">2963</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2964"><a href="#ChartDrawer-2964"><span class="linenos">2964</span></a><span class="sd">        Generate and save aspect-grid-only chart SVG to disk.</span>
</span><span id="ChartDrawer-2965"><a href="#ChartDrawer-2965"><span class="linenos">2965</span></a>
</span><span id="ChartDrawer-2966"><a href="#ChartDrawer-2966"><span class="linenos">2966</span></a><span class="sd">        Calls generate_aspect_grid_only_svg_string and writes a file named</span>
</span><span id="ChartDrawer-2967"><a href="#ChartDrawer-2967"><span class="linenos">2967</span></a><span class="sd">        &quot;{subject.name} - {chart_type} Chart - Aspect Grid Only.svg&quot; in the specified output directory.</span>
</span><span id="ChartDrawer-2968"><a href="#ChartDrawer-2968"><span class="linenos">2968</span></a>
</span><span id="ChartDrawer-2969"><a href="#ChartDrawer-2969"><span class="linenos">2969</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer-2970"><a href="#ChartDrawer-2970"><span class="linenos">2970</span></a><span class="sd">            output_path (str, Path, or None): Directory path where the SVG file will be saved.</span>
</span><span id="ChartDrawer-2971"><a href="#ChartDrawer-2971"><span class="linenos">2971</span></a><span class="sd">                If None, defaults to the user&#39;s home directory.</span>
</span><span id="ChartDrawer-2972"><a href="#ChartDrawer-2972"><span class="linenos">2972</span></a><span class="sd">            filename (str or None): Custom filename for the SVG file (without extension).</span>
</span><span id="ChartDrawer-2973"><a href="#ChartDrawer-2973"><span class="linenos">2973</span></a><span class="sd">                If None, uses the default pattern: &quot;{subject.name} - {chart_type} Chart - Aspect Grid Only&quot;.</span>
</span><span id="ChartDrawer-2974"><a href="#ChartDrawer-2974"><span class="linenos">2974</span></a><span class="sd">            minify (bool): Pass-through to generate_aspect_grid_only_svg_string for compact output.</span>
</span><span id="ChartDrawer-2975"><a href="#ChartDrawer-2975"><span class="linenos">2975</span></a><span class="sd">            remove_css_variables (bool): Pass-through to generate_aspect_grid_only_svg_string to embed CSS variables.</span>
</span><span id="ChartDrawer-2976"><a href="#ChartDrawer-2976"><span class="linenos">2976</span></a>
</span><span id="ChartDrawer-2977"><a href="#ChartDrawer-2977"><span class="linenos">2977</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer-2978"><a href="#ChartDrawer-2978"><span class="linenos">2978</span></a><span class="sd">            None</span>
</span><span id="ChartDrawer-2979"><a href="#ChartDrawer-2979"><span class="linenos">2979</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer-2980"><a href="#ChartDrawer-2980"><span class="linenos">2980</span></a>
</span><span id="ChartDrawer-2981"><a href="#ChartDrawer-2981"><span class="linenos">2981</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_aspect_grid_only_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">)</span>
</span><span id="ChartDrawer-2982"><a href="#ChartDrawer-2982"><span class="linenos">2982</span></a>
</span><span id="ChartDrawer-2983"><a href="#ChartDrawer-2983"><span class="linenos">2983</span></a>        <span class="c1"># Convert output_path to Path object, default to home directory</span>
</span><span id="ChartDrawer-2984"><a href="#ChartDrawer-2984"><span class="linenos">2984</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="ChartDrawer-2985"><a href="#ChartDrawer-2985"><span class="linenos">2985</span></a>
</span><span id="ChartDrawer-2986"><a href="#ChartDrawer-2986"><span class="linenos">2986</span></a>        <span class="c1"># Determine filename</span>
</span><span id="ChartDrawer-2987"><a href="#ChartDrawer-2987"><span class="linenos">2987</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer-2988"><a href="#ChartDrawer-2988"><span class="linenos">2988</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.svg&quot;</span>
</span><span id="ChartDrawer-2989"><a href="#ChartDrawer-2989"><span class="linenos">2989</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer-2990"><a href="#ChartDrawer-2990"><span class="linenos">2990</span></a>            <span class="c1"># Use default filename pattern</span>
</span><span id="ChartDrawer-2991"><a href="#ChartDrawer-2991"><span class="linenos">2991</span></a>            <span class="n">chart_type_for_filename</span> <span class="o">=</span> <span class="s2">&quot;ExternalNatal&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer-2992"><a href="#ChartDrawer-2992"><span class="linenos">2992</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Aspect Grid Only.svg&quot;</span>
</span><span id="ChartDrawer-2993"><a href="#ChartDrawer-2993"><span class="linenos">2993</span></a>
</span><span id="ChartDrawer-2994"><a href="#ChartDrawer-2994"><span class="linenos">2994</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chartname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
</span><span id="ChartDrawer-2995"><a href="#ChartDrawer-2995"><span class="linenos">2995</span></a>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer-2996"><a href="#ChartDrawer-2996"><span class="linenos">2996</span></a>
</span><span id="ChartDrawer-2997"><a href="#ChartDrawer-2997"><span class="linenos">2997</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG Generated Correctly in: </span><span class="si">{</span><span class="n">chartname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>ChartDrawer generates astrological chart visualizations as SVG files from pre-computed chart data.</p>

<p>This class is designed for pure visualization and requires chart data to be pre-computed using
ChartDataFactory. This separation ensures clean architecture where ChartDataFactory handles
all calculations (aspects, element/quality distributions, subjects) while ChartDrawer focuses
solely on rendering SVG visualizations.</p>

<p>ChartDrawer supports creating full chart SVGs, wheel-only SVGs, and aspect-grid-only SVGs
for various chart types including Natal, Transit, Synastry, and Composite.
Charts are rendered using XML templates and drawing utilities, with customizable themes,
language, and visual settings.</p>

<p>The generated SVG files are optimized for web use and can be saved to any specified
destination path using the save_svg method.</p>

<p>NOTE:
    The generated SVG files are optimized for web use, opening in browsers. If you want to
    use them in other applications, you might need to adjust the SVG settings or styles.</p>

<p>Args:
    chart_data (ChartDataModel):
        Pre-computed chart data from ChartDataFactory containing all subjects, aspects,
        element/quality distributions, and other analytical data. This is the ONLY source
        of chart information - no calculations are performed by ChartDrawer.
    theme (KerykeionChartTheme, optional):
        CSS theme for the chart. If None, no default styles are applied. Defaults to 'classic'.
    double_chart_aspect_grid_type (Literal['list', 'table'], optional):
        Specifies rendering style for double-chart aspect grids. Defaults to 'list'.
    chart_language (KerykeionChartLanguage, optional):
        Language code for chart labels. Defaults to 'EN'.
    language_pack (dict | None, optional):
        Additional translations merged over the bundled defaults for the
        selected language. Useful to introduce new languages or override
        existing labels.
    transparent_background (bool, optional):
        Whether to use a transparent background instead of the theme color. Defaults to False.</p>

<p>Public Methods:
    makeTemplate(minify=False, remove_css_variables=False) -> str:
        Render the full chart SVG as a string without writing to disk. Use <code>minify=True</code>
        to remove whitespace and quotes, and <code>remove_css_variables=True</code> to embed CSS vars.</p>

<pre><code>save_svg(output_path=None, filename=None, minify=False, remove_css_variables=False) -&gt; None:
    Generate and write the full chart SVG file to the specified path.
    If output_path is None, saves to the user's home directory.
    If filename is None, uses default pattern: '{subject.name} - {chart_type} Chart.svg'.

makeWheelOnlyTemplate(minify=False, remove_css_variables=False) -&gt; str:
    Render only the chart wheel (no aspect grid) as an SVG string.

save_wheel_only_svg_file(output_path=None, filename=None, minify=False, remove_css_variables=False) -&gt; None:
    Generate and write the wheel-only SVG file to the specified path.
    If output_path is None, saves to the user's home directory.
    If filename is None, uses default pattern: '{subject.name} - {chart_type} Chart - Wheel Only.svg'.

makeAspectGridOnlyTemplate(minify=False, remove_css_variables=False) -&gt; str:
    Render only the aspect grid as an SVG string.

save_aspect_grid_only_svg_file(output_path=None, filename=None, minify=False, remove_css_variables=False) -&gt; None:
    Generate and write the aspect-grid-only SVG file to the specified path.
    If output_path is None, saves to the user's home directory.
    If filename is None, uses default pattern: '{subject.name} - {chart_type} Chart - Aspect Grid Only.svg'.
</code></pre>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>from kerykeion.astrological_subject_factory import AstrologicalSubjectFactory
      from kerykeion.chart_data_factory import ChartDataFactory
      from kerykeion.charts.chart_drawer import ChartDrawer</p>
      
      <h1 id="step-1-create-subject">Step 1: Create subject</h1>
      
      <p>subject = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>("John", 1990, 1, 1, 12, 0, "London", "GB")</p>
      
      <h1 id="step-2-pre-compute-chart-data">Step 2: Pre-compute chart data</h1>
      
      <p>chart_data = <a href="#ChartDataFactory.create_natal_chart_data">ChartDataFactory.create_natal_chart_data</a>(subject)</p>
      
      <h1 id="step-3-create-visualization">Step 3: Create visualization</h1>
      
      <p>chart_drawer = ChartDrawer(chart_data=chart_data, theme="classic")
      chart_drawer.save_svg()  # Saves to home directory with default filename</p>
      
      <h1 id="or-specify-custom-path-and-filename">Or specify custom path and filename:</h1>
      
      <p>chart_drawer.save_svg("/path/to/output/directory", "my_custom_chart")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="ChartDrawer.__init__" class="classattr">
                                        <input id="ChartDrawer.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ChartDrawer</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">chart_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">theme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;dark-high-contrast&#39;</span><span class="p">,</span> <span class="s1">&#39;classic&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">,</span> <span class="s1">&#39;black-and-white&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;classic&#39;</span>,</span><span class="param">	<span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span>,</span><span class="param">	<span class="n">chart_language</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;EN&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;PT&#39;</span><span class="p">,</span> <span class="s1">&#39;IT&#39;</span><span class="p">,</span> <span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;ES&#39;</span><span class="p">,</span> <span class="s1">&#39;RU&#39;</span><span class="p">,</span> <span class="s1">&#39;TR&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;HI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;EN&#39;</span>,</span><span class="param">	<span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">external_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">transparent_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">colors_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;paper_0&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-paper-0)&#39;</span><span class="p">,</span> <span class="s1">&#39;paper_1&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-paper-1)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_0&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-0)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_1&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-1)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_2&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-2)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_3&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-3)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_4&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-4)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_5&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-5)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_6&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-6)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_7&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-7)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_8&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-8)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_9&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-9)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_10&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-10)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_bg_11&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-bg-11)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_0&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-0)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_1&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-1)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_2&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-2)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_3&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-3)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_4&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-4)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_5&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-5)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_6&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-6)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_7&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-7)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_8&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-8)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_9&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-9)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_10&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-10)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_icon_11&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-icon-11)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_radix_ring_0&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-radix-ring-0)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_radix_ring_1&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-radix-ring-1)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_radix_ring_2&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-radix-ring-2)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_transit_ring_0&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-transit-ring-0)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_transit_ring_1&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-transit-ring-1)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_transit_ring_2&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-transit-ring-2)&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_transit_ring_3&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-zodiac-transit-ring-3)&#39;</span><span class="p">,</span> <span class="s1">&#39;houses_radix_line&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-houses-radix-line)&#39;</span><span class="p">,</span> <span class="s1">&#39;houses_transit_line&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-houses-transit-line)&#39;</span><span class="p">,</span> <span class="s1">&#39;lunar_phase_0&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-lunar-phase-0)&#39;</span><span class="p">,</span> <span class="s1">&#39;lunar_phase_1&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-lunar-phase-1)&#39;</span><span class="p">}</span>,</span><span class="param">	<span class="n">celestial_points_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-sun)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Sun&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-moon)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Moon&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-mercury)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-venus)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Venus&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-mars)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mars&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-jupiter)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-saturn)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-uranus)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-neptune)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pluto)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-mean-node)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-true-node)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-chiron)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-first-house)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Asc&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-tenth-house)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mc&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-seventh-house)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Dsc&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-fourth-house)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Ic&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-mean-lilith)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-mean-node)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-true-node)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-mean-lilith)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-earth)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Earth&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pholus)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-ceres)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pallas)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-juno)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Juno&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-vesta)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-eris)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Eris&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-sedna)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-haumea)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-makemake)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-ixion)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-orcus)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-quaoar)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-regulus)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-spica)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Spica&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pars-fortunae)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Fortune&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pars-spiritus)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Spirit&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pars-amoris)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Love&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-pars-fidei)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Faith&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-vertex)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-anti-vertex)&#39;</span><span class="p">,</span> <span class="s1">&#39;element_points&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">}]</span>,</span><span class="param">	<span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-conjunction)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;semi-sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-semi-sextile)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;semi-square&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-semi-square)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-sextile)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-quintile)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-square)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-trine)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sesquiquadrate&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-sesquiquadrate)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">144</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;biquintile&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-biquintile)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quincunx&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-quincunx)&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;is_major&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;var(--kerykeion-chart-color-opposition)&#39;</span><span class="p">}]</span>,</span><span class="param">	<span class="n">custom_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_house_position_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">show_cusp_position_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">auto_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>,</span><span class="param">	<span class="n">show_degree_indicators</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">show_aspect_icons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="ChartDrawer.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.__init__-242"><a href="#ChartDrawer.__init__-242"><span class="linenos">242</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ChartDrawer.__init__-243"><a href="#ChartDrawer.__init__-243"><span class="linenos">243</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-244"><a href="#ChartDrawer.__init__-244"><span class="linenos">244</span></a>        <span class="n">chart_data</span><span class="p">:</span> <span class="s2">&quot;ChartDataModel&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-245"><a href="#ChartDrawer.__init__-245"><span class="linenos">245</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-246"><a href="#ChartDrawer.__init__-246"><span class="linenos">246</span></a>        <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;classic&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-247"><a href="#ChartDrawer.__init__-247"><span class="linenos">247</span></a>        <span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-248"><a href="#ChartDrawer.__init__-248"><span class="linenos">248</span></a>        <span class="n">chart_language</span><span class="p">:</span> <span class="n">KerykeionChartLanguage</span> <span class="o">=</span> <span class="s2">&quot;EN&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-249"><a href="#ChartDrawer.__init__-249"><span class="linenos">249</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-250"><a href="#ChartDrawer.__init__-250"><span class="linenos">250</span></a>        <span class="n">external_view</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-251"><a href="#ChartDrawer.__init__-251"><span class="linenos">251</span></a>        <span class="n">transparent_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-252"><a href="#ChartDrawer.__init__-252"><span class="linenos">252</span></a>        <span class="n">colors_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_COLORS</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-253"><a href="#ChartDrawer.__init__-253"><span class="linenos">253</span></a>        <span class="n">celestial_points_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_CELESTIAL_POINTS_SETTINGS</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-254"><a href="#ChartDrawer.__init__-254"><span class="linenos">254</span></a>        <span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_CHART_ASPECTS_SETTINGS</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-255"><a href="#ChartDrawer.__init__-255"><span class="linenos">255</span></a>        <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-256"><a href="#ChartDrawer.__init__-256"><span class="linenos">256</span></a>        <span class="n">show_house_position_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-257"><a href="#ChartDrawer.__init__-257"><span class="linenos">257</span></a>        <span class="n">show_cusp_position_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-258"><a href="#ChartDrawer.__init__-258"><span class="linenos">258</span></a>        <span class="n">auto_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-259"><a href="#ChartDrawer.__init__-259"><span class="linenos">259</span></a>        <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-260"><a href="#ChartDrawer.__init__-260"><span class="linenos">260</span></a>        <span class="n">show_degree_indicators</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-261"><a href="#ChartDrawer.__init__-261"><span class="linenos">261</span></a>        <span class="n">show_aspect_icons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-262"><a href="#ChartDrawer.__init__-262"><span class="linenos">262</span></a>    <span class="p">):</span>
</span><span id="ChartDrawer.__init__-263"><a href="#ChartDrawer.__init__-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.__init__-264"><a href="#ChartDrawer.__init__-264"><span class="linenos">264</span></a><span class="sd">        Initialize the chart visualizer with pre-computed chart data.</span>
</span><span id="ChartDrawer.__init__-265"><a href="#ChartDrawer.__init__-265"><span class="linenos">265</span></a>
</span><span id="ChartDrawer.__init__-266"><a href="#ChartDrawer.__init__-266"><span class="linenos">266</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.__init__-267"><a href="#ChartDrawer.__init__-267"><span class="linenos">267</span></a><span class="sd">            chart_data (ChartDataModel):</span>
</span><span id="ChartDrawer.__init__-268"><a href="#ChartDrawer.__init__-268"><span class="linenos">268</span></a><span class="sd">                Pre-computed chart data from ChartDataFactory containing all subjects,</span>
</span><span id="ChartDrawer.__init__-269"><a href="#ChartDrawer.__init__-269"><span class="linenos">269</span></a><span class="sd">                aspects, element/quality distributions, and other analytical data.</span>
</span><span id="ChartDrawer.__init__-270"><a href="#ChartDrawer.__init__-270"><span class="linenos">270</span></a><span class="sd">            theme (KerykeionChartTheme or None, optional):</span>
</span><span id="ChartDrawer.__init__-271"><a href="#ChartDrawer.__init__-271"><span class="linenos">271</span></a><span class="sd">                CSS theme to apply; None for default styling.</span>
</span><span id="ChartDrawer.__init__-272"><a href="#ChartDrawer.__init__-272"><span class="linenos">272</span></a><span class="sd">            double_chart_aspect_grid_type (Literal[&#39;list&#39;,&#39;table&#39;], optional):</span>
</span><span id="ChartDrawer.__init__-273"><a href="#ChartDrawer.__init__-273"><span class="linenos">273</span></a><span class="sd">                Layout style for double-chart aspect grids (&#39;list&#39; or &#39;table&#39;).</span>
</span><span id="ChartDrawer.__init__-274"><a href="#ChartDrawer.__init__-274"><span class="linenos">274</span></a><span class="sd">            chart_language (KerykeionChartLanguage, optional):</span>
</span><span id="ChartDrawer.__init__-275"><a href="#ChartDrawer.__init__-275"><span class="linenos">275</span></a><span class="sd">                Language code for chart labels (e.g., &#39;EN&#39;, &#39;IT&#39;).</span>
</span><span id="ChartDrawer.__init__-276"><a href="#ChartDrawer.__init__-276"><span class="linenos">276</span></a><span class="sd">            language_pack (dict | None, optional):</span>
</span><span id="ChartDrawer.__init__-277"><a href="#ChartDrawer.__init__-277"><span class="linenos">277</span></a><span class="sd">                Additional translations merged over the bundled defaults for the</span>
</span><span id="ChartDrawer.__init__-278"><a href="#ChartDrawer.__init__-278"><span class="linenos">278</span></a><span class="sd">                selected language. Useful to introduce new languages or override</span>
</span><span id="ChartDrawer.__init__-279"><a href="#ChartDrawer.__init__-279"><span class="linenos">279</span></a><span class="sd">                existing labels.</span>
</span><span id="ChartDrawer.__init__-280"><a href="#ChartDrawer.__init__-280"><span class="linenos">280</span></a><span class="sd">            external_view (bool, optional):</span>
</span><span id="ChartDrawer.__init__-281"><a href="#ChartDrawer.__init__-281"><span class="linenos">281</span></a><span class="sd">                Whether to use external visualization (planets on outer ring) for single-subject charts. Defaults to False.</span>
</span><span id="ChartDrawer.__init__-282"><a href="#ChartDrawer.__init__-282"><span class="linenos">282</span></a><span class="sd">            transparent_background (bool, optional):</span>
</span><span id="ChartDrawer.__init__-283"><a href="#ChartDrawer.__init__-283"><span class="linenos">283</span></a><span class="sd">                Whether to use a transparent background instead of the theme color. Defaults to False.</span>
</span><span id="ChartDrawer.__init__-284"><a href="#ChartDrawer.__init__-284"><span class="linenos">284</span></a><span class="sd">            custom_title (str or None, optional):</span>
</span><span id="ChartDrawer.__init__-285"><a href="#ChartDrawer.__init__-285"><span class="linenos">285</span></a><span class="sd">                Custom title for the chart. If None, the default title will be used based on chart type. Defaults to None.</span>
</span><span id="ChartDrawer.__init__-286"><a href="#ChartDrawer.__init__-286"><span class="linenos">286</span></a><span class="sd">            show_house_position_comparison (bool, optional):</span>
</span><span id="ChartDrawer.__init__-287"><a href="#ChartDrawer.__init__-287"><span class="linenos">287</span></a><span class="sd">                Whether to render the house position comparison grid (when supported by the chart type).</span>
</span><span id="ChartDrawer.__init__-288"><a href="#ChartDrawer.__init__-288"><span class="linenos">288</span></a><span class="sd">                Defaults to True. Set to False to hide the table and reclaim horizontal space.</span>
</span><span id="ChartDrawer.__init__-289"><a href="#ChartDrawer.__init__-289"><span class="linenos">289</span></a><span class="sd">            show_cusp_position_comparison (bool, optional):</span>
</span><span id="ChartDrawer.__init__-290"><a href="#ChartDrawer.__init__-290"><span class="linenos">290</span></a><span class="sd">                Whether to render the cusp position comparison grid alongside or in place of the house comparison.</span>
</span><span id="ChartDrawer.__init__-291"><a href="#ChartDrawer.__init__-291"><span class="linenos">291</span></a><span class="sd">                Defaults to False so cusp tables are only shown when explicitly requested.</span>
</span><span id="ChartDrawer.__init__-292"><a href="#ChartDrawer.__init__-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.__init__-293"><a href="#ChartDrawer.__init__-293"><span class="linenos">293</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer.__init__-294"><a href="#ChartDrawer.__init__-294"><span class="linenos">294</span></a>        <span class="c1"># COMMON INITIALIZATION</span>
</span><span id="ChartDrawer.__init__-295"><a href="#ChartDrawer.__init__-295"><span class="linenos">295</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer.__init__-296"><a href="#ChartDrawer.__init__-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span> <span class="o">=</span> <span class="n">chart_language</span>
</span><span id="ChartDrawer.__init__-297"><a href="#ChartDrawer.__init__-297"><span class="linenos">297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">=</span> <span class="n">double_chart_aspect_grid_type</span>
</span><span id="ChartDrawer.__init__-298"><a href="#ChartDrawer.__init__-298"><span class="linenos">298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transparent_background</span> <span class="o">=</span> <span class="n">transparent_background</span>
</span><span id="ChartDrawer.__init__-299"><a href="#ChartDrawer.__init__-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span> <span class="o">=</span> <span class="n">external_view</span>
</span><span id="ChartDrawer.__init__-300"><a href="#ChartDrawer.__init__-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">colors_settings</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-301"><a href="#ChartDrawer.__init__-301"><span class="linenos">301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">body</span><span class="p">)</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">celestial_points_settings</span><span class="p">]</span>
</span><span id="ChartDrawer.__init__-302"><a href="#ChartDrawer.__init__-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span> <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">aspects_settings</span><span class="p">]</span>
</span><span id="ChartDrawer.__init__-303"><a href="#ChartDrawer.__init__-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">custom_title</span> <span class="o">=</span> <span class="n">custom_title</span>
</span><span id="ChartDrawer.__init__-304"><a href="#ChartDrawer.__init__-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_house_position_comparison</span> <span class="o">=</span> <span class="n">show_house_position_comparison</span>
</span><span id="ChartDrawer.__init__-305"><a href="#ChartDrawer.__init__-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_cusp_position_comparison</span> <span class="o">=</span> <span class="n">show_cusp_position_comparison</span>
</span><span id="ChartDrawer.__init__-306"><a href="#ChartDrawer.__init__-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_degree_indicators</span> <span class="o">=</span> <span class="n">show_degree_indicators</span>
</span><span id="ChartDrawer.__init__-307"><a href="#ChartDrawer.__init__-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_aspect_icons</span> <span class="o">=</span> <span class="n">show_aspect_icons</span>
</span><span id="ChartDrawer.__init__-308"><a href="#ChartDrawer.__init__-308"><span class="linenos">308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_size</span> <span class="o">=</span> <span class="n">auto_size</span>
</span><span id="ChartDrawer.__init__-309"><a href="#ChartDrawer.__init__-309"><span class="linenos">309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_padding</span> <span class="o">=</span> <span class="n">padding</span>
</span><span id="ChartDrawer.__init__-310"><a href="#ChartDrawer.__init__-310"><span class="linenos">310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vertical_offsets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BASE_VERTICAL_OFFSETS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-311"><a href="#ChartDrawer.__init__-311"><span class="linenos">311</span></a>
</span><span id="ChartDrawer.__init__-312"><a href="#ChartDrawer.__init__-312"><span class="linenos">312</span></a>        <span class="c1"># Extract data from ChartDataModel</span>
</span><span id="ChartDrawer.__init__-313"><a href="#ChartDrawer.__init__-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_data</span> <span class="o">=</span> <span class="n">chart_data</span>
</span><span id="ChartDrawer.__init__-314"><a href="#ChartDrawer.__init__-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer.__init__-315"><a href="#ChartDrawer.__init__-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="ChartDrawer.__init__-316"><a href="#ChartDrawer.__init__-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">active_aspects</span>
</span><span id="ChartDrawer.__init__-317"><a href="#ChartDrawer.__init__-317"><span class="linenos">317</span></a>
</span><span id="ChartDrawer.__init__-318"><a href="#ChartDrawer.__init__-318"><span class="linenos">318</span></a>        <span class="c1"># Extract subjects based on chart type</span>
</span><span id="ChartDrawer.__init__-319"><a href="#ChartDrawer.__init__-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Natal&quot;</span><span class="p">,</span> <span class="s2">&quot;Composite&quot;</span><span class="p">,</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDrawer.__init__-320"><a href="#ChartDrawer.__init__-320"><span class="linenos">320</span></a>            <span class="c1"># SingleChartDataModel</span>
</span><span id="ChartDrawer.__init__-321"><a href="#ChartDrawer.__init__-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="s1">&#39;subject&#39;</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-322"><a href="#ChartDrawer.__init__-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChartDrawer.__init__-323"><a href="#ChartDrawer.__init__-323"><span class="linenos">323</span></a>
</span><span id="ChartDrawer.__init__-324"><a href="#ChartDrawer.__init__-324"><span class="linenos">324</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># DualChartDataModel for Transit, Synastry, DualReturnChart</span>
</span><span id="ChartDrawer.__init__-325"><a href="#ChartDrawer.__init__-325"><span class="linenos">325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="s1">&#39;first_subject&#39;</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-326"><a href="#ChartDrawer.__init__-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="s1">&#39;second_subject&#39;</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-327"><a href="#ChartDrawer.__init__-327"><span class="linenos">327</span></a>
</span><span id="ChartDrawer.__init__-328"><a href="#ChartDrawer.__init__-328"><span class="linenos">328</span></a>        <span class="c1"># Load settings</span>
</span><span id="ChartDrawer.__init__-329"><a href="#ChartDrawer.__init__-329"><span class="linenos">329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_language_settings</span><span class="p">(</span><span class="n">language_pack</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-330"><a href="#ChartDrawer.__init__-330"><span class="linenos">330</span></a>
</span><span id="ChartDrawer.__init__-331"><a href="#ChartDrawer.__init__-331"><span class="linenos">331</span></a>        <span class="c1"># Default radius for all charts</span>
</span><span id="ChartDrawer.__init__-332"><a href="#ChartDrawer.__init__-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_radius</span> <span class="o">=</span> <span class="mi">240</span>
</span><span id="ChartDrawer.__init__-333"><a href="#ChartDrawer.__init__-333"><span class="linenos">333</span></a>
</span><span id="ChartDrawer.__init__-334"><a href="#ChartDrawer.__init__-334"><span class="linenos">334</span></a>        <span class="c1"># Configure available planets from chart data</span>
</span><span id="ChartDrawer.__init__-335"><a href="#ChartDrawer.__init__-335"><span class="linenos">335</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer.__init__-336"><a href="#ChartDrawer.__init__-336"><span class="linenos">336</span></a>        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-337"><a href="#ChartDrawer.__init__-337"><span class="linenos">337</span></a>            <span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-338"><a href="#ChartDrawer.__init__-338"><span class="linenos">338</span></a>                <span class="n">body</span><span class="p">[</span><span class="s2">&quot;is_active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ChartDrawer.__init__-339"><a href="#ChartDrawer.__init__-339"><span class="linenos">339</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ChartDrawer.__init__-340"><a href="#ChartDrawer.__init__-340"><span class="linenos">340</span></a>
</span><span id="ChartDrawer.__init__-341"><a href="#ChartDrawer.__init__-341"><span class="linenos">341</span></a>        <span class="n">active_points_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-342"><a href="#ChartDrawer.__init__-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">active_points_count</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-343"><a href="#ChartDrawer.__init__-343"><span class="linenos">343</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ChartDrawer.__init__-344"><a href="#ChartDrawer.__init__-344"><span class="linenos">344</span></a>                <span class="s2">&quot;ChartDrawer detected </span><span class="si">%s</span><span class="s2"> active celestial points; rendering may look crowded beyond 24.&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-345"><a href="#ChartDrawer.__init__-345"><span class="linenos">345</span></a>                <span class="n">active_points_count</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-346"><a href="#ChartDrawer.__init__-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer.__init__-347"><a href="#ChartDrawer.__init__-347"><span class="linenos">347</span></a>
</span><span id="ChartDrawer.__init__-348"><a href="#ChartDrawer.__init__-348"><span class="linenos">348</span></a>        <span class="c1"># Set available celestial points</span>
</span><span id="ChartDrawer.__init__-349"><a href="#ChartDrawer.__init__-349"><span class="linenos">349</span></a>        <span class="n">available_celestial_points_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">]</span>
</span><span id="ChartDrawer.__init__-350"><a href="#ChartDrawer.__init__-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_subject_points</span><span class="p">(</span>
</span><span id="ChartDrawer.__init__-351"><a href="#ChartDrawer.__init__-351"><span class="linenos">351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-352"><a href="#ChartDrawer.__init__-352"><span class="linenos">352</span></a>            <span class="n">available_celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-353"><a href="#ChartDrawer.__init__-353"><span class="linenos">353</span></a>        <span class="p">)</span>
</span><span id="ChartDrawer.__init__-354"><a href="#ChartDrawer.__init__-354"><span class="linenos">354</span></a>
</span><span id="ChartDrawer.__init__-355"><a href="#ChartDrawer.__init__-355"><span class="linenos">355</span></a>        <span class="c1"># Collect secondary subject points for dual charts using the same active set</span>
</span><span id="ChartDrawer.__init__-356"><a href="#ChartDrawer.__init__-356"><span class="linenos">356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">KerykeionPointModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChartDrawer.__init__-357"><a href="#ChartDrawer.__init__-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-358"><a href="#ChartDrawer.__init__-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_subject_points</span><span class="p">(</span>
</span><span id="ChartDrawer.__init__-359"><a href="#ChartDrawer.__init__-359"><span class="linenos">359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-360"><a href="#ChartDrawer.__init__-360"><span class="linenos">360</span></a>                <span class="n">available_celestial_points_names</span><span class="p">,</span>
</span><span id="ChartDrawer.__init__-361"><a href="#ChartDrawer.__init__-361"><span class="linenos">361</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer.__init__-362"><a href="#ChartDrawer.__init__-362"><span class="linenos">362</span></a>
</span><span id="ChartDrawer.__init__-363"><a href="#ChartDrawer.__init__-363"><span class="linenos">363</span></a>        <span class="c1"># ------------------------</span>
</span><span id="ChartDrawer.__init__-364"><a href="#ChartDrawer.__init__-364"><span class="linenos">364</span></a>        <span class="c1"># CHART TYPE SPECIFIC SETUP FROM CHART DATA</span>
</span><span id="ChartDrawer.__init__-365"><a href="#ChartDrawer.__init__-365"><span class="linenos">365</span></a>        <span class="c1"># ------------------------</span>
</span><span id="ChartDrawer.__init__-366"><a href="#ChartDrawer.__init__-366"><span class="linenos">366</span></a>
</span><span id="ChartDrawer.__init__-367"><a href="#ChartDrawer.__init__-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-368"><a href="#ChartDrawer.__init__-368"><span class="linenos">368</span></a>            <span class="c1"># --- NATAL CHART SETUP ---</span>
</span><span id="ChartDrawer.__init__-369"><a href="#ChartDrawer.__init__-369"><span class="linenos">369</span></a>
</span><span id="ChartDrawer.__init__-370"><a href="#ChartDrawer.__init__-370"><span class="linenos">370</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer.__init__-371"><a href="#ChartDrawer.__init__-371"><span class="linenos">371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer.__init__-372"><a href="#ChartDrawer.__init__-372"><span class="linenos">372</span></a>
</span><span id="ChartDrawer.__init__-373"><a href="#ChartDrawer.__init__-373"><span class="linenos">373</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer.__init__-374"><a href="#ChartDrawer.__init__-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer.__init__-375"><a href="#ChartDrawer.__init__-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span>
</span><span id="ChartDrawer.__init__-376"><a href="#ChartDrawer.__init__-376"><span class="linenos">376</span></a>
</span><span id="ChartDrawer.__init__-377"><a href="#ChartDrawer.__init__-377"><span class="linenos">377</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer.__init__-378"><a href="#ChartDrawer.__init__-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-379"><a href="#ChartDrawer.__init__-379"><span class="linenos">379</span></a>
</span><span id="ChartDrawer.__init__-380"><a href="#ChartDrawer.__init__-380"><span class="linenos">380</span></a>            <span class="c1"># Circle radii - depends on external_view</span>
</span><span id="ChartDrawer.__init__-381"><a href="#ChartDrawer.__init__-381"><span class="linenos">381</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-382"><a href="#ChartDrawer.__init__-382"><span class="linenos">382</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">56</span>
</span><span id="ChartDrawer.__init__-383"><a href="#ChartDrawer.__init__-383"><span class="linenos">383</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">92</span>
</span><span id="ChartDrawer.__init__-384"><a href="#ChartDrawer.__init__-384"><span class="linenos">384</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">112</span>
</span><span id="ChartDrawer.__init__-385"><a href="#ChartDrawer.__init__-385"><span class="linenos">385</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-386"><a href="#ChartDrawer.__init__-386"><span class="linenos">386</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer.__init__-387"><a href="#ChartDrawer.__init__-387"><span class="linenos">387</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer.__init__-388"><a href="#ChartDrawer.__init__-388"><span class="linenos">388</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer.__init__-389"><a href="#ChartDrawer.__init__-389"><span class="linenos">389</span></a>
</span><span id="ChartDrawer.__init__-390"><a href="#ChartDrawer.__init__-390"><span class="linenos">390</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-391"><a href="#ChartDrawer.__init__-391"><span class="linenos">391</span></a>            <span class="c1"># --- COMPOSITE CHART SETUP ---</span>
</span><span id="ChartDrawer.__init__-392"><a href="#ChartDrawer.__init__-392"><span class="linenos">392</span></a>
</span><span id="ChartDrawer.__init__-393"><a href="#ChartDrawer.__init__-393"><span class="linenos">393</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer.__init__-394"><a href="#ChartDrawer.__init__-394"><span class="linenos">394</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer.__init__-395"><a href="#ChartDrawer.__init__-395"><span class="linenos">395</span></a>
</span><span id="ChartDrawer.__init__-396"><a href="#ChartDrawer.__init__-396"><span class="linenos">396</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer.__init__-397"><a href="#ChartDrawer.__init__-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer.__init__-398"><a href="#ChartDrawer.__init__-398"><span class="linenos">398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span>
</span><span id="ChartDrawer.__init__-399"><a href="#ChartDrawer.__init__-399"><span class="linenos">399</span></a>
</span><span id="ChartDrawer.__init__-400"><a href="#ChartDrawer.__init__-400"><span class="linenos">400</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer.__init__-401"><a href="#ChartDrawer.__init__-401"><span class="linenos">401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-402"><a href="#ChartDrawer.__init__-402"><span class="linenos">402</span></a>
</span><span id="ChartDrawer.__init__-403"><a href="#ChartDrawer.__init__-403"><span class="linenos">403</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer.__init__-404"><a href="#ChartDrawer.__init__-404"><span class="linenos">404</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer.__init__-405"><a href="#ChartDrawer.__init__-405"><span class="linenos">405</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer.__init__-406"><a href="#ChartDrawer.__init__-406"><span class="linenos">406</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer.__init__-407"><a href="#ChartDrawer.__init__-407"><span class="linenos">407</span></a>
</span><span id="ChartDrawer.__init__-408"><a href="#ChartDrawer.__init__-408"><span class="linenos">408</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-409"><a href="#ChartDrawer.__init__-409"><span class="linenos">409</span></a>            <span class="c1"># --- TRANSIT CHART SETUP ---</span>
</span><span id="ChartDrawer.__init__-410"><a href="#ChartDrawer.__init__-410"><span class="linenos">410</span></a>
</span><span id="ChartDrawer.__init__-411"><a href="#ChartDrawer.__init__-411"><span class="linenos">411</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer.__init__-412"><a href="#ChartDrawer.__init__-412"><span class="linenos">412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer.__init__-413"><a href="#ChartDrawer.__init__-413"><span class="linenos">413</span></a>
</span><span id="ChartDrawer.__init__-414"><a href="#ChartDrawer.__init__-414"><span class="linenos">414</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer.__init__-415"><a href="#ChartDrawer.__init__-415"><span class="linenos">415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer.__init__-416"><a href="#ChartDrawer.__init__-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-417"><a href="#ChartDrawer.__init__-417"><span class="linenos">417</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH_WITH_TABLE</span>
</span><span id="ChartDrawer.__init__-418"><a href="#ChartDrawer.__init__-418"><span class="linenos">418</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-419"><a href="#ChartDrawer.__init__-419"><span class="linenos">419</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_FULL_WIDTH</span>
</span><span id="ChartDrawer.__init__-420"><a href="#ChartDrawer.__init__-420"><span class="linenos">420</span></a>
</span><span id="ChartDrawer.__init__-421"><a href="#ChartDrawer.__init__-421"><span class="linenos">421</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer.__init__-422"><a href="#ChartDrawer.__init__-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-423"><a href="#ChartDrawer.__init__-423"><span class="linenos">423</span></a>
</span><span id="ChartDrawer.__init__-424"><a href="#ChartDrawer.__init__-424"><span class="linenos">424</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer.__init__-425"><a href="#ChartDrawer.__init__-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer.__init__-426"><a href="#ChartDrawer.__init__-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer.__init__-427"><a href="#ChartDrawer.__init__-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer.__init__-428"><a href="#ChartDrawer.__init__-428"><span class="linenos">428</span></a>
</span><span id="ChartDrawer.__init__-429"><a href="#ChartDrawer.__init__-429"><span class="linenos">429</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-430"><a href="#ChartDrawer.__init__-430"><span class="linenos">430</span></a>            <span class="c1"># --- SYNASTRY CHART SETUP ---</span>
</span><span id="ChartDrawer.__init__-431"><a href="#ChartDrawer.__init__-431"><span class="linenos">431</span></a>
</span><span id="ChartDrawer.__init__-432"><a href="#ChartDrawer.__init__-432"><span class="linenos">432</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer.__init__-433"><a href="#ChartDrawer.__init__-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer.__init__-434"><a href="#ChartDrawer.__init__-434"><span class="linenos">434</span></a>
</span><span id="ChartDrawer.__init__-435"><a href="#ChartDrawer.__init__-435"><span class="linenos">435</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer.__init__-436"><a href="#ChartDrawer.__init__-436"><span class="linenos">436</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer.__init__-437"><a href="#ChartDrawer.__init__-437"><span class="linenos">437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_SYNASTRY_WIDTH</span>
</span><span id="ChartDrawer.__init__-438"><a href="#ChartDrawer.__init__-438"><span class="linenos">438</span></a>
</span><span id="ChartDrawer.__init__-439"><a href="#ChartDrawer.__init__-439"><span class="linenos">439</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer.__init__-440"><a href="#ChartDrawer.__init__-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-441"><a href="#ChartDrawer.__init__-441"><span class="linenos">441</span></a>
</span><span id="ChartDrawer.__init__-442"><a href="#ChartDrawer.__init__-442"><span class="linenos">442</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer.__init__-443"><a href="#ChartDrawer.__init__-443"><span class="linenos">443</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer.__init__-444"><a href="#ChartDrawer.__init__-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer.__init__-445"><a href="#ChartDrawer.__init__-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer.__init__-446"><a href="#ChartDrawer.__init__-446"><span class="linenos">446</span></a>
</span><span id="ChartDrawer.__init__-447"><a href="#ChartDrawer.__init__-447"><span class="linenos">447</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-448"><a href="#ChartDrawer.__init__-448"><span class="linenos">448</span></a>            <span class="c1"># --- RETURN CHART SETUP ---</span>
</span><span id="ChartDrawer.__init__-449"><a href="#ChartDrawer.__init__-449"><span class="linenos">449</span></a>
</span><span id="ChartDrawer.__init__-450"><a href="#ChartDrawer.__init__-450"><span class="linenos">450</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer.__init__-451"><a href="#ChartDrawer.__init__-451"><span class="linenos">451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer.__init__-452"><a href="#ChartDrawer.__init__-452"><span class="linenos">452</span></a>
</span><span id="ChartDrawer.__init__-453"><a href="#ChartDrawer.__init__-453"><span class="linenos">453</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer.__init__-454"><a href="#ChartDrawer.__init__-454"><span class="linenos">454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer.__init__-455"><a href="#ChartDrawer.__init__-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_ULTRA_WIDE_WIDTH</span>
</span><span id="ChartDrawer.__init__-456"><a href="#ChartDrawer.__init__-456"><span class="linenos">456</span></a>
</span><span id="ChartDrawer.__init__-457"><a href="#ChartDrawer.__init__-457"><span class="linenos">457</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer.__init__-458"><a href="#ChartDrawer.__init__-458"><span class="linenos">458</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-459"><a href="#ChartDrawer.__init__-459"><span class="linenos">459</span></a>
</span><span id="ChartDrawer.__init__-460"><a href="#ChartDrawer.__init__-460"><span class="linenos">460</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer.__init__-461"><a href="#ChartDrawer.__init__-461"><span class="linenos">461</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer.__init__-462"><a href="#ChartDrawer.__init__-462"><span class="linenos">462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer.__init__-463"><a href="#ChartDrawer.__init__-463"><span class="linenos">463</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer.__init__-464"><a href="#ChartDrawer.__init__-464"><span class="linenos">464</span></a>
</span><span id="ChartDrawer.__init__-465"><a href="#ChartDrawer.__init__-465"><span class="linenos">465</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-466"><a href="#ChartDrawer.__init__-466"><span class="linenos">466</span></a>            <span class="c1"># --- SINGLE WHEEL RETURN CHART SETUP ---</span>
</span><span id="ChartDrawer.__init__-467"><a href="#ChartDrawer.__init__-467"><span class="linenos">467</span></a>
</span><span id="ChartDrawer.__init__-468"><a href="#ChartDrawer.__init__-468"><span class="linenos">468</span></a>            <span class="c1"># Extract aspects from pre-computed chart data</span>
</span><span id="ChartDrawer.__init__-469"><a href="#ChartDrawer.__init__-469"><span class="linenos">469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="ChartDrawer.__init__-470"><a href="#ChartDrawer.__init__-470"><span class="linenos">470</span></a>
</span><span id="ChartDrawer.__init__-471"><a href="#ChartDrawer.__init__-471"><span class="linenos">471</span></a>            <span class="c1"># Screen size</span>
</span><span id="ChartDrawer.__init__-472"><a href="#ChartDrawer.__init__-472"><span class="linenos">472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_HEIGHT</span>
</span><span id="ChartDrawer.__init__-473"><a href="#ChartDrawer.__init__-473"><span class="linenos">473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_NATAL_WIDTH</span>
</span><span id="ChartDrawer.__init__-474"><a href="#ChartDrawer.__init__-474"><span class="linenos">474</span></a>
</span><span id="ChartDrawer.__init__-475"><a href="#ChartDrawer.__init__-475"><span class="linenos">475</span></a>            <span class="c1"># Get location and coordinates</span>
</span><span id="ChartDrawer.__init__-476"><a href="#ChartDrawer.__init__-476"><span class="linenos">476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location_info</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-477"><a href="#ChartDrawer.__init__-477"><span class="linenos">477</span></a>
</span><span id="ChartDrawer.__init__-478"><a href="#ChartDrawer.__init__-478"><span class="linenos">478</span></a>            <span class="c1"># Circle radii</span>
</span><span id="ChartDrawer.__init__-479"><a href="#ChartDrawer.__init__-479"><span class="linenos">479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_circle_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ChartDrawer.__init__-480"><a href="#ChartDrawer.__init__-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_circle_radius</span> <span class="o">=</span> <span class="mi">36</span>
</span><span id="ChartDrawer.__init__-481"><a href="#ChartDrawer.__init__-481"><span class="linenos">481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">third_circle_radius</span> <span class="o">=</span> <span class="mi">120</span>
</span><span id="ChartDrawer.__init__-482"><a href="#ChartDrawer.__init__-482"><span class="linenos">482</span></a>
</span><span id="ChartDrawer.__init__-483"><a href="#ChartDrawer.__init__-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_house_comparison_width_override</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-484"><a href="#ChartDrawer.__init__-484"><span class="linenos">484</span></a>
</span><span id="ChartDrawer.__init__-485"><a href="#ChartDrawer.__init__-485"><span class="linenos">485</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer.__init__-486"><a href="#ChartDrawer.__init__-486"><span class="linenos">486</span></a>        <span class="c1"># FINAL COMMON SETUP FROM CHART DATA</span>
</span><span id="ChartDrawer.__init__-487"><a href="#ChartDrawer.__init__-487"><span class="linenos">487</span></a>        <span class="c1"># --------------------</span>
</span><span id="ChartDrawer.__init__-488"><a href="#ChartDrawer.__init__-488"><span class="linenos">488</span></a>
</span><span id="ChartDrawer.__init__-489"><a href="#ChartDrawer.__init__-489"><span class="linenos">489</span></a>        <span class="c1"># Extract pre-computed element and quality distributions</span>
</span><span id="ChartDrawer.__init__-490"><a href="#ChartDrawer.__init__-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fire</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">fire</span>
</span><span id="ChartDrawer.__init__-491"><a href="#ChartDrawer.__init__-491"><span class="linenos">491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">earth</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">earth</span>
</span><span id="ChartDrawer.__init__-492"><a href="#ChartDrawer.__init__-492"><span class="linenos">492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">air</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">air</span>
</span><span id="ChartDrawer.__init__-493"><a href="#ChartDrawer.__init__-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">water</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">element_distribution</span><span class="o">.</span><span class="n">water</span>
</span><span id="ChartDrawer.__init__-494"><a href="#ChartDrawer.__init__-494"><span class="linenos">494</span></a>
</span><span id="ChartDrawer.__init__-495"><a href="#ChartDrawer.__init__-495"><span class="linenos">495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cardinal</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">quality_distribution</span><span class="o">.</span><span class="n">cardinal</span>
</span><span id="ChartDrawer.__init__-496"><a href="#ChartDrawer.__init__-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">quality_distribution</span><span class="o">.</span><span class="n">fixed</span>
</span><span id="ChartDrawer.__init__-497"><a href="#ChartDrawer.__init__-497"><span class="linenos">497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mutable</span> <span class="o">=</span> <span class="n">chart_data</span><span class="o">.</span><span class="n">quality_distribution</span><span class="o">.</span><span class="n">mutable</span>
</span><span id="ChartDrawer.__init__-498"><a href="#ChartDrawer.__init__-498"><span class="linenos">498</span></a>
</span><span id="ChartDrawer.__init__-499"><a href="#ChartDrawer.__init__-499"><span class="linenos">499</span></a>        <span class="c1"># Set up theme</span>
</span><span id="ChartDrawer.__init__-500"><a href="#ChartDrawer.__init__-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="n">theme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_args</span><span class="p">(</span><span class="n">KerykeionChartTheme</span><span class="p">)</span> <span class="ow">and</span> <span class="n">theme</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-501"><a href="#ChartDrawer.__init__-501"><span class="linenos">501</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Theme </span><span class="si">{</span><span class="n">theme</span><span class="si">}</span><span class="s2"> is not available. Set None for default theme.&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-502"><a href="#ChartDrawer.__init__-502"><span class="linenos">502</span></a>
</span><span id="ChartDrawer.__init__-503"><a href="#ChartDrawer.__init__-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_up_theme</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
</span><span id="ChartDrawer.__init__-504"><a href="#ChartDrawer.__init__-504"><span class="linenos">504</span></a>
</span><span id="ChartDrawer.__init__-505"><a href="#ChartDrawer.__init__-505"><span class="linenos">505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_dynamic_height_adjustment</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-506"><a href="#ChartDrawer.__init__-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_height_for_extended_aspect_columns</span><span class="p">()</span>
</span><span id="ChartDrawer.__init__-507"><a href="#ChartDrawer.__init__-507"><span class="linenos">507</span></a>        <span class="c1"># Reconcile width with the updated layout once height adjustments are known.</span>
</span><span id="ChartDrawer.__init__-508"><a href="#ChartDrawer.__init__-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_size</span><span class="p">:</span>
</span><span id="ChartDrawer.__init__-509"><a href="#ChartDrawer.__init__-509"><span class="linenos">509</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_width_to_content</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the chart visualizer with pre-computed chart data.</p>

<p>Args:
    chart_data (ChartDataModel):
        Pre-computed chart data from ChartDataFactory containing all subjects,
        aspects, element/quality distributions, and other analytical data.
    theme (KerykeionChartTheme or None, optional):
        CSS theme to apply; None for default styling.
    double_chart_aspect_grid_type (Literal['list','table'], optional):
        Layout style for double-chart aspect grids ('list' or 'table').
    chart_language (KerykeionChartLanguage, optional):
        Language code for chart labels (e.g., 'EN', 'IT').
    language_pack (dict | None, optional):
        Additional translations merged over the bundled defaults for the
        selected language. Useful to introduce new languages or override
        existing labels.
    external_view (bool, optional):
        Whether to use external visualization (planets on outer ring) for single-subject charts. Defaults to False.
    transparent_background (bool, optional):
        Whether to use a transparent background instead of the theme color. Defaults to False.
    custom_title (str or None, optional):
        Custom title for the chart. If None, the default title will be used based on chart type. Defaults to None.
    show_house_position_comparison (bool, optional):
        Whether to render the house position comparison grid (when supported by the chart type).
        Defaults to True. Set to False to hide the table and reclaim horizontal space.
    show_cusp_position_comparison (bool, optional):
        Whether to render the cusp position comparison grid alongside or in place of the house comparison.
        Defaults to False so cusp tables are only shown when explicitly requested.</p>
</div>


                            </div>
                            <div id="ChartDrawer.first_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">first_obj</span><span class="annotation">: Union[kerykeion.schemas.kr_models.AstrologicalSubjectModel, kerykeion.schemas.kr_models.CompositeSubjectModel, <a href="#PlanetReturnModel">PlanetReturnModel</a>]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.first_obj"></a>
    
    

                            </div>
                            <div id="ChartDrawer.second_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">second_obj</span><span class="annotation">: Union[kerykeion.schemas.kr_models.AstrologicalSubjectModel, <a href="#PlanetReturnModel">PlanetReturnModel</a>, NoneType]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.second_obj"></a>
    
    

                            </div>
                            <div id="ChartDrawer.chart_type" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_type</span><span class="annotation">: Literal[&#39;Natal&#39;, &#39;Synastry&#39;, &#39;Transit&#39;, &#39;Composite&#39;, &#39;DualReturnChart&#39;, &#39;SingleReturnChart&#39;]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.chart_type"></a>
    
    

                            </div>
                            <div id="ChartDrawer.theme" class="classattr">
                                <div class="attr variable">
            <span class="name">theme</span><span class="annotation">: Optional[Literal[&#39;light&#39;, &#39;dark&#39;, &#39;dark-high-contrast&#39;, &#39;classic&#39;, &#39;strawberry&#39;, &#39;black-and-white&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.theme"></a>
    
    

                            </div>
                            <div id="ChartDrawer.double_chart_aspect_grid_type" class="classattr">
                                <div class="attr variable">
            <span class="name">double_chart_aspect_grid_type</span><span class="annotation">: Literal[&#39;list&#39;, &#39;table&#39;]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.double_chart_aspect_grid_type"></a>
    
    

                            </div>
                            <div id="ChartDrawer.chart_language" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_language</span><span class="annotation">: Literal[&#39;EN&#39;, &#39;FR&#39;, &#39;PT&#39;, &#39;IT&#39;, &#39;CN&#39;, &#39;ES&#39;, &#39;RU&#39;, &#39;TR&#39;, &#39;DE&#39;, &#39;HI&#39;]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.chart_language"></a>
    
    

                            </div>
                            <div id="ChartDrawer.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span><span class="annotation">: List[Literal[&#39;Sun&#39;, &#39;Moon&#39;, &#39;Mercury&#39;, &#39;Venus&#39;, &#39;Mars&#39;, &#39;Jupiter&#39;, &#39;Saturn&#39;, &#39;Uranus&#39;, &#39;Neptune&#39;, &#39;Pluto&#39;, &#39;Mean_North_Lunar_Node&#39;, &#39;True_North_Lunar_Node&#39;, &#39;Mean_South_Lunar_Node&#39;, &#39;True_South_Lunar_Node&#39;, &#39;Chiron&#39;, &#39;Mean_Lilith&#39;, &#39;True_Lilith&#39;, &#39;Earth&#39;, &#39;Pholus&#39;, &#39;Ceres&#39;, &#39;Pallas&#39;, &#39;Juno&#39;, &#39;Vesta&#39;, &#39;Eris&#39;, &#39;Sedna&#39;, &#39;Haumea&#39;, &#39;Makemake&#39;, &#39;Ixion&#39;, &#39;Orcus&#39;, &#39;Quaoar&#39;, &#39;Regulus&#39;, &#39;Spica&#39;, &#39;Pars_Fortunae&#39;, &#39;Pars_Spiritus&#39;, &#39;Pars_Amoris&#39;, &#39;Pars_Fidei&#39;, &#39;Vertex&#39;, &#39;Anti_Vertex&#39;, &#39;Ascendant&#39;, &#39;Medium_Coeli&#39;, &#39;Descendant&#39;, &#39;Imum_Coeli&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.active_points"></a>
    
    

                            </div>
                            <div id="ChartDrawer.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span><span class="annotation">: List[kerykeion.schemas.kr_models.ActiveAspect]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.active_aspects"></a>
    
    

                            </div>
                            <div id="ChartDrawer.transparent_background" class="classattr">
                                <div class="attr variable">
            <span class="name">transparent_background</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.transparent_background"></a>
    
    

                            </div>
                            <div id="ChartDrawer.external_view" class="classattr">
                                <div class="attr variable">
            <span class="name">external_view</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.external_view"></a>
    
    

                            </div>
                            <div id="ChartDrawer.show_house_position_comparison" class="classattr">
                                <div class="attr variable">
            <span class="name">show_house_position_comparison</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.show_house_position_comparison"></a>
    
    

                            </div>
                            <div id="ChartDrawer.custom_title" class="classattr">
                                <div class="attr variable">
            <span class="name">custom_title</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.custom_title"></a>
    
    

                            </div>
                            <div id="ChartDrawer.fire" class="classattr">
                                <div class="attr variable">
            <span class="name">fire</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.fire"></a>
    
    

                            </div>
                            <div id="ChartDrawer.earth" class="classattr">
                                <div class="attr variable">
            <span class="name">earth</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.earth"></a>
    
    

                            </div>
                            <div id="ChartDrawer.air" class="classattr">
                                <div class="attr variable">
            <span class="name">air</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.air"></a>
    
    

                            </div>
                            <div id="ChartDrawer.water" class="classattr">
                                <div class="attr variable">
            <span class="name">water</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.water"></a>
    
    

                            </div>
                            <div id="ChartDrawer.first_circle_radius" class="classattr">
                                <div class="attr variable">
            <span class="name">first_circle_radius</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.first_circle_radius"></a>
    
    

                            </div>
                            <div id="ChartDrawer.second_circle_radius" class="classattr">
                                <div class="attr variable">
            <span class="name">second_circle_radius</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.second_circle_radius"></a>
    
    

                            </div>
                            <div id="ChartDrawer.third_circle_radius" class="classattr">
                                <div class="attr variable">
            <span class="name">third_circle_radius</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.third_circle_radius"></a>
    
    

                            </div>
                            <div id="ChartDrawer.width" class="classattr">
                                <div class="attr variable">
            <span class="name">width</span><span class="annotation">: Union[float, int]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.width"></a>
    
    

                            </div>
                            <div id="ChartDrawer.language_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">language_settings</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.language_settings"></a>
    
    

                            </div>
                            <div id="ChartDrawer.chart_colors_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_colors_settings</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.chart_colors_settings"></a>
    
    

                            </div>
                            <div id="ChartDrawer.planets_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">planets_settings</span><span class="annotation">: list[dict[typing.Any, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.planets_settings"></a>
    
    

                            </div>
                            <div id="ChartDrawer.aspects_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects_settings</span><span class="annotation">: list[dict[typing.Any, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.aspects_settings"></a>
    
    

                            </div>
                            <div id="ChartDrawer.available_planets_setting" class="classattr">
                                <div class="attr variable">
            <span class="name">available_planets_setting</span><span class="annotation">: List[kerykeion.schemas.settings_models.KerykeionSettingsCelestialPointModel]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.available_planets_setting"></a>
    
    

                            </div>
                            <div id="ChartDrawer.height" class="classattr">
                                <div class="attr variable">
            <span class="name">height</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.height"></a>
    
    

                            </div>
                            <div id="ChartDrawer.location" class="classattr">
                                <div class="attr variable">
            <span class="name">location</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.location"></a>
    
    

                            </div>
                            <div id="ChartDrawer.geolat" class="classattr">
                                <div class="attr variable">
            <span class="name">geolat</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.geolat"></a>
    
    

                            </div>
                            <div id="ChartDrawer.geolon" class="classattr">
                                <div class="attr variable">
            <span class="name">geolon</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.geolon"></a>
    
    

                            </div>
                            <div id="ChartDrawer.template" class="classattr">
                                <div class="attr variable">
            <span class="name">template</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.template"></a>
    
    

                            </div>
                            <div id="ChartDrawer.show_cusp_position_comparison" class="classattr">
                                <div class="attr variable">
            <span class="name">show_cusp_position_comparison</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.show_cusp_position_comparison"></a>
    
    

                            </div>
                            <div id="ChartDrawer.show_degree_indicators" class="classattr">
                                <div class="attr variable">
            <span class="name">show_degree_indicators</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.show_degree_indicators"></a>
    
    

                            </div>
                            <div id="ChartDrawer.show_aspect_icons" class="classattr">
                                <div class="attr variable">
            <span class="name">show_aspect_icons</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.show_aspect_icons"></a>
    
    

                            </div>
                            <div id="ChartDrawer.auto_size" class="classattr">
                                <div class="attr variable">
            <span class="name">auto_size</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.auto_size"></a>
    
    

                            </div>
                            <div id="ChartDrawer.chart_data" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_data</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.chart_data"></a>
    
    

                            </div>
                            <div id="ChartDrawer.main_radius" class="classattr">
                                <div class="attr variable">
            <span class="name">main_radius</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.main_radius"></a>
    
    

                            </div>
                            <div id="ChartDrawer.available_kerykeion_celestial_points" class="classattr">
                                <div class="attr variable">
            <span class="name">available_kerykeion_celestial_points</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.available_kerykeion_celestial_points"></a>
    
    

                            </div>
                            <div id="ChartDrawer.t_available_kerykeion_celestial_points" class="classattr">
                                <div class="attr variable">
            <span class="name">t_available_kerykeion_celestial_points</span><span class="annotation">: list[kerykeion.schemas.kr_models.KerykeionPointModel]</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.t_available_kerykeion_celestial_points"></a>
    
    

                            </div>
                            <div id="ChartDrawer.cardinal" class="classattr">
                                <div class="attr variable">
            <span class="name">cardinal</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.cardinal"></a>
    
    

                            </div>
                            <div id="ChartDrawer.fixed" class="classattr">
                                <div class="attr variable">
            <span class="name">fixed</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.fixed"></a>
    
    

                            </div>
                            <div id="ChartDrawer.mutable" class="classattr">
                                <div class="attr variable">
            <span class="name">mutable</span>

        
    </div>
    <a class="headerlink" href="#ChartDrawer.mutable"></a>
    
    

                            </div>
                            <div id="ChartDrawer.set_up_theme" class="classattr">
                                        <input id="ChartDrawer.set_up_theme-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_up_theme</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">theme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;dark-high-contrast&#39;</span><span class="p">,</span> <span class="s1">&#39;classic&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">,</span> <span class="s1">&#39;black-and-white&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ChartDrawer.set_up_theme-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.set_up_theme"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.set_up_theme-1135"><a href="#ChartDrawer.set_up_theme-1135"><span class="linenos">1135</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_up_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.set_up_theme-1136"><a href="#ChartDrawer.set_up_theme-1136"><span class="linenos">1136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.set_up_theme-1137"><a href="#ChartDrawer.set_up_theme-1137"><span class="linenos">1137</span></a><span class="sd">        Load and apply a CSS theme for the chart visualization.</span>
</span><span id="ChartDrawer.set_up_theme-1138"><a href="#ChartDrawer.set_up_theme-1138"><span class="linenos">1138</span></a>
</span><span id="ChartDrawer.set_up_theme-1139"><a href="#ChartDrawer.set_up_theme-1139"><span class="linenos">1139</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.set_up_theme-1140"><a href="#ChartDrawer.set_up_theme-1140"><span class="linenos">1140</span></a><span class="sd">            theme (KerykeionChartTheme or None): Name of the theme to apply. If None, no CSS is applied.</span>
</span><span id="ChartDrawer.set_up_theme-1141"><a href="#ChartDrawer.set_up_theme-1141"><span class="linenos">1141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.set_up_theme-1142"><a href="#ChartDrawer.set_up_theme-1142"><span class="linenos">1142</span></a>        <span class="k">if</span> <span class="n">theme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.set_up_theme-1143"><a href="#ChartDrawer.set_up_theme-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">color_style_tag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChartDrawer.set_up_theme-1144"><a href="#ChartDrawer.set_up_theme-1144"><span class="linenos">1144</span></a>            <span class="k">return</span>
</span><span id="ChartDrawer.set_up_theme-1145"><a href="#ChartDrawer.set_up_theme-1145"><span class="linenos">1145</span></a>
</span><span id="ChartDrawer.set_up_theme-1146"><a href="#ChartDrawer.set_up_theme-1146"><span class="linenos">1146</span></a>        <span class="n">theme_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;themes&quot;</span>
</span><span id="ChartDrawer.set_up_theme-1147"><a href="#ChartDrawer.set_up_theme-1147"><span class="linenos">1147</span></a>
</span><span id="ChartDrawer.set_up_theme-1148"><a href="#ChartDrawer.set_up_theme-1148"><span class="linenos">1148</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">theme_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">theme</span><span class="si">}</span><span class="s2">.css&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer.set_up_theme-1149"><a href="#ChartDrawer.set_up_theme-1149"><span class="linenos">1149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">color_style_tag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Load and apply a CSS theme for the chart visualization.</p>

<p>Args:
    theme (KerykeionChartTheme or None): Name of the theme to apply. If None, no CSS is applied.</p>
</div>


                            </div>
                            <div id="ChartDrawer.generate_svg_string" class="classattr">
                                        <input id="ChartDrawer.generate_svg_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_svg_string</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">custom_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ChartDrawer.generate_svg_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.generate_svg_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.generate_svg_string-2747"><a href="#ChartDrawer.generate_svg_string-2747"><span class="linenos">2747</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_svg_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_svg_string-2748"><a href="#ChartDrawer.generate_svg_string-2748"><span class="linenos">2748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.generate_svg_string-2749"><a href="#ChartDrawer.generate_svg_string-2749"><span class="linenos">2749</span></a><span class="sd">        Render the full chart SVG as a string.</span>
</span><span id="ChartDrawer.generate_svg_string-2750"><a href="#ChartDrawer.generate_svg_string-2750"><span class="linenos">2750</span></a>
</span><span id="ChartDrawer.generate_svg_string-2751"><a href="#ChartDrawer.generate_svg_string-2751"><span class="linenos">2751</span></a><span class="sd">        Reads the XML template, substitutes variables, and optionally inlines CSS</span>
</span><span id="ChartDrawer.generate_svg_string-2752"><a href="#ChartDrawer.generate_svg_string-2752"><span class="linenos">2752</span></a><span class="sd">        variables and minifies the output.</span>
</span><span id="ChartDrawer.generate_svg_string-2753"><a href="#ChartDrawer.generate_svg_string-2753"><span class="linenos">2753</span></a>
</span><span id="ChartDrawer.generate_svg_string-2754"><a href="#ChartDrawer.generate_svg_string-2754"><span class="linenos">2754</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.generate_svg_string-2755"><a href="#ChartDrawer.generate_svg_string-2755"><span class="linenos">2755</span></a><span class="sd">            minify (bool): Remove whitespace and quotes for compactness.</span>
</span><span id="ChartDrawer.generate_svg_string-2756"><a href="#ChartDrawer.generate_svg_string-2756"><span class="linenos">2756</span></a><span class="sd">            remove_css_variables (bool): Embed CSS variable definitions.</span>
</span><span id="ChartDrawer.generate_svg_string-2757"><a href="#ChartDrawer.generate_svg_string-2757"><span class="linenos">2757</span></a><span class="sd">            custom_title (str or None): Optional override for the SVG title.</span>
</span><span id="ChartDrawer.generate_svg_string-2758"><a href="#ChartDrawer.generate_svg_string-2758"><span class="linenos">2758</span></a>
</span><span id="ChartDrawer.generate_svg_string-2759"><a href="#ChartDrawer.generate_svg_string-2759"><span class="linenos">2759</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer.generate_svg_string-2760"><a href="#ChartDrawer.generate_svg_string-2760"><span class="linenos">2760</span></a><span class="sd">            str: SVG markup as a string.</span>
</span><span id="ChartDrawer.generate_svg_string-2761"><a href="#ChartDrawer.generate_svg_string-2761"><span class="linenos">2761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.generate_svg_string-2762"><a href="#ChartDrawer.generate_svg_string-2762"><span class="linenos">2762</span></a>        <span class="n">td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dictionary</span><span class="p">(</span><span class="n">custom_title</span><span class="o">=</span><span class="n">custom_title</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_svg_string-2763"><a href="#ChartDrawer.generate_svg_string-2763"><span class="linenos">2763</span></a>
</span><span id="ChartDrawer.generate_svg_string-2764"><a href="#ChartDrawer.generate_svg_string-2764"><span class="linenos">2764</span></a>        <span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
</span><span id="ChartDrawer.generate_svg_string-2765"><a href="#ChartDrawer.generate_svg_string-2765"><span class="linenos">2765</span></a>        <span class="n">xml_svg</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;chart.xml&quot;</span>
</span><span id="ChartDrawer.generate_svg_string-2766"><a href="#ChartDrawer.generate_svg_string-2766"><span class="linenos">2766</span></a>
</span><span id="ChartDrawer.generate_svg_string-2767"><a href="#ChartDrawer.generate_svg_string-2767"><span class="linenos">2767</span></a>        <span class="c1"># read template</span>
</span><span id="ChartDrawer.generate_svg_string-2768"><a href="#ChartDrawer.generate_svg_string-2768"><span class="linenos">2768</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xml_svg</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_svg_string-2769"><a href="#ChartDrawer.generate_svg_string-2769"><span class="linenos">2769</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
</span><span id="ChartDrawer.generate_svg_string-2770"><a href="#ChartDrawer.generate_svg_string-2770"><span class="linenos">2770</span></a>
</span><span id="ChartDrawer.generate_svg_string-2771"><a href="#ChartDrawer.generate_svg_string-2771"><span class="linenos">2771</span></a>        <span class="c1"># return filename</span>
</span><span id="ChartDrawer.generate_svg_string-2772"><a href="#ChartDrawer.generate_svg_string-2772"><span class="linenos">2772</span></a>
</span><span id="ChartDrawer.generate_svg_string-2773"><a href="#ChartDrawer.generate_svg_string-2773"><span class="linenos">2773</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Template dictionary includes </span><span class="si">%s</span><span class="s2"> fields&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()))</span>
</span><span id="ChartDrawer.generate_svg_string-2774"><a href="#ChartDrawer.generate_svg_string-2774"><span class="linenos">2774</span></a>
</span><span id="ChartDrawer.generate_svg_string-2775"><a href="#ChartDrawer.generate_svg_string-2775"><span class="linenos">2775</span></a>        <span class="k">if</span> <span class="n">remove_css_variables</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_svg_string-2776"><a href="#ChartDrawer.generate_svg_string-2776"><span class="linenos">2776</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">inline_css_variables_in_svg</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_svg_string-2777"><a href="#ChartDrawer.generate_svg_string-2777"><span class="linenos">2777</span></a>
</span><span id="ChartDrawer.generate_svg_string-2778"><a href="#ChartDrawer.generate_svg_string-2778"><span class="linenos">2778</span></a>        <span class="k">if</span> <span class="n">minify</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_svg_string-2779"><a href="#ChartDrawer.generate_svg_string-2779"><span class="linenos">2779</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">scourString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_svg_string-2780"><a href="#ChartDrawer.generate_svg_string-2780"><span class="linenos">2780</span></a>
</span><span id="ChartDrawer.generate_svg_string-2781"><a href="#ChartDrawer.generate_svg_string-2781"><span class="linenos">2781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_svg_string-2782"><a href="#ChartDrawer.generate_svg_string-2782"><span class="linenos">2782</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_svg_string-2783"><a href="#ChartDrawer.generate_svg_string-2783"><span class="linenos">2783</span></a>
</span><span id="ChartDrawer.generate_svg_string-2784"><a href="#ChartDrawer.generate_svg_string-2784"><span class="linenos">2784</span></a>        <span class="k">return</span> <span class="n">template</span>
</span></pre></div>


            <div class="docstring"><p>Render the full chart SVG as a string.</p>

<p>Reads the XML template, substitutes variables, and optionally inlines CSS
variables and minifies the output.</p>

<p>Args:
    minify (bool): Remove whitespace and quotes for compactness.
    remove_css_variables (bool): Embed CSS variable definitions.
    custom_title (str or None): Optional override for the SVG title.</p>

<p>Returns:
    str: SVG markup as a string.</p>
</div>


                            </div>
                            <div id="ChartDrawer.save_svg" class="classattr">
                                        <input id="ChartDrawer.save_svg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_svg</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">custom_title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ChartDrawer.save_svg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.save_svg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.save_svg-2786"><a href="#ChartDrawer.save_svg-2786"><span class="linenos">2786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_svg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">custom_title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ChartDrawer.save_svg-2787"><a href="#ChartDrawer.save_svg-2787"><span class="linenos">2787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.save_svg-2788"><a href="#ChartDrawer.save_svg-2788"><span class="linenos">2788</span></a><span class="sd">        Generate and save the full chart SVG to disk.</span>
</span><span id="ChartDrawer.save_svg-2789"><a href="#ChartDrawer.save_svg-2789"><span class="linenos">2789</span></a>
</span><span id="ChartDrawer.save_svg-2790"><a href="#ChartDrawer.save_svg-2790"><span class="linenos">2790</span></a><span class="sd">        Calls generate_svg_string to render the SVG, then writes a file named</span>
</span><span id="ChartDrawer.save_svg-2791"><a href="#ChartDrawer.save_svg-2791"><span class="linenos">2791</span></a><span class="sd">        &quot;{subject.name} - {chart_type} Chart.svg&quot; in the specified output directory.</span>
</span><span id="ChartDrawer.save_svg-2792"><a href="#ChartDrawer.save_svg-2792"><span class="linenos">2792</span></a>
</span><span id="ChartDrawer.save_svg-2793"><a href="#ChartDrawer.save_svg-2793"><span class="linenos">2793</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.save_svg-2794"><a href="#ChartDrawer.save_svg-2794"><span class="linenos">2794</span></a><span class="sd">            output_path (str, Path, or None): Directory path where the SVG file will be saved.</span>
</span><span id="ChartDrawer.save_svg-2795"><a href="#ChartDrawer.save_svg-2795"><span class="linenos">2795</span></a><span class="sd">                If None, defaults to the user&#39;s home directory.</span>
</span><span id="ChartDrawer.save_svg-2796"><a href="#ChartDrawer.save_svg-2796"><span class="linenos">2796</span></a><span class="sd">            filename (str or None): Custom filename for the SVG file (without extension).</span>
</span><span id="ChartDrawer.save_svg-2797"><a href="#ChartDrawer.save_svg-2797"><span class="linenos">2797</span></a><span class="sd">                If None, uses the default pattern: &quot;{subject.name} - {chart_type} Chart&quot;.</span>
</span><span id="ChartDrawer.save_svg-2798"><a href="#ChartDrawer.save_svg-2798"><span class="linenos">2798</span></a><span class="sd">            minify (bool): Pass-through to generate_svg_string for compact output.</span>
</span><span id="ChartDrawer.save_svg-2799"><a href="#ChartDrawer.save_svg-2799"><span class="linenos">2799</span></a><span class="sd">            remove_css_variables (bool): Pass-through to generate_svg_string to embed CSS variables.</span>
</span><span id="ChartDrawer.save_svg-2800"><a href="#ChartDrawer.save_svg-2800"><span class="linenos">2800</span></a><span class="sd">            custom_title (str or None): Optional override for the SVG title.</span>
</span><span id="ChartDrawer.save_svg-2801"><a href="#ChartDrawer.save_svg-2801"><span class="linenos">2801</span></a>
</span><span id="ChartDrawer.save_svg-2802"><a href="#ChartDrawer.save_svg-2802"><span class="linenos">2802</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer.save_svg-2803"><a href="#ChartDrawer.save_svg-2803"><span class="linenos">2803</span></a><span class="sd">            None</span>
</span><span id="ChartDrawer.save_svg-2804"><a href="#ChartDrawer.save_svg-2804"><span class="linenos">2804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.save_svg-2805"><a href="#ChartDrawer.save_svg-2805"><span class="linenos">2805</span></a>
</span><span id="ChartDrawer.save_svg-2806"><a href="#ChartDrawer.save_svg-2806"><span class="linenos">2806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">,</span> <span class="n">custom_title</span><span class="o">=</span><span class="n">custom_title</span><span class="p">)</span>
</span><span id="ChartDrawer.save_svg-2807"><a href="#ChartDrawer.save_svg-2807"><span class="linenos">2807</span></a>
</span><span id="ChartDrawer.save_svg-2808"><a href="#ChartDrawer.save_svg-2808"><span class="linenos">2808</span></a>        <span class="c1"># Convert output_path to Path object, default to home directory</span>
</span><span id="ChartDrawer.save_svg-2809"><a href="#ChartDrawer.save_svg-2809"><span class="linenos">2809</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="ChartDrawer.save_svg-2810"><a href="#ChartDrawer.save_svg-2810"><span class="linenos">2810</span></a>
</span><span id="ChartDrawer.save_svg-2811"><a href="#ChartDrawer.save_svg-2811"><span class="linenos">2811</span></a>        <span class="c1"># Determine filename</span>
</span><span id="ChartDrawer.save_svg-2812"><a href="#ChartDrawer.save_svg-2812"><span class="linenos">2812</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.save_svg-2813"><a href="#ChartDrawer.save_svg-2813"><span class="linenos">2813</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.svg&quot;</span>
</span><span id="ChartDrawer.save_svg-2814"><a href="#ChartDrawer.save_svg-2814"><span class="linenos">2814</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.save_svg-2815"><a href="#ChartDrawer.save_svg-2815"><span class="linenos">2815</span></a>            <span class="c1"># Use default filename pattern</span>
</span><span id="ChartDrawer.save_svg-2816"><a href="#ChartDrawer.save_svg-2816"><span class="linenos">2816</span></a>            <span class="n">chart_type_for_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer.save_svg-2817"><a href="#ChartDrawer.save_svg-2817"><span class="linenos">2817</span></a>
</span><span id="ChartDrawer.save_svg-2818"><a href="#ChartDrawer.save_svg-2818"><span class="linenos">2818</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Lunar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.save_svg-2819"><a href="#ChartDrawer.save_svg-2819"><span class="linenos">2819</span></a>                <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Lunar Return.svg&quot;</span>
</span><span id="ChartDrawer.save_svg-2820"><a href="#ChartDrawer.save_svg-2820"><span class="linenos">2820</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ChartDrawer.save_svg-2821"><a href="#ChartDrawer.save_svg-2821"><span class="linenos">2821</span></a>                <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Solar Return.svg&quot;</span>
</span><span id="ChartDrawer.save_svg-2822"><a href="#ChartDrawer.save_svg-2822"><span class="linenos">2822</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.save_svg-2823"><a href="#ChartDrawer.save_svg-2823"><span class="linenos">2823</span></a>                <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart.svg&quot;</span>
</span><span id="ChartDrawer.save_svg-2824"><a href="#ChartDrawer.save_svg-2824"><span class="linenos">2824</span></a>
</span><span id="ChartDrawer.save_svg-2825"><a href="#ChartDrawer.save_svg-2825"><span class="linenos">2825</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chartname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
</span><span id="ChartDrawer.save_svg-2826"><a href="#ChartDrawer.save_svg-2826"><span class="linenos">2826</span></a>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer.save_svg-2827"><a href="#ChartDrawer.save_svg-2827"><span class="linenos">2827</span></a>
</span><span id="ChartDrawer.save_svg-2828"><a href="#ChartDrawer.save_svg-2828"><span class="linenos">2828</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG Generated Correctly in: </span><span class="si">{</span><span class="n">chartname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate and save the full chart SVG to disk.</p>

<p>Calls generate_svg_string to render the SVG, then writes a file named
"{subject.name} - {chart_type} Chart.svg" in the specified output directory.</p>

<p>Args:
    output_path (str, Path, or None): Directory path where the SVG file will be saved.
        If None, defaults to the user's home directory.
    filename (str or None): Custom filename for the SVG file (without extension).
        If None, uses the default pattern: "{subject.name} - {chart_type} Chart".
    minify (bool): Pass-through to generate_svg_string for compact output.
    remove_css_variables (bool): Pass-through to generate_svg_string to embed CSS variables.
    custom_title (str or None): Optional override for the SVG title.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="ChartDrawer.generate_wheel_only_svg_string" class="classattr">
                                        <input id="ChartDrawer.generate_wheel_only_svg_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_wheel_only_svg_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ChartDrawer.generate_wheel_only_svg_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.generate_wheel_only_svg_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.generate_wheel_only_svg_string-2830"><a href="#ChartDrawer.generate_wheel_only_svg_string-2830"><span class="linenos">2830</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_wheel_only_svg_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2831"><a href="#ChartDrawer.generate_wheel_only_svg_string-2831"><span class="linenos">2831</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2832"><a href="#ChartDrawer.generate_wheel_only_svg_string-2832"><span class="linenos">2832</span></a><span class="sd">        Render the wheel-only chart SVG as a string.</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2833"><a href="#ChartDrawer.generate_wheel_only_svg_string-2833"><span class="linenos">2833</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2834"><a href="#ChartDrawer.generate_wheel_only_svg_string-2834"><span class="linenos">2834</span></a><span class="sd">        Reads the wheel-only XML template, substitutes chart data, and applies optional</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2835"><a href="#ChartDrawer.generate_wheel_only_svg_string-2835"><span class="linenos">2835</span></a><span class="sd">        CSS inlining and minification.</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2836"><a href="#ChartDrawer.generate_wheel_only_svg_string-2836"><span class="linenos">2836</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2837"><a href="#ChartDrawer.generate_wheel_only_svg_string-2837"><span class="linenos">2837</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2838"><a href="#ChartDrawer.generate_wheel_only_svg_string-2838"><span class="linenos">2838</span></a><span class="sd">            minify (bool): Remove whitespace and quotes for compactness.</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2839"><a href="#ChartDrawer.generate_wheel_only_svg_string-2839"><span class="linenos">2839</span></a><span class="sd">            remove_css_variables (bool): Embed CSS variable definitions.</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2840"><a href="#ChartDrawer.generate_wheel_only_svg_string-2840"><span class="linenos">2840</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2841"><a href="#ChartDrawer.generate_wheel_only_svg_string-2841"><span class="linenos">2841</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2842"><a href="#ChartDrawer.generate_wheel_only_svg_string-2842"><span class="linenos">2842</span></a><span class="sd">            str: SVG markup for the chart wheel only.</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2843"><a href="#ChartDrawer.generate_wheel_only_svg_string-2843"><span class="linenos">2843</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2844"><a href="#ChartDrawer.generate_wheel_only_svg_string-2844"><span class="linenos">2844</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2845"><a href="#ChartDrawer.generate_wheel_only_svg_string-2845"><span class="linenos">2845</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2846"><a href="#ChartDrawer.generate_wheel_only_svg_string-2846"><span class="linenos">2846</span></a>            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;wheel_only.xml&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2847"><a href="#ChartDrawer.generate_wheel_only_svg_string-2847"><span class="linenos">2847</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2848"><a href="#ChartDrawer.generate_wheel_only_svg_string-2848"><span class="linenos">2848</span></a>            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2849"><a href="#ChartDrawer.generate_wheel_only_svg_string-2849"><span class="linenos">2849</span></a>            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2850"><a href="#ChartDrawer.generate_wheel_only_svg_string-2850"><span class="linenos">2850</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2851"><a href="#ChartDrawer.generate_wheel_only_svg_string-2851"><span class="linenos">2851</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2852"><a href="#ChartDrawer.generate_wheel_only_svg_string-2852"><span class="linenos">2852</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2853"><a href="#ChartDrawer.generate_wheel_only_svg_string-2853"><span class="linenos">2853</span></a>        <span class="n">template_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dictionary</span><span class="p">()</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2854"><a href="#ChartDrawer.generate_wheel_only_svg_string-2854"><span class="linenos">2854</span></a>        <span class="c1"># Use a compact viewBox specific for the wheel-only rendering</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2855"><a href="#ChartDrawer.generate_wheel_only_svg_string-2855"><span class="linenos">2855</span></a>        <span class="n">wheel_viewbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wheel_only_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2856"><a href="#ChartDrawer.generate_wheel_only_svg_string-2856"><span class="linenos">2856</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">({</span><span class="o">**</span><span class="n">template_dict</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="s2">&quot;viewbox&quot;</span><span class="p">:</span> <span class="n">wheel_viewbox</span><span class="p">})</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2857"><a href="#ChartDrawer.generate_wheel_only_svg_string-2857"><span class="linenos">2857</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2858"><a href="#ChartDrawer.generate_wheel_only_svg_string-2858"><span class="linenos">2858</span></a>        <span class="k">if</span> <span class="n">remove_css_variables</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2859"><a href="#ChartDrawer.generate_wheel_only_svg_string-2859"><span class="linenos">2859</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">inline_css_variables_in_svg</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2860"><a href="#ChartDrawer.generate_wheel_only_svg_string-2860"><span class="linenos">2860</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2861"><a href="#ChartDrawer.generate_wheel_only_svg_string-2861"><span class="linenos">2861</span></a>        <span class="k">if</span> <span class="n">minify</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2862"><a href="#ChartDrawer.generate_wheel_only_svg_string-2862"><span class="linenos">2862</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">scourString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2863"><a href="#ChartDrawer.generate_wheel_only_svg_string-2863"><span class="linenos">2863</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2864"><a href="#ChartDrawer.generate_wheel_only_svg_string-2864"><span class="linenos">2864</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2865"><a href="#ChartDrawer.generate_wheel_only_svg_string-2865"><span class="linenos">2865</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2866"><a href="#ChartDrawer.generate_wheel_only_svg_string-2866"><span class="linenos">2866</span></a>
</span><span id="ChartDrawer.generate_wheel_only_svg_string-2867"><a href="#ChartDrawer.generate_wheel_only_svg_string-2867"><span class="linenos">2867</span></a>        <span class="k">return</span> <span class="n">template</span>
</span></pre></div>


            <div class="docstring"><p>Render the wheel-only chart SVG as a string.</p>

<p>Reads the wheel-only XML template, substitutes chart data, and applies optional
CSS inlining and minification.</p>

<p>Args:
    minify (bool): Remove whitespace and quotes for compactness.
    remove_css_variables (bool): Embed CSS variable definitions.</p>

<p>Returns:
    str: SVG markup for the chart wheel only.</p>
</div>


                            </div>
                            <div id="ChartDrawer.save_wheel_only_svg_file" class="classattr">
                                        <input id="ChartDrawer.save_wheel_only_svg_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_wheel_only_svg_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ChartDrawer.save_wheel_only_svg_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.save_wheel_only_svg_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.save_wheel_only_svg_file-2869"><a href="#ChartDrawer.save_wheel_only_svg_file-2869"><span class="linenos">2869</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_wheel_only_svg_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2870"><a href="#ChartDrawer.save_wheel_only_svg_file-2870"><span class="linenos">2870</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2871"><a href="#ChartDrawer.save_wheel_only_svg_file-2871"><span class="linenos">2871</span></a><span class="sd">        Generate and save wheel-only chart SVG to disk.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2872"><a href="#ChartDrawer.save_wheel_only_svg_file-2872"><span class="linenos">2872</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2873"><a href="#ChartDrawer.save_wheel_only_svg_file-2873"><span class="linenos">2873</span></a><span class="sd">        Calls generate_wheel_only_svg_string and writes a file named</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2874"><a href="#ChartDrawer.save_wheel_only_svg_file-2874"><span class="linenos">2874</span></a><span class="sd">        &quot;{subject.name} - {chart_type} Chart - Wheel Only.svg&quot; in the specified output directory.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2875"><a href="#ChartDrawer.save_wheel_only_svg_file-2875"><span class="linenos">2875</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2876"><a href="#ChartDrawer.save_wheel_only_svg_file-2876"><span class="linenos">2876</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2877"><a href="#ChartDrawer.save_wheel_only_svg_file-2877"><span class="linenos">2877</span></a><span class="sd">            output_path (str, Path, or None): Directory path where the SVG file will be saved.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2878"><a href="#ChartDrawer.save_wheel_only_svg_file-2878"><span class="linenos">2878</span></a><span class="sd">                If None, defaults to the user&#39;s home directory.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2879"><a href="#ChartDrawer.save_wheel_only_svg_file-2879"><span class="linenos">2879</span></a><span class="sd">            filename (str or None): Custom filename for the SVG file (without extension).</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2880"><a href="#ChartDrawer.save_wheel_only_svg_file-2880"><span class="linenos">2880</span></a><span class="sd">                If None, uses the default pattern: &quot;{subject.name} - {chart_type} Chart - Wheel Only&quot;.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2881"><a href="#ChartDrawer.save_wheel_only_svg_file-2881"><span class="linenos">2881</span></a><span class="sd">            minify (bool): Pass-through to generate_wheel_only_svg_string for compact output.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2882"><a href="#ChartDrawer.save_wheel_only_svg_file-2882"><span class="linenos">2882</span></a><span class="sd">            remove_css_variables (bool): Pass-through to generate_wheel_only_svg_string to embed CSS variables.</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2883"><a href="#ChartDrawer.save_wheel_only_svg_file-2883"><span class="linenos">2883</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2884"><a href="#ChartDrawer.save_wheel_only_svg_file-2884"><span class="linenos">2884</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2885"><a href="#ChartDrawer.save_wheel_only_svg_file-2885"><span class="linenos">2885</span></a><span class="sd">            None</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2886"><a href="#ChartDrawer.save_wheel_only_svg_file-2886"><span class="linenos">2886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2887"><a href="#ChartDrawer.save_wheel_only_svg_file-2887"><span class="linenos">2887</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2888"><a href="#ChartDrawer.save_wheel_only_svg_file-2888"><span class="linenos">2888</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_wheel_only_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">)</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2889"><a href="#ChartDrawer.save_wheel_only_svg_file-2889"><span class="linenos">2889</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2890"><a href="#ChartDrawer.save_wheel_only_svg_file-2890"><span class="linenos">2890</span></a>        <span class="c1"># Convert output_path to Path object, default to home directory</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2891"><a href="#ChartDrawer.save_wheel_only_svg_file-2891"><span class="linenos">2891</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2892"><a href="#ChartDrawer.save_wheel_only_svg_file-2892"><span class="linenos">2892</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2893"><a href="#ChartDrawer.save_wheel_only_svg_file-2893"><span class="linenos">2893</span></a>        <span class="c1"># Determine filename</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2894"><a href="#ChartDrawer.save_wheel_only_svg_file-2894"><span class="linenos">2894</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2895"><a href="#ChartDrawer.save_wheel_only_svg_file-2895"><span class="linenos">2895</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.svg&quot;</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2896"><a href="#ChartDrawer.save_wheel_only_svg_file-2896"><span class="linenos">2896</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2897"><a href="#ChartDrawer.save_wheel_only_svg_file-2897"><span class="linenos">2897</span></a>            <span class="c1"># Use default filename pattern</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2898"><a href="#ChartDrawer.save_wheel_only_svg_file-2898"><span class="linenos">2898</span></a>            <span class="n">chart_type_for_filename</span> <span class="o">=</span> <span class="s2">&quot;ExternalNatal&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2899"><a href="#ChartDrawer.save_wheel_only_svg_file-2899"><span class="linenos">2899</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Wheel Only.svg&quot;</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2900"><a href="#ChartDrawer.save_wheel_only_svg_file-2900"><span class="linenos">2900</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2901"><a href="#ChartDrawer.save_wheel_only_svg_file-2901"><span class="linenos">2901</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chartname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2902"><a href="#ChartDrawer.save_wheel_only_svg_file-2902"><span class="linenos">2902</span></a>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2903"><a href="#ChartDrawer.save_wheel_only_svg_file-2903"><span class="linenos">2903</span></a>
</span><span id="ChartDrawer.save_wheel_only_svg_file-2904"><a href="#ChartDrawer.save_wheel_only_svg_file-2904"><span class="linenos">2904</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG Generated Correctly in: </span><span class="si">{</span><span class="n">chartname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate and save wheel-only chart SVG to disk.</p>

<p>Calls generate_wheel_only_svg_string and writes a file named
"{subject.name} - {chart_type} Chart - Wheel Only.svg" in the specified output directory.</p>

<p>Args:
    output_path (str, Path, or None): Directory path where the SVG file will be saved.
        If None, defaults to the user's home directory.
    filename (str or None): Custom filename for the SVG file (without extension).
        If None, uses the default pattern: "{subject.name} - {chart_type} Chart - Wheel Only".
    minify (bool): Pass-through to generate_wheel_only_svg_string for compact output.
    remove_css_variables (bool): Pass-through to generate_wheel_only_svg_string to embed CSS variables.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                            <div id="ChartDrawer.generate_aspect_grid_only_svg_string" class="classattr">
                                        <input id="ChartDrawer.generate_aspect_grid_only_svg_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_aspect_grid_only_svg_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ChartDrawer.generate_aspect_grid_only_svg_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.generate_aspect_grid_only_svg_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2906"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2906"><span class="linenos">2906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_aspect_grid_only_svg_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2907"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2907"><span class="linenos">2907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2908"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2908"><span class="linenos">2908</span></a><span class="sd">        Render the aspect-grid-only chart SVG as a string.</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2909"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2909"><span class="linenos">2909</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2910"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2910"><span class="linenos">2910</span></a><span class="sd">        Reads the aspect-grid XML template, generates the aspect grid based on chart type,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2911"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2911"><span class="linenos">2911</span></a><span class="sd">        and applies optional CSS inlining and minification.</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2912"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2912"><span class="linenos">2912</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2913"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2913"><span class="linenos">2913</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2914"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2914"><span class="linenos">2914</span></a><span class="sd">            minify (bool): Remove whitespace and quotes for compactness.</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2915"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2915"><span class="linenos">2915</span></a><span class="sd">            remove_css_variables (bool): Embed CSS variable definitions.</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2916"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2916"><span class="linenos">2916</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2917"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2917"><span class="linenos">2917</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2918"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2918"><span class="linenos">2918</span></a><span class="sd">            str: SVG markup for the aspect grid only.</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2919"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2919"><span class="linenos">2919</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2920"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2920"><span class="linenos">2920</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2921"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2921"><span class="linenos">2921</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2922"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2922"><span class="linenos">2922</span></a>            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span> <span class="o">/</span> <span class="s2">&quot;aspect_grid_only.xml&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2923"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2923"><span class="linenos">2923</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2924"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2924"><span class="linenos">2924</span></a>            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2925"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2925"><span class="linenos">2925</span></a>            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2926"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2926"><span class="linenos">2926</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2927"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2927"><span class="linenos">2927</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2928"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2928"><span class="linenos">2928</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2929"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2929"><span class="linenos">2929</span></a>        <span class="n">template_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dictionary</span><span class="p">()</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2930"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2930"><span class="linenos">2930</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2931"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2931"><span class="linenos">2931</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">,</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">]:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2932"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2932"><span class="linenos">2932</span></a>            <span class="n">aspects_grid</span> <span class="o">=</span> <span class="n">draw_transit_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2933"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2933"><span class="linenos">2933</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2934"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2934"><span class="linenos">2934</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2935"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2935"><span class="linenos">2935</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2936"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2936"><span class="linenos">2936</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2937"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2937"><span class="linenos">2937</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2938"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2938"><span class="linenos">2938</span></a>            <span class="n">aspects_grid</span> <span class="o">=</span> <span class="n">draw_aspect_grid</span><span class="p">(</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2939"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2939"><span class="linenos">2939</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">[</span><span class="s2">&quot;paper_0&quot;</span><span class="p">],</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2940"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2940"><span class="linenos">2940</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2941"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2941"><span class="linenos">2941</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2942"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2942"><span class="linenos">2942</span></a>                <span class="n">x_start</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2943"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2943"><span class="linenos">2943</span></a>                <span class="n">y_start</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2944"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2944"><span class="linenos">2944</span></a>            <span class="p">)</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2945"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2945"><span class="linenos">2945</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2946"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2946"><span class="linenos">2946</span></a>        <span class="c1"># Use a compact, known-good viewBox that frames the grid</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2947"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2947"><span class="linenos">2947</span></a>        <span class="n">viewbox_override</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid_only_viewbox</span><span class="p">()</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2948"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2948"><span class="linenos">2948</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2949"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2949"><span class="linenos">2949</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">({</span><span class="o">**</span><span class="n">template_dict</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="s2">&quot;makeAspectGrid&quot;</span><span class="p">:</span> <span class="n">aspects_grid</span><span class="p">,</span> <span class="s2">&quot;viewbox&quot;</span><span class="p">:</span> <span class="n">viewbox_override</span><span class="p">})</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2950"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2950"><span class="linenos">2950</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2951"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2951"><span class="linenos">2951</span></a>        <span class="k">if</span> <span class="n">remove_css_variables</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2952"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2952"><span class="linenos">2952</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">inline_css_variables_in_svg</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2953"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2953"><span class="linenos">2953</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2954"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2954"><span class="linenos">2954</span></a>        <span class="k">if</span> <span class="n">minify</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2955"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2955"><span class="linenos">2955</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">scourString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2956"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2956"><span class="linenos">2956</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2957"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2957"><span class="linenos">2957</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2958"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2958"><span class="linenos">2958</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2959"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2959"><span class="linenos">2959</span></a>
</span><span id="ChartDrawer.generate_aspect_grid_only_svg_string-2960"><a href="#ChartDrawer.generate_aspect_grid_only_svg_string-2960"><span class="linenos">2960</span></a>        <span class="k">return</span> <span class="n">template</span>
</span></pre></div>


            <div class="docstring"><p>Render the aspect-grid-only chart SVG as a string.</p>

<p>Reads the aspect-grid XML template, generates the aspect grid based on chart type,
and applies optional CSS inlining and minification.</p>

<p>Args:
    minify (bool): Remove whitespace and quotes for compactness.
    remove_css_variables (bool): Embed CSS variable definitions.</p>

<p>Returns:
    str: SVG markup for the aspect grid only.</p>
</div>


                            </div>
                            <div id="ChartDrawer.save_aspect_grid_only_svg_file" class="classattr">
                                        <input id="ChartDrawer.save_aspect_grid_only_svg_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_aspect_grid_only_svg_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ChartDrawer.save_aspect_grid_only_svg_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChartDrawer.save_aspect_grid_only_svg_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2962"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2962"><span class="linenos">2962</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_aspect_grid_only_svg_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2963"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2963"><span class="linenos">2963</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2964"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2964"><span class="linenos">2964</span></a><span class="sd">        Generate and save aspect-grid-only chart SVG to disk.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2965"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2965"><span class="linenos">2965</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2966"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2966"><span class="linenos">2966</span></a><span class="sd">        Calls generate_aspect_grid_only_svg_string and writes a file named</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2967"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2967"><span class="linenos">2967</span></a><span class="sd">        &quot;{subject.name} - {chart_type} Chart - Aspect Grid Only.svg&quot; in the specified output directory.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2968"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2968"><span class="linenos">2968</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2969"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2969"><span class="linenos">2969</span></a><span class="sd">        Args:</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2970"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2970"><span class="linenos">2970</span></a><span class="sd">            output_path (str, Path, or None): Directory path where the SVG file will be saved.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2971"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2971"><span class="linenos">2971</span></a><span class="sd">                If None, defaults to the user&#39;s home directory.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2972"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2972"><span class="linenos">2972</span></a><span class="sd">            filename (str or None): Custom filename for the SVG file (without extension).</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2973"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2973"><span class="linenos">2973</span></a><span class="sd">                If None, uses the default pattern: &quot;{subject.name} - {chart_type} Chart - Aspect Grid Only&quot;.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2974"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2974"><span class="linenos">2974</span></a><span class="sd">            minify (bool): Pass-through to generate_aspect_grid_only_svg_string for compact output.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2975"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2975"><span class="linenos">2975</span></a><span class="sd">            remove_css_variables (bool): Pass-through to generate_aspect_grid_only_svg_string to embed CSS variables.</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2976"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2976"><span class="linenos">2976</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2977"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2977"><span class="linenos">2977</span></a><span class="sd">        Returns:</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2978"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2978"><span class="linenos">2978</span></a><span class="sd">            None</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2979"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2979"><span class="linenos">2979</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2980"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2980"><span class="linenos">2980</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2981"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2981"><span class="linenos">2981</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_aspect_grid_only_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">)</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2982"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2982"><span class="linenos">2982</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2983"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2983"><span class="linenos">2983</span></a>        <span class="c1"># Convert output_path to Path object, default to home directory</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2984"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2984"><span class="linenos">2984</span></a>        <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2985"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2985"><span class="linenos">2985</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2986"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2986"><span class="linenos">2986</span></a>        <span class="c1"># Determine filename</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2987"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2987"><span class="linenos">2987</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2988"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2988"><span class="linenos">2988</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.svg&quot;</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2989"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2989"><span class="linenos">2989</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2990"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2990"><span class="linenos">2990</span></a>            <span class="c1"># Use default filename pattern</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2991"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2991"><span class="linenos">2991</span></a>            <span class="n">chart_type_for_filename</span> <span class="o">=</span> <span class="s2">&quot;ExternalNatal&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_view</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2992"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2992"><span class="linenos">2992</span></a>            <span class="n">chartname</span> <span class="o">=</span> <span class="n">output_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">chart_type_for_filename</span><span class="si">}</span><span class="s2"> Chart - Aspect Grid Only.svg&quot;</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2993"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2993"><span class="linenos">2993</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2994"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2994"><span class="linenos">2994</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chartname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2995"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2995"><span class="linenos">2995</span></a>            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2996"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2996"><span class="linenos">2996</span></a>
</span><span id="ChartDrawer.save_aspect_grid_only_svg_file-2997"><a href="#ChartDrawer.save_aspect_grid_only_svg_file-2997"><span class="linenos">2997</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG Generated Correctly in: </span><span class="si">{</span><span class="n">chartname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate and save aspect-grid-only chart SVG to disk.</p>

<p>Calls generate_aspect_grid_only_svg_string and writes a file named
"{subject.name} - {chart_type} Chart - Aspect Grid Only.svg" in the specified output directory.</p>

<p>Args:
    output_path (str, Path, or None): Directory path where the SVG file will be saved.
        If None, defaults to the user's home directory.
    filename (str or None): Custom filename for the SVG file (without extension).
        If None, uses the default pattern: "{subject.name} - {chart_type} Chart - Aspect Grid Only".
    minify (bool): Pass-through to generate_aspect_grid_only_svg_string for compact output.
    remove_css_variables (bool): Pass-through to generate_aspect_grid_only_svg_string to embed CSS variables.</p>

<p>Returns:
    None</p>
</div>


                            </div>
                </section>
                <section id="CompositeSubjectFactory">
                            <input id="CompositeSubjectFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CompositeSubjectFactory</span>:

                <label class="view-source-button" for="CompositeSubjectFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompositeSubjectFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompositeSubjectFactory-59"><a href="#CompositeSubjectFactory-59"><span class="linenos"> 59</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CompositeSubjectFactory</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-60"><a href="#CompositeSubjectFactory-60"><span class="linenos"> 60</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-61"><a href="#CompositeSubjectFactory-61"><span class="linenos"> 61</span></a><span class="sd">    Factory class to create composite astrological charts from two astrological subjects.</span>
</span><span id="CompositeSubjectFactory-62"><a href="#CompositeSubjectFactory-62"><span class="linenos"> 62</span></a>
</span><span id="CompositeSubjectFactory-63"><a href="#CompositeSubjectFactory-63"><span class="linenos"> 63</span></a><span class="sd">    A composite chart represents the relationship between two people by calculating the midpoint</span>
</span><span id="CompositeSubjectFactory-64"><a href="#CompositeSubjectFactory-64"><span class="linenos"> 64</span></a><span class="sd">    between corresponding planetary positions and house cusps. This creates a single chart</span>
</span><span id="CompositeSubjectFactory-65"><a href="#CompositeSubjectFactory-65"><span class="linenos"> 65</span></a><span class="sd">    that symbolizes the energy of the relationship itself.</span>
</span><span id="CompositeSubjectFactory-66"><a href="#CompositeSubjectFactory-66"><span class="linenos"> 66</span></a>
</span><span id="CompositeSubjectFactory-67"><a href="#CompositeSubjectFactory-67"><span class="linenos"> 67</span></a><span class="sd">    Currently supports the midpoint method for composite chart calculation, where:</span>
</span><span id="CompositeSubjectFactory-68"><a href="#CompositeSubjectFactory-68"><span class="linenos"> 68</span></a><span class="sd">    - Planetary positions are calculated as the circular mean of corresponding planets</span>
</span><span id="CompositeSubjectFactory-69"><a href="#CompositeSubjectFactory-69"><span class="linenos"> 69</span></a><span class="sd">    - House cusps are calculated as the circular mean of corresponding houses</span>
</span><span id="CompositeSubjectFactory-70"><a href="#CompositeSubjectFactory-70"><span class="linenos"> 70</span></a><span class="sd">    - Houses are reordered to maintain consistency with the original house system</span>
</span><span id="CompositeSubjectFactory-71"><a href="#CompositeSubjectFactory-71"><span class="linenos"> 71</span></a><span class="sd">    - Only common active points between both subjects are included</span>
</span><span id="CompositeSubjectFactory-72"><a href="#CompositeSubjectFactory-72"><span class="linenos"> 72</span></a>
</span><span id="CompositeSubjectFactory-73"><a href="#CompositeSubjectFactory-73"><span class="linenos"> 73</span></a><span class="sd">    The resulting composite chart maintains the zodiac type, sidereal mode, houses system,</span>
</span><span id="CompositeSubjectFactory-74"><a href="#CompositeSubjectFactory-74"><span class="linenos"> 74</span></a><span class="sd">    and perspective type of the input subjects (which must be identical between subjects).</span>
</span><span id="CompositeSubjectFactory-75"><a href="#CompositeSubjectFactory-75"><span class="linenos"> 75</span></a>
</span><span id="CompositeSubjectFactory-76"><a href="#CompositeSubjectFactory-76"><span class="linenos"> 76</span></a><span class="sd">    Attributes:</span>
</span><span id="CompositeSubjectFactory-77"><a href="#CompositeSubjectFactory-77"><span class="linenos"> 77</span></a><span class="sd">        model (CompositeSubjectModel | None): The generated composite subject model</span>
</span><span id="CompositeSubjectFactory-78"><a href="#CompositeSubjectFactory-78"><span class="linenos"> 78</span></a><span class="sd">        first_subject (AstrologicalSubjectModel): First astrological subject</span>
</span><span id="CompositeSubjectFactory-79"><a href="#CompositeSubjectFactory-79"><span class="linenos"> 79</span></a><span class="sd">        second_subject (AstrologicalSubjectModel): Second astrological subject</span>
</span><span id="CompositeSubjectFactory-80"><a href="#CompositeSubjectFactory-80"><span class="linenos"> 80</span></a><span class="sd">        name (str): Name of the composite chart</span>
</span><span id="CompositeSubjectFactory-81"><a href="#CompositeSubjectFactory-81"><span class="linenos"> 81</span></a><span class="sd">        composite_chart_type (CompositeChartType): Type of composite chart (currently &quot;Midpoint&quot;)</span>
</span><span id="CompositeSubjectFactory-82"><a href="#CompositeSubjectFactory-82"><span class="linenos"> 82</span></a><span class="sd">        zodiac_type (ZodiacType): Zodiac system used (Tropical or Sidereal)</span>
</span><span id="CompositeSubjectFactory-83"><a href="#CompositeSubjectFactory-83"><span class="linenos"> 83</span></a><span class="sd">        sidereal_mode (SiderealMode | None): Sidereal calculation mode if applicable</span>
</span><span id="CompositeSubjectFactory-84"><a href="#CompositeSubjectFactory-84"><span class="linenos"> 84</span></a><span class="sd">        houses_system_identifier (HousesSystemIdentifier): House system identifier</span>
</span><span id="CompositeSubjectFactory-85"><a href="#CompositeSubjectFactory-85"><span class="linenos"> 85</span></a><span class="sd">        houses_system_name (str): Human-readable house system name</span>
</span><span id="CompositeSubjectFactory-86"><a href="#CompositeSubjectFactory-86"><span class="linenos"> 86</span></a><span class="sd">        perspective_type (PerspectiveType): Astrological perspective type</span>
</span><span id="CompositeSubjectFactory-87"><a href="#CompositeSubjectFactory-87"><span class="linenos"> 87</span></a><span class="sd">        houses_names_list (list[Houses]): List of house names</span>
</span><span id="CompositeSubjectFactory-88"><a href="#CompositeSubjectFactory-88"><span class="linenos"> 88</span></a><span class="sd">        active_points (list[AstrologicalPoint]): Common active planetary points</span>
</span><span id="CompositeSubjectFactory-89"><a href="#CompositeSubjectFactory-89"><span class="linenos"> 89</span></a>
</span><span id="CompositeSubjectFactory-90"><a href="#CompositeSubjectFactory-90"><span class="linenos"> 90</span></a><span class="sd">    Example:</span>
</span><span id="CompositeSubjectFactory-91"><a href="#CompositeSubjectFactory-91"><span class="linenos"> 91</span></a><span class="sd">        &gt;&gt;&gt; first_person = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="CompositeSubjectFactory-92"><a href="#CompositeSubjectFactory-92"><span class="linenos"> 92</span></a><span class="sd">        ...     &quot;John&quot;, 1990, 1, 1, 12, 0, &quot;New York&quot;, &quot;US&quot;</span>
</span><span id="CompositeSubjectFactory-93"><a href="#CompositeSubjectFactory-93"><span class="linenos"> 93</span></a><span class="sd">        ... )</span>
</span><span id="CompositeSubjectFactory-94"><a href="#CompositeSubjectFactory-94"><span class="linenos"> 94</span></a><span class="sd">        &gt;&gt;&gt; second_person = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="CompositeSubjectFactory-95"><a href="#CompositeSubjectFactory-95"><span class="linenos"> 95</span></a><span class="sd">        ...     &quot;Jane&quot;, 1992, 6, 15, 14, 30, &quot;Los Angeles&quot;, &quot;US&quot;</span>
</span><span id="CompositeSubjectFactory-96"><a href="#CompositeSubjectFactory-96"><span class="linenos"> 96</span></a><span class="sd">        ... )</span>
</span><span id="CompositeSubjectFactory-97"><a href="#CompositeSubjectFactory-97"><span class="linenos"> 97</span></a><span class="sd">        &gt;&gt;&gt; composite = CompositeSubjectFactory(first_person, second_person)</span>
</span><span id="CompositeSubjectFactory-98"><a href="#CompositeSubjectFactory-98"><span class="linenos"> 98</span></a><span class="sd">        &gt;&gt;&gt; composite_model = composite.get_midpoint_composite_subject_model()</span>
</span><span id="CompositeSubjectFactory-99"><a href="#CompositeSubjectFactory-99"><span class="linenos"> 99</span></a>
</span><span id="CompositeSubjectFactory-100"><a href="#CompositeSubjectFactory-100"><span class="linenos">100</span></a><span class="sd">    Raises:</span>
</span><span id="CompositeSubjectFactory-101"><a href="#CompositeSubjectFactory-101"><span class="linenos">101</span></a><span class="sd">        KerykeionException: When subjects have incompatible settings (different zodiac types,</span>
</span><span id="CompositeSubjectFactory-102"><a href="#CompositeSubjectFactory-102"><span class="linenos">102</span></a><span class="sd">                           sidereal modes, house systems, or perspective types)</span>
</span><span id="CompositeSubjectFactory-103"><a href="#CompositeSubjectFactory-103"><span class="linenos">103</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-104"><a href="#CompositeSubjectFactory-104"><span class="linenos">104</span></a>
</span><span id="CompositeSubjectFactory-105"><a href="#CompositeSubjectFactory-105"><span class="linenos">105</span></a>    <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="CompositeSubjectFactory-106"><a href="#CompositeSubjectFactory-106"><span class="linenos">106</span></a>    <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span>
</span><span id="CompositeSubjectFactory-107"><a href="#CompositeSubjectFactory-107"><span class="linenos">107</span></a>    <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span>
</span><span id="CompositeSubjectFactory-108"><a href="#CompositeSubjectFactory-108"><span class="linenos">108</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="CompositeSubjectFactory-109"><a href="#CompositeSubjectFactory-109"><span class="linenos">109</span></a>    <span class="n">composite_chart_type</span><span class="p">:</span> <span class="n">CompositeChartType</span>
</span><span id="CompositeSubjectFactory-110"><a href="#CompositeSubjectFactory-110"><span class="linenos">110</span></a>    <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span>
</span><span id="CompositeSubjectFactory-111"><a href="#CompositeSubjectFactory-111"><span class="linenos">111</span></a>    <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="CompositeSubjectFactory-112"><a href="#CompositeSubjectFactory-112"><span class="linenos">112</span></a>    <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span>
</span><span id="CompositeSubjectFactory-113"><a href="#CompositeSubjectFactory-113"><span class="linenos">113</span></a>    <span class="n">houses_system_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="CompositeSubjectFactory-114"><a href="#CompositeSubjectFactory-114"><span class="linenos">114</span></a>    <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span>
</span><span id="CompositeSubjectFactory-115"><a href="#CompositeSubjectFactory-115"><span class="linenos">115</span></a>    <span class="n">houses_names_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Houses</span><span class="p">]</span>
</span><span id="CompositeSubjectFactory-116"><a href="#CompositeSubjectFactory-116"><span class="linenos">116</span></a>    <span class="n">active_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span>
</span><span id="CompositeSubjectFactory-117"><a href="#CompositeSubjectFactory-117"><span class="linenos">117</span></a>
</span><span id="CompositeSubjectFactory-118"><a href="#CompositeSubjectFactory-118"><span class="linenos">118</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-119"><a href="#CompositeSubjectFactory-119"><span class="linenos">119</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory-120"><a href="#CompositeSubjectFactory-120"><span class="linenos">120</span></a>            <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory-121"><a href="#CompositeSubjectFactory-121"><span class="linenos">121</span></a>            <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory-122"><a href="#CompositeSubjectFactory-122"><span class="linenos">122</span></a>            <span class="n">chart_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CompositeSubjectFactory-123"><a href="#CompositeSubjectFactory-123"><span class="linenos">123</span></a>    <span class="p">):</span>
</span><span id="CompositeSubjectFactory-124"><a href="#CompositeSubjectFactory-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-125"><a href="#CompositeSubjectFactory-125"><span class="linenos">125</span></a><span class="sd">        Initialize the composite subject factory with two astrological subjects.</span>
</span><span id="CompositeSubjectFactory-126"><a href="#CompositeSubjectFactory-126"><span class="linenos">126</span></a>
</span><span id="CompositeSubjectFactory-127"><a href="#CompositeSubjectFactory-127"><span class="linenos">127</span></a><span class="sd">        Validates that both subjects have compatible settings and extracts common</span>
</span><span id="CompositeSubjectFactory-128"><a href="#CompositeSubjectFactory-128"><span class="linenos">128</span></a><span class="sd">        active points for composite chart calculation.</span>
</span><span id="CompositeSubjectFactory-129"><a href="#CompositeSubjectFactory-129"><span class="linenos">129</span></a>
</span><span id="CompositeSubjectFactory-130"><a href="#CompositeSubjectFactory-130"><span class="linenos">130</span></a><span class="sd">        Args:</span>
</span><span id="CompositeSubjectFactory-131"><a href="#CompositeSubjectFactory-131"><span class="linenos">131</span></a><span class="sd">            first_subject (AstrologicalSubjectModel): First astrological subject for the composite</span>
</span><span id="CompositeSubjectFactory-132"><a href="#CompositeSubjectFactory-132"><span class="linenos">132</span></a><span class="sd">            second_subject (AstrologicalSubjectModel): Second astrological subject for the composite</span>
</span><span id="CompositeSubjectFactory-133"><a href="#CompositeSubjectFactory-133"><span class="linenos">133</span></a><span class="sd">            chart_name (str | None, optional): Custom name for the composite chart.</span>
</span><span id="CompositeSubjectFactory-134"><a href="#CompositeSubjectFactory-134"><span class="linenos">134</span></a><span class="sd">                                             If None, generates name from subject names.</span>
</span><span id="CompositeSubjectFactory-135"><a href="#CompositeSubjectFactory-135"><span class="linenos">135</span></a><span class="sd">                                             Defaults to None.</span>
</span><span id="CompositeSubjectFactory-136"><a href="#CompositeSubjectFactory-136"><span class="linenos">136</span></a>
</span><span id="CompositeSubjectFactory-137"><a href="#CompositeSubjectFactory-137"><span class="linenos">137</span></a><span class="sd">        Raises:</span>
</span><span id="CompositeSubjectFactory-138"><a href="#CompositeSubjectFactory-138"><span class="linenos">138</span></a><span class="sd">            KerykeionException: If subjects have different zodiac types, sidereal modes,</span>
</span><span id="CompositeSubjectFactory-139"><a href="#CompositeSubjectFactory-139"><span class="linenos">139</span></a><span class="sd">                              house systems, house system names, or perspective types.</span>
</span><span id="CompositeSubjectFactory-140"><a href="#CompositeSubjectFactory-140"><span class="linenos">140</span></a>
</span><span id="CompositeSubjectFactory-141"><a href="#CompositeSubjectFactory-141"><span class="linenos">141</span></a><span class="sd">        Note:</span>
</span><span id="CompositeSubjectFactory-142"><a href="#CompositeSubjectFactory-142"><span class="linenos">142</span></a><span class="sd">            Both subjects must have identical astrological calculation settings to ensure</span>
</span><span id="CompositeSubjectFactory-143"><a href="#CompositeSubjectFactory-143"><span class="linenos">143</span></a><span class="sd">            meaningful composite chart calculations.</span>
</span><span id="CompositeSubjectFactory-144"><a href="#CompositeSubjectFactory-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-145"><a href="#CompositeSubjectFactory-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CompositeSubjectFactory-146"><a href="#CompositeSubjectFactory-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">composite_chart_type</span> <span class="o">=</span> <span class="s2">&quot;Midpoint&quot;</span>
</span><span id="CompositeSubjectFactory-147"><a href="#CompositeSubjectFactory-147"><span class="linenos">147</span></a>
</span><span id="CompositeSubjectFactory-148"><a href="#CompositeSubjectFactory-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span> <span class="o">=</span> <span class="n">first_subject</span>
</span><span id="CompositeSubjectFactory-149"><a href="#CompositeSubjectFactory-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span> <span class="o">=</span> <span class="n">second_subject</span>
</span><span id="CompositeSubjectFactory-150"><a href="#CompositeSubjectFactory-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-151"><a href="#CompositeSubjectFactory-151"><span class="linenos">151</span></a>            <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory-152"><a href="#CompositeSubjectFactory-152"><span class="linenos">152</span></a>            <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="CompositeSubjectFactory-153"><a href="#CompositeSubjectFactory-153"><span class="linenos">153</span></a>        <span class="p">)</span>
</span><span id="CompositeSubjectFactory-154"><a href="#CompositeSubjectFactory-154"><span class="linenos">154</span></a>
</span><span id="CompositeSubjectFactory-155"><a href="#CompositeSubjectFactory-155"><span class="linenos">155</span></a>        <span class="c1"># Name</span>
</span><span id="CompositeSubjectFactory-156"><a href="#CompositeSubjectFactory-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">chart_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-157"><a href="#CompositeSubjectFactory-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Composite Chart&quot;</span>
</span><span id="CompositeSubjectFactory-158"><a href="#CompositeSubjectFactory-158"><span class="linenos">158</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-159"><a href="#CompositeSubjectFactory-159"><span class="linenos">159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">chart_name</span>
</span><span id="CompositeSubjectFactory-160"><a href="#CompositeSubjectFactory-160"><span class="linenos">160</span></a>
</span><span id="CompositeSubjectFactory-161"><a href="#CompositeSubjectFactory-161"><span class="linenos">161</span></a>        <span class="c1"># Zodiac Type</span>
</span><span id="CompositeSubjectFactory-162"><a href="#CompositeSubjectFactory-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-163"><a href="#CompositeSubjectFactory-163"><span class="linenos">163</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same zodiac type&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-164"><a href="#CompositeSubjectFactory-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">zodiac_type</span>
</span><span id="CompositeSubjectFactory-165"><a href="#CompositeSubjectFactory-165"><span class="linenos">165</span></a>
</span><span id="CompositeSubjectFactory-166"><a href="#CompositeSubjectFactory-166"><span class="linenos">166</span></a>        <span class="c1"># Sidereal Mode</span>
</span><span id="CompositeSubjectFactory-167"><a href="#CompositeSubjectFactory-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-168"><a href="#CompositeSubjectFactory-168"><span class="linenos">168</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same sidereal mode&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-169"><a href="#CompositeSubjectFactory-169"><span class="linenos">169</span></a>
</span><span id="CompositeSubjectFactory-170"><a href="#CompositeSubjectFactory-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-171"><a href="#CompositeSubjectFactory-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">sidereal_mode</span>
</span><span id="CompositeSubjectFactory-172"><a href="#CompositeSubjectFactory-172"><span class="linenos">172</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-173"><a href="#CompositeSubjectFactory-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CompositeSubjectFactory-174"><a href="#CompositeSubjectFactory-174"><span class="linenos">174</span></a>
</span><span id="CompositeSubjectFactory-175"><a href="#CompositeSubjectFactory-175"><span class="linenos">175</span></a>        <span class="c1"># Houses System</span>
</span><span id="CompositeSubjectFactory-176"><a href="#CompositeSubjectFactory-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_identifier</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-177"><a href="#CompositeSubjectFactory-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same houses system&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-178"><a href="#CompositeSubjectFactory-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_identifier</span>
</span><span id="CompositeSubjectFactory-179"><a href="#CompositeSubjectFactory-179"><span class="linenos">179</span></a>
</span><span id="CompositeSubjectFactory-180"><a href="#CompositeSubjectFactory-180"><span class="linenos">180</span></a>        <span class="c1"># Houses System Name</span>
</span><span id="CompositeSubjectFactory-181"><a href="#CompositeSubjectFactory-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_name</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-182"><a href="#CompositeSubjectFactory-182"><span class="linenos">182</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same houses system name&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-183"><a href="#CompositeSubjectFactory-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_system_name</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_name</span>
</span><span id="CompositeSubjectFactory-184"><a href="#CompositeSubjectFactory-184"><span class="linenos">184</span></a>
</span><span id="CompositeSubjectFactory-185"><a href="#CompositeSubjectFactory-185"><span class="linenos">185</span></a>        <span class="c1"># Perspective Type</span>
</span><span id="CompositeSubjectFactory-186"><a href="#CompositeSubjectFactory-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">perspective_type</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-187"><a href="#CompositeSubjectFactory-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same perspective type&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-188"><a href="#CompositeSubjectFactory-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">perspective_type</span>
</span><span id="CompositeSubjectFactory-189"><a href="#CompositeSubjectFactory-189"><span class="linenos">189</span></a>
</span><span id="CompositeSubjectFactory-190"><a href="#CompositeSubjectFactory-190"><span class="linenos">190</span></a>        <span class="c1"># Planets Names List</span>
</span><span id="CompositeSubjectFactory-191"><a href="#CompositeSubjectFactory-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CompositeSubjectFactory-192"><a href="#CompositeSubjectFactory-192"><span class="linenos">192</span></a>        <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-193"><a href="#CompositeSubjectFactory-193"><span class="linenos">193</span></a>            <span class="k">if</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-194"><a href="#CompositeSubjectFactory-194"><span class="linenos">194</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">planet</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-195"><a href="#CompositeSubjectFactory-195"><span class="linenos">195</span></a>
</span><span id="CompositeSubjectFactory-196"><a href="#CompositeSubjectFactory-196"><span class="linenos">196</span></a>        <span class="c1"># Houses Names List</span>
</span><span id="CompositeSubjectFactory-197"><a href="#CompositeSubjectFactory-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_names_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">houses_names_list</span>
</span><span id="CompositeSubjectFactory-198"><a href="#CompositeSubjectFactory-198"><span class="linenos">198</span></a>
</span><span id="CompositeSubjectFactory-199"><a href="#CompositeSubjectFactory-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-200"><a href="#CompositeSubjectFactory-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-201"><a href="#CompositeSubjectFactory-201"><span class="linenos">201</span></a><span class="sd">        Return string representation of the composite subject.</span>
</span><span id="CompositeSubjectFactory-202"><a href="#CompositeSubjectFactory-202"><span class="linenos">202</span></a>
</span><span id="CompositeSubjectFactory-203"><a href="#CompositeSubjectFactory-203"><span class="linenos">203</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-204"><a href="#CompositeSubjectFactory-204"><span class="linenos">204</span></a><span class="sd">            str: Human-readable string describing the composite chart.</span>
</span><span id="CompositeSubjectFactory-205"><a href="#CompositeSubjectFactory-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-206"><a href="#CompositeSubjectFactory-206"><span class="linenos">206</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Composite Chart Data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CompositeSubjectFactory-207"><a href="#CompositeSubjectFactory-207"><span class="linenos">207</span></a>
</span><span id="CompositeSubjectFactory-208"><a href="#CompositeSubjectFactory-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-209"><a href="#CompositeSubjectFactory-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-210"><a href="#CompositeSubjectFactory-210"><span class="linenos">210</span></a><span class="sd">        Return detailed string representation of the composite subject.</span>
</span><span id="CompositeSubjectFactory-211"><a href="#CompositeSubjectFactory-211"><span class="linenos">211</span></a>
</span><span id="CompositeSubjectFactory-212"><a href="#CompositeSubjectFactory-212"><span class="linenos">212</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-213"><a href="#CompositeSubjectFactory-213"><span class="linenos">213</span></a><span class="sd">            str: Detailed string representation for debugging purposes.</span>
</span><span id="CompositeSubjectFactory-214"><a href="#CompositeSubjectFactory-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-215"><a href="#CompositeSubjectFactory-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Composite Chart Data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CompositeSubjectFactory-216"><a href="#CompositeSubjectFactory-216"><span class="linenos">216</span></a>
</span><span id="CompositeSubjectFactory-217"><a href="#CompositeSubjectFactory-217"><span class="linenos">217</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-218"><a href="#CompositeSubjectFactory-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-219"><a href="#CompositeSubjectFactory-219"><span class="linenos">219</span></a><span class="sd">        Check equality with another composite subject.</span>
</span><span id="CompositeSubjectFactory-220"><a href="#CompositeSubjectFactory-220"><span class="linenos">220</span></a>
</span><span id="CompositeSubjectFactory-221"><a href="#CompositeSubjectFactory-221"><span class="linenos">221</span></a><span class="sd">        Args:</span>
</span><span id="CompositeSubjectFactory-222"><a href="#CompositeSubjectFactory-222"><span class="linenos">222</span></a><span class="sd">            other (CompositeSubjectFactory): Another composite subject to compare with.</span>
</span><span id="CompositeSubjectFactory-223"><a href="#CompositeSubjectFactory-223"><span class="linenos">223</span></a>
</span><span id="CompositeSubjectFactory-224"><a href="#CompositeSubjectFactory-224"><span class="linenos">224</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-225"><a href="#CompositeSubjectFactory-225"><span class="linenos">225</span></a><span class="sd">            bool: True if both subjects and chart name are identical.</span>
</span><span id="CompositeSubjectFactory-226"><a href="#CompositeSubjectFactory-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-227"><a href="#CompositeSubjectFactory-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">first_subject</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">second_subject</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">chart_name</span>
</span><span id="CompositeSubjectFactory-228"><a href="#CompositeSubjectFactory-228"><span class="linenos">228</span></a>
</span><span id="CompositeSubjectFactory-229"><a href="#CompositeSubjectFactory-229"><span class="linenos">229</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-230"><a href="#CompositeSubjectFactory-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-231"><a href="#CompositeSubjectFactory-231"><span class="linenos">231</span></a><span class="sd">        Check inequality with another composite subject.</span>
</span><span id="CompositeSubjectFactory-232"><a href="#CompositeSubjectFactory-232"><span class="linenos">232</span></a>
</span><span id="CompositeSubjectFactory-233"><a href="#CompositeSubjectFactory-233"><span class="linenos">233</span></a><span class="sd">        Args:</span>
</span><span id="CompositeSubjectFactory-234"><a href="#CompositeSubjectFactory-234"><span class="linenos">234</span></a><span class="sd">            other (CompositeSubjectFactory): Another composite subject to compare with.</span>
</span><span id="CompositeSubjectFactory-235"><a href="#CompositeSubjectFactory-235"><span class="linenos">235</span></a>
</span><span id="CompositeSubjectFactory-236"><a href="#CompositeSubjectFactory-236"><span class="linenos">236</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-237"><a href="#CompositeSubjectFactory-237"><span class="linenos">237</span></a><span class="sd">            bool: True if subjects or chart name are different.</span>
</span><span id="CompositeSubjectFactory-238"><a href="#CompositeSubjectFactory-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-239"><a href="#CompositeSubjectFactory-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-240"><a href="#CompositeSubjectFactory-240"><span class="linenos">240</span></a>
</span><span id="CompositeSubjectFactory-241"><a href="#CompositeSubjectFactory-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-242"><a href="#CompositeSubjectFactory-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-243"><a href="#CompositeSubjectFactory-243"><span class="linenos">243</span></a><span class="sd">        Generate hash for the composite subject.</span>
</span><span id="CompositeSubjectFactory-244"><a href="#CompositeSubjectFactory-244"><span class="linenos">244</span></a>
</span><span id="CompositeSubjectFactory-245"><a href="#CompositeSubjectFactory-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-246"><a href="#CompositeSubjectFactory-246"><span class="linenos">246</span></a><span class="sd">            int: Hash value based on both subjects and chart name.</span>
</span><span id="CompositeSubjectFactory-247"><a href="#CompositeSubjectFactory-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-248"><a href="#CompositeSubjectFactory-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</span><span id="CompositeSubjectFactory-249"><a href="#CompositeSubjectFactory-249"><span class="linenos">249</span></a>
</span><span id="CompositeSubjectFactory-250"><a href="#CompositeSubjectFactory-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-251"><a href="#CompositeSubjectFactory-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-252"><a href="#CompositeSubjectFactory-252"><span class="linenos">252</span></a><span class="sd">        Create a shallow copy of the composite subject.</span>
</span><span id="CompositeSubjectFactory-253"><a href="#CompositeSubjectFactory-253"><span class="linenos">253</span></a>
</span><span id="CompositeSubjectFactory-254"><a href="#CompositeSubjectFactory-254"><span class="linenos">254</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-255"><a href="#CompositeSubjectFactory-255"><span class="linenos">255</span></a><span class="sd">            CompositeSubjectFactory: New instance with the same subjects and name.</span>
</span><span id="CompositeSubjectFactory-256"><a href="#CompositeSubjectFactory-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-257"><a href="#CompositeSubjectFactory-257"><span class="linenos">257</span></a>        <span class="k">return</span> <span class="n">CompositeSubjectFactory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-258"><a href="#CompositeSubjectFactory-258"><span class="linenos">258</span></a>
</span><span id="CompositeSubjectFactory-259"><a href="#CompositeSubjectFactory-259"><span class="linenos">259</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-260"><a href="#CompositeSubjectFactory-260"><span class="linenos">260</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-261"><a href="#CompositeSubjectFactory-261"><span class="linenos">261</span></a><span class="sd">        Set an attribute using dictionary-style access.</span>
</span><span id="CompositeSubjectFactory-262"><a href="#CompositeSubjectFactory-262"><span class="linenos">262</span></a>
</span><span id="CompositeSubjectFactory-263"><a href="#CompositeSubjectFactory-263"><span class="linenos">263</span></a><span class="sd">        Args:</span>
</span><span id="CompositeSubjectFactory-264"><a href="#CompositeSubjectFactory-264"><span class="linenos">264</span></a><span class="sd">            key (str): Attribute name to set.</span>
</span><span id="CompositeSubjectFactory-265"><a href="#CompositeSubjectFactory-265"><span class="linenos">265</span></a><span class="sd">            value: Value to assign to the attribute.</span>
</span><span id="CompositeSubjectFactory-266"><a href="#CompositeSubjectFactory-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-267"><a href="#CompositeSubjectFactory-267"><span class="linenos">267</span></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-268"><a href="#CompositeSubjectFactory-268"><span class="linenos">268</span></a>
</span><span id="CompositeSubjectFactory-269"><a href="#CompositeSubjectFactory-269"><span class="linenos">269</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-270"><a href="#CompositeSubjectFactory-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-271"><a href="#CompositeSubjectFactory-271"><span class="linenos">271</span></a><span class="sd">        Get an attribute using dictionary-style access.</span>
</span><span id="CompositeSubjectFactory-272"><a href="#CompositeSubjectFactory-272"><span class="linenos">272</span></a>
</span><span id="CompositeSubjectFactory-273"><a href="#CompositeSubjectFactory-273"><span class="linenos">273</span></a><span class="sd">        Args:</span>
</span><span id="CompositeSubjectFactory-274"><a href="#CompositeSubjectFactory-274"><span class="linenos">274</span></a><span class="sd">            key (str): Attribute name to retrieve.</span>
</span><span id="CompositeSubjectFactory-275"><a href="#CompositeSubjectFactory-275"><span class="linenos">275</span></a>
</span><span id="CompositeSubjectFactory-276"><a href="#CompositeSubjectFactory-276"><span class="linenos">276</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-277"><a href="#CompositeSubjectFactory-277"><span class="linenos">277</span></a><span class="sd">            Any: Value of the requested attribute.</span>
</span><span id="CompositeSubjectFactory-278"><a href="#CompositeSubjectFactory-278"><span class="linenos">278</span></a>
</span><span id="CompositeSubjectFactory-279"><a href="#CompositeSubjectFactory-279"><span class="linenos">279</span></a><span class="sd">        Raises:</span>
</span><span id="CompositeSubjectFactory-280"><a href="#CompositeSubjectFactory-280"><span class="linenos">280</span></a><span class="sd">            AttributeError: If the attribute doesn&#39;t exist.</span>
</span><span id="CompositeSubjectFactory-281"><a href="#CompositeSubjectFactory-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-282"><a href="#CompositeSubjectFactory-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-283"><a href="#CompositeSubjectFactory-283"><span class="linenos">283</span></a>
</span><span id="CompositeSubjectFactory-284"><a href="#CompositeSubjectFactory-284"><span class="linenos">284</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_midpoint_composite_points_and_houses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-285"><a href="#CompositeSubjectFactory-285"><span class="linenos">285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-286"><a href="#CompositeSubjectFactory-286"><span class="linenos">286</span></a><span class="sd">        Calculate midpoint positions for all planets and house cusps in the composite chart.</span>
</span><span id="CompositeSubjectFactory-287"><a href="#CompositeSubjectFactory-287"><span class="linenos">287</span></a>
</span><span id="CompositeSubjectFactory-288"><a href="#CompositeSubjectFactory-288"><span class="linenos">288</span></a><span class="sd">        This method implements the midpoint composite technique by:</span>
</span><span id="CompositeSubjectFactory-289"><a href="#CompositeSubjectFactory-289"><span class="linenos">289</span></a><span class="sd">        1. Computing circular means of house cusp positions from both subjects</span>
</span><span id="CompositeSubjectFactory-290"><a href="#CompositeSubjectFactory-290"><span class="linenos">290</span></a><span class="sd">        2. Sorting house positions to maintain proper house order</span>
</span><span id="CompositeSubjectFactory-291"><a href="#CompositeSubjectFactory-291"><span class="linenos">291</span></a><span class="sd">        3. Creating composite house cusps with calculated positions</span>
</span><span id="CompositeSubjectFactory-292"><a href="#CompositeSubjectFactory-292"><span class="linenos">292</span></a><span class="sd">        4. Computing circular means of planetary positions for common active points</span>
</span><span id="CompositeSubjectFactory-293"><a href="#CompositeSubjectFactory-293"><span class="linenos">293</span></a><span class="sd">        5. Assigning planets to their appropriate houses in the composite chart</span>
</span><span id="CompositeSubjectFactory-294"><a href="#CompositeSubjectFactory-294"><span class="linenos">294</span></a>
</span><span id="CompositeSubjectFactory-295"><a href="#CompositeSubjectFactory-295"><span class="linenos">295</span></a><span class="sd">        The circular mean calculation ensures proper handling of zodiacal positions</span>
</span><span id="CompositeSubjectFactory-296"><a href="#CompositeSubjectFactory-296"><span class="linenos">296</span></a><span class="sd">        around the 360-degree boundary (e.g., when one position is at 350 and</span>
</span><span id="CompositeSubjectFactory-297"><a href="#CompositeSubjectFactory-297"><span class="linenos">297</span></a><span class="sd">        another at 10, the midpoint is correctly calculated as 0).</span>
</span><span id="CompositeSubjectFactory-298"><a href="#CompositeSubjectFactory-298"><span class="linenos">298</span></a>
</span><span id="CompositeSubjectFactory-299"><a href="#CompositeSubjectFactory-299"><span class="linenos">299</span></a><span class="sd">        Side Effects:</span>
</span><span id="CompositeSubjectFactory-300"><a href="#CompositeSubjectFactory-300"><span class="linenos">300</span></a><span class="sd">            - Updates instance attributes with calculated house cusp positions</span>
</span><span id="CompositeSubjectFactory-301"><a href="#CompositeSubjectFactory-301"><span class="linenos">301</span></a><span class="sd">            - Updates instance attributes with calculated planetary positions</span>
</span><span id="CompositeSubjectFactory-302"><a href="#CompositeSubjectFactory-302"><span class="linenos">302</span></a><span class="sd">            - Sets house assignments for each planetary position</span>
</span><span id="CompositeSubjectFactory-303"><a href="#CompositeSubjectFactory-303"><span class="linenos">303</span></a>
</span><span id="CompositeSubjectFactory-304"><a href="#CompositeSubjectFactory-304"><span class="linenos">304</span></a><span class="sd">        Note:</span>
</span><span id="CompositeSubjectFactory-305"><a href="#CompositeSubjectFactory-305"><span class="linenos">305</span></a><span class="sd">            This is an internal method called by get_midpoint_composite_subject_model().</span>
</span><span id="CompositeSubjectFactory-306"><a href="#CompositeSubjectFactory-306"><span class="linenos">306</span></a><span class="sd">            Only planets that exist in both subjects&#39; active_points are included.</span>
</span><span id="CompositeSubjectFactory-307"><a href="#CompositeSubjectFactory-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-308"><a href="#CompositeSubjectFactory-308"><span class="linenos">308</span></a>        <span class="c1"># Houses</span>
</span><span id="CompositeSubjectFactory-309"><a href="#CompositeSubjectFactory-309"><span class="linenos">309</span></a>        <span class="n">house_degree_list_ut</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CompositeSubjectFactory-310"><a href="#CompositeSubjectFactory-310"><span class="linenos">310</span></a>        <span class="k">for</span> <span class="n">house</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">houses_names_list</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-311"><a href="#CompositeSubjectFactory-311"><span class="linenos">311</span></a>            <span class="n">house_lower</span> <span class="o">=</span> <span class="n">house</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory-312"><a href="#CompositeSubjectFactory-312"><span class="linenos">312</span></a>            <span class="n">house_degree_list_ut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-313"><a href="#CompositeSubjectFactory-313"><span class="linenos">313</span></a>                <span class="n">circular_mean</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-314"><a href="#CompositeSubjectFactory-314"><span class="linenos">314</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">[</span><span class="n">house_lower</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="CompositeSubjectFactory-315"><a href="#CompositeSubjectFactory-315"><span class="linenos">315</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">[</span><span class="n">house_lower</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">]</span>
</span><span id="CompositeSubjectFactory-316"><a href="#CompositeSubjectFactory-316"><span class="linenos">316</span></a>                <span class="p">)</span>
</span><span id="CompositeSubjectFactory-317"><a href="#CompositeSubjectFactory-317"><span class="linenos">317</span></a>        <span class="p">)</span>
</span><span id="CompositeSubjectFactory-318"><a href="#CompositeSubjectFactory-318"><span class="linenos">318</span></a>        <span class="n">house_degree_list_ut</span> <span class="o">=</span> <span class="n">circular_sort</span><span class="p">(</span><span class="n">house_degree_list_ut</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-319"><a href="#CompositeSubjectFactory-319"><span class="linenos">319</span></a>
</span><span id="CompositeSubjectFactory-320"><a href="#CompositeSubjectFactory-320"><span class="linenos">320</span></a>        <span class="k">for</span> <span class="n">house_index</span><span class="p">,</span> <span class="n">house_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">houses_names_list</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-321"><a href="#CompositeSubjectFactory-321"><span class="linenos">321</span></a>            <span class="n">house_lower</span> <span class="o">=</span> <span class="n">house_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory-322"><a href="#CompositeSubjectFactory-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">house_lower</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-323"><a href="#CompositeSubjectFactory-323"><span class="linenos">323</span></a>                <span class="n">house_degree_list_ut</span><span class="p">[</span><span class="n">house_index</span><span class="p">],</span>
</span><span id="CompositeSubjectFactory-324"><a href="#CompositeSubjectFactory-324"><span class="linenos">324</span></a>                <span class="n">house_name</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory-325"><a href="#CompositeSubjectFactory-325"><span class="linenos">325</span></a>                <span class="s2">&quot;House&quot;</span>
</span><span id="CompositeSubjectFactory-326"><a href="#CompositeSubjectFactory-326"><span class="linenos">326</span></a>            <span class="p">)</span>
</span><span id="CompositeSubjectFactory-327"><a href="#CompositeSubjectFactory-327"><span class="linenos">327</span></a>
</span><span id="CompositeSubjectFactory-328"><a href="#CompositeSubjectFactory-328"><span class="linenos">328</span></a>
</span><span id="CompositeSubjectFactory-329"><a href="#CompositeSubjectFactory-329"><span class="linenos">329</span></a>        <span class="c1"># Planets</span>
</span><span id="CompositeSubjectFactory-330"><a href="#CompositeSubjectFactory-330"><span class="linenos">330</span></a>        <span class="n">common_planets</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CompositeSubjectFactory-331"><a href="#CompositeSubjectFactory-331"><span class="linenos">331</span></a>        <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-332"><a href="#CompositeSubjectFactory-332"><span class="linenos">332</span></a>            <span class="k">if</span> <span class="n">planet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-333"><a href="#CompositeSubjectFactory-333"><span class="linenos">333</span></a>                <span class="n">common_planets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">planet</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-334"><a href="#CompositeSubjectFactory-334"><span class="linenos">334</span></a>
</span><span id="CompositeSubjectFactory-335"><a href="#CompositeSubjectFactory-335"><span class="linenos">335</span></a>        <span class="n">planets</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CompositeSubjectFactory-336"><a href="#CompositeSubjectFactory-336"><span class="linenos">336</span></a>        <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">common_planets</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory-337"><a href="#CompositeSubjectFactory-337"><span class="linenos">337</span></a>            <span class="n">planet_lower</span> <span class="o">=</span> <span class="n">planet</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory-338"><a href="#CompositeSubjectFactory-338"><span class="linenos">338</span></a>            <span class="n">planets</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CompositeSubjectFactory-339"><a href="#CompositeSubjectFactory-339"><span class="linenos">339</span></a>            <span class="n">planets</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">circular_mean</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-340"><a href="#CompositeSubjectFactory-340"><span class="linenos">340</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span>
</span><span id="CompositeSubjectFactory-341"><a href="#CompositeSubjectFactory-341"><span class="linenos">341</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">]</span>
</span><span id="CompositeSubjectFactory-342"><a href="#CompositeSubjectFactory-342"><span class="linenos">342</span></a>            <span class="p">)</span>
</span><span id="CompositeSubjectFactory-343"><a href="#CompositeSubjectFactory-343"><span class="linenos">343</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_kerykeion_point_from_degree</span><span class="p">(</span><span class="n">planets</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">][</span><span class="s2">&quot;abs_pos&quot;</span><span class="p">],</span> <span class="n">planet</span><span class="p">,</span> <span class="s2">&quot;AstrologicalPoint&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-344"><a href="#CompositeSubjectFactory-344"><span class="linenos">344</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">][</span><span class="s2">&quot;house&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_planet_house</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">planet_lower</span><span class="p">][</span><span class="s1">&#39;abs_pos&#39;</span><span class="p">],</span> <span class="n">house_degree_list_ut</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory-345"><a href="#CompositeSubjectFactory-345"><span class="linenos">345</span></a>
</span><span id="CompositeSubjectFactory-346"><a href="#CompositeSubjectFactory-346"><span class="linenos">346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_composite_lunar_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-347"><a href="#CompositeSubjectFactory-347"><span class="linenos">347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-348"><a href="#CompositeSubjectFactory-348"><span class="linenos">348</span></a><span class="sd">        Calculate the lunar phase for the composite chart based on Sun-Moon midpoints.</span>
</span><span id="CompositeSubjectFactory-349"><a href="#CompositeSubjectFactory-349"><span class="linenos">349</span></a>
</span><span id="CompositeSubjectFactory-350"><a href="#CompositeSubjectFactory-350"><span class="linenos">350</span></a><span class="sd">        Uses the composite positions of the Sun and Moon to determine the lunar phase</span>
</span><span id="CompositeSubjectFactory-351"><a href="#CompositeSubjectFactory-351"><span class="linenos">351</span></a><span class="sd">        angle, representing the relationship&#39;s emotional and instinctual dynamics.</span>
</span><span id="CompositeSubjectFactory-352"><a href="#CompositeSubjectFactory-352"><span class="linenos">352</span></a>
</span><span id="CompositeSubjectFactory-353"><a href="#CompositeSubjectFactory-353"><span class="linenos">353</span></a><span class="sd">        Side Effects:</span>
</span><span id="CompositeSubjectFactory-354"><a href="#CompositeSubjectFactory-354"><span class="linenos">354</span></a><span class="sd">            Sets the lunar_phase attribute with the calculated phase information.</span>
</span><span id="CompositeSubjectFactory-355"><a href="#CompositeSubjectFactory-355"><span class="linenos">355</span></a>
</span><span id="CompositeSubjectFactory-356"><a href="#CompositeSubjectFactory-356"><span class="linenos">356</span></a><span class="sd">        Note:</span>
</span><span id="CompositeSubjectFactory-357"><a href="#CompositeSubjectFactory-357"><span class="linenos">357</span></a><span class="sd">            This method should be called after _calculate_midpoint_composite_points_and_houses()</span>
</span><span id="CompositeSubjectFactory-358"><a href="#CompositeSubjectFactory-358"><span class="linenos">358</span></a><span class="sd">            to ensure Sun and Moon composite positions are available.</span>
</span><span id="CompositeSubjectFactory-359"><a href="#CompositeSubjectFactory-359"><span class="linenos">359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-360"><a href="#CompositeSubjectFactory-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lunar_phase</span> <span class="o">=</span> <span class="n">calculate_moon_phase</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-361"><a href="#CompositeSubjectFactory-361"><span class="linenos">361</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;moon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory-362"><a href="#CompositeSubjectFactory-362"><span class="linenos">362</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;sun&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs_pos</span>
</span><span id="CompositeSubjectFactory-363"><a href="#CompositeSubjectFactory-363"><span class="linenos">363</span></a>        <span class="p">)</span>
</span><span id="CompositeSubjectFactory-364"><a href="#CompositeSubjectFactory-364"><span class="linenos">364</span></a>
</span><span id="CompositeSubjectFactory-365"><a href="#CompositeSubjectFactory-365"><span class="linenos">365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_midpoint_composite_subject_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory-366"><a href="#CompositeSubjectFactory-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-367"><a href="#CompositeSubjectFactory-367"><span class="linenos">367</span></a><span class="sd">        Generate the complete composite chart model using the midpoint technique.</span>
</span><span id="CompositeSubjectFactory-368"><a href="#CompositeSubjectFactory-368"><span class="linenos">368</span></a>
</span><span id="CompositeSubjectFactory-369"><a href="#CompositeSubjectFactory-369"><span class="linenos">369</span></a><span class="sd">        This is the main public method for creating a composite chart. It orchestrates</span>
</span><span id="CompositeSubjectFactory-370"><a href="#CompositeSubjectFactory-370"><span class="linenos">370</span></a><span class="sd">        the calculation of all composite positions and creates a complete CompositeSubjectModel</span>
</span><span id="CompositeSubjectFactory-371"><a href="#CompositeSubjectFactory-371"><span class="linenos">371</span></a><span class="sd">        containing all necessary astrological data for the relationship chart.</span>
</span><span id="CompositeSubjectFactory-372"><a href="#CompositeSubjectFactory-372"><span class="linenos">372</span></a>
</span><span id="CompositeSubjectFactory-373"><a href="#CompositeSubjectFactory-373"><span class="linenos">373</span></a><span class="sd">        The process includes:</span>
</span><span id="CompositeSubjectFactory-374"><a href="#CompositeSubjectFactory-374"><span class="linenos">374</span></a><span class="sd">        1. Calculating midpoint positions for all planets and house cusps</span>
</span><span id="CompositeSubjectFactory-375"><a href="#CompositeSubjectFactory-375"><span class="linenos">375</span></a><span class="sd">        2. Computing the composite lunar phase</span>
</span><span id="CompositeSubjectFactory-376"><a href="#CompositeSubjectFactory-376"><span class="linenos">376</span></a><span class="sd">        3. Assembling all data into a comprehensive model</span>
</span><span id="CompositeSubjectFactory-377"><a href="#CompositeSubjectFactory-377"><span class="linenos">377</span></a>
</span><span id="CompositeSubjectFactory-378"><a href="#CompositeSubjectFactory-378"><span class="linenos">378</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory-379"><a href="#CompositeSubjectFactory-379"><span class="linenos">379</span></a><span class="sd">            CompositeSubjectModel: Complete composite chart data model containing:</span>
</span><span id="CompositeSubjectFactory-380"><a href="#CompositeSubjectFactory-380"><span class="linenos">380</span></a><span class="sd">                - All calculated planetary positions and their house placements</span>
</span><span id="CompositeSubjectFactory-381"><a href="#CompositeSubjectFactory-381"><span class="linenos">381</span></a><span class="sd">                - House cusp positions maintaining proper house system order</span>
</span><span id="CompositeSubjectFactory-382"><a href="#CompositeSubjectFactory-382"><span class="linenos">382</span></a><span class="sd">                - Lunar phase information for the composite chart</span>
</span><span id="CompositeSubjectFactory-383"><a href="#CompositeSubjectFactory-383"><span class="linenos">383</span></a><span class="sd">                - All metadata from the original subjects (names, chart type, etc.)</span>
</span><span id="CompositeSubjectFactory-384"><a href="#CompositeSubjectFactory-384"><span class="linenos">384</span></a>
</span><span id="CompositeSubjectFactory-385"><a href="#CompositeSubjectFactory-385"><span class="linenos">385</span></a><span class="sd">        Example:</span>
</span><span id="CompositeSubjectFactory-386"><a href="#CompositeSubjectFactory-386"><span class="linenos">386</span></a><span class="sd">            &gt;&gt;&gt; composite = CompositeSubjectFactory(person1, person2, &quot;Our Relationship&quot;)</span>
</span><span id="CompositeSubjectFactory-387"><a href="#CompositeSubjectFactory-387"><span class="linenos">387</span></a><span class="sd">            &gt;&gt;&gt; model = composite.get_midpoint_composite_subject_model()</span>
</span><span id="CompositeSubjectFactory-388"><a href="#CompositeSubjectFactory-388"><span class="linenos">388</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Composite Sun at {model.sun.abs_pos} in House {model.sun.house}&quot;)</span>
</span><span id="CompositeSubjectFactory-389"><a href="#CompositeSubjectFactory-389"><span class="linenos">389</span></a>
</span><span id="CompositeSubjectFactory-390"><a href="#CompositeSubjectFactory-390"><span class="linenos">390</span></a><span class="sd">        Note:</span>
</span><span id="CompositeSubjectFactory-391"><a href="#CompositeSubjectFactory-391"><span class="linenos">391</span></a><span class="sd">            This method performs all calculations internally and returns a complete,</span>
</span><span id="CompositeSubjectFactory-392"><a href="#CompositeSubjectFactory-392"><span class="linenos">392</span></a><span class="sd">            ready-to-use composite chart model suitable for analysis or chart drawing.</span>
</span><span id="CompositeSubjectFactory-393"><a href="#CompositeSubjectFactory-393"><span class="linenos">393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory-394"><a href="#CompositeSubjectFactory-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_midpoint_composite_points_and_houses</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory-395"><a href="#CompositeSubjectFactory-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_composite_lunar_phase</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory-396"><a href="#CompositeSubjectFactory-396"><span class="linenos">396</span></a>
</span><span id="CompositeSubjectFactory-397"><a href="#CompositeSubjectFactory-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="n">CompositeSubjectModel</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory-398"><a href="#CompositeSubjectFactory-398"><span class="linenos">398</span></a>            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</span><span id="CompositeSubjectFactory-399"><a href="#CompositeSubjectFactory-399"><span class="linenos">399</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Factory class to create composite astrological charts from two astrological subjects.</p>

<p>A composite chart represents the relationship between two people by calculating the midpoint
between corresponding planetary positions and house cusps. This creates a single chart
that symbolizes the energy of the relationship itself.</p>

<p>Currently supports the midpoint method for composite chart calculation, where:</p>

<ul>
<li>Planetary positions are calculated as the circular mean of corresponding planets</li>
<li>House cusps are calculated as the circular mean of corresponding houses</li>
<li>Houses are reordered to maintain consistency with the original house system</li>
<li>Only common active points between both subjects are included</li>
</ul>

<p>The resulting composite chart maintains the zodiac type, sidereal mode, houses system,
and perspective type of the input subjects (which must be identical between subjects).</p>

<p>Attributes:
    model (CompositeSubjectModel | None): The generated composite subject model
    first_subject (AstrologicalSubjectModel): First astrological subject
    second_subject (AstrologicalSubjectModel): Second astrological subject
    name (str): Name of the composite chart
    composite_chart_type (CompositeChartType): Type of composite chart (currently "Midpoint")
    zodiac_type (ZodiacType): Zodiac system used (Tropical or Sidereal)
    sidereal_mode (SiderealMode | None): Sidereal calculation mode if applicable
    houses_system_identifier (HousesSystemIdentifier): House system identifier
    houses_system_name (str): Human-readable house system name
    perspective_type (PerspectiveType): Astrological perspective type
    houses_names_list (list[Houses]): List of house names
    active_points (list[AstrologicalPoint]): Common active planetary points</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>first_person = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
          ...     "John", 1990, 1, 1, 12, 0, "New York", "US"
          ... )
      second_person = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
          ...     "Jane", 1992, 6, 15, 14, 30, "Los Angeles", "US"
          ... )
      composite = CompositeSubjectFactory(first_person, second_person)
      composite_model = composite.get_midpoint_composite_subject_model()</p>
    </blockquote>
  </blockquote>
</blockquote>

<p>Raises:
    KerykeionException: When subjects have incompatible settings (different zodiac types,
                       sidereal modes, house systems, or perspective types)</p>
</div>


                            <div id="CompositeSubjectFactory.__init__" class="classattr">
                                        <input id="CompositeSubjectFactory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CompositeSubjectFactory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">chart_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="CompositeSubjectFactory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompositeSubjectFactory.__init__-118"><a href="#CompositeSubjectFactory.__init__-118"><span class="linenos">118</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory.__init__-119"><a href="#CompositeSubjectFactory.__init__-119"><span class="linenos">119</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory.__init__-120"><a href="#CompositeSubjectFactory.__init__-120"><span class="linenos">120</span></a>            <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory.__init__-121"><a href="#CompositeSubjectFactory.__init__-121"><span class="linenos">121</span></a>            <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory.__init__-122"><a href="#CompositeSubjectFactory.__init__-122"><span class="linenos">122</span></a>            <span class="n">chart_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CompositeSubjectFactory.__init__-123"><a href="#CompositeSubjectFactory.__init__-123"><span class="linenos">123</span></a>    <span class="p">):</span>
</span><span id="CompositeSubjectFactory.__init__-124"><a href="#CompositeSubjectFactory.__init__-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory.__init__-125"><a href="#CompositeSubjectFactory.__init__-125"><span class="linenos">125</span></a><span class="sd">        Initialize the composite subject factory with two astrological subjects.</span>
</span><span id="CompositeSubjectFactory.__init__-126"><a href="#CompositeSubjectFactory.__init__-126"><span class="linenos">126</span></a>
</span><span id="CompositeSubjectFactory.__init__-127"><a href="#CompositeSubjectFactory.__init__-127"><span class="linenos">127</span></a><span class="sd">        Validates that both subjects have compatible settings and extracts common</span>
</span><span id="CompositeSubjectFactory.__init__-128"><a href="#CompositeSubjectFactory.__init__-128"><span class="linenos">128</span></a><span class="sd">        active points for composite chart calculation.</span>
</span><span id="CompositeSubjectFactory.__init__-129"><a href="#CompositeSubjectFactory.__init__-129"><span class="linenos">129</span></a>
</span><span id="CompositeSubjectFactory.__init__-130"><a href="#CompositeSubjectFactory.__init__-130"><span class="linenos">130</span></a><span class="sd">        Args:</span>
</span><span id="CompositeSubjectFactory.__init__-131"><a href="#CompositeSubjectFactory.__init__-131"><span class="linenos">131</span></a><span class="sd">            first_subject (AstrologicalSubjectModel): First astrological subject for the composite</span>
</span><span id="CompositeSubjectFactory.__init__-132"><a href="#CompositeSubjectFactory.__init__-132"><span class="linenos">132</span></a><span class="sd">            second_subject (AstrologicalSubjectModel): Second astrological subject for the composite</span>
</span><span id="CompositeSubjectFactory.__init__-133"><a href="#CompositeSubjectFactory.__init__-133"><span class="linenos">133</span></a><span class="sd">            chart_name (str | None, optional): Custom name for the composite chart.</span>
</span><span id="CompositeSubjectFactory.__init__-134"><a href="#CompositeSubjectFactory.__init__-134"><span class="linenos">134</span></a><span class="sd">                                             If None, generates name from subject names.</span>
</span><span id="CompositeSubjectFactory.__init__-135"><a href="#CompositeSubjectFactory.__init__-135"><span class="linenos">135</span></a><span class="sd">                                             Defaults to None.</span>
</span><span id="CompositeSubjectFactory.__init__-136"><a href="#CompositeSubjectFactory.__init__-136"><span class="linenos">136</span></a>
</span><span id="CompositeSubjectFactory.__init__-137"><a href="#CompositeSubjectFactory.__init__-137"><span class="linenos">137</span></a><span class="sd">        Raises:</span>
</span><span id="CompositeSubjectFactory.__init__-138"><a href="#CompositeSubjectFactory.__init__-138"><span class="linenos">138</span></a><span class="sd">            KerykeionException: If subjects have different zodiac types, sidereal modes,</span>
</span><span id="CompositeSubjectFactory.__init__-139"><a href="#CompositeSubjectFactory.__init__-139"><span class="linenos">139</span></a><span class="sd">                              house systems, house system names, or perspective types.</span>
</span><span id="CompositeSubjectFactory.__init__-140"><a href="#CompositeSubjectFactory.__init__-140"><span class="linenos">140</span></a>
</span><span id="CompositeSubjectFactory.__init__-141"><a href="#CompositeSubjectFactory.__init__-141"><span class="linenos">141</span></a><span class="sd">        Note:</span>
</span><span id="CompositeSubjectFactory.__init__-142"><a href="#CompositeSubjectFactory.__init__-142"><span class="linenos">142</span></a><span class="sd">            Both subjects must have identical astrological calculation settings to ensure</span>
</span><span id="CompositeSubjectFactory.__init__-143"><a href="#CompositeSubjectFactory.__init__-143"><span class="linenos">143</span></a><span class="sd">            meaningful composite chart calculations.</span>
</span><span id="CompositeSubjectFactory.__init__-144"><a href="#CompositeSubjectFactory.__init__-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory.__init__-145"><a href="#CompositeSubjectFactory.__init__-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CompositeSubjectFactory.__init__-146"><a href="#CompositeSubjectFactory.__init__-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">composite_chart_type</span> <span class="o">=</span> <span class="s2">&quot;Midpoint&quot;</span>
</span><span id="CompositeSubjectFactory.__init__-147"><a href="#CompositeSubjectFactory.__init__-147"><span class="linenos">147</span></a>
</span><span id="CompositeSubjectFactory.__init__-148"><a href="#CompositeSubjectFactory.__init__-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span> <span class="o">=</span> <span class="n">first_subject</span>
</span><span id="CompositeSubjectFactory.__init__-149"><a href="#CompositeSubjectFactory.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span> <span class="o">=</span> <span class="n">second_subject</span>
</span><span id="CompositeSubjectFactory.__init__-150"><a href="#CompositeSubjectFactory.__init__-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">find_common_active_points</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory.__init__-151"><a href="#CompositeSubjectFactory.__init__-151"><span class="linenos">151</span></a>            <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="CompositeSubjectFactory.__init__-152"><a href="#CompositeSubjectFactory.__init__-152"><span class="linenos">152</span></a>            <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span>
</span><span id="CompositeSubjectFactory.__init__-153"><a href="#CompositeSubjectFactory.__init__-153"><span class="linenos">153</span></a>        <span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-154"><a href="#CompositeSubjectFactory.__init__-154"><span class="linenos">154</span></a>
</span><span id="CompositeSubjectFactory.__init__-155"><a href="#CompositeSubjectFactory.__init__-155"><span class="linenos">155</span></a>        <span class="c1"># Name</span>
</span><span id="CompositeSubjectFactory.__init__-156"><a href="#CompositeSubjectFactory.__init__-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">chart_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-157"><a href="#CompositeSubjectFactory.__init__-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Composite Chart&quot;</span>
</span><span id="CompositeSubjectFactory.__init__-158"><a href="#CompositeSubjectFactory.__init__-158"><span class="linenos">158</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-159"><a href="#CompositeSubjectFactory.__init__-159"><span class="linenos">159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">chart_name</span>
</span><span id="CompositeSubjectFactory.__init__-160"><a href="#CompositeSubjectFactory.__init__-160"><span class="linenos">160</span></a>
</span><span id="CompositeSubjectFactory.__init__-161"><a href="#CompositeSubjectFactory.__init__-161"><span class="linenos">161</span></a>        <span class="c1"># Zodiac Type</span>
</span><span id="CompositeSubjectFactory.__init__-162"><a href="#CompositeSubjectFactory.__init__-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-163"><a href="#CompositeSubjectFactory.__init__-163"><span class="linenos">163</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same zodiac type&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-164"><a href="#CompositeSubjectFactory.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">zodiac_type</span>
</span><span id="CompositeSubjectFactory.__init__-165"><a href="#CompositeSubjectFactory.__init__-165"><span class="linenos">165</span></a>
</span><span id="CompositeSubjectFactory.__init__-166"><a href="#CompositeSubjectFactory.__init__-166"><span class="linenos">166</span></a>        <span class="c1"># Sidereal Mode</span>
</span><span id="CompositeSubjectFactory.__init__-167"><a href="#CompositeSubjectFactory.__init__-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-168"><a href="#CompositeSubjectFactory.__init__-168"><span class="linenos">168</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same sidereal mode&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-169"><a href="#CompositeSubjectFactory.__init__-169"><span class="linenos">169</span></a>
</span><span id="CompositeSubjectFactory.__init__-170"><a href="#CompositeSubjectFactory.__init__-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-171"><a href="#CompositeSubjectFactory.__init__-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">sidereal_mode</span>
</span><span id="CompositeSubjectFactory.__init__-172"><a href="#CompositeSubjectFactory.__init__-172"><span class="linenos">172</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-173"><a href="#CompositeSubjectFactory.__init__-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="CompositeSubjectFactory.__init__-174"><a href="#CompositeSubjectFactory.__init__-174"><span class="linenos">174</span></a>
</span><span id="CompositeSubjectFactory.__init__-175"><a href="#CompositeSubjectFactory.__init__-175"><span class="linenos">175</span></a>        <span class="c1"># Houses System</span>
</span><span id="CompositeSubjectFactory.__init__-176"><a href="#CompositeSubjectFactory.__init__-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_identifier</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-177"><a href="#CompositeSubjectFactory.__init__-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same houses system&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-178"><a href="#CompositeSubjectFactory.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_identifier</span>
</span><span id="CompositeSubjectFactory.__init__-179"><a href="#CompositeSubjectFactory.__init__-179"><span class="linenos">179</span></a>
</span><span id="CompositeSubjectFactory.__init__-180"><a href="#CompositeSubjectFactory.__init__-180"><span class="linenos">180</span></a>        <span class="c1"># Houses System Name</span>
</span><span id="CompositeSubjectFactory.__init__-181"><a href="#CompositeSubjectFactory.__init__-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_name</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-182"><a href="#CompositeSubjectFactory.__init__-182"><span class="linenos">182</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same houses system name&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-183"><a href="#CompositeSubjectFactory.__init__-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_system_name</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">houses_system_name</span>
</span><span id="CompositeSubjectFactory.__init__-184"><a href="#CompositeSubjectFactory.__init__-184"><span class="linenos">184</span></a>
</span><span id="CompositeSubjectFactory.__init__-185"><a href="#CompositeSubjectFactory.__init__-185"><span class="linenos">185</span></a>        <span class="c1"># Perspective Type</span>
</span><span id="CompositeSubjectFactory.__init__-186"><a href="#CompositeSubjectFactory.__init__-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">perspective_type</span> <span class="o">!=</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-187"><a href="#CompositeSubjectFactory.__init__-187"><span class="linenos">187</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Both subjects must have the same perspective type&quot;</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-188"><a href="#CompositeSubjectFactory.__init__-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span> <span class="o">=</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">perspective_type</span>
</span><span id="CompositeSubjectFactory.__init__-189"><a href="#CompositeSubjectFactory.__init__-189"><span class="linenos">189</span></a>
</span><span id="CompositeSubjectFactory.__init__-190"><a href="#CompositeSubjectFactory.__init__-190"><span class="linenos">190</span></a>        <span class="c1"># Planets Names List</span>
</span><span id="CompositeSubjectFactory.__init__-191"><a href="#CompositeSubjectFactory.__init__-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CompositeSubjectFactory.__init__-192"><a href="#CompositeSubjectFactory.__init__-192"><span class="linenos">192</span></a>        <span class="k">for</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">first_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-193"><a href="#CompositeSubjectFactory.__init__-193"><span class="linenos">193</span></a>            <span class="k">if</span> <span class="n">planet</span> <span class="ow">in</span> <span class="n">second_subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">:</span>
</span><span id="CompositeSubjectFactory.__init__-194"><a href="#CompositeSubjectFactory.__init__-194"><span class="linenos">194</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">planet</span><span class="p">)</span>
</span><span id="CompositeSubjectFactory.__init__-195"><a href="#CompositeSubjectFactory.__init__-195"><span class="linenos">195</span></a>
</span><span id="CompositeSubjectFactory.__init__-196"><a href="#CompositeSubjectFactory.__init__-196"><span class="linenos">196</span></a>        <span class="c1"># Houses Names List</span>
</span><span id="CompositeSubjectFactory.__init__-197"><a href="#CompositeSubjectFactory.__init__-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_names_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">houses_names_list</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the composite subject factory with two astrological subjects.</p>

<p>Validates that both subjects have compatible settings and extracts common
active points for composite chart calculation.</p>

<p>Args:
    first_subject (AstrologicalSubjectModel): First astrological subject for the composite
    second_subject (AstrologicalSubjectModel): Second astrological subject for the composite
    chart_name (str | None, optional): Custom name for the composite chart.
                                     If None, generates name from subject names.
                                     Defaults to None.</p>

<p>Raises:
    KerykeionException: If subjects have different zodiac types, sidereal modes,
                      house systems, house system names, or perspective types.</p>

<p>Note:
    Both subjects must have identical astrological calculation settings to ensure
    meaningful composite chart calculations.</p>
</div>


                            </div>
                            <div id="CompositeSubjectFactory.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span><span class="annotation">: Optional[kerykeion.schemas.kr_models.CompositeSubjectModel]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.model"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.first_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">first_subject</span><span class="annotation">: kerykeion.schemas.kr_models.AstrologicalSubjectModel</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.first_subject"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.second_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">second_subject</span><span class="annotation">: kerykeion.schemas.kr_models.AstrologicalSubjectModel</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.second_subject"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.name"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.composite_chart_type" class="classattr">
                                <div class="attr variable">
            <span class="name">composite_chart_type</span><span class="annotation">: Literal[&#39;Midpoint&#39;]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.composite_chart_type"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.zodiac_type" class="classattr">
                                <div class="attr variable">
            <span class="name">zodiac_type</span><span class="annotation">: Literal[&#39;Tropical&#39;, &#39;Sidereal&#39;]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.zodiac_type"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.sidereal_mode" class="classattr">
                                <div class="attr variable">
            <span class="name">sidereal_mode</span><span class="annotation">: Optional[Literal[&#39;FAGAN_BRADLEY&#39;, &#39;LAHIRI&#39;, &#39;DELUCE&#39;, &#39;RAMAN&#39;, &#39;USHASHASHI&#39;, &#39;KRISHNAMURTI&#39;, &#39;DJWHAL_KHUL&#39;, &#39;YUKTESHWAR&#39;, &#39;JN_BHASIN&#39;, &#39;BABYL_KUGLER1&#39;, &#39;BABYL_KUGLER2&#39;, &#39;BABYL_KUGLER3&#39;, &#39;BABYL_HUBER&#39;, &#39;BABYL_ETPSC&#39;, &#39;ALDEBARAN_15TAU&#39;, &#39;HIPPARCHOS&#39;, &#39;SASSANIAN&#39;, &#39;J2000&#39;, &#39;J1900&#39;, &#39;B1950&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.sidereal_mode"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.houses_system_identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">houses_system_identifier</span><span class="annotation">: Literal[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;F&#39;, &#39;H&#39;, &#39;I&#39;, &#39;i&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.houses_system_identifier"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.houses_system_name" class="classattr">
                                <div class="attr variable">
            <span class="name">houses_system_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.houses_system_name"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.perspective_type" class="classattr">
                                <div class="attr variable">
            <span class="name">perspective_type</span><span class="annotation">: Literal[&#39;Apparent Geocentric&#39;, &#39;Heliocentric&#39;, &#39;Topocentric&#39;, &#39;True Geocentric&#39;]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.perspective_type"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.houses_names_list" class="classattr">
                                <div class="attr variable">
            <span class="name">houses_names_list</span><span class="annotation">: list[typing.Literal[&#39;First_House&#39;, &#39;Second_House&#39;, &#39;Third_House&#39;, &#39;Fourth_House&#39;, &#39;Fifth_House&#39;, &#39;Sixth_House&#39;, &#39;Seventh_House&#39;, &#39;Eighth_House&#39;, &#39;Ninth_House&#39;, &#39;Tenth_House&#39;, &#39;Eleventh_House&#39;, &#39;Twelfth_House&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.houses_names_list"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span><span class="annotation">: list[typing.Literal[&#39;Sun&#39;, &#39;Moon&#39;, &#39;Mercury&#39;, &#39;Venus&#39;, &#39;Mars&#39;, &#39;Jupiter&#39;, &#39;Saturn&#39;, &#39;Uranus&#39;, &#39;Neptune&#39;, &#39;Pluto&#39;, &#39;Mean_North_Lunar_Node&#39;, &#39;True_North_Lunar_Node&#39;, &#39;Mean_South_Lunar_Node&#39;, &#39;True_South_Lunar_Node&#39;, &#39;Chiron&#39;, &#39;Mean_Lilith&#39;, &#39;True_Lilith&#39;, &#39;Earth&#39;, &#39;Pholus&#39;, &#39;Ceres&#39;, &#39;Pallas&#39;, &#39;Juno&#39;, &#39;Vesta&#39;, &#39;Eris&#39;, &#39;Sedna&#39;, &#39;Haumea&#39;, &#39;Makemake&#39;, &#39;Ixion&#39;, &#39;Orcus&#39;, &#39;Quaoar&#39;, &#39;Regulus&#39;, &#39;Spica&#39;, &#39;Pars_Fortunae&#39;, &#39;Pars_Spiritus&#39;, &#39;Pars_Amoris&#39;, &#39;Pars_Fidei&#39;, &#39;Vertex&#39;, &#39;Anti_Vertex&#39;, &#39;Ascendant&#39;, &#39;Medium_Coeli&#39;, &#39;Descendant&#39;, &#39;Imum_Coeli&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.active_points"></a>
    
    

                            </div>
                            <div id="CompositeSubjectFactory.get_midpoint_composite_subject_model" class="classattr">
                                        <input id="CompositeSubjectFactory.get_midpoint_composite_subject_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_midpoint_composite_subject_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="CompositeSubjectFactory.get_midpoint_composite_subject_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompositeSubjectFactory.get_midpoint_composite_subject_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-365"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-365"><span class="linenos">365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_midpoint_composite_subject_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-366"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-367"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-367"><span class="linenos">367</span></a><span class="sd">        Generate the complete composite chart model using the midpoint technique.</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-368"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-368"><span class="linenos">368</span></a>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-369"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-369"><span class="linenos">369</span></a><span class="sd">        This is the main public method for creating a composite chart. It orchestrates</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-370"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-370"><span class="linenos">370</span></a><span class="sd">        the calculation of all composite positions and creates a complete CompositeSubjectModel</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-371"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-371"><span class="linenos">371</span></a><span class="sd">        containing all necessary astrological data for the relationship chart.</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-372"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-372"><span class="linenos">372</span></a>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-373"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-373"><span class="linenos">373</span></a><span class="sd">        The process includes:</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-374"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-374"><span class="linenos">374</span></a><span class="sd">        1. Calculating midpoint positions for all planets and house cusps</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-375"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-375"><span class="linenos">375</span></a><span class="sd">        2. Computing the composite lunar phase</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-376"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-376"><span class="linenos">376</span></a><span class="sd">        3. Assembling all data into a comprehensive model</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-377"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-377"><span class="linenos">377</span></a>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-378"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-378"><span class="linenos">378</span></a><span class="sd">        Returns:</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-379"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-379"><span class="linenos">379</span></a><span class="sd">            CompositeSubjectModel: Complete composite chart data model containing:</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-380"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-380"><span class="linenos">380</span></a><span class="sd">                - All calculated planetary positions and their house placements</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-381"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-381"><span class="linenos">381</span></a><span class="sd">                - House cusp positions maintaining proper house system order</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-382"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-382"><span class="linenos">382</span></a><span class="sd">                - Lunar phase information for the composite chart</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-383"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-383"><span class="linenos">383</span></a><span class="sd">                - All metadata from the original subjects (names, chart type, etc.)</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-384"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-384"><span class="linenos">384</span></a>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-385"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-385"><span class="linenos">385</span></a><span class="sd">        Example:</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-386"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-386"><span class="linenos">386</span></a><span class="sd">            &gt;&gt;&gt; composite = CompositeSubjectFactory(person1, person2, &quot;Our Relationship&quot;)</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-387"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-387"><span class="linenos">387</span></a><span class="sd">            &gt;&gt;&gt; model = composite.get_midpoint_composite_subject_model()</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-388"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-388"><span class="linenos">388</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Composite Sun at {model.sun.abs_pos} in House {model.sun.house}&quot;)</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-389"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-389"><span class="linenos">389</span></a>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-390"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-390"><span class="linenos">390</span></a><span class="sd">        Note:</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-391"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-391"><span class="linenos">391</span></a><span class="sd">            This method performs all calculations internally and returns a complete,</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-392"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-392"><span class="linenos">392</span></a><span class="sd">            ready-to-use composite chart model suitable for analysis or chart drawing.</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-393"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-393"><span class="linenos">393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-394"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_midpoint_composite_points_and_houses</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-395"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_composite_lunar_phase</span><span class="p">()</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-396"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-396"><span class="linenos">396</span></a>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-397"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="n">CompositeSubjectModel</span><span class="p">(</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-398"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-398"><span class="linenos">398</span></a>            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</span><span id="CompositeSubjectFactory.get_midpoint_composite_subject_model-399"><a href="#CompositeSubjectFactory.get_midpoint_composite_subject_model-399"><span class="linenos">399</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate the complete composite chart model using the midpoint technique.</p>

<p>This is the main public method for creating a composite chart. It orchestrates
the calculation of all composite positions and creates a complete CompositeSubjectModel
containing all necessary astrological data for the relationship chart.</p>

<p>The process includes:</p>

<ol>
<li>Calculating midpoint positions for all planets and house cusps</li>
<li>Computing the composite lunar phase</li>
<li>Assembling all data into a comprehensive model</li>
</ol>

<p>Returns:
    CompositeSubjectModel: Complete composite chart data model containing:
        - All calculated planetary positions and their house placements
        - House cusp positions maintaining proper house system order
        - Lunar phase information for the composite chart
        - All metadata from the original subjects (names, chart type, etc.)</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>composite = CompositeSubjectFactory(person1, person2, "Our Relationship")
      model = composite.get_midpoint_composite_subject_model()
      print(f"Composite Sun at {model.sun.abs_pos} in House {model.sun.house}")</p>
    </blockquote>
  </blockquote>
</blockquote>

<p>Note:
    This method performs all calculations internally and returns a complete,
    ready-to-use composite chart model suitable for analysis or chart drawing.</p>
</div>


                            </div>
                </section>
                <section id="EphemerisDataFactory">
                            <input id="EphemerisDataFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EphemerisDataFactory</span>:

                <label class="view-source-button" for="EphemerisDataFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EphemerisDataFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EphemerisDataFactory-70"><a href="#EphemerisDataFactory-70"><span class="linenos"> 70</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EphemerisDataFactory</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-71"><a href="#EphemerisDataFactory-71"><span class="linenos"> 71</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory-72"><a href="#EphemerisDataFactory-72"><span class="linenos"> 72</span></a><span class="sd">    A factory class for generating ephemeris data over a specified date range.</span>
</span><span id="EphemerisDataFactory-73"><a href="#EphemerisDataFactory-73"><span class="linenos"> 73</span></a>
</span><span id="EphemerisDataFactory-74"><a href="#EphemerisDataFactory-74"><span class="linenos"> 74</span></a><span class="sd">    This class calculates astrological ephemeris data (planetary positions and house cusps)</span>
</span><span id="EphemerisDataFactory-75"><a href="#EphemerisDataFactory-75"><span class="linenos"> 75</span></a><span class="sd">    for a sequence of dates, allowing for detailed astronomical calculations across time periods.</span>
</span><span id="EphemerisDataFactory-76"><a href="#EphemerisDataFactory-76"><span class="linenos"> 76</span></a><span class="sd">    It supports different time intervals (days, hours, or minutes) and various astrological</span>
</span><span id="EphemerisDataFactory-77"><a href="#EphemerisDataFactory-77"><span class="linenos"> 77</span></a><span class="sd">    calculation systems.</span>
</span><span id="EphemerisDataFactory-78"><a href="#EphemerisDataFactory-78"><span class="linenos"> 78</span></a>
</span><span id="EphemerisDataFactory-79"><a href="#EphemerisDataFactory-79"><span class="linenos"> 79</span></a><span class="sd">    The factory creates data points at regular intervals between start and end dates,</span>
</span><span id="EphemerisDataFactory-80"><a href="#EphemerisDataFactory-80"><span class="linenos"> 80</span></a><span class="sd">    with built-in safeguards to prevent excessive computational loads through configurable</span>
</span><span id="EphemerisDataFactory-81"><a href="#EphemerisDataFactory-81"><span class="linenos"> 81</span></a><span class="sd">    maximum limits.</span>
</span><span id="EphemerisDataFactory-82"><a href="#EphemerisDataFactory-82"><span class="linenos"> 82</span></a>
</span><span id="EphemerisDataFactory-83"><a href="#EphemerisDataFactory-83"><span class="linenos"> 83</span></a><span class="sd">    Args:</span>
</span><span id="EphemerisDataFactory-84"><a href="#EphemerisDataFactory-84"><span class="linenos"> 84</span></a><span class="sd">        start_datetime (datetime): The starting date and time for ephemeris calculations.</span>
</span><span id="EphemerisDataFactory-85"><a href="#EphemerisDataFactory-85"><span class="linenos"> 85</span></a><span class="sd">        end_datetime (datetime): The ending date and time for ephemeris calculations.</span>
</span><span id="EphemerisDataFactory-86"><a href="#EphemerisDataFactory-86"><span class="linenos"> 86</span></a><span class="sd">        step_type (Literal[&quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;], optional): The time interval unit</span>
</span><span id="EphemerisDataFactory-87"><a href="#EphemerisDataFactory-87"><span class="linenos"> 87</span></a><span class="sd">            for data points. Defaults to &quot;days&quot;.</span>
</span><span id="EphemerisDataFactory-88"><a href="#EphemerisDataFactory-88"><span class="linenos"> 88</span></a><span class="sd">        step (int, optional): The number of units to advance for each data point.</span>
</span><span id="EphemerisDataFactory-89"><a href="#EphemerisDataFactory-89"><span class="linenos"> 89</span></a><span class="sd">            For example, step=2 with step_type=&quot;days&quot; creates data points every 2 days.</span>
</span><span id="EphemerisDataFactory-90"><a href="#EphemerisDataFactory-90"><span class="linenos"> 90</span></a><span class="sd">            Defaults to 1.</span>
</span><span id="EphemerisDataFactory-91"><a href="#EphemerisDataFactory-91"><span class="linenos"> 91</span></a><span class="sd">        lat (float, optional): Geographic latitude in decimal degrees for calculations.</span>
</span><span id="EphemerisDataFactory-92"><a href="#EphemerisDataFactory-92"><span class="linenos"> 92</span></a><span class="sd">            Positive values for North, negative for South. Defaults to 51.4769 (Greenwich).</span>
</span><span id="EphemerisDataFactory-93"><a href="#EphemerisDataFactory-93"><span class="linenos"> 93</span></a><span class="sd">        lng (float, optional): Geographic longitude in decimal degrees for calculations.</span>
</span><span id="EphemerisDataFactory-94"><a href="#EphemerisDataFactory-94"><span class="linenos"> 94</span></a><span class="sd">            Positive values for East, negative for West. Defaults to 0.0005 (Greenwich).</span>
</span><span id="EphemerisDataFactory-95"><a href="#EphemerisDataFactory-95"><span class="linenos"> 95</span></a><span class="sd">        tz_str (str, optional): Timezone identifier (e.g., &quot;Europe/London&quot;, &quot;America/New_York&quot;).</span>
</span><span id="EphemerisDataFactory-96"><a href="#EphemerisDataFactory-96"><span class="linenos"> 96</span></a><span class="sd">            Defaults to &quot;Etc/UTC&quot;.</span>
</span><span id="EphemerisDataFactory-97"><a href="#EphemerisDataFactory-97"><span class="linenos"> 97</span></a><span class="sd">        is_dst (bool, optional): Whether daylight saving time is active for the location.</span>
</span><span id="EphemerisDataFactory-98"><a href="#EphemerisDataFactory-98"><span class="linenos"> 98</span></a><span class="sd">            Only relevant for certain timezone calculations. Defaults to False.</span>
</span><span id="EphemerisDataFactory-99"><a href="#EphemerisDataFactory-99"><span class="linenos"> 99</span></a><span class="sd">        zodiac_type (ZodiacType, optional): The zodiac system to use (tropical or sidereal).</span>
</span><span id="EphemerisDataFactory-100"><a href="#EphemerisDataFactory-100"><span class="linenos">100</span></a><span class="sd">            Defaults to DEFAULT_ZODIAC_TYPE.</span>
</span><span id="EphemerisDataFactory-101"><a href="#EphemerisDataFactory-101"><span class="linenos">101</span></a><span class="sd">        sidereal_mode (Union[SiderealMode, None], optional): The sidereal calculation mode</span>
</span><span id="EphemerisDataFactory-102"><a href="#EphemerisDataFactory-102"><span class="linenos">102</span></a><span class="sd">            if using sidereal zodiac. Only applies when zodiac_type is sidereal.</span>
</span><span id="EphemerisDataFactory-103"><a href="#EphemerisDataFactory-103"><span class="linenos">103</span></a><span class="sd">            Defaults to None.</span>
</span><span id="EphemerisDataFactory-104"><a href="#EphemerisDataFactory-104"><span class="linenos">104</span></a><span class="sd">        houses_system_identifier (HousesSystemIdentifier, optional): The house system</span>
</span><span id="EphemerisDataFactory-105"><a href="#EphemerisDataFactory-105"><span class="linenos">105</span></a><span class="sd">            for astrological house calculations (e.g., Placidus, Koch, Equal).</span>
</span><span id="EphemerisDataFactory-106"><a href="#EphemerisDataFactory-106"><span class="linenos">106</span></a><span class="sd">            Defaults to DEFAULT_HOUSES_SYSTEM_IDENTIFIER.</span>
</span><span id="EphemerisDataFactory-107"><a href="#EphemerisDataFactory-107"><span class="linenos">107</span></a><span class="sd">        perspective_type (PerspectiveType, optional): The calculation perspective</span>
</span><span id="EphemerisDataFactory-108"><a href="#EphemerisDataFactory-108"><span class="linenos">108</span></a><span class="sd">            (geocentric, heliocentric, etc.). Defaults to DEFAULT_PERSPECTIVE_TYPE.</span>
</span><span id="EphemerisDataFactory-109"><a href="#EphemerisDataFactory-109"><span class="linenos">109</span></a><span class="sd">        max_days (Union[int, None], optional): Maximum number of daily data points allowed.</span>
</span><span id="EphemerisDataFactory-110"><a href="#EphemerisDataFactory-110"><span class="linenos">110</span></a><span class="sd">            Set to None to disable this safety check. Defaults to 730 (2 years).</span>
</span><span id="EphemerisDataFactory-111"><a href="#EphemerisDataFactory-111"><span class="linenos">111</span></a><span class="sd">        max_hours (Union[int, None], optional): Maximum number of hourly data points allowed.</span>
</span><span id="EphemerisDataFactory-112"><a href="#EphemerisDataFactory-112"><span class="linenos">112</span></a><span class="sd">            Set to None to disable this safety check. Defaults to 8760 (1 year).</span>
</span><span id="EphemerisDataFactory-113"><a href="#EphemerisDataFactory-113"><span class="linenos">113</span></a><span class="sd">        max_minutes (Union[int, None], optional): Maximum number of minute-interval data points.</span>
</span><span id="EphemerisDataFactory-114"><a href="#EphemerisDataFactory-114"><span class="linenos">114</span></a><span class="sd">            Set to None to disable this safety check. Defaults to 525600 (1 year).</span>
</span><span id="EphemerisDataFactory-115"><a href="#EphemerisDataFactory-115"><span class="linenos">115</span></a>
</span><span id="EphemerisDataFactory-116"><a href="#EphemerisDataFactory-116"><span class="linenos">116</span></a><span class="sd">    Raises:</span>
</span><span id="EphemerisDataFactory-117"><a href="#EphemerisDataFactory-117"><span class="linenos">117</span></a><span class="sd">        ValueError: If step_type is not one of &quot;days&quot;, &quot;hours&quot;, or &quot;minutes&quot;.</span>
</span><span id="EphemerisDataFactory-118"><a href="#EphemerisDataFactory-118"><span class="linenos">118</span></a><span class="sd">        ValueError: If the calculated number of data points exceeds the respective maximum limit.</span>
</span><span id="EphemerisDataFactory-119"><a href="#EphemerisDataFactory-119"><span class="linenos">119</span></a><span class="sd">        ValueError: If no valid dates are generated from the input parameters.</span>
</span><span id="EphemerisDataFactory-120"><a href="#EphemerisDataFactory-120"><span class="linenos">120</span></a>
</span><span id="EphemerisDataFactory-121"><a href="#EphemerisDataFactory-121"><span class="linenos">121</span></a><span class="sd">    Examples:</span>
</span><span id="EphemerisDataFactory-122"><a href="#EphemerisDataFactory-122"><span class="linenos">122</span></a><span class="sd">        Create daily ephemeris data for a month:</span>
</span><span id="EphemerisDataFactory-123"><a href="#EphemerisDataFactory-123"><span class="linenos">123</span></a>
</span><span id="EphemerisDataFactory-124"><a href="#EphemerisDataFactory-124"><span class="linenos">124</span></a><span class="sd">        &gt;&gt;&gt; from datetime import datetime</span>
</span><span id="EphemerisDataFactory-125"><a href="#EphemerisDataFactory-125"><span class="linenos">125</span></a><span class="sd">        &gt;&gt;&gt; start = datetime(2024, 1, 1)</span>
</span><span id="EphemerisDataFactory-126"><a href="#EphemerisDataFactory-126"><span class="linenos">126</span></a><span class="sd">        &gt;&gt;&gt; end = datetime(2024, 1, 31)</span>
</span><span id="EphemerisDataFactory-127"><a href="#EphemerisDataFactory-127"><span class="linenos">127</span></a><span class="sd">        &gt;&gt;&gt; factory = EphemerisDataFactory(start, end)</span>
</span><span id="EphemerisDataFactory-128"><a href="#EphemerisDataFactory-128"><span class="linenos">128</span></a><span class="sd">        &gt;&gt;&gt; data = factory.get_ephemeris_data()</span>
</span><span id="EphemerisDataFactory-129"><a href="#EphemerisDataFactory-129"><span class="linenos">129</span></a>
</span><span id="EphemerisDataFactory-130"><a href="#EphemerisDataFactory-130"><span class="linenos">130</span></a><span class="sd">        Create hourly data for a specific location:</span>
</span><span id="EphemerisDataFactory-131"><a href="#EphemerisDataFactory-131"><span class="linenos">131</span></a>
</span><span id="EphemerisDataFactory-132"><a href="#EphemerisDataFactory-132"><span class="linenos">132</span></a><span class="sd">        &gt;&gt;&gt; factory = EphemerisDataFactory(</span>
</span><span id="EphemerisDataFactory-133"><a href="#EphemerisDataFactory-133"><span class="linenos">133</span></a><span class="sd">        ...     start, end,</span>
</span><span id="EphemerisDataFactory-134"><a href="#EphemerisDataFactory-134"><span class="linenos">134</span></a><span class="sd">        ...     step_type=&quot;hours&quot;,</span>
</span><span id="EphemerisDataFactory-135"><a href="#EphemerisDataFactory-135"><span class="linenos">135</span></a><span class="sd">        ...     lat=40.7128,  # New York</span>
</span><span id="EphemerisDataFactory-136"><a href="#EphemerisDataFactory-136"><span class="linenos">136</span></a><span class="sd">        ...     lng=-74.0060,</span>
</span><span id="EphemerisDataFactory-137"><a href="#EphemerisDataFactory-137"><span class="linenos">137</span></a><span class="sd">        ...     tz_str=&quot;America/New_York&quot;</span>
</span><span id="EphemerisDataFactory-138"><a href="#EphemerisDataFactory-138"><span class="linenos">138</span></a><span class="sd">        ... )</span>
</span><span id="EphemerisDataFactory-139"><a href="#EphemerisDataFactory-139"><span class="linenos">139</span></a><span class="sd">        &gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()</span>
</span><span id="EphemerisDataFactory-140"><a href="#EphemerisDataFactory-140"><span class="linenos">140</span></a>
</span><span id="EphemerisDataFactory-141"><a href="#EphemerisDataFactory-141"><span class="linenos">141</span></a><span class="sd">    Note:</span>
</span><span id="EphemerisDataFactory-142"><a href="#EphemerisDataFactory-142"><span class="linenos">142</span></a><span class="sd">        Large date ranges with small step intervals can generate thousands of data points,</span>
</span><span id="EphemerisDataFactory-143"><a href="#EphemerisDataFactory-143"><span class="linenos">143</span></a><span class="sd">        which may require significant computation time and memory. The factory includes</span>
</span><span id="EphemerisDataFactory-144"><a href="#EphemerisDataFactory-144"><span class="linenos">144</span></a><span class="sd">        warnings for calculations exceeding 1000 data points and enforces maximum limits</span>
</span><span id="EphemerisDataFactory-145"><a href="#EphemerisDataFactory-145"><span class="linenos">145</span></a><span class="sd">        to prevent system overload.</span>
</span><span id="EphemerisDataFactory-146"><a href="#EphemerisDataFactory-146"><span class="linenos">146</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory-147"><a href="#EphemerisDataFactory-147"><span class="linenos">147</span></a>
</span><span id="EphemerisDataFactory-148"><a href="#EphemerisDataFactory-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="EphemerisDataFactory-149"><a href="#EphemerisDataFactory-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-150"><a href="#EphemerisDataFactory-150"><span class="linenos">150</span></a>        <span class="n">start_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-151"><a href="#EphemerisDataFactory-151"><span class="linenos">151</span></a>        <span class="n">end_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-152"><a href="#EphemerisDataFactory-152"><span class="linenos">152</span></a>        <span class="n">step_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;days&quot;</span><span class="p">,</span> <span class="s2">&quot;hours&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;days&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-153"><a href="#EphemerisDataFactory-153"><span class="linenos">153</span></a>        <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-154"><a href="#EphemerisDataFactory-154"><span class="linenos">154</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">51.4769</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-155"><a href="#EphemerisDataFactory-155"><span class="linenos">155</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-156"><a href="#EphemerisDataFactory-156"><span class="linenos">156</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/UTC&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-157"><a href="#EphemerisDataFactory-157"><span class="linenos">157</span></a>        <span class="n">is_dst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-158"><a href="#EphemerisDataFactory-158"><span class="linenos">158</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-159"><a href="#EphemerisDataFactory-159"><span class="linenos">159</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-160"><a href="#EphemerisDataFactory-160"><span class="linenos">160</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-161"><a href="#EphemerisDataFactory-161"><span class="linenos">161</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-162"><a href="#EphemerisDataFactory-162"><span class="linenos">162</span></a>        <span class="n">max_days</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">730</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-163"><a href="#EphemerisDataFactory-163"><span class="linenos">163</span></a>        <span class="n">max_hours</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8760</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-164"><a href="#EphemerisDataFactory-164"><span class="linenos">164</span></a>        <span class="n">max_minutes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">525600</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-165"><a href="#EphemerisDataFactory-165"><span class="linenos">165</span></a>    <span class="p">):</span>
</span><span id="EphemerisDataFactory-166"><a href="#EphemerisDataFactory-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">=</span> <span class="n">start_datetime</span>
</span><span id="EphemerisDataFactory-167"><a href="#EphemerisDataFactory-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">=</span> <span class="n">end_datetime</span>
</span><span id="EphemerisDataFactory-168"><a href="#EphemerisDataFactory-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">=</span> <span class="n">step_type</span>
</span><span id="EphemerisDataFactory-169"><a href="#EphemerisDataFactory-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
</span><span id="EphemerisDataFactory-170"><a href="#EphemerisDataFactory-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
</span><span id="EphemerisDataFactory-171"><a href="#EphemerisDataFactory-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="n">lng</span>
</span><span id="EphemerisDataFactory-172"><a href="#EphemerisDataFactory-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span> <span class="o">=</span> <span class="n">tz_str</span>
</span><span id="EphemerisDataFactory-173"><a href="#EphemerisDataFactory-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_dst</span> <span class="o">=</span> <span class="n">is_dst</span>
</span><span id="EphemerisDataFactory-174"><a href="#EphemerisDataFactory-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">normalize_zodiac_type</span><span class="p">(</span><span class="n">zodiac_type</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-175"><a href="#EphemerisDataFactory-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">=</span> <span class="n">sidereal_mode</span>
</span><span id="EphemerisDataFactory-176"><a href="#EphemerisDataFactory-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span> <span class="o">=</span> <span class="n">houses_system_identifier</span>
</span><span id="EphemerisDataFactory-177"><a href="#EphemerisDataFactory-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span> <span class="o">=</span> <span class="n">perspective_type</span>
</span><span id="EphemerisDataFactory-178"><a href="#EphemerisDataFactory-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_days</span> <span class="o">=</span> <span class="n">max_days</span>
</span><span id="EphemerisDataFactory-179"><a href="#EphemerisDataFactory-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_hours</span> <span class="o">=</span> <span class="n">max_hours</span>
</span><span id="EphemerisDataFactory-180"><a href="#EphemerisDataFactory-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_minutes</span> <span class="o">=</span> <span class="n">max_minutes</span>
</span><span id="EphemerisDataFactory-181"><a href="#EphemerisDataFactory-181"><span class="linenos">181</span></a>
</span><span id="EphemerisDataFactory-182"><a href="#EphemerisDataFactory-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EphemerisDataFactory-183"><a href="#EphemerisDataFactory-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;days&quot;</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-184"><a href="#EphemerisDataFactory-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="EphemerisDataFactory-185"><a href="#EphemerisDataFactory-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">max_days</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_days</span><span class="p">):</span>
</span><span id="EphemerisDataFactory-186"><a href="#EphemerisDataFactory-186"><span class="linenos">186</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many days: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_days</span><span class="si">}</span><span class="s2">. To prevent this error, set max_days to a higher value or reduce the date range.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-187"><a href="#EphemerisDataFactory-187"><span class="linenos">187</span></a>
</span><span id="EphemerisDataFactory-188"><a href="#EphemerisDataFactory-188"><span class="linenos">188</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;hours&quot;</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-189"><a href="#EphemerisDataFactory-189"><span class="linenos">189</span></a>            <span class="n">hours_diff</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>
</span><span id="EphemerisDataFactory-190"><a href="#EphemerisDataFactory-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hours_diff</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="EphemerisDataFactory-191"><a href="#EphemerisDataFactory-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="n">max_hours</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_hours</span><span class="p">):</span>
</span><span id="EphemerisDataFactory-192"><a href="#EphemerisDataFactory-192"><span class="linenos">192</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many hours: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hours</span><span class="si">}</span><span class="s2">. To prevent this error, set max_hours to a higher value or reduce the date range.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-193"><a href="#EphemerisDataFactory-193"><span class="linenos">193</span></a>
</span><span id="EphemerisDataFactory-194"><a href="#EphemerisDataFactory-194"><span class="linenos">194</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;minutes&quot;</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-195"><a href="#EphemerisDataFactory-195"><span class="linenos">195</span></a>            <span class="n">minutes_diff</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
</span><span id="EphemerisDataFactory-196"><a href="#EphemerisDataFactory-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minutes_diff</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="EphemerisDataFactory-197"><a href="#EphemerisDataFactory-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="n">max_minutes</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_minutes</span><span class="p">):</span>
</span><span id="EphemerisDataFactory-198"><a href="#EphemerisDataFactory-198"><span class="linenos">198</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many minutes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_minutes</span><span class="si">}</span><span class="s2">. To prevent this error, set max_minutes to a higher value or reduce the date range.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-199"><a href="#EphemerisDataFactory-199"><span class="linenos">199</span></a>
</span><span id="EphemerisDataFactory-200"><a href="#EphemerisDataFactory-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-201"><a href="#EphemerisDataFactory-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid step type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-202"><a href="#EphemerisDataFactory-202"><span class="linenos">202</span></a>
</span><span id="EphemerisDataFactory-203"><a href="#EphemerisDataFactory-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-204"><a href="#EphemerisDataFactory-204"><span class="linenos">204</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No dates found. Check the date range and step values.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-205"><a href="#EphemerisDataFactory-205"><span class="linenos">205</span></a>
</span><span id="EphemerisDataFactory-206"><a href="#EphemerisDataFactory-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-207"><a href="#EphemerisDataFactory-207"><span class="linenos">207</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Large number of dates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2">. The calculation may take a while.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-208"><a href="#EphemerisDataFactory-208"><span class="linenos">208</span></a>
</span><span id="EphemerisDataFactory-209"><a href="#EphemerisDataFactory-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ephemeris_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-210"><a href="#EphemerisDataFactory-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory-211"><a href="#EphemerisDataFactory-211"><span class="linenos">211</span></a><span class="sd">        Generate ephemeris data for the specified date range.</span>
</span><span id="EphemerisDataFactory-212"><a href="#EphemerisDataFactory-212"><span class="linenos">212</span></a>
</span><span id="EphemerisDataFactory-213"><a href="#EphemerisDataFactory-213"><span class="linenos">213</span></a><span class="sd">        This method creates a comprehensive dataset containing planetary positions and</span>
</span><span id="EphemerisDataFactory-214"><a href="#EphemerisDataFactory-214"><span class="linenos">214</span></a><span class="sd">        astrological house cusps for each date in the configured time series. The data</span>
</span><span id="EphemerisDataFactory-215"><a href="#EphemerisDataFactory-215"><span class="linenos">215</span></a><span class="sd">        is structured for easy consumption by astrological applications and analysis tools.</span>
</span><span id="EphemerisDataFactory-216"><a href="#EphemerisDataFactory-216"><span class="linenos">216</span></a>
</span><span id="EphemerisDataFactory-217"><a href="#EphemerisDataFactory-217"><span class="linenos">217</span></a><span class="sd">        The returned data includes all available astrological points (planets, asteroids,</span>
</span><span id="EphemerisDataFactory-218"><a href="#EphemerisDataFactory-218"><span class="linenos">218</span></a><span class="sd">        lunar nodes, etc.) as configured by the perspective type, along with complete</span>
</span><span id="EphemerisDataFactory-219"><a href="#EphemerisDataFactory-219"><span class="linenos">219</span></a><span class="sd">        house cusp information for each calculated moment.</span>
</span><span id="EphemerisDataFactory-220"><a href="#EphemerisDataFactory-220"><span class="linenos">220</span></a>
</span><span id="EphemerisDataFactory-221"><a href="#EphemerisDataFactory-221"><span class="linenos">221</span></a><span class="sd">        Args:</span>
</span><span id="EphemerisDataFactory-222"><a href="#EphemerisDataFactory-222"><span class="linenos">222</span></a><span class="sd">            as_model (bool, optional): If True, returns data as validated model instances</span>
</span><span id="EphemerisDataFactory-223"><a href="#EphemerisDataFactory-223"><span class="linenos">223</span></a><span class="sd">                (EphemerisDictModel objects) which provide type safety and validation.</span>
</span><span id="EphemerisDataFactory-224"><a href="#EphemerisDataFactory-224"><span class="linenos">224</span></a><span class="sd">                If False, returns raw dictionary data for maximum flexibility.</span>
</span><span id="EphemerisDataFactory-225"><a href="#EphemerisDataFactory-225"><span class="linenos">225</span></a><span class="sd">                Defaults to False.</span>
</span><span id="EphemerisDataFactory-226"><a href="#EphemerisDataFactory-226"><span class="linenos">226</span></a>
</span><span id="EphemerisDataFactory-227"><a href="#EphemerisDataFactory-227"><span class="linenos">227</span></a><span class="sd">        Returns:</span>
</span><span id="EphemerisDataFactory-228"><a href="#EphemerisDataFactory-228"><span class="linenos">228</span></a><span class="sd">            list: A list of ephemeris data points, where each element represents one</span>
</span><span id="EphemerisDataFactory-229"><a href="#EphemerisDataFactory-229"><span class="linenos">229</span></a><span class="sd">                calculated moment in time. The structure depends on the as_model parameter:</span>
</span><span id="EphemerisDataFactory-230"><a href="#EphemerisDataFactory-230"><span class="linenos">230</span></a>
</span><span id="EphemerisDataFactory-231"><a href="#EphemerisDataFactory-231"><span class="linenos">231</span></a><span class="sd">                If as_model=False (default):</span>
</span><span id="EphemerisDataFactory-232"><a href="#EphemerisDataFactory-232"><span class="linenos">232</span></a><span class="sd">                    List of dictionaries with keys:</span>
</span><span id="EphemerisDataFactory-233"><a href="#EphemerisDataFactory-233"><span class="linenos">233</span></a><span class="sd">                    - &quot;date&quot; (str): ISO format datetime string (e.g., &quot;2020-01-01T00:00:00&quot;)</span>
</span><span id="EphemerisDataFactory-234"><a href="#EphemerisDataFactory-234"><span class="linenos">234</span></a><span class="sd">                    - &quot;planets&quot; (list): List of dictionaries, each containing planetary data</span>
</span><span id="EphemerisDataFactory-235"><a href="#EphemerisDataFactory-235"><span class="linenos">235</span></a><span class="sd">                      with keys like &#39;name&#39;, &#39;abs_pos&#39;, &#39;lon&#39;, &#39;lat&#39;, &#39;dist&#39;, &#39;speed&#39;, etc.</span>
</span><span id="EphemerisDataFactory-236"><a href="#EphemerisDataFactory-236"><span class="linenos">236</span></a><span class="sd">                    - &quot;houses&quot; (list): List of dictionaries containing house cusp data</span>
</span><span id="EphemerisDataFactory-237"><a href="#EphemerisDataFactory-237"><span class="linenos">237</span></a><span class="sd">                      with keys like &#39;name&#39;, &#39;abs_pos&#39;, &#39;lon&#39;, etc.</span>
</span><span id="EphemerisDataFactory-238"><a href="#EphemerisDataFactory-238"><span class="linenos">238</span></a>
</span><span id="EphemerisDataFactory-239"><a href="#EphemerisDataFactory-239"><span class="linenos">239</span></a><span class="sd">                If as_model=True:</span>
</span><span id="EphemerisDataFactory-240"><a href="#EphemerisDataFactory-240"><span class="linenos">240</span></a><span class="sd">                    List of EphemerisDictModel instances providing the same data</span>
</span><span id="EphemerisDataFactory-241"><a href="#EphemerisDataFactory-241"><span class="linenos">241</span></a><span class="sd">                    with type validation and structured access.</span>
</span><span id="EphemerisDataFactory-242"><a href="#EphemerisDataFactory-242"><span class="linenos">242</span></a>
</span><span id="EphemerisDataFactory-243"><a href="#EphemerisDataFactory-243"><span class="linenos">243</span></a><span class="sd">        Examples:</span>
</span><span id="EphemerisDataFactory-244"><a href="#EphemerisDataFactory-244"><span class="linenos">244</span></a><span class="sd">            Basic usage with dictionary output:</span>
</span><span id="EphemerisDataFactory-245"><a href="#EphemerisDataFactory-245"><span class="linenos">245</span></a>
</span><span id="EphemerisDataFactory-246"><a href="#EphemerisDataFactory-246"><span class="linenos">246</span></a><span class="sd">            &gt;&gt;&gt; factory = EphemerisDataFactory(start_date, end_date)</span>
</span><span id="EphemerisDataFactory-247"><a href="#EphemerisDataFactory-247"><span class="linenos">247</span></a><span class="sd">            &gt;&gt;&gt; data = factory.get_ephemeris_data()</span>
</span><span id="EphemerisDataFactory-248"><a href="#EphemerisDataFactory-248"><span class="linenos">248</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Sun position: {data[0][&#39;planets&#39;][0][&#39;abs_pos&#39;]}&quot;)</span>
</span><span id="EphemerisDataFactory-249"><a href="#EphemerisDataFactory-249"><span class="linenos">249</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;First house cusp: {data[0][&#39;houses&#39;][0][&#39;abs_pos&#39;]}&quot;)</span>
</span><span id="EphemerisDataFactory-250"><a href="#EphemerisDataFactory-250"><span class="linenos">250</span></a>
</span><span id="EphemerisDataFactory-251"><a href="#EphemerisDataFactory-251"><span class="linenos">251</span></a><span class="sd">            Using model instances for type safety:</span>
</span><span id="EphemerisDataFactory-252"><a href="#EphemerisDataFactory-252"><span class="linenos">252</span></a>
</span><span id="EphemerisDataFactory-253"><a href="#EphemerisDataFactory-253"><span class="linenos">253</span></a><span class="sd">            &gt;&gt;&gt; data_models = factory.get_ephemeris_data(as_model=True)</span>
</span><span id="EphemerisDataFactory-254"><a href="#EphemerisDataFactory-254"><span class="linenos">254</span></a><span class="sd">            &gt;&gt;&gt; first_point = data_models[0]</span>
</span><span id="EphemerisDataFactory-255"><a href="#EphemerisDataFactory-255"><span class="linenos">255</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Date: {first_point.date}&quot;)</span>
</span><span id="EphemerisDataFactory-256"><a href="#EphemerisDataFactory-256"><span class="linenos">256</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Number of planets: {len(first_point.planets)}&quot;)</span>
</span><span id="EphemerisDataFactory-257"><a href="#EphemerisDataFactory-257"><span class="linenos">257</span></a>
</span><span id="EphemerisDataFactory-258"><a href="#EphemerisDataFactory-258"><span class="linenos">258</span></a><span class="sd">        Note:</span>
</span><span id="EphemerisDataFactory-259"><a href="#EphemerisDataFactory-259"><span class="linenos">259</span></a><span class="sd">            - The calculation time is proportional to the number of data points</span>
</span><span id="EphemerisDataFactory-260"><a href="#EphemerisDataFactory-260"><span class="linenos">260</span></a><span class="sd">            - For large datasets (&gt;1000 points), consider using the method in batches</span>
</span><span id="EphemerisDataFactory-261"><a href="#EphemerisDataFactory-261"><span class="linenos">261</span></a><span class="sd">            - Planet order and availability depend on the configured perspective type</span>
</span><span id="EphemerisDataFactory-262"><a href="#EphemerisDataFactory-262"><span class="linenos">262</span></a><span class="sd">            - House system affects the house cusp calculations</span>
</span><span id="EphemerisDataFactory-263"><a href="#EphemerisDataFactory-263"><span class="linenos">263</span></a><span class="sd">            - All positions are in the configured zodiac system (tropical/sidereal)</span>
</span><span id="EphemerisDataFactory-264"><a href="#EphemerisDataFactory-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory-265"><a href="#EphemerisDataFactory-265"><span class="linenos">265</span></a>        <span class="n">ephemeris_data_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EphemerisDataFactory-266"><a href="#EphemerisDataFactory-266"><span class="linenos">266</span></a>        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-267"><a href="#EphemerisDataFactory-267"><span class="linenos">267</span></a>            <span class="n">subject</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="EphemerisDataFactory-268"><a href="#EphemerisDataFactory-268"><span class="linenos">268</span></a>                <span class="n">year</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-269"><a href="#EphemerisDataFactory-269"><span class="linenos">269</span></a>                <span class="n">month</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-270"><a href="#EphemerisDataFactory-270"><span class="linenos">270</span></a>                <span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-271"><a href="#EphemerisDataFactory-271"><span class="linenos">271</span></a>                <span class="n">hour</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-272"><a href="#EphemerisDataFactory-272"><span class="linenos">272</span></a>                <span class="n">minute</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-273"><a href="#EphemerisDataFactory-273"><span class="linenos">273</span></a>                <span class="n">lng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-274"><a href="#EphemerisDataFactory-274"><span class="linenos">274</span></a>                <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-275"><a href="#EphemerisDataFactory-275"><span class="linenos">275</span></a>                <span class="n">tz_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-276"><a href="#EphemerisDataFactory-276"><span class="linenos">276</span></a>                <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-277"><a href="#EphemerisDataFactory-277"><span class="linenos">277</span></a>                <span class="n">nation</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-278"><a href="#EphemerisDataFactory-278"><span class="linenos">278</span></a>                <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-279"><a href="#EphemerisDataFactory-279"><span class="linenos">279</span></a>                <span class="n">zodiac_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-280"><a href="#EphemerisDataFactory-280"><span class="linenos">280</span></a>                <span class="n">sidereal_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-281"><a href="#EphemerisDataFactory-281"><span class="linenos">281</span></a>                <span class="n">houses_system_identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-282"><a href="#EphemerisDataFactory-282"><span class="linenos">282</span></a>                <span class="n">perspective_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-283"><a href="#EphemerisDataFactory-283"><span class="linenos">283</span></a>                <span class="n">is_dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dst</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-284"><a href="#EphemerisDataFactory-284"><span class="linenos">284</span></a>            <span class="p">)</span>
</span><span id="EphemerisDataFactory-285"><a href="#EphemerisDataFactory-285"><span class="linenos">285</span></a>
</span><span id="EphemerisDataFactory-286"><a href="#EphemerisDataFactory-286"><span class="linenos">286</span></a>            <span class="n">houses_list</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-287"><a href="#EphemerisDataFactory-287"><span class="linenos">287</span></a>            <span class="n">available_planets</span> <span class="o">=</span> <span class="n">get_available_astrological_points_list</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-288"><a href="#EphemerisDataFactory-288"><span class="linenos">288</span></a>
</span><span id="EphemerisDataFactory-289"><a href="#EphemerisDataFactory-289"><span class="linenos">289</span></a>            <span class="n">ephemeris_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s2">&quot;planets&quot;</span><span class="p">:</span> <span class="n">available_planets</span><span class="p">,</span> <span class="s2">&quot;houses&quot;</span><span class="p">:</span> <span class="n">houses_list</span><span class="p">})</span>
</span><span id="EphemerisDataFactory-290"><a href="#EphemerisDataFactory-290"><span class="linenos">290</span></a>
</span><span id="EphemerisDataFactory-291"><a href="#EphemerisDataFactory-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="n">as_model</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-292"><a href="#EphemerisDataFactory-292"><span class="linenos">292</span></a>            <span class="c1"># Type narrowing: at this point, the dict structure matches EphemerisDictModel</span>
</span><span id="EphemerisDataFactory-293"><a href="#EphemerisDataFactory-293"><span class="linenos">293</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">EphemerisDictModel</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">planets</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;planets&quot;</span><span class="p">],</span> <span class="n">houses</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ephemeris_data_list</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="EphemerisDataFactory-294"><a href="#EphemerisDataFactory-294"><span class="linenos">294</span></a>
</span><span id="EphemerisDataFactory-295"><a href="#EphemerisDataFactory-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">ephemeris_data_list</span>
</span><span id="EphemerisDataFactory-296"><a href="#EphemerisDataFactory-296"><span class="linenos">296</span></a>
</span><span id="EphemerisDataFactory-297"><a href="#EphemerisDataFactory-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ephemeris_data_as_astrological_subjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">]:</span>
</span><span id="EphemerisDataFactory-298"><a href="#EphemerisDataFactory-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory-299"><a href="#EphemerisDataFactory-299"><span class="linenos">299</span></a><span class="sd">        Generate ephemeris data as complete AstrologicalSubject instances.</span>
</span><span id="EphemerisDataFactory-300"><a href="#EphemerisDataFactory-300"><span class="linenos">300</span></a>
</span><span id="EphemerisDataFactory-301"><a href="#EphemerisDataFactory-301"><span class="linenos">301</span></a><span class="sd">        This method creates fully-featured AstrologicalSubject objects for each date in the</span>
</span><span id="EphemerisDataFactory-302"><a href="#EphemerisDataFactory-302"><span class="linenos">302</span></a><span class="sd">        configured time series, providing access to all astrological calculation methods</span>
</span><span id="EphemerisDataFactory-303"><a href="#EphemerisDataFactory-303"><span class="linenos">303</span></a><span class="sd">        and properties. Unlike the dictionary-based approach of get_ephemeris_data(),</span>
</span><span id="EphemerisDataFactory-304"><a href="#EphemerisDataFactory-304"><span class="linenos">304</span></a><span class="sd">        this method returns objects with the complete Kerykeion API available.</span>
</span><span id="EphemerisDataFactory-305"><a href="#EphemerisDataFactory-305"><span class="linenos">305</span></a>
</span><span id="EphemerisDataFactory-306"><a href="#EphemerisDataFactory-306"><span class="linenos">306</span></a><span class="sd">        Each AstrologicalSubject instance represents a complete astrological chart for</span>
</span><span id="EphemerisDataFactory-307"><a href="#EphemerisDataFactory-307"><span class="linenos">307</span></a><span class="sd">        the specified moment, location, and calculation settings. This allows direct</span>
</span><span id="EphemerisDataFactory-308"><a href="#EphemerisDataFactory-308"><span class="linenos">308</span></a><span class="sd">        access to methods like get_sun(), get_all_points(), draw_chart(), calculate</span>
</span><span id="EphemerisDataFactory-309"><a href="#EphemerisDataFactory-309"><span class="linenos">309</span></a><span class="sd">        aspects, and all other astrological analysis features.</span>
</span><span id="EphemerisDataFactory-310"><a href="#EphemerisDataFactory-310"><span class="linenos">310</span></a>
</span><span id="EphemerisDataFactory-311"><a href="#EphemerisDataFactory-311"><span class="linenos">311</span></a><span class="sd">        Args:</span>
</span><span id="EphemerisDataFactory-312"><a href="#EphemerisDataFactory-312"><span class="linenos">312</span></a><span class="sd">            as_model (bool, optional): If True, returns AstrologicalSubjectModel instances</span>
</span><span id="EphemerisDataFactory-313"><a href="#EphemerisDataFactory-313"><span class="linenos">313</span></a><span class="sd">                (Pydantic model versions) which provide serialization and validation features.</span>
</span><span id="EphemerisDataFactory-314"><a href="#EphemerisDataFactory-314"><span class="linenos">314</span></a><span class="sd">                If False, returns raw AstrologicalSubject instances with full method access.</span>
</span><span id="EphemerisDataFactory-315"><a href="#EphemerisDataFactory-315"><span class="linenos">315</span></a><span class="sd">                Defaults to False.</span>
</span><span id="EphemerisDataFactory-316"><a href="#EphemerisDataFactory-316"><span class="linenos">316</span></a>
</span><span id="EphemerisDataFactory-317"><a href="#EphemerisDataFactory-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="EphemerisDataFactory-318"><a href="#EphemerisDataFactory-318"><span class="linenos">318</span></a><span class="sd">            List[AstrologicalSubjectModel]: A list of AstrologicalSubject or</span>
</span><span id="EphemerisDataFactory-319"><a href="#EphemerisDataFactory-319"><span class="linenos">319</span></a><span class="sd">                AstrologicalSubjectModel instances (depending on as_model parameter).</span>
</span><span id="EphemerisDataFactory-320"><a href="#EphemerisDataFactory-320"><span class="linenos">320</span></a><span class="sd">                Each element represents one calculated moment in time with full</span>
</span><span id="EphemerisDataFactory-321"><a href="#EphemerisDataFactory-321"><span class="linenos">321</span></a><span class="sd">                astrological chart data and methods available.</span>
</span><span id="EphemerisDataFactory-322"><a href="#EphemerisDataFactory-322"><span class="linenos">322</span></a>
</span><span id="EphemerisDataFactory-323"><a href="#EphemerisDataFactory-323"><span class="linenos">323</span></a><span class="sd">                Each subject contains:</span>
</span><span id="EphemerisDataFactory-324"><a href="#EphemerisDataFactory-324"><span class="linenos">324</span></a><span class="sd">                - All planetary and astrological point positions</span>
</span><span id="EphemerisDataFactory-325"><a href="#EphemerisDataFactory-325"><span class="linenos">325</span></a><span class="sd">                - Complete house system calculations</span>
</span><span id="EphemerisDataFactory-326"><a href="#EphemerisDataFactory-326"><span class="linenos">326</span></a><span class="sd">                - Chart drawing capabilities</span>
</span><span id="EphemerisDataFactory-327"><a href="#EphemerisDataFactory-327"><span class="linenos">327</span></a><span class="sd">                - Aspect calculation methods</span>
</span><span id="EphemerisDataFactory-328"><a href="#EphemerisDataFactory-328"><span class="linenos">328</span></a><span class="sd">                - Access to all Kerykeion astrological features</span>
</span><span id="EphemerisDataFactory-329"><a href="#EphemerisDataFactory-329"><span class="linenos">329</span></a>
</span><span id="EphemerisDataFactory-330"><a href="#EphemerisDataFactory-330"><span class="linenos">330</span></a><span class="sd">        Examples:</span>
</span><span id="EphemerisDataFactory-331"><a href="#EphemerisDataFactory-331"><span class="linenos">331</span></a><span class="sd">            Basic usage for accessing individual chart features:</span>
</span><span id="EphemerisDataFactory-332"><a href="#EphemerisDataFactory-332"><span class="linenos">332</span></a>
</span><span id="EphemerisDataFactory-333"><a href="#EphemerisDataFactory-333"><span class="linenos">333</span></a><span class="sd">            &gt;&gt;&gt; factory = EphemerisDataFactory(start_date, end_date)</span>
</span><span id="EphemerisDataFactory-334"><a href="#EphemerisDataFactory-334"><span class="linenos">334</span></a><span class="sd">            &gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()</span>
</span><span id="EphemerisDataFactory-335"><a href="#EphemerisDataFactory-335"><span class="linenos">335</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="EphemerisDataFactory-336"><a href="#EphemerisDataFactory-336"><span class="linenos">336</span></a><span class="sd">            &gt;&gt;&gt; # Access specific planetary data</span>
</span><span id="EphemerisDataFactory-337"><a href="#EphemerisDataFactory-337"><span class="linenos">337</span></a><span class="sd">            &gt;&gt;&gt; sun_data = subjects[0].get_sun()</span>
</span><span id="EphemerisDataFactory-338"><a href="#EphemerisDataFactory-338"><span class="linenos">338</span></a><span class="sd">            &gt;&gt;&gt; moon_data = subjects[0].get_moon()</span>
</span><span id="EphemerisDataFactory-339"><a href="#EphemerisDataFactory-339"><span class="linenos">339</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="EphemerisDataFactory-340"><a href="#EphemerisDataFactory-340"><span class="linenos">340</span></a><span class="sd">            &gt;&gt;&gt; # Get all astrological points</span>
</span><span id="EphemerisDataFactory-341"><a href="#EphemerisDataFactory-341"><span class="linenos">341</span></a><span class="sd">            &gt;&gt;&gt; all_points = subjects[0].get_all_points()</span>
</span><span id="EphemerisDataFactory-342"><a href="#EphemerisDataFactory-342"><span class="linenos">342</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="EphemerisDataFactory-343"><a href="#EphemerisDataFactory-343"><span class="linenos">343</span></a><span class="sd">            &gt;&gt;&gt; # Generate chart visualization</span>
</span><span id="EphemerisDataFactory-344"><a href="#EphemerisDataFactory-344"><span class="linenos">344</span></a><span class="sd">            &gt;&gt;&gt; chart_svg = subjects[0].draw_chart()</span>
</span><span id="EphemerisDataFactory-345"><a href="#EphemerisDataFactory-345"><span class="linenos">345</span></a>
</span><span id="EphemerisDataFactory-346"><a href="#EphemerisDataFactory-346"><span class="linenos">346</span></a><span class="sd">            Using model instances for serialization:</span>
</span><span id="EphemerisDataFactory-347"><a href="#EphemerisDataFactory-347"><span class="linenos">347</span></a>
</span><span id="EphemerisDataFactory-348"><a href="#EphemerisDataFactory-348"><span class="linenos">348</span></a><span class="sd">            &gt;&gt;&gt; subjects_models = factory.get_ephemeris_data_as_astrological_subjects(as_model=True)</span>
</span><span id="EphemerisDataFactory-349"><a href="#EphemerisDataFactory-349"><span class="linenos">349</span></a><span class="sd">            &gt;&gt;&gt; # Model instances can be easily serialized to JSON</span>
</span><span id="EphemerisDataFactory-350"><a href="#EphemerisDataFactory-350"><span class="linenos">350</span></a><span class="sd">            &gt;&gt;&gt; json_data = subjects_models[0].model_dump_json()</span>
</span><span id="EphemerisDataFactory-351"><a href="#EphemerisDataFactory-351"><span class="linenos">351</span></a>
</span><span id="EphemerisDataFactory-352"><a href="#EphemerisDataFactory-352"><span class="linenos">352</span></a><span class="sd">            Batch processing for analysis:</span>
</span><span id="EphemerisDataFactory-353"><a href="#EphemerisDataFactory-353"><span class="linenos">353</span></a>
</span><span id="EphemerisDataFactory-354"><a href="#EphemerisDataFactory-354"><span class="linenos">354</span></a><span class="sd">            &gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()</span>
</span><span id="EphemerisDataFactory-355"><a href="#EphemerisDataFactory-355"><span class="linenos">355</span></a><span class="sd">            &gt;&gt;&gt; sun_positions = [subj.sun[&#39;abs_pos&#39;] for subj in subjects if subj.sun]</span>
</span><span id="EphemerisDataFactory-356"><a href="#EphemerisDataFactory-356"><span class="linenos">356</span></a><span class="sd">            &gt;&gt;&gt; # Analyze sun position changes over time</span>
</span><span id="EphemerisDataFactory-357"><a href="#EphemerisDataFactory-357"><span class="linenos">357</span></a>
</span><span id="EphemerisDataFactory-358"><a href="#EphemerisDataFactory-358"><span class="linenos">358</span></a><span class="sd">        Use Cases:</span>
</span><span id="EphemerisDataFactory-359"><a href="#EphemerisDataFactory-359"><span class="linenos">359</span></a><span class="sd">            - Time-series astrological analysis</span>
</span><span id="EphemerisDataFactory-360"><a href="#EphemerisDataFactory-360"><span class="linenos">360</span></a><span class="sd">            - Planetary motion tracking</span>
</span><span id="EphemerisDataFactory-361"><a href="#EphemerisDataFactory-361"><span class="linenos">361</span></a><span class="sd">            - Aspect pattern analysis over time</span>
</span><span id="EphemerisDataFactory-362"><a href="#EphemerisDataFactory-362"><span class="linenos">362</span></a><span class="sd">            - Chart animation data generation</span>
</span><span id="EphemerisDataFactory-363"><a href="#EphemerisDataFactory-363"><span class="linenos">363</span></a><span class="sd">            - Astrological research and statistics</span>
</span><span id="EphemerisDataFactory-364"><a href="#EphemerisDataFactory-364"><span class="linenos">364</span></a><span class="sd">            - Progressive chart calculations</span>
</span><span id="EphemerisDataFactory-365"><a href="#EphemerisDataFactory-365"><span class="linenos">365</span></a>
</span><span id="EphemerisDataFactory-366"><a href="#EphemerisDataFactory-366"><span class="linenos">366</span></a><span class="sd">        Performance Notes:</span>
</span><span id="EphemerisDataFactory-367"><a href="#EphemerisDataFactory-367"><span class="linenos">367</span></a><span class="sd">            - More computationally intensive than get_ephemeris_data()</span>
</span><span id="EphemerisDataFactory-368"><a href="#EphemerisDataFactory-368"><span class="linenos">368</span></a><span class="sd">            - Each subject performs full astrological calculations</span>
</span><span id="EphemerisDataFactory-369"><a href="#EphemerisDataFactory-369"><span class="linenos">369</span></a><span class="sd">            - Memory usage scales with the number of data points</span>
</span><span id="EphemerisDataFactory-370"><a href="#EphemerisDataFactory-370"><span class="linenos">370</span></a><span class="sd">            - Consider processing in batches for very large date ranges</span>
</span><span id="EphemerisDataFactory-371"><a href="#EphemerisDataFactory-371"><span class="linenos">371</span></a><span class="sd">            - Ideal for comprehensive analysis requiring full chart features</span>
</span><span id="EphemerisDataFactory-372"><a href="#EphemerisDataFactory-372"><span class="linenos">372</span></a>
</span><span id="EphemerisDataFactory-373"><a href="#EphemerisDataFactory-373"><span class="linenos">373</span></a><span class="sd">        See Also:</span>
</span><span id="EphemerisDataFactory-374"><a href="#EphemerisDataFactory-374"><span class="linenos">374</span></a><span class="sd">            get_ephemeris_data(): For lightweight dictionary-based ephemeris data</span>
</span><span id="EphemerisDataFactory-375"><a href="#EphemerisDataFactory-375"><span class="linenos">375</span></a><span class="sd">            AstrologicalSubject: For details on available methods and properties</span>
</span><span id="EphemerisDataFactory-376"><a href="#EphemerisDataFactory-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory-377"><a href="#EphemerisDataFactory-377"><span class="linenos">377</span></a>        <span class="n">subjects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EphemerisDataFactory-378"><a href="#EphemerisDataFactory-378"><span class="linenos">378</span></a>        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-379"><a href="#EphemerisDataFactory-379"><span class="linenos">379</span></a>            <span class="n">subject</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="EphemerisDataFactory-380"><a href="#EphemerisDataFactory-380"><span class="linenos">380</span></a>                <span class="n">year</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-381"><a href="#EphemerisDataFactory-381"><span class="linenos">381</span></a>                <span class="n">month</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-382"><a href="#EphemerisDataFactory-382"><span class="linenos">382</span></a>                <span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-383"><a href="#EphemerisDataFactory-383"><span class="linenos">383</span></a>                <span class="n">hour</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-384"><a href="#EphemerisDataFactory-384"><span class="linenos">384</span></a>                <span class="n">minute</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-385"><a href="#EphemerisDataFactory-385"><span class="linenos">385</span></a>                <span class="n">lng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-386"><a href="#EphemerisDataFactory-386"><span class="linenos">386</span></a>                <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-387"><a href="#EphemerisDataFactory-387"><span class="linenos">387</span></a>                <span class="n">tz_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-388"><a href="#EphemerisDataFactory-388"><span class="linenos">388</span></a>                <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-389"><a href="#EphemerisDataFactory-389"><span class="linenos">389</span></a>                <span class="n">nation</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-390"><a href="#EphemerisDataFactory-390"><span class="linenos">390</span></a>                <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-391"><a href="#EphemerisDataFactory-391"><span class="linenos">391</span></a>                <span class="n">zodiac_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-392"><a href="#EphemerisDataFactory-392"><span class="linenos">392</span></a>                <span class="n">sidereal_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-393"><a href="#EphemerisDataFactory-393"><span class="linenos">393</span></a>                <span class="n">houses_system_identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-394"><a href="#EphemerisDataFactory-394"><span class="linenos">394</span></a>                <span class="n">perspective_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-395"><a href="#EphemerisDataFactory-395"><span class="linenos">395</span></a>                <span class="n">is_dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dst</span><span class="p">,</span>
</span><span id="EphemerisDataFactory-396"><a href="#EphemerisDataFactory-396"><span class="linenos">396</span></a>            <span class="p">)</span>
</span><span id="EphemerisDataFactory-397"><a href="#EphemerisDataFactory-397"><span class="linenos">397</span></a>
</span><span id="EphemerisDataFactory-398"><a href="#EphemerisDataFactory-398"><span class="linenos">398</span></a>            <span class="k">if</span> <span class="n">as_model</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-399"><a href="#EphemerisDataFactory-399"><span class="linenos">399</span></a>                <span class="n">subjects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-400"><a href="#EphemerisDataFactory-400"><span class="linenos">400</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EphemerisDataFactory-401"><a href="#EphemerisDataFactory-401"><span class="linenos">401</span></a>                <span class="n">subjects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory-402"><a href="#EphemerisDataFactory-402"><span class="linenos">402</span></a>
</span><span id="EphemerisDataFactory-403"><a href="#EphemerisDataFactory-403"><span class="linenos">403</span></a>        <span class="k">return</span> <span class="n">subjects_list</span>
</span></pre></div>


            <div class="docstring"><p>A factory class for generating ephemeris data over a specified date range.</p>

<p>This class calculates astrological ephemeris data (planetary positions and house cusps)
for a sequence of dates, allowing for detailed astronomical calculations across time periods.
It supports different time intervals (days, hours, or minutes) and various astrological
calculation systems.</p>

<p>The factory creates data points at regular intervals between start and end dates,
with built-in safeguards to prevent excessive computational loads through configurable
maximum limits.</p>

<p>Args:
    start_datetime (datetime): The starting date and time for ephemeris calculations.
    end_datetime (datetime): The ending date and time for ephemeris calculations.
    step_type (Literal["days", "hours", "minutes"], optional): The time interval unit
        for data points. Defaults to "days".
    step (int, optional): The number of units to advance for each data point.
        For example, step=2 with step_type="days" creates data points every 2 days.
        Defaults to 1.
    lat (float, optional): Geographic latitude in decimal degrees for calculations.
        Positive values for North, negative for South. Defaults to 51.4769 (Greenwich).
    lng (float, optional): Geographic longitude in decimal degrees for calculations.
        Positive values for East, negative for West. Defaults to 0.0005 (Greenwich).
    tz_str (str, optional): Timezone identifier (e.g., "Europe/London", "America/New_York").
        Defaults to "Etc/UTC".
    is_dst (bool, optional): Whether daylight saving time is active for the location.
        Only relevant for certain timezone calculations. Defaults to False.
    zodiac_type (ZodiacType, optional): The zodiac system to use (tropical or sidereal).
        Defaults to DEFAULT_ZODIAC_TYPE.
    sidereal_mode (Union[SiderealMode, None], optional): The sidereal calculation mode
        if using sidereal zodiac. Only applies when zodiac_type is sidereal.
        Defaults to None.
    houses_system_identifier (HousesSystemIdentifier, optional): The house system
        for astrological house calculations (e.g., Placidus, Koch, Equal).
        Defaults to DEFAULT_HOUSES_SYSTEM_IDENTIFIER.
    perspective_type (PerspectiveType, optional): The calculation perspective
        (geocentric, heliocentric, etc.). Defaults to DEFAULT_PERSPECTIVE_TYPE.
    max_days (Union[int, None], optional): Maximum number of daily data points allowed.
        Set to None to disable this safety check. Defaults to 730 (2 years).
    max_hours (Union[int, None], optional): Maximum number of hourly data points allowed.
        Set to None to disable this safety check. Defaults to 8760 (1 year).
    max_minutes (Union[int, None], optional): Maximum number of minute-interval data points.
        Set to None to disable this safety check. Defaults to 525600 (1 year).</p>

<p>Raises:
    ValueError: If step_type is not one of "days", "hours", or "minutes".
    ValueError: If the calculated number of data points exceeds the respective maximum limit.
    ValueError: If no valid dates are generated from the input parameters.</p>

<p>Examples:
    Create daily ephemeris data for a month:</p>

<pre><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; start = datetime(2024, 1, 1)
&gt;&gt;&gt; end = datetime(2024, 1, 31)
&gt;&gt;&gt; factory = EphemerisDataFactory(start, end)
&gt;&gt;&gt; data = factory.get_ephemeris_data()

Create hourly data for a specific location:

&gt;&gt;&gt; factory = EphemerisDataFactory(
...     start, end,
...     step_type="hours",
...     lat=40.7128,  # New York
...     lng=-74.0060,
...     tz_str="America/New_York"
... )
&gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()
</code></pre>

<p>Note:
    Large date ranges with small step intervals can generate thousands of data points,
    which may require significant computation time and memory. The factory includes
    warnings for calculations exceeding 1000 data points and enforces maximum limits
    to prevent system overload.</p>
</div>


                            <div id="EphemerisDataFactory.__init__" class="classattr">
                                        <input id="EphemerisDataFactory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EphemerisDataFactory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>,</span><span class="param">	<span class="n">end_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>,</span><span class="param">	<span class="n">step_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;minutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;days&#39;</span>,</span><span class="param">	<span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">51.4769</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0005</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Etc/UTC&#39;</span>,</span><span class="param">	<span class="n">is_dst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span> <span class="s1">&#39;Sidereal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tropical&#39;</span>,</span><span class="param">	<span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FAGAN_BRADLEY&#39;</span><span class="p">,</span> <span class="s1">&#39;LAHIRI&#39;</span><span class="p">,</span> <span class="s1">&#39;DELUCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMAN&#39;</span><span class="p">,</span> <span class="s1">&#39;USHASHASHI&#39;</span><span class="p">,</span> <span class="s1">&#39;KRISHNAMURTI&#39;</span><span class="p">,</span> <span class="s1">&#39;DJWHAL_KHUL&#39;</span><span class="p">,</span> <span class="s1">&#39;YUKTESHWAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JN_BHASIN&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER1&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER2&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER3&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_HUBER&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_ETPSC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALDEBARAN_15TAU&#39;</span><span class="p">,</span> <span class="s1">&#39;HIPPARCHOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SASSANIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;J2000&#39;</span><span class="p">,</span> <span class="s1">&#39;J1900&#39;</span><span class="p">,</span> <span class="s1">&#39;B1950&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span>,</span><span class="param">	<span class="n">perspective_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Apparent Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Heliocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Topocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;True Geocentric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Apparent Geocentric&#39;</span>,</span><span class="param">	<span class="n">max_days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">730</span>,</span><span class="param">	<span class="n">max_hours</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8760</span>,</span><span class="param">	<span class="n">max_minutes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">525600</span></span>)</span>

                <label class="view-source-button" for="EphemerisDataFactory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EphemerisDataFactory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EphemerisDataFactory.__init__-148"><a href="#EphemerisDataFactory.__init__-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="EphemerisDataFactory.__init__-149"><a href="#EphemerisDataFactory.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-150"><a href="#EphemerisDataFactory.__init__-150"><span class="linenos">150</span></a>        <span class="n">start_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-151"><a href="#EphemerisDataFactory.__init__-151"><span class="linenos">151</span></a>        <span class="n">end_datetime</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-152"><a href="#EphemerisDataFactory.__init__-152"><span class="linenos">152</span></a>        <span class="n">step_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;days&quot;</span><span class="p">,</span> <span class="s2">&quot;hours&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;days&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-153"><a href="#EphemerisDataFactory.__init__-153"><span class="linenos">153</span></a>        <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-154"><a href="#EphemerisDataFactory.__init__-154"><span class="linenos">154</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">51.4769</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-155"><a href="#EphemerisDataFactory.__init__-155"><span class="linenos">155</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-156"><a href="#EphemerisDataFactory.__init__-156"><span class="linenos">156</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/UTC&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-157"><a href="#EphemerisDataFactory.__init__-157"><span class="linenos">157</span></a>        <span class="n">is_dst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-158"><a href="#EphemerisDataFactory.__init__-158"><span class="linenos">158</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">ZodiacType</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-159"><a href="#EphemerisDataFactory.__init__-159"><span class="linenos">159</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-160"><a href="#EphemerisDataFactory.__init__-160"><span class="linenos">160</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">HousesSystemIdentifier</span> <span class="o">=</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-161"><a href="#EphemerisDataFactory.__init__-161"><span class="linenos">161</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">PerspectiveType</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-162"><a href="#EphemerisDataFactory.__init__-162"><span class="linenos">162</span></a>        <span class="n">max_days</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">730</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-163"><a href="#EphemerisDataFactory.__init__-163"><span class="linenos">163</span></a>        <span class="n">max_hours</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8760</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-164"><a href="#EphemerisDataFactory.__init__-164"><span class="linenos">164</span></a>        <span class="n">max_minutes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">525600</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.__init__-165"><a href="#EphemerisDataFactory.__init__-165"><span class="linenos">165</span></a>    <span class="p">):</span>
</span><span id="EphemerisDataFactory.__init__-166"><a href="#EphemerisDataFactory.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">=</span> <span class="n">start_datetime</span>
</span><span id="EphemerisDataFactory.__init__-167"><a href="#EphemerisDataFactory.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">=</span> <span class="n">end_datetime</span>
</span><span id="EphemerisDataFactory.__init__-168"><a href="#EphemerisDataFactory.__init__-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">=</span> <span class="n">step_type</span>
</span><span id="EphemerisDataFactory.__init__-169"><a href="#EphemerisDataFactory.__init__-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
</span><span id="EphemerisDataFactory.__init__-170"><a href="#EphemerisDataFactory.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
</span><span id="EphemerisDataFactory.__init__-171"><a href="#EphemerisDataFactory.__init__-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="n">lng</span>
</span><span id="EphemerisDataFactory.__init__-172"><a href="#EphemerisDataFactory.__init__-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span> <span class="o">=</span> <span class="n">tz_str</span>
</span><span id="EphemerisDataFactory.__init__-173"><a href="#EphemerisDataFactory.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_dst</span> <span class="o">=</span> <span class="n">is_dst</span>
</span><span id="EphemerisDataFactory.__init__-174"><a href="#EphemerisDataFactory.__init__-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">normalize_zodiac_type</span><span class="p">(</span><span class="n">zodiac_type</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.__init__-175"><a href="#EphemerisDataFactory.__init__-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span> <span class="o">=</span> <span class="n">sidereal_mode</span>
</span><span id="EphemerisDataFactory.__init__-176"><a href="#EphemerisDataFactory.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span> <span class="o">=</span> <span class="n">houses_system_identifier</span>
</span><span id="EphemerisDataFactory.__init__-177"><a href="#EphemerisDataFactory.__init__-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span> <span class="o">=</span> <span class="n">perspective_type</span>
</span><span id="EphemerisDataFactory.__init__-178"><a href="#EphemerisDataFactory.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_days</span> <span class="o">=</span> <span class="n">max_days</span>
</span><span id="EphemerisDataFactory.__init__-179"><a href="#EphemerisDataFactory.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_hours</span> <span class="o">=</span> <span class="n">max_hours</span>
</span><span id="EphemerisDataFactory.__init__-180"><a href="#EphemerisDataFactory.__init__-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_minutes</span> <span class="o">=</span> <span class="n">max_minutes</span>
</span><span id="EphemerisDataFactory.__init__-181"><a href="#EphemerisDataFactory.__init__-181"><span class="linenos">181</span></a>
</span><span id="EphemerisDataFactory.__init__-182"><a href="#EphemerisDataFactory.__init__-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EphemerisDataFactory.__init__-183"><a href="#EphemerisDataFactory.__init__-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;days&quot;</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.__init__-184"><a href="#EphemerisDataFactory.__init__-184"><span class="linenos">184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="EphemerisDataFactory.__init__-185"><a href="#EphemerisDataFactory.__init__-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">max_days</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_days</span><span class="p">):</span>
</span><span id="EphemerisDataFactory.__init__-186"><a href="#EphemerisDataFactory.__init__-186"><span class="linenos">186</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many days: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_days</span><span class="si">}</span><span class="s2">. To prevent this error, set max_days to a higher value or reduce the date range.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.__init__-187"><a href="#EphemerisDataFactory.__init__-187"><span class="linenos">187</span></a>
</span><span id="EphemerisDataFactory.__init__-188"><a href="#EphemerisDataFactory.__init__-188"><span class="linenos">188</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;hours&quot;</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.__init__-189"><a href="#EphemerisDataFactory.__init__-189"><span class="linenos">189</span></a>            <span class="n">hours_diff</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>
</span><span id="EphemerisDataFactory.__init__-190"><a href="#EphemerisDataFactory.__init__-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hours_diff</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="EphemerisDataFactory.__init__-191"><a href="#EphemerisDataFactory.__init__-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="n">max_hours</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_hours</span><span class="p">):</span>
</span><span id="EphemerisDataFactory.__init__-192"><a href="#EphemerisDataFactory.__init__-192"><span class="linenos">192</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many hours: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hours</span><span class="si">}</span><span class="s2">. To prevent this error, set max_hours to a higher value or reduce the date range.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.__init__-193"><a href="#EphemerisDataFactory.__init__-193"><span class="linenos">193</span></a>
</span><span id="EphemerisDataFactory.__init__-194"><a href="#EphemerisDataFactory.__init__-194"><span class="linenos">194</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;minutes&quot;</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.__init__-195"><a href="#EphemerisDataFactory.__init__-195"><span class="linenos">195</span></a>            <span class="n">minutes_diff</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_datetime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
</span><span id="EphemerisDataFactory.__init__-196"><a href="#EphemerisDataFactory.__init__-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minutes_diff</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="EphemerisDataFactory.__init__-197"><a href="#EphemerisDataFactory.__init__-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="n">max_minutes</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_minutes</span><span class="p">):</span>
</span><span id="EphemerisDataFactory.__init__-198"><a href="#EphemerisDataFactory.__init__-198"><span class="linenos">198</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many minutes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_minutes</span><span class="si">}</span><span class="s2">. To prevent this error, set max_minutes to a higher value or reduce the date range.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.__init__-199"><a href="#EphemerisDataFactory.__init__-199"><span class="linenos">199</span></a>
</span><span id="EphemerisDataFactory.__init__-200"><a href="#EphemerisDataFactory.__init__-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.__init__-201"><a href="#EphemerisDataFactory.__init__-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid step type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.__init__-202"><a href="#EphemerisDataFactory.__init__-202"><span class="linenos">202</span></a>
</span><span id="EphemerisDataFactory.__init__-203"><a href="#EphemerisDataFactory.__init__-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.__init__-204"><a href="#EphemerisDataFactory.__init__-204"><span class="linenos">204</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No dates found. Check the date range and step values.&quot;</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.__init__-205"><a href="#EphemerisDataFactory.__init__-205"><span class="linenos">205</span></a>
</span><span id="EphemerisDataFactory.__init__-206"><a href="#EphemerisDataFactory.__init__-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.__init__-207"><a href="#EphemerisDataFactory.__init__-207"><span class="linenos">207</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Large number of dates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">)</span><span class="si">}</span><span class="s2">. The calculation may take a while.&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="EphemerisDataFactory.start_datetime" class="classattr">
                                <div class="attr variable">
            <span class="name">start_datetime</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.start_datetime"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.end_datetime" class="classattr">
                                <div class="attr variable">
            <span class="name">end_datetime</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.end_datetime"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.step_type" class="classattr">
                                <div class="attr variable">
            <span class="name">step_type</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.step_type"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.step" class="classattr">
                                <div class="attr variable">
            <span class="name">step</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.step"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.lat" class="classattr">
                                <div class="attr variable">
            <span class="name">lat</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.lat"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.lng" class="classattr">
                                <div class="attr variable">
            <span class="name">lng</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.lng"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.tz_str" class="classattr">
                                <div class="attr variable">
            <span class="name">tz_str</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.tz_str"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.is_dst" class="classattr">
                                <div class="attr variable">
            <span class="name">is_dst</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.is_dst"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.zodiac_type" class="classattr">
                                <div class="attr variable">
            <span class="name">zodiac_type</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.zodiac_type"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.sidereal_mode" class="classattr">
                                <div class="attr variable">
            <span class="name">sidereal_mode</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.sidereal_mode"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.houses_system_identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">houses_system_identifier</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.houses_system_identifier"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.perspective_type" class="classattr">
                                <div class="attr variable">
            <span class="name">perspective_type</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.perspective_type"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.max_days" class="classattr">
                                <div class="attr variable">
            <span class="name">max_days</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.max_days"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.max_hours" class="classattr">
                                <div class="attr variable">
            <span class="name">max_hours</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.max_hours"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.max_minutes" class="classattr">
                                <div class="attr variable">
            <span class="name">max_minutes</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.max_minutes"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.dates_list" class="classattr">
                                <div class="attr variable">
            <span class="name">dates_list</span>

        
    </div>
    <a class="headerlink" href="#EphemerisDataFactory.dates_list"></a>
    
    

                            </div>
                            <div id="EphemerisDataFactory.get_ephemeris_data" class="classattr">
                                        <input id="EphemerisDataFactory.get_ephemeris_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ephemeris_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">as_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">list</span>:</span></span>

                <label class="view-source-button" for="EphemerisDataFactory.get_ephemeris_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EphemerisDataFactory.get_ephemeris_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EphemerisDataFactory.get_ephemeris_data-209"><a href="#EphemerisDataFactory.get_ephemeris_data-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ephemeris_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-210"><a href="#EphemerisDataFactory.get_ephemeris_data-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-211"><a href="#EphemerisDataFactory.get_ephemeris_data-211"><span class="linenos">211</span></a><span class="sd">        Generate ephemeris data for the specified date range.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-212"><a href="#EphemerisDataFactory.get_ephemeris_data-212"><span class="linenos">212</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-213"><a href="#EphemerisDataFactory.get_ephemeris_data-213"><span class="linenos">213</span></a><span class="sd">        This method creates a comprehensive dataset containing planetary positions and</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-214"><a href="#EphemerisDataFactory.get_ephemeris_data-214"><span class="linenos">214</span></a><span class="sd">        astrological house cusps for each date in the configured time series. The data</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-215"><a href="#EphemerisDataFactory.get_ephemeris_data-215"><span class="linenos">215</span></a><span class="sd">        is structured for easy consumption by astrological applications and analysis tools.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-216"><a href="#EphemerisDataFactory.get_ephemeris_data-216"><span class="linenos">216</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-217"><a href="#EphemerisDataFactory.get_ephemeris_data-217"><span class="linenos">217</span></a><span class="sd">        The returned data includes all available astrological points (planets, asteroids,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-218"><a href="#EphemerisDataFactory.get_ephemeris_data-218"><span class="linenos">218</span></a><span class="sd">        lunar nodes, etc.) as configured by the perspective type, along with complete</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-219"><a href="#EphemerisDataFactory.get_ephemeris_data-219"><span class="linenos">219</span></a><span class="sd">        house cusp information for each calculated moment.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-220"><a href="#EphemerisDataFactory.get_ephemeris_data-220"><span class="linenos">220</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-221"><a href="#EphemerisDataFactory.get_ephemeris_data-221"><span class="linenos">221</span></a><span class="sd">        Args:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-222"><a href="#EphemerisDataFactory.get_ephemeris_data-222"><span class="linenos">222</span></a><span class="sd">            as_model (bool, optional): If True, returns data as validated model instances</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-223"><a href="#EphemerisDataFactory.get_ephemeris_data-223"><span class="linenos">223</span></a><span class="sd">                (EphemerisDictModel objects) which provide type safety and validation.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-224"><a href="#EphemerisDataFactory.get_ephemeris_data-224"><span class="linenos">224</span></a><span class="sd">                If False, returns raw dictionary data for maximum flexibility.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-225"><a href="#EphemerisDataFactory.get_ephemeris_data-225"><span class="linenos">225</span></a><span class="sd">                Defaults to False.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-226"><a href="#EphemerisDataFactory.get_ephemeris_data-226"><span class="linenos">226</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-227"><a href="#EphemerisDataFactory.get_ephemeris_data-227"><span class="linenos">227</span></a><span class="sd">        Returns:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-228"><a href="#EphemerisDataFactory.get_ephemeris_data-228"><span class="linenos">228</span></a><span class="sd">            list: A list of ephemeris data points, where each element represents one</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-229"><a href="#EphemerisDataFactory.get_ephemeris_data-229"><span class="linenos">229</span></a><span class="sd">                calculated moment in time. The structure depends on the as_model parameter:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-230"><a href="#EphemerisDataFactory.get_ephemeris_data-230"><span class="linenos">230</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-231"><a href="#EphemerisDataFactory.get_ephemeris_data-231"><span class="linenos">231</span></a><span class="sd">                If as_model=False (default):</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-232"><a href="#EphemerisDataFactory.get_ephemeris_data-232"><span class="linenos">232</span></a><span class="sd">                    List of dictionaries with keys:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-233"><a href="#EphemerisDataFactory.get_ephemeris_data-233"><span class="linenos">233</span></a><span class="sd">                    - &quot;date&quot; (str): ISO format datetime string (e.g., &quot;2020-01-01T00:00:00&quot;)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-234"><a href="#EphemerisDataFactory.get_ephemeris_data-234"><span class="linenos">234</span></a><span class="sd">                    - &quot;planets&quot; (list): List of dictionaries, each containing planetary data</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-235"><a href="#EphemerisDataFactory.get_ephemeris_data-235"><span class="linenos">235</span></a><span class="sd">                      with keys like &#39;name&#39;, &#39;abs_pos&#39;, &#39;lon&#39;, &#39;lat&#39;, &#39;dist&#39;, &#39;speed&#39;, etc.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-236"><a href="#EphemerisDataFactory.get_ephemeris_data-236"><span class="linenos">236</span></a><span class="sd">                    - &quot;houses&quot; (list): List of dictionaries containing house cusp data</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-237"><a href="#EphemerisDataFactory.get_ephemeris_data-237"><span class="linenos">237</span></a><span class="sd">                      with keys like &#39;name&#39;, &#39;abs_pos&#39;, &#39;lon&#39;, etc.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-238"><a href="#EphemerisDataFactory.get_ephemeris_data-238"><span class="linenos">238</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-239"><a href="#EphemerisDataFactory.get_ephemeris_data-239"><span class="linenos">239</span></a><span class="sd">                If as_model=True:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-240"><a href="#EphemerisDataFactory.get_ephemeris_data-240"><span class="linenos">240</span></a><span class="sd">                    List of EphemerisDictModel instances providing the same data</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-241"><a href="#EphemerisDataFactory.get_ephemeris_data-241"><span class="linenos">241</span></a><span class="sd">                    with type validation and structured access.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-242"><a href="#EphemerisDataFactory.get_ephemeris_data-242"><span class="linenos">242</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-243"><a href="#EphemerisDataFactory.get_ephemeris_data-243"><span class="linenos">243</span></a><span class="sd">        Examples:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-244"><a href="#EphemerisDataFactory.get_ephemeris_data-244"><span class="linenos">244</span></a><span class="sd">            Basic usage with dictionary output:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-245"><a href="#EphemerisDataFactory.get_ephemeris_data-245"><span class="linenos">245</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-246"><a href="#EphemerisDataFactory.get_ephemeris_data-246"><span class="linenos">246</span></a><span class="sd">            &gt;&gt;&gt; factory = EphemerisDataFactory(start_date, end_date)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-247"><a href="#EphemerisDataFactory.get_ephemeris_data-247"><span class="linenos">247</span></a><span class="sd">            &gt;&gt;&gt; data = factory.get_ephemeris_data()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-248"><a href="#EphemerisDataFactory.get_ephemeris_data-248"><span class="linenos">248</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Sun position: {data[0][&#39;planets&#39;][0][&#39;abs_pos&#39;]}&quot;)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-249"><a href="#EphemerisDataFactory.get_ephemeris_data-249"><span class="linenos">249</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;First house cusp: {data[0][&#39;houses&#39;][0][&#39;abs_pos&#39;]}&quot;)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-250"><a href="#EphemerisDataFactory.get_ephemeris_data-250"><span class="linenos">250</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-251"><a href="#EphemerisDataFactory.get_ephemeris_data-251"><span class="linenos">251</span></a><span class="sd">            Using model instances for type safety:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-252"><a href="#EphemerisDataFactory.get_ephemeris_data-252"><span class="linenos">252</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-253"><a href="#EphemerisDataFactory.get_ephemeris_data-253"><span class="linenos">253</span></a><span class="sd">            &gt;&gt;&gt; data_models = factory.get_ephemeris_data(as_model=True)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-254"><a href="#EphemerisDataFactory.get_ephemeris_data-254"><span class="linenos">254</span></a><span class="sd">            &gt;&gt;&gt; first_point = data_models[0]</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-255"><a href="#EphemerisDataFactory.get_ephemeris_data-255"><span class="linenos">255</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Date: {first_point.date}&quot;)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-256"><a href="#EphemerisDataFactory.get_ephemeris_data-256"><span class="linenos">256</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Number of planets: {len(first_point.planets)}&quot;)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-257"><a href="#EphemerisDataFactory.get_ephemeris_data-257"><span class="linenos">257</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-258"><a href="#EphemerisDataFactory.get_ephemeris_data-258"><span class="linenos">258</span></a><span class="sd">        Note:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-259"><a href="#EphemerisDataFactory.get_ephemeris_data-259"><span class="linenos">259</span></a><span class="sd">            - The calculation time is proportional to the number of data points</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-260"><a href="#EphemerisDataFactory.get_ephemeris_data-260"><span class="linenos">260</span></a><span class="sd">            - For large datasets (&gt;1000 points), consider using the method in batches</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-261"><a href="#EphemerisDataFactory.get_ephemeris_data-261"><span class="linenos">261</span></a><span class="sd">            - Planet order and availability depend on the configured perspective type</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-262"><a href="#EphemerisDataFactory.get_ephemeris_data-262"><span class="linenos">262</span></a><span class="sd">            - House system affects the house cusp calculations</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-263"><a href="#EphemerisDataFactory.get_ephemeris_data-263"><span class="linenos">263</span></a><span class="sd">            - All positions are in the configured zodiac system (tropical/sidereal)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-264"><a href="#EphemerisDataFactory.get_ephemeris_data-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-265"><a href="#EphemerisDataFactory.get_ephemeris_data-265"><span class="linenos">265</span></a>        <span class="n">ephemeris_data_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-266"><a href="#EphemerisDataFactory.get_ephemeris_data-266"><span class="linenos">266</span></a>        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-267"><a href="#EphemerisDataFactory.get_ephemeris_data-267"><span class="linenos">267</span></a>            <span class="n">subject</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-268"><a href="#EphemerisDataFactory.get_ephemeris_data-268"><span class="linenos">268</span></a>                <span class="n">year</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-269"><a href="#EphemerisDataFactory.get_ephemeris_data-269"><span class="linenos">269</span></a>                <span class="n">month</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-270"><a href="#EphemerisDataFactory.get_ephemeris_data-270"><span class="linenos">270</span></a>                <span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-271"><a href="#EphemerisDataFactory.get_ephemeris_data-271"><span class="linenos">271</span></a>                <span class="n">hour</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-272"><a href="#EphemerisDataFactory.get_ephemeris_data-272"><span class="linenos">272</span></a>                <span class="n">minute</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-273"><a href="#EphemerisDataFactory.get_ephemeris_data-273"><span class="linenos">273</span></a>                <span class="n">lng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-274"><a href="#EphemerisDataFactory.get_ephemeris_data-274"><span class="linenos">274</span></a>                <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-275"><a href="#EphemerisDataFactory.get_ephemeris_data-275"><span class="linenos">275</span></a>                <span class="n">tz_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-276"><a href="#EphemerisDataFactory.get_ephemeris_data-276"><span class="linenos">276</span></a>                <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-277"><a href="#EphemerisDataFactory.get_ephemeris_data-277"><span class="linenos">277</span></a>                <span class="n">nation</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-278"><a href="#EphemerisDataFactory.get_ephemeris_data-278"><span class="linenos">278</span></a>                <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-279"><a href="#EphemerisDataFactory.get_ephemeris_data-279"><span class="linenos">279</span></a>                <span class="n">zodiac_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-280"><a href="#EphemerisDataFactory.get_ephemeris_data-280"><span class="linenos">280</span></a>                <span class="n">sidereal_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-281"><a href="#EphemerisDataFactory.get_ephemeris_data-281"><span class="linenos">281</span></a>                <span class="n">houses_system_identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-282"><a href="#EphemerisDataFactory.get_ephemeris_data-282"><span class="linenos">282</span></a>                <span class="n">perspective_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-283"><a href="#EphemerisDataFactory.get_ephemeris_data-283"><span class="linenos">283</span></a>                <span class="n">is_dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dst</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-284"><a href="#EphemerisDataFactory.get_ephemeris_data-284"><span class="linenos">284</span></a>            <span class="p">)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-285"><a href="#EphemerisDataFactory.get_ephemeris_data-285"><span class="linenos">285</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-286"><a href="#EphemerisDataFactory.get_ephemeris_data-286"><span class="linenos">286</span></a>            <span class="n">houses_list</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-287"><a href="#EphemerisDataFactory.get_ephemeris_data-287"><span class="linenos">287</span></a>            <span class="n">available_planets</span> <span class="o">=</span> <span class="n">get_available_astrological_points_list</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-288"><a href="#EphemerisDataFactory.get_ephemeris_data-288"><span class="linenos">288</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-289"><a href="#EphemerisDataFactory.get_ephemeris_data-289"><span class="linenos">289</span></a>            <span class="n">ephemeris_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="s2">&quot;planets&quot;</span><span class="p">:</span> <span class="n">available_planets</span><span class="p">,</span> <span class="s2">&quot;houses&quot;</span><span class="p">:</span> <span class="n">houses_list</span><span class="p">})</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-290"><a href="#EphemerisDataFactory.get_ephemeris_data-290"><span class="linenos">290</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-291"><a href="#EphemerisDataFactory.get_ephemeris_data-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="n">as_model</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-292"><a href="#EphemerisDataFactory.get_ephemeris_data-292"><span class="linenos">292</span></a>            <span class="c1"># Type narrowing: at this point, the dict structure matches EphemerisDictModel</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-293"><a href="#EphemerisDataFactory.get_ephemeris_data-293"><span class="linenos">293</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">EphemerisDictModel</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">planets</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;planets&quot;</span><span class="p">],</span> <span class="n">houses</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;houses&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">ephemeris_data_list</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data-294"><a href="#EphemerisDataFactory.get_ephemeris_data-294"><span class="linenos">294</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data-295"><a href="#EphemerisDataFactory.get_ephemeris_data-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">ephemeris_data_list</span>
</span></pre></div>


            <div class="docstring"><p>Generate ephemeris data for the specified date range.</p>

<p>This method creates a comprehensive dataset containing planetary positions and
astrological house cusps for each date in the configured time series. The data
is structured for easy consumption by astrological applications and analysis tools.</p>

<p>The returned data includes all available astrological points (planets, asteroids,
lunar nodes, etc.) as configured by the perspective type, along with complete
house cusp information for each calculated moment.</p>

<p>Args:
    as_model (bool, optional): If True, returns data as validated model instances
        (EphemerisDictModel objects) which provide type safety and validation.
        If False, returns raw dictionary data for maximum flexibility.
        Defaults to False.</p>

<p>Returns:
    list: A list of ephemeris data points, where each element represents one
        calculated moment in time. The structure depends on the as_model parameter:</p>

<pre><code>    If as_model=False (default):
        List of dictionaries with keys:
        - "date" (str): ISO format datetime string (e.g., "2020-01-01T00:00:00")
        - "planets" (list): List of dictionaries, each containing planetary data
          with keys like 'name', 'abs_pos', 'lon', 'lat', 'dist', 'speed', etc.
        - "houses" (list): List of dictionaries containing house cusp data
          with keys like 'name', 'abs_pos', 'lon', etc.

    If as_model=True:
        List of EphemerisDictModel instances providing the same data
        with type validation and structured access.
</code></pre>

<p>Examples:
    Basic usage with dictionary output:</p>

<pre><code>&gt;&gt;&gt; factory = EphemerisDataFactory(start_date, end_date)
&gt;&gt;&gt; data = factory.get_ephemeris_data()
&gt;&gt;&gt; print(f"Sun position: {data[0]['planets'][0]['abs_pos']}")
&gt;&gt;&gt; print(f"First house cusp: {data[0]['houses'][0]['abs_pos']}")

Using model instances for type safety:

&gt;&gt;&gt; data_models = factory.get_ephemeris_data(as_model=True)
&gt;&gt;&gt; first_point = data_models[0]
&gt;&gt;&gt; print(f"Date: {first_point.date}")
&gt;&gt;&gt; print(f"Number of planets: {len(first_point.planets)}")
</code></pre>

<p>Note:
    - The calculation time is proportional to the number of data points
    - For large datasets (&gt;1000 points), consider using the method in batches
    - Planet order and availability depend on the configured perspective type
    - House system affects the house cusp calculations
    - All positions are in the configured zodiac system (tropical/sidereal)</p>
</div>


                            </div>
                            <div id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects" class="classattr">
                                        <input id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ephemeris_data_as_astrological_subjects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">as_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-297"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_ephemeris_data_as_astrological_subjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">]:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-298"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-299"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-299"><span class="linenos">299</span></a><span class="sd">        Generate ephemeris data as complete AstrologicalSubject instances.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-300"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-300"><span class="linenos">300</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-301"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-301"><span class="linenos">301</span></a><span class="sd">        This method creates fully-featured AstrologicalSubject objects for each date in the</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-302"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-302"><span class="linenos">302</span></a><span class="sd">        configured time series, providing access to all astrological calculation methods</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-303"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-303"><span class="linenos">303</span></a><span class="sd">        and properties. Unlike the dictionary-based approach of get_ephemeris_data(),</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-304"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-304"><span class="linenos">304</span></a><span class="sd">        this method returns objects with the complete Kerykeion API available.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-305"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-305"><span class="linenos">305</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-306"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-306"><span class="linenos">306</span></a><span class="sd">        Each AstrologicalSubject instance represents a complete astrological chart for</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-307"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-307"><span class="linenos">307</span></a><span class="sd">        the specified moment, location, and calculation settings. This allows direct</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-308"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-308"><span class="linenos">308</span></a><span class="sd">        access to methods like get_sun(), get_all_points(), draw_chart(), calculate</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-309"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-309"><span class="linenos">309</span></a><span class="sd">        aspects, and all other astrological analysis features.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-310"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-310"><span class="linenos">310</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-311"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-311"><span class="linenos">311</span></a><span class="sd">        Args:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-312"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-312"><span class="linenos">312</span></a><span class="sd">            as_model (bool, optional): If True, returns AstrologicalSubjectModel instances</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-313"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-313"><span class="linenos">313</span></a><span class="sd">                (Pydantic model versions) which provide serialization and validation features.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-314"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-314"><span class="linenos">314</span></a><span class="sd">                If False, returns raw AstrologicalSubject instances with full method access.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-315"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-315"><span class="linenos">315</span></a><span class="sd">                Defaults to False.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-316"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-316"><span class="linenos">316</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-317"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-318"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-318"><span class="linenos">318</span></a><span class="sd">            List[AstrologicalSubjectModel]: A list of AstrologicalSubject or</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-319"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-319"><span class="linenos">319</span></a><span class="sd">                AstrologicalSubjectModel instances (depending on as_model parameter).</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-320"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-320"><span class="linenos">320</span></a><span class="sd">                Each element represents one calculated moment in time with full</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-321"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-321"><span class="linenos">321</span></a><span class="sd">                astrological chart data and methods available.</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-322"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-322"><span class="linenos">322</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-323"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-323"><span class="linenos">323</span></a><span class="sd">                Each subject contains:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-324"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-324"><span class="linenos">324</span></a><span class="sd">                - All planetary and astrological point positions</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-325"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-325"><span class="linenos">325</span></a><span class="sd">                - Complete house system calculations</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-326"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-326"><span class="linenos">326</span></a><span class="sd">                - Chart drawing capabilities</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-327"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-327"><span class="linenos">327</span></a><span class="sd">                - Aspect calculation methods</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-328"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-328"><span class="linenos">328</span></a><span class="sd">                - Access to all Kerykeion astrological features</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-329"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-329"><span class="linenos">329</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-330"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-330"><span class="linenos">330</span></a><span class="sd">        Examples:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-331"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-331"><span class="linenos">331</span></a><span class="sd">            Basic usage for accessing individual chart features:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-332"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-332"><span class="linenos">332</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-333"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-333"><span class="linenos">333</span></a><span class="sd">            &gt;&gt;&gt; factory = EphemerisDataFactory(start_date, end_date)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-334"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-334"><span class="linenos">334</span></a><span class="sd">            &gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-335"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-335"><span class="linenos">335</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-336"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-336"><span class="linenos">336</span></a><span class="sd">            &gt;&gt;&gt; # Access specific planetary data</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-337"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-337"><span class="linenos">337</span></a><span class="sd">            &gt;&gt;&gt; sun_data = subjects[0].get_sun()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-338"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-338"><span class="linenos">338</span></a><span class="sd">            &gt;&gt;&gt; moon_data = subjects[0].get_moon()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-339"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-339"><span class="linenos">339</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-340"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-340"><span class="linenos">340</span></a><span class="sd">            &gt;&gt;&gt; # Get all astrological points</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-341"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-341"><span class="linenos">341</span></a><span class="sd">            &gt;&gt;&gt; all_points = subjects[0].get_all_points()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-342"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-342"><span class="linenos">342</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-343"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-343"><span class="linenos">343</span></a><span class="sd">            &gt;&gt;&gt; # Generate chart visualization</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-344"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-344"><span class="linenos">344</span></a><span class="sd">            &gt;&gt;&gt; chart_svg = subjects[0].draw_chart()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-345"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-345"><span class="linenos">345</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-346"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-346"><span class="linenos">346</span></a><span class="sd">            Using model instances for serialization:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-347"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-347"><span class="linenos">347</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-348"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-348"><span class="linenos">348</span></a><span class="sd">            &gt;&gt;&gt; subjects_models = factory.get_ephemeris_data_as_astrological_subjects(as_model=True)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-349"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-349"><span class="linenos">349</span></a><span class="sd">            &gt;&gt;&gt; # Model instances can be easily serialized to JSON</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-350"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-350"><span class="linenos">350</span></a><span class="sd">            &gt;&gt;&gt; json_data = subjects_models[0].model_dump_json()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-351"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-351"><span class="linenos">351</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-352"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-352"><span class="linenos">352</span></a><span class="sd">            Batch processing for analysis:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-353"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-353"><span class="linenos">353</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-354"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-354"><span class="linenos">354</span></a><span class="sd">            &gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-355"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-355"><span class="linenos">355</span></a><span class="sd">            &gt;&gt;&gt; sun_positions = [subj.sun[&#39;abs_pos&#39;] for subj in subjects if subj.sun]</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-356"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-356"><span class="linenos">356</span></a><span class="sd">            &gt;&gt;&gt; # Analyze sun position changes over time</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-357"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-357"><span class="linenos">357</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-358"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-358"><span class="linenos">358</span></a><span class="sd">        Use Cases:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-359"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-359"><span class="linenos">359</span></a><span class="sd">            - Time-series astrological analysis</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-360"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-360"><span class="linenos">360</span></a><span class="sd">            - Planetary motion tracking</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-361"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-361"><span class="linenos">361</span></a><span class="sd">            - Aspect pattern analysis over time</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-362"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-362"><span class="linenos">362</span></a><span class="sd">            - Chart animation data generation</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-363"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-363"><span class="linenos">363</span></a><span class="sd">            - Astrological research and statistics</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-364"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-364"><span class="linenos">364</span></a><span class="sd">            - Progressive chart calculations</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-365"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-365"><span class="linenos">365</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-366"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-366"><span class="linenos">366</span></a><span class="sd">        Performance Notes:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-367"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-367"><span class="linenos">367</span></a><span class="sd">            - More computationally intensive than get_ephemeris_data()</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-368"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-368"><span class="linenos">368</span></a><span class="sd">            - Each subject performs full astrological calculations</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-369"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-369"><span class="linenos">369</span></a><span class="sd">            - Memory usage scales with the number of data points</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-370"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-370"><span class="linenos">370</span></a><span class="sd">            - Consider processing in batches for very large date ranges</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-371"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-371"><span class="linenos">371</span></a><span class="sd">            - Ideal for comprehensive analysis requiring full chart features</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-372"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-372"><span class="linenos">372</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-373"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-373"><span class="linenos">373</span></a><span class="sd">        See Also:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-374"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-374"><span class="linenos">374</span></a><span class="sd">            get_ephemeris_data(): For lightweight dictionary-based ephemeris data</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-375"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-375"><span class="linenos">375</span></a><span class="sd">            AstrologicalSubject: For details on available methods and properties</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-376"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-377"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-377"><span class="linenos">377</span></a>        <span class="n">subjects_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-378"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-378"><span class="linenos">378</span></a>        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_list</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-379"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-379"><span class="linenos">379</span></a>            <span class="n">subject</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-380"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-380"><span class="linenos">380</span></a>                <span class="n">year</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-381"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-381"><span class="linenos">381</span></a>                <span class="n">month</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-382"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-382"><span class="linenos">382</span></a>                <span class="n">day</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-383"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-383"><span class="linenos">383</span></a>                <span class="n">hour</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-384"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-384"><span class="linenos">384</span></a>                <span class="n">minute</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-385"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-385"><span class="linenos">385</span></a>                <span class="n">lng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-386"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-386"><span class="linenos">386</span></a>                <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-387"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-387"><span class="linenos">387</span></a>                <span class="n">tz_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-388"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-388"><span class="linenos">388</span></a>                <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-389"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-389"><span class="linenos">389</span></a>                <span class="n">nation</span><span class="o">=</span><span class="s2">&quot;Placeholder&quot;</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-390"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-390"><span class="linenos">390</span></a>                <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-391"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-391"><span class="linenos">391</span></a>                <span class="n">zodiac_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-392"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-392"><span class="linenos">392</span></a>                <span class="n">sidereal_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-393"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-393"><span class="linenos">393</span></a>                <span class="n">houses_system_identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">houses_system_identifier</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-394"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-394"><span class="linenos">394</span></a>                <span class="n">perspective_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-395"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-395"><span class="linenos">395</span></a>                <span class="n">is_dst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dst</span><span class="p">,</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-396"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-396"><span class="linenos">396</span></a>            <span class="p">)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-397"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-397"><span class="linenos">397</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-398"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-398"><span class="linenos">398</span></a>            <span class="k">if</span> <span class="n">as_model</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-399"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-399"><span class="linenos">399</span></a>                <span class="n">subjects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-400"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-400"><span class="linenos">400</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-401"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-401"><span class="linenos">401</span></a>                <span class="n">subjects_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-402"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-402"><span class="linenos">402</span></a>
</span><span id="EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-403"><a href="#EphemerisDataFactory.get_ephemeris_data_as_astrological_subjects-403"><span class="linenos">403</span></a>        <span class="k">return</span> <span class="n">subjects_list</span>
</span></pre></div>


            <div class="docstring"><p>Generate ephemeris data as complete AstrologicalSubject instances.</p>

<p>This method creates fully-featured AstrologicalSubject objects for each date in the
configured time series, providing access to all astrological calculation methods
and properties. Unlike the dictionary-based approach of get_ephemeris_data(),
this method returns objects with the complete Kerykeion API available.</p>

<p>Each AstrologicalSubject instance represents a complete astrological chart for
the specified moment, location, and calculation settings. This allows direct
access to methods like get_sun(), get_all_points(), draw_chart(), calculate
aspects, and all other astrological analysis features.</p>

<p>Args:
    as_model (bool, optional): If True, returns AstrologicalSubjectModel instances
        (Pydantic model versions) which provide serialization and validation features.
        If False, returns raw AstrologicalSubject instances with full method access.
        Defaults to False.</p>

<p>Returns:
    List[AstrologicalSubjectModel]: A list of AstrologicalSubject or
        AstrologicalSubjectModel instances (depending on as_model parameter).
        Each element represents one calculated moment in time with full
        astrological chart data and methods available.</p>

<pre><code>    Each subject contains:
    - All planetary and astrological point positions
    - Complete house system calculations
    - Chart drawing capabilities
    - Aspect calculation methods
    - Access to all Kerykeion astrological features
</code></pre>

<p>Examples:
    Basic usage for accessing individual chart features:</p>

<pre><code>&gt;&gt;&gt; factory = EphemerisDataFactory(start_date, end_date)
&gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()
&gt;&gt;&gt;
&gt;&gt;&gt; # Access specific planetary data
&gt;&gt;&gt; sun_data = subjects[0].get_sun()
&gt;&gt;&gt; moon_data = subjects[0].get_moon()
&gt;&gt;&gt;
&gt;&gt;&gt; # Get all astrological points
&gt;&gt;&gt; all_points = subjects[0].get_all_points()
&gt;&gt;&gt;
&gt;&gt;&gt; # Generate chart visualization
&gt;&gt;&gt; chart_svg = subjects[0].draw_chart()

Using model instances for serialization:

&gt;&gt;&gt; subjects_models = factory.get_ephemeris_data_as_astrological_subjects(as_model=True)
&gt;&gt;&gt; # Model instances can be easily serialized to JSON
&gt;&gt;&gt; json_data = subjects_models[0].model_dump_json()

Batch processing for analysis:

&gt;&gt;&gt; subjects = factory.get_ephemeris_data_as_astrological_subjects()
&gt;&gt;&gt; sun_positions = [subj.sun['abs_pos'] for subj in subjects if subj.sun]
&gt;&gt;&gt; # Analyze sun position changes over time
</code></pre>

<p>Use Cases:
    - Time-series astrological analysis
    - Planetary motion tracking
    - Aspect pattern analysis over time
    - Chart animation data generation
    - Astrological research and statistics
    - Progressive chart calculations</p>

<p>Performance Notes:
    - More computationally intensive than get_ephemeris_data()
    - Each subject performs full astrological calculations
    - Memory usage scales with the number of data points
    - Consider processing in batches for very large date ranges
    - Ideal for comprehensive analysis requiring full chart features</p>

<p>See Also:
    get_ephemeris_data(): For lightweight dictionary-based ephemeris data
    AstrologicalSubject: For details on available methods and properties</p>
</div>


                            </div>
                </section>
                <section id="HouseComparisonFactory">
                            <input id="HouseComparisonFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HouseComparisonFactory</span>:

                <label class="view-source-button" for="HouseComparisonFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HouseComparisonFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HouseComparisonFactory-22"><a href="#HouseComparisonFactory-22"><span class="linenos"> 22</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HouseComparisonFactory</span><span class="p">:</span>
</span><span id="HouseComparisonFactory-23"><a href="#HouseComparisonFactory-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory-24"><a href="#HouseComparisonFactory-24"><span class="linenos"> 24</span></a><span class="sd">    Factory for creating house comparison analyses between two astrological subjects.</span>
</span><span id="HouseComparisonFactory-25"><a href="#HouseComparisonFactory-25"><span class="linenos"> 25</span></a>
</span><span id="HouseComparisonFactory-26"><a href="#HouseComparisonFactory-26"><span class="linenos"> 26</span></a><span class="sd">    Analyzes placement of astrological points from one subject within the house system</span>
</span><span id="HouseComparisonFactory-27"><a href="#HouseComparisonFactory-27"><span class="linenos"> 27</span></a><span class="sd">    of another subject, performing bidirectional analysis for synastry studies and</span>
</span><span id="HouseComparisonFactory-28"><a href="#HouseComparisonFactory-28"><span class="linenos"> 28</span></a><span class="sd">    subject comparisons. Supports both natal subjects and planetary return subjects.</span>
</span><span id="HouseComparisonFactory-29"><a href="#HouseComparisonFactory-29"><span class="linenos"> 29</span></a>
</span><span id="HouseComparisonFactory-30"><a href="#HouseComparisonFactory-30"><span class="linenos"> 30</span></a><span class="sd">    Attributes:</span>
</span><span id="HouseComparisonFactory-31"><a href="#HouseComparisonFactory-31"><span class="linenos"> 31</span></a><span class="sd">        first_subject: First astrological subject (natal or return subject)</span>
</span><span id="HouseComparisonFactory-32"><a href="#HouseComparisonFactory-32"><span class="linenos"> 32</span></a><span class="sd">        second_subject: Second astrological subject (natal or return subject)</span>
</span><span id="HouseComparisonFactory-33"><a href="#HouseComparisonFactory-33"><span class="linenos"> 33</span></a><span class="sd">        active_points: List of astrological points to include in analysis</span>
</span><span id="HouseComparisonFactory-34"><a href="#HouseComparisonFactory-34"><span class="linenos"> 34</span></a>
</span><span id="HouseComparisonFactory-35"><a href="#HouseComparisonFactory-35"><span class="linenos"> 35</span></a><span class="sd">    Example:</span>
</span><span id="HouseComparisonFactory-36"><a href="#HouseComparisonFactory-36"><span class="linenos"> 36</span></a><span class="sd">        &gt;&gt;&gt; natal_chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="HouseComparisonFactory-37"><a href="#HouseComparisonFactory-37"><span class="linenos"> 37</span></a><span class="sd">        ...     &quot;Person A&quot;, 1990, 5, 15, 10, 30, &quot;Rome&quot;, &quot;IT&quot;</span>
</span><span id="HouseComparisonFactory-38"><a href="#HouseComparisonFactory-38"><span class="linenos"> 38</span></a><span class="sd">        ... )</span>
</span><span id="HouseComparisonFactory-39"><a href="#HouseComparisonFactory-39"><span class="linenos"> 39</span></a><span class="sd">        &gt;&gt;&gt; partner_chart = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="HouseComparisonFactory-40"><a href="#HouseComparisonFactory-40"><span class="linenos"> 40</span></a><span class="sd">        ...     &quot;Person B&quot;, 1992, 8, 23, 14, 45, &quot;Milan&quot;, &quot;IT&quot;</span>
</span><span id="HouseComparisonFactory-41"><a href="#HouseComparisonFactory-41"><span class="linenos"> 41</span></a><span class="sd">        ... )</span>
</span><span id="HouseComparisonFactory-42"><a href="#HouseComparisonFactory-42"><span class="linenos"> 42</span></a><span class="sd">        &gt;&gt;&gt; factory = HouseComparisonFactory(natal_chart, partner_chart)</span>
</span><span id="HouseComparisonFactory-43"><a href="#HouseComparisonFactory-43"><span class="linenos"> 43</span></a><span class="sd">        &gt;&gt;&gt; comparison = factory.get_house_comparison()</span>
</span><span id="HouseComparisonFactory-44"><a href="#HouseComparisonFactory-44"><span class="linenos"> 44</span></a>
</span><span id="HouseComparisonFactory-45"><a href="#HouseComparisonFactory-45"><span class="linenos"> 45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory-46"><a href="#HouseComparisonFactory-46"><span class="linenos"> 46</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-47"><a href="#HouseComparisonFactory-47"><span class="linenos"> 47</span></a>                 <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">],</span>
</span><span id="HouseComparisonFactory-48"><a href="#HouseComparisonFactory-48"><span class="linenos"> 48</span></a>                 <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">],</span>
</span><span id="HouseComparisonFactory-49"><a href="#HouseComparisonFactory-49"><span class="linenos"> 49</span></a>                <span class="n">active_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-50"><a href="#HouseComparisonFactory-50"><span class="linenos"> 50</span></a>
</span><span id="HouseComparisonFactory-51"><a href="#HouseComparisonFactory-51"><span class="linenos"> 51</span></a>        <span class="p">):</span>
</span><span id="HouseComparisonFactory-52"><a href="#HouseComparisonFactory-52"><span class="linenos"> 52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory-53"><a href="#HouseComparisonFactory-53"><span class="linenos"> 53</span></a><span class="sd">        Initialize the house comparison factory.</span>
</span><span id="HouseComparisonFactory-54"><a href="#HouseComparisonFactory-54"><span class="linenos"> 54</span></a>
</span><span id="HouseComparisonFactory-55"><a href="#HouseComparisonFactory-55"><span class="linenos"> 55</span></a><span class="sd">        Args:</span>
</span><span id="HouseComparisonFactory-56"><a href="#HouseComparisonFactory-56"><span class="linenos"> 56</span></a><span class="sd">            first_subject: First astrological subject for comparison</span>
</span><span id="HouseComparisonFactory-57"><a href="#HouseComparisonFactory-57"><span class="linenos"> 57</span></a><span class="sd">            second_subject: Second astrological subject for comparison</span>
</span><span id="HouseComparisonFactory-58"><a href="#HouseComparisonFactory-58"><span class="linenos"> 58</span></a><span class="sd">            active_points: List of astrological points to include in analysis.</span>
</span><span id="HouseComparisonFactory-59"><a href="#HouseComparisonFactory-59"><span class="linenos"> 59</span></a><span class="sd">                          Defaults to standard active points.</span>
</span><span id="HouseComparisonFactory-60"><a href="#HouseComparisonFactory-60"><span class="linenos"> 60</span></a>
</span><span id="HouseComparisonFactory-61"><a href="#HouseComparisonFactory-61"><span class="linenos"> 61</span></a><span class="sd">        Note:</span>
</span><span id="HouseComparisonFactory-62"><a href="#HouseComparisonFactory-62"><span class="linenos"> 62</span></a><span class="sd">            Both subjects must have valid house system data for accurate analysis.</span>
</span><span id="HouseComparisonFactory-63"><a href="#HouseComparisonFactory-63"><span class="linenos"> 63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory-64"><a href="#HouseComparisonFactory-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span> <span class="o">=</span> <span class="n">first_subject</span>
</span><span id="HouseComparisonFactory-65"><a href="#HouseComparisonFactory-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span> <span class="o">=</span> <span class="n">second_subject</span>
</span><span id="HouseComparisonFactory-66"><a href="#HouseComparisonFactory-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">active_points</span>
</span><span id="HouseComparisonFactory-67"><a href="#HouseComparisonFactory-67"><span class="linenos"> 67</span></a>
</span><span id="HouseComparisonFactory-68"><a href="#HouseComparisonFactory-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_house_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HouseComparisonModel&quot;</span><span class="p">:</span>
</span><span id="HouseComparisonFactory-69"><a href="#HouseComparisonFactory-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory-70"><a href="#HouseComparisonFactory-70"><span class="linenos"> 70</span></a><span class="sd">        Generate bidirectional house comparison analysis between the two subjects.</span>
</span><span id="HouseComparisonFactory-71"><a href="#HouseComparisonFactory-71"><span class="linenos"> 71</span></a>
</span><span id="HouseComparisonFactory-72"><a href="#HouseComparisonFactory-72"><span class="linenos"> 72</span></a><span class="sd">        Calculates where each active astrological point from one subject falls within</span>
</span><span id="HouseComparisonFactory-73"><a href="#HouseComparisonFactory-73"><span class="linenos"> 73</span></a><span class="sd">        the house system of the other subject, and vice versa.</span>
</span><span id="HouseComparisonFactory-74"><a href="#HouseComparisonFactory-74"><span class="linenos"> 74</span></a>
</span><span id="HouseComparisonFactory-75"><a href="#HouseComparisonFactory-75"><span class="linenos"> 75</span></a><span class="sd">        Returns:</span>
</span><span id="HouseComparisonFactory-76"><a href="#HouseComparisonFactory-76"><span class="linenos"> 76</span></a><span class="sd">            HouseComparisonModel: Model containing:</span>
</span><span id="HouseComparisonFactory-77"><a href="#HouseComparisonFactory-77"><span class="linenos"> 77</span></a><span class="sd">                - first_subject_name: Name of the first subject</span>
</span><span id="HouseComparisonFactory-78"><a href="#HouseComparisonFactory-78"><span class="linenos"> 78</span></a><span class="sd">                - second_subject_name: Name of the second subject</span>
</span><span id="HouseComparisonFactory-79"><a href="#HouseComparisonFactory-79"><span class="linenos"> 79</span></a><span class="sd">                - first_points_in_second_houses: First subject&#39;s points in second subject&#39;s houses</span>
</span><span id="HouseComparisonFactory-80"><a href="#HouseComparisonFactory-80"><span class="linenos"> 80</span></a><span class="sd">                - second_points_in_first_houses: Second subject&#39;s points in first subject&#39;s houses</span>
</span><span id="HouseComparisonFactory-81"><a href="#HouseComparisonFactory-81"><span class="linenos"> 81</span></a>
</span><span id="HouseComparisonFactory-82"><a href="#HouseComparisonFactory-82"><span class="linenos"> 82</span></a><span class="sd">        Note:</span>
</span><span id="HouseComparisonFactory-83"><a href="#HouseComparisonFactory-83"><span class="linenos"> 83</span></a><span class="sd">            Analysis scope is determined by the active_points list. Only specified</span>
</span><span id="HouseComparisonFactory-84"><a href="#HouseComparisonFactory-84"><span class="linenos"> 84</span></a><span class="sd">            points will be included in the results.</span>
</span><span id="HouseComparisonFactory-85"><a href="#HouseComparisonFactory-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory-86"><a href="#HouseComparisonFactory-86"><span class="linenos"> 86</span></a>        <span class="n">first_points_in_second_houses</span> <span class="o">=</span> <span class="n">calculate_points_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="HouseComparisonFactory-87"><a href="#HouseComparisonFactory-87"><span class="linenos"> 87</span></a>        <span class="n">second_points_in_first_houses</span> <span class="o">=</span> <span class="n">calculate_points_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="HouseComparisonFactory-88"><a href="#HouseComparisonFactory-88"><span class="linenos"> 88</span></a>
</span><span id="HouseComparisonFactory-89"><a href="#HouseComparisonFactory-89"><span class="linenos"> 89</span></a>        <span class="c1"># Calculate cusp placements in reciprocal houses</span>
</span><span id="HouseComparisonFactory-90"><a href="#HouseComparisonFactory-90"><span class="linenos"> 90</span></a>        <span class="n">first_cusps_in_second_houses</span> <span class="o">=</span> <span class="n">calculate_cusps_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">)</span>
</span><span id="HouseComparisonFactory-91"><a href="#HouseComparisonFactory-91"><span class="linenos"> 91</span></a>        <span class="n">second_cusps_in_first_houses</span> <span class="o">=</span> <span class="n">calculate_cusps_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">)</span>
</span><span id="HouseComparisonFactory-92"><a href="#HouseComparisonFactory-92"><span class="linenos"> 92</span></a>
</span><span id="HouseComparisonFactory-93"><a href="#HouseComparisonFactory-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="n">HouseComparisonModel</span><span class="p">(</span>
</span><span id="HouseComparisonFactory-94"><a href="#HouseComparisonFactory-94"><span class="linenos"> 94</span></a>            <span class="n">first_subject_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-95"><a href="#HouseComparisonFactory-95"><span class="linenos"> 95</span></a>            <span class="n">second_subject_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-96"><a href="#HouseComparisonFactory-96"><span class="linenos"> 96</span></a>            <span class="n">first_points_in_second_houses</span><span class="o">=</span><span class="n">first_points_in_second_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-97"><a href="#HouseComparisonFactory-97"><span class="linenos"> 97</span></a>            <span class="n">second_points_in_first_houses</span><span class="o">=</span><span class="n">second_points_in_first_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-98"><a href="#HouseComparisonFactory-98"><span class="linenos"> 98</span></a>            <span class="n">first_cusps_in_second_houses</span><span class="o">=</span><span class="n">first_cusps_in_second_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-99"><a href="#HouseComparisonFactory-99"><span class="linenos"> 99</span></a>            <span class="n">second_cusps_in_first_houses</span><span class="o">=</span><span class="n">second_cusps_in_first_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory-100"><a href="#HouseComparisonFactory-100"><span class="linenos">100</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Factory for creating house comparison analyses between two astrological subjects.</p>

<p>Analyzes placement of astrological points from one subject within the house system
of another subject, performing bidirectional analysis for synastry studies and
subject comparisons. Supports both natal subjects and planetary return subjects.</p>

<p>Attributes:
    first_subject: First astrological subject (natal or return subject)
    second_subject: Second astrological subject (natal or return subject)
    active_points: List of astrological points to include in analysis</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>natal_chart = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
          ...     "Person A", 1990, 5, 15, 10, 30, "Rome", "IT"
          ... )
      partner_chart = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
          ...     "Person B", 1992, 8, 23, 14, 45, "Milan", "IT"
          ... )
      factory = HouseComparisonFactory(natal_chart, partner_chart)
      comparison = factory.get_house_comparison()</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            <div id="HouseComparisonFactory.__init__" class="classattr">
                                        <input id="HouseComparisonFactory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HouseComparisonFactory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="HouseComparisonFactory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HouseComparisonFactory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HouseComparisonFactory.__init__-46"><a href="#HouseComparisonFactory.__init__-46"><span class="linenos">46</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.__init__-47"><a href="#HouseComparisonFactory.__init__-47"><span class="linenos">47</span></a>                 <span class="n">first_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">],</span>
</span><span id="HouseComparisonFactory.__init__-48"><a href="#HouseComparisonFactory.__init__-48"><span class="linenos">48</span></a>                 <span class="n">second_subject</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AstrologicalSubjectModel&quot;</span><span class="p">,</span> <span class="s2">&quot;PlanetReturnModel&quot;</span><span class="p">],</span>
</span><span id="HouseComparisonFactory.__init__-49"><a href="#HouseComparisonFactory.__init__-49"><span class="linenos">49</span></a>                <span class="n">active_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.__init__-50"><a href="#HouseComparisonFactory.__init__-50"><span class="linenos">50</span></a>
</span><span id="HouseComparisonFactory.__init__-51"><a href="#HouseComparisonFactory.__init__-51"><span class="linenos">51</span></a>        <span class="p">):</span>
</span><span id="HouseComparisonFactory.__init__-52"><a href="#HouseComparisonFactory.__init__-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory.__init__-53"><a href="#HouseComparisonFactory.__init__-53"><span class="linenos">53</span></a><span class="sd">        Initialize the house comparison factory.</span>
</span><span id="HouseComparisonFactory.__init__-54"><a href="#HouseComparisonFactory.__init__-54"><span class="linenos">54</span></a>
</span><span id="HouseComparisonFactory.__init__-55"><a href="#HouseComparisonFactory.__init__-55"><span class="linenos">55</span></a><span class="sd">        Args:</span>
</span><span id="HouseComparisonFactory.__init__-56"><a href="#HouseComparisonFactory.__init__-56"><span class="linenos">56</span></a><span class="sd">            first_subject: First astrological subject for comparison</span>
</span><span id="HouseComparisonFactory.__init__-57"><a href="#HouseComparisonFactory.__init__-57"><span class="linenos">57</span></a><span class="sd">            second_subject: Second astrological subject for comparison</span>
</span><span id="HouseComparisonFactory.__init__-58"><a href="#HouseComparisonFactory.__init__-58"><span class="linenos">58</span></a><span class="sd">            active_points: List of astrological points to include in analysis.</span>
</span><span id="HouseComparisonFactory.__init__-59"><a href="#HouseComparisonFactory.__init__-59"><span class="linenos">59</span></a><span class="sd">                          Defaults to standard active points.</span>
</span><span id="HouseComparisonFactory.__init__-60"><a href="#HouseComparisonFactory.__init__-60"><span class="linenos">60</span></a>
</span><span id="HouseComparisonFactory.__init__-61"><a href="#HouseComparisonFactory.__init__-61"><span class="linenos">61</span></a><span class="sd">        Note:</span>
</span><span id="HouseComparisonFactory.__init__-62"><a href="#HouseComparisonFactory.__init__-62"><span class="linenos">62</span></a><span class="sd">            Both subjects must have valid house system data for accurate analysis.</span>
</span><span id="HouseComparisonFactory.__init__-63"><a href="#HouseComparisonFactory.__init__-63"><span class="linenos">63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory.__init__-64"><a href="#HouseComparisonFactory.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span> <span class="o">=</span> <span class="n">first_subject</span>
</span><span id="HouseComparisonFactory.__init__-65"><a href="#HouseComparisonFactory.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span> <span class="o">=</span> <span class="n">second_subject</span>
</span><span id="HouseComparisonFactory.__init__-66"><a href="#HouseComparisonFactory.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">active_points</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the house comparison factory.</p>

<p>Args:
    first_subject: First astrological subject for comparison
    second_subject: Second astrological subject for comparison
    active_points: List of astrological points to include in analysis.
                  Defaults to standard active points.</p>

<p>Note:
    Both subjects must have valid house system data for accurate analysis.</p>
</div>


                            </div>
                            <div id="HouseComparisonFactory.first_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">first_subject</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonFactory.first_subject"></a>
    
    

                            </div>
                            <div id="HouseComparisonFactory.second_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">second_subject</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonFactory.second_subject"></a>
    
    

                            </div>
                            <div id="HouseComparisonFactory.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonFactory.active_points"></a>
    
    

                            </div>
                            <div id="HouseComparisonFactory.get_house_comparison" class="classattr">
                                        <input id="HouseComparisonFactory.get_house_comparison-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_house_comparison</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#HouseComparisonModel">HouseComparisonModel</a></span>:</span></span>

                <label class="view-source-button" for="HouseComparisonFactory.get_house_comparison-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HouseComparisonFactory.get_house_comparison"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HouseComparisonFactory.get_house_comparison-68"><a href="#HouseComparisonFactory.get_house_comparison-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_house_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HouseComparisonModel&quot;</span><span class="p">:</span>
</span><span id="HouseComparisonFactory.get_house_comparison-69"><a href="#HouseComparisonFactory.get_house_comparison-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory.get_house_comparison-70"><a href="#HouseComparisonFactory.get_house_comparison-70"><span class="linenos"> 70</span></a><span class="sd">        Generate bidirectional house comparison analysis between the two subjects.</span>
</span><span id="HouseComparisonFactory.get_house_comparison-71"><a href="#HouseComparisonFactory.get_house_comparison-71"><span class="linenos"> 71</span></a>
</span><span id="HouseComparisonFactory.get_house_comparison-72"><a href="#HouseComparisonFactory.get_house_comparison-72"><span class="linenos"> 72</span></a><span class="sd">        Calculates where each active astrological point from one subject falls within</span>
</span><span id="HouseComparisonFactory.get_house_comparison-73"><a href="#HouseComparisonFactory.get_house_comparison-73"><span class="linenos"> 73</span></a><span class="sd">        the house system of the other subject, and vice versa.</span>
</span><span id="HouseComparisonFactory.get_house_comparison-74"><a href="#HouseComparisonFactory.get_house_comparison-74"><span class="linenos"> 74</span></a>
</span><span id="HouseComparisonFactory.get_house_comparison-75"><a href="#HouseComparisonFactory.get_house_comparison-75"><span class="linenos"> 75</span></a><span class="sd">        Returns:</span>
</span><span id="HouseComparisonFactory.get_house_comparison-76"><a href="#HouseComparisonFactory.get_house_comparison-76"><span class="linenos"> 76</span></a><span class="sd">            HouseComparisonModel: Model containing:</span>
</span><span id="HouseComparisonFactory.get_house_comparison-77"><a href="#HouseComparisonFactory.get_house_comparison-77"><span class="linenos"> 77</span></a><span class="sd">                - first_subject_name: Name of the first subject</span>
</span><span id="HouseComparisonFactory.get_house_comparison-78"><a href="#HouseComparisonFactory.get_house_comparison-78"><span class="linenos"> 78</span></a><span class="sd">                - second_subject_name: Name of the second subject</span>
</span><span id="HouseComparisonFactory.get_house_comparison-79"><a href="#HouseComparisonFactory.get_house_comparison-79"><span class="linenos"> 79</span></a><span class="sd">                - first_points_in_second_houses: First subject&#39;s points in second subject&#39;s houses</span>
</span><span id="HouseComparisonFactory.get_house_comparison-80"><a href="#HouseComparisonFactory.get_house_comparison-80"><span class="linenos"> 80</span></a><span class="sd">                - second_points_in_first_houses: Second subject&#39;s points in first subject&#39;s houses</span>
</span><span id="HouseComparisonFactory.get_house_comparison-81"><a href="#HouseComparisonFactory.get_house_comparison-81"><span class="linenos"> 81</span></a>
</span><span id="HouseComparisonFactory.get_house_comparison-82"><a href="#HouseComparisonFactory.get_house_comparison-82"><span class="linenos"> 82</span></a><span class="sd">        Note:</span>
</span><span id="HouseComparisonFactory.get_house_comparison-83"><a href="#HouseComparisonFactory.get_house_comparison-83"><span class="linenos"> 83</span></a><span class="sd">            Analysis scope is determined by the active_points list. Only specified</span>
</span><span id="HouseComparisonFactory.get_house_comparison-84"><a href="#HouseComparisonFactory.get_house_comparison-84"><span class="linenos"> 84</span></a><span class="sd">            points will be included in the results.</span>
</span><span id="HouseComparisonFactory.get_house_comparison-85"><a href="#HouseComparisonFactory.get_house_comparison-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HouseComparisonFactory.get_house_comparison-86"><a href="#HouseComparisonFactory.get_house_comparison-86"><span class="linenos"> 86</span></a>        <span class="n">first_points_in_second_houses</span> <span class="o">=</span> <span class="n">calculate_points_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="HouseComparisonFactory.get_house_comparison-87"><a href="#HouseComparisonFactory.get_house_comparison-87"><span class="linenos"> 87</span></a>        <span class="n">second_points_in_first_houses</span> <span class="o">=</span> <span class="n">calculate_points_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="HouseComparisonFactory.get_house_comparison-88"><a href="#HouseComparisonFactory.get_house_comparison-88"><span class="linenos"> 88</span></a>
</span><span id="HouseComparisonFactory.get_house_comparison-89"><a href="#HouseComparisonFactory.get_house_comparison-89"><span class="linenos"> 89</span></a>        <span class="c1"># Calculate cusp placements in reciprocal houses</span>
</span><span id="HouseComparisonFactory.get_house_comparison-90"><a href="#HouseComparisonFactory.get_house_comparison-90"><span class="linenos"> 90</span></a>        <span class="n">first_cusps_in_second_houses</span> <span class="o">=</span> <span class="n">calculate_cusps_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">)</span>
</span><span id="HouseComparisonFactory.get_house_comparison-91"><a href="#HouseComparisonFactory.get_house_comparison-91"><span class="linenos"> 91</span></a>        <span class="n">second_cusps_in_first_houses</span> <span class="o">=</span> <span class="n">calculate_cusps_in_reciprocal_houses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">)</span>
</span><span id="HouseComparisonFactory.get_house_comparison-92"><a href="#HouseComparisonFactory.get_house_comparison-92"><span class="linenos"> 92</span></a>
</span><span id="HouseComparisonFactory.get_house_comparison-93"><a href="#HouseComparisonFactory.get_house_comparison-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="n">HouseComparisonModel</span><span class="p">(</span>
</span><span id="HouseComparisonFactory.get_house_comparison-94"><a href="#HouseComparisonFactory.get_house_comparison-94"><span class="linenos"> 94</span></a>            <span class="n">first_subject_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.get_house_comparison-95"><a href="#HouseComparisonFactory.get_house_comparison-95"><span class="linenos"> 95</span></a>            <span class="n">second_subject_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.get_house_comparison-96"><a href="#HouseComparisonFactory.get_house_comparison-96"><span class="linenos"> 96</span></a>            <span class="n">first_points_in_second_houses</span><span class="o">=</span><span class="n">first_points_in_second_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.get_house_comparison-97"><a href="#HouseComparisonFactory.get_house_comparison-97"><span class="linenos"> 97</span></a>            <span class="n">second_points_in_first_houses</span><span class="o">=</span><span class="n">second_points_in_first_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.get_house_comparison-98"><a href="#HouseComparisonFactory.get_house_comparison-98"><span class="linenos"> 98</span></a>            <span class="n">first_cusps_in_second_houses</span><span class="o">=</span><span class="n">first_cusps_in_second_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.get_house_comparison-99"><a href="#HouseComparisonFactory.get_house_comparison-99"><span class="linenos"> 99</span></a>            <span class="n">second_cusps_in_first_houses</span><span class="o">=</span><span class="n">second_cusps_in_first_houses</span><span class="p">,</span>
</span><span id="HouseComparisonFactory.get_house_comparison-100"><a href="#HouseComparisonFactory.get_house_comparison-100"><span class="linenos">100</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate bidirectional house comparison analysis between the two subjects.</p>

<p>Calculates where each active astrological point from one subject falls within
the house system of the other subject, and vice versa.</p>

<p>Returns:
    HouseComparisonModel: Model containing:
        - first_subject_name: Name of the first subject
        - second_subject_name: Name of the second subject
        - first_points_in_second_houses: First subject's points in second subject's houses
        - second_points_in_first_houses: Second subject's points in first subject's houses</p>

<p>Note:
    Analysis scope is determined by the active_points list. Only specified
    points will be included in the results.</p>
</div>


                            </div>
                </section>
                <section id="HouseComparisonModel">
                            <input id="HouseComparisonModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HouseComparisonModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.SubscriptableBaseModel</span>):

                <label class="view-source-button" for="HouseComparisonModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HouseComparisonModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HouseComparisonModel-453"><a href="#HouseComparisonModel-453"><span class="linenos">453</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HouseComparisonModel</span><span class="p">(</span><span class="n">SubscriptableBaseModel</span><span class="p">):</span>
</span><span id="HouseComparisonModel-454"><a href="#HouseComparisonModel-454"><span class="linenos">454</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-455"><a href="#HouseComparisonModel-455"><span class="linenos">455</span></a><span class="sd">    Bidirectional house comparison analysis between two astrological subjects.</span>
</span><span id="HouseComparisonModel-456"><a href="#HouseComparisonModel-456"><span class="linenos">456</span></a>
</span><span id="HouseComparisonModel-457"><a href="#HouseComparisonModel-457"><span class="linenos">457</span></a><span class="sd">    Contains results of how astrological points from each subject interact with</span>
</span><span id="HouseComparisonModel-458"><a href="#HouseComparisonModel-458"><span class="linenos">458</span></a><span class="sd">    the house system of the other subject.</span>
</span><span id="HouseComparisonModel-459"><a href="#HouseComparisonModel-459"><span class="linenos">459</span></a>
</span><span id="HouseComparisonModel-460"><a href="#HouseComparisonModel-460"><span class="linenos">460</span></a><span class="sd">    Attributes:</span>
</span><span id="HouseComparisonModel-461"><a href="#HouseComparisonModel-461"><span class="linenos">461</span></a><span class="sd">        first_subject_name: Name of the first subject</span>
</span><span id="HouseComparisonModel-462"><a href="#HouseComparisonModel-462"><span class="linenos">462</span></a><span class="sd">        second_subject_name: Name of the second subject</span>
</span><span id="HouseComparisonModel-463"><a href="#HouseComparisonModel-463"><span class="linenos">463</span></a><span class="sd">        first_points_in_second_houses: First subject&#39;s points in second subject&#39;s houses</span>
</span><span id="HouseComparisonModel-464"><a href="#HouseComparisonModel-464"><span class="linenos">464</span></a><span class="sd">        second_points_in_first_houses: Second subject&#39;s points in first subject&#39;s houses</span>
</span><span id="HouseComparisonModel-465"><a href="#HouseComparisonModel-465"><span class="linenos">465</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-466"><a href="#HouseComparisonModel-466"><span class="linenos">466</span></a>
</span><span id="HouseComparisonModel-467"><a href="#HouseComparisonModel-467"><span class="linenos">467</span></a>    <span class="n">first_subject_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="HouseComparisonModel-468"><a href="#HouseComparisonModel-468"><span class="linenos">468</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the first subject&quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-469"><a href="#HouseComparisonModel-469"><span class="linenos">469</span></a>    <span class="n">second_subject_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="HouseComparisonModel-470"><a href="#HouseComparisonModel-470"><span class="linenos">470</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Name of the second subject&quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-471"><a href="#HouseComparisonModel-471"><span class="linenos">471</span></a>    <span class="n">first_points_in_second_houses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PointInHouseModel</span><span class="p">]</span>
</span><span id="HouseComparisonModel-472"><a href="#HouseComparisonModel-472"><span class="linenos">472</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;First subject&#39;s points positioned in second subject&#39;s houses&quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-473"><a href="#HouseComparisonModel-473"><span class="linenos">473</span></a>    <span class="n">second_points_in_first_houses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PointInHouseModel</span><span class="p">]</span>
</span><span id="HouseComparisonModel-474"><a href="#HouseComparisonModel-474"><span class="linenos">474</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Second subject&#39;s points positioned in first subject&#39;s houses&quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-475"><a href="#HouseComparisonModel-475"><span class="linenos">475</span></a>    <span class="n">first_cusps_in_second_houses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PointInHouseModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span id="HouseComparisonModel-476"><a href="#HouseComparisonModel-476"><span class="linenos">476</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;First subject&#39;s house cusps positioned in second subject&#39;s houses&quot;&quot;&quot;</span>
</span><span id="HouseComparisonModel-477"><a href="#HouseComparisonModel-477"><span class="linenos">477</span></a>    <span class="n">second_cusps_in_first_houses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PointInHouseModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span id="HouseComparisonModel-478"><a href="#HouseComparisonModel-478"><span class="linenos">478</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Second subject&#39;s house cusps positioned in first subject&#39;s houses&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Bidirectional house comparison analysis between two astrological subjects.</p>

<p>Contains results of how astrological points from each subject interact with
the house system of the other subject.</p>

<p>Attributes:
    first_subject_name: Name of the first subject
    second_subject_name: Name of the second subject
    first_points_in_second_houses: First subject's points in second subject's houses
    second_points_in_first_houses: Second subject's points in first subject's houses</p>
</div>


                            <div id="HouseComparisonModel.first_subject_name" class="classattr">
                                <div class="attr variable">
            <span class="name">first_subject_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.first_subject_name"></a>
    
            <div class="docstring"><p>Name of the first subject</p>
</div>


                            </div>
                            <div id="HouseComparisonModel.second_subject_name" class="classattr">
                                <div class="attr variable">
            <span class="name">second_subject_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.second_subject_name"></a>
    
            <div class="docstring"><p>Name of the second subject</p>
</div>


                            </div>
                            <div id="HouseComparisonModel.first_points_in_second_houses" class="classattr">
                                <div class="attr variable">
            <span class="name">first_points_in_second_houses</span><span class="annotation">: List[kerykeion.schemas.kr_models.PointInHouseModel]</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.first_points_in_second_houses"></a>
    
            <div class="docstring"><p>First subject's points positioned in second subject's houses</p>
</div>


                            </div>
                            <div id="HouseComparisonModel.second_points_in_first_houses" class="classattr">
                                <div class="attr variable">
            <span class="name">second_points_in_first_houses</span><span class="annotation">: List[kerykeion.schemas.kr_models.PointInHouseModel]</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.second_points_in_first_houses"></a>
    
            <div class="docstring"><p>Second subject's points positioned in first subject's houses</p>
</div>


                            </div>
                            <div id="HouseComparisonModel.first_cusps_in_second_houses" class="classattr">
                                <div class="attr variable">
            <span class="name">first_cusps_in_second_houses</span><span class="annotation">: List[kerykeion.schemas.kr_models.PointInHouseModel]</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.first_cusps_in_second_houses"></a>
    
            <div class="docstring"><p>First subject's house cusps positioned in second subject's houses</p>
</div>


                            </div>
                            <div id="HouseComparisonModel.second_cusps_in_first_houses" class="classattr">
                                <div class="attr variable">
            <span class="name">second_cusps_in_first_houses</span><span class="annotation">: List[kerykeion.schemas.kr_models.PointInHouseModel]</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.second_cusps_in_first_houses"></a>
    
            <div class="docstring"><p>Second subject's house cusps positioned in first subject's houses</p>
</div>


                            </div>
                            <div id="HouseComparisonModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#HouseComparisonModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="KerykeionException">
                            <input id="KerykeionException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KerykeionException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="KerykeionException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionException-8"><a href="#KerykeionException-8"><span class="linenos"> 8</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KerykeionException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="KerykeionException-9"><a href="#KerykeionException-9"><span class="linenos"> 9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="KerykeionException-10"><a href="#KerykeionException-10"><span class="linenos">10</span></a><span class="sd">    Custom Kerykeion Exception</span>
</span><span id="KerykeionException-11"><a href="#KerykeionException-11"><span class="linenos">11</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="KerykeionException-12"><a href="#KerykeionException-12"><span class="linenos">12</span></a>
</span><span id="KerykeionException-13"><a href="#KerykeionException-13"><span class="linenos">13</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="KerykeionException-14"><a href="#KerykeionException-14"><span class="linenos">14</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="KerykeionException-15"><a href="#KerykeionException-15"><span class="linenos">15</span></a><span class="sd">        Initialize a new KerykeionException.</span>
</span><span id="KerykeionException-16"><a href="#KerykeionException-16"><span class="linenos">16</span></a>
</span><span id="KerykeionException-17"><a href="#KerykeionException-17"><span class="linenos">17</span></a><span class="sd">        Args:</span>
</span><span id="KerykeionException-18"><a href="#KerykeionException-18"><span class="linenos">18</span></a><span class="sd">            message: The error message to be displayed.</span>
</span><span id="KerykeionException-19"><a href="#KerykeionException-19"><span class="linenos">19</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KerykeionException-20"><a href="#KerykeionException-20"><span class="linenos">20</span></a>        <span class="c1"># Call the base class constructor with the parameters it needs</span>
</span><span id="KerykeionException-21"><a href="#KerykeionException-21"><span class="linenos">21</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Custom Kerykeion Exception</p>
</div>


                            <div id="KerykeionException.__init__" class="classattr">
                                        <input id="KerykeionException.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KerykeionException</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">message</span></span>)</span>

                <label class="view-source-button" for="KerykeionException.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionException.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionException.__init__-13"><a href="#KerykeionException.__init__-13"><span class="linenos">13</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="KerykeionException.__init__-14"><a href="#KerykeionException.__init__-14"><span class="linenos">14</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="KerykeionException.__init__-15"><a href="#KerykeionException.__init__-15"><span class="linenos">15</span></a><span class="sd">        Initialize a new KerykeionException.</span>
</span><span id="KerykeionException.__init__-16"><a href="#KerykeionException.__init__-16"><span class="linenos">16</span></a>
</span><span id="KerykeionException.__init__-17"><a href="#KerykeionException.__init__-17"><span class="linenos">17</span></a><span class="sd">        Args:</span>
</span><span id="KerykeionException.__init__-18"><a href="#KerykeionException.__init__-18"><span class="linenos">18</span></a><span class="sd">            message: The error message to be displayed.</span>
</span><span id="KerykeionException.__init__-19"><a href="#KerykeionException.__init__-19"><span class="linenos">19</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="KerykeionException.__init__-20"><a href="#KerykeionException.__init__-20"><span class="linenos">20</span></a>        <span class="c1"># Call the base class constructor with the parameters it needs</span>
</span><span id="KerykeionException.__init__-21"><a href="#KerykeionException.__init__-21"><span class="linenos">21</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new KerykeionException.</p>

<p>Args:
    message: The error message to be displayed.</p>
</div>


                            </div>
                </section>
                <section id="PlanetaryReturnFactory">
                            <input id="PlanetaryReturnFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PlanetaryReturnFactory</span>:

                <label class="view-source-button" for="PlanetaryReturnFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetaryReturnFactory-91"><a href="#PlanetaryReturnFactory-91"><span class="linenos"> 91</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PlanetaryReturnFactory</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-92"><a href="#PlanetaryReturnFactory-92"><span class="linenos"> 92</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-93"><a href="#PlanetaryReturnFactory-93"><span class="linenos"> 93</span></a><span class="sd">    A factory class for calculating and generating planetary return charts.</span>
</span><span id="PlanetaryReturnFactory-94"><a href="#PlanetaryReturnFactory-94"><span class="linenos"> 94</span></a>
</span><span id="PlanetaryReturnFactory-95"><a href="#PlanetaryReturnFactory-95"><span class="linenos"> 95</span></a><span class="sd">    This class specializes in computing precise planetary return moments using the Swiss</span>
</span><span id="PlanetaryReturnFactory-96"><a href="#PlanetaryReturnFactory-96"><span class="linenos"> 96</span></a><span class="sd">    Ephemeris library and creating complete astrological charts for those calculated times.</span>
</span><span id="PlanetaryReturnFactory-97"><a href="#PlanetaryReturnFactory-97"><span class="linenos"> 97</span></a><span class="sd">    It supports both Solar Returns (annual) and Lunar Returns (monthly), providing</span>
</span><span id="PlanetaryReturnFactory-98"><a href="#PlanetaryReturnFactory-98"><span class="linenos"> 98</span></a><span class="sd">    comprehensive astrological analysis capabilities for timing and forecasting applications.</span>
</span><span id="PlanetaryReturnFactory-99"><a href="#PlanetaryReturnFactory-99"><span class="linenos"> 99</span></a>
</span><span id="PlanetaryReturnFactory-100"><a href="#PlanetaryReturnFactory-100"><span class="linenos">100</span></a><span class="sd">    Planetary returns are fundamental concepts in predictive astrology:</span>
</span><span id="PlanetaryReturnFactory-101"><a href="#PlanetaryReturnFactory-101"><span class="linenos">101</span></a><span class="sd">    - Solar Returns: Occur when the Sun returns to its exact natal position (~365.25 days)</span>
</span><span id="PlanetaryReturnFactory-102"><a href="#PlanetaryReturnFactory-102"><span class="linenos">102</span></a><span class="sd">    - Lunar Returns: Occur when the Moon returns to its exact natal position (~27-29 days)</span>
</span><span id="PlanetaryReturnFactory-103"><a href="#PlanetaryReturnFactory-103"><span class="linenos">103</span></a>
</span><span id="PlanetaryReturnFactory-104"><a href="#PlanetaryReturnFactory-104"><span class="linenos">104</span></a><span class="sd">    The factory handles complex astronomical calculations automatically, including:</span>
</span><span id="PlanetaryReturnFactory-105"><a href="#PlanetaryReturnFactory-105"><span class="linenos">105</span></a><span class="sd">    - Precise celestial mechanics computations</span>
</span><span id="PlanetaryReturnFactory-106"><a href="#PlanetaryReturnFactory-106"><span class="linenos">106</span></a><span class="sd">    - Timezone conversions and UTC coordination</span>
</span><span id="PlanetaryReturnFactory-107"><a href="#PlanetaryReturnFactory-107"><span class="linenos">107</span></a><span class="sd">    - Location-based calculations for return chart casting</span>
</span><span id="PlanetaryReturnFactory-108"><a href="#PlanetaryReturnFactory-108"><span class="linenos">108</span></a><span class="sd">    - Integration with online geocoding services</span>
</span><span id="PlanetaryReturnFactory-109"><a href="#PlanetaryReturnFactory-109"><span class="linenos">109</span></a><span class="sd">    - Complete chart generation with all astrological points</span>
</span><span id="PlanetaryReturnFactory-110"><a href="#PlanetaryReturnFactory-110"><span class="linenos">110</span></a>
</span><span id="PlanetaryReturnFactory-111"><a href="#PlanetaryReturnFactory-111"><span class="linenos">111</span></a><span class="sd">    Args:</span>
</span><span id="PlanetaryReturnFactory-112"><a href="#PlanetaryReturnFactory-112"><span class="linenos">112</span></a><span class="sd">        subject (AstrologicalSubjectModel): The natal astrological subject for whom</span>
</span><span id="PlanetaryReturnFactory-113"><a href="#PlanetaryReturnFactory-113"><span class="linenos">113</span></a><span class="sd">            returns are calculated. Must contain complete birth data including</span>
</span><span id="PlanetaryReturnFactory-114"><a href="#PlanetaryReturnFactory-114"><span class="linenos">114</span></a><span class="sd">            planetary positions at birth.</span>
</span><span id="PlanetaryReturnFactory-115"><a href="#PlanetaryReturnFactory-115"><span class="linenos">115</span></a><span class="sd">        city (Optional[str]): City name for return chart location. Required when</span>
</span><span id="PlanetaryReturnFactory-116"><a href="#PlanetaryReturnFactory-116"><span class="linenos">116</span></a><span class="sd">            using online mode for location data retrieval.</span>
</span><span id="PlanetaryReturnFactory-117"><a href="#PlanetaryReturnFactory-117"><span class="linenos">117</span></a><span class="sd">        nation (Optional[str]): Nation/country code for return chart location.</span>
</span><span id="PlanetaryReturnFactory-118"><a href="#PlanetaryReturnFactory-118"><span class="linenos">118</span></a><span class="sd">            Required when using online mode (e.g., &quot;US&quot;, &quot;GB&quot;, &quot;FR&quot;).</span>
</span><span id="PlanetaryReturnFactory-119"><a href="#PlanetaryReturnFactory-119"><span class="linenos">119</span></a><span class="sd">        lng (Optional[Union[int, float]]): Geographic longitude in decimal degrees</span>
</span><span id="PlanetaryReturnFactory-120"><a href="#PlanetaryReturnFactory-120"><span class="linenos">120</span></a><span class="sd">            for return chart location. Positive values for East, negative for West.</span>
</span><span id="PlanetaryReturnFactory-121"><a href="#PlanetaryReturnFactory-121"><span class="linenos">121</span></a><span class="sd">            Required when using offline mode.</span>
</span><span id="PlanetaryReturnFactory-122"><a href="#PlanetaryReturnFactory-122"><span class="linenos">122</span></a><span class="sd">        lat (Optional[Union[int, float]]): Geographic latitude in decimal degrees</span>
</span><span id="PlanetaryReturnFactory-123"><a href="#PlanetaryReturnFactory-123"><span class="linenos">123</span></a><span class="sd">            for return chart location. Positive values for North, negative for South.</span>
</span><span id="PlanetaryReturnFactory-124"><a href="#PlanetaryReturnFactory-124"><span class="linenos">124</span></a><span class="sd">            Required when using offline mode.</span>
</span><span id="PlanetaryReturnFactory-125"><a href="#PlanetaryReturnFactory-125"><span class="linenos">125</span></a><span class="sd">        tz_str (Optional[str]): Timezone identifier for return chart location</span>
</span><span id="PlanetaryReturnFactory-126"><a href="#PlanetaryReturnFactory-126"><span class="linenos">126</span></a><span class="sd">            (e.g., &quot;America/New_York&quot;, &quot;Europe/London&quot;, &quot;Asia/Tokyo&quot;).</span>
</span><span id="PlanetaryReturnFactory-127"><a href="#PlanetaryReturnFactory-127"><span class="linenos">127</span></a><span class="sd">            Required when using offline mode.</span>
</span><span id="PlanetaryReturnFactory-128"><a href="#PlanetaryReturnFactory-128"><span class="linenos">128</span></a><span class="sd">        online (bool, optional): Whether to fetch location data online via Geonames</span>
</span><span id="PlanetaryReturnFactory-129"><a href="#PlanetaryReturnFactory-129"><span class="linenos">129</span></a><span class="sd">            service. When True, requires city, nation, and geonames_username.</span>
</span><span id="PlanetaryReturnFactory-130"><a href="#PlanetaryReturnFactory-130"><span class="linenos">130</span></a><span class="sd">            When False, requires lng, lat, and tz_str. Defaults to True.</span>
</span><span id="PlanetaryReturnFactory-131"><a href="#PlanetaryReturnFactory-131"><span class="linenos">131</span></a><span class="sd">        geonames_username (Optional[str]): Username for Geonames API access.</span>
</span><span id="PlanetaryReturnFactory-132"><a href="#PlanetaryReturnFactory-132"><span class="linenos">132</span></a><span class="sd">            Required when online=True and coordinates are not provided.</span>
</span><span id="PlanetaryReturnFactory-133"><a href="#PlanetaryReturnFactory-133"><span class="linenos">133</span></a><span class="sd">            Register at http://www.geonames.org/login for free account.</span>
</span><span id="PlanetaryReturnFactory-134"><a href="#PlanetaryReturnFactory-134"><span class="linenos">134</span></a><span class="sd">        cache_expire_after_days (int, optional): Number of days to cache Geonames</span>
</span><span id="PlanetaryReturnFactory-135"><a href="#PlanetaryReturnFactory-135"><span class="linenos">135</span></a><span class="sd">            location data before refreshing. Defaults to system setting.</span>
</span><span id="PlanetaryReturnFactory-136"><a href="#PlanetaryReturnFactory-136"><span class="linenos">136</span></a><span class="sd">        altitude (Optional[Union[float, int]]): Elevation above sea level in meters</span>
</span><span id="PlanetaryReturnFactory-137"><a href="#PlanetaryReturnFactory-137"><span class="linenos">137</span></a><span class="sd">            for the return chart location. Reserved for future astronomical</span>
</span><span id="PlanetaryReturnFactory-138"><a href="#PlanetaryReturnFactory-138"><span class="linenos">138</span></a><span class="sd">            calculations. Defaults to None.</span>
</span><span id="PlanetaryReturnFactory-139"><a href="#PlanetaryReturnFactory-139"><span class="linenos">139</span></a>
</span><span id="PlanetaryReturnFactory-140"><a href="#PlanetaryReturnFactory-140"><span class="linenos">140</span></a><span class="sd">    Raises:</span>
</span><span id="PlanetaryReturnFactory-141"><a href="#PlanetaryReturnFactory-141"><span class="linenos">141</span></a><span class="sd">        KerykeionException: If required location parameters are missing for the</span>
</span><span id="PlanetaryReturnFactory-142"><a href="#PlanetaryReturnFactory-142"><span class="linenos">142</span></a><span class="sd">            chosen mode (online/offline).</span>
</span><span id="PlanetaryReturnFactory-143"><a href="#PlanetaryReturnFactory-143"><span class="linenos">143</span></a><span class="sd">        KerykeionException: If Geonames API fails to retrieve location data.</span>
</span><span id="PlanetaryReturnFactory-144"><a href="#PlanetaryReturnFactory-144"><span class="linenos">144</span></a><span class="sd">        KerykeionException: If online mode is used without proper API credentials.</span>
</span><span id="PlanetaryReturnFactory-145"><a href="#PlanetaryReturnFactory-145"><span class="linenos">145</span></a>
</span><span id="PlanetaryReturnFactory-146"><a href="#PlanetaryReturnFactory-146"><span class="linenos">146</span></a><span class="sd">    Attributes:</span>
</span><span id="PlanetaryReturnFactory-147"><a href="#PlanetaryReturnFactory-147"><span class="linenos">147</span></a><span class="sd">        subject (AstrologicalSubjectModel): The natal subject for calculations.</span>
</span><span id="PlanetaryReturnFactory-148"><a href="#PlanetaryReturnFactory-148"><span class="linenos">148</span></a><span class="sd">        city (Optional[str]): Return chart city name.</span>
</span><span id="PlanetaryReturnFactory-149"><a href="#PlanetaryReturnFactory-149"><span class="linenos">149</span></a><span class="sd">        nation (Optional[str]): Return chart nation code.</span>
</span><span id="PlanetaryReturnFactory-150"><a href="#PlanetaryReturnFactory-150"><span class="linenos">150</span></a><span class="sd">        lng (float): Return chart longitude coordinate.</span>
</span><span id="PlanetaryReturnFactory-151"><a href="#PlanetaryReturnFactory-151"><span class="linenos">151</span></a><span class="sd">        lat (float): Return chart latitude coordinate.</span>
</span><span id="PlanetaryReturnFactory-152"><a href="#PlanetaryReturnFactory-152"><span class="linenos">152</span></a><span class="sd">        tz_str (str): Return chart timezone identifier.</span>
</span><span id="PlanetaryReturnFactory-153"><a href="#PlanetaryReturnFactory-153"><span class="linenos">153</span></a><span class="sd">        online (bool): Location data retrieval mode.</span>
</span><span id="PlanetaryReturnFactory-154"><a href="#PlanetaryReturnFactory-154"><span class="linenos">154</span></a><span class="sd">        city_data (Optional[dict]): Cached location data from Geonames.</span>
</span><span id="PlanetaryReturnFactory-155"><a href="#PlanetaryReturnFactory-155"><span class="linenos">155</span></a>
</span><span id="PlanetaryReturnFactory-156"><a href="#PlanetaryReturnFactory-156"><span class="linenos">156</span></a><span class="sd">    Examples:</span>
</span><span id="PlanetaryReturnFactory-157"><a href="#PlanetaryReturnFactory-157"><span class="linenos">157</span></a><span class="sd">        Online mode with automatic location lookup:</span>
</span><span id="PlanetaryReturnFactory-158"><a href="#PlanetaryReturnFactory-158"><span class="linenos">158</span></a>
</span><span id="PlanetaryReturnFactory-159"><a href="#PlanetaryReturnFactory-159"><span class="linenos">159</span></a><span class="sd">        &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_birth_data(</span>
</span><span id="PlanetaryReturnFactory-160"><a href="#PlanetaryReturnFactory-160"><span class="linenos">160</span></a><span class="sd">        ...     name=&quot;Alice&quot;, year=1985, month=3, day=21,</span>
</span><span id="PlanetaryReturnFactory-161"><a href="#PlanetaryReturnFactory-161"><span class="linenos">161</span></a><span class="sd">        ...     hour=14, minute=30, lat=51.5074, lng=-0.1278,</span>
</span><span id="PlanetaryReturnFactory-162"><a href="#PlanetaryReturnFactory-162"><span class="linenos">162</span></a><span class="sd">        ...     tz_str=&quot;Europe/London&quot;</span>
</span><span id="PlanetaryReturnFactory-163"><a href="#PlanetaryReturnFactory-163"><span class="linenos">163</span></a><span class="sd">        ... )</span>
</span><span id="PlanetaryReturnFactory-164"><a href="#PlanetaryReturnFactory-164"><span class="linenos">164</span></a><span class="sd">        &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory-165"><a href="#PlanetaryReturnFactory-165"><span class="linenos">165</span></a><span class="sd">        ...     subject,</span>
</span><span id="PlanetaryReturnFactory-166"><a href="#PlanetaryReturnFactory-166"><span class="linenos">166</span></a><span class="sd">        ...     city=&quot;London&quot;,</span>
</span><span id="PlanetaryReturnFactory-167"><a href="#PlanetaryReturnFactory-167"><span class="linenos">167</span></a><span class="sd">        ...     nation=&quot;GB&quot;,</span>
</span><span id="PlanetaryReturnFactory-168"><a href="#PlanetaryReturnFactory-168"><span class="linenos">168</span></a><span class="sd">        ...     online=True,</span>
</span><span id="PlanetaryReturnFactory-169"><a href="#PlanetaryReturnFactory-169"><span class="linenos">169</span></a><span class="sd">        ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="PlanetaryReturnFactory-170"><a href="#PlanetaryReturnFactory-170"><span class="linenos">170</span></a><span class="sd">        ... )</span>
</span><span id="PlanetaryReturnFactory-171"><a href="#PlanetaryReturnFactory-171"><span class="linenos">171</span></a>
</span><span id="PlanetaryReturnFactory-172"><a href="#PlanetaryReturnFactory-172"><span class="linenos">172</span></a><span class="sd">        Offline mode with manual coordinates:</span>
</span><span id="PlanetaryReturnFactory-173"><a href="#PlanetaryReturnFactory-173"><span class="linenos">173</span></a>
</span><span id="PlanetaryReturnFactory-174"><a href="#PlanetaryReturnFactory-174"><span class="linenos">174</span></a><span class="sd">        &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory-175"><a href="#PlanetaryReturnFactory-175"><span class="linenos">175</span></a><span class="sd">        ...     subject,</span>
</span><span id="PlanetaryReturnFactory-176"><a href="#PlanetaryReturnFactory-176"><span class="linenos">176</span></a><span class="sd">        ...     lng=-74.0060,</span>
</span><span id="PlanetaryReturnFactory-177"><a href="#PlanetaryReturnFactory-177"><span class="linenos">177</span></a><span class="sd">        ...     lat=40.7128,</span>
</span><span id="PlanetaryReturnFactory-178"><a href="#PlanetaryReturnFactory-178"><span class="linenos">178</span></a><span class="sd">        ...     tz_str=&quot;America/New_York&quot;,</span>
</span><span id="PlanetaryReturnFactory-179"><a href="#PlanetaryReturnFactory-179"><span class="linenos">179</span></a><span class="sd">        ...     online=False</span>
</span><span id="PlanetaryReturnFactory-180"><a href="#PlanetaryReturnFactory-180"><span class="linenos">180</span></a><span class="sd">        ... )</span>
</span><span id="PlanetaryReturnFactory-181"><a href="#PlanetaryReturnFactory-181"><span class="linenos">181</span></a>
</span><span id="PlanetaryReturnFactory-182"><a href="#PlanetaryReturnFactory-182"><span class="linenos">182</span></a><span class="sd">        Different location for return chart:</span>
</span><span id="PlanetaryReturnFactory-183"><a href="#PlanetaryReturnFactory-183"><span class="linenos">183</span></a>
</span><span id="PlanetaryReturnFactory-184"><a href="#PlanetaryReturnFactory-184"><span class="linenos">184</span></a><span class="sd">        &gt;&gt;&gt; # Calculate return as if living in a different city</span>
</span><span id="PlanetaryReturnFactory-185"><a href="#PlanetaryReturnFactory-185"><span class="linenos">185</span></a><span class="sd">        &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory-186"><a href="#PlanetaryReturnFactory-186"><span class="linenos">186</span></a><span class="sd">        ...     natal_subject,  # Born in London</span>
</span><span id="PlanetaryReturnFactory-187"><a href="#PlanetaryReturnFactory-187"><span class="linenos">187</span></a><span class="sd">        ...     city=&quot;Paris&quot;,   # But living in Paris</span>
</span><span id="PlanetaryReturnFactory-188"><a href="#PlanetaryReturnFactory-188"><span class="linenos">188</span></a><span class="sd">        ...     nation=&quot;FR&quot;,</span>
</span><span id="PlanetaryReturnFactory-189"><a href="#PlanetaryReturnFactory-189"><span class="linenos">189</span></a><span class="sd">        ...     online=True</span>
</span><span id="PlanetaryReturnFactory-190"><a href="#PlanetaryReturnFactory-190"><span class="linenos">190</span></a><span class="sd">        ... )</span>
</span><span id="PlanetaryReturnFactory-191"><a href="#PlanetaryReturnFactory-191"><span class="linenos">191</span></a>
</span><span id="PlanetaryReturnFactory-192"><a href="#PlanetaryReturnFactory-192"><span class="linenos">192</span></a><span class="sd">    Use Cases:</span>
</span><span id="PlanetaryReturnFactory-193"><a href="#PlanetaryReturnFactory-193"><span class="linenos">193</span></a><span class="sd">        - Annual Solar Return charts for yearly forecasting</span>
</span><span id="PlanetaryReturnFactory-194"><a href="#PlanetaryReturnFactory-194"><span class="linenos">194</span></a><span class="sd">        - Monthly Lunar Return charts for timing analysis</span>
</span><span id="PlanetaryReturnFactory-195"><a href="#PlanetaryReturnFactory-195"><span class="linenos">195</span></a><span class="sd">        - Relocation returns for different geographic locations</span>
</span><span id="PlanetaryReturnFactory-196"><a href="#PlanetaryReturnFactory-196"><span class="linenos">196</span></a><span class="sd">        - Research into planetary cycle effects</span>
</span><span id="PlanetaryReturnFactory-197"><a href="#PlanetaryReturnFactory-197"><span class="linenos">197</span></a><span class="sd">        - Astrological consultation and chart analysis</span>
</span><span id="PlanetaryReturnFactory-198"><a href="#PlanetaryReturnFactory-198"><span class="linenos">198</span></a><span class="sd">        - Educational demonstrations of celestial mechanics</span>
</span><span id="PlanetaryReturnFactory-199"><a href="#PlanetaryReturnFactory-199"><span class="linenos">199</span></a>
</span><span id="PlanetaryReturnFactory-200"><a href="#PlanetaryReturnFactory-200"><span class="linenos">200</span></a><span class="sd">    Note:</span>
</span><span id="PlanetaryReturnFactory-201"><a href="#PlanetaryReturnFactory-201"><span class="linenos">201</span></a><span class="sd">        Return calculations use the exact degree and minute of natal planetary</span>
</span><span id="PlanetaryReturnFactory-202"><a href="#PlanetaryReturnFactory-202"><span class="linenos">202</span></a><span class="sd">        positions. The resulting charts are cast for the precise moment when</span>
</span><span id="PlanetaryReturnFactory-203"><a href="#PlanetaryReturnFactory-203"><span class="linenos">203</span></a><span class="sd">        the transiting planet reaches this position, which may not align with</span>
</span><span id="PlanetaryReturnFactory-204"><a href="#PlanetaryReturnFactory-204"><span class="linenos">204</span></a><span class="sd">        calendar dates (especially for Solar Returns, which can occur on</span>
</span><span id="PlanetaryReturnFactory-205"><a href="#PlanetaryReturnFactory-205"><span class="linenos">205</span></a><span class="sd">        different dates depending on leap years and location).</span>
</span><span id="PlanetaryReturnFactory-206"><a href="#PlanetaryReturnFactory-206"><span class="linenos">206</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-207"><a href="#PlanetaryReturnFactory-207"><span class="linenos">207</span></a>
</span><span id="PlanetaryReturnFactory-208"><a href="#PlanetaryReturnFactory-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-209"><a href="#PlanetaryReturnFactory-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-210"><a href="#PlanetaryReturnFactory-210"><span class="linenos">210</span></a>            <span class="n">subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-211"><a href="#PlanetaryReturnFactory-211"><span class="linenos">211</span></a>            <span class="n">city</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-212"><a href="#PlanetaryReturnFactory-212"><span class="linenos">212</span></a>            <span class="n">nation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-213"><a href="#PlanetaryReturnFactory-213"><span class="linenos">213</span></a>            <span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-214"><a href="#PlanetaryReturnFactory-214"><span class="linenos">214</span></a>            <span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-215"><a href="#PlanetaryReturnFactory-215"><span class="linenos">215</span></a>            <span class="n">tz_str</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-216"><a href="#PlanetaryReturnFactory-216"><span class="linenos">216</span></a>            <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-217"><a href="#PlanetaryReturnFactory-217"><span class="linenos">217</span></a>            <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-218"><a href="#PlanetaryReturnFactory-218"><span class="linenos">218</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-219"><a href="#PlanetaryReturnFactory-219"><span class="linenos">219</span></a>            <span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-220"><a href="#PlanetaryReturnFactory-220"><span class="linenos">220</span></a>            <span class="n">altitude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-221"><a href="#PlanetaryReturnFactory-221"><span class="linenos">221</span></a>        <span class="p">):</span>
</span><span id="PlanetaryReturnFactory-222"><a href="#PlanetaryReturnFactory-222"><span class="linenos">222</span></a>
</span><span id="PlanetaryReturnFactory-223"><a href="#PlanetaryReturnFactory-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-224"><a href="#PlanetaryReturnFactory-224"><span class="linenos">224</span></a><span class="sd">        Initialize a PlanetaryReturnFactory instance with location and configuration settings.</span>
</span><span id="PlanetaryReturnFactory-225"><a href="#PlanetaryReturnFactory-225"><span class="linenos">225</span></a>
</span><span id="PlanetaryReturnFactory-226"><a href="#PlanetaryReturnFactory-226"><span class="linenos">226</span></a><span class="sd">        This constructor sets up the factory with all necessary parameters for calculating</span>
</span><span id="PlanetaryReturnFactory-227"><a href="#PlanetaryReturnFactory-227"><span class="linenos">227</span></a><span class="sd">        planetary returns at a specified location. It supports both online mode (with</span>
</span><span id="PlanetaryReturnFactory-228"><a href="#PlanetaryReturnFactory-228"><span class="linenos">228</span></a><span class="sd">        automatic geocoding via Geonames) and offline mode (with manual coordinates).</span>
</span><span id="PlanetaryReturnFactory-229"><a href="#PlanetaryReturnFactory-229"><span class="linenos">229</span></a>
</span><span id="PlanetaryReturnFactory-230"><a href="#PlanetaryReturnFactory-230"><span class="linenos">230</span></a><span class="sd">        The factory validates input parameters based on the chosen mode and automatically</span>
</span><span id="PlanetaryReturnFactory-231"><a href="#PlanetaryReturnFactory-231"><span class="linenos">231</span></a><span class="sd">        retrieves missing location data when operating online. All location parameters</span>
</span><span id="PlanetaryReturnFactory-232"><a href="#PlanetaryReturnFactory-232"><span class="linenos">232</span></a><span class="sd">        are stored and used for casting return charts at the exact calculated moments.</span>
</span><span id="PlanetaryReturnFactory-233"><a href="#PlanetaryReturnFactory-233"><span class="linenos">233</span></a>
</span><span id="PlanetaryReturnFactory-234"><a href="#PlanetaryReturnFactory-234"><span class="linenos">234</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory-235"><a href="#PlanetaryReturnFactory-235"><span class="linenos">235</span></a><span class="sd">            subject (AstrologicalSubjectModel): The natal astrological subject containing</span>
</span><span id="PlanetaryReturnFactory-236"><a href="#PlanetaryReturnFactory-236"><span class="linenos">236</span></a><span class="sd">                birth data and planetary positions. This subject&#39;s natal planetary</span>
</span><span id="PlanetaryReturnFactory-237"><a href="#PlanetaryReturnFactory-237"><span class="linenos">237</span></a><span class="sd">                positions serve as reference points for calculating returns.</span>
</span><span id="PlanetaryReturnFactory-238"><a href="#PlanetaryReturnFactory-238"><span class="linenos">238</span></a><span class="sd">            city (Optional[str]): City name for the return chart location. Must be a</span>
</span><span id="PlanetaryReturnFactory-239"><a href="#PlanetaryReturnFactory-239"><span class="linenos">239</span></a><span class="sd">                recognizable city name for Geonames geocoding when using online mode.</span>
</span><span id="PlanetaryReturnFactory-240"><a href="#PlanetaryReturnFactory-240"><span class="linenos">240</span></a><span class="sd">                Examples: &quot;New York&quot;, &quot;London&quot;, &quot;Tokyo&quot;, &quot;Paris&quot;.</span>
</span><span id="PlanetaryReturnFactory-241"><a href="#PlanetaryReturnFactory-241"><span class="linenos">241</span></a><span class="sd">            nation (Optional[str]): Country or nation code for the return chart location.</span>
</span><span id="PlanetaryReturnFactory-242"><a href="#PlanetaryReturnFactory-242"><span class="linenos">242</span></a><span class="sd">                Use ISO country codes for best results (e.g., &quot;US&quot;, &quot;GB&quot;, &quot;JP&quot;, &quot;FR&quot;).</span>
</span><span id="PlanetaryReturnFactory-243"><a href="#PlanetaryReturnFactory-243"><span class="linenos">243</span></a><span class="sd">                Required when online=True.</span>
</span><span id="PlanetaryReturnFactory-244"><a href="#PlanetaryReturnFactory-244"><span class="linenos">244</span></a><span class="sd">            lng (Optional[Union[int, float]]): Geographic longitude coordinate in decimal</span>
</span><span id="PlanetaryReturnFactory-245"><a href="#PlanetaryReturnFactory-245"><span class="linenos">245</span></a><span class="sd">                degrees for return chart location. Range: -180.0 to +180.0.</span>
</span><span id="PlanetaryReturnFactory-246"><a href="#PlanetaryReturnFactory-246"><span class="linenos">246</span></a><span class="sd">                Positive values represent East longitude, negative values West longitude.</span>
</span><span id="PlanetaryReturnFactory-247"><a href="#PlanetaryReturnFactory-247"><span class="linenos">247</span></a><span class="sd">                Required when online=False.</span>
</span><span id="PlanetaryReturnFactory-248"><a href="#PlanetaryReturnFactory-248"><span class="linenos">248</span></a><span class="sd">            lat (Optional[Union[int, float]]): Geographic latitude coordinate in decimal</span>
</span><span id="PlanetaryReturnFactory-249"><a href="#PlanetaryReturnFactory-249"><span class="linenos">249</span></a><span class="sd">                degrees for return chart location. Range: -90.0 to +90.0.</span>
</span><span id="PlanetaryReturnFactory-250"><a href="#PlanetaryReturnFactory-250"><span class="linenos">250</span></a><span class="sd">                Positive values represent North latitude, negative values South latitude.</span>
</span><span id="PlanetaryReturnFactory-251"><a href="#PlanetaryReturnFactory-251"><span class="linenos">251</span></a><span class="sd">                Required when online=False.</span>
</span><span id="PlanetaryReturnFactory-252"><a href="#PlanetaryReturnFactory-252"><span class="linenos">252</span></a><span class="sd">            tz_str (Optional[str]): Timezone identifier string for return chart location.</span>
</span><span id="PlanetaryReturnFactory-253"><a href="#PlanetaryReturnFactory-253"><span class="linenos">253</span></a><span class="sd">                Must be a valid timezone from the IANA Time Zone Database</span>
</span><span id="PlanetaryReturnFactory-254"><a href="#PlanetaryReturnFactory-254"><span class="linenos">254</span></a><span class="sd">                (e.g., &quot;America/New_York&quot;, &quot;Europe/London&quot;, &quot;Asia/Tokyo&quot;).</span>
</span><span id="PlanetaryReturnFactory-255"><a href="#PlanetaryReturnFactory-255"><span class="linenos">255</span></a><span class="sd">                Required when online=False.</span>
</span><span id="PlanetaryReturnFactory-256"><a href="#PlanetaryReturnFactory-256"><span class="linenos">256</span></a><span class="sd">            online (bool, optional): Location data retrieval mode. When True, uses</span>
</span><span id="PlanetaryReturnFactory-257"><a href="#PlanetaryReturnFactory-257"><span class="linenos">257</span></a><span class="sd">                Geonames web service to automatically fetch coordinates and timezone</span>
</span><span id="PlanetaryReturnFactory-258"><a href="#PlanetaryReturnFactory-258"><span class="linenos">258</span></a><span class="sd">                from city/nation parameters. When False, uses manually provided</span>
</span><span id="PlanetaryReturnFactory-259"><a href="#PlanetaryReturnFactory-259"><span class="linenos">259</span></a><span class="sd">                coordinates and timezone. Defaults to True.</span>
</span><span id="PlanetaryReturnFactory-260"><a href="#PlanetaryReturnFactory-260"><span class="linenos">260</span></a><span class="sd">            geonames_username (Optional[str]): Username for Geonames API access.</span>
</span><span id="PlanetaryReturnFactory-261"><a href="#PlanetaryReturnFactory-261"><span class="linenos">261</span></a><span class="sd">                Required when online=True and coordinates are not manually provided.</span>
</span><span id="PlanetaryReturnFactory-262"><a href="#PlanetaryReturnFactory-262"><span class="linenos">262</span></a><span class="sd">                Free accounts available at http://www.geonames.org/login.</span>
</span><span id="PlanetaryReturnFactory-263"><a href="#PlanetaryReturnFactory-263"><span class="linenos">263</span></a><span class="sd">                If None and required, uses default username with warning.</span>
</span><span id="PlanetaryReturnFactory-264"><a href="#PlanetaryReturnFactory-264"><span class="linenos">264</span></a><span class="sd">            cache_expire_after_days (int, optional): Number of days to cache Geonames</span>
</span><span id="PlanetaryReturnFactory-265"><a href="#PlanetaryReturnFactory-265"><span class="linenos">265</span></a><span class="sd">                location data locally before requiring refresh. Helps reduce API</span>
</span><span id="PlanetaryReturnFactory-266"><a href="#PlanetaryReturnFactory-266"><span class="linenos">266</span></a><span class="sd">                calls and improve performance for repeated calculations.</span>
</span><span id="PlanetaryReturnFactory-267"><a href="#PlanetaryReturnFactory-267"><span class="linenos">267</span></a><span class="sd">                Defaults to system configuration value.</span>
</span><span id="PlanetaryReturnFactory-268"><a href="#PlanetaryReturnFactory-268"><span class="linenos">268</span></a><span class="sd">            altitude (Optional[Union[float, int]]): Elevation above sea level in meters</span>
</span><span id="PlanetaryReturnFactory-269"><a href="#PlanetaryReturnFactory-269"><span class="linenos">269</span></a><span class="sd">                for the return chart location. Currently reserved for future use in</span>
</span><span id="PlanetaryReturnFactory-270"><a href="#PlanetaryReturnFactory-270"><span class="linenos">270</span></a><span class="sd">                advanced astronomical calculations. Defaults to None.</span>
</span><span id="PlanetaryReturnFactory-271"><a href="#PlanetaryReturnFactory-271"><span class="linenos">271</span></a>
</span><span id="PlanetaryReturnFactory-272"><a href="#PlanetaryReturnFactory-272"><span class="linenos">272</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory-273"><a href="#PlanetaryReturnFactory-273"><span class="linenos">273</span></a><span class="sd">            KerykeionException: If city is not provided when online=True.</span>
</span><span id="PlanetaryReturnFactory-274"><a href="#PlanetaryReturnFactory-274"><span class="linenos">274</span></a><span class="sd">            KerykeionException: If nation is not provided when online=True.</span>
</span><span id="PlanetaryReturnFactory-275"><a href="#PlanetaryReturnFactory-275"><span class="linenos">275</span></a><span class="sd">            KerykeionException: If coordinates (lat/lng) are not provided when online=False.</span>
</span><span id="PlanetaryReturnFactory-276"><a href="#PlanetaryReturnFactory-276"><span class="linenos">276</span></a><span class="sd">            KerykeionException: If timezone (tz_str) is not provided when online=False.</span>
</span><span id="PlanetaryReturnFactory-277"><a href="#PlanetaryReturnFactory-277"><span class="linenos">277</span></a><span class="sd">            KerykeionException: If Geonames API fails to retrieve valid location data.</span>
</span><span id="PlanetaryReturnFactory-278"><a href="#PlanetaryReturnFactory-278"><span class="linenos">278</span></a><span class="sd">            KerykeionException: If required parameters are missing for the chosen mode.</span>
</span><span id="PlanetaryReturnFactory-279"><a href="#PlanetaryReturnFactory-279"><span class="linenos">279</span></a>
</span><span id="PlanetaryReturnFactory-280"><a href="#PlanetaryReturnFactory-280"><span class="linenos">280</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory-281"><a href="#PlanetaryReturnFactory-281"><span class="linenos">281</span></a><span class="sd">            Initialize with online geocoding:</span>
</span><span id="PlanetaryReturnFactory-282"><a href="#PlanetaryReturnFactory-282"><span class="linenos">282</span></a>
</span><span id="PlanetaryReturnFactory-283"><a href="#PlanetaryReturnFactory-283"><span class="linenos">283</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory-284"><a href="#PlanetaryReturnFactory-284"><span class="linenos">284</span></a><span class="sd">            ...     subject,</span>
</span><span id="PlanetaryReturnFactory-285"><a href="#PlanetaryReturnFactory-285"><span class="linenos">285</span></a><span class="sd">            ...     city=&quot;San Francisco&quot;,</span>
</span><span id="PlanetaryReturnFactory-286"><a href="#PlanetaryReturnFactory-286"><span class="linenos">286</span></a><span class="sd">            ...     nation=&quot;US&quot;,</span>
</span><span id="PlanetaryReturnFactory-287"><a href="#PlanetaryReturnFactory-287"><span class="linenos">287</span></a><span class="sd">            ...     online=True,</span>
</span><span id="PlanetaryReturnFactory-288"><a href="#PlanetaryReturnFactory-288"><span class="linenos">288</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="PlanetaryReturnFactory-289"><a href="#PlanetaryReturnFactory-289"><span class="linenos">289</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-290"><a href="#PlanetaryReturnFactory-290"><span class="linenos">290</span></a>
</span><span id="PlanetaryReturnFactory-291"><a href="#PlanetaryReturnFactory-291"><span class="linenos">291</span></a><span class="sd">            Initialize with manual coordinates:</span>
</span><span id="PlanetaryReturnFactory-292"><a href="#PlanetaryReturnFactory-292"><span class="linenos">292</span></a>
</span><span id="PlanetaryReturnFactory-293"><a href="#PlanetaryReturnFactory-293"><span class="linenos">293</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory-294"><a href="#PlanetaryReturnFactory-294"><span class="linenos">294</span></a><span class="sd">            ...     subject,</span>
</span><span id="PlanetaryReturnFactory-295"><a href="#PlanetaryReturnFactory-295"><span class="linenos">295</span></a><span class="sd">            ...     lng=-122.4194,</span>
</span><span id="PlanetaryReturnFactory-296"><a href="#PlanetaryReturnFactory-296"><span class="linenos">296</span></a><span class="sd">            ...     lat=37.7749,</span>
</span><span id="PlanetaryReturnFactory-297"><a href="#PlanetaryReturnFactory-297"><span class="linenos">297</span></a><span class="sd">            ...     tz_str=&quot;America/Los_Angeles&quot;,</span>
</span><span id="PlanetaryReturnFactory-298"><a href="#PlanetaryReturnFactory-298"><span class="linenos">298</span></a><span class="sd">            ...     online=False</span>
</span><span id="PlanetaryReturnFactory-299"><a href="#PlanetaryReturnFactory-299"><span class="linenos">299</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-300"><a href="#PlanetaryReturnFactory-300"><span class="linenos">300</span></a>
</span><span id="PlanetaryReturnFactory-301"><a href="#PlanetaryReturnFactory-301"><span class="linenos">301</span></a><span class="sd">            Initialize with mixed parameters (coordinates override online lookup):</span>
</span><span id="PlanetaryReturnFactory-302"><a href="#PlanetaryReturnFactory-302"><span class="linenos">302</span></a>
</span><span id="PlanetaryReturnFactory-303"><a href="#PlanetaryReturnFactory-303"><span class="linenos">303</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory-304"><a href="#PlanetaryReturnFactory-304"><span class="linenos">304</span></a><span class="sd">            ...     subject,</span>
</span><span id="PlanetaryReturnFactory-305"><a href="#PlanetaryReturnFactory-305"><span class="linenos">305</span></a><span class="sd">            ...     city=&quot;Custom Location&quot;,</span>
</span><span id="PlanetaryReturnFactory-306"><a href="#PlanetaryReturnFactory-306"><span class="linenos">306</span></a><span class="sd">            ...     lng=-74.0060,</span>
</span><span id="PlanetaryReturnFactory-307"><a href="#PlanetaryReturnFactory-307"><span class="linenos">307</span></a><span class="sd">            ...     lat=40.7128,</span>
</span><span id="PlanetaryReturnFactory-308"><a href="#PlanetaryReturnFactory-308"><span class="linenos">308</span></a><span class="sd">            ...     tz_str=&quot;America/New_York&quot;,</span>
</span><span id="PlanetaryReturnFactory-309"><a href="#PlanetaryReturnFactory-309"><span class="linenos">309</span></a><span class="sd">            ...     online=False</span>
</span><span id="PlanetaryReturnFactory-310"><a href="#PlanetaryReturnFactory-310"><span class="linenos">310</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-311"><a href="#PlanetaryReturnFactory-311"><span class="linenos">311</span></a>
</span><span id="PlanetaryReturnFactory-312"><a href="#PlanetaryReturnFactory-312"><span class="linenos">312</span></a><span class="sd">        Note:</span>
</span><span id="PlanetaryReturnFactory-313"><a href="#PlanetaryReturnFactory-313"><span class="linenos">313</span></a><span class="sd">            - When both online and manual coordinates are provided, offline mode takes precedence</span>
</span><span id="PlanetaryReturnFactory-314"><a href="#PlanetaryReturnFactory-314"><span class="linenos">314</span></a><span class="sd">            - Geonames cache helps reduce API calls for frequently used locations</span>
</span><span id="PlanetaryReturnFactory-315"><a href="#PlanetaryReturnFactory-315"><span class="linenos">315</span></a><span class="sd">            - Timezone accuracy is crucial for precise return calculations</span>
</span><span id="PlanetaryReturnFactory-316"><a href="#PlanetaryReturnFactory-316"><span class="linenos">316</span></a><span class="sd">            - Location parameters affect house cusps and angular positions in return charts</span>
</span><span id="PlanetaryReturnFactory-317"><a href="#PlanetaryReturnFactory-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-318"><a href="#PlanetaryReturnFactory-318"><span class="linenos">318</span></a>        <span class="c1"># Store basic configuration</span>
</span><span id="PlanetaryReturnFactory-319"><a href="#PlanetaryReturnFactory-319"><span class="linenos">319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>
</span><span id="PlanetaryReturnFactory-320"><a href="#PlanetaryReturnFactory-320"><span class="linenos">320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">online</span> <span class="o">=</span> <span class="n">online</span>
</span><span id="PlanetaryReturnFactory-321"><a href="#PlanetaryReturnFactory-321"><span class="linenos">321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_expire_after_days</span> <span class="o">=</span> <span class="n">cache_expire_after_days</span>
</span><span id="PlanetaryReturnFactory-322"><a href="#PlanetaryReturnFactory-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span>
</span><span id="PlanetaryReturnFactory-323"><a href="#PlanetaryReturnFactory-323"><span class="linenos">323</span></a>
</span><span id="PlanetaryReturnFactory-324"><a href="#PlanetaryReturnFactory-324"><span class="linenos">324</span></a>        <span class="c1"># Geonames username</span>
</span><span id="PlanetaryReturnFactory-325"><a href="#PlanetaryReturnFactory-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="n">geonames_username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lat</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lng</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tz_str</span><span class="p">):</span>
</span><span id="PlanetaryReturnFactory-326"><a href="#PlanetaryReturnFactory-326"><span class="linenos">326</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-327"><a href="#PlanetaryReturnFactory-327"><span class="linenos">327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span>
</span><span id="PlanetaryReturnFactory-328"><a href="#PlanetaryReturnFactory-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-329"><a href="#PlanetaryReturnFactory-329"><span class="linenos">329</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span> <span class="o">=</span> <span class="n">geonames_username</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-330"><a href="#PlanetaryReturnFactory-330"><span class="linenos">330</span></a>
</span><span id="PlanetaryReturnFactory-331"><a href="#PlanetaryReturnFactory-331"><span class="linenos">331</span></a>        <span class="c1"># City</span>
</span><span id="PlanetaryReturnFactory-332"><a href="#PlanetaryReturnFactory-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">city</span> <span class="ow">and</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-333"><a href="#PlanetaryReturnFactory-333"><span class="linenos">333</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the city if you want to use the online mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-334"><a href="#PlanetaryReturnFactory-334"><span class="linenos">334</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-335"><a href="#PlanetaryReturnFactory-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
</span><span id="PlanetaryReturnFactory-336"><a href="#PlanetaryReturnFactory-336"><span class="linenos">336</span></a>
</span><span id="PlanetaryReturnFactory-337"><a href="#PlanetaryReturnFactory-337"><span class="linenos">337</span></a>        <span class="c1"># Nation</span>
</span><span id="PlanetaryReturnFactory-338"><a href="#PlanetaryReturnFactory-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">nation</span> <span class="ow">and</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-339"><a href="#PlanetaryReturnFactory-339"><span class="linenos">339</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the nation if you want to use the online mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-340"><a href="#PlanetaryReturnFactory-340"><span class="linenos">340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-341"><a href="#PlanetaryReturnFactory-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nation</span> <span class="o">=</span> <span class="n">nation</span>
</span><span id="PlanetaryReturnFactory-342"><a href="#PlanetaryReturnFactory-342"><span class="linenos">342</span></a>
</span><span id="PlanetaryReturnFactory-343"><a href="#PlanetaryReturnFactory-343"><span class="linenos">343</span></a>        <span class="c1"># Latitude</span>
</span><span id="PlanetaryReturnFactory-344"><a href="#PlanetaryReturnFactory-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lat</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-345"><a href="#PlanetaryReturnFactory-345"><span class="linenos">345</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the coordinates and timezone if you want to use the offline mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-346"><a href="#PlanetaryReturnFactory-346"><span class="linenos">346</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-347"><a href="#PlanetaryReturnFactory-347"><span class="linenos">347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-348"><a href="#PlanetaryReturnFactory-348"><span class="linenos">348</span></a>
</span><span id="PlanetaryReturnFactory-349"><a href="#PlanetaryReturnFactory-349"><span class="linenos">349</span></a>        <span class="c1"># Longitude</span>
</span><span id="PlanetaryReturnFactory-350"><a href="#PlanetaryReturnFactory-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lng</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-351"><a href="#PlanetaryReturnFactory-351"><span class="linenos">351</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the coordinates and timezone if you want to use the offline mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-352"><a href="#PlanetaryReturnFactory-352"><span class="linenos">352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-353"><a href="#PlanetaryReturnFactory-353"><span class="linenos">353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="n">lng</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-354"><a href="#PlanetaryReturnFactory-354"><span class="linenos">354</span></a>
</span><span id="PlanetaryReturnFactory-355"><a href="#PlanetaryReturnFactory-355"><span class="linenos">355</span></a>        <span class="c1"># Timezone</span>
</span><span id="PlanetaryReturnFactory-356"><a href="#PlanetaryReturnFactory-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">online</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tz_str</span><span class="p">):</span>
</span><span id="PlanetaryReturnFactory-357"><a href="#PlanetaryReturnFactory-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the coordinates and timezone if you want to use the offline mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-358"><a href="#PlanetaryReturnFactory-358"><span class="linenos">358</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-359"><a href="#PlanetaryReturnFactory-359"><span class="linenos">359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span> <span class="o">=</span> <span class="n">tz_str</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-360"><a href="#PlanetaryReturnFactory-360"><span class="linenos">360</span></a>
</span><span id="PlanetaryReturnFactory-361"><a href="#PlanetaryReturnFactory-361"><span class="linenos">361</span></a>        <span class="c1"># Online mode</span>
</span><span id="PlanetaryReturnFactory-362"><a href="#PlanetaryReturnFactory-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">online</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">):</span>
</span><span id="PlanetaryReturnFactory-363"><a href="#PlanetaryReturnFactory-363"><span class="linenos">363</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching timezone/coordinates from geonames&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-364"><a href="#PlanetaryReturnFactory-364"><span class="linenos">364</span></a>
</span><span id="PlanetaryReturnFactory-365"><a href="#PlanetaryReturnFactory-365"><span class="linenos">365</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nation</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-366"><a href="#PlanetaryReturnFactory-366"><span class="linenos">366</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the city and nation if you want to use the online mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-367"><a href="#PlanetaryReturnFactory-367"><span class="linenos">367</span></a>
</span><span id="PlanetaryReturnFactory-368"><a href="#PlanetaryReturnFactory-368"><span class="linenos">368</span></a>            <span class="n">geonames</span> <span class="o">=</span> <span class="n">FetchGeonames</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-369"><a href="#PlanetaryReturnFactory-369"><span class="linenos">369</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-370"><a href="#PlanetaryReturnFactory-370"><span class="linenos">370</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nation</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-371"><a href="#PlanetaryReturnFactory-371"><span class="linenos">371</span></a>                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-372"><a href="#PlanetaryReturnFactory-372"><span class="linenos">372</span></a>                <span class="n">cache_expire_after_days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_expire_after_days</span>
</span><span id="PlanetaryReturnFactory-373"><a href="#PlanetaryReturnFactory-373"><span class="linenos">373</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-374"><a href="#PlanetaryReturnFactory-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">geonames</span><span class="o">.</span><span class="n">get_serialized_data</span><span class="p">()</span>
</span><span id="PlanetaryReturnFactory-375"><a href="#PlanetaryReturnFactory-375"><span class="linenos">375</span></a>
</span><span id="PlanetaryReturnFactory-376"><a href="#PlanetaryReturnFactory-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="PlanetaryReturnFactory-377"><a href="#PlanetaryReturnFactory-377"><span class="linenos">377</span></a>                <span class="s2">&quot;countryCode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory-378"><a href="#PlanetaryReturnFactory-378"><span class="linenos">378</span></a>                <span class="ow">or</span> <span class="s2">&quot;timezonestr&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory-379"><a href="#PlanetaryReturnFactory-379"><span class="linenos">379</span></a>                <span class="ow">or</span> <span class="s2">&quot;lat&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory-380"><a href="#PlanetaryReturnFactory-380"><span class="linenos">380</span></a>                <span class="ow">or</span> <span class="s2">&quot;lng&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory-381"><a href="#PlanetaryReturnFactory-381"><span class="linenos">381</span></a>            <span class="p">):</span>
</span><span id="PlanetaryReturnFactory-382"><a href="#PlanetaryReturnFactory-382"><span class="linenos">382</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;No data found for this city, try again! Maybe check your connection?&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-383"><a href="#PlanetaryReturnFactory-383"><span class="linenos">383</span></a>
</span><span id="PlanetaryReturnFactory-384"><a href="#PlanetaryReturnFactory-384"><span class="linenos">384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;countryCode&quot;</span><span class="p">]</span>
</span><span id="PlanetaryReturnFactory-385"><a href="#PlanetaryReturnFactory-385"><span class="linenos">385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">])</span>
</span><span id="PlanetaryReturnFactory-386"><a href="#PlanetaryReturnFactory-386"><span class="linenos">386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">])</span>
</span><span id="PlanetaryReturnFactory-387"><a href="#PlanetaryReturnFactory-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;timezonestr&quot;</span><span class="p">]</span>
</span><span id="PlanetaryReturnFactory-388"><a href="#PlanetaryReturnFactory-388"><span class="linenos">388</span></a>
</span><span id="PlanetaryReturnFactory-389"><a href="#PlanetaryReturnFactory-389"><span class="linenos">389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_iso_formatted_time</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-390"><a href="#PlanetaryReturnFactory-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-391"><a href="#PlanetaryReturnFactory-391"><span class="linenos">391</span></a>        <span class="n">iso_formatted_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-392"><a href="#PlanetaryReturnFactory-392"><span class="linenos">392</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory-393"><a href="#PlanetaryReturnFactory-393"><span class="linenos">393</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-394"><a href="#PlanetaryReturnFactory-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-395"><a href="#PlanetaryReturnFactory-395"><span class="linenos">395</span></a><span class="sd">        Calculate the next planetary return occurring after a specified ISO-formatted datetime.</span>
</span><span id="PlanetaryReturnFactory-396"><a href="#PlanetaryReturnFactory-396"><span class="linenos">396</span></a>
</span><span id="PlanetaryReturnFactory-397"><a href="#PlanetaryReturnFactory-397"><span class="linenos">397</span></a><span class="sd">        This method computes the exact moment when the specified planet (Sun or Moon) returns</span>
</span><span id="PlanetaryReturnFactory-398"><a href="#PlanetaryReturnFactory-398"><span class="linenos">398</span></a><span class="sd">        to its natal position, starting the search from the provided datetime. It uses precise</span>
</span><span id="PlanetaryReturnFactory-399"><a href="#PlanetaryReturnFactory-399"><span class="linenos">399</span></a><span class="sd">        Swiss Ephemeris calculations to determine the exact return moment and generates a</span>
</span><span id="PlanetaryReturnFactory-400"><a href="#PlanetaryReturnFactory-400"><span class="linenos">400</span></a><span class="sd">        complete astrological chart for that calculated time.</span>
</span><span id="PlanetaryReturnFactory-401"><a href="#PlanetaryReturnFactory-401"><span class="linenos">401</span></a>
</span><span id="PlanetaryReturnFactory-402"><a href="#PlanetaryReturnFactory-402"><span class="linenos">402</span></a><span class="sd">        The calculation process:</span>
</span><span id="PlanetaryReturnFactory-403"><a href="#PlanetaryReturnFactory-403"><span class="linenos">403</span></a><span class="sd">        1. Converts the ISO datetime to Julian Day format for astronomical calculations</span>
</span><span id="PlanetaryReturnFactory-404"><a href="#PlanetaryReturnFactory-404"><span class="linenos">404</span></a><span class="sd">        2. Uses Swiss Ephemeris functions (solcross_ut/mooncross_ut) to find the exact</span>
</span><span id="PlanetaryReturnFactory-405"><a href="#PlanetaryReturnFactory-405"><span class="linenos">405</span></a><span class="sd">           return moment when the planet reaches its natal degree and minute</span>
</span><span id="PlanetaryReturnFactory-406"><a href="#PlanetaryReturnFactory-406"><span class="linenos">406</span></a><span class="sd">        3. Creates a complete AstrologicalSubject instance for the calculated return time</span>
</span><span id="PlanetaryReturnFactory-407"><a href="#PlanetaryReturnFactory-407"><span class="linenos">407</span></a><span class="sd">        4. Returns a comprehensive PlanetReturnModel with all chart data</span>
</span><span id="PlanetaryReturnFactory-408"><a href="#PlanetaryReturnFactory-408"><span class="linenos">408</span></a>
</span><span id="PlanetaryReturnFactory-409"><a href="#PlanetaryReturnFactory-409"><span class="linenos">409</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory-410"><a href="#PlanetaryReturnFactory-410"><span class="linenos">410</span></a><span class="sd">            iso_formatted_time (str): Starting datetime in ISO format for the search.</span>
</span><span id="PlanetaryReturnFactory-411"><a href="#PlanetaryReturnFactory-411"><span class="linenos">411</span></a><span class="sd">                Must be a valid ISO 8601 datetime string (e.g., &quot;2024-01-15T10:30:00&quot;</span>
</span><span id="PlanetaryReturnFactory-412"><a href="#PlanetaryReturnFactory-412"><span class="linenos">412</span></a><span class="sd">                or &quot;2024-01-15T10:30:00+00:00&quot;). The method will find the next return</span>
</span><span id="PlanetaryReturnFactory-413"><a href="#PlanetaryReturnFactory-413"><span class="linenos">413</span></a><span class="sd">                occurring after this moment.</span>
</span><span id="PlanetaryReturnFactory-414"><a href="#PlanetaryReturnFactory-414"><span class="linenos">414</span></a><span class="sd">            return_type (ReturnType): Type of planetary return to calculate.</span>
</span><span id="PlanetaryReturnFactory-415"><a href="#PlanetaryReturnFactory-415"><span class="linenos">415</span></a><span class="sd">                Must be either &quot;Solar&quot; for Sun returns or &quot;Lunar&quot; for Moon returns.</span>
</span><span id="PlanetaryReturnFactory-416"><a href="#PlanetaryReturnFactory-416"><span class="linenos">416</span></a><span class="sd">                This determines which planet&#39;s return cycle to compute.</span>
</span><span id="PlanetaryReturnFactory-417"><a href="#PlanetaryReturnFactory-417"><span class="linenos">417</span></a>
</span><span id="PlanetaryReturnFactory-418"><a href="#PlanetaryReturnFactory-418"><span class="linenos">418</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory-419"><a href="#PlanetaryReturnFactory-419"><span class="linenos">419</span></a><span class="sd">            PlanetReturnModel: A comprehensive Pydantic model containing complete</span>
</span><span id="PlanetaryReturnFactory-420"><a href="#PlanetaryReturnFactory-420"><span class="linenos">420</span></a><span class="sd">                astrological chart data for the calculated return moment, including:</span>
</span><span id="PlanetaryReturnFactory-421"><a href="#PlanetaryReturnFactory-421"><span class="linenos">421</span></a><span class="sd">                - Exact return datetime (UTC and local timezone)</span>
</span><span id="PlanetaryReturnFactory-422"><a href="#PlanetaryReturnFactory-422"><span class="linenos">422</span></a><span class="sd">                - All planetary positions at the return moment</span>
</span><span id="PlanetaryReturnFactory-423"><a href="#PlanetaryReturnFactory-423"><span class="linenos">423</span></a><span class="sd">                - House cusps and angles for the return location</span>
</span><span id="PlanetaryReturnFactory-424"><a href="#PlanetaryReturnFactory-424"><span class="linenos">424</span></a><span class="sd">                - Complete astrological subject data with all calculated points</span>
</span><span id="PlanetaryReturnFactory-425"><a href="#PlanetaryReturnFactory-425"><span class="linenos">425</span></a><span class="sd">                - Return type identifier and subject name</span>
</span><span id="PlanetaryReturnFactory-426"><a href="#PlanetaryReturnFactory-426"><span class="linenos">426</span></a><span class="sd">                - Julian Day Number for the return moment</span>
</span><span id="PlanetaryReturnFactory-427"><a href="#PlanetaryReturnFactory-427"><span class="linenos">427</span></a>
</span><span id="PlanetaryReturnFactory-428"><a href="#PlanetaryReturnFactory-428"><span class="linenos">428</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory-429"><a href="#PlanetaryReturnFactory-429"><span class="linenos">429</span></a><span class="sd">            KerykeionException: If return_type is not &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory-430"><a href="#PlanetaryReturnFactory-430"><span class="linenos">430</span></a><span class="sd">            ValueError: If iso_formatted_time is not a valid ISO datetime format.</span>
</span><span id="PlanetaryReturnFactory-431"><a href="#PlanetaryReturnFactory-431"><span class="linenos">431</span></a><span class="sd">            SwissEphException: If Swiss Ephemeris calculations fail due to invalid</span>
</span><span id="PlanetaryReturnFactory-432"><a href="#PlanetaryReturnFactory-432"><span class="linenos">432</span></a><span class="sd">                date ranges or astronomical calculation errors.</span>
</span><span id="PlanetaryReturnFactory-433"><a href="#PlanetaryReturnFactory-433"><span class="linenos">433</span></a>
</span><span id="PlanetaryReturnFactory-434"><a href="#PlanetaryReturnFactory-434"><span class="linenos">434</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory-435"><a href="#PlanetaryReturnFactory-435"><span class="linenos">435</span></a><span class="sd">            Calculate next Solar Return after a specific date:</span>
</span><span id="PlanetaryReturnFactory-436"><a href="#PlanetaryReturnFactory-436"><span class="linenos">436</span></a>
</span><span id="PlanetaryReturnFactory-437"><a href="#PlanetaryReturnFactory-437"><span class="linenos">437</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(subject, ...)</span>
</span><span id="PlanetaryReturnFactory-438"><a href="#PlanetaryReturnFactory-438"><span class="linenos">438</span></a><span class="sd">            &gt;&gt;&gt; solar_return = factory.next_return_from_iso_formatted_time(</span>
</span><span id="PlanetaryReturnFactory-439"><a href="#PlanetaryReturnFactory-439"><span class="linenos">439</span></a><span class="sd">            ...     &quot;2024-06-15T12:00:00&quot;,</span>
</span><span id="PlanetaryReturnFactory-440"><a href="#PlanetaryReturnFactory-440"><span class="linenos">440</span></a><span class="sd">            ...     &quot;Solar&quot;</span>
</span><span id="PlanetaryReturnFactory-441"><a href="#PlanetaryReturnFactory-441"><span class="linenos">441</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-442"><a href="#PlanetaryReturnFactory-442"><span class="linenos">442</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Solar Return: {solar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory-443"><a href="#PlanetaryReturnFactory-443"><span class="linenos">443</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Sun position: {solar_return.sun.abs_pos}&quot;)</span>
</span><span id="PlanetaryReturnFactory-444"><a href="#PlanetaryReturnFactory-444"><span class="linenos">444</span></a>
</span><span id="PlanetaryReturnFactory-445"><a href="#PlanetaryReturnFactory-445"><span class="linenos">445</span></a><span class="sd">            Calculate next Lunar Return with timezone:</span>
</span><span id="PlanetaryReturnFactory-446"><a href="#PlanetaryReturnFactory-446"><span class="linenos">446</span></a>
</span><span id="PlanetaryReturnFactory-447"><a href="#PlanetaryReturnFactory-447"><span class="linenos">447</span></a><span class="sd">            &gt;&gt;&gt; lunar_return = factory.next_return_from_iso_formatted_time(</span>
</span><span id="PlanetaryReturnFactory-448"><a href="#PlanetaryReturnFactory-448"><span class="linenos">448</span></a><span class="sd">            ...     &quot;2024-01-01T00:00:00+00:00&quot;,</span>
</span><span id="PlanetaryReturnFactory-449"><a href="#PlanetaryReturnFactory-449"><span class="linenos">449</span></a><span class="sd">            ...     &quot;Lunar&quot;</span>
</span><span id="PlanetaryReturnFactory-450"><a href="#PlanetaryReturnFactory-450"><span class="linenos">450</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-451"><a href="#PlanetaryReturnFactory-451"><span class="linenos">451</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Moon return in {lunar_return.tz_str}&quot;)</span>
</span><span id="PlanetaryReturnFactory-452"><a href="#PlanetaryReturnFactory-452"><span class="linenos">452</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Return occurs: {lunar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory-453"><a href="#PlanetaryReturnFactory-453"><span class="linenos">453</span></a>
</span><span id="PlanetaryReturnFactory-454"><a href="#PlanetaryReturnFactory-454"><span class="linenos">454</span></a><span class="sd">            Access complete chart data from return:</span>
</span><span id="PlanetaryReturnFactory-455"><a href="#PlanetaryReturnFactory-455"><span class="linenos">455</span></a>
</span><span id="PlanetaryReturnFactory-456"><a href="#PlanetaryReturnFactory-456"><span class="linenos">456</span></a><span class="sd">            &gt;&gt;&gt; return_chart = factory.next_return_from_iso_formatted_time(</span>
</span><span id="PlanetaryReturnFactory-457"><a href="#PlanetaryReturnFactory-457"><span class="linenos">457</span></a><span class="sd">            ...     datetime.now().isoformat(),</span>
</span><span id="PlanetaryReturnFactory-458"><a href="#PlanetaryReturnFactory-458"><span class="linenos">458</span></a><span class="sd">            ...     &quot;Solar&quot;</span>
</span><span id="PlanetaryReturnFactory-459"><a href="#PlanetaryReturnFactory-459"><span class="linenos">459</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-460"><a href="#PlanetaryReturnFactory-460"><span class="linenos">460</span></a><span class="sd">            &gt;&gt;&gt; # Access all planetary positions</span>
</span><span id="PlanetaryReturnFactory-461"><a href="#PlanetaryReturnFactory-461"><span class="linenos">461</span></a><span class="sd">            &gt;&gt;&gt; for planet in return_chart.planets_list:</span>
</span><span id="PlanetaryReturnFactory-462"><a href="#PlanetaryReturnFactory-462"><span class="linenos">462</span></a><span class="sd">            ...     print(f&quot;{planet.name}: {planet.abs_pos} in {planet.sign}&quot;)</span>
</span><span id="PlanetaryReturnFactory-463"><a href="#PlanetaryReturnFactory-463"><span class="linenos">463</span></a><span class="sd">            &gt;&gt;&gt; # Access house cusps</span>
</span><span id="PlanetaryReturnFactory-464"><a href="#PlanetaryReturnFactory-464"><span class="linenos">464</span></a><span class="sd">            &gt;&gt;&gt; for house in return_chart.houses_list:</span>
</span><span id="PlanetaryReturnFactory-465"><a href="#PlanetaryReturnFactory-465"><span class="linenos">465</span></a><span class="sd">            ...     print(f&quot;House {house.number}: {house.abs_pos}&quot;)</span>
</span><span id="PlanetaryReturnFactory-466"><a href="#PlanetaryReturnFactory-466"><span class="linenos">466</span></a>
</span><span id="PlanetaryReturnFactory-467"><a href="#PlanetaryReturnFactory-467"><span class="linenos">467</span></a><span class="sd">        Technical Notes:</span>
</span><span id="PlanetaryReturnFactory-468"><a href="#PlanetaryReturnFactory-468"><span class="linenos">468</span></a><span class="sd">            - Solar returns typically occur within 1-2 days of the natal birthday</span>
</span><span id="PlanetaryReturnFactory-469"><a href="#PlanetaryReturnFactory-469"><span class="linenos">469</span></a><span class="sd">            - Lunar returns occur approximately every 27.3 days (sidereal month)</span>
</span><span id="PlanetaryReturnFactory-470"><a href="#PlanetaryReturnFactory-470"><span class="linenos">470</span></a><span class="sd">            - Return moments are calculated to the second for maximum precision</span>
</span><span id="PlanetaryReturnFactory-471"><a href="#PlanetaryReturnFactory-471"><span class="linenos">471</span></a><span class="sd">            - The method accounts for leap years and varying orbital speeds</span>
</span><span id="PlanetaryReturnFactory-472"><a href="#PlanetaryReturnFactory-472"><span class="linenos">472</span></a><span class="sd">            - Return charts use the factory&#39;s configured location, not the natal location</span>
</span><span id="PlanetaryReturnFactory-473"><a href="#PlanetaryReturnFactory-473"><span class="linenos">473</span></a>
</span><span id="PlanetaryReturnFactory-474"><a href="#PlanetaryReturnFactory-474"><span class="linenos">474</span></a><span class="sd">        Use Cases:</span>
</span><span id="PlanetaryReturnFactory-475"><a href="#PlanetaryReturnFactory-475"><span class="linenos">475</span></a><span class="sd">            - Annual birthday return chart calculations</span>
</span><span id="PlanetaryReturnFactory-476"><a href="#PlanetaryReturnFactory-476"><span class="linenos">476</span></a><span class="sd">            - Monthly lunar return timing for astrological consultation</span>
</span><span id="PlanetaryReturnFactory-477"><a href="#PlanetaryReturnFactory-477"><span class="linenos">477</span></a><span class="sd">            - Research into planetary cycle patterns and timing</span>
</span><span id="PlanetaryReturnFactory-478"><a href="#PlanetaryReturnFactory-478"><span class="linenos">478</span></a><span class="sd">            - Forecasting and predictive astrology applications</span>
</span><span id="PlanetaryReturnFactory-479"><a href="#PlanetaryReturnFactory-479"><span class="linenos">479</span></a><span class="sd">            - Educational demonstrations of astronomical cycles</span>
</span><span id="PlanetaryReturnFactory-480"><a href="#PlanetaryReturnFactory-480"><span class="linenos">480</span></a>
</span><span id="PlanetaryReturnFactory-481"><a href="#PlanetaryReturnFactory-481"><span class="linenos">481</span></a><span class="sd">        See Also:</span>
</span><span id="PlanetaryReturnFactory-482"><a href="#PlanetaryReturnFactory-482"><span class="linenos">482</span></a><span class="sd">            next_return_from_year(): Simplified interface for yearly calculations</span>
</span><span id="PlanetaryReturnFactory-483"><a href="#PlanetaryReturnFactory-483"><span class="linenos">483</span></a><span class="sd">            next_return_from_date(): Date-based calculation interface</span>
</span><span id="PlanetaryReturnFactory-484"><a href="#PlanetaryReturnFactory-484"><span class="linenos">484</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-485"><a href="#PlanetaryReturnFactory-485"><span class="linenos">485</span></a>
</span><span id="PlanetaryReturnFactory-486"><a href="#PlanetaryReturnFactory-486"><span class="linenos">486</span></a>        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_formatted_time</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-487"><a href="#PlanetaryReturnFactory-487"><span class="linenos">487</span></a>        <span class="n">julian_day</span> <span class="o">=</span> <span class="n">datetime_to_julian</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-488"><a href="#PlanetaryReturnFactory-488"><span class="linenos">488</span></a>
</span><span id="PlanetaryReturnFactory-489"><a href="#PlanetaryReturnFactory-489"><span class="linenos">489</span></a>        <span class="n">return_julian_date</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PlanetaryReturnFactory-490"><a href="#PlanetaryReturnFactory-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-491"><a href="#PlanetaryReturnFactory-491"><span class="linenos">491</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">sun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-492"><a href="#PlanetaryReturnFactory-492"><span class="linenos">492</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Sun position is required for Solar return but is not available in the subject.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-493"><a href="#PlanetaryReturnFactory-493"><span class="linenos">493</span></a>            <span class="n">return_julian_date</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">solcross_ut</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-494"><a href="#PlanetaryReturnFactory-494"><span class="linenos">494</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-495"><a href="#PlanetaryReturnFactory-495"><span class="linenos">495</span></a>                <span class="n">julian_day</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-496"><a href="#PlanetaryReturnFactory-496"><span class="linenos">496</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-497"><a href="#PlanetaryReturnFactory-497"><span class="linenos">497</span></a>        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Lunar&quot;</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-498"><a href="#PlanetaryReturnFactory-498"><span class="linenos">498</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">moon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-499"><a href="#PlanetaryReturnFactory-499"><span class="linenos">499</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Moon position is required for Lunar return but is not available in the subject.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-500"><a href="#PlanetaryReturnFactory-500"><span class="linenos">500</span></a>            <span class="n">return_julian_date</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">mooncross_ut</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-501"><a href="#PlanetaryReturnFactory-501"><span class="linenos">501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">moon</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-502"><a href="#PlanetaryReturnFactory-502"><span class="linenos">502</span></a>                <span class="n">julian_day</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-503"><a href="#PlanetaryReturnFactory-503"><span class="linenos">503</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-504"><a href="#PlanetaryReturnFactory-504"><span class="linenos">504</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-505"><a href="#PlanetaryReturnFactory-505"><span class="linenos">505</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return type </span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s2">. Use &#39;Solar&#39; or &#39;Lunar&#39;.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-506"><a href="#PlanetaryReturnFactory-506"><span class="linenos">506</span></a>
</span><span id="PlanetaryReturnFactory-507"><a href="#PlanetaryReturnFactory-507"><span class="linenos">507</span></a>        <span class="n">solar_return_date_utc</span> <span class="o">=</span> <span class="n">julian_to_datetime</span><span class="p">(</span><span class="n">return_julian_date</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-508"><a href="#PlanetaryReturnFactory-508"><span class="linenos">508</span></a>        <span class="n">solar_return_date_utc</span> <span class="o">=</span> <span class="n">solar_return_date_utc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-509"><a href="#PlanetaryReturnFactory-509"><span class="linenos">509</span></a>
</span><span id="PlanetaryReturnFactory-510"><a href="#PlanetaryReturnFactory-510"><span class="linenos">510</span></a>        <span class="n">solar_return_astrological_subject</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_iso_utc_time</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-511"><a href="#PlanetaryReturnFactory-511"><span class="linenos">511</span></a>            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-512"><a href="#PlanetaryReturnFactory-512"><span class="linenos">512</span></a>            <span class="n">iso_utc_time</span><span class="o">=</span><span class="n">solar_return_date_utc</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PlanetaryReturnFactory-513"><a href="#PlanetaryReturnFactory-513"><span class="linenos">513</span></a>            <span class="n">lng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>       <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-514"><a href="#PlanetaryReturnFactory-514"><span class="linenos">514</span></a>            <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>       <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-515"><a href="#PlanetaryReturnFactory-515"><span class="linenos">515</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-516"><a href="#PlanetaryReturnFactory-516"><span class="linenos">516</span></a>            <span class="n">city</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>     <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-517"><a href="#PlanetaryReturnFactory-517"><span class="linenos">517</span></a>            <span class="n">nation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nation</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory-518"><a href="#PlanetaryReturnFactory-518"><span class="linenos">518</span></a>            <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-519"><a href="#PlanetaryReturnFactory-519"><span class="linenos">519</span></a>            <span class="n">altitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-520"><a href="#PlanetaryReturnFactory-520"><span class="linenos">520</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-521"><a href="#PlanetaryReturnFactory-521"><span class="linenos">521</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-522"><a href="#PlanetaryReturnFactory-522"><span class="linenos">522</span></a>
</span><span id="PlanetaryReturnFactory-523"><a href="#PlanetaryReturnFactory-523"><span class="linenos">523</span></a>        <span class="n">model_data</span> <span class="o">=</span> <span class="n">solar_return_astrological_subject</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span><span id="PlanetaryReturnFactory-524"><a href="#PlanetaryReturnFactory-524"><span class="linenos">524</span></a>        <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s2"> Return&quot;</span>
</span><span id="PlanetaryReturnFactory-525"><a href="#PlanetaryReturnFactory-525"><span class="linenos">525</span></a>        <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;return_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">return_type</span>
</span><span id="PlanetaryReturnFactory-526"><a href="#PlanetaryReturnFactory-526"><span class="linenos">526</span></a>
</span><span id="PlanetaryReturnFactory-527"><a href="#PlanetaryReturnFactory-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="n">PlanetReturnModel</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-528"><a href="#PlanetaryReturnFactory-528"><span class="linenos">528</span></a>            <span class="o">**</span><span class="n">model_data</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-529"><a href="#PlanetaryReturnFactory-529"><span class="linenos">529</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-530"><a href="#PlanetaryReturnFactory-530"><span class="linenos">530</span></a>
</span><span id="PlanetaryReturnFactory-531"><a href="#PlanetaryReturnFactory-531"><span class="linenos">531</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_year</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-532"><a href="#PlanetaryReturnFactory-532"><span class="linenos">532</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-533"><a href="#PlanetaryReturnFactory-533"><span class="linenos">533</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-534"><a href="#PlanetaryReturnFactory-534"><span class="linenos">534</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory-535"><a href="#PlanetaryReturnFactory-535"><span class="linenos">535</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-536"><a href="#PlanetaryReturnFactory-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-537"><a href="#PlanetaryReturnFactory-537"><span class="linenos">537</span></a><span class="sd">        Calculate the planetary return occurring within a specified year.</span>
</span><span id="PlanetaryReturnFactory-538"><a href="#PlanetaryReturnFactory-538"><span class="linenos">538</span></a>
</span><span id="PlanetaryReturnFactory-539"><a href="#PlanetaryReturnFactory-539"><span class="linenos">539</span></a><span class="sd">        This is a convenience method that finds the first planetary return (Solar or Lunar)</span>
</span><span id="PlanetaryReturnFactory-540"><a href="#PlanetaryReturnFactory-540"><span class="linenos">540</span></a><span class="sd">        that occurs in the given calendar year. It automatically searches from January 1st</span>
</span><span id="PlanetaryReturnFactory-541"><a href="#PlanetaryReturnFactory-541"><span class="linenos">541</span></a><span class="sd">        of the specified year and returns the first return found, making it ideal for</span>
</span><span id="PlanetaryReturnFactory-542"><a href="#PlanetaryReturnFactory-542"><span class="linenos">542</span></a><span class="sd">        annual forecasting and birthday return calculations.</span>
</span><span id="PlanetaryReturnFactory-543"><a href="#PlanetaryReturnFactory-543"><span class="linenos">543</span></a>
</span><span id="PlanetaryReturnFactory-544"><a href="#PlanetaryReturnFactory-544"><span class="linenos">544</span></a><span class="sd">        For Solar Returns, this typically finds the return closest to the natal birthday</span>
</span><span id="PlanetaryReturnFactory-545"><a href="#PlanetaryReturnFactory-545"><span class="linenos">545</span></a><span class="sd">        within that year. For Lunar Returns, it finds the first lunar return occurring</span>
</span><span id="PlanetaryReturnFactory-546"><a href="#PlanetaryReturnFactory-546"><span class="linenos">546</span></a><span class="sd">        in January of the specified year.</span>
</span><span id="PlanetaryReturnFactory-547"><a href="#PlanetaryReturnFactory-547"><span class="linenos">547</span></a>
</span><span id="PlanetaryReturnFactory-548"><a href="#PlanetaryReturnFactory-548"><span class="linenos">548</span></a><span class="sd">        The method internally uses next_return_from_iso_formatted_time() with a starting</span>
</span><span id="PlanetaryReturnFactory-549"><a href="#PlanetaryReturnFactory-549"><span class="linenos">549</span></a><span class="sd">        point of January 1st at midnight UTC for the specified year.</span>
</span><span id="PlanetaryReturnFactory-550"><a href="#PlanetaryReturnFactory-550"><span class="linenos">550</span></a>
</span><span id="PlanetaryReturnFactory-551"><a href="#PlanetaryReturnFactory-551"><span class="linenos">551</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory-552"><a href="#PlanetaryReturnFactory-552"><span class="linenos">552</span></a><span class="sd">            year (int): The calendar year to search for the return. Must be a valid</span>
</span><span id="PlanetaryReturnFactory-553"><a href="#PlanetaryReturnFactory-553"><span class="linenos">553</span></a><span class="sd">                year (typically between 1800-2200 for reliable ephemeris data).</span>
</span><span id="PlanetaryReturnFactory-554"><a href="#PlanetaryReturnFactory-554"><span class="linenos">554</span></a><span class="sd">                Examples: 2024, 2025, 1990, 2050.</span>
</span><span id="PlanetaryReturnFactory-555"><a href="#PlanetaryReturnFactory-555"><span class="linenos">555</span></a><span class="sd">            return_type (ReturnType): The type of planetary return to calculate.</span>
</span><span id="PlanetaryReturnFactory-556"><a href="#PlanetaryReturnFactory-556"><span class="linenos">556</span></a><span class="sd">                Must be either &quot;Solar&quot; for Sun returns or &quot;Lunar&quot; for Moon returns.</span>
</span><span id="PlanetaryReturnFactory-557"><a href="#PlanetaryReturnFactory-557"><span class="linenos">557</span></a>
</span><span id="PlanetaryReturnFactory-558"><a href="#PlanetaryReturnFactory-558"><span class="linenos">558</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory-559"><a href="#PlanetaryReturnFactory-559"><span class="linenos">559</span></a><span class="sd">            PlanetReturnModel: A comprehensive model containing the return chart data</span>
</span><span id="PlanetaryReturnFactory-560"><a href="#PlanetaryReturnFactory-560"><span class="linenos">560</span></a><span class="sd">                for the first return found in the specified year. Includes:</span>
</span><span id="PlanetaryReturnFactory-561"><a href="#PlanetaryReturnFactory-561"><span class="linenos">561</span></a><span class="sd">                - Exact return datetime in both UTC and local timezone</span>
</span><span id="PlanetaryReturnFactory-562"><a href="#PlanetaryReturnFactory-562"><span class="linenos">562</span></a><span class="sd">                - Complete planetary positions at the return moment</span>
</span><span id="PlanetaryReturnFactory-563"><a href="#PlanetaryReturnFactory-563"><span class="linenos">563</span></a><span class="sd">                - House cusps calculated for the factory&#39;s configured location</span>
</span><span id="PlanetaryReturnFactory-564"><a href="#PlanetaryReturnFactory-564"><span class="linenos">564</span></a><span class="sd">                - All astrological chart features and calculated points</span>
</span><span id="PlanetaryReturnFactory-565"><a href="#PlanetaryReturnFactory-565"><span class="linenos">565</span></a><span class="sd">                - Return type and subject identification</span>
</span><span id="PlanetaryReturnFactory-566"><a href="#PlanetaryReturnFactory-566"><span class="linenos">566</span></a>
</span><span id="PlanetaryReturnFactory-567"><a href="#PlanetaryReturnFactory-567"><span class="linenos">567</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory-568"><a href="#PlanetaryReturnFactory-568"><span class="linenos">568</span></a><span class="sd">            KerykeionException: If return_type is not &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory-569"><a href="#PlanetaryReturnFactory-569"><span class="linenos">569</span></a><span class="sd">            ValueError: If year is outside the valid range for ephemeris calculations.</span>
</span><span id="PlanetaryReturnFactory-570"><a href="#PlanetaryReturnFactory-570"><span class="linenos">570</span></a><span class="sd">            SwissEphException: If astronomical calculations fail for the given year.</span>
</span><span id="PlanetaryReturnFactory-571"><a href="#PlanetaryReturnFactory-571"><span class="linenos">571</span></a>
</span><span id="PlanetaryReturnFactory-572"><a href="#PlanetaryReturnFactory-572"><span class="linenos">572</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory-573"><a href="#PlanetaryReturnFactory-573"><span class="linenos">573</span></a><span class="sd">            Calculate Solar Return for 2024:</span>
</span><span id="PlanetaryReturnFactory-574"><a href="#PlanetaryReturnFactory-574"><span class="linenos">574</span></a>
</span><span id="PlanetaryReturnFactory-575"><a href="#PlanetaryReturnFactory-575"><span class="linenos">575</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(subject, ...)</span>
</span><span id="PlanetaryReturnFactory-576"><a href="#PlanetaryReturnFactory-576"><span class="linenos">576</span></a><span class="sd">            &gt;&gt;&gt; solar_return_2024 = factory.next_return_from_year(2024, &quot;Solar&quot;)</span>
</span><span id="PlanetaryReturnFactory-577"><a href="#PlanetaryReturnFactory-577"><span class="linenos">577</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;2024 Solar Return: {solar_return_2024.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory-578"><a href="#PlanetaryReturnFactory-578"><span class="linenos">578</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Birthday location: {solar_return_2024.city}, {solar_return_2024.nation}&quot;)</span>
</span><span id="PlanetaryReturnFactory-579"><a href="#PlanetaryReturnFactory-579"><span class="linenos">579</span></a>
</span><span id="PlanetaryReturnFactory-580"><a href="#PlanetaryReturnFactory-580"><span class="linenos">580</span></a><span class="sd">            Calculate first Lunar Return of 2025:</span>
</span><span id="PlanetaryReturnFactory-581"><a href="#PlanetaryReturnFactory-581"><span class="linenos">581</span></a>
</span><span id="PlanetaryReturnFactory-582"><a href="#PlanetaryReturnFactory-582"><span class="linenos">582</span></a><span class="sd">            &gt;&gt;&gt; lunar_return = factory.next_return_from_year(2025, &quot;Lunar&quot;)</span>
</span><span id="PlanetaryReturnFactory-583"><a href="#PlanetaryReturnFactory-583"><span class="linenos">583</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;First 2025 Lunar Return: {lunar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory-584"><a href="#PlanetaryReturnFactory-584"><span class="linenos">584</span></a>
</span><span id="PlanetaryReturnFactory-585"><a href="#PlanetaryReturnFactory-585"><span class="linenos">585</span></a><span class="sd">            Compare multiple years:</span>
</span><span id="PlanetaryReturnFactory-586"><a href="#PlanetaryReturnFactory-586"><span class="linenos">586</span></a>
</span><span id="PlanetaryReturnFactory-587"><a href="#PlanetaryReturnFactory-587"><span class="linenos">587</span></a><span class="sd">            &gt;&gt;&gt; for year in [2023, 2024, 2025]:</span>
</span><span id="PlanetaryReturnFactory-588"><a href="#PlanetaryReturnFactory-588"><span class="linenos">588</span></a><span class="sd">            ...     solar_return = factory.next_return_from_year(year, &quot;Solar&quot;)</span>
</span><span id="PlanetaryReturnFactory-589"><a href="#PlanetaryReturnFactory-589"><span class="linenos">589</span></a><span class="sd">            ...     print(f&quot;{year}: {solar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory-590"><a href="#PlanetaryReturnFactory-590"><span class="linenos">590</span></a>
</span><span id="PlanetaryReturnFactory-591"><a href="#PlanetaryReturnFactory-591"><span class="linenos">591</span></a><span class="sd">        Practical Applications:</span>
</span><span id="PlanetaryReturnFactory-592"><a href="#PlanetaryReturnFactory-592"><span class="linenos">592</span></a><span class="sd">            - Annual Solar Return chart casting for birthday forecasting</span>
</span><span id="PlanetaryReturnFactory-593"><a href="#PlanetaryReturnFactory-593"><span class="linenos">593</span></a><span class="sd">            - Comparative analysis of return charts across multiple years</span>
</span><span id="PlanetaryReturnFactory-594"><a href="#PlanetaryReturnFactory-594"><span class="linenos">594</span></a><span class="sd">            - Research into planetary return timing patterns</span>
</span><span id="PlanetaryReturnFactory-595"><a href="#PlanetaryReturnFactory-595"><span class="linenos">595</span></a><span class="sd">            - Automated birthday return calculations for consultation</span>
</span><span id="PlanetaryReturnFactory-596"><a href="#PlanetaryReturnFactory-596"><span class="linenos">596</span></a><span class="sd">            - Educational demonstrations of annual astrological cycles</span>
</span><span id="PlanetaryReturnFactory-597"><a href="#PlanetaryReturnFactory-597"><span class="linenos">597</span></a>
</span><span id="PlanetaryReturnFactory-598"><a href="#PlanetaryReturnFactory-598"><span class="linenos">598</span></a><span class="sd">        Technical Notes:</span>
</span><span id="PlanetaryReturnFactory-599"><a href="#PlanetaryReturnFactory-599"><span class="linenos">599</span></a><span class="sd">            - Solar returns in a given year occur near but not exactly on the birthday</span>
</span><span id="PlanetaryReturnFactory-600"><a href="#PlanetaryReturnFactory-600"><span class="linenos">600</span></a><span class="sd">            - The exact date can vary by 1-2 days due to leap years and orbital mechanics</span>
</span><span id="PlanetaryReturnFactory-601"><a href="#PlanetaryReturnFactory-601"><span class="linenos">601</span></a><span class="sd">            - Lunar returns occur approximately every 27.3 days throughout the year</span>
</span><span id="PlanetaryReturnFactory-602"><a href="#PlanetaryReturnFactory-602"><span class="linenos">602</span></a><span class="sd">            - This method finds the chronologically first return in the year</span>
</span><span id="PlanetaryReturnFactory-603"><a href="#PlanetaryReturnFactory-603"><span class="linenos">603</span></a><span class="sd">            - Return moment precision is calculated to the second</span>
</span><span id="PlanetaryReturnFactory-604"><a href="#PlanetaryReturnFactory-604"><span class="linenos">604</span></a>
</span><span id="PlanetaryReturnFactory-605"><a href="#PlanetaryReturnFactory-605"><span class="linenos">605</span></a><span class="sd">        Use Cases:</span>
</span><span id="PlanetaryReturnFactory-606"><a href="#PlanetaryReturnFactory-606"><span class="linenos">606</span></a><span class="sd">            - Birthday return chart interpretation</span>
</span><span id="PlanetaryReturnFactory-607"><a href="#PlanetaryReturnFactory-607"><span class="linenos">607</span></a><span class="sd">            - Annual astrological forecasting</span>
</span><span id="PlanetaryReturnFactory-608"><a href="#PlanetaryReturnFactory-608"><span class="linenos">608</span></a><span class="sd">            - Timing analysis for major life events</span>
</span><span id="PlanetaryReturnFactory-609"><a href="#PlanetaryReturnFactory-609"><span class="linenos">609</span></a><span class="sd">            - Comparative return chart studies</span>
</span><span id="PlanetaryReturnFactory-610"><a href="#PlanetaryReturnFactory-610"><span class="linenos">610</span></a><span class="sd">            - Astrological consultation preparation</span>
</span><span id="PlanetaryReturnFactory-611"><a href="#PlanetaryReturnFactory-611"><span class="linenos">611</span></a>
</span><span id="PlanetaryReturnFactory-612"><a href="#PlanetaryReturnFactory-612"><span class="linenos">612</span></a><span class="sd">        See Also:</span>
</span><span id="PlanetaryReturnFactory-613"><a href="#PlanetaryReturnFactory-613"><span class="linenos">613</span></a><span class="sd">            next_return_from_date(): For more specific date-based searches</span>
</span><span id="PlanetaryReturnFactory-614"><a href="#PlanetaryReturnFactory-614"><span class="linenos">614</span></a><span class="sd">            next_return_from_iso_formatted_time(): For custom starting dates</span>
</span><span id="PlanetaryReturnFactory-615"><a href="#PlanetaryReturnFactory-615"><span class="linenos">615</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-616"><a href="#PlanetaryReturnFactory-616"><span class="linenos">616</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="PlanetaryReturnFactory-617"><a href="#PlanetaryReturnFactory-617"><span class="linenos">617</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-618"><a href="#PlanetaryReturnFactory-618"><span class="linenos">618</span></a>            <span class="s2">&quot;next_return_from_year is deprecated, use next_return_from_date instead&quot;</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-619"><a href="#PlanetaryReturnFactory-619"><span class="linenos">619</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-620"><a href="#PlanetaryReturnFactory-620"><span class="linenos">620</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
</span><span id="PlanetaryReturnFactory-621"><a href="#PlanetaryReturnFactory-621"><span class="linenos">621</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-622"><a href="#PlanetaryReturnFactory-622"><span class="linenos">622</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-623"><a href="#PlanetaryReturnFactory-623"><span class="linenos">623</span></a>
</span><span id="PlanetaryReturnFactory-624"><a href="#PlanetaryReturnFactory-624"><span class="linenos">624</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_date</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-625"><a href="#PlanetaryReturnFactory-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-626"><a href="#PlanetaryReturnFactory-626"><span class="linenos">626</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-627"><a href="#PlanetaryReturnFactory-627"><span class="linenos">627</span></a>        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-628"><a href="#PlanetaryReturnFactory-628"><span class="linenos">628</span></a>        <span class="n">day</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-629"><a href="#PlanetaryReturnFactory-629"><span class="linenos">629</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-630"><a href="#PlanetaryReturnFactory-630"><span class="linenos">630</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory-631"><a href="#PlanetaryReturnFactory-631"><span class="linenos">631</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-632"><a href="#PlanetaryReturnFactory-632"><span class="linenos">632</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-633"><a href="#PlanetaryReturnFactory-633"><span class="linenos">633</span></a><span class="sd">        Calculate the first planetary return occurring on or after a specified date.</span>
</span><span id="PlanetaryReturnFactory-634"><a href="#PlanetaryReturnFactory-634"><span class="linenos">634</span></a>
</span><span id="PlanetaryReturnFactory-635"><a href="#PlanetaryReturnFactory-635"><span class="linenos">635</span></a><span class="sd">        This method provides precise timing control for planetary return calculations by</span>
</span><span id="PlanetaryReturnFactory-636"><a href="#PlanetaryReturnFactory-636"><span class="linenos">636</span></a><span class="sd">        searching from a specific day, month, and year. It&#39;s particularly useful for</span>
</span><span id="PlanetaryReturnFactory-637"><a href="#PlanetaryReturnFactory-637"><span class="linenos">637</span></a><span class="sd">        finding Lunar Returns when multiple returns occur within a single month</span>
</span><span id="PlanetaryReturnFactory-638"><a href="#PlanetaryReturnFactory-638"><span class="linenos">638</span></a><span class="sd">        (approximately every 27.3 days).</span>
</span><span id="PlanetaryReturnFactory-639"><a href="#PlanetaryReturnFactory-639"><span class="linenos">639</span></a>
</span><span id="PlanetaryReturnFactory-640"><a href="#PlanetaryReturnFactory-640"><span class="linenos">640</span></a><span class="sd">        The method searches from midnight (00:00:00 UTC) of the specified date,</span>
</span><span id="PlanetaryReturnFactory-641"><a href="#PlanetaryReturnFactory-641"><span class="linenos">641</span></a><span class="sd">        finding the next return that occurs from that point forward.</span>
</span><span id="PlanetaryReturnFactory-642"><a href="#PlanetaryReturnFactory-642"><span class="linenos">642</span></a>
</span><span id="PlanetaryReturnFactory-643"><a href="#PlanetaryReturnFactory-643"><span class="linenos">643</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory-644"><a href="#PlanetaryReturnFactory-644"><span class="linenos">644</span></a><span class="sd">            year (int): The calendar year to search within. Must be a valid year</span>
</span><span id="PlanetaryReturnFactory-645"><a href="#PlanetaryReturnFactory-645"><span class="linenos">645</span></a><span class="sd">                within the ephemeris data range (typically 1800-2200).</span>
</span><span id="PlanetaryReturnFactory-646"><a href="#PlanetaryReturnFactory-646"><span class="linenos">646</span></a><span class="sd">            month (int): The month to start the search from. Must be between 1 and 12.</span>
</span><span id="PlanetaryReturnFactory-647"><a href="#PlanetaryReturnFactory-647"><span class="linenos">647</span></a><span class="sd">            day (int): The day to start the search from. Must be a valid day for the</span>
</span><span id="PlanetaryReturnFactory-648"><a href="#PlanetaryReturnFactory-648"><span class="linenos">648</span></a><span class="sd">                specified month (1-28/29/30/31 depending on month). Defaults to 1.</span>
</span><span id="PlanetaryReturnFactory-649"><a href="#PlanetaryReturnFactory-649"><span class="linenos">649</span></a><span class="sd">            return_type (ReturnType): The type of planetary return to calculate.</span>
</span><span id="PlanetaryReturnFactory-650"><a href="#PlanetaryReturnFactory-650"><span class="linenos">650</span></a><span class="sd">                Must be either &quot;Solar&quot; for Sun returns or &quot;Lunar&quot; for Moon returns.</span>
</span><span id="PlanetaryReturnFactory-651"><a href="#PlanetaryReturnFactory-651"><span class="linenos">651</span></a>
</span><span id="PlanetaryReturnFactory-652"><a href="#PlanetaryReturnFactory-652"><span class="linenos">652</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory-653"><a href="#PlanetaryReturnFactory-653"><span class="linenos">653</span></a><span class="sd">            PlanetReturnModel: Comprehensive return chart data for the first return</span>
</span><span id="PlanetaryReturnFactory-654"><a href="#PlanetaryReturnFactory-654"><span class="linenos">654</span></a><span class="sd">                found on or after the specified date.</span>
</span><span id="PlanetaryReturnFactory-655"><a href="#PlanetaryReturnFactory-655"><span class="linenos">655</span></a>
</span><span id="PlanetaryReturnFactory-656"><a href="#PlanetaryReturnFactory-656"><span class="linenos">656</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory-657"><a href="#PlanetaryReturnFactory-657"><span class="linenos">657</span></a><span class="sd">            KerykeionException: If month is not between 1 and 12.</span>
</span><span id="PlanetaryReturnFactory-658"><a href="#PlanetaryReturnFactory-658"><span class="linenos">658</span></a><span class="sd">            KerykeionException: If day is not valid for the given month/year.</span>
</span><span id="PlanetaryReturnFactory-659"><a href="#PlanetaryReturnFactory-659"><span class="linenos">659</span></a><span class="sd">            KerykeionException: If return_type is not &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory-660"><a href="#PlanetaryReturnFactory-660"><span class="linenos">660</span></a>
</span><span id="PlanetaryReturnFactory-661"><a href="#PlanetaryReturnFactory-661"><span class="linenos">661</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory-662"><a href="#PlanetaryReturnFactory-662"><span class="linenos">662</span></a><span class="sd">            Find first Lunar Return after January 15, 2024:</span>
</span><span id="PlanetaryReturnFactory-663"><a href="#PlanetaryReturnFactory-663"><span class="linenos">663</span></a>
</span><span id="PlanetaryReturnFactory-664"><a href="#PlanetaryReturnFactory-664"><span class="linenos">664</span></a><span class="sd">            &gt;&gt;&gt; lunar_return = factory.next_return_from_date(</span>
</span><span id="PlanetaryReturnFactory-665"><a href="#PlanetaryReturnFactory-665"><span class="linenos">665</span></a><span class="sd">            ...     2024, 1, 15, return_type=&quot;Lunar&quot;</span>
</span><span id="PlanetaryReturnFactory-666"><a href="#PlanetaryReturnFactory-666"><span class="linenos">666</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory-667"><a href="#PlanetaryReturnFactory-667"><span class="linenos">667</span></a>
</span><span id="PlanetaryReturnFactory-668"><a href="#PlanetaryReturnFactory-668"><span class="linenos">668</span></a><span class="sd">            Find second Lunar Return in a month (after the first one):</span>
</span><span id="PlanetaryReturnFactory-669"><a href="#PlanetaryReturnFactory-669"><span class="linenos">669</span></a>
</span><span id="PlanetaryReturnFactory-670"><a href="#PlanetaryReturnFactory-670"><span class="linenos">670</span></a><span class="sd">            &gt;&gt;&gt; # First return from start of month</span>
</span><span id="PlanetaryReturnFactory-671"><a href="#PlanetaryReturnFactory-671"><span class="linenos">671</span></a><span class="sd">            &gt;&gt;&gt; first_lr = factory.next_return_from_date(2024, 1, 1, return_type=&quot;Lunar&quot;)</span>
</span><span id="PlanetaryReturnFactory-672"><a href="#PlanetaryReturnFactory-672"><span class="linenos">672</span></a><span class="sd">            &gt;&gt;&gt; # Second return from middle of month</span>
</span><span id="PlanetaryReturnFactory-673"><a href="#PlanetaryReturnFactory-673"><span class="linenos">673</span></a><span class="sd">            &gt;&gt;&gt; second_lr = factory.next_return_from_date(2024, 1, 15, return_type=&quot;Lunar&quot;)</span>
</span><span id="PlanetaryReturnFactory-674"><a href="#PlanetaryReturnFactory-674"><span class="linenos">674</span></a>
</span><span id="PlanetaryReturnFactory-675"><a href="#PlanetaryReturnFactory-675"><span class="linenos">675</span></a><span class="sd">        See Also:</span>
</span><span id="PlanetaryReturnFactory-676"><a href="#PlanetaryReturnFactory-676"><span class="linenos">676</span></a><span class="sd">            next_return_from_year(): For annual return calculations</span>
</span><span id="PlanetaryReturnFactory-677"><a href="#PlanetaryReturnFactory-677"><span class="linenos">677</span></a><span class="sd">            next_return_from_iso_formatted_time(): For custom datetime searches</span>
</span><span id="PlanetaryReturnFactory-678"><a href="#PlanetaryReturnFactory-678"><span class="linenos">678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-679"><a href="#PlanetaryReturnFactory-679"><span class="linenos">679</span></a>        <span class="c1"># Validate month input</span>
</span><span id="PlanetaryReturnFactory-680"><a href="#PlanetaryReturnFactory-680"><span class="linenos">680</span></a>        <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-681"><a href="#PlanetaryReturnFactory-681"><span class="linenos">681</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">. Month must be between 1 and 12.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-682"><a href="#PlanetaryReturnFactory-682"><span class="linenos">682</span></a>
</span><span id="PlanetaryReturnFactory-683"><a href="#PlanetaryReturnFactory-683"><span class="linenos">683</span></a>        <span class="c1"># Validate day input</span>
</span><span id="PlanetaryReturnFactory-684"><a href="#PlanetaryReturnFactory-684"><span class="linenos">684</span></a>        <span class="n">max_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PlanetaryReturnFactory-685"><a href="#PlanetaryReturnFactory-685"><span class="linenos">685</span></a>        <span class="k">if</span> <span class="n">day</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">day</span> <span class="o">&gt;</span> <span class="n">max_day</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-686"><a href="#PlanetaryReturnFactory-686"><span class="linenos">686</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-687"><a href="#PlanetaryReturnFactory-687"><span class="linenos">687</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid day </span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">. Day must be between 1 and </span><span class="si">{</span><span class="n">max_day</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="PlanetaryReturnFactory-688"><a href="#PlanetaryReturnFactory-688"><span class="linenos">688</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-689"><a href="#PlanetaryReturnFactory-689"><span class="linenos">689</span></a>
</span><span id="PlanetaryReturnFactory-690"><a href="#PlanetaryReturnFactory-690"><span class="linenos">690</span></a>        <span class="c1"># Create datetime for the specified date (UTC)</span>
</span><span id="PlanetaryReturnFactory-691"><a href="#PlanetaryReturnFactory-691"><span class="linenos">691</span></a>        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory-692"><a href="#PlanetaryReturnFactory-692"><span class="linenos">692</span></a>
</span><span id="PlanetaryReturnFactory-693"><a href="#PlanetaryReturnFactory-693"><span class="linenos">693</span></a>        <span class="c1"># Get the return using the existing method</span>
</span><span id="PlanetaryReturnFactory-694"><a href="#PlanetaryReturnFactory-694"><span class="linenos">694</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_return_from_iso_formatted_time</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-695"><a href="#PlanetaryReturnFactory-695"><span class="linenos">695</span></a>            <span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PlanetaryReturnFactory-696"><a href="#PlanetaryReturnFactory-696"><span class="linenos">696</span></a>            <span class="n">return_type</span>
</span><span id="PlanetaryReturnFactory-697"><a href="#PlanetaryReturnFactory-697"><span class="linenos">697</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-698"><a href="#PlanetaryReturnFactory-698"><span class="linenos">698</span></a>
</span><span id="PlanetaryReturnFactory-699"><a href="#PlanetaryReturnFactory-699"><span class="linenos">699</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_month_and_year</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-700"><a href="#PlanetaryReturnFactory-700"><span class="linenos">700</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-701"><a href="#PlanetaryReturnFactory-701"><span class="linenos">701</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-702"><a href="#PlanetaryReturnFactory-702"><span class="linenos">702</span></a>        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-703"><a href="#PlanetaryReturnFactory-703"><span class="linenos">703</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory-704"><a href="#PlanetaryReturnFactory-704"><span class="linenos">704</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory-705"><a href="#PlanetaryReturnFactory-705"><span class="linenos">705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-706"><a href="#PlanetaryReturnFactory-706"><span class="linenos">706</span></a><span class="sd">        DEPRECATED: Use next_return_from_date() instead.</span>
</span><span id="PlanetaryReturnFactory-707"><a href="#PlanetaryReturnFactory-707"><span class="linenos">707</span></a>
</span><span id="PlanetaryReturnFactory-708"><a href="#PlanetaryReturnFactory-708"><span class="linenos">708</span></a><span class="sd">        Calculate the first planetary return occurring in or after a specified month and year.</span>
</span><span id="PlanetaryReturnFactory-709"><a href="#PlanetaryReturnFactory-709"><span class="linenos">709</span></a><span class="sd">        This method is kept for backward compatibility and will be removed in a future version.</span>
</span><span id="PlanetaryReturnFactory-710"><a href="#PlanetaryReturnFactory-710"><span class="linenos">710</span></a>
</span><span id="PlanetaryReturnFactory-711"><a href="#PlanetaryReturnFactory-711"><span class="linenos">711</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory-712"><a href="#PlanetaryReturnFactory-712"><span class="linenos">712</span></a><span class="sd">            year (int): The calendar year to search within.</span>
</span><span id="PlanetaryReturnFactory-713"><a href="#PlanetaryReturnFactory-713"><span class="linenos">713</span></a><span class="sd">            month (int): The month to start the search from (1-12).</span>
</span><span id="PlanetaryReturnFactory-714"><a href="#PlanetaryReturnFactory-714"><span class="linenos">714</span></a><span class="sd">            return_type (ReturnType): &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory-715"><a href="#PlanetaryReturnFactory-715"><span class="linenos">715</span></a>
</span><span id="PlanetaryReturnFactory-716"><a href="#PlanetaryReturnFactory-716"><span class="linenos">716</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory-717"><a href="#PlanetaryReturnFactory-717"><span class="linenos">717</span></a><span class="sd">            PlanetReturnModel: Return chart data for the first return found.</span>
</span><span id="PlanetaryReturnFactory-718"><a href="#PlanetaryReturnFactory-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory-719"><a href="#PlanetaryReturnFactory-719"><span class="linenos">719</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="PlanetaryReturnFactory-720"><a href="#PlanetaryReturnFactory-720"><span class="linenos">720</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory-721"><a href="#PlanetaryReturnFactory-721"><span class="linenos">721</span></a>            <span class="s2">&quot;next_return_from_month_and_year is deprecated, use next_return_from_date instead&quot;</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-722"><a href="#PlanetaryReturnFactory-722"><span class="linenos">722</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory-723"><a href="#PlanetaryReturnFactory-723"><span class="linenos">723</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
</span><span id="PlanetaryReturnFactory-724"><a href="#PlanetaryReturnFactory-724"><span class="linenos">724</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory-725"><a href="#PlanetaryReturnFactory-725"><span class="linenos">725</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A factory class for calculating and generating planetary return charts.</p>

<p>This class specializes in computing precise planetary return moments using the Swiss
Ephemeris library and creating complete astrological charts for those calculated times.
It supports both Solar Returns (annual) and Lunar Returns (monthly), providing
comprehensive astrological analysis capabilities for timing and forecasting applications.</p>

<p>Planetary returns are fundamental concepts in predictive astrology:</p>

<ul>
<li>Solar Returns: Occur when the Sun returns to its exact natal position (~365.25 days)</li>
<li>Lunar Returns: Occur when the Moon returns to its exact natal position (~27-29 days)</li>
</ul>

<p>The factory handles complex astronomical calculations automatically, including:</p>

<ul>
<li>Precise celestial mechanics computations</li>
<li>Timezone conversions and UTC coordination</li>
<li>Location-based calculations for return chart casting</li>
<li>Integration with online geocoding services</li>
<li>Complete chart generation with all astrological points</li>
</ul>

<p>Args:
    subject (AstrologicalSubjectModel): The natal astrological subject for whom
        returns are calculated. Must contain complete birth data including
        planetary positions at birth.
    city (Optional[str]): City name for return chart location. Required when
        using online mode for location data retrieval.
    nation (Optional[str]): Nation/country code for return chart location.
        Required when using online mode (e.g., "US", "GB", "FR").
    lng (Optional[Union[int, float]]): Geographic longitude in decimal degrees
        for return chart location. Positive values for East, negative for West.
        Required when using offline mode.
    lat (Optional[Union[int, float]]): Geographic latitude in decimal degrees
        for return chart location. Positive values for North, negative for South.
        Required when using offline mode.
    tz_str (Optional[str]): Timezone identifier for return chart location
        (e.g., "America/New_York", "Europe/London", "Asia/Tokyo").
        Required when using offline mode.
    online (bool, optional): Whether to fetch location data online via Geonames
        service. When True, requires city, nation, and geonames_username.
        When False, requires lng, lat, and tz_str. Defaults to True.
    geonames_username (Optional[str]): Username for Geonames API access.
        Required when online=True and coordinates are not provided.
        Register at <a href="http://www.geonames.org/login">http://www.geonames.org/login</a> for free account.
    cache_expire_after_days (int, optional): Number of days to cache Geonames
        location data before refreshing. Defaults to system setting.
    altitude (Optional[Union[float, int]]): Elevation above sea level in meters
        for the return chart location. Reserved for future astronomical
        calculations. Defaults to None.</p>

<p>Raises:
    KerykeionException: If required location parameters are missing for the
        chosen mode (online/offline).
    KerykeionException: If Geonames API fails to retrieve location data.
    KerykeionException: If online mode is used without proper API credentials.</p>

<p>Attributes:
    subject (AstrologicalSubjectModel): The natal subject for calculations.
    city (Optional[str]): Return chart city name.
    nation (Optional[str]): Return chart nation code.
    lng (float): Return chart longitude coordinate.
    lat (float): Return chart latitude coordinate.
    tz_str (str): Return chart timezone identifier.
    online (bool): Location data retrieval mode.
    city_data (Optional[dict]): Cached location data from Geonames.</p>

<p>Examples:
    Online mode with automatic location lookup:</p>

<pre><code>&gt;&gt;&gt; subject = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(
...     name="Alice", year=1985, month=3, day=21,
...     hour=14, minute=30, lat=51.5074, lng=-0.1278,
...     tz_str="Europe/London"
... )
&gt;&gt;&gt; factory = PlanetaryReturnFactory(
...     subject,
...     city="London",
...     nation="GB",
...     online=True,
...     geonames_username="your_username"
... )

Offline mode with manual coordinates:

&gt;&gt;&gt; factory = PlanetaryReturnFactory(
...     subject,
...     lng=-74.0060,
...     lat=40.7128,
...     tz_str="America/New_York",
...     online=False
... )

Different location for return chart:

&gt;&gt;&gt; # Calculate return as if living in a different city
&gt;&gt;&gt; factory = PlanetaryReturnFactory(
...     natal_subject,  # Born in London
...     city="Paris",   # But living in Paris
...     nation="FR",
...     online=True
... )
</code></pre>

<p>Use Cases:
    - Annual Solar Return charts for yearly forecasting
    - Monthly Lunar Return charts for timing analysis
    - Relocation returns for different geographic locations
    - Research into planetary cycle effects
    - Astrological consultation and chart analysis
    - Educational demonstrations of celestial mechanics</p>

<p>Note:
    Return calculations use the exact degree and minute of natal planetary
    positions. The resulting charts are cast for the precise moment when
    the transiting planet reaches this position, which may not align with
    calendar dates (especially for Solar Returns, which can occur on
    different dates depending on leap years and location).</p>
</div>


                            <div id="PlanetaryReturnFactory.__init__" class="classattr">
                                        <input id="PlanetaryReturnFactory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PlanetaryReturnFactory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">altitude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="PlanetaryReturnFactory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetaryReturnFactory.__init__-208"><a href="#PlanetaryReturnFactory.__init__-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.__init__-209"><a href="#PlanetaryReturnFactory.__init__-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-210"><a href="#PlanetaryReturnFactory.__init__-210"><span class="linenos">210</span></a>            <span class="n">subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-211"><a href="#PlanetaryReturnFactory.__init__-211"><span class="linenos">211</span></a>            <span class="n">city</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-212"><a href="#PlanetaryReturnFactory.__init__-212"><span class="linenos">212</span></a>            <span class="n">nation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-213"><a href="#PlanetaryReturnFactory.__init__-213"><span class="linenos">213</span></a>            <span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-214"><a href="#PlanetaryReturnFactory.__init__-214"><span class="linenos">214</span></a>            <span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-215"><a href="#PlanetaryReturnFactory.__init__-215"><span class="linenos">215</span></a>            <span class="n">tz_str</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-216"><a href="#PlanetaryReturnFactory.__init__-216"><span class="linenos">216</span></a>            <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-217"><a href="#PlanetaryReturnFactory.__init__-217"><span class="linenos">217</span></a>            <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-218"><a href="#PlanetaryReturnFactory.__init__-218"><span class="linenos">218</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-219"><a href="#PlanetaryReturnFactory.__init__-219"><span class="linenos">219</span></a>            <span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-220"><a href="#PlanetaryReturnFactory.__init__-220"><span class="linenos">220</span></a>            <span class="n">altitude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-221"><a href="#PlanetaryReturnFactory.__init__-221"><span class="linenos">221</span></a>        <span class="p">):</span>
</span><span id="PlanetaryReturnFactory.__init__-222"><a href="#PlanetaryReturnFactory.__init__-222"><span class="linenos">222</span></a>
</span><span id="PlanetaryReturnFactory.__init__-223"><a href="#PlanetaryReturnFactory.__init__-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.__init__-224"><a href="#PlanetaryReturnFactory.__init__-224"><span class="linenos">224</span></a><span class="sd">        Initialize a PlanetaryReturnFactory instance with location and configuration settings.</span>
</span><span id="PlanetaryReturnFactory.__init__-225"><a href="#PlanetaryReturnFactory.__init__-225"><span class="linenos">225</span></a>
</span><span id="PlanetaryReturnFactory.__init__-226"><a href="#PlanetaryReturnFactory.__init__-226"><span class="linenos">226</span></a><span class="sd">        This constructor sets up the factory with all necessary parameters for calculating</span>
</span><span id="PlanetaryReturnFactory.__init__-227"><a href="#PlanetaryReturnFactory.__init__-227"><span class="linenos">227</span></a><span class="sd">        planetary returns at a specified location. It supports both online mode (with</span>
</span><span id="PlanetaryReturnFactory.__init__-228"><a href="#PlanetaryReturnFactory.__init__-228"><span class="linenos">228</span></a><span class="sd">        automatic geocoding via Geonames) and offline mode (with manual coordinates).</span>
</span><span id="PlanetaryReturnFactory.__init__-229"><a href="#PlanetaryReturnFactory.__init__-229"><span class="linenos">229</span></a>
</span><span id="PlanetaryReturnFactory.__init__-230"><a href="#PlanetaryReturnFactory.__init__-230"><span class="linenos">230</span></a><span class="sd">        The factory validates input parameters based on the chosen mode and automatically</span>
</span><span id="PlanetaryReturnFactory.__init__-231"><a href="#PlanetaryReturnFactory.__init__-231"><span class="linenos">231</span></a><span class="sd">        retrieves missing location data when operating online. All location parameters</span>
</span><span id="PlanetaryReturnFactory.__init__-232"><a href="#PlanetaryReturnFactory.__init__-232"><span class="linenos">232</span></a><span class="sd">        are stored and used for casting return charts at the exact calculated moments.</span>
</span><span id="PlanetaryReturnFactory.__init__-233"><a href="#PlanetaryReturnFactory.__init__-233"><span class="linenos">233</span></a>
</span><span id="PlanetaryReturnFactory.__init__-234"><a href="#PlanetaryReturnFactory.__init__-234"><span class="linenos">234</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory.__init__-235"><a href="#PlanetaryReturnFactory.__init__-235"><span class="linenos">235</span></a><span class="sd">            subject (AstrologicalSubjectModel): The natal astrological subject containing</span>
</span><span id="PlanetaryReturnFactory.__init__-236"><a href="#PlanetaryReturnFactory.__init__-236"><span class="linenos">236</span></a><span class="sd">                birth data and planetary positions. This subject&#39;s natal planetary</span>
</span><span id="PlanetaryReturnFactory.__init__-237"><a href="#PlanetaryReturnFactory.__init__-237"><span class="linenos">237</span></a><span class="sd">                positions serve as reference points for calculating returns.</span>
</span><span id="PlanetaryReturnFactory.__init__-238"><a href="#PlanetaryReturnFactory.__init__-238"><span class="linenos">238</span></a><span class="sd">            city (Optional[str]): City name for the return chart location. Must be a</span>
</span><span id="PlanetaryReturnFactory.__init__-239"><a href="#PlanetaryReturnFactory.__init__-239"><span class="linenos">239</span></a><span class="sd">                recognizable city name for Geonames geocoding when using online mode.</span>
</span><span id="PlanetaryReturnFactory.__init__-240"><a href="#PlanetaryReturnFactory.__init__-240"><span class="linenos">240</span></a><span class="sd">                Examples: &quot;New York&quot;, &quot;London&quot;, &quot;Tokyo&quot;, &quot;Paris&quot;.</span>
</span><span id="PlanetaryReturnFactory.__init__-241"><a href="#PlanetaryReturnFactory.__init__-241"><span class="linenos">241</span></a><span class="sd">            nation (Optional[str]): Country or nation code for the return chart location.</span>
</span><span id="PlanetaryReturnFactory.__init__-242"><a href="#PlanetaryReturnFactory.__init__-242"><span class="linenos">242</span></a><span class="sd">                Use ISO country codes for best results (e.g., &quot;US&quot;, &quot;GB&quot;, &quot;JP&quot;, &quot;FR&quot;).</span>
</span><span id="PlanetaryReturnFactory.__init__-243"><a href="#PlanetaryReturnFactory.__init__-243"><span class="linenos">243</span></a><span class="sd">                Required when online=True.</span>
</span><span id="PlanetaryReturnFactory.__init__-244"><a href="#PlanetaryReturnFactory.__init__-244"><span class="linenos">244</span></a><span class="sd">            lng (Optional[Union[int, float]]): Geographic longitude coordinate in decimal</span>
</span><span id="PlanetaryReturnFactory.__init__-245"><a href="#PlanetaryReturnFactory.__init__-245"><span class="linenos">245</span></a><span class="sd">                degrees for return chart location. Range: -180.0 to +180.0.</span>
</span><span id="PlanetaryReturnFactory.__init__-246"><a href="#PlanetaryReturnFactory.__init__-246"><span class="linenos">246</span></a><span class="sd">                Positive values represent East longitude, negative values West longitude.</span>
</span><span id="PlanetaryReturnFactory.__init__-247"><a href="#PlanetaryReturnFactory.__init__-247"><span class="linenos">247</span></a><span class="sd">                Required when online=False.</span>
</span><span id="PlanetaryReturnFactory.__init__-248"><a href="#PlanetaryReturnFactory.__init__-248"><span class="linenos">248</span></a><span class="sd">            lat (Optional[Union[int, float]]): Geographic latitude coordinate in decimal</span>
</span><span id="PlanetaryReturnFactory.__init__-249"><a href="#PlanetaryReturnFactory.__init__-249"><span class="linenos">249</span></a><span class="sd">                degrees for return chart location. Range: -90.0 to +90.0.</span>
</span><span id="PlanetaryReturnFactory.__init__-250"><a href="#PlanetaryReturnFactory.__init__-250"><span class="linenos">250</span></a><span class="sd">                Positive values represent North latitude, negative values South latitude.</span>
</span><span id="PlanetaryReturnFactory.__init__-251"><a href="#PlanetaryReturnFactory.__init__-251"><span class="linenos">251</span></a><span class="sd">                Required when online=False.</span>
</span><span id="PlanetaryReturnFactory.__init__-252"><a href="#PlanetaryReturnFactory.__init__-252"><span class="linenos">252</span></a><span class="sd">            tz_str (Optional[str]): Timezone identifier string for return chart location.</span>
</span><span id="PlanetaryReturnFactory.__init__-253"><a href="#PlanetaryReturnFactory.__init__-253"><span class="linenos">253</span></a><span class="sd">                Must be a valid timezone from the IANA Time Zone Database</span>
</span><span id="PlanetaryReturnFactory.__init__-254"><a href="#PlanetaryReturnFactory.__init__-254"><span class="linenos">254</span></a><span class="sd">                (e.g., &quot;America/New_York&quot;, &quot;Europe/London&quot;, &quot;Asia/Tokyo&quot;).</span>
</span><span id="PlanetaryReturnFactory.__init__-255"><a href="#PlanetaryReturnFactory.__init__-255"><span class="linenos">255</span></a><span class="sd">                Required when online=False.</span>
</span><span id="PlanetaryReturnFactory.__init__-256"><a href="#PlanetaryReturnFactory.__init__-256"><span class="linenos">256</span></a><span class="sd">            online (bool, optional): Location data retrieval mode. When True, uses</span>
</span><span id="PlanetaryReturnFactory.__init__-257"><a href="#PlanetaryReturnFactory.__init__-257"><span class="linenos">257</span></a><span class="sd">                Geonames web service to automatically fetch coordinates and timezone</span>
</span><span id="PlanetaryReturnFactory.__init__-258"><a href="#PlanetaryReturnFactory.__init__-258"><span class="linenos">258</span></a><span class="sd">                from city/nation parameters. When False, uses manually provided</span>
</span><span id="PlanetaryReturnFactory.__init__-259"><a href="#PlanetaryReturnFactory.__init__-259"><span class="linenos">259</span></a><span class="sd">                coordinates and timezone. Defaults to True.</span>
</span><span id="PlanetaryReturnFactory.__init__-260"><a href="#PlanetaryReturnFactory.__init__-260"><span class="linenos">260</span></a><span class="sd">            geonames_username (Optional[str]): Username for Geonames API access.</span>
</span><span id="PlanetaryReturnFactory.__init__-261"><a href="#PlanetaryReturnFactory.__init__-261"><span class="linenos">261</span></a><span class="sd">                Required when online=True and coordinates are not manually provided.</span>
</span><span id="PlanetaryReturnFactory.__init__-262"><a href="#PlanetaryReturnFactory.__init__-262"><span class="linenos">262</span></a><span class="sd">                Free accounts available at http://www.geonames.org/login.</span>
</span><span id="PlanetaryReturnFactory.__init__-263"><a href="#PlanetaryReturnFactory.__init__-263"><span class="linenos">263</span></a><span class="sd">                If None and required, uses default username with warning.</span>
</span><span id="PlanetaryReturnFactory.__init__-264"><a href="#PlanetaryReturnFactory.__init__-264"><span class="linenos">264</span></a><span class="sd">            cache_expire_after_days (int, optional): Number of days to cache Geonames</span>
</span><span id="PlanetaryReturnFactory.__init__-265"><a href="#PlanetaryReturnFactory.__init__-265"><span class="linenos">265</span></a><span class="sd">                location data locally before requiring refresh. Helps reduce API</span>
</span><span id="PlanetaryReturnFactory.__init__-266"><a href="#PlanetaryReturnFactory.__init__-266"><span class="linenos">266</span></a><span class="sd">                calls and improve performance for repeated calculations.</span>
</span><span id="PlanetaryReturnFactory.__init__-267"><a href="#PlanetaryReturnFactory.__init__-267"><span class="linenos">267</span></a><span class="sd">                Defaults to system configuration value.</span>
</span><span id="PlanetaryReturnFactory.__init__-268"><a href="#PlanetaryReturnFactory.__init__-268"><span class="linenos">268</span></a><span class="sd">            altitude (Optional[Union[float, int]]): Elevation above sea level in meters</span>
</span><span id="PlanetaryReturnFactory.__init__-269"><a href="#PlanetaryReturnFactory.__init__-269"><span class="linenos">269</span></a><span class="sd">                for the return chart location. Currently reserved for future use in</span>
</span><span id="PlanetaryReturnFactory.__init__-270"><a href="#PlanetaryReturnFactory.__init__-270"><span class="linenos">270</span></a><span class="sd">                advanced astronomical calculations. Defaults to None.</span>
</span><span id="PlanetaryReturnFactory.__init__-271"><a href="#PlanetaryReturnFactory.__init__-271"><span class="linenos">271</span></a>
</span><span id="PlanetaryReturnFactory.__init__-272"><a href="#PlanetaryReturnFactory.__init__-272"><span class="linenos">272</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory.__init__-273"><a href="#PlanetaryReturnFactory.__init__-273"><span class="linenos">273</span></a><span class="sd">            KerykeionException: If city is not provided when online=True.</span>
</span><span id="PlanetaryReturnFactory.__init__-274"><a href="#PlanetaryReturnFactory.__init__-274"><span class="linenos">274</span></a><span class="sd">            KerykeionException: If nation is not provided when online=True.</span>
</span><span id="PlanetaryReturnFactory.__init__-275"><a href="#PlanetaryReturnFactory.__init__-275"><span class="linenos">275</span></a><span class="sd">            KerykeionException: If coordinates (lat/lng) are not provided when online=False.</span>
</span><span id="PlanetaryReturnFactory.__init__-276"><a href="#PlanetaryReturnFactory.__init__-276"><span class="linenos">276</span></a><span class="sd">            KerykeionException: If timezone (tz_str) is not provided when online=False.</span>
</span><span id="PlanetaryReturnFactory.__init__-277"><a href="#PlanetaryReturnFactory.__init__-277"><span class="linenos">277</span></a><span class="sd">            KerykeionException: If Geonames API fails to retrieve valid location data.</span>
</span><span id="PlanetaryReturnFactory.__init__-278"><a href="#PlanetaryReturnFactory.__init__-278"><span class="linenos">278</span></a><span class="sd">            KerykeionException: If required parameters are missing for the chosen mode.</span>
</span><span id="PlanetaryReturnFactory.__init__-279"><a href="#PlanetaryReturnFactory.__init__-279"><span class="linenos">279</span></a>
</span><span id="PlanetaryReturnFactory.__init__-280"><a href="#PlanetaryReturnFactory.__init__-280"><span class="linenos">280</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory.__init__-281"><a href="#PlanetaryReturnFactory.__init__-281"><span class="linenos">281</span></a><span class="sd">            Initialize with online geocoding:</span>
</span><span id="PlanetaryReturnFactory.__init__-282"><a href="#PlanetaryReturnFactory.__init__-282"><span class="linenos">282</span></a>
</span><span id="PlanetaryReturnFactory.__init__-283"><a href="#PlanetaryReturnFactory.__init__-283"><span class="linenos">283</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory.__init__-284"><a href="#PlanetaryReturnFactory.__init__-284"><span class="linenos">284</span></a><span class="sd">            ...     subject,</span>
</span><span id="PlanetaryReturnFactory.__init__-285"><a href="#PlanetaryReturnFactory.__init__-285"><span class="linenos">285</span></a><span class="sd">            ...     city=&quot;San Francisco&quot;,</span>
</span><span id="PlanetaryReturnFactory.__init__-286"><a href="#PlanetaryReturnFactory.__init__-286"><span class="linenos">286</span></a><span class="sd">            ...     nation=&quot;US&quot;,</span>
</span><span id="PlanetaryReturnFactory.__init__-287"><a href="#PlanetaryReturnFactory.__init__-287"><span class="linenos">287</span></a><span class="sd">            ...     online=True,</span>
</span><span id="PlanetaryReturnFactory.__init__-288"><a href="#PlanetaryReturnFactory.__init__-288"><span class="linenos">288</span></a><span class="sd">            ...     geonames_username=&quot;your_username&quot;</span>
</span><span id="PlanetaryReturnFactory.__init__-289"><a href="#PlanetaryReturnFactory.__init__-289"><span class="linenos">289</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.__init__-290"><a href="#PlanetaryReturnFactory.__init__-290"><span class="linenos">290</span></a>
</span><span id="PlanetaryReturnFactory.__init__-291"><a href="#PlanetaryReturnFactory.__init__-291"><span class="linenos">291</span></a><span class="sd">            Initialize with manual coordinates:</span>
</span><span id="PlanetaryReturnFactory.__init__-292"><a href="#PlanetaryReturnFactory.__init__-292"><span class="linenos">292</span></a>
</span><span id="PlanetaryReturnFactory.__init__-293"><a href="#PlanetaryReturnFactory.__init__-293"><span class="linenos">293</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory.__init__-294"><a href="#PlanetaryReturnFactory.__init__-294"><span class="linenos">294</span></a><span class="sd">            ...     subject,</span>
</span><span id="PlanetaryReturnFactory.__init__-295"><a href="#PlanetaryReturnFactory.__init__-295"><span class="linenos">295</span></a><span class="sd">            ...     lng=-122.4194,</span>
</span><span id="PlanetaryReturnFactory.__init__-296"><a href="#PlanetaryReturnFactory.__init__-296"><span class="linenos">296</span></a><span class="sd">            ...     lat=37.7749,</span>
</span><span id="PlanetaryReturnFactory.__init__-297"><a href="#PlanetaryReturnFactory.__init__-297"><span class="linenos">297</span></a><span class="sd">            ...     tz_str=&quot;America/Los_Angeles&quot;,</span>
</span><span id="PlanetaryReturnFactory.__init__-298"><a href="#PlanetaryReturnFactory.__init__-298"><span class="linenos">298</span></a><span class="sd">            ...     online=False</span>
</span><span id="PlanetaryReturnFactory.__init__-299"><a href="#PlanetaryReturnFactory.__init__-299"><span class="linenos">299</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.__init__-300"><a href="#PlanetaryReturnFactory.__init__-300"><span class="linenos">300</span></a>
</span><span id="PlanetaryReturnFactory.__init__-301"><a href="#PlanetaryReturnFactory.__init__-301"><span class="linenos">301</span></a><span class="sd">            Initialize with mixed parameters (coordinates override online lookup):</span>
</span><span id="PlanetaryReturnFactory.__init__-302"><a href="#PlanetaryReturnFactory.__init__-302"><span class="linenos">302</span></a>
</span><span id="PlanetaryReturnFactory.__init__-303"><a href="#PlanetaryReturnFactory.__init__-303"><span class="linenos">303</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(</span>
</span><span id="PlanetaryReturnFactory.__init__-304"><a href="#PlanetaryReturnFactory.__init__-304"><span class="linenos">304</span></a><span class="sd">            ...     subject,</span>
</span><span id="PlanetaryReturnFactory.__init__-305"><a href="#PlanetaryReturnFactory.__init__-305"><span class="linenos">305</span></a><span class="sd">            ...     city=&quot;Custom Location&quot;,</span>
</span><span id="PlanetaryReturnFactory.__init__-306"><a href="#PlanetaryReturnFactory.__init__-306"><span class="linenos">306</span></a><span class="sd">            ...     lng=-74.0060,</span>
</span><span id="PlanetaryReturnFactory.__init__-307"><a href="#PlanetaryReturnFactory.__init__-307"><span class="linenos">307</span></a><span class="sd">            ...     lat=40.7128,</span>
</span><span id="PlanetaryReturnFactory.__init__-308"><a href="#PlanetaryReturnFactory.__init__-308"><span class="linenos">308</span></a><span class="sd">            ...     tz_str=&quot;America/New_York&quot;,</span>
</span><span id="PlanetaryReturnFactory.__init__-309"><a href="#PlanetaryReturnFactory.__init__-309"><span class="linenos">309</span></a><span class="sd">            ...     online=False</span>
</span><span id="PlanetaryReturnFactory.__init__-310"><a href="#PlanetaryReturnFactory.__init__-310"><span class="linenos">310</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.__init__-311"><a href="#PlanetaryReturnFactory.__init__-311"><span class="linenos">311</span></a>
</span><span id="PlanetaryReturnFactory.__init__-312"><a href="#PlanetaryReturnFactory.__init__-312"><span class="linenos">312</span></a><span class="sd">        Note:</span>
</span><span id="PlanetaryReturnFactory.__init__-313"><a href="#PlanetaryReturnFactory.__init__-313"><span class="linenos">313</span></a><span class="sd">            - When both online and manual coordinates are provided, offline mode takes precedence</span>
</span><span id="PlanetaryReturnFactory.__init__-314"><a href="#PlanetaryReturnFactory.__init__-314"><span class="linenos">314</span></a><span class="sd">            - Geonames cache helps reduce API calls for frequently used locations</span>
</span><span id="PlanetaryReturnFactory.__init__-315"><a href="#PlanetaryReturnFactory.__init__-315"><span class="linenos">315</span></a><span class="sd">            - Timezone accuracy is crucial for precise return calculations</span>
</span><span id="PlanetaryReturnFactory.__init__-316"><a href="#PlanetaryReturnFactory.__init__-316"><span class="linenos">316</span></a><span class="sd">            - Location parameters affect house cusps and angular positions in return charts</span>
</span><span id="PlanetaryReturnFactory.__init__-317"><a href="#PlanetaryReturnFactory.__init__-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.__init__-318"><a href="#PlanetaryReturnFactory.__init__-318"><span class="linenos">318</span></a>        <span class="c1"># Store basic configuration</span>
</span><span id="PlanetaryReturnFactory.__init__-319"><a href="#PlanetaryReturnFactory.__init__-319"><span class="linenos">319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>
</span><span id="PlanetaryReturnFactory.__init__-320"><a href="#PlanetaryReturnFactory.__init__-320"><span class="linenos">320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">online</span> <span class="o">=</span> <span class="n">online</span>
</span><span id="PlanetaryReturnFactory.__init__-321"><a href="#PlanetaryReturnFactory.__init__-321"><span class="linenos">321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_expire_after_days</span> <span class="o">=</span> <span class="n">cache_expire_after_days</span>
</span><span id="PlanetaryReturnFactory.__init__-322"><a href="#PlanetaryReturnFactory.__init__-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span>
</span><span id="PlanetaryReturnFactory.__init__-323"><a href="#PlanetaryReturnFactory.__init__-323"><span class="linenos">323</span></a>
</span><span id="PlanetaryReturnFactory.__init__-324"><a href="#PlanetaryReturnFactory.__init__-324"><span class="linenos">324</span></a>        <span class="c1"># Geonames username</span>
</span><span id="PlanetaryReturnFactory.__init__-325"><a href="#PlanetaryReturnFactory.__init__-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="n">geonames_username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">online</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lat</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lng</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tz_str</span><span class="p">):</span>
</span><span id="PlanetaryReturnFactory.__init__-326"><a href="#PlanetaryReturnFactory.__init__-326"><span class="linenos">326</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-327"><a href="#PlanetaryReturnFactory.__init__-327"><span class="linenos">327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span> <span class="o">=</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span>
</span><span id="PlanetaryReturnFactory.__init__-328"><a href="#PlanetaryReturnFactory.__init__-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-329"><a href="#PlanetaryReturnFactory.__init__-329"><span class="linenos">329</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span> <span class="o">=</span> <span class="n">geonames_username</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.__init__-330"><a href="#PlanetaryReturnFactory.__init__-330"><span class="linenos">330</span></a>
</span><span id="PlanetaryReturnFactory.__init__-331"><a href="#PlanetaryReturnFactory.__init__-331"><span class="linenos">331</span></a>        <span class="c1"># City</span>
</span><span id="PlanetaryReturnFactory.__init__-332"><a href="#PlanetaryReturnFactory.__init__-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">city</span> <span class="ow">and</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-333"><a href="#PlanetaryReturnFactory.__init__-333"><span class="linenos">333</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the city if you want to use the online mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-334"><a href="#PlanetaryReturnFactory.__init__-334"><span class="linenos">334</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-335"><a href="#PlanetaryReturnFactory.__init__-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
</span><span id="PlanetaryReturnFactory.__init__-336"><a href="#PlanetaryReturnFactory.__init__-336"><span class="linenos">336</span></a>
</span><span id="PlanetaryReturnFactory.__init__-337"><a href="#PlanetaryReturnFactory.__init__-337"><span class="linenos">337</span></a>        <span class="c1"># Nation</span>
</span><span id="PlanetaryReturnFactory.__init__-338"><a href="#PlanetaryReturnFactory.__init__-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">nation</span> <span class="ow">and</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-339"><a href="#PlanetaryReturnFactory.__init__-339"><span class="linenos">339</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the nation if you want to use the online mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-340"><a href="#PlanetaryReturnFactory.__init__-340"><span class="linenos">340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-341"><a href="#PlanetaryReturnFactory.__init__-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nation</span> <span class="o">=</span> <span class="n">nation</span>
</span><span id="PlanetaryReturnFactory.__init__-342"><a href="#PlanetaryReturnFactory.__init__-342"><span class="linenos">342</span></a>
</span><span id="PlanetaryReturnFactory.__init__-343"><a href="#PlanetaryReturnFactory.__init__-343"><span class="linenos">343</span></a>        <span class="c1"># Latitude</span>
</span><span id="PlanetaryReturnFactory.__init__-344"><a href="#PlanetaryReturnFactory.__init__-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lat</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-345"><a href="#PlanetaryReturnFactory.__init__-345"><span class="linenos">345</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the coordinates and timezone if you want to use the offline mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-346"><a href="#PlanetaryReturnFactory.__init__-346"><span class="linenos">346</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-347"><a href="#PlanetaryReturnFactory.__init__-347"><span class="linenos">347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.__init__-348"><a href="#PlanetaryReturnFactory.__init__-348"><span class="linenos">348</span></a>
</span><span id="PlanetaryReturnFactory.__init__-349"><a href="#PlanetaryReturnFactory.__init__-349"><span class="linenos">349</span></a>        <span class="c1"># Longitude</span>
</span><span id="PlanetaryReturnFactory.__init__-350"><a href="#PlanetaryReturnFactory.__init__-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lng</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">online</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-351"><a href="#PlanetaryReturnFactory.__init__-351"><span class="linenos">351</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the coordinates and timezone if you want to use the offline mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-352"><a href="#PlanetaryReturnFactory.__init__-352"><span class="linenos">352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-353"><a href="#PlanetaryReturnFactory.__init__-353"><span class="linenos">353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="n">lng</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.__init__-354"><a href="#PlanetaryReturnFactory.__init__-354"><span class="linenos">354</span></a>
</span><span id="PlanetaryReturnFactory.__init__-355"><a href="#PlanetaryReturnFactory.__init__-355"><span class="linenos">355</span></a>        <span class="c1"># Timezone</span>
</span><span id="PlanetaryReturnFactory.__init__-356"><a href="#PlanetaryReturnFactory.__init__-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">online</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">tz_str</span><span class="p">):</span>
</span><span id="PlanetaryReturnFactory.__init__-357"><a href="#PlanetaryReturnFactory.__init__-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the coordinates and timezone if you want to use the offline mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-358"><a href="#PlanetaryReturnFactory.__init__-358"><span class="linenos">358</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-359"><a href="#PlanetaryReturnFactory.__init__-359"><span class="linenos">359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span> <span class="o">=</span> <span class="n">tz_str</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.__init__-360"><a href="#PlanetaryReturnFactory.__init__-360"><span class="linenos">360</span></a>
</span><span id="PlanetaryReturnFactory.__init__-361"><a href="#PlanetaryReturnFactory.__init__-361"><span class="linenos">361</span></a>        <span class="c1"># Online mode</span>
</span><span id="PlanetaryReturnFactory.__init__-362"><a href="#PlanetaryReturnFactory.__init__-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">online</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">):</span>
</span><span id="PlanetaryReturnFactory.__init__-363"><a href="#PlanetaryReturnFactory.__init__-363"><span class="linenos">363</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetching timezone/coordinates from geonames&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-364"><a href="#PlanetaryReturnFactory.__init__-364"><span class="linenos">364</span></a>
</span><span id="PlanetaryReturnFactory.__init__-365"><a href="#PlanetaryReturnFactory.__init__-365"><span class="linenos">365</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nation</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.__init__-366"><a href="#PlanetaryReturnFactory.__init__-366"><span class="linenos">366</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;You need to set the city and nation if you want to use the online mode!&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-367"><a href="#PlanetaryReturnFactory.__init__-367"><span class="linenos">367</span></a>
</span><span id="PlanetaryReturnFactory.__init__-368"><a href="#PlanetaryReturnFactory.__init__-368"><span class="linenos">368</span></a>            <span class="n">geonames</span> <span class="o">=</span> <span class="n">FetchGeonames</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.__init__-369"><a href="#PlanetaryReturnFactory.__init__-369"><span class="linenos">369</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-370"><a href="#PlanetaryReturnFactory.__init__-370"><span class="linenos">370</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nation</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-371"><a href="#PlanetaryReturnFactory.__init__-371"><span class="linenos">371</span></a>                <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.__init__-372"><a href="#PlanetaryReturnFactory.__init__-372"><span class="linenos">372</span></a>                <span class="n">cache_expire_after_days</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_expire_after_days</span>
</span><span id="PlanetaryReturnFactory.__init__-373"><a href="#PlanetaryReturnFactory.__init__-373"><span class="linenos">373</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-374"><a href="#PlanetaryReturnFactory.__init__-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">geonames</span><span class="o">.</span><span class="n">get_serialized_data</span><span class="p">()</span>
</span><span id="PlanetaryReturnFactory.__init__-375"><a href="#PlanetaryReturnFactory.__init__-375"><span class="linenos">375</span></a>
</span><span id="PlanetaryReturnFactory.__init__-376"><a href="#PlanetaryReturnFactory.__init__-376"><span class="linenos">376</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="PlanetaryReturnFactory.__init__-377"><a href="#PlanetaryReturnFactory.__init__-377"><span class="linenos">377</span></a>                <span class="s2">&quot;countryCode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory.__init__-378"><a href="#PlanetaryReturnFactory.__init__-378"><span class="linenos">378</span></a>                <span class="ow">or</span> <span class="s2">&quot;timezonestr&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory.__init__-379"><a href="#PlanetaryReturnFactory.__init__-379"><span class="linenos">379</span></a>                <span class="ow">or</span> <span class="s2">&quot;lat&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory.__init__-380"><a href="#PlanetaryReturnFactory.__init__-380"><span class="linenos">380</span></a>                <span class="ow">or</span> <span class="s2">&quot;lng&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span>
</span><span id="PlanetaryReturnFactory.__init__-381"><a href="#PlanetaryReturnFactory.__init__-381"><span class="linenos">381</span></a>            <span class="p">):</span>
</span><span id="PlanetaryReturnFactory.__init__-382"><a href="#PlanetaryReturnFactory.__init__-382"><span class="linenos">382</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;No data found for this city, try again! Maybe check your connection?&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.__init__-383"><a href="#PlanetaryReturnFactory.__init__-383"><span class="linenos">383</span></a>
</span><span id="PlanetaryReturnFactory.__init__-384"><a href="#PlanetaryReturnFactory.__init__-384"><span class="linenos">384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;countryCode&quot;</span><span class="p">]</span>
</span><span id="PlanetaryReturnFactory.__init__-385"><a href="#PlanetaryReturnFactory.__init__-385"><span class="linenos">385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">])</span>
</span><span id="PlanetaryReturnFactory.__init__-386"><a href="#PlanetaryReturnFactory.__init__-386"><span class="linenos">386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">])</span>
</span><span id="PlanetaryReturnFactory.__init__-387"><a href="#PlanetaryReturnFactory.__init__-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_data</span><span class="p">[</span><span class="s2">&quot;timezonestr&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a PlanetaryReturnFactory instance with location and configuration settings.</p>

<p>This constructor sets up the factory with all necessary parameters for calculating
planetary returns at a specified location. It supports both online mode (with
automatic geocoding via Geonames) and offline mode (with manual coordinates).</p>

<p>The factory validates input parameters based on the chosen mode and automatically
retrieves missing location data when operating online. All location parameters
are stored and used for casting return charts at the exact calculated moments.</p>

<p>Args:
    subject (AstrologicalSubjectModel): The natal astrological subject containing
        birth data and planetary positions. This subject's natal planetary
        positions serve as reference points for calculating returns.
    city (Optional[str]): City name for the return chart location. Must be a
        recognizable city name for Geonames geocoding when using online mode.
        Examples: "New York", "London", "Tokyo", "Paris".
    nation (Optional[str]): Country or nation code for the return chart location.
        Use ISO country codes for best results (e.g., "US", "GB", "JP", "FR").
        Required when online=True.
    lng (Optional[Union[int, float]]): Geographic longitude coordinate in decimal
        degrees for return chart location. Range: -180.0 to +180.0.
        Positive values represent East longitude, negative values West longitude.
        Required when online=False.
    lat (Optional[Union[int, float]]): Geographic latitude coordinate in decimal
        degrees for return chart location. Range: -90.0 to +90.0.
        Positive values represent North latitude, negative values South latitude.
        Required when online=False.
    tz_str (Optional[str]): Timezone identifier string for return chart location.
        Must be a valid timezone from the IANA Time Zone Database
        (e.g., "America/New_York", "Europe/London", "Asia/Tokyo").
        Required when online=False.
    online (bool, optional): Location data retrieval mode. When True, uses
        Geonames web service to automatically fetch coordinates and timezone
        from city/nation parameters. When False, uses manually provided
        coordinates and timezone. Defaults to True.
    geonames_username (Optional[str]): Username for Geonames API access.
        Required when online=True and coordinates are not manually provided.
        Free accounts available at <a href="http://www.geonames.org/login">http://www.geonames.org/login</a>.
        If None and required, uses default username with warning.
    cache_expire_after_days (int, optional): Number of days to cache Geonames
        location data locally before requiring refresh. Helps reduce API
        calls and improve performance for repeated calculations.
        Defaults to system configuration value.
    altitude (Optional[Union[float, int]]): Elevation above sea level in meters
        for the return chart location. Currently reserved for future use in
        advanced astronomical calculations. Defaults to None.</p>

<p>Raises:
    KerykeionException: If city is not provided when online=True.
    KerykeionException: If nation is not provided when online=True.
    KerykeionException: If coordinates (lat/lng) are not provided when online=False.
    KerykeionException: If timezone (tz_str) is not provided when online=False.
    KerykeionException: If Geonames API fails to retrieve valid location data.
    KerykeionException: If required parameters are missing for the chosen mode.</p>

<p>Examples:
    Initialize with online geocoding:</p>

<pre><code>&gt;&gt;&gt; factory = PlanetaryReturnFactory(
...     subject,
...     city="San Francisco",
...     nation="US",
...     online=True,
...     geonames_username="your_username"
... )

Initialize with manual coordinates:

&gt;&gt;&gt; factory = PlanetaryReturnFactory(
...     subject,
...     lng=-122.4194,
...     lat=37.7749,
...     tz_str="America/Los_Angeles",
...     online=False
... )

Initialize with mixed parameters (coordinates override online lookup):

&gt;&gt;&gt; factory = PlanetaryReturnFactory(
...     subject,
...     city="Custom Location",
...     lng=-74.0060,
...     lat=40.7128,
...     tz_str="America/New_York",
...     online=False
... )
</code></pre>

<p>Note:
    - When both online and manual coordinates are provided, offline mode takes precedence
    - Geonames cache helps reduce API calls for frequently used locations
    - Timezone accuracy is crucial for precise return calculations
    - Location parameters affect house cusps and angular positions in return charts</p>
</div>


                            </div>
                            <div id="PlanetaryReturnFactory.subject" class="classattr">
                                <div class="attr variable">
            <span class="name">subject</span>

        
    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.subject"></a>
    
    

                            </div>
                            <div id="PlanetaryReturnFactory.online" class="classattr">
                                <div class="attr variable">
            <span class="name">online</span>

        
    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.online"></a>
    
    

                            </div>
                            <div id="PlanetaryReturnFactory.cache_expire_after_days" class="classattr">
                                <div class="attr variable">
            <span class="name">cache_expire_after_days</span>

        
    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.cache_expire_after_days"></a>
    
    

                            </div>
                            <div id="PlanetaryReturnFactory.altitude" class="classattr">
                                <div class="attr variable">
            <span class="name">altitude</span>

        
    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.altitude"></a>
    
    

                            </div>
                            <div id="PlanetaryReturnFactory.next_return_from_iso_formatted_time" class="classattr">
                                        <input id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_return_from_iso_formatted_time</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">iso_formatted_time</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">return_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Lunar&#39;</span><span class="p">,</span> <span class="s1">&#39;Solar&#39;</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span>:</span></span>

                <label class="view-source-button" for="PlanetaryReturnFactory.next_return_from_iso_formatted_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-389"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-389"><span class="linenos">389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_iso_formatted_time</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-390"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-391"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-391"><span class="linenos">391</span></a>        <span class="n">iso_formatted_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-392"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-392"><span class="linenos">392</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-393"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-393"><span class="linenos">393</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-394"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-395"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-395"><span class="linenos">395</span></a><span class="sd">        Calculate the next planetary return occurring after a specified ISO-formatted datetime.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-396"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-396"><span class="linenos">396</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-397"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-397"><span class="linenos">397</span></a><span class="sd">        This method computes the exact moment when the specified planet (Sun or Moon) returns</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-398"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-398"><span class="linenos">398</span></a><span class="sd">        to its natal position, starting the search from the provided datetime. It uses precise</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-399"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-399"><span class="linenos">399</span></a><span class="sd">        Swiss Ephemeris calculations to determine the exact return moment and generates a</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-400"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-400"><span class="linenos">400</span></a><span class="sd">        complete astrological chart for that calculated time.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-401"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-401"><span class="linenos">401</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-402"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-402"><span class="linenos">402</span></a><span class="sd">        The calculation process:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-403"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-403"><span class="linenos">403</span></a><span class="sd">        1. Converts the ISO datetime to Julian Day format for astronomical calculations</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-404"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-404"><span class="linenos">404</span></a><span class="sd">        2. Uses Swiss Ephemeris functions (solcross_ut/mooncross_ut) to find the exact</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-405"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-405"><span class="linenos">405</span></a><span class="sd">           return moment when the planet reaches its natal degree and minute</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-406"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-406"><span class="linenos">406</span></a><span class="sd">        3. Creates a complete AstrologicalSubject instance for the calculated return time</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-407"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-407"><span class="linenos">407</span></a><span class="sd">        4. Returns a comprehensive PlanetReturnModel with all chart data</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-408"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-408"><span class="linenos">408</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-409"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-409"><span class="linenos">409</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-410"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-410"><span class="linenos">410</span></a><span class="sd">            iso_formatted_time (str): Starting datetime in ISO format for the search.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-411"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-411"><span class="linenos">411</span></a><span class="sd">                Must be a valid ISO 8601 datetime string (e.g., &quot;2024-01-15T10:30:00&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-412"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-412"><span class="linenos">412</span></a><span class="sd">                or &quot;2024-01-15T10:30:00+00:00&quot;). The method will find the next return</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-413"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-413"><span class="linenos">413</span></a><span class="sd">                occurring after this moment.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-414"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-414"><span class="linenos">414</span></a><span class="sd">            return_type (ReturnType): Type of planetary return to calculate.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-415"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-415"><span class="linenos">415</span></a><span class="sd">                Must be either &quot;Solar&quot; for Sun returns or &quot;Lunar&quot; for Moon returns.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-416"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-416"><span class="linenos">416</span></a><span class="sd">                This determines which planet&#39;s return cycle to compute.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-417"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-417"><span class="linenos">417</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-418"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-418"><span class="linenos">418</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-419"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-419"><span class="linenos">419</span></a><span class="sd">            PlanetReturnModel: A comprehensive Pydantic model containing complete</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-420"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-420"><span class="linenos">420</span></a><span class="sd">                astrological chart data for the calculated return moment, including:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-421"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-421"><span class="linenos">421</span></a><span class="sd">                - Exact return datetime (UTC and local timezone)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-422"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-422"><span class="linenos">422</span></a><span class="sd">                - All planetary positions at the return moment</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-423"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-423"><span class="linenos">423</span></a><span class="sd">                - House cusps and angles for the return location</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-424"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-424"><span class="linenos">424</span></a><span class="sd">                - Complete astrological subject data with all calculated points</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-425"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-425"><span class="linenos">425</span></a><span class="sd">                - Return type identifier and subject name</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-426"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-426"><span class="linenos">426</span></a><span class="sd">                - Julian Day Number for the return moment</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-427"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-427"><span class="linenos">427</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-428"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-428"><span class="linenos">428</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-429"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-429"><span class="linenos">429</span></a><span class="sd">            KerykeionException: If return_type is not &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-430"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-430"><span class="linenos">430</span></a><span class="sd">            ValueError: If iso_formatted_time is not a valid ISO datetime format.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-431"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-431"><span class="linenos">431</span></a><span class="sd">            SwissEphException: If Swiss Ephemeris calculations fail due to invalid</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-432"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-432"><span class="linenos">432</span></a><span class="sd">                date ranges or astronomical calculation errors.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-433"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-433"><span class="linenos">433</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-434"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-434"><span class="linenos">434</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-435"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-435"><span class="linenos">435</span></a><span class="sd">            Calculate next Solar Return after a specific date:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-436"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-436"><span class="linenos">436</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-437"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-437"><span class="linenos">437</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(subject, ...)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-438"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-438"><span class="linenos">438</span></a><span class="sd">            &gt;&gt;&gt; solar_return = factory.next_return_from_iso_formatted_time(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-439"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-439"><span class="linenos">439</span></a><span class="sd">            ...     &quot;2024-06-15T12:00:00&quot;,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-440"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-440"><span class="linenos">440</span></a><span class="sd">            ...     &quot;Solar&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-441"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-441"><span class="linenos">441</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-442"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-442"><span class="linenos">442</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Solar Return: {solar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-443"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-443"><span class="linenos">443</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Sun position: {solar_return.sun.abs_pos}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-444"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-444"><span class="linenos">444</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-445"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-445"><span class="linenos">445</span></a><span class="sd">            Calculate next Lunar Return with timezone:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-446"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-446"><span class="linenos">446</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-447"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-447"><span class="linenos">447</span></a><span class="sd">            &gt;&gt;&gt; lunar_return = factory.next_return_from_iso_formatted_time(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-448"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-448"><span class="linenos">448</span></a><span class="sd">            ...     &quot;2024-01-01T00:00:00+00:00&quot;,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-449"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-449"><span class="linenos">449</span></a><span class="sd">            ...     &quot;Lunar&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-450"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-450"><span class="linenos">450</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-451"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-451"><span class="linenos">451</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Moon return in {lunar_return.tz_str}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-452"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-452"><span class="linenos">452</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Return occurs: {lunar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-453"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-453"><span class="linenos">453</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-454"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-454"><span class="linenos">454</span></a><span class="sd">            Access complete chart data from return:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-455"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-455"><span class="linenos">455</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-456"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-456"><span class="linenos">456</span></a><span class="sd">            &gt;&gt;&gt; return_chart = factory.next_return_from_iso_formatted_time(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-457"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-457"><span class="linenos">457</span></a><span class="sd">            ...     datetime.now().isoformat(),</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-458"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-458"><span class="linenos">458</span></a><span class="sd">            ...     &quot;Solar&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-459"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-459"><span class="linenos">459</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-460"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-460"><span class="linenos">460</span></a><span class="sd">            &gt;&gt;&gt; # Access all planetary positions</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-461"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-461"><span class="linenos">461</span></a><span class="sd">            &gt;&gt;&gt; for planet in return_chart.planets_list:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-462"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-462"><span class="linenos">462</span></a><span class="sd">            ...     print(f&quot;{planet.name}: {planet.abs_pos} in {planet.sign}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-463"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-463"><span class="linenos">463</span></a><span class="sd">            &gt;&gt;&gt; # Access house cusps</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-464"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-464"><span class="linenos">464</span></a><span class="sd">            &gt;&gt;&gt; for house in return_chart.houses_list:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-465"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-465"><span class="linenos">465</span></a><span class="sd">            ...     print(f&quot;House {house.number}: {house.abs_pos}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-466"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-466"><span class="linenos">466</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-467"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-467"><span class="linenos">467</span></a><span class="sd">        Technical Notes:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-468"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-468"><span class="linenos">468</span></a><span class="sd">            - Solar returns typically occur within 1-2 days of the natal birthday</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-469"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-469"><span class="linenos">469</span></a><span class="sd">            - Lunar returns occur approximately every 27.3 days (sidereal month)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-470"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-470"><span class="linenos">470</span></a><span class="sd">            - Return moments are calculated to the second for maximum precision</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-471"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-471"><span class="linenos">471</span></a><span class="sd">            - The method accounts for leap years and varying orbital speeds</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-472"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-472"><span class="linenos">472</span></a><span class="sd">            - Return charts use the factory&#39;s configured location, not the natal location</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-473"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-473"><span class="linenos">473</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-474"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-474"><span class="linenos">474</span></a><span class="sd">        Use Cases:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-475"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-475"><span class="linenos">475</span></a><span class="sd">            - Annual birthday return chart calculations</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-476"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-476"><span class="linenos">476</span></a><span class="sd">            - Monthly lunar return timing for astrological consultation</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-477"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-477"><span class="linenos">477</span></a><span class="sd">            - Research into planetary cycle patterns and timing</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-478"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-478"><span class="linenos">478</span></a><span class="sd">            - Forecasting and predictive astrology applications</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-479"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-479"><span class="linenos">479</span></a><span class="sd">            - Educational demonstrations of astronomical cycles</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-480"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-480"><span class="linenos">480</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-481"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-481"><span class="linenos">481</span></a><span class="sd">        See Also:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-482"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-482"><span class="linenos">482</span></a><span class="sd">            next_return_from_year(): Simplified interface for yearly calculations</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-483"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-483"><span class="linenos">483</span></a><span class="sd">            next_return_from_date(): Date-based calculation interface</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-484"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-484"><span class="linenos">484</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-485"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-485"><span class="linenos">485</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-486"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-486"><span class="linenos">486</span></a>        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_formatted_time</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-487"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-487"><span class="linenos">487</span></a>        <span class="n">julian_day</span> <span class="o">=</span> <span class="n">datetime_to_julian</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-488"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-488"><span class="linenos">488</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-489"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-489"><span class="linenos">489</span></a>        <span class="n">return_julian_date</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-490"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-491"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-491"><span class="linenos">491</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">sun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-492"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-492"><span class="linenos">492</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Sun position is required for Solar return but is not available in the subject.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-493"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-493"><span class="linenos">493</span></a>            <span class="n">return_julian_date</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">solcross_ut</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-494"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-494"><span class="linenos">494</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-495"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-495"><span class="linenos">495</span></a>                <span class="n">julian_day</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-496"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-496"><span class="linenos">496</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-497"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-497"><span class="linenos">497</span></a>        <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Lunar&quot;</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-498"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-498"><span class="linenos">498</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">moon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-499"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-499"><span class="linenos">499</span></a>                <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="s2">&quot;Moon position is required for Lunar return but is not available in the subject.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-500"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-500"><span class="linenos">500</span></a>            <span class="n">return_julian_date</span> <span class="o">=</span> <span class="n">swe</span><span class="o">.</span><span class="n">mooncross_ut</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-501"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-501"><span class="linenos">501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">moon</span><span class="o">.</span><span class="n">abs_pos</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-502"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-502"><span class="linenos">502</span></a>                <span class="n">julian_day</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-503"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-503"><span class="linenos">503</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-504"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-504"><span class="linenos">504</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-505"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-505"><span class="linenos">505</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return type </span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s2">. Use &#39;Solar&#39; or &#39;Lunar&#39;.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-506"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-506"><span class="linenos">506</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-507"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-507"><span class="linenos">507</span></a>        <span class="n">solar_return_date_utc</span> <span class="o">=</span> <span class="n">julian_to_datetime</span><span class="p">(</span><span class="n">return_julian_date</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-508"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-508"><span class="linenos">508</span></a>        <span class="n">solar_return_date_utc</span> <span class="o">=</span> <span class="n">solar_return_date_utc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-509"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-509"><span class="linenos">509</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-510"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-510"><span class="linenos">510</span></a>        <span class="n">solar_return_astrological_subject</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_iso_utc_time</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-511"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-511"><span class="linenos">511</span></a>            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-512"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-512"><span class="linenos">512</span></a>            <span class="n">iso_utc_time</span><span class="o">=</span><span class="n">solar_return_date_utc</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-513"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-513"><span class="linenos">513</span></a>            <span class="n">lng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lng</span><span class="p">,</span>       <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-514"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-514"><span class="linenos">514</span></a>            <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>       <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-515"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-515"><span class="linenos">515</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz_str</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-516"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-516"><span class="linenos">516</span></a>            <span class="n">city</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>     <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-517"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-517"><span class="linenos">517</span></a>            <span class="n">nation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nation</span><span class="p">,</span> <span class="c1"># type: ignore</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-518"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-518"><span class="linenos">518</span></a>            <span class="n">online</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-519"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-519"><span class="linenos">519</span></a>            <span class="n">altitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-520"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-520"><span class="linenos">520</span></a>            <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-521"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-521"><span class="linenos">521</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-522"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-522"><span class="linenos">522</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-523"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-523"><span class="linenos">523</span></a>        <span class="n">model_data</span> <span class="o">=</span> <span class="n">solar_return_astrological_subject</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-524"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-524"><span class="linenos">524</span></a>        <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s2"> Return&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-525"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-525"><span class="linenos">525</span></a>        <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;return_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">return_type</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-526"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-526"><span class="linenos">526</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-527"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="n">PlanetReturnModel</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-528"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-528"><span class="linenos">528</span></a>            <span class="o">**</span><span class="n">model_data</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_iso_formatted_time-529"><a href="#PlanetaryReturnFactory.next_return_from_iso_formatted_time-529"><span class="linenos">529</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the next planetary return occurring after a specified ISO-formatted datetime.</p>

<p>This method computes the exact moment when the specified planet (Sun or Moon) returns
to its natal position, starting the search from the provided datetime. It uses precise
Swiss Ephemeris calculations to determine the exact return moment and generates a
complete astrological chart for that calculated time.</p>

<p>The calculation process:</p>

<ol>
<li>Converts the ISO datetime to Julian Day format for astronomical calculations</li>
<li>Uses Swiss Ephemeris functions (solcross_ut/mooncross_ut) to find the exact
return moment when the planet reaches its natal degree and minute</li>
<li>Creates a complete AstrologicalSubject instance for the calculated return time</li>
<li>Returns a comprehensive PlanetReturnModel with all chart data</li>
</ol>

<p>Args:
    iso_formatted_time (str): Starting datetime in ISO format for the search.
        Must be a valid ISO 8601 datetime string (e.g., "2024-01-15T10:30:00"
        or "2024-01-15T10:30:00+00:00"). The method will find the next return
        occurring after this moment.
    return_type (ReturnType): Type of planetary return to calculate.
        Must be either "Solar" for Sun returns or "Lunar" for Moon returns.
        This determines which planet's return cycle to compute.</p>

<p>Returns:
    PlanetReturnModel: A comprehensive Pydantic model containing complete
        astrological chart data for the calculated return moment, including:
        - Exact return datetime (UTC and local timezone)
        - All planetary positions at the return moment
        - House cusps and angles for the return location
        - Complete astrological subject data with all calculated points
        - Return type identifier and subject name
        - Julian Day Number for the return moment</p>

<p>Raises:
    KerykeionException: If return_type is not "Solar" or "Lunar".
    ValueError: If iso_formatted_time is not a valid ISO datetime format.
    SwissEphException: If Swiss Ephemeris calculations fail due to invalid
        date ranges or astronomical calculation errors.</p>

<p>Examples:
    Calculate next Solar Return after a specific date:</p>

<pre><code>&gt;&gt;&gt; factory = PlanetaryReturnFactory(subject, ...)
&gt;&gt;&gt; solar_return = factory.next_return_from_iso_formatted_time(
...     "2024-06-15T12:00:00",
...     "Solar"
... )
&gt;&gt;&gt; print(f"Solar Return: {solar_return.iso_formatted_local_datetime}")
&gt;&gt;&gt; print(f"Sun position: {solar_return.sun.abs_pos}")

Calculate next Lunar Return with timezone:

&gt;&gt;&gt; lunar_return = factory.next_return_from_iso_formatted_time(
...     "2024-01-01T00:00:00+00:00",
...     "Lunar"
... )
&gt;&gt;&gt; print(f"Moon return in {lunar_return.tz_str}")
&gt;&gt;&gt; print(f"Return occurs: {lunar_return.iso_formatted_local_datetime}")

Access complete chart data from return:

&gt;&gt;&gt; return_chart = factory.next_return_from_iso_formatted_time(
...     datetime.now().isoformat(),
...     "Solar"
... )
&gt;&gt;&gt; # Access all planetary positions
&gt;&gt;&gt; for planet in return_chart.planets_list:
...     print(f"{planet.name}: {planet.abs_pos} in {planet.sign}")
&gt;&gt;&gt; # Access house cusps
&gt;&gt;&gt; for house in return_chart.houses_list:
...     print(f"House {house.number}: {house.abs_pos}")
</code></pre>

<p>Technical Notes:
    - Solar returns typically occur within 1-2 days of the natal birthday
    - Lunar returns occur approximately every 27.3 days (sidereal month)
    - Return moments are calculated to the second for maximum precision
    - The method accounts for leap years and varying orbital speeds
    - Return charts use the factory's configured location, not the natal location</p>

<p>Use Cases:
    - Annual birthday return chart calculations
    - Monthly lunar return timing for astrological consultation
    - Research into planetary cycle patterns and timing
    - Forecasting and predictive astrology applications
    - Educational demonstrations of astronomical cycles</p>

<p>See Also:
    next_return_from_year(): Simplified interface for yearly calculations
    next_return_from_date(): Date-based calculation interface</p>
</div>


                            </div>
                            <div id="PlanetaryReturnFactory.next_return_from_year" class="classattr">
                                        <input id="PlanetaryReturnFactory.next_return_from_year-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_return_from_year</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">year</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">return_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Lunar&#39;</span><span class="p">,</span> <span class="s1">&#39;Solar&#39;</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span>:</span></span>

                <label class="view-source-button" for="PlanetaryReturnFactory.next_return_from_year-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.next_return_from_year"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetaryReturnFactory.next_return_from_year-531"><a href="#PlanetaryReturnFactory.next_return_from_year-531"><span class="linenos">531</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_year</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-532"><a href="#PlanetaryReturnFactory.next_return_from_year-532"><span class="linenos">532</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-533"><a href="#PlanetaryReturnFactory.next_return_from_year-533"><span class="linenos">533</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-534"><a href="#PlanetaryReturnFactory.next_return_from_year-534"><span class="linenos">534</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-535"><a href="#PlanetaryReturnFactory.next_return_from_year-535"><span class="linenos">535</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-536"><a href="#PlanetaryReturnFactory.next_return_from_year-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-537"><a href="#PlanetaryReturnFactory.next_return_from_year-537"><span class="linenos">537</span></a><span class="sd">        Calculate the planetary return occurring within a specified year.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-538"><a href="#PlanetaryReturnFactory.next_return_from_year-538"><span class="linenos">538</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-539"><a href="#PlanetaryReturnFactory.next_return_from_year-539"><span class="linenos">539</span></a><span class="sd">        This is a convenience method that finds the first planetary return (Solar or Lunar)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-540"><a href="#PlanetaryReturnFactory.next_return_from_year-540"><span class="linenos">540</span></a><span class="sd">        that occurs in the given calendar year. It automatically searches from January 1st</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-541"><a href="#PlanetaryReturnFactory.next_return_from_year-541"><span class="linenos">541</span></a><span class="sd">        of the specified year and returns the first return found, making it ideal for</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-542"><a href="#PlanetaryReturnFactory.next_return_from_year-542"><span class="linenos">542</span></a><span class="sd">        annual forecasting and birthday return calculations.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-543"><a href="#PlanetaryReturnFactory.next_return_from_year-543"><span class="linenos">543</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-544"><a href="#PlanetaryReturnFactory.next_return_from_year-544"><span class="linenos">544</span></a><span class="sd">        For Solar Returns, this typically finds the return closest to the natal birthday</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-545"><a href="#PlanetaryReturnFactory.next_return_from_year-545"><span class="linenos">545</span></a><span class="sd">        within that year. For Lunar Returns, it finds the first lunar return occurring</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-546"><a href="#PlanetaryReturnFactory.next_return_from_year-546"><span class="linenos">546</span></a><span class="sd">        in January of the specified year.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-547"><a href="#PlanetaryReturnFactory.next_return_from_year-547"><span class="linenos">547</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-548"><a href="#PlanetaryReturnFactory.next_return_from_year-548"><span class="linenos">548</span></a><span class="sd">        The method internally uses next_return_from_iso_formatted_time() with a starting</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-549"><a href="#PlanetaryReturnFactory.next_return_from_year-549"><span class="linenos">549</span></a><span class="sd">        point of January 1st at midnight UTC for the specified year.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-550"><a href="#PlanetaryReturnFactory.next_return_from_year-550"><span class="linenos">550</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-551"><a href="#PlanetaryReturnFactory.next_return_from_year-551"><span class="linenos">551</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-552"><a href="#PlanetaryReturnFactory.next_return_from_year-552"><span class="linenos">552</span></a><span class="sd">            year (int): The calendar year to search for the return. Must be a valid</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-553"><a href="#PlanetaryReturnFactory.next_return_from_year-553"><span class="linenos">553</span></a><span class="sd">                year (typically between 1800-2200 for reliable ephemeris data).</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-554"><a href="#PlanetaryReturnFactory.next_return_from_year-554"><span class="linenos">554</span></a><span class="sd">                Examples: 2024, 2025, 1990, 2050.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-555"><a href="#PlanetaryReturnFactory.next_return_from_year-555"><span class="linenos">555</span></a><span class="sd">            return_type (ReturnType): The type of planetary return to calculate.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-556"><a href="#PlanetaryReturnFactory.next_return_from_year-556"><span class="linenos">556</span></a><span class="sd">                Must be either &quot;Solar&quot; for Sun returns or &quot;Lunar&quot; for Moon returns.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-557"><a href="#PlanetaryReturnFactory.next_return_from_year-557"><span class="linenos">557</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-558"><a href="#PlanetaryReturnFactory.next_return_from_year-558"><span class="linenos">558</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-559"><a href="#PlanetaryReturnFactory.next_return_from_year-559"><span class="linenos">559</span></a><span class="sd">            PlanetReturnModel: A comprehensive model containing the return chart data</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-560"><a href="#PlanetaryReturnFactory.next_return_from_year-560"><span class="linenos">560</span></a><span class="sd">                for the first return found in the specified year. Includes:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-561"><a href="#PlanetaryReturnFactory.next_return_from_year-561"><span class="linenos">561</span></a><span class="sd">                - Exact return datetime in both UTC and local timezone</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-562"><a href="#PlanetaryReturnFactory.next_return_from_year-562"><span class="linenos">562</span></a><span class="sd">                - Complete planetary positions at the return moment</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-563"><a href="#PlanetaryReturnFactory.next_return_from_year-563"><span class="linenos">563</span></a><span class="sd">                - House cusps calculated for the factory&#39;s configured location</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-564"><a href="#PlanetaryReturnFactory.next_return_from_year-564"><span class="linenos">564</span></a><span class="sd">                - All astrological chart features and calculated points</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-565"><a href="#PlanetaryReturnFactory.next_return_from_year-565"><span class="linenos">565</span></a><span class="sd">                - Return type and subject identification</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-566"><a href="#PlanetaryReturnFactory.next_return_from_year-566"><span class="linenos">566</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-567"><a href="#PlanetaryReturnFactory.next_return_from_year-567"><span class="linenos">567</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-568"><a href="#PlanetaryReturnFactory.next_return_from_year-568"><span class="linenos">568</span></a><span class="sd">            KerykeionException: If return_type is not &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-569"><a href="#PlanetaryReturnFactory.next_return_from_year-569"><span class="linenos">569</span></a><span class="sd">            ValueError: If year is outside the valid range for ephemeris calculations.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-570"><a href="#PlanetaryReturnFactory.next_return_from_year-570"><span class="linenos">570</span></a><span class="sd">            SwissEphException: If astronomical calculations fail for the given year.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-571"><a href="#PlanetaryReturnFactory.next_return_from_year-571"><span class="linenos">571</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-572"><a href="#PlanetaryReturnFactory.next_return_from_year-572"><span class="linenos">572</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-573"><a href="#PlanetaryReturnFactory.next_return_from_year-573"><span class="linenos">573</span></a><span class="sd">            Calculate Solar Return for 2024:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-574"><a href="#PlanetaryReturnFactory.next_return_from_year-574"><span class="linenos">574</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-575"><a href="#PlanetaryReturnFactory.next_return_from_year-575"><span class="linenos">575</span></a><span class="sd">            &gt;&gt;&gt; factory = PlanetaryReturnFactory(subject, ...)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-576"><a href="#PlanetaryReturnFactory.next_return_from_year-576"><span class="linenos">576</span></a><span class="sd">            &gt;&gt;&gt; solar_return_2024 = factory.next_return_from_year(2024, &quot;Solar&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-577"><a href="#PlanetaryReturnFactory.next_return_from_year-577"><span class="linenos">577</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;2024 Solar Return: {solar_return_2024.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-578"><a href="#PlanetaryReturnFactory.next_return_from_year-578"><span class="linenos">578</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;Birthday location: {solar_return_2024.city}, {solar_return_2024.nation}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-579"><a href="#PlanetaryReturnFactory.next_return_from_year-579"><span class="linenos">579</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-580"><a href="#PlanetaryReturnFactory.next_return_from_year-580"><span class="linenos">580</span></a><span class="sd">            Calculate first Lunar Return of 2025:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-581"><a href="#PlanetaryReturnFactory.next_return_from_year-581"><span class="linenos">581</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-582"><a href="#PlanetaryReturnFactory.next_return_from_year-582"><span class="linenos">582</span></a><span class="sd">            &gt;&gt;&gt; lunar_return = factory.next_return_from_year(2025, &quot;Lunar&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-583"><a href="#PlanetaryReturnFactory.next_return_from_year-583"><span class="linenos">583</span></a><span class="sd">            &gt;&gt;&gt; print(f&quot;First 2025 Lunar Return: {lunar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-584"><a href="#PlanetaryReturnFactory.next_return_from_year-584"><span class="linenos">584</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-585"><a href="#PlanetaryReturnFactory.next_return_from_year-585"><span class="linenos">585</span></a><span class="sd">            Compare multiple years:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-586"><a href="#PlanetaryReturnFactory.next_return_from_year-586"><span class="linenos">586</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-587"><a href="#PlanetaryReturnFactory.next_return_from_year-587"><span class="linenos">587</span></a><span class="sd">            &gt;&gt;&gt; for year in [2023, 2024, 2025]:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-588"><a href="#PlanetaryReturnFactory.next_return_from_year-588"><span class="linenos">588</span></a><span class="sd">            ...     solar_return = factory.next_return_from_year(year, &quot;Solar&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-589"><a href="#PlanetaryReturnFactory.next_return_from_year-589"><span class="linenos">589</span></a><span class="sd">            ...     print(f&quot;{year}: {solar_return.iso_formatted_local_datetime}&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-590"><a href="#PlanetaryReturnFactory.next_return_from_year-590"><span class="linenos">590</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-591"><a href="#PlanetaryReturnFactory.next_return_from_year-591"><span class="linenos">591</span></a><span class="sd">        Practical Applications:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-592"><a href="#PlanetaryReturnFactory.next_return_from_year-592"><span class="linenos">592</span></a><span class="sd">            - Annual Solar Return chart casting for birthday forecasting</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-593"><a href="#PlanetaryReturnFactory.next_return_from_year-593"><span class="linenos">593</span></a><span class="sd">            - Comparative analysis of return charts across multiple years</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-594"><a href="#PlanetaryReturnFactory.next_return_from_year-594"><span class="linenos">594</span></a><span class="sd">            - Research into planetary return timing patterns</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-595"><a href="#PlanetaryReturnFactory.next_return_from_year-595"><span class="linenos">595</span></a><span class="sd">            - Automated birthday return calculations for consultation</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-596"><a href="#PlanetaryReturnFactory.next_return_from_year-596"><span class="linenos">596</span></a><span class="sd">            - Educational demonstrations of annual astrological cycles</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-597"><a href="#PlanetaryReturnFactory.next_return_from_year-597"><span class="linenos">597</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-598"><a href="#PlanetaryReturnFactory.next_return_from_year-598"><span class="linenos">598</span></a><span class="sd">        Technical Notes:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-599"><a href="#PlanetaryReturnFactory.next_return_from_year-599"><span class="linenos">599</span></a><span class="sd">            - Solar returns in a given year occur near but not exactly on the birthday</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-600"><a href="#PlanetaryReturnFactory.next_return_from_year-600"><span class="linenos">600</span></a><span class="sd">            - The exact date can vary by 1-2 days due to leap years and orbital mechanics</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-601"><a href="#PlanetaryReturnFactory.next_return_from_year-601"><span class="linenos">601</span></a><span class="sd">            - Lunar returns occur approximately every 27.3 days throughout the year</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-602"><a href="#PlanetaryReturnFactory.next_return_from_year-602"><span class="linenos">602</span></a><span class="sd">            - This method finds the chronologically first return in the year</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-603"><a href="#PlanetaryReturnFactory.next_return_from_year-603"><span class="linenos">603</span></a><span class="sd">            - Return moment precision is calculated to the second</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-604"><a href="#PlanetaryReturnFactory.next_return_from_year-604"><span class="linenos">604</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-605"><a href="#PlanetaryReturnFactory.next_return_from_year-605"><span class="linenos">605</span></a><span class="sd">        Use Cases:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-606"><a href="#PlanetaryReturnFactory.next_return_from_year-606"><span class="linenos">606</span></a><span class="sd">            - Birthday return chart interpretation</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-607"><a href="#PlanetaryReturnFactory.next_return_from_year-607"><span class="linenos">607</span></a><span class="sd">            - Annual astrological forecasting</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-608"><a href="#PlanetaryReturnFactory.next_return_from_year-608"><span class="linenos">608</span></a><span class="sd">            - Timing analysis for major life events</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-609"><a href="#PlanetaryReturnFactory.next_return_from_year-609"><span class="linenos">609</span></a><span class="sd">            - Comparative return chart studies</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-610"><a href="#PlanetaryReturnFactory.next_return_from_year-610"><span class="linenos">610</span></a><span class="sd">            - Astrological consultation preparation</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-611"><a href="#PlanetaryReturnFactory.next_return_from_year-611"><span class="linenos">611</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_year-612"><a href="#PlanetaryReturnFactory.next_return_from_year-612"><span class="linenos">612</span></a><span class="sd">        See Also:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-613"><a href="#PlanetaryReturnFactory.next_return_from_year-613"><span class="linenos">613</span></a><span class="sd">            next_return_from_date(): For more specific date-based searches</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-614"><a href="#PlanetaryReturnFactory.next_return_from_year-614"><span class="linenos">614</span></a><span class="sd">            next_return_from_iso_formatted_time(): For custom starting dates</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-615"><a href="#PlanetaryReturnFactory.next_return_from_year-615"><span class="linenos">615</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-616"><a href="#PlanetaryReturnFactory.next_return_from_year-616"><span class="linenos">616</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-617"><a href="#PlanetaryReturnFactory.next_return_from_year-617"><span class="linenos">617</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-618"><a href="#PlanetaryReturnFactory.next_return_from_year-618"><span class="linenos">618</span></a>            <span class="s2">&quot;next_return_from_year is deprecated, use next_return_from_date instead&quot;</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-619"><a href="#PlanetaryReturnFactory.next_return_from_year-619"><span class="linenos">619</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-620"><a href="#PlanetaryReturnFactory.next_return_from_year-620"><span class="linenos">620</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-621"><a href="#PlanetaryReturnFactory.next_return_from_year-621"><span class="linenos">621</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_year-622"><a href="#PlanetaryReturnFactory.next_return_from_year-622"><span class="linenos">622</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the planetary return occurring within a specified year.</p>

<p>This is a convenience method that finds the first planetary return (Solar or Lunar)
that occurs in the given calendar year. It automatically searches from January 1st
of the specified year and returns the first return found, making it ideal for
annual forecasting and birthday return calculations.</p>

<p>For Solar Returns, this typically finds the return closest to the natal birthday
within that year. For Lunar Returns, it finds the first lunar return occurring
in January of the specified year.</p>

<p>The method internally uses next_return_from_iso_formatted_time() with a starting
point of January 1st at midnight UTC for the specified year.</p>

<p>Args:
    year (int): The calendar year to search for the return. Must be a valid
        year (typically between 1800-2200 for reliable ephemeris data).
        Examples: 2024, 2025, 1990, 2050.
    return_type (ReturnType): The type of planetary return to calculate.
        Must be either "Solar" for Sun returns or "Lunar" for Moon returns.</p>

<p>Returns:
    PlanetReturnModel: A comprehensive model containing the return chart data
        for the first return found in the specified year. Includes:
        - Exact return datetime in both UTC and local timezone
        - Complete planetary positions at the return moment
        - House cusps calculated for the factory's configured location
        - All astrological chart features and calculated points
        - Return type and subject identification</p>

<p>Raises:
    KerykeionException: If return_type is not "Solar" or "Lunar".
    ValueError: If year is outside the valid range for ephemeris calculations.
    SwissEphException: If astronomical calculations fail for the given year.</p>

<p>Examples:
    Calculate Solar Return for 2024:</p>

<pre><code>&gt;&gt;&gt; factory = PlanetaryReturnFactory(subject, ...)
&gt;&gt;&gt; solar_return_2024 = factory.next_return_from_year(2024, "Solar")
&gt;&gt;&gt; print(f"2024 Solar Return: {solar_return_2024.iso_formatted_local_datetime}")
&gt;&gt;&gt; print(f"Birthday location: {solar_return_2024.city}, {solar_return_2024.nation}")

Calculate first Lunar Return of 2025:

&gt;&gt;&gt; lunar_return = factory.next_return_from_year(2025, "Lunar")
&gt;&gt;&gt; print(f"First 2025 Lunar Return: {lunar_return.iso_formatted_local_datetime}")

Compare multiple years:

&gt;&gt;&gt; for year in [2023, 2024, 2025]:
...     solar_return = factory.next_return_from_year(year, "Solar")
...     print(f"{year}: {solar_return.iso_formatted_local_datetime}")
</code></pre>

<p>Practical Applications:
    - Annual Solar Return chart casting for birthday forecasting
    - Comparative analysis of return charts across multiple years
    - Research into planetary return timing patterns
    - Automated birthday return calculations for consultation
    - Educational demonstrations of annual astrological cycles</p>

<p>Technical Notes:
    - Solar returns in a given year occur near but not exactly on the birthday
    - The exact date can vary by 1-2 days due to leap years and orbital mechanics
    - Lunar returns occur approximately every 27.3 days throughout the year
    - This method finds the chronologically first return in the year
    - Return moment precision is calculated to the second</p>

<p>Use Cases:
    - Birthday return chart interpretation
    - Annual astrological forecasting
    - Timing analysis for major life events
    - Comparative return chart studies
    - Astrological consultation preparation</p>

<p>See Also:
    next_return_from_date(): For more specific date-based searches
    next_return_from_iso_formatted_time(): For custom starting dates</p>
</div>


                            </div>
                            <div id="PlanetaryReturnFactory.next_return_from_date" class="classattr">
                                        <input id="PlanetaryReturnFactory.next_return_from_date-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_return_from_date</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">year</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">month</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">day</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">return_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Lunar&#39;</span><span class="p">,</span> <span class="s1">&#39;Solar&#39;</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span>:</span></span>

                <label class="view-source-button" for="PlanetaryReturnFactory.next_return_from_date-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.next_return_from_date"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetaryReturnFactory.next_return_from_date-624"><a href="#PlanetaryReturnFactory.next_return_from_date-624"><span class="linenos">624</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_date</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-625"><a href="#PlanetaryReturnFactory.next_return_from_date-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-626"><a href="#PlanetaryReturnFactory.next_return_from_date-626"><span class="linenos">626</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-627"><a href="#PlanetaryReturnFactory.next_return_from_date-627"><span class="linenos">627</span></a>        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-628"><a href="#PlanetaryReturnFactory.next_return_from_date-628"><span class="linenos">628</span></a>        <span class="n">day</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-629"><a href="#PlanetaryReturnFactory.next_return_from_date-629"><span class="linenos">629</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-630"><a href="#PlanetaryReturnFactory.next_return_from_date-630"><span class="linenos">630</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-631"><a href="#PlanetaryReturnFactory.next_return_from_date-631"><span class="linenos">631</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-632"><a href="#PlanetaryReturnFactory.next_return_from_date-632"><span class="linenos">632</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-633"><a href="#PlanetaryReturnFactory.next_return_from_date-633"><span class="linenos">633</span></a><span class="sd">        Calculate the first planetary return occurring on or after a specified date.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-634"><a href="#PlanetaryReturnFactory.next_return_from_date-634"><span class="linenos">634</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-635"><a href="#PlanetaryReturnFactory.next_return_from_date-635"><span class="linenos">635</span></a><span class="sd">        This method provides precise timing control for planetary return calculations by</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-636"><a href="#PlanetaryReturnFactory.next_return_from_date-636"><span class="linenos">636</span></a><span class="sd">        searching from a specific day, month, and year. It&#39;s particularly useful for</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-637"><a href="#PlanetaryReturnFactory.next_return_from_date-637"><span class="linenos">637</span></a><span class="sd">        finding Lunar Returns when multiple returns occur within a single month</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-638"><a href="#PlanetaryReturnFactory.next_return_from_date-638"><span class="linenos">638</span></a><span class="sd">        (approximately every 27.3 days).</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-639"><a href="#PlanetaryReturnFactory.next_return_from_date-639"><span class="linenos">639</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-640"><a href="#PlanetaryReturnFactory.next_return_from_date-640"><span class="linenos">640</span></a><span class="sd">        The method searches from midnight (00:00:00 UTC) of the specified date,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-641"><a href="#PlanetaryReturnFactory.next_return_from_date-641"><span class="linenos">641</span></a><span class="sd">        finding the next return that occurs from that point forward.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-642"><a href="#PlanetaryReturnFactory.next_return_from_date-642"><span class="linenos">642</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-643"><a href="#PlanetaryReturnFactory.next_return_from_date-643"><span class="linenos">643</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-644"><a href="#PlanetaryReturnFactory.next_return_from_date-644"><span class="linenos">644</span></a><span class="sd">            year (int): The calendar year to search within. Must be a valid year</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-645"><a href="#PlanetaryReturnFactory.next_return_from_date-645"><span class="linenos">645</span></a><span class="sd">                within the ephemeris data range (typically 1800-2200).</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-646"><a href="#PlanetaryReturnFactory.next_return_from_date-646"><span class="linenos">646</span></a><span class="sd">            month (int): The month to start the search from. Must be between 1 and 12.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-647"><a href="#PlanetaryReturnFactory.next_return_from_date-647"><span class="linenos">647</span></a><span class="sd">            day (int): The day to start the search from. Must be a valid day for the</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-648"><a href="#PlanetaryReturnFactory.next_return_from_date-648"><span class="linenos">648</span></a><span class="sd">                specified month (1-28/29/30/31 depending on month). Defaults to 1.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-649"><a href="#PlanetaryReturnFactory.next_return_from_date-649"><span class="linenos">649</span></a><span class="sd">            return_type (ReturnType): The type of planetary return to calculate.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-650"><a href="#PlanetaryReturnFactory.next_return_from_date-650"><span class="linenos">650</span></a><span class="sd">                Must be either &quot;Solar&quot; for Sun returns or &quot;Lunar&quot; for Moon returns.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-651"><a href="#PlanetaryReturnFactory.next_return_from_date-651"><span class="linenos">651</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-652"><a href="#PlanetaryReturnFactory.next_return_from_date-652"><span class="linenos">652</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-653"><a href="#PlanetaryReturnFactory.next_return_from_date-653"><span class="linenos">653</span></a><span class="sd">            PlanetReturnModel: Comprehensive return chart data for the first return</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-654"><a href="#PlanetaryReturnFactory.next_return_from_date-654"><span class="linenos">654</span></a><span class="sd">                found on or after the specified date.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-655"><a href="#PlanetaryReturnFactory.next_return_from_date-655"><span class="linenos">655</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-656"><a href="#PlanetaryReturnFactory.next_return_from_date-656"><span class="linenos">656</span></a><span class="sd">        Raises:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-657"><a href="#PlanetaryReturnFactory.next_return_from_date-657"><span class="linenos">657</span></a><span class="sd">            KerykeionException: If month is not between 1 and 12.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-658"><a href="#PlanetaryReturnFactory.next_return_from_date-658"><span class="linenos">658</span></a><span class="sd">            KerykeionException: If day is not valid for the given month/year.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-659"><a href="#PlanetaryReturnFactory.next_return_from_date-659"><span class="linenos">659</span></a><span class="sd">            KerykeionException: If return_type is not &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-660"><a href="#PlanetaryReturnFactory.next_return_from_date-660"><span class="linenos">660</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-661"><a href="#PlanetaryReturnFactory.next_return_from_date-661"><span class="linenos">661</span></a><span class="sd">        Examples:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-662"><a href="#PlanetaryReturnFactory.next_return_from_date-662"><span class="linenos">662</span></a><span class="sd">            Find first Lunar Return after January 15, 2024:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-663"><a href="#PlanetaryReturnFactory.next_return_from_date-663"><span class="linenos">663</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-664"><a href="#PlanetaryReturnFactory.next_return_from_date-664"><span class="linenos">664</span></a><span class="sd">            &gt;&gt;&gt; lunar_return = factory.next_return_from_date(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-665"><a href="#PlanetaryReturnFactory.next_return_from_date-665"><span class="linenos">665</span></a><span class="sd">            ...     2024, 1, 15, return_type=&quot;Lunar&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-666"><a href="#PlanetaryReturnFactory.next_return_from_date-666"><span class="linenos">666</span></a><span class="sd">            ... )</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-667"><a href="#PlanetaryReturnFactory.next_return_from_date-667"><span class="linenos">667</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-668"><a href="#PlanetaryReturnFactory.next_return_from_date-668"><span class="linenos">668</span></a><span class="sd">            Find second Lunar Return in a month (after the first one):</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-669"><a href="#PlanetaryReturnFactory.next_return_from_date-669"><span class="linenos">669</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-670"><a href="#PlanetaryReturnFactory.next_return_from_date-670"><span class="linenos">670</span></a><span class="sd">            &gt;&gt;&gt; # First return from start of month</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-671"><a href="#PlanetaryReturnFactory.next_return_from_date-671"><span class="linenos">671</span></a><span class="sd">            &gt;&gt;&gt; first_lr = factory.next_return_from_date(2024, 1, 1, return_type=&quot;Lunar&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-672"><a href="#PlanetaryReturnFactory.next_return_from_date-672"><span class="linenos">672</span></a><span class="sd">            &gt;&gt;&gt; # Second return from middle of month</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-673"><a href="#PlanetaryReturnFactory.next_return_from_date-673"><span class="linenos">673</span></a><span class="sd">            &gt;&gt;&gt; second_lr = factory.next_return_from_date(2024, 1, 15, return_type=&quot;Lunar&quot;)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-674"><a href="#PlanetaryReturnFactory.next_return_from_date-674"><span class="linenos">674</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-675"><a href="#PlanetaryReturnFactory.next_return_from_date-675"><span class="linenos">675</span></a><span class="sd">        See Also:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-676"><a href="#PlanetaryReturnFactory.next_return_from_date-676"><span class="linenos">676</span></a><span class="sd">            next_return_from_year(): For annual return calculations</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-677"><a href="#PlanetaryReturnFactory.next_return_from_date-677"><span class="linenos">677</span></a><span class="sd">            next_return_from_iso_formatted_time(): For custom datetime searches</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-678"><a href="#PlanetaryReturnFactory.next_return_from_date-678"><span class="linenos">678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-679"><a href="#PlanetaryReturnFactory.next_return_from_date-679"><span class="linenos">679</span></a>        <span class="c1"># Validate month input</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-680"><a href="#PlanetaryReturnFactory.next_return_from_date-680"><span class="linenos">680</span></a>        <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-681"><a href="#PlanetaryReturnFactory.next_return_from_date-681"><span class="linenos">681</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">. Month must be between 1 and 12.&quot;</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-682"><a href="#PlanetaryReturnFactory.next_return_from_date-682"><span class="linenos">682</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-683"><a href="#PlanetaryReturnFactory.next_return_from_date-683"><span class="linenos">683</span></a>        <span class="c1"># Validate day input</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-684"><a href="#PlanetaryReturnFactory.next_return_from_date-684"><span class="linenos">684</span></a>        <span class="n">max_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-685"><a href="#PlanetaryReturnFactory.next_return_from_date-685"><span class="linenos">685</span></a>        <span class="k">if</span> <span class="n">day</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">day</span> <span class="o">&gt;</span> <span class="n">max_day</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-686"><a href="#PlanetaryReturnFactory.next_return_from_date-686"><span class="linenos">686</span></a>            <span class="k">raise</span> <span class="n">KerykeionException</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-687"><a href="#PlanetaryReturnFactory.next_return_from_date-687"><span class="linenos">687</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid day </span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">. Day must be between 1 and </span><span class="si">{</span><span class="n">max_day</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-688"><a href="#PlanetaryReturnFactory.next_return_from_date-688"><span class="linenos">688</span></a>            <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-689"><a href="#PlanetaryReturnFactory.next_return_from_date-689"><span class="linenos">689</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-690"><a href="#PlanetaryReturnFactory.next_return_from_date-690"><span class="linenos">690</span></a>        <span class="c1"># Create datetime for the specified date (UTC)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-691"><a href="#PlanetaryReturnFactory.next_return_from_date-691"><span class="linenos">691</span></a>        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-692"><a href="#PlanetaryReturnFactory.next_return_from_date-692"><span class="linenos">692</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_date-693"><a href="#PlanetaryReturnFactory.next_return_from_date-693"><span class="linenos">693</span></a>        <span class="c1"># Get the return using the existing method</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-694"><a href="#PlanetaryReturnFactory.next_return_from_date-694"><span class="linenos">694</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_return_from_iso_formatted_time</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-695"><a href="#PlanetaryReturnFactory.next_return_from_date-695"><span class="linenos">695</span></a>            <span class="n">start_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-696"><a href="#PlanetaryReturnFactory.next_return_from_date-696"><span class="linenos">696</span></a>            <span class="n">return_type</span>
</span><span id="PlanetaryReturnFactory.next_return_from_date-697"><a href="#PlanetaryReturnFactory.next_return_from_date-697"><span class="linenos">697</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the first planetary return occurring on or after a specified date.</p>

<p>This method provides precise timing control for planetary return calculations by
searching from a specific day, month, and year. It's particularly useful for
finding Lunar Returns when multiple returns occur within a single month
(approximately every 27.3 days).</p>

<p>The method searches from midnight (00:00:00 UTC) of the specified date,
finding the next return that occurs from that point forward.</p>

<p>Args:
    year (int): The calendar year to search within. Must be a valid year
        within the ephemeris data range (typically 1800-2200).
    month (int): The month to start the search from. Must be between 1 and 12.
    day (int): The day to start the search from. Must be a valid day for the
        specified month (1-28/29/30/31 depending on month). Defaults to 1.
    return_type (ReturnType): The type of planetary return to calculate.
        Must be either "Solar" for Sun returns or "Lunar" for Moon returns.</p>

<p>Returns:
    PlanetReturnModel: Comprehensive return chart data for the first return
        found on or after the specified date.</p>

<p>Raises:
    KerykeionException: If month is not between 1 and 12.
    KerykeionException: If day is not valid for the given month/year.
    KerykeionException: If return_type is not "Solar" or "Lunar".</p>

<p>Examples:
    Find first Lunar Return after January 15, 2024:</p>

<pre><code>&gt;&gt;&gt; lunar_return = factory.next_return_from_date(
...     2024, 1, 15, return_type="Lunar"
... )

Find second Lunar Return in a month (after the first one):

&gt;&gt;&gt; # First return from start of month
&gt;&gt;&gt; first_lr = factory.next_return_from_date(2024, 1, 1, return_type="Lunar")
&gt;&gt;&gt; # Second return from middle of month
&gt;&gt;&gt; second_lr = factory.next_return_from_date(2024, 1, 15, return_type="Lunar")
</code></pre>

<p>See Also:
    next_return_from_year(): For annual return calculations
    next_return_from_iso_formatted_time(): For custom datetime searches</p>
</div>


                            </div>
                            <div id="PlanetaryReturnFactory.next_return_from_month_and_year" class="classattr">
                                        <input id="PlanetaryReturnFactory.next_return_from_month_and_year-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_return_from_month_and_year</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">year</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">month</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">return_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Lunar&#39;</span><span class="p">,</span> <span class="s1">&#39;Solar&#39;</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span>:</span></span>

                <label class="view-source-button" for="PlanetaryReturnFactory.next_return_from_month_and_year-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetaryReturnFactory.next_return_from_month_and_year"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-699"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-699"><span class="linenos">699</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next_return_from_month_and_year</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-700"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-700"><span class="linenos">700</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-701"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-701"><span class="linenos">701</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-702"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-702"><span class="linenos">702</span></a>        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-703"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-703"><span class="linenos">703</span></a>        <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-704"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-704"><span class="linenos">704</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlanetReturnModel</span><span class="p">:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-705"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-705"><span class="linenos">705</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-706"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-706"><span class="linenos">706</span></a><span class="sd">        DEPRECATED: Use next_return_from_date() instead.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-707"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-707"><span class="linenos">707</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-708"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-708"><span class="linenos">708</span></a><span class="sd">        Calculate the first planetary return occurring in or after a specified month and year.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-709"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-709"><span class="linenos">709</span></a><span class="sd">        This method is kept for backward compatibility and will be removed in a future version.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-710"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-710"><span class="linenos">710</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-711"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-711"><span class="linenos">711</span></a><span class="sd">        Args:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-712"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-712"><span class="linenos">712</span></a><span class="sd">            year (int): The calendar year to search within.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-713"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-713"><span class="linenos">713</span></a><span class="sd">            month (int): The month to start the search from (1-12).</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-714"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-714"><span class="linenos">714</span></a><span class="sd">            return_type (ReturnType): &quot;Solar&quot; or &quot;Lunar&quot;.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-715"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-715"><span class="linenos">715</span></a>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-716"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-716"><span class="linenos">716</span></a><span class="sd">        Returns:</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-717"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-717"><span class="linenos">717</span></a><span class="sd">            PlanetReturnModel: Return chart data for the first return found.</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-718"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-719"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-719"><span class="linenos">719</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-720"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-720"><span class="linenos">720</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-721"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-721"><span class="linenos">721</span></a>            <span class="s2">&quot;next_return_from_month_and_year is deprecated, use next_return_from_date instead&quot;</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-722"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-722"><span class="linenos">722</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-723"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-723"><span class="linenos">723</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-724"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-724"><span class="linenos">724</span></a>        <span class="p">)</span>
</span><span id="PlanetaryReturnFactory.next_return_from_month_and_year-725"><a href="#PlanetaryReturnFactory.next_return_from_month_and_year-725"><span class="linenos">725</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_return_from_date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>DEPRECATED: Use next_return_from_date() instead.</p>

<p>Calculate the first planetary return occurring in or after a specified month and year.
This method is kept for backward compatibility and will be removed in a future version.</p>

<p>Args:
    year (int): The calendar year to search within.
    month (int): The month to start the search from (1-12).
    return_type (ReturnType): "Solar" or "Lunar".</p>

<p>Returns:
    PlanetReturnModel: Return chart data for the first return found.</p>
</div>


                            </div>
                </section>
                <section id="PlanetReturnModel">
                            <input id="PlanetReturnModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PlanetReturnModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.AstrologicalBaseModel</span>):

                <label class="view-source-button" for="PlanetReturnModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanetReturnModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanetReturnModel-275"><a href="#PlanetReturnModel-275"><span class="linenos">275</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PlanetReturnModel</span><span class="p">(</span><span class="n">AstrologicalBaseModel</span><span class="p">):</span>
</span><span id="PlanetReturnModel-276"><a href="#PlanetReturnModel-276"><span class="linenos">276</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="PlanetReturnModel-277"><a href="#PlanetReturnModel-277"><span class="linenos">277</span></a><span class="sd">    Pydantic Model for Planet Return</span>
</span><span id="PlanetReturnModel-278"><a href="#PlanetReturnModel-278"><span class="linenos">278</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PlanetReturnModel-279"><a href="#PlanetReturnModel-279"><span class="linenos">279</span></a>    <span class="c1"># Specific return data</span>
</span><span id="PlanetReturnModel-280"><a href="#PlanetReturnModel-280"><span class="linenos">280</span></a>    <span class="n">return_type</span><span class="p">:</span> <span class="n">ReturnType</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Type of return: Solar or Lunar&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pydantic Model for Planet Return</p>
</div>


                            <div id="PlanetReturnModel.return_type" class="classattr">
                                <div class="attr variable">
            <span class="name">return_type</span><span class="annotation">: Literal[&#39;Lunar&#39;, &#39;Solar&#39;]</span>

        
    </div>
    <a class="headerlink" href="#PlanetReturnModel.return_type"></a>
    
    

                            </div>
                            <div id="PlanetReturnModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#PlanetReturnModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="RelationshipScoreFactory">
                            <input id="RelationshipScoreFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RelationshipScoreFactory</span>:

                <label class="view-source-button" for="RelationshipScoreFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationshipScoreFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationshipScoreFactory-65"><a href="#RelationshipScoreFactory-65"><span class="linenos"> 65</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RelationshipScoreFactory</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-66"><a href="#RelationshipScoreFactory-66"><span class="linenos"> 66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-67"><a href="#RelationshipScoreFactory-67"><span class="linenos"> 67</span></a><span class="sd">    Calculates relationship scores between two subjects using the Ciro Discepolo method.</span>
</span><span id="RelationshipScoreFactory-68"><a href="#RelationshipScoreFactory-68"><span class="linenos"> 68</span></a>
</span><span id="RelationshipScoreFactory-69"><a href="#RelationshipScoreFactory-69"><span class="linenos"> 69</span></a><span class="sd">    The scoring system evaluates synastry aspects between planetary positions to generate</span>
</span><span id="RelationshipScoreFactory-70"><a href="#RelationshipScoreFactory-70"><span class="linenos"> 70</span></a><span class="sd">    numerical compatibility scores with categorical descriptions.</span>
</span><span id="RelationshipScoreFactory-71"><a href="#RelationshipScoreFactory-71"><span class="linenos"> 71</span></a>
</span><span id="RelationshipScoreFactory-72"><a href="#RelationshipScoreFactory-72"><span class="linenos"> 72</span></a><span class="sd">    Score Ranges:</span>
</span><span id="RelationshipScoreFactory-73"><a href="#RelationshipScoreFactory-73"><span class="linenos"> 73</span></a><span class="sd">        - 0-5: Minimal relationship</span>
</span><span id="RelationshipScoreFactory-74"><a href="#RelationshipScoreFactory-74"><span class="linenos"> 74</span></a><span class="sd">        - 5-10: Medium relationship</span>
</span><span id="RelationshipScoreFactory-75"><a href="#RelationshipScoreFactory-75"><span class="linenos"> 75</span></a><span class="sd">        - 10-15: Important relationship</span>
</span><span id="RelationshipScoreFactory-76"><a href="#RelationshipScoreFactory-76"><span class="linenos"> 76</span></a><span class="sd">        - 15-20: Very important relationship</span>
</span><span id="RelationshipScoreFactory-77"><a href="#RelationshipScoreFactory-77"><span class="linenos"> 77</span></a><span class="sd">        - 20-30: Exceptional relationship</span>
</span><span id="RelationshipScoreFactory-78"><a href="#RelationshipScoreFactory-78"><span class="linenos"> 78</span></a><span class="sd">        - 30+: Rare exceptional relationship</span>
</span><span id="RelationshipScoreFactory-79"><a href="#RelationshipScoreFactory-79"><span class="linenos"> 79</span></a>
</span><span id="RelationshipScoreFactory-80"><a href="#RelationshipScoreFactory-80"><span class="linenos"> 80</span></a><span class="sd">    Args:</span>
</span><span id="RelationshipScoreFactory-81"><a href="#RelationshipScoreFactory-81"><span class="linenos"> 81</span></a><span class="sd">        first_subject (AstrologicalSubjectModel): First astrological subject</span>
</span><span id="RelationshipScoreFactory-82"><a href="#RelationshipScoreFactory-82"><span class="linenos"> 82</span></a><span class="sd">        second_subject (AstrologicalSubjectModel): Second astrological subject</span>
</span><span id="RelationshipScoreFactory-83"><a href="#RelationshipScoreFactory-83"><span class="linenos"> 83</span></a><span class="sd">        use_only_major_aspects (bool, optional): Filter to major aspects only. Defaults to True.</span>
</span><span id="RelationshipScoreFactory-84"><a href="#RelationshipScoreFactory-84"><span class="linenos"> 84</span></a><span class="sd">        axis_orb_limit (float | None, optional): Optional orb threshold for chart axes</span>
</span><span id="RelationshipScoreFactory-85"><a href="#RelationshipScoreFactory-85"><span class="linenos"> 85</span></a><span class="sd">            filtering during aspect calculation.</span>
</span><span id="RelationshipScoreFactory-86"><a href="#RelationshipScoreFactory-86"><span class="linenos"> 86</span></a>
</span><span id="RelationshipScoreFactory-87"><a href="#RelationshipScoreFactory-87"><span class="linenos"> 87</span></a><span class="sd">    Reference:</span>
</span><span id="RelationshipScoreFactory-88"><a href="#RelationshipScoreFactory-88"><span class="linenos"> 88</span></a><span class="sd">        http://www.cirodiscepolo.it/Articoli/Discepoloele.htm</span>
</span><span id="RelationshipScoreFactory-89"><a href="#RelationshipScoreFactory-89"><span class="linenos"> 89</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-90"><a href="#RelationshipScoreFactory-90"><span class="linenos"> 90</span></a>
</span><span id="RelationshipScoreFactory-91"><a href="#RelationshipScoreFactory-91"><span class="linenos"> 91</span></a>    <span class="n">SCORE_MAPPING</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RelationshipScoreFactory-92"><a href="#RelationshipScoreFactory-92"><span class="linenos"> 92</span></a>        <span class="p">(</span><span class="s2">&quot;Minimal&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="RelationshipScoreFactory-93"><a href="#RelationshipScoreFactory-93"><span class="linenos"> 93</span></a>        <span class="p">(</span><span class="s2">&quot;Medium&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="RelationshipScoreFactory-94"><a href="#RelationshipScoreFactory-94"><span class="linenos"> 94</span></a>        <span class="p">(</span><span class="s2">&quot;Important&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
</span><span id="RelationshipScoreFactory-95"><a href="#RelationshipScoreFactory-95"><span class="linenos"> 95</span></a>        <span class="p">(</span><span class="s2">&quot;Very Important&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span><span id="RelationshipScoreFactory-96"><a href="#RelationshipScoreFactory-96"><span class="linenos"> 96</span></a>        <span class="p">(</span><span class="s2">&quot;Exceptional&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
</span><span id="RelationshipScoreFactory-97"><a href="#RelationshipScoreFactory-97"><span class="linenos"> 97</span></a>        <span class="p">(</span><span class="s2">&quot;Rare Exceptional&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)),</span>
</span><span id="RelationshipScoreFactory-98"><a href="#RelationshipScoreFactory-98"><span class="linenos"> 98</span></a>    <span class="p">]</span>
</span><span id="RelationshipScoreFactory-99"><a href="#RelationshipScoreFactory-99"><span class="linenos"> 99</span></a>
</span><span id="RelationshipScoreFactory-100"><a href="#RelationshipScoreFactory-100"><span class="linenos">100</span></a>    <span class="n">MAJOR_ASPECTS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;conjunction&quot;</span><span class="p">,</span> <span class="s2">&quot;opposition&quot;</span><span class="p">,</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="s2">&quot;trine&quot;</span><span class="p">,</span> <span class="s2">&quot;sextile&quot;</span><span class="p">}</span>
</span><span id="RelationshipScoreFactory-101"><a href="#RelationshipScoreFactory-101"><span class="linenos">101</span></a>
</span><span id="RelationshipScoreFactory-102"><a href="#RelationshipScoreFactory-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-103"><a href="#RelationshipScoreFactory-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-104"><a href="#RelationshipScoreFactory-104"><span class="linenos">104</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-105"><a href="#RelationshipScoreFactory-105"><span class="linenos">105</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-106"><a href="#RelationshipScoreFactory-106"><span class="linenos">106</span></a>        <span class="n">use_only_major_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-107"><a href="#RelationshipScoreFactory-107"><span class="linenos">107</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-108"><a href="#RelationshipScoreFactory-108"><span class="linenos">108</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-109"><a href="#RelationshipScoreFactory-109"><span class="linenos">109</span></a>    <span class="p">):</span>
</span><span id="RelationshipScoreFactory-110"><a href="#RelationshipScoreFactory-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_only_major_aspects</span> <span class="o">=</span> <span class="n">use_only_major_aspects</span>
</span><span id="RelationshipScoreFactory-111"><a href="#RelationshipScoreFactory-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span> <span class="o">=</span> <span class="n">first_subject</span>
</span><span id="RelationshipScoreFactory-112"><a href="#RelationshipScoreFactory-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span> <span class="o">=</span> <span class="n">second_subject</span>
</span><span id="RelationshipScoreFactory-113"><a href="#RelationshipScoreFactory-113"><span class="linenos">113</span></a>
</span><span id="RelationshipScoreFactory-114"><a href="#RelationshipScoreFactory-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">score_value</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="RelationshipScoreFactory-115"><a href="#RelationshipScoreFactory-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_description</span><span class="p">:</span> <span class="n">RelationshipScoreDescription</span> <span class="o">=</span> <span class="s2">&quot;Minimal&quot;</span>
</span><span id="RelationshipScoreFactory-116"><a href="#RelationshipScoreFactory-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_destiny_sign</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RelationshipScoreFactory-117"><a href="#RelationshipScoreFactory-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_aspects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelationshipScoreAspectModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RelationshipScoreFactory-118"><a href="#RelationshipScoreFactory-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoreBreakdownItemModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RelationshipScoreFactory-119"><a href="#RelationshipScoreFactory-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_synastry_aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-120"><a href="#RelationshipScoreFactory-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-121"><a href="#RelationshipScoreFactory-121"><span class="linenos">121</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-122"><a href="#RelationshipScoreFactory-122"><span class="linenos">122</span></a>            <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-123"><a href="#RelationshipScoreFactory-123"><span class="linenos">123</span></a>            <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-124"><a href="#RelationshipScoreFactory-124"><span class="linenos">124</span></a>            <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-125"><a href="#RelationshipScoreFactory-125"><span class="linenos">125</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="RelationshipScoreFactory-126"><a href="#RelationshipScoreFactory-126"><span class="linenos">126</span></a>
</span><span id="RelationshipScoreFactory-127"><a href="#RelationshipScoreFactory-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_destiny_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-128"><a href="#RelationshipScoreFactory-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-129"><a href="#RelationshipScoreFactory-129"><span class="linenos">129</span></a><span class="sd">        Checks if subjects share the same sun sign quality and adds points.</span>
</span><span id="RelationshipScoreFactory-130"><a href="#RelationshipScoreFactory-130"><span class="linenos">130</span></a>
</span><span id="RelationshipScoreFactory-131"><a href="#RelationshipScoreFactory-131"><span class="linenos">131</span></a><span class="sd">        Adds 5 points if both subjects have sun signs with matching quality</span>
</span><span id="RelationshipScoreFactory-132"><a href="#RelationshipScoreFactory-132"><span class="linenos">132</span></a><span class="sd">        (cardinal, fixed, or mutable).</span>
</span><span id="RelationshipScoreFactory-133"><a href="#RelationshipScoreFactory-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-134"><a href="#RelationshipScoreFactory-134"><span class="linenos">134</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">sun</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">sun</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]:</span> <span class="c1"># type: ignore</span>
</span><span id="RelationshipScoreFactory-135"><a href="#RelationshipScoreFactory-135"><span class="linenos">135</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_destiny_sign</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RelationshipScoreFactory-136"><a href="#RelationshipScoreFactory-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">score_value</span> <span class="o">+=</span> <span class="n">DESTINY_SIGN_POINTS</span>
</span><span id="RelationshipScoreFactory-137"><a href="#RelationshipScoreFactory-137"><span class="linenos">137</span></a>            <span class="n">quality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">sun</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span> <span class="c1"># type: ignore</span>
</span><span id="RelationshipScoreFactory-138"><a href="#RelationshipScoreFactory-138"><span class="linenos">138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-139"><a href="#RelationshipScoreFactory-139"><span class="linenos">139</span></a>                <span class="n">ScoreBreakdownItemModel</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-140"><a href="#RelationshipScoreFactory-140"><span class="linenos">140</span></a>                    <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;destiny_sign&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-141"><a href="#RelationshipScoreFactory-141"><span class="linenos">141</span></a>                    <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Both Sun signs share </span><span class="si">{</span><span class="n">quality</span><span class="si">}</span><span class="s2"> quality&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-142"><a href="#RelationshipScoreFactory-142"><span class="linenos">142</span></a>                    <span class="n">points</span><span class="o">=</span><span class="n">DESTINY_SIGN_POINTS</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-143"><a href="#RelationshipScoreFactory-143"><span class="linenos">143</span></a>                    <span class="n">details</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">sun</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">sun</span><span class="p">[</span><span class="s1">&#39;sign&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore</span>
</span><span id="RelationshipScoreFactory-144"><a href="#RelationshipScoreFactory-144"><span class="linenos">144</span></a>                <span class="p">)</span>
</span><span id="RelationshipScoreFactory-145"><a href="#RelationshipScoreFactory-145"><span class="linenos">145</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-146"><a href="#RelationshipScoreFactory-146"><span class="linenos">146</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Destiny sign found, adding </span><span class="si">{</span><span class="n">DESTINY_SIGN_POINTS</span><span class="si">}</span><span class="s2"> points, total score: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">score_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-147"><a href="#RelationshipScoreFactory-147"><span class="linenos">147</span></a>
</span><span id="RelationshipScoreFactory-148"><a href="#RelationshipScoreFactory-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-149"><a href="#RelationshipScoreFactory-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-150"><a href="#RelationshipScoreFactory-150"><span class="linenos">150</span></a><span class="sd">        Processes an aspect and adds points to the total score.</span>
</span><span id="RelationshipScoreFactory-151"><a href="#RelationshipScoreFactory-151"><span class="linenos">151</span></a>
</span><span id="RelationshipScoreFactory-152"><a href="#RelationshipScoreFactory-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-153"><a href="#RelationshipScoreFactory-153"><span class="linenos">153</span></a><span class="sd">            aspect (dict): Aspect data containing planetary positions and geometry</span>
</span><span id="RelationshipScoreFactory-154"><a href="#RelationshipScoreFactory-154"><span class="linenos">154</span></a><span class="sd">            points (int): Points to add to the total score</span>
</span><span id="RelationshipScoreFactory-155"><a href="#RelationshipScoreFactory-155"><span class="linenos">155</span></a><span class="sd">            rule (str): Rule identifier for the breakdown</span>
</span><span id="RelationshipScoreFactory-156"><a href="#RelationshipScoreFactory-156"><span class="linenos">156</span></a><span class="sd">            description (str): Human-readable description for the breakdown</span>
</span><span id="RelationshipScoreFactory-157"><a href="#RelationshipScoreFactory-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-158"><a href="#RelationshipScoreFactory-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_only_major_aspects</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAJOR_ASPECTS</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-159"><a href="#RelationshipScoreFactory-159"><span class="linenos">159</span></a>            <span class="k">return</span>
</span><span id="RelationshipScoreFactory-160"><a href="#RelationshipScoreFactory-160"><span class="linenos">160</span></a>
</span><span id="RelationshipScoreFactory-161"><a href="#RelationshipScoreFactory-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">score_value</span> <span class="o">+=</span> <span class="n">points</span>
</span><span id="RelationshipScoreFactory-162"><a href="#RelationshipScoreFactory-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-163"><a href="#RelationshipScoreFactory-163"><span class="linenos">163</span></a>            <span class="n">RelationshipScoreAspectModel</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-164"><a href="#RelationshipScoreFactory-164"><span class="linenos">164</span></a>                <span class="n">p1_name</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">],</span>
</span><span id="RelationshipScoreFactory-165"><a href="#RelationshipScoreFactory-165"><span class="linenos">165</span></a>                <span class="n">p2_name</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">],</span>
</span><span id="RelationshipScoreFactory-166"><a href="#RelationshipScoreFactory-166"><span class="linenos">166</span></a>                <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">],</span>
</span><span id="RelationshipScoreFactory-167"><a href="#RelationshipScoreFactory-167"><span class="linenos">167</span></a>                <span class="n">orbit</span><span class="o">=</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;orbit&quot;</span><span class="p">],</span>
</span><span id="RelationshipScoreFactory-168"><a href="#RelationshipScoreFactory-168"><span class="linenos">168</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-169"><a href="#RelationshipScoreFactory-169"><span class="linenos">169</span></a>        <span class="p">)</span>
</span><span id="RelationshipScoreFactory-170"><a href="#RelationshipScoreFactory-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-171"><a href="#RelationshipScoreFactory-171"><span class="linenos">171</span></a>            <span class="n">ScoreBreakdownItemModel</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-172"><a href="#RelationshipScoreFactory-172"><span class="linenos">172</span></a>                <span class="n">rule</span><span class="o">=</span><span class="n">rule</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-173"><a href="#RelationshipScoreFactory-173"><span class="linenos">173</span></a>                <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-174"><a href="#RelationshipScoreFactory-174"><span class="linenos">174</span></a>                <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-175"><a href="#RelationshipScoreFactory-175"><span class="linenos">175</span></a>                <span class="n">details</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;p1_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;p2_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (orbit: </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;orbit&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="RelationshipScoreFactory-176"><a href="#RelationshipScoreFactory-176"><span class="linenos">176</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-177"><a href="#RelationshipScoreFactory-177"><span class="linenos">177</span></a>        <span class="p">)</span>
</span><span id="RelationshipScoreFactory-178"><a href="#RelationshipScoreFactory-178"><span class="linenos">178</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;p1_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;p2_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> aspect: </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> with orbit </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;orbit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degrees, adding </span><span class="si">{</span><span class="n">points</span><span class="si">}</span><span class="s2"> points, total score: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">score_value</span><span class="si">}</span><span class="s2">, total aspects: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_aspects</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-179"><a href="#RelationshipScoreFactory-179"><span class="linenos">179</span></a>
</span><span id="RelationshipScoreFactory-180"><a href="#RelationshipScoreFactory-180"><span class="linenos">180</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_sun_sun_main_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-181"><a href="#RelationshipScoreFactory-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-182"><a href="#RelationshipScoreFactory-182"><span class="linenos">182</span></a><span class="sd">        Evaluates Sun-Sun conjunction, opposition, or square aspects.</span>
</span><span id="RelationshipScoreFactory-183"><a href="#RelationshipScoreFactory-183"><span class="linenos">183</span></a>
</span><span id="RelationshipScoreFactory-184"><a href="#RelationshipScoreFactory-184"><span class="linenos">184</span></a><span class="sd">        Adds 8 points for standard orbs, 11 points for tight orbs (2).</span>
</span><span id="RelationshipScoreFactory-185"><a href="#RelationshipScoreFactory-185"><span class="linenos">185</span></a>
</span><span id="RelationshipScoreFactory-186"><a href="#RelationshipScoreFactory-186"><span class="linenos">186</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-187"><a href="#RelationshipScoreFactory-187"><span class="linenos">187</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-188"><a href="#RelationshipScoreFactory-188"><span class="linenos">188</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-189"><a href="#RelationshipScoreFactory-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;conjunction&quot;</span><span class="p">,</span> <span class="s2">&quot;opposition&quot;</span><span class="p">,</span> <span class="s2">&quot;square&quot;</span><span class="p">}:</span>
</span><span id="RelationshipScoreFactory-190"><a href="#RelationshipScoreFactory-190"><span class="linenos">190</span></a>            <span class="n">is_high_precision</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;orbit&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">HIGH_PRECISION_ORBIT_THRESHOLD</span>
</span><span id="RelationshipScoreFactory-191"><a href="#RelationshipScoreFactory-191"><span class="linenos">191</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="n">MAJOR_ASPECT_POINTS_HIGH_PRECISION</span> <span class="k">if</span> <span class="n">is_high_precision</span> <span class="k">else</span> <span class="n">MAJOR_ASPECT_POINTS_STANDARD</span>
</span><span id="RelationshipScoreFactory-192"><a href="#RelationshipScoreFactory-192"><span class="linenos">192</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="s2">&quot;high precision (2)&quot;</span> <span class="k">if</span> <span class="n">is_high_precision</span> <span class="k">else</span> <span class="s2">&quot;standard&quot;</span>
</span><span id="RelationshipScoreFactory-193"><a href="#RelationshipScoreFactory-193"><span class="linenos">193</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-194"><a href="#RelationshipScoreFactory-194"><span class="linenos">194</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-195"><a href="#RelationshipScoreFactory-195"><span class="linenos">195</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;sun_sun_major&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-196"><a href="#RelationshipScoreFactory-196"><span class="linenos">196</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sun-Sun </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="RelationshipScoreFactory-197"><a href="#RelationshipScoreFactory-197"><span class="linenos">197</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-198"><a href="#RelationshipScoreFactory-198"><span class="linenos">198</span></a>
</span><span id="RelationshipScoreFactory-199"><a href="#RelationshipScoreFactory-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_sun_moon_conjunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-200"><a href="#RelationshipScoreFactory-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-201"><a href="#RelationshipScoreFactory-201"><span class="linenos">201</span></a><span class="sd">        Evaluates Sun-Moon conjunction aspects.</span>
</span><span id="RelationshipScoreFactory-202"><a href="#RelationshipScoreFactory-202"><span class="linenos">202</span></a>
</span><span id="RelationshipScoreFactory-203"><a href="#RelationshipScoreFactory-203"><span class="linenos">203</span></a><span class="sd">        Adds 8 points for standard orbs, 11 points for tight orbs (2).</span>
</span><span id="RelationshipScoreFactory-204"><a href="#RelationshipScoreFactory-204"><span class="linenos">204</span></a>
</span><span id="RelationshipScoreFactory-205"><a href="#RelationshipScoreFactory-205"><span class="linenos">205</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-206"><a href="#RelationshipScoreFactory-206"><span class="linenos">206</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-207"><a href="#RelationshipScoreFactory-207"><span class="linenos">207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-208"><a href="#RelationshipScoreFactory-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="p">{</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">],</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]}</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">}</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;conjunction&quot;</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-209"><a href="#RelationshipScoreFactory-209"><span class="linenos">209</span></a>            <span class="n">is_high_precision</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;orbit&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">HIGH_PRECISION_ORBIT_THRESHOLD</span>
</span><span id="RelationshipScoreFactory-210"><a href="#RelationshipScoreFactory-210"><span class="linenos">210</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="n">MAJOR_ASPECT_POINTS_HIGH_PRECISION</span> <span class="k">if</span> <span class="n">is_high_precision</span> <span class="k">else</span> <span class="n">MAJOR_ASPECT_POINTS_STANDARD</span>
</span><span id="RelationshipScoreFactory-211"><a href="#RelationshipScoreFactory-211"><span class="linenos">211</span></a>            <span class="n">precision</span> <span class="o">=</span> <span class="s2">&quot;high precision (2)&quot;</span> <span class="k">if</span> <span class="n">is_high_precision</span> <span class="k">else</span> <span class="s2">&quot;standard&quot;</span>
</span><span id="RelationshipScoreFactory-212"><a href="#RelationshipScoreFactory-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-213"><a href="#RelationshipScoreFactory-213"><span class="linenos">213</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-214"><a href="#RelationshipScoreFactory-214"><span class="linenos">214</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;sun_moon_conjunction&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-215"><a href="#RelationshipScoreFactory-215"><span class="linenos">215</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sun-Moon conjunction (</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="RelationshipScoreFactory-216"><a href="#RelationshipScoreFactory-216"><span class="linenos">216</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-217"><a href="#RelationshipScoreFactory-217"><span class="linenos">217</span></a>
</span><span id="RelationshipScoreFactory-218"><a href="#RelationshipScoreFactory-218"><span class="linenos">218</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_sun_sun_other_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-219"><a href="#RelationshipScoreFactory-219"><span class="linenos">219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-220"><a href="#RelationshipScoreFactory-220"><span class="linenos">220</span></a><span class="sd">        Evaluates Sun-Sun aspects other than conjunction, opposition, or square.</span>
</span><span id="RelationshipScoreFactory-221"><a href="#RelationshipScoreFactory-221"><span class="linenos">221</span></a>
</span><span id="RelationshipScoreFactory-222"><a href="#RelationshipScoreFactory-222"><span class="linenos">222</span></a><span class="sd">        Adds 4 points for any qualifying aspect.</span>
</span><span id="RelationshipScoreFactory-223"><a href="#RelationshipScoreFactory-223"><span class="linenos">223</span></a>
</span><span id="RelationshipScoreFactory-224"><a href="#RelationshipScoreFactory-224"><span class="linenos">224</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-225"><a href="#RelationshipScoreFactory-225"><span class="linenos">225</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-226"><a href="#RelationshipScoreFactory-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-227"><a href="#RelationshipScoreFactory-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Sun&quot;</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;conjunction&quot;</span><span class="p">,</span> <span class="s2">&quot;opposition&quot;</span><span class="p">,</span> <span class="s2">&quot;square&quot;</span><span class="p">}:</span>
</span><span id="RelationshipScoreFactory-228"><a href="#RelationshipScoreFactory-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-229"><a href="#RelationshipScoreFactory-229"><span class="linenos">229</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">MINOR_ASPECT_POINTS</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-230"><a href="#RelationshipScoreFactory-230"><span class="linenos">230</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;sun_sun_minor&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-231"><a href="#RelationshipScoreFactory-231"><span class="linenos">231</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sun-Sun </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RelationshipScoreFactory-232"><a href="#RelationshipScoreFactory-232"><span class="linenos">232</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-233"><a href="#RelationshipScoreFactory-233"><span class="linenos">233</span></a>
</span><span id="RelationshipScoreFactory-234"><a href="#RelationshipScoreFactory-234"><span class="linenos">234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_sun_moon_other_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-235"><a href="#RelationshipScoreFactory-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-236"><a href="#RelationshipScoreFactory-236"><span class="linenos">236</span></a><span class="sd">        Evaluates Sun-Moon aspects other than conjunctions.</span>
</span><span id="RelationshipScoreFactory-237"><a href="#RelationshipScoreFactory-237"><span class="linenos">237</span></a>
</span><span id="RelationshipScoreFactory-238"><a href="#RelationshipScoreFactory-238"><span class="linenos">238</span></a><span class="sd">        Adds 4 points for any qualifying aspect.</span>
</span><span id="RelationshipScoreFactory-239"><a href="#RelationshipScoreFactory-239"><span class="linenos">239</span></a>
</span><span id="RelationshipScoreFactory-240"><a href="#RelationshipScoreFactory-240"><span class="linenos">240</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-241"><a href="#RelationshipScoreFactory-241"><span class="linenos">241</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-242"><a href="#RelationshipScoreFactory-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-243"><a href="#RelationshipScoreFactory-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="p">{</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">],</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]}</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">}</span> <span class="ow">and</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;aspect&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;conjunction&quot;</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-244"><a href="#RelationshipScoreFactory-244"><span class="linenos">244</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-245"><a href="#RelationshipScoreFactory-245"><span class="linenos">245</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">MINOR_ASPECT_POINTS</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-246"><a href="#RelationshipScoreFactory-246"><span class="linenos">246</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;sun_moon_other&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-247"><a href="#RelationshipScoreFactory-247"><span class="linenos">247</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sun-Moon </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RelationshipScoreFactory-248"><a href="#RelationshipScoreFactory-248"><span class="linenos">248</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-249"><a href="#RelationshipScoreFactory-249"><span class="linenos">249</span></a>
</span><span id="RelationshipScoreFactory-250"><a href="#RelationshipScoreFactory-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_sun_ascendant_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-251"><a href="#RelationshipScoreFactory-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-252"><a href="#RelationshipScoreFactory-252"><span class="linenos">252</span></a><span class="sd">        Evaluates Sun-Ascendant aspects.</span>
</span><span id="RelationshipScoreFactory-253"><a href="#RelationshipScoreFactory-253"><span class="linenos">253</span></a>
</span><span id="RelationshipScoreFactory-254"><a href="#RelationshipScoreFactory-254"><span class="linenos">254</span></a><span class="sd">        Adds 4 points for any aspect between Sun and Ascendant.</span>
</span><span id="RelationshipScoreFactory-255"><a href="#RelationshipScoreFactory-255"><span class="linenos">255</span></a>
</span><span id="RelationshipScoreFactory-256"><a href="#RelationshipScoreFactory-256"><span class="linenos">256</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-257"><a href="#RelationshipScoreFactory-257"><span class="linenos">257</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-258"><a href="#RelationshipScoreFactory-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-259"><a href="#RelationshipScoreFactory-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="p">{</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">],</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]}</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">}:</span>
</span><span id="RelationshipScoreFactory-260"><a href="#RelationshipScoreFactory-260"><span class="linenos">260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-261"><a href="#RelationshipScoreFactory-261"><span class="linenos">261</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">SUN_ASCENDANT_ASPECT_POINTS</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-262"><a href="#RelationshipScoreFactory-262"><span class="linenos">262</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;sun_ascendant&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-263"><a href="#RelationshipScoreFactory-263"><span class="linenos">263</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sun-Ascendant </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RelationshipScoreFactory-264"><a href="#RelationshipScoreFactory-264"><span class="linenos">264</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-265"><a href="#RelationshipScoreFactory-265"><span class="linenos">265</span></a>
</span><span id="RelationshipScoreFactory-266"><a href="#RelationshipScoreFactory-266"><span class="linenos">266</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_moon_ascendant_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-267"><a href="#RelationshipScoreFactory-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-268"><a href="#RelationshipScoreFactory-268"><span class="linenos">268</span></a><span class="sd">        Evaluates Moon-Ascendant aspects.</span>
</span><span id="RelationshipScoreFactory-269"><a href="#RelationshipScoreFactory-269"><span class="linenos">269</span></a>
</span><span id="RelationshipScoreFactory-270"><a href="#RelationshipScoreFactory-270"><span class="linenos">270</span></a><span class="sd">        Adds 4 points for any aspect between Moon and Ascendant.</span>
</span><span id="RelationshipScoreFactory-271"><a href="#RelationshipScoreFactory-271"><span class="linenos">271</span></a>
</span><span id="RelationshipScoreFactory-272"><a href="#RelationshipScoreFactory-272"><span class="linenos">272</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-273"><a href="#RelationshipScoreFactory-273"><span class="linenos">273</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-274"><a href="#RelationshipScoreFactory-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-275"><a href="#RelationshipScoreFactory-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="p">{</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">],</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]}</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="s2">&quot;Ascendant&quot;</span><span class="p">}:</span>
</span><span id="RelationshipScoreFactory-276"><a href="#RelationshipScoreFactory-276"><span class="linenos">276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-277"><a href="#RelationshipScoreFactory-277"><span class="linenos">277</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">MOON_ASCENDANT_ASPECT_POINTS</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-278"><a href="#RelationshipScoreFactory-278"><span class="linenos">278</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;moon_ascendant&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-279"><a href="#RelationshipScoreFactory-279"><span class="linenos">279</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Moon-Ascendant </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RelationshipScoreFactory-280"><a href="#RelationshipScoreFactory-280"><span class="linenos">280</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-281"><a href="#RelationshipScoreFactory-281"><span class="linenos">281</span></a>
</span><span id="RelationshipScoreFactory-282"><a href="#RelationshipScoreFactory-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_venus_mars_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aspect</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-283"><a href="#RelationshipScoreFactory-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-284"><a href="#RelationshipScoreFactory-284"><span class="linenos">284</span></a><span class="sd">        Evaluates Venus-Mars aspects.</span>
</span><span id="RelationshipScoreFactory-285"><a href="#RelationshipScoreFactory-285"><span class="linenos">285</span></a>
</span><span id="RelationshipScoreFactory-286"><a href="#RelationshipScoreFactory-286"><span class="linenos">286</span></a><span class="sd">        Adds 4 points for any aspect between Venus and Mars.</span>
</span><span id="RelationshipScoreFactory-287"><a href="#RelationshipScoreFactory-287"><span class="linenos">287</span></a>
</span><span id="RelationshipScoreFactory-288"><a href="#RelationshipScoreFactory-288"><span class="linenos">288</span></a><span class="sd">        Args:</span>
</span><span id="RelationshipScoreFactory-289"><a href="#RelationshipScoreFactory-289"><span class="linenos">289</span></a><span class="sd">            aspect (dict): Aspect data</span>
</span><span id="RelationshipScoreFactory-290"><a href="#RelationshipScoreFactory-290"><span class="linenos">290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-291"><a href="#RelationshipScoreFactory-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="p">{</span><span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p1_name&quot;</span><span class="p">],</span> <span class="n">aspect</span><span class="p">[</span><span class="s2">&quot;p2_name&quot;</span><span class="p">]}</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Venus&quot;</span><span class="p">,</span> <span class="s2">&quot;Mars&quot;</span><span class="p">}:</span>
</span><span id="RelationshipScoreFactory-292"><a href="#RelationshipScoreFactory-292"><span class="linenos">292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_aspect</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-293"><a href="#RelationshipScoreFactory-293"><span class="linenos">293</span></a>                <span class="n">aspect</span><span class="p">,</span> <span class="n">VENUS_MARS_ASPECT_POINTS</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-294"><a href="#RelationshipScoreFactory-294"><span class="linenos">294</span></a>                <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;venus_mars&quot;</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-295"><a href="#RelationshipScoreFactory-295"><span class="linenos">295</span></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Venus-Mars </span><span class="si">{</span><span class="n">aspect</span><span class="p">[</span><span class="s1">&#39;aspect&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RelationshipScoreFactory-296"><a href="#RelationshipScoreFactory-296"><span class="linenos">296</span></a>            <span class="p">)</span>
</span><span id="RelationshipScoreFactory-297"><a href="#RelationshipScoreFactory-297"><span class="linenos">297</span></a>
</span><span id="RelationshipScoreFactory-298"><a href="#RelationshipScoreFactory-298"><span class="linenos">298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_relationship_score_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-299"><a href="#RelationshipScoreFactory-299"><span class="linenos">299</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-300"><a href="#RelationshipScoreFactory-300"><span class="linenos">300</span></a><span class="sd">        Determines the categorical description based on the numerical score.</span>
</span><span id="RelationshipScoreFactory-301"><a href="#RelationshipScoreFactory-301"><span class="linenos">301</span></a>
</span><span id="RelationshipScoreFactory-302"><a href="#RelationshipScoreFactory-302"><span class="linenos">302</span></a><span class="sd">        Maps the total score to predefined description ranges.</span>
</span><span id="RelationshipScoreFactory-303"><a href="#RelationshipScoreFactory-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-304"><a href="#RelationshipScoreFactory-304"><span class="linenos">304</span></a>        <span class="k">for</span> <span class="n">description</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SCORE_MAPPING</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-305"><a href="#RelationshipScoreFactory-305"><span class="linenos">305</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_value</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-306"><a href="#RelationshipScoreFactory-306"><span class="linenos">306</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_description</span> <span class="o">=</span> <span class="n">description</span>
</span><span id="RelationshipScoreFactory-307"><a href="#RelationshipScoreFactory-307"><span class="linenos">307</span></a>                <span class="k">break</span>
</span><span id="RelationshipScoreFactory-308"><a href="#RelationshipScoreFactory-308"><span class="linenos">308</span></a>
</span><span id="RelationshipScoreFactory-309"><a href="#RelationshipScoreFactory-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relationship_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory-310"><a href="#RelationshipScoreFactory-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-311"><a href="#RelationshipScoreFactory-311"><span class="linenos">311</span></a><span class="sd">        Calculates the complete relationship score using all evaluation methods.</span>
</span><span id="RelationshipScoreFactory-312"><a href="#RelationshipScoreFactory-312"><span class="linenos">312</span></a>
</span><span id="RelationshipScoreFactory-313"><a href="#RelationshipScoreFactory-313"><span class="linenos">313</span></a><span class="sd">        Returns:</span>
</span><span id="RelationshipScoreFactory-314"><a href="#RelationshipScoreFactory-314"><span class="linenos">314</span></a><span class="sd">            RelationshipScoreModel: Score object containing numerical value, description,</span>
</span><span id="RelationshipScoreFactory-315"><a href="#RelationshipScoreFactory-315"><span class="linenos">315</span></a><span class="sd">                destiny sign status, contributing aspects, and subject data.</span>
</span><span id="RelationshipScoreFactory-316"><a href="#RelationshipScoreFactory-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory-317"><a href="#RelationshipScoreFactory-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_destiny_sign</span><span class="p">()</span>
</span><span id="RelationshipScoreFactory-318"><a href="#RelationshipScoreFactory-318"><span class="linenos">318</span></a>
</span><span id="RelationshipScoreFactory-319"><a href="#RelationshipScoreFactory-319"><span class="linenos">319</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synastry_aspects</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory-320"><a href="#RelationshipScoreFactory-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_sun_main_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-321"><a href="#RelationshipScoreFactory-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_moon_conjunction</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-322"><a href="#RelationshipScoreFactory-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_moon_other_aspects</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-323"><a href="#RelationshipScoreFactory-323"><span class="linenos">323</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_sun_other_aspects</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-324"><a href="#RelationshipScoreFactory-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_ascendant_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-325"><a href="#RelationshipScoreFactory-325"><span class="linenos">325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_moon_ascendant_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-326"><a href="#RelationshipScoreFactory-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_venus_mars_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory-327"><a href="#RelationshipScoreFactory-327"><span class="linenos">327</span></a>
</span><span id="RelationshipScoreFactory-328"><a href="#RelationshipScoreFactory-328"><span class="linenos">328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_relationship_score_description</span><span class="p">()</span>
</span><span id="RelationshipScoreFactory-329"><a href="#RelationshipScoreFactory-329"><span class="linenos">329</span></a>
</span><span id="RelationshipScoreFactory-330"><a href="#RelationshipScoreFactory-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="n">RelationshipScoreModel</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory-331"><a href="#RelationshipScoreFactory-331"><span class="linenos">331</span></a>            <span class="n">score_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score_value</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-332"><a href="#RelationshipScoreFactory-332"><span class="linenos">332</span></a>            <span class="n">score_description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_description</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-333"><a href="#RelationshipScoreFactory-333"><span class="linenos">333</span></a>            <span class="n">is_destiny_sign</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_destiny_sign</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-334"><a href="#RelationshipScoreFactory-334"><span class="linenos">334</span></a>            <span class="n">aspects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_aspects</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-335"><a href="#RelationshipScoreFactory-335"><span class="linenos">335</span></a>            <span class="n">score_breakdown</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory-336"><a href="#RelationshipScoreFactory-336"><span class="linenos">336</span></a>            <span class="n">subjects</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">],</span>
</span><span id="RelationshipScoreFactory-337"><a href="#RelationshipScoreFactory-337"><span class="linenos">337</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates relationship scores between two subjects using the Ciro Discepolo method.</p>

<p>The scoring system evaluates synastry aspects between planetary positions to generate
numerical compatibility scores with categorical descriptions.</p>

<p>Score Ranges:
    - 0-5: Minimal relationship
    - 5-10: Medium relationship
    - 10-15: Important relationship
    - 15-20: Very important relationship
    - 20-30: Exceptional relationship
    - 30+: Rare exceptional relationship</p>

<p>Args:
    first_subject (AstrologicalSubjectModel): First astrological subject
    second_subject (AstrologicalSubjectModel): Second astrological subject
    use_only_major_aspects (bool, optional): Filter to major aspects only. Defaults to True.
    axis_orb_limit (float | None, optional): Optional orb threshold for chart axes
        filtering during aspect calculation.</p>

<p>Reference:
    <a href="http://www.cirodiscepolo.it/Articoli/Discepoloele.htm">http://www.cirodiscepolo.it/Articoli/Discepoloele.htm</a></p>
</div>


                            <div id="RelationshipScoreFactory.__init__" class="classattr">
                                        <input id="RelationshipScoreFactory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RelationshipScoreFactory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">second_subject</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">use_only_major_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="RelationshipScoreFactory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationshipScoreFactory.__init__-102"><a href="#RelationshipScoreFactory.__init__-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory.__init__-103"><a href="#RelationshipScoreFactory.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-104"><a href="#RelationshipScoreFactory.__init__-104"><span class="linenos">104</span></a>        <span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-105"><a href="#RelationshipScoreFactory.__init__-105"><span class="linenos">105</span></a>        <span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-106"><a href="#RelationshipScoreFactory.__init__-106"><span class="linenos">106</span></a>        <span class="n">use_only_major_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-107"><a href="#RelationshipScoreFactory.__init__-107"><span class="linenos">107</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-108"><a href="#RelationshipScoreFactory.__init__-108"><span class="linenos">108</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-109"><a href="#RelationshipScoreFactory.__init__-109"><span class="linenos">109</span></a>    <span class="p">):</span>
</span><span id="RelationshipScoreFactory.__init__-110"><a href="#RelationshipScoreFactory.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_only_major_aspects</span> <span class="o">=</span> <span class="n">use_only_major_aspects</span>
</span><span id="RelationshipScoreFactory.__init__-111"><a href="#RelationshipScoreFactory.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span> <span class="o">=</span> <span class="n">first_subject</span>
</span><span id="RelationshipScoreFactory.__init__-112"><a href="#RelationshipScoreFactory.__init__-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span> <span class="o">=</span> <span class="n">second_subject</span>
</span><span id="RelationshipScoreFactory.__init__-113"><a href="#RelationshipScoreFactory.__init__-113"><span class="linenos">113</span></a>
</span><span id="RelationshipScoreFactory.__init__-114"><a href="#RelationshipScoreFactory.__init__-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">score_value</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="RelationshipScoreFactory.__init__-115"><a href="#RelationshipScoreFactory.__init__-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_description</span><span class="p">:</span> <span class="n">RelationshipScoreDescription</span> <span class="o">=</span> <span class="s2">&quot;Minimal&quot;</span>
</span><span id="RelationshipScoreFactory.__init__-116"><a href="#RelationshipScoreFactory.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_destiny_sign</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RelationshipScoreFactory.__init__-117"><a href="#RelationshipScoreFactory.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_aspects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelationshipScoreAspectModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RelationshipScoreFactory.__init__-118"><a href="#RelationshipScoreFactory.__init__-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoreBreakdownItemModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RelationshipScoreFactory.__init__-119"><a href="#RelationshipScoreFactory.__init__-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_synastry_aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory.__init__-120"><a href="#RelationshipScoreFactory.__init__-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-121"><a href="#RelationshipScoreFactory.__init__-121"><span class="linenos">121</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-122"><a href="#RelationshipScoreFactory.__init__-122"><span class="linenos">122</span></a>            <span class="n">axis_orb_limit</span><span class="o">=</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-123"><a href="#RelationshipScoreFactory.__init__-123"><span class="linenos">123</span></a>            <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-124"><a href="#RelationshipScoreFactory.__init__-124"><span class="linenos">124</span></a>            <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.__init__-125"><a href="#RelationshipScoreFactory.__init__-125"><span class="linenos">125</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">aspects</span>
</span></pre></div>


    

                            </div>
                            <div id="RelationshipScoreFactory.SCORE_MAPPING" class="classattr">
                                <div class="attr variable">
            <span class="name">SCORE_MAPPING</span>        =
<input id="RelationshipScoreFactory.SCORE_MAPPING-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="RelationshipScoreFactory.SCORE_MAPPING-view-value"></label><span class="default_value">[(&#39;Minimal&#39;, 5), (&#39;Medium&#39;, 10), (&#39;Important&#39;, 15), (&#39;Very Important&#39;, 20), (&#39;Exceptional&#39;, 30), (&#39;Rare Exceptional&#39;, inf)]</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.SCORE_MAPPING"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.MAJOR_ASPECTS" class="classattr">
                                <div class="attr variable">
            <span class="name">MAJOR_ASPECTS</span>        =
<span class="default_value">{&#39;conjunction&#39;, &#39;opposition&#39;, &#39;square&#39;, &#39;sextile&#39;, &#39;trine&#39;}</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.MAJOR_ASPECTS"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.use_only_major_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">use_only_major_aspects</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.use_only_major_aspects"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.first_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">first_subject</span><span class="annotation">: kerykeion.schemas.kr_models.AstrologicalSubjectModel</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.first_subject"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.second_subject" class="classattr">
                                <div class="attr variable">
            <span class="name">second_subject</span><span class="annotation">: kerykeion.schemas.kr_models.AstrologicalSubjectModel</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.second_subject"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.score_value" class="classattr">
                                <div class="attr variable">
            <span class="name">score_value</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.score_value"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.relationship_score_description" class="classattr">
                                <div class="attr variable">
            <span class="name">relationship_score_description</span><span class="annotation">: Literal[&#39;Minimal&#39;, &#39;Medium&#39;, &#39;Important&#39;, &#39;Very Important&#39;, &#39;Exceptional&#39;, &#39;Rare Exceptional&#39;]</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.relationship_score_description"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.is_destiny_sign" class="classattr">
                                <div class="attr variable">
            <span class="name">is_destiny_sign</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.is_destiny_sign"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.relationship_score_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">relationship_score_aspects</span><span class="annotation">: list[kerykeion.schemas.kr_models.RelationshipScoreAspectModel]</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.relationship_score_aspects"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.score_breakdown" class="classattr">
                                <div class="attr variable">
            <span class="name">score_breakdown</span><span class="annotation">: list[kerykeion.schemas.kr_models.ScoreBreakdownItemModel]</span>

        
    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.score_breakdown"></a>
    
    

                            </div>
                            <div id="RelationshipScoreFactory.get_relationship_score" class="classattr">
                                        <input id="RelationshipScoreFactory.get_relationship_score-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_relationship_score</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RelationshipScoreFactory.get_relationship_score-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RelationshipScoreFactory.get_relationship_score"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RelationshipScoreFactory.get_relationship_score-309"><a href="#RelationshipScoreFactory.get_relationship_score-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relationship_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-310"><a href="#RelationshipScoreFactory.get_relationship_score-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-311"><a href="#RelationshipScoreFactory.get_relationship_score-311"><span class="linenos">311</span></a><span class="sd">        Calculates the complete relationship score using all evaluation methods.</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-312"><a href="#RelationshipScoreFactory.get_relationship_score-312"><span class="linenos">312</span></a>
</span><span id="RelationshipScoreFactory.get_relationship_score-313"><a href="#RelationshipScoreFactory.get_relationship_score-313"><span class="linenos">313</span></a><span class="sd">        Returns:</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-314"><a href="#RelationshipScoreFactory.get_relationship_score-314"><span class="linenos">314</span></a><span class="sd">            RelationshipScoreModel: Score object containing numerical value, description,</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-315"><a href="#RelationshipScoreFactory.get_relationship_score-315"><span class="linenos">315</span></a><span class="sd">                destiny sign status, contributing aspects, and subject data.</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-316"><a href="#RelationshipScoreFactory.get_relationship_score-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-317"><a href="#RelationshipScoreFactory.get_relationship_score-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_destiny_sign</span><span class="p">()</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-318"><a href="#RelationshipScoreFactory.get_relationship_score-318"><span class="linenos">318</span></a>
</span><span id="RelationshipScoreFactory.get_relationship_score-319"><a href="#RelationshipScoreFactory.get_relationship_score-319"><span class="linenos">319</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_synastry_aspects</span><span class="p">:</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-320"><a href="#RelationshipScoreFactory.get_relationship_score-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_sun_main_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-321"><a href="#RelationshipScoreFactory.get_relationship_score-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_moon_conjunction</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-322"><a href="#RelationshipScoreFactory.get_relationship_score-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_moon_other_aspects</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-323"><a href="#RelationshipScoreFactory.get_relationship_score-323"><span class="linenos">323</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_sun_other_aspects</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-324"><a href="#RelationshipScoreFactory.get_relationship_score-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sun_ascendant_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-325"><a href="#RelationshipScoreFactory.get_relationship_score-325"><span class="linenos">325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_moon_ascendant_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-326"><a href="#RelationshipScoreFactory.get_relationship_score-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_venus_mars_aspect</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-327"><a href="#RelationshipScoreFactory.get_relationship_score-327"><span class="linenos">327</span></a>
</span><span id="RelationshipScoreFactory.get_relationship_score-328"><a href="#RelationshipScoreFactory.get_relationship_score-328"><span class="linenos">328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_relationship_score_description</span><span class="p">()</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-329"><a href="#RelationshipScoreFactory.get_relationship_score-329"><span class="linenos">329</span></a>
</span><span id="RelationshipScoreFactory.get_relationship_score-330"><a href="#RelationshipScoreFactory.get_relationship_score-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="n">RelationshipScoreModel</span><span class="p">(</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-331"><a href="#RelationshipScoreFactory.get_relationship_score-331"><span class="linenos">331</span></a>            <span class="n">score_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score_value</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-332"><a href="#RelationshipScoreFactory.get_relationship_score-332"><span class="linenos">332</span></a>            <span class="n">score_description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_description</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-333"><a href="#RelationshipScoreFactory.get_relationship_score-333"><span class="linenos">333</span></a>            <span class="n">is_destiny_sign</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_destiny_sign</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-334"><a href="#RelationshipScoreFactory.get_relationship_score-334"><span class="linenos">334</span></a>            <span class="n">aspects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relationship_score_aspects</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-335"><a href="#RelationshipScoreFactory.get_relationship_score-335"><span class="linenos">335</span></a>            <span class="n">score_breakdown</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="p">,</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-336"><a href="#RelationshipScoreFactory.get_relationship_score-336"><span class="linenos">336</span></a>            <span class="n">subjects</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_subject</span><span class="p">],</span>
</span><span id="RelationshipScoreFactory.get_relationship_score-337"><a href="#RelationshipScoreFactory.get_relationship_score-337"><span class="linenos">337</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the complete relationship score using all evaluation methods.</p>

<p>Returns:
    RelationshipScoreModel: Score object containing numerical value, description,
        destiny sign status, contributing aspects, and subject data.</p>
</div>


                            </div>
                </section>
                <section id="ReportGenerator">
                            <input id="ReportGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ReportGenerator</span>:

                <label class="view-source-button" for="ReportGenerator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReportGenerator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReportGenerator-46"><a href="#ReportGenerator-46"><span class="linenos"> 46</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ReportGenerator</span><span class="p">:</span>
</span><span id="ReportGenerator-47"><a href="#ReportGenerator-47"><span class="linenos"> 47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator-48"><a href="#ReportGenerator-48"><span class="linenos"> 48</span></a><span class="sd">    Generate textual reports for astrological data models with a structure that mirrors the</span>
</span><span id="ReportGenerator-49"><a href="#ReportGenerator-49"><span class="linenos"> 49</span></a><span class="sd">    chart-specific dispatch logic used in :class:`~kerykeion.charts.chart_drawer.ChartDrawer`.</span>
</span><span id="ReportGenerator-50"><a href="#ReportGenerator-50"><span class="linenos"> 50</span></a>
</span><span id="ReportGenerator-51"><a href="#ReportGenerator-51"><span class="linenos"> 51</span></a><span class="sd">    The generator accepts any of the chart data models handled by ``ChartDrawer`` as well as</span>
</span><span id="ReportGenerator-52"><a href="#ReportGenerator-52"><span class="linenos"> 52</span></a><span class="sd">    raw ``AstrologicalSubjectModel`` instances. The ``print_report`` method automatically</span>
</span><span id="ReportGenerator-53"><a href="#ReportGenerator-53"><span class="linenos"> 53</span></a><span class="sd">    selects the appropriate layout and sections depending on the underlying chart type.</span>
</span><span id="ReportGenerator-54"><a href="#ReportGenerator-54"><span class="linenos"> 54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ReportGenerator-55"><a href="#ReportGenerator-55"><span class="linenos"> 55</span></a>
</span><span id="ReportGenerator-56"><a href="#ReportGenerator-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ReportGenerator-57"><a href="#ReportGenerator-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReportGenerator-58"><a href="#ReportGenerator-58"><span class="linenos"> 58</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ChartDataModel</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="ReportGenerator-59"><a href="#ReportGenerator-59"><span class="linenos"> 59</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ReportGenerator-60"><a href="#ReportGenerator-60"><span class="linenos"> 60</span></a>        <span class="n">include_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ReportGenerator-61"><a href="#ReportGenerator-61"><span class="linenos"> 61</span></a>        <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator-62"><a href="#ReportGenerator-62"><span class="linenos"> 62</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-63"><a href="#ReportGenerator-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="ReportGenerator-64"><a href="#ReportGenerator-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_include_aspects_default</span> <span class="o">=</span> <span class="n">include_aspects</span>
</span><span id="ReportGenerator-65"><a href="#ReportGenerator-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_aspects_default</span> <span class="o">=</span> <span class="n">max_aspects</span>
</span><span id="ReportGenerator-66"><a href="#ReportGenerator-66"><span class="linenos"> 66</span></a>
</span><span id="ReportGenerator-67"><a href="#ReportGenerator-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator-68"><a href="#ReportGenerator-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span><span class="p">:</span> <span class="n">LiteralReportKind</span>
</span><span id="ReportGenerator-69"><a href="#ReportGenerator-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChartDataModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator-70"><a href="#ReportGenerator-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">:</span> <span class="n">SubjectLike</span>
</span><span id="ReportGenerator-71"><a href="#ReportGenerator-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator-72"><a href="#ReportGenerator-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-73"><a href="#ReportGenerator-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-74"><a href="#ReportGenerator-74"><span class="linenos"> 74</span></a>
</span><span id="ReportGenerator-75"><a href="#ReportGenerator-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_model</span><span class="p">()</span>
</span><span id="ReportGenerator-76"><a href="#ReportGenerator-76"><span class="linenos"> 76</span></a>
</span><span id="ReportGenerator-77"><a href="#ReportGenerator-77"><span class="linenos"> 77</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-78"><a href="#ReportGenerator-78"><span class="linenos"> 78</span></a>    <span class="c1"># Public API</span>
</span><span id="ReportGenerator-79"><a href="#ReportGenerator-79"><span class="linenos"> 79</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-80"><a href="#ReportGenerator-80"><span class="linenos"> 80</span></a>
</span><span id="ReportGenerator-81"><a href="#ReportGenerator-81"><span class="linenos"> 81</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span>
</span><span id="ReportGenerator-82"><a href="#ReportGenerator-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReportGenerator-83"><a href="#ReportGenerator-83"><span class="linenos"> 83</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ReportGenerator-84"><a href="#ReportGenerator-84"><span class="linenos"> 84</span></a>        <span class="n">include_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator-85"><a href="#ReportGenerator-85"><span class="linenos"> 85</span></a>        <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator-86"><a href="#ReportGenerator-86"><span class="linenos"> 86</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-87"><a href="#ReportGenerator-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator-88"><a href="#ReportGenerator-88"><span class="linenos"> 88</span></a><span class="sd">        Build the report content without printing it.</span>
</span><span id="ReportGenerator-89"><a href="#ReportGenerator-89"><span class="linenos"> 89</span></a>
</span><span id="ReportGenerator-90"><a href="#ReportGenerator-90"><span class="linenos"> 90</span></a><span class="sd">        Args:</span>
</span><span id="ReportGenerator-91"><a href="#ReportGenerator-91"><span class="linenos"> 91</span></a><span class="sd">            include_aspects: Override the default setting for including the aspects section.</span>
</span><span id="ReportGenerator-92"><a href="#ReportGenerator-92"><span class="linenos"> 92</span></a><span class="sd">            max_aspects: Override the default limit for the number of aspects displayed.</span>
</span><span id="ReportGenerator-93"><a href="#ReportGenerator-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReportGenerator-94"><a href="#ReportGenerator-94"><span class="linenos"> 94</span></a>        <span class="n">include_aspects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include_aspects_default</span> <span class="k">if</span> <span class="n">include_aspects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">include_aspects</span>
</span><span id="ReportGenerator-95"><a href="#ReportGenerator-95"><span class="linenos"> 95</span></a>        <span class="n">max_aspects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_aspects_default</span> <span class="k">if</span> <span class="n">max_aspects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_aspects</span>
</span><span id="ReportGenerator-96"><a href="#ReportGenerator-96"><span class="linenos"> 96</span></a>
</span><span id="ReportGenerator-97"><a href="#ReportGenerator-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">==</span> <span class="s2">&quot;subject&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-98"><a href="#ReportGenerator-98"><span class="linenos"> 98</span></a>            <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_subject_report</span><span class="p">()</span>
</span><span id="ReportGenerator-99"><a href="#ReportGenerator-99"><span class="linenos"> 99</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">==</span> <span class="s2">&quot;single_chart&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-100"><a href="#ReportGenerator-100"><span class="linenos">100</span></a>            <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_single_chart_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="n">include_aspects</span><span class="p">,</span> <span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">)</span>
</span><span id="ReportGenerator-101"><a href="#ReportGenerator-101"><span class="linenos">101</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-102"><a href="#ReportGenerator-102"><span class="linenos">102</span></a>            <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dual_chart_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="n">include_aspects</span><span class="p">,</span> <span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">)</span>
</span><span id="ReportGenerator-103"><a href="#ReportGenerator-103"><span class="linenos">103</span></a>
</span><span id="ReportGenerator-104"><a href="#ReportGenerator-104"><span class="linenos">104</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_title</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-105"><a href="#ReportGenerator-105"><span class="linenos">105</span></a>        <span class="n">full_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">title</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">section</span> <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span> <span class="k">if</span> <span class="n">section</span><span class="p">]]</span>
</span><span id="ReportGenerator-106"><a href="#ReportGenerator-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">full_sections</span><span class="p">)</span>
</span><span id="ReportGenerator-107"><a href="#ReportGenerator-107"><span class="linenos">107</span></a>
</span><span id="ReportGenerator-108"><a href="#ReportGenerator-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span>
</span><span id="ReportGenerator-109"><a href="#ReportGenerator-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReportGenerator-110"><a href="#ReportGenerator-110"><span class="linenos">110</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ReportGenerator-111"><a href="#ReportGenerator-111"><span class="linenos">111</span></a>        <span class="n">include_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator-112"><a href="#ReportGenerator-112"><span class="linenos">112</span></a>        <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator-113"><a href="#ReportGenerator-113"><span class="linenos">113</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-114"><a href="#ReportGenerator-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator-115"><a href="#ReportGenerator-115"><span class="linenos">115</span></a><span class="sd">        Print the generated report to stdout.</span>
</span><span id="ReportGenerator-116"><a href="#ReportGenerator-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReportGenerator-117"><a href="#ReportGenerator-117"><span class="linenos">117</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="n">include_aspects</span><span class="p">,</span> <span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">))</span>
</span><span id="ReportGenerator-118"><a href="#ReportGenerator-118"><span class="linenos">118</span></a>
</span><span id="ReportGenerator-119"><a href="#ReportGenerator-119"><span class="linenos">119</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-120"><a href="#ReportGenerator-120"><span class="linenos">120</span></a>    <span class="c1"># Internal initialisation helpers</span>
</span><span id="ReportGenerator-121"><a href="#ReportGenerator-121"><span class="linenos">121</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-122"><a href="#ReportGenerator-122"><span class="linenos">122</span></a>
</span><span id="ReportGenerator-123"><a href="#ReportGenerator-123"><span class="linenos">123</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-124"><a href="#ReportGenerator-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ReportGenerator-125"><a href="#ReportGenerator-125"><span class="linenos">125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">=</span> <span class="s2">&quot;subject&quot;</span>
</span><span id="ReportGenerator-126"><a href="#ReportGenerator-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="s2">&quot;Subject&quot;</span>
</span><span id="ReportGenerator-127"><a href="#ReportGenerator-127"><span class="linenos">127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="ReportGenerator-128"><a href="#ReportGenerator-128"><span class="linenos">128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator-129"><a href="#ReportGenerator-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="ReportGenerator-130"><a href="#ReportGenerator-130"><span class="linenos">130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-131"><a href="#ReportGenerator-131"><span class="linenos">131</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">SingleChartDataModel</span><span class="p">):</span>
</span><span id="ReportGenerator-132"><a href="#ReportGenerator-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">=</span> <span class="s2">&quot;single_chart&quot;</span>
</span><span id="ReportGenerator-133"><a href="#ReportGenerator-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ReportGenerator-134"><a href="#ReportGenerator-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="ReportGenerator-135"><a href="#ReportGenerator-135"><span class="linenos">135</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">subject</span>
</span><span id="ReportGenerator-136"><a href="#ReportGenerator-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="ReportGenerator-137"><a href="#ReportGenerator-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span> <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">active_aspects</span><span class="p">]</span>
</span><span id="ReportGenerator-138"><a href="#ReportGenerator-138"><span class="linenos">138</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">):</span>
</span><span id="ReportGenerator-139"><a href="#ReportGenerator-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">=</span> <span class="s2">&quot;dual_chart&quot;</span>
</span><span id="ReportGenerator-140"><a href="#ReportGenerator-140"><span class="linenos">140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chart_type</span>
</span><span id="ReportGenerator-141"><a href="#ReportGenerator-141"><span class="linenos">141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="ReportGenerator-142"><a href="#ReportGenerator-142"><span class="linenos">142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">first_subject</span>
</span><span id="ReportGenerator-143"><a href="#ReportGenerator-143"><span class="linenos">143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">second_subject</span>
</span><span id="ReportGenerator-144"><a href="#ReportGenerator-144"><span class="linenos">144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="ReportGenerator-145"><a href="#ReportGenerator-145"><span class="linenos">145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspect</span><span class="p">)</span> <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">active_aspects</span><span class="p">]</span>
</span><span id="ReportGenerator-146"><a href="#ReportGenerator-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-147"><a href="#ReportGenerator-147"><span class="linenos">147</span></a>            <span class="n">supported</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ReportGenerator-148"><a href="#ReportGenerator-148"><span class="linenos">148</span></a>                <span class="s2">&quot;AstrologicalSubjectModel, SingleChartDataModel, DualChartDataModel&quot;</span>
</span><span id="ReportGenerator-149"><a href="#ReportGenerator-149"><span class="linenos">149</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-150"><a href="#ReportGenerator-150"><span class="linenos">150</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported model type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span><span class="si">!r}</span><span class="s2">. Supported models: </span><span class="si">{</span><span class="n">supported</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-151"><a href="#ReportGenerator-151"><span class="linenos">151</span></a>
</span><span id="ReportGenerator-152"><a href="#ReportGenerator-152"><span class="linenos">152</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-153"><a href="#ReportGenerator-153"><span class="linenos">153</span></a>    <span class="c1"># Report builders</span>
</span><span id="ReportGenerator-154"><a href="#ReportGenerator-154"><span class="linenos">154</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-155"><a href="#ReportGenerator-155"><span class="linenos">155</span></a>
</span><span id="ReportGenerator-156"><a href="#ReportGenerator-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_subject_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ReportGenerator-157"><a href="#ReportGenerator-157"><span class="linenos">157</span></a>        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-158"><a href="#ReportGenerator-158"><span class="linenos">158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_subject_data_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="s2">&quot;Astrological Subject&quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-159"><a href="#ReportGenerator-159"><span class="linenos">159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_celestial_points_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="s2">&quot;Celestial Points&quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-160"><a href="#ReportGenerator-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_houses_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="s2">&quot;Houses&quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-161"><a href="#ReportGenerator-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_lunar_phase_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">),</span>
</span><span id="ReportGenerator-162"><a href="#ReportGenerator-162"><span class="linenos">162</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-163"><a href="#ReportGenerator-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">sections</span>
</span><span id="ReportGenerator-164"><a href="#ReportGenerator-164"><span class="linenos">164</span></a>
</span><span id="ReportGenerator-165"><a href="#ReportGenerator-165"><span class="linenos">165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_single_chart_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">include_aspects</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ReportGenerator-166"><a href="#ReportGenerator-166"><span class="linenos">166</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ReportGenerator-167"><a href="#ReportGenerator-167"><span class="linenos">167</span></a>        <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-168"><a href="#ReportGenerator-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_subject_data_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject_label</span><span class="p">()),</span>
</span><span id="ReportGenerator-169"><a href="#ReportGenerator-169"><span class="linenos">169</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-170"><a href="#ReportGenerator-170"><span class="linenos">170</span></a>
</span><span id="ReportGenerator-171"><a href="#ReportGenerator-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="ReportGenerator-172"><a href="#ReportGenerator-172"><span class="linenos">172</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-173"><a href="#ReportGenerator-173"><span class="linenos">173</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_subject_data_report</span><span class="p">(</span>
</span><span id="ReportGenerator-174"><a href="#ReportGenerator-174"><span class="linenos">174</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">first_subject</span><span class="p">,</span>
</span><span id="ReportGenerator-175"><a href="#ReportGenerator-175"><span class="linenos">175</span></a>                    <span class="s2">&quot;Composite  First Subject&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-176"><a href="#ReportGenerator-176"><span class="linenos">176</span></a>                <span class="p">)</span>
</span><span id="ReportGenerator-177"><a href="#ReportGenerator-177"><span class="linenos">177</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-178"><a href="#ReportGenerator-178"><span class="linenos">178</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-179"><a href="#ReportGenerator-179"><span class="linenos">179</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_subject_data_report</span><span class="p">(</span>
</span><span id="ReportGenerator-180"><a href="#ReportGenerator-180"><span class="linenos">180</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">second_subject</span><span class="p">,</span>
</span><span id="ReportGenerator-181"><a href="#ReportGenerator-181"><span class="linenos">181</span></a>                    <span class="s2">&quot;Composite  Second Subject&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-182"><a href="#ReportGenerator-182"><span class="linenos">182</span></a>                <span class="p">)</span>
</span><span id="ReportGenerator-183"><a href="#ReportGenerator-183"><span class="linenos">183</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-184"><a href="#ReportGenerator-184"><span class="linenos">184</span></a>
</span><span id="ReportGenerator-185"><a href="#ReportGenerator-185"><span class="linenos">185</span></a>        <span class="n">sections</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
</span><span id="ReportGenerator-186"><a href="#ReportGenerator-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_celestial_points_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject_label</span><span class="p">()</span><span class="si">}</span><span class="s2"> Celestial Points&quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-187"><a href="#ReportGenerator-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_houses_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject_label</span><span class="p">()</span><span class="si">}</span><span class="s2"> Houses&quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-188"><a href="#ReportGenerator-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_lunar_phase_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">),</span>
</span><span id="ReportGenerator-189"><a href="#ReportGenerator-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_elements_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-190"><a href="#ReportGenerator-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_qualities_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-191"><a href="#ReportGenerator-191"><span class="linenos">191</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_configuration_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-192"><a href="#ReportGenerator-192"><span class="linenos">192</span></a>        <span class="p">])</span>
</span><span id="ReportGenerator-193"><a href="#ReportGenerator-193"><span class="linenos">193</span></a>
</span><span id="ReportGenerator-194"><a href="#ReportGenerator-194"><span class="linenos">194</span></a>        <span class="k">if</span> <span class="n">include_aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-195"><a href="#ReportGenerator-195"><span class="linenos">195</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aspects_report</span><span class="p">(</span><span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">))</span>
</span><span id="ReportGenerator-196"><a href="#ReportGenerator-196"><span class="linenos">196</span></a>
</span><span id="ReportGenerator-197"><a href="#ReportGenerator-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">sections</span>
</span><span id="ReportGenerator-198"><a href="#ReportGenerator-198"><span class="linenos">198</span></a>
</span><span id="ReportGenerator-199"><a href="#ReportGenerator-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_dual_chart_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">include_aspects</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ReportGenerator-200"><a href="#ReportGenerator-200"><span class="linenos">200</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ReportGenerator-201"><a href="#ReportGenerator-201"><span class="linenos">201</span></a>        <span class="n">primary_label</span><span class="p">,</span> <span class="n">secondary_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject_role_labels</span><span class="p">()</span>
</span><span id="ReportGenerator-202"><a href="#ReportGenerator-202"><span class="linenos">202</span></a>
</span><span id="ReportGenerator-203"><a href="#ReportGenerator-203"><span class="linenos">203</span></a>        <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-204"><a href="#ReportGenerator-204"><span class="linenos">204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_subject_data_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="n">primary_label</span><span class="p">),</span>
</span><span id="ReportGenerator-205"><a href="#ReportGenerator-205"><span class="linenos">205</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-206"><a href="#ReportGenerator-206"><span class="linenos">206</span></a>
</span><span id="ReportGenerator-207"><a href="#ReportGenerator-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-208"><a href="#ReportGenerator-208"><span class="linenos">208</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject_data_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="p">,</span> <span class="n">secondary_label</span><span class="p">))</span>
</span><span id="ReportGenerator-209"><a href="#ReportGenerator-209"><span class="linenos">209</span></a>
</span><span id="ReportGenerator-210"><a href="#ReportGenerator-210"><span class="linenos">210</span></a>        <span class="n">sections</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
</span><span id="ReportGenerator-211"><a href="#ReportGenerator-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_celestial_points_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">primary_label</span><span class="si">}</span><span class="s2"> Celestial Points&quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-212"><a href="#ReportGenerator-212"><span class="linenos">212</span></a>        <span class="p">])</span>
</span><span id="ReportGenerator-213"><a href="#ReportGenerator-213"><span class="linenos">213</span></a>
</span><span id="ReportGenerator-214"><a href="#ReportGenerator-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-215"><a href="#ReportGenerator-215"><span class="linenos">215</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-216"><a href="#ReportGenerator-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_celestial_points_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">secondary_label</span><span class="si">}</span><span class="s2"> Celestial Points&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-217"><a href="#ReportGenerator-217"><span class="linenos">217</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-218"><a href="#ReportGenerator-218"><span class="linenos">218</span></a>
</span><span id="ReportGenerator-219"><a href="#ReportGenerator-219"><span class="linenos">219</span></a>        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_houses_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">primary_label</span><span class="si">}</span><span class="s2"> Houses&quot;</span><span class="p">))</span>
</span><span id="ReportGenerator-220"><a href="#ReportGenerator-220"><span class="linenos">220</span></a>
</span><span id="ReportGenerator-221"><a href="#ReportGenerator-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-222"><a href="#ReportGenerator-222"><span class="linenos">222</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_houses_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">secondary_label</span><span class="si">}</span><span class="s2"> Houses&quot;</span><span class="p">))</span>
</span><span id="ReportGenerator-223"><a href="#ReportGenerator-223"><span class="linenos">223</span></a>
</span><span id="ReportGenerator-224"><a href="#ReportGenerator-224"><span class="linenos">224</span></a>        <span class="n">sections</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
</span><span id="ReportGenerator-225"><a href="#ReportGenerator-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_lunar_phase_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">),</span>
</span><span id="ReportGenerator-226"><a href="#ReportGenerator-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_elements_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-227"><a href="#ReportGenerator-227"><span class="linenos">227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_qualities_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-228"><a href="#ReportGenerator-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_house_comparison_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-229"><a href="#ReportGenerator-229"><span class="linenos">229</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_relationship_score_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-230"><a href="#ReportGenerator-230"><span class="linenos">230</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_active_configuration_report</span><span class="p">(),</span>
</span><span id="ReportGenerator-231"><a href="#ReportGenerator-231"><span class="linenos">231</span></a>        <span class="p">])</span>
</span><span id="ReportGenerator-232"><a href="#ReportGenerator-232"><span class="linenos">232</span></a>
</span><span id="ReportGenerator-233"><a href="#ReportGenerator-233"><span class="linenos">233</span></a>        <span class="k">if</span> <span class="n">include_aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-234"><a href="#ReportGenerator-234"><span class="linenos">234</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aspects_report</span><span class="p">(</span><span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">))</span>
</span><span id="ReportGenerator-235"><a href="#ReportGenerator-235"><span class="linenos">235</span></a>
</span><span id="ReportGenerator-236"><a href="#ReportGenerator-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="n">sections</span>
</span><span id="ReportGenerator-237"><a href="#ReportGenerator-237"><span class="linenos">237</span></a>
</span><span id="ReportGenerator-238"><a href="#ReportGenerator-238"><span class="linenos">238</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-239"><a href="#ReportGenerator-239"><span class="linenos">239</span></a>    <span class="c1"># Section helpers</span>
</span><span id="ReportGenerator-240"><a href="#ReportGenerator-240"><span class="linenos">240</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-241"><a href="#ReportGenerator-241"><span class="linenos">241</span></a>
</span><span id="ReportGenerator-242"><a href="#ReportGenerator-242"><span class="linenos">242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_title</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-243"><a href="#ReportGenerator-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">==</span> <span class="s2">&quot;subject&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-244"><a href="#ReportGenerator-244"><span class="linenos">244</span></a>            <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Subject Report&quot;</span>
</span><span id="ReportGenerator-245"><a href="#ReportGenerator-245"><span class="linenos">245</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Natal&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-246"><a href="#ReportGenerator-246"><span class="linenos">246</span></a>            <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Natal Chart Report&quot;</span>
</span><span id="ReportGenerator-247"><a href="#ReportGenerator-247"><span class="linenos">247</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-248"><a href="#ReportGenerator-248"><span class="linenos">248</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="ReportGenerator-249"><a href="#ReportGenerator-249"><span class="linenos">249</span></a>                <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span>
</span><span id="ReportGenerator-250"><a href="#ReportGenerator-250"><span class="linenos">250</span></a>                <span class="n">second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span>
</span><span id="ReportGenerator-251"><a href="#ReportGenerator-251"><span class="linenos">251</span></a>                <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">second</span><span class="si">}</span><span class="s2">  Composite Report&quot;</span>
</span><span id="ReportGenerator-252"><a href="#ReportGenerator-252"><span class="linenos">252</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-253"><a href="#ReportGenerator-253"><span class="linenos">253</span></a>                <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Composite Report&quot;</span>
</span><span id="ReportGenerator-254"><a href="#ReportGenerator-254"><span class="linenos">254</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-255"><a href="#ReportGenerator-255"><span class="linenos">255</span></a>            <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_year</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span>
</span><span id="ReportGenerator-256"><a href="#ReportGenerator-256"><span class="linenos">256</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-257"><a href="#ReportGenerator-257"><span class="linenos">257</span></a>                <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Solar Return </span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="ReportGenerator-258"><a href="#ReportGenerator-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-259"><a href="#ReportGenerator-259"><span class="linenos">259</span></a>                <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Lunar Return </span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="ReportGenerator-260"><a href="#ReportGenerator-260"><span class="linenos">260</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-261"><a href="#ReportGenerator-261"><span class="linenos">261</span></a>            <span class="n">date_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_date_iso</span><span class="p">(</span>
</span><span id="ReportGenerator-262"><a href="#ReportGenerator-262"><span class="linenos">262</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="ReportGenerator-263"><a href="#ReportGenerator-263"><span class="linenos">263</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-264"><a href="#ReportGenerator-264"><span class="linenos">264</span></a>            <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Transit </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="ReportGenerator-265"><a href="#ReportGenerator-265"><span class="linenos">265</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-266"><a href="#ReportGenerator-266"><span class="linenos">266</span></a>            <span class="n">second_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
</span><span id="ReportGenerator-267"><a href="#ReportGenerator-267"><span class="linenos">267</span></a>            <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">second_name</span><span class="si">}</span><span class="s2">  Synastry Report&quot;</span>
</span><span id="ReportGenerator-268"><a href="#ReportGenerator-268"><span class="linenos">268</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-269"><a href="#ReportGenerator-269"><span class="linenos">269</span></a>            <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_year</span><span class="p">(</span>
</span><span id="ReportGenerator-270"><a href="#ReportGenerator-270"><span class="linenos">270</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="ReportGenerator-271"><a href="#ReportGenerator-271"><span class="linenos">271</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-272"><a href="#ReportGenerator-272"><span class="linenos">272</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-273"><a href="#ReportGenerator-273"><span class="linenos">273</span></a>                <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Solar Return Comparison </span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="ReportGenerator-274"><a href="#ReportGenerator-274"><span class="linenos">274</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-275"><a href="#ReportGenerator-275"><span class="linenos">275</span></a>                <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Lunar Return Comparison </span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="ReportGenerator-276"><a href="#ReportGenerator-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-277"><a href="#ReportGenerator-277"><span class="linenos">277</span></a>            <span class="n">base_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">  Chart Report&quot;</span>
</span><span id="ReportGenerator-278"><a href="#ReportGenerator-278"><span class="linenos">278</span></a>
</span><span id="ReportGenerator-279"><a href="#ReportGenerator-279"><span class="linenos">279</span></a>        <span class="n">separator</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_title</span><span class="p">)</span>
</span><span id="ReportGenerator-280"><a href="#ReportGenerator-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">separator</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">base_title</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">separator</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ReportGenerator-281"><a href="#ReportGenerator-281"><span class="linenos">281</span></a>
</span><span id="ReportGenerator-282"><a href="#ReportGenerator-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_primary_subject_label</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-283"><a href="#ReportGenerator-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Composite&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-284"><a href="#ReportGenerator-284"><span class="linenos">284</span></a>            <span class="k">return</span> <span class="s2">&quot;Composite Chart&quot;</span>
</span><span id="ReportGenerator-285"><a href="#ReportGenerator-285"><span class="linenos">285</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;SingleReturnChart&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-286"><a href="#ReportGenerator-286"><span class="linenos">286</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="o">.</span><span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;Solar&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-287"><a href="#ReportGenerator-287"><span class="linenos">287</span></a>                <span class="k">return</span> <span class="s2">&quot;Solar Return Chart&quot;</span>
</span><span id="ReportGenerator-288"><a href="#ReportGenerator-288"><span class="linenos">288</span></a>            <span class="k">return</span> <span class="s2">&quot;Lunar Return Chart&quot;</span>
</span><span id="ReportGenerator-289"><a href="#ReportGenerator-289"><span class="linenos">289</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Chart&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ReportGenerator-290"><a href="#ReportGenerator-290"><span class="linenos">290</span></a>
</span><span id="ReportGenerator-291"><a href="#ReportGenerator-291"><span class="linenos">291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_subject_role_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="ReportGenerator-292"><a href="#ReportGenerator-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-293"><a href="#ReportGenerator-293"><span class="linenos">293</span></a>            <span class="k">return</span> <span class="s2">&quot;Natal Subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit Subject&quot;</span>
</span><span id="ReportGenerator-294"><a href="#ReportGenerator-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;Synastry&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-295"><a href="#ReportGenerator-295"><span class="linenos">295</span></a>            <span class="k">return</span> <span class="s2">&quot;First Subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Second Subject&quot;</span>
</span><span id="ReportGenerator-296"><a href="#ReportGenerator-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">==</span> <span class="s2">&quot;DualReturnChart&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator-297"><a href="#ReportGenerator-297"><span class="linenos">297</span></a>            <span class="k">return</span> <span class="s2">&quot;Natal Subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Return Subject&quot;</span>
</span><span id="ReportGenerator-298"><a href="#ReportGenerator-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="s2">&quot;Primary Subject&quot;</span><span class="p">,</span> <span class="s2">&quot;Secondary Subject&quot;</span>
</span><span id="ReportGenerator-299"><a href="#ReportGenerator-299"><span class="linenos">299</span></a>
</span><span id="ReportGenerator-300"><a href="#ReportGenerator-300"><span class="linenos">300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_subject_data_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">SubjectLike</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-301"><a href="#ReportGenerator-301"><span class="linenos">301</span></a>        <span class="n">birth_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">subject</span><span class="o">.</span><span class="n">name</span><span class="p">]]</span>
</span><span id="ReportGenerator-302"><a href="#ReportGenerator-302"><span class="linenos">302</span></a>
</span><span id="ReportGenerator-303"><a href="#ReportGenerator-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="ReportGenerator-304"><a href="#ReportGenerator-304"><span class="linenos">304</span></a>            <span class="n">composite_members</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">first_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">second_subject</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ReportGenerator-305"><a href="#ReportGenerator-305"><span class="linenos">305</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Composite Members&quot;</span><span class="p">,</span> <span class="n">composite_members</span><span class="p">])</span>
</span><span id="ReportGenerator-306"><a href="#ReportGenerator-306"><span class="linenos">306</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Composite Type&quot;</span><span class="p">,</span> <span class="n">subject</span><span class="o">.</span><span class="n">composite_chart_type</span><span class="p">])</span>
</span><span id="ReportGenerator-307"><a href="#ReportGenerator-307"><span class="linenos">307</span></a>
</span><span id="ReportGenerator-308"><a href="#ReportGenerator-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">):</span>
</span><span id="ReportGenerator-309"><a href="#ReportGenerator-309"><span class="linenos">309</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Return Type&quot;</span><span class="p">,</span> <span class="n">subject</span><span class="o">.</span><span class="n">return_type</span><span class="p">])</span>
</span><span id="ReportGenerator-310"><a href="#ReportGenerator-310"><span class="linenos">310</span></a>
</span><span id="ReportGenerator-311"><a href="#ReportGenerator-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ReportGenerator-312"><a href="#ReportGenerator-312"><span class="linenos">312</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-313"><a href="#ReportGenerator-313"><span class="linenos">313</span></a>                <span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="ReportGenerator-314"><a href="#ReportGenerator-314"><span class="linenos">314</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-315"><a href="#ReportGenerator-315"><span class="linenos">315</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">subject</span><span class="o">.</span><span class="n">minute</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
</span><span id="ReportGenerator-316"><a href="#ReportGenerator-316"><span class="linenos">316</span></a>
</span><span id="ReportGenerator-317"><a href="#ReportGenerator-317"><span class="linenos">317</span></a>        <span class="n">city</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-318"><a href="#ReportGenerator-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">city</span><span class="p">:</span>
</span><span id="ReportGenerator-319"><a href="#ReportGenerator-319"><span class="linenos">319</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;City&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">city</span><span class="p">)])</span>
</span><span id="ReportGenerator-320"><a href="#ReportGenerator-320"><span class="linenos">320</span></a>
</span><span id="ReportGenerator-321"><a href="#ReportGenerator-321"><span class="linenos">321</span></a>        <span class="n">nation</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;nation&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-322"><a href="#ReportGenerator-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">nation</span><span class="p">:</span>
</span><span id="ReportGenerator-323"><a href="#ReportGenerator-323"><span class="linenos">323</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Nation&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nation</span><span class="p">)])</span>
</span><span id="ReportGenerator-324"><a href="#ReportGenerator-324"><span class="linenos">324</span></a>
</span><span id="ReportGenerator-325"><a href="#ReportGenerator-325"><span class="linenos">325</span></a>        <span class="n">lat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-326"><a href="#ReportGenerator-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-327"><a href="#ReportGenerator-327"><span class="linenos">327</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Latitude&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
</span><span id="ReportGenerator-328"><a href="#ReportGenerator-328"><span class="linenos">328</span></a>
</span><span id="ReportGenerator-329"><a href="#ReportGenerator-329"><span class="linenos">329</span></a>        <span class="n">lng</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-330"><a href="#ReportGenerator-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-331"><a href="#ReportGenerator-331"><span class="linenos">331</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Longitude&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lng</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
</span><span id="ReportGenerator-332"><a href="#ReportGenerator-332"><span class="linenos">332</span></a>
</span><span id="ReportGenerator-333"><a href="#ReportGenerator-333"><span class="linenos">333</span></a>        <span class="n">tz_str</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;tz_str&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-334"><a href="#ReportGenerator-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">tz_str</span><span class="p">:</span>
</span><span id="ReportGenerator-335"><a href="#ReportGenerator-335"><span class="linenos">335</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Timezone&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tz_str</span><span class="p">)])</span>
</span><span id="ReportGenerator-336"><a href="#ReportGenerator-336"><span class="linenos">336</span></a>
</span><span id="ReportGenerator-337"><a href="#ReportGenerator-337"><span class="linenos">337</span></a>        <span class="n">day_of_week</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;day_of_week&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-338"><a href="#ReportGenerator-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">day_of_week</span><span class="p">:</span>
</span><span id="ReportGenerator-339"><a href="#ReportGenerator-339"><span class="linenos">339</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Day of Week&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">day_of_week</span><span class="p">)])</span>
</span><span id="ReportGenerator-340"><a href="#ReportGenerator-340"><span class="linenos">340</span></a>
</span><span id="ReportGenerator-341"><a href="#ReportGenerator-341"><span class="linenos">341</span></a>        <span class="n">iso_local</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;iso_formatted_local_datetime&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-342"><a href="#ReportGenerator-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">iso_local</span><span class="p">:</span>
</span><span id="ReportGenerator-343"><a href="#ReportGenerator-343"><span class="linenos">343</span></a>            <span class="n">birth_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;ISO Local Datetime&quot;</span><span class="p">,</span> <span class="n">iso_local</span><span class="p">])</span>
</span><span id="ReportGenerator-344"><a href="#ReportGenerator-344"><span class="linenos">344</span></a>
</span><span id="ReportGenerator-345"><a href="#ReportGenerator-345"><span class="linenos">345</span></a>        <span class="n">settings_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Setting&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-346"><a href="#ReportGenerator-346"><span class="linenos">346</span></a>        <span class="n">settings_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Zodiac Type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">zodiac_type</span><span class="p">)])</span>
</span><span id="ReportGenerator-347"><a href="#ReportGenerator-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;sidereal_mode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ReportGenerator-348"><a href="#ReportGenerator-348"><span class="linenos">348</span></a>            <span class="n">settings_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Sidereal Mode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">sidereal_mode</span><span class="p">)])</span>
</span><span id="ReportGenerator-349"><a href="#ReportGenerator-349"><span class="linenos">349</span></a>        <span class="n">settings_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Houses System&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">houses_system_name</span><span class="p">)])</span>
</span><span id="ReportGenerator-350"><a href="#ReportGenerator-350"><span class="linenos">350</span></a>        <span class="n">settings_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Perspective Type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">perspective_type</span><span class="p">)])</span>
</span><span id="ReportGenerator-351"><a href="#ReportGenerator-351"><span class="linenos">351</span></a>
</span><span id="ReportGenerator-352"><a href="#ReportGenerator-352"><span class="linenos">352</span></a>        <span class="n">julian_day</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;julian_day&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-353"><a href="#ReportGenerator-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="n">julian_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-354"><a href="#ReportGenerator-354"><span class="linenos">354</span></a>            <span class="n">settings_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Julian Day&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">julian_day</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
</span><span id="ReportGenerator-355"><a href="#ReportGenerator-355"><span class="linenos">355</span></a>
</span><span id="ReportGenerator-356"><a href="#ReportGenerator-356"><span class="linenos">356</span></a>        <span class="n">active_points</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;active_points&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-357"><a href="#ReportGenerator-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="ReportGenerator-358"><a href="#ReportGenerator-358"><span class="linenos">358</span></a>            <span class="n">settings_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Active Points Count&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">active_points</span><span class="p">))])</span>
</span><span id="ReportGenerator-359"><a href="#ReportGenerator-359"><span class="linenos">359</span></a>
</span><span id="ReportGenerator-360"><a href="#ReportGenerator-360"><span class="linenos">360</span></a>        <span class="n">birth_table</span> <span class="o">=</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">birth_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">  Birth Data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-361"><a href="#ReportGenerator-361"><span class="linenos">361</span></a>        <span class="n">settings_table</span> <span class="o">=</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">settings_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">  Settings&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-362"><a href="#ReportGenerator-362"><span class="linenos">362</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">birth_table</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">settings_table</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ReportGenerator-363"><a href="#ReportGenerator-363"><span class="linenos">363</span></a>
</span><span id="ReportGenerator-364"><a href="#ReportGenerator-364"><span class="linenos">364</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_celestial_points_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">SubjectLike</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-365"><a href="#ReportGenerator-365"><span class="linenos">365</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_celestial_points</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="ReportGenerator-366"><a href="#ReportGenerator-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span><span class="p">:</span>
</span><span id="ReportGenerator-367"><a href="#ReportGenerator-367"><span class="linenos">367</span></a>            <span class="k">return</span> <span class="s2">&quot;No celestial points data available.&quot;</span>
</span><span id="ReportGenerator-368"><a href="#ReportGenerator-368"><span class="linenos">368</span></a>
</span><span id="ReportGenerator-369"><a href="#ReportGenerator-369"><span class="linenos">369</span></a>        <span class="n">main_planets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="s2">&quot;Mercury&quot;</span><span class="p">,</span> <span class="s2">&quot;Venus&quot;</span><span class="p">,</span> <span class="s2">&quot;Mars&quot;</span><span class="p">,</span> <span class="s2">&quot;Jupiter&quot;</span><span class="p">,</span> <span class="s2">&quot;Saturn&quot;</span><span class="p">,</span> <span class="s2">&quot;Uranus&quot;</span><span class="p">,</span> <span class="s2">&quot;Neptune&quot;</span><span class="p">,</span> <span class="s2">&quot;Pluto&quot;</span><span class="p">]</span>
</span><span id="ReportGenerator-370"><a href="#ReportGenerator-370"><span class="linenos">370</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mean_North_Lunar_Node&quot;</span><span class="p">,</span> <span class="s2">&quot;True_North_Lunar_Node&quot;</span><span class="p">]</span>
</span><span id="ReportGenerator-371"><a href="#ReportGenerator-371"><span class="linenos">371</span></a>        <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ascendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium_Coeli&quot;</span><span class="p">,</span> <span class="s2">&quot;Descendant&quot;</span><span class="p">,</span> <span class="s2">&quot;Imum_Coeli&quot;</span><span class="p">]</span>
</span><span id="ReportGenerator-372"><a href="#ReportGenerator-372"><span class="linenos">372</span></a>
</span><span id="ReportGenerator-373"><a href="#ReportGenerator-373"><span class="linenos">373</span></a>        <span class="n">sorted_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-374"><a href="#ReportGenerator-374"><span class="linenos">374</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">angles</span> <span class="o">+</span> <span class="n">main_planets</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="ReportGenerator-375"><a href="#ReportGenerator-375"><span class="linenos">375</span></a>            <span class="n">sorted_points</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">])</span>
</span><span id="ReportGenerator-376"><a href="#ReportGenerator-376"><span class="linenos">376</span></a>
</span><span id="ReportGenerator-377"><a href="#ReportGenerator-377"><span class="linenos">377</span></a>        <span class="n">used_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">angles</span> <span class="o">+</span> <span class="n">main_planets</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">)</span>
</span><span id="ReportGenerator-378"><a href="#ReportGenerator-378"><span class="linenos">378</span></a>        <span class="n">sorted_points</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_names</span><span class="p">])</span>
</span><span id="ReportGenerator-379"><a href="#ReportGenerator-379"><span class="linenos">379</span></a>
</span><span id="ReportGenerator-380"><a href="#ReportGenerator-380"><span class="linenos">380</span></a>        <span class="n">celestial_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;Sign&quot;</span><span class="p">,</span> <span class="s2">&quot;Position&quot;</span><span class="p">,</span> <span class="s2">&quot;Speed&quot;</span><span class="p">,</span> <span class="s2">&quot;Decl.&quot;</span><span class="p">,</span> <span class="s2">&quot;Ret.&quot;</span><span class="p">,</span> <span class="s2">&quot;House&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-381"><a href="#ReportGenerator-381"><span class="linenos">381</span></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">sorted_points</span><span class="p">:</span>
</span><span id="ReportGenerator-382"><a href="#ReportGenerator-382"><span class="linenos">382</span></a>            <span class="n">speed_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">speed</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">/d&quot;</span> <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="ReportGenerator-383"><a href="#ReportGenerator-383"><span class="linenos">383</span></a>            <span class="n">decl_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">declination</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">declination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="ReportGenerator-384"><a href="#ReportGenerator-384"><span class="linenos">384</span></a>            <span class="n">ret_str</span> <span class="o">=</span> <span class="s2">&quot;R&quot;</span> <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">retrograde</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span>
</span><span id="ReportGenerator-385"><a href="#ReportGenerator-385"><span class="linenos">385</span></a>            <span class="n">house_str</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">house</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">house</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span>
</span><span id="ReportGenerator-386"><a href="#ReportGenerator-386"><span class="linenos">386</span></a>            <span class="n">celestial_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-387"><a href="#ReportGenerator-387"><span class="linenos">387</span></a>                <span class="n">point</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-388"><a href="#ReportGenerator-388"><span class="linenos">388</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">sign</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">emoji</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-389"><a href="#ReportGenerator-389"><span class="linenos">389</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">position</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-390"><a href="#ReportGenerator-390"><span class="linenos">390</span></a>                <span class="n">speed_str</span><span class="p">,</span>
</span><span id="ReportGenerator-391"><a href="#ReportGenerator-391"><span class="linenos">391</span></a>                <span class="n">decl_str</span><span class="p">,</span>
</span><span id="ReportGenerator-392"><a href="#ReportGenerator-392"><span class="linenos">392</span></a>                <span class="n">ret_str</span><span class="p">,</span>
</span><span id="ReportGenerator-393"><a href="#ReportGenerator-393"><span class="linenos">393</span></a>                <span class="n">house_str</span><span class="p">,</span>
</span><span id="ReportGenerator-394"><a href="#ReportGenerator-394"><span class="linenos">394</span></a>            <span class="p">])</span>
</span><span id="ReportGenerator-395"><a href="#ReportGenerator-395"><span class="linenos">395</span></a>
</span><span id="ReportGenerator-396"><a href="#ReportGenerator-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">celestial_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-397"><a href="#ReportGenerator-397"><span class="linenos">397</span></a>
</span><span id="ReportGenerator-398"><a href="#ReportGenerator-398"><span class="linenos">398</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_collect_celestial_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">SubjectLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">KerykeionPointModel</span><span class="p">]:</span>
</span><span id="ReportGenerator-399"><a href="#ReportGenerator-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">):</span>
</span><span id="ReportGenerator-400"><a href="#ReportGenerator-400"><span class="linenos">400</span></a>            <span class="k">return</span> <span class="n">get_available_astrological_points_list</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
</span><span id="ReportGenerator-401"><a href="#ReportGenerator-401"><span class="linenos">401</span></a>
</span><span id="ReportGenerator-402"><a href="#ReportGenerator-402"><span class="linenos">402</span></a>        <span class="n">points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">KerykeionPointModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-403"><a href="#ReportGenerator-403"><span class="linenos">403</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;active_points&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-404"><a href="#ReportGenerator-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="ReportGenerator-405"><a href="#ReportGenerator-405"><span class="linenos">405</span></a>            <span class="k">return</span> <span class="n">points</span>
</span><span id="ReportGenerator-406"><a href="#ReportGenerator-406"><span class="linenos">406</span></a>
</span><span id="ReportGenerator-407"><a href="#ReportGenerator-407"><span class="linenos">407</span></a>        <span class="k">for</span> <span class="n">point_name</span> <span class="ow">in</span> <span class="n">active_points</span><span class="p">:</span>
</span><span id="ReportGenerator-408"><a href="#ReportGenerator-408"><span class="linenos">408</span></a>            <span class="n">attr_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">point_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="ReportGenerator-409"><a href="#ReportGenerator-409"><span class="linenos">409</span></a>            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-410"><a href="#ReportGenerator-410"><span class="linenos">410</span></a>            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-411"><a href="#ReportGenerator-411"><span class="linenos">411</span></a>                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
</span><span id="ReportGenerator-412"><a href="#ReportGenerator-412"><span class="linenos">412</span></a>
</span><span id="ReportGenerator-413"><a href="#ReportGenerator-413"><span class="linenos">413</span></a>        <span class="k">return</span> <span class="n">points</span>
</span><span id="ReportGenerator-414"><a href="#ReportGenerator-414"><span class="linenos">414</span></a>
</span><span id="ReportGenerator-415"><a href="#ReportGenerator-415"><span class="linenos">415</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_houses_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">SubjectLike</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-416"><a href="#ReportGenerator-416"><span class="linenos">416</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ReportGenerator-417"><a href="#ReportGenerator-417"><span class="linenos">417</span></a>            <span class="n">houses</span> <span class="o">=</span> <span class="n">get_houses_list</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="ReportGenerator-418"><a href="#ReportGenerator-418"><span class="linenos">418</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ReportGenerator-419"><a href="#ReportGenerator-419"><span class="linenos">419</span></a>            <span class="k">return</span> <span class="s2">&quot;No houses data available.&quot;</span>
</span><span id="ReportGenerator-420"><a href="#ReportGenerator-420"><span class="linenos">420</span></a>
</span><span id="ReportGenerator-421"><a href="#ReportGenerator-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">houses</span><span class="p">:</span>
</span><span id="ReportGenerator-422"><a href="#ReportGenerator-422"><span class="linenos">422</span></a>            <span class="k">return</span> <span class="s2">&quot;No houses data available.&quot;</span>
</span><span id="ReportGenerator-423"><a href="#ReportGenerator-423"><span class="linenos">423</span></a>
</span><span id="ReportGenerator-424"><a href="#ReportGenerator-424"><span class="linenos">424</span></a>        <span class="n">houses_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;House&quot;</span><span class="p">,</span> <span class="s2">&quot;Sign&quot;</span><span class="p">,</span> <span class="s2">&quot;Position&quot;</span><span class="p">,</span> <span class="s2">&quot;Absolute Position&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-425"><a href="#ReportGenerator-425"><span class="linenos">425</span></a>        <span class="k">for</span> <span class="n">house</span> <span class="ow">in</span> <span class="n">houses</span><span class="p">:</span>
</span><span id="ReportGenerator-426"><a href="#ReportGenerator-426"><span class="linenos">426</span></a>            <span class="n">houses_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-427"><a href="#ReportGenerator-427"><span class="linenos">427</span></a>                <span class="n">house</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-428"><a href="#ReportGenerator-428"><span class="linenos">428</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">house</span><span class="o">.</span><span class="n">sign</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">house</span><span class="o">.</span><span class="n">emoji</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-429"><a href="#ReportGenerator-429"><span class="linenos">429</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">house</span><span class="o">.</span><span class="n">position</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-430"><a href="#ReportGenerator-430"><span class="linenos">430</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">house</span><span class="o">.</span><span class="n">abs_pos</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-431"><a href="#ReportGenerator-431"><span class="linenos">431</span></a>            <span class="p">])</span>
</span><span id="ReportGenerator-432"><a href="#ReportGenerator-432"><span class="linenos">432</span></a>
</span><span id="ReportGenerator-433"><a href="#ReportGenerator-433"><span class="linenos">433</span></a>        <span class="n">system_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;houses_system_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-434"><a href="#ReportGenerator-434"><span class="linenos">434</span></a>        <span class="n">table_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">system_name</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">system_name</span> <span class="k">else</span> <span class="n">title</span>
</span><span id="ReportGenerator-435"><a href="#ReportGenerator-435"><span class="linenos">435</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">houses_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">table_title</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-436"><a href="#ReportGenerator-436"><span class="linenos">436</span></a>
</span><span id="ReportGenerator-437"><a href="#ReportGenerator-437"><span class="linenos">437</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_lunar_phase_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="n">SubjectLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-438"><a href="#ReportGenerator-438"><span class="linenos">438</span></a>        <span class="n">lunar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot;lunar_phase&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-439"><a href="#ReportGenerator-439"><span class="linenos">439</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">lunar</span><span class="p">:</span>
</span><span id="ReportGenerator-440"><a href="#ReportGenerator-440"><span class="linenos">440</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-441"><a href="#ReportGenerator-441"><span class="linenos">441</span></a>
</span><span id="ReportGenerator-442"><a href="#ReportGenerator-442"><span class="linenos">442</span></a>        <span class="n">lunar_data</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-443"><a href="#ReportGenerator-443"><span class="linenos">443</span></a>            <span class="p">[</span><span class="s2">&quot;Lunar Phase Information&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-444"><a href="#ReportGenerator-444"><span class="linenos">444</span></a>            <span class="p">[</span><span class="s2">&quot;Phase Name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lunar</span><span class="o">.</span><span class="n">moon_phase_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">lunar</span><span class="o">.</span><span class="n">moon_emoji</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-445"><a href="#ReportGenerator-445"><span class="linenos">445</span></a>            <span class="p">[</span><span class="s2">&quot;Sun-Moon Angle&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lunar</span><span class="o">.</span><span class="n">degrees_between_s_m</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-446"><a href="#ReportGenerator-446"><span class="linenos">446</span></a>            <span class="p">[</span><span class="s2">&quot;Lunation Day&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lunar</span><span class="o">.</span><span class="n">moon_phase</span><span class="p">)],</span>
</span><span id="ReportGenerator-447"><a href="#ReportGenerator-447"><span class="linenos">447</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-448"><a href="#ReportGenerator-448"><span class="linenos">448</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">lunar_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lunar Phase&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-449"><a href="#ReportGenerator-449"><span class="linenos">449</span></a>
</span><span id="ReportGenerator-450"><a href="#ReportGenerator-450"><span class="linenos">450</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_elements_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-451"><a href="#ReportGenerator-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="s2">&quot;element_distribution&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ReportGenerator-452"><a href="#ReportGenerator-452"><span class="linenos">452</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-453"><a href="#ReportGenerator-453"><span class="linenos">453</span></a>
</span><span id="ReportGenerator-454"><a href="#ReportGenerator-454"><span class="linenos">454</span></a>        <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="o">.</span><span class="n">element_distribution</span>
</span><span id="ReportGenerator-455"><a href="#ReportGenerator-455"><span class="linenos">455</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">fire</span> <span class="o">+</span> <span class="n">elem</span><span class="o">.</span><span class="n">earth</span> <span class="o">+</span> <span class="n">elem</span><span class="o">.</span><span class="n">air</span> <span class="o">+</span> <span class="n">elem</span><span class="o">.</span><span class="n">water</span>
</span><span id="ReportGenerator-456"><a href="#ReportGenerator-456"><span class="linenos">456</span></a>        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ReportGenerator-457"><a href="#ReportGenerator-457"><span class="linenos">457</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-458"><a href="#ReportGenerator-458"><span class="linenos">458</span></a>
</span><span id="ReportGenerator-459"><a href="#ReportGenerator-459"><span class="linenos">459</span></a>        <span class="n">element_data</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-460"><a href="#ReportGenerator-460"><span class="linenos">460</span></a>            <span class="p">[</span><span class="s2">&quot;Element&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Percentage&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-461"><a href="#ReportGenerator-461"><span class="linenos">461</span></a>            <span class="p">[</span><span class="s2">&quot;Fire &quot;</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">fire</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">fire</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-462"><a href="#ReportGenerator-462"><span class="linenos">462</span></a>            <span class="p">[</span><span class="s2">&quot;Earth &quot;</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">earth</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">earth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-463"><a href="#ReportGenerator-463"><span class="linenos">463</span></a>            <span class="p">[</span><span class="s2">&quot;Air &quot;</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">air</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">air</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-464"><a href="#ReportGenerator-464"><span class="linenos">464</span></a>            <span class="p">[</span><span class="s2">&quot;Water &quot;</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">water</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">water</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-465"><a href="#ReportGenerator-465"><span class="linenos">465</span></a>            <span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="s2">&quot;100%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-466"><a href="#ReportGenerator-466"><span class="linenos">466</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-467"><a href="#ReportGenerator-467"><span class="linenos">467</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">element_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Element Distribution&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-468"><a href="#ReportGenerator-468"><span class="linenos">468</span></a>
</span><span id="ReportGenerator-469"><a href="#ReportGenerator-469"><span class="linenos">469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_qualities_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-470"><a href="#ReportGenerator-470"><span class="linenos">470</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="s2">&quot;quality_distribution&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ReportGenerator-471"><a href="#ReportGenerator-471"><span class="linenos">471</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-472"><a href="#ReportGenerator-472"><span class="linenos">472</span></a>
</span><span id="ReportGenerator-473"><a href="#ReportGenerator-473"><span class="linenos">473</span></a>        <span class="n">qual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="o">.</span><span class="n">quality_distribution</span>
</span><span id="ReportGenerator-474"><a href="#ReportGenerator-474"><span class="linenos">474</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="n">qual</span><span class="o">.</span><span class="n">cardinal</span> <span class="o">+</span> <span class="n">qual</span><span class="o">.</span><span class="n">fixed</span> <span class="o">+</span> <span class="n">qual</span><span class="o">.</span><span class="n">mutable</span>
</span><span id="ReportGenerator-475"><a href="#ReportGenerator-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ReportGenerator-476"><a href="#ReportGenerator-476"><span class="linenos">476</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-477"><a href="#ReportGenerator-477"><span class="linenos">477</span></a>
</span><span id="ReportGenerator-478"><a href="#ReportGenerator-478"><span class="linenos">478</span></a>        <span class="n">quality_data</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-479"><a href="#ReportGenerator-479"><span class="linenos">479</span></a>            <span class="p">[</span><span class="s2">&quot;Quality&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Percentage&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-480"><a href="#ReportGenerator-480"><span class="linenos">480</span></a>            <span class="p">[</span><span class="s2">&quot;Cardinal&quot;</span><span class="p">,</span> <span class="n">qual</span><span class="o">.</span><span class="n">cardinal</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">qual</span><span class="o">.</span><span class="n">cardinal</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-481"><a href="#ReportGenerator-481"><span class="linenos">481</span></a>            <span class="p">[</span><span class="s2">&quot;Fixed&quot;</span><span class="p">,</span> <span class="n">qual</span><span class="o">.</span><span class="n">fixed</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">qual</span><span class="o">.</span><span class="n">fixed</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-482"><a href="#ReportGenerator-482"><span class="linenos">482</span></a>            <span class="p">[</span><span class="s2">&quot;Mutable&quot;</span><span class="p">,</span> <span class="n">qual</span><span class="o">.</span><span class="n">mutable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">qual</span><span class="o">.</span><span class="n">mutable</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-483"><a href="#ReportGenerator-483"><span class="linenos">483</span></a>            <span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="s2">&quot;100%&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-484"><a href="#ReportGenerator-484"><span class="linenos">484</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-485"><a href="#ReportGenerator-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">quality_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Quality Distribution&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-486"><a href="#ReportGenerator-486"><span class="linenos">486</span></a>
</span><span id="ReportGenerator-487"><a href="#ReportGenerator-487"><span class="linenos">487</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_active_configuration_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-488"><a href="#ReportGenerator-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-489"><a href="#ReportGenerator-489"><span class="linenos">489</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-490"><a href="#ReportGenerator-490"><span class="linenos">490</span></a>
</span><span id="ReportGenerator-491"><a href="#ReportGenerator-491"><span class="linenos">491</span></a>        <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-492"><a href="#ReportGenerator-492"><span class="linenos">492</span></a>
</span><span id="ReportGenerator-493"><a href="#ReportGenerator-493"><span class="linenos">493</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span><span class="p">:</span>
</span><span id="ReportGenerator-494"><a href="#ReportGenerator-494"><span class="linenos">494</span></a>            <span class="n">points_table</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;Active Point&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-495"><a href="#ReportGenerator-495"><span class="linenos">495</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ReportGenerator-496"><a href="#ReportGenerator-496"><span class="linenos">496</span></a>                <span class="n">points_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)])</span>
</span><span id="ReportGenerator-497"><a href="#ReportGenerator-497"><span class="linenos">497</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AsciiTable</span><span class="p">(</span><span class="n">points_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Active Celestial Points&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span id="ReportGenerator-498"><a href="#ReportGenerator-498"><span class="linenos">498</span></a>
</span><span id="ReportGenerator-499"><a href="#ReportGenerator-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-500"><a href="#ReportGenerator-500"><span class="linenos">500</span></a>            <span class="n">aspects_table</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Aspect&quot;</span><span class="p">,</span> <span class="s2">&quot;Orb ()&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-501"><a href="#ReportGenerator-501"><span class="linenos">501</span></a>            <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-502"><a href="#ReportGenerator-502"><span class="linenos">502</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="ReportGenerator-503"><a href="#ReportGenerator-503"><span class="linenos">503</span></a>                <span class="n">orb</span> <span class="o">=</span> <span class="n">aspect</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;orb&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-504"><a href="#ReportGenerator-504"><span class="linenos">504</span></a>                <span class="n">orbit_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">orb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span>
</span><span id="ReportGenerator-505"><a href="#ReportGenerator-505"><span class="linenos">505</span></a>                <span class="n">aspects_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">orbit_str</span><span class="p">])</span>
</span><span id="ReportGenerator-506"><a href="#ReportGenerator-506"><span class="linenos">506</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AsciiTable</span><span class="p">(</span><span class="n">aspects_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Active Aspects Configuration&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span id="ReportGenerator-507"><a href="#ReportGenerator-507"><span class="linenos">507</span></a>
</span><span id="ReportGenerator-508"><a href="#ReportGenerator-508"><span class="linenos">508</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span>
</span><span id="ReportGenerator-509"><a href="#ReportGenerator-509"><span class="linenos">509</span></a>
</span><span id="ReportGenerator-510"><a href="#ReportGenerator-510"><span class="linenos">510</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_aspects_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-511"><a href="#ReportGenerator-511"><span class="linenos">511</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="s2">&quot;aspects&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ReportGenerator-512"><a href="#ReportGenerator-512"><span class="linenos">512</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-513"><a href="#ReportGenerator-513"><span class="linenos">513</span></a>
</span><span id="ReportGenerator-514"><a href="#ReportGenerator-514"><span class="linenos">514</span></a>        <span class="n">aspects_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="ReportGenerator-515"><a href="#ReportGenerator-515"><span class="linenos">515</span></a>
</span><span id="ReportGenerator-516"><a href="#ReportGenerator-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">aspects_list</span><span class="p">:</span>
</span><span id="ReportGenerator-517"><a href="#ReportGenerator-517"><span class="linenos">517</span></a>            <span class="k">return</span> <span class="s2">&quot;No aspects data available.&quot;</span>
</span><span id="ReportGenerator-518"><a href="#ReportGenerator-518"><span class="linenos">518</span></a>
</span><span id="ReportGenerator-519"><a href="#ReportGenerator-519"><span class="linenos">519</span></a>        <span class="n">total_aspects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aspects_list</span><span class="p">)</span>
</span><span id="ReportGenerator-520"><a href="#ReportGenerator-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">max_aspects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator-521"><a href="#ReportGenerator-521"><span class="linenos">521</span></a>            <span class="n">aspects_list</span> <span class="o">=</span> <span class="n">aspects_list</span><span class="p">[:</span><span class="n">max_aspects</span><span class="p">]</span>
</span><span id="ReportGenerator-522"><a href="#ReportGenerator-522"><span class="linenos">522</span></a>
</span><span id="ReportGenerator-523"><a href="#ReportGenerator-523"><span class="linenos">523</span></a>        <span class="n">is_dual</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">)</span>
</span><span id="ReportGenerator-524"><a href="#ReportGenerator-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">is_dual</span><span class="p">:</span>
</span><span id="ReportGenerator-525"><a href="#ReportGenerator-525"><span class="linenos">525</span></a>            <span class="n">table_header</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Point 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Owner 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Aspect&quot;</span><span class="p">,</span> <span class="s2">&quot;Point 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Owner 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Orb&quot;</span><span class="p">,</span> <span class="s2">&quot;Movement&quot;</span><span class="p">]</span>
</span><span id="ReportGenerator-526"><a href="#ReportGenerator-526"><span class="linenos">526</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-527"><a href="#ReportGenerator-527"><span class="linenos">527</span></a>            <span class="n">table_header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Point 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Aspect&quot;</span><span class="p">,</span> <span class="s2">&quot;Point 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Orb&quot;</span><span class="p">,</span> <span class="s2">&quot;Movement&quot;</span><span class="p">]</span>
</span><span id="ReportGenerator-528"><a href="#ReportGenerator-528"><span class="linenos">528</span></a>
</span><span id="ReportGenerator-529"><a href="#ReportGenerator-529"><span class="linenos">529</span></a>        <span class="n">aspects_table</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">table_header</span><span class="p">]</span>
</span><span id="ReportGenerator-530"><a href="#ReportGenerator-530"><span class="linenos">530</span></a>        <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">aspects_list</span><span class="p">:</span>
</span><span id="ReportGenerator-531"><a href="#ReportGenerator-531"><span class="linenos">531</span></a>            <span class="n">aspect_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span>
</span><span id="ReportGenerator-532"><a href="#ReportGenerator-532"><span class="linenos">532</span></a>            <span class="n">symbol</span> <span class="o">=</span> <span class="n">ASPECT_SYMBOLS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aspect_name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">aspect_name</span><span class="p">)</span>
</span><span id="ReportGenerator-533"><a href="#ReportGenerator-533"><span class="linenos">533</span></a>            <span class="n">movement_symbol</span> <span class="o">=</span> <span class="n">MOVEMENT_SYMBOLS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aspect</span><span class="o">.</span><span class="n">aspect_movement</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-534"><a href="#ReportGenerator-534"><span class="linenos">534</span></a>            <span class="n">movement</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="o">.</span><span class="n">aspect_movement</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">movement_symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="ReportGenerator-535"><a href="#ReportGenerator-535"><span class="linenos">535</span></a>
</span><span id="ReportGenerator-536"><a href="#ReportGenerator-536"><span class="linenos">536</span></a>            <span class="k">if</span> <span class="n">is_dual</span><span class="p">:</span>
</span><span id="ReportGenerator-537"><a href="#ReportGenerator-537"><span class="linenos">537</span></a>                <span class="n">aspects_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-538"><a href="#ReportGenerator-538"><span class="linenos">538</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p1_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-539"><a href="#ReportGenerator-539"><span class="linenos">539</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p1_owner</span><span class="p">,</span>
</span><span id="ReportGenerator-540"><a href="#ReportGenerator-540"><span class="linenos">540</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="o">.</span><span class="n">aspect</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-541"><a href="#ReportGenerator-541"><span class="linenos">541</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p2_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-542"><a href="#ReportGenerator-542"><span class="linenos">542</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p2_owner</span><span class="p">,</span>
</span><span id="ReportGenerator-543"><a href="#ReportGenerator-543"><span class="linenos">543</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="o">.</span><span class="n">orbit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-544"><a href="#ReportGenerator-544"><span class="linenos">544</span></a>                    <span class="n">movement</span><span class="p">,</span>
</span><span id="ReportGenerator-545"><a href="#ReportGenerator-545"><span class="linenos">545</span></a>                <span class="p">])</span>
</span><span id="ReportGenerator-546"><a href="#ReportGenerator-546"><span class="linenos">546</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator-547"><a href="#ReportGenerator-547"><span class="linenos">547</span></a>                <span class="n">aspects_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-548"><a href="#ReportGenerator-548"><span class="linenos">548</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p1_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-549"><a href="#ReportGenerator-549"><span class="linenos">549</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="o">.</span><span class="n">aspect</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">symbol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-550"><a href="#ReportGenerator-550"><span class="linenos">550</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p2_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-551"><a href="#ReportGenerator-551"><span class="linenos">551</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="o">.</span><span class="n">orbit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-552"><a href="#ReportGenerator-552"><span class="linenos">552</span></a>                    <span class="n">movement</span><span class="p">,</span>
</span><span id="ReportGenerator-553"><a href="#ReportGenerator-553"><span class="linenos">553</span></a>                <span class="p">])</span>
</span><span id="ReportGenerator-554"><a href="#ReportGenerator-554"><span class="linenos">554</span></a>
</span><span id="ReportGenerator-555"><a href="#ReportGenerator-555"><span class="linenos">555</span></a>        <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (showing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">aspects_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total_aspects</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">max_aspects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-556"><a href="#ReportGenerator-556"><span class="linenos">556</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Aspects</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ReportGenerator-557"><a href="#ReportGenerator-557"><span class="linenos">557</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">aspects_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-558"><a href="#ReportGenerator-558"><span class="linenos">558</span></a>
</span><span id="ReportGenerator-559"><a href="#ReportGenerator-559"><span class="linenos">559</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_house_comparison_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-560"><a href="#ReportGenerator-560"><span class="linenos">560</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="o">.</span><span class="n">house_comparison</span><span class="p">:</span>
</span><span id="ReportGenerator-561"><a href="#ReportGenerator-561"><span class="linenos">561</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-562"><a href="#ReportGenerator-562"><span class="linenos">562</span></a>
</span><span id="ReportGenerator-563"><a href="#ReportGenerator-563"><span class="linenos">563</span></a>        <span class="n">comparison</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="o">.</span><span class="n">house_comparison</span>
</span><span id="ReportGenerator-564"><a href="#ReportGenerator-564"><span class="linenos">564</span></a>        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator-565"><a href="#ReportGenerator-565"><span class="linenos">565</span></a>
</span><span id="ReportGenerator-566"><a href="#ReportGenerator-566"><span class="linenos">566</span></a>        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-567"><a href="#ReportGenerator-567"><span class="linenos">567</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_render_point_in_house_table</span><span class="p">(</span>
</span><span id="ReportGenerator-568"><a href="#ReportGenerator-568"><span class="linenos">568</span></a>                <span class="n">comparison</span><span class="o">.</span><span class="n">first_points_in_second_houses</span><span class="p">,</span>
</span><span id="ReportGenerator-569"><a href="#ReportGenerator-569"><span class="linenos">569</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">first_subject_name</span><span class="si">}</span><span class="s2"> points in </span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">second_subject_name</span><span class="si">}</span><span class="s2"> houses&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-570"><a href="#ReportGenerator-570"><span class="linenos">570</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-571"><a href="#ReportGenerator-571"><span class="linenos">571</span></a>        <span class="p">)</span>
</span><span id="ReportGenerator-572"><a href="#ReportGenerator-572"><span class="linenos">572</span></a>        <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-573"><a href="#ReportGenerator-573"><span class="linenos">573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_render_point_in_house_table</span><span class="p">(</span>
</span><span id="ReportGenerator-574"><a href="#ReportGenerator-574"><span class="linenos">574</span></a>                <span class="n">comparison</span><span class="o">.</span><span class="n">second_points_in_first_houses</span><span class="p">,</span>
</span><span id="ReportGenerator-575"><a href="#ReportGenerator-575"><span class="linenos">575</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">second_subject_name</span><span class="si">}</span><span class="s2"> points in </span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">first_subject_name</span><span class="si">}</span><span class="s2"> houses&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-576"><a href="#ReportGenerator-576"><span class="linenos">576</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-577"><a href="#ReportGenerator-577"><span class="linenos">577</span></a>        <span class="p">)</span>
</span><span id="ReportGenerator-578"><a href="#ReportGenerator-578"><span class="linenos">578</span></a>
</span><span id="ReportGenerator-579"><a href="#ReportGenerator-579"><span class="linenos">579</span></a>        <span class="c1"># Add cusp comparison sections</span>
</span><span id="ReportGenerator-580"><a href="#ReportGenerator-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="n">comparison</span><span class="o">.</span><span class="n">first_cusps_in_second_houses</span><span class="p">:</span>
</span><span id="ReportGenerator-581"><a href="#ReportGenerator-581"><span class="linenos">581</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-582"><a href="#ReportGenerator-582"><span class="linenos">582</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_render_cusp_in_house_table</span><span class="p">(</span>
</span><span id="ReportGenerator-583"><a href="#ReportGenerator-583"><span class="linenos">583</span></a>                    <span class="n">comparison</span><span class="o">.</span><span class="n">first_cusps_in_second_houses</span><span class="p">,</span>
</span><span id="ReportGenerator-584"><a href="#ReportGenerator-584"><span class="linenos">584</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">first_subject_name</span><span class="si">}</span><span class="s2"> cusps in </span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">second_subject_name</span><span class="si">}</span><span class="s2"> houses&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-585"><a href="#ReportGenerator-585"><span class="linenos">585</span></a>                <span class="p">)</span>
</span><span id="ReportGenerator-586"><a href="#ReportGenerator-586"><span class="linenos">586</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-587"><a href="#ReportGenerator-587"><span class="linenos">587</span></a>
</span><span id="ReportGenerator-588"><a href="#ReportGenerator-588"><span class="linenos">588</span></a>        <span class="k">if</span> <span class="n">comparison</span><span class="o">.</span><span class="n">second_cusps_in_first_houses</span><span class="p">:</span>
</span><span id="ReportGenerator-589"><a href="#ReportGenerator-589"><span class="linenos">589</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="ReportGenerator-590"><a href="#ReportGenerator-590"><span class="linenos">590</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_render_cusp_in_house_table</span><span class="p">(</span>
</span><span id="ReportGenerator-591"><a href="#ReportGenerator-591"><span class="linenos">591</span></a>                    <span class="n">comparison</span><span class="o">.</span><span class="n">second_cusps_in_first_houses</span><span class="p">,</span>
</span><span id="ReportGenerator-592"><a href="#ReportGenerator-592"><span class="linenos">592</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">second_subject_name</span><span class="si">}</span><span class="s2"> cusps in </span><span class="si">{</span><span class="n">comparison</span><span class="o">.</span><span class="n">first_subject_name</span><span class="si">}</span><span class="s2"> houses&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-593"><a href="#ReportGenerator-593"><span class="linenos">593</span></a>                <span class="p">)</span>
</span><span id="ReportGenerator-594"><a href="#ReportGenerator-594"><span class="linenos">594</span></a>            <span class="p">)</span>
</span><span id="ReportGenerator-595"><a href="#ReportGenerator-595"><span class="linenos">595</span></a>
</span><span id="ReportGenerator-596"><a href="#ReportGenerator-596"><span class="linenos">596</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">section</span> <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span> <span class="k">if</span> <span class="n">section</span><span class="p">)</span>
</span><span id="ReportGenerator-597"><a href="#ReportGenerator-597"><span class="linenos">597</span></a>
</span><span id="ReportGenerator-598"><a href="#ReportGenerator-598"><span class="linenos">598</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_render_point_in_house_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PointInHouseModel</span><span class="p">],</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-599"><a href="#ReportGenerator-599"><span class="linenos">599</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span><span class="p">:</span>
</span><span id="ReportGenerator-600"><a href="#ReportGenerator-600"><span class="linenos">600</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-601"><a href="#ReportGenerator-601"><span class="linenos">601</span></a>
</span><span id="ReportGenerator-602"><a href="#ReportGenerator-602"><span class="linenos">602</span></a>        <span class="n">table_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;Owner House&quot;</span><span class="p">,</span> <span class="s2">&quot;Projected House&quot;</span><span class="p">,</span> <span class="s2">&quot;Sign&quot;</span><span class="p">,</span> <span class="s2">&quot;Degree&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-603"><a href="#ReportGenerator-603"><span class="linenos">603</span></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
</span><span id="ReportGenerator-604"><a href="#ReportGenerator-604"><span class="linenos">604</span></a>            <span class="n">owner_house</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
</span><span id="ReportGenerator-605"><a href="#ReportGenerator-605"><span class="linenos">605</span></a>            <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">point_owner_house_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">point</span><span class="o">.</span><span class="n">point_owner_house_name</span><span class="p">:</span>
</span><span id="ReportGenerator-606"><a href="#ReportGenerator-606"><span class="linenos">606</span></a>                <span class="n">owner_house</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_owner_house_number</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_owner_house_name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ReportGenerator-607"><a href="#ReportGenerator-607"><span class="linenos">607</span></a>
</span><span id="ReportGenerator-608"><a href="#ReportGenerator-608"><span class="linenos">608</span></a>            <span class="n">projected_house</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">projected_house_number</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">projected_house_name</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ReportGenerator-609"><a href="#ReportGenerator-609"><span class="linenos">609</span></a>            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-610"><a href="#ReportGenerator-610"><span class="linenos">610</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_owner_name</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-611"><a href="#ReportGenerator-611"><span class="linenos">611</span></a>                <span class="n">owner_house</span><span class="p">,</span>
</span><span id="ReportGenerator-612"><a href="#ReportGenerator-612"><span class="linenos">612</span></a>                <span class="n">projected_house</span><span class="p">,</span>
</span><span id="ReportGenerator-613"><a href="#ReportGenerator-613"><span class="linenos">613</span></a>                <span class="n">point</span><span class="o">.</span><span class="n">point_sign</span><span class="p">,</span>
</span><span id="ReportGenerator-614"><a href="#ReportGenerator-614"><span class="linenos">614</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_degree</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-615"><a href="#ReportGenerator-615"><span class="linenos">615</span></a>            <span class="p">])</span>
</span><span id="ReportGenerator-616"><a href="#ReportGenerator-616"><span class="linenos">616</span></a>
</span><span id="ReportGenerator-617"><a href="#ReportGenerator-617"><span class="linenos">617</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-618"><a href="#ReportGenerator-618"><span class="linenos">618</span></a>
</span><span id="ReportGenerator-619"><a href="#ReportGenerator-619"><span class="linenos">619</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_render_cusp_in_house_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PointInHouseModel</span><span class="p">],</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-620"><a href="#ReportGenerator-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span><span class="p">:</span>
</span><span id="ReportGenerator-621"><a href="#ReportGenerator-621"><span class="linenos">621</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-622"><a href="#ReportGenerator-622"><span class="linenos">622</span></a>
</span><span id="ReportGenerator-623"><a href="#ReportGenerator-623"><span class="linenos">623</span></a>        <span class="n">table_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;Projected House&quot;</span><span class="p">,</span> <span class="s2">&quot;Sign&quot;</span><span class="p">,</span> <span class="s2">&quot;Degree&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-624"><a href="#ReportGenerator-624"><span class="linenos">624</span></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
</span><span id="ReportGenerator-625"><a href="#ReportGenerator-625"><span class="linenos">625</span></a>            <span class="n">projected_house</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">projected_house_number</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">projected_house_name</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="ReportGenerator-626"><a href="#ReportGenerator-626"><span class="linenos">626</span></a>            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-627"><a href="#ReportGenerator-627"><span class="linenos">627</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_owner_name</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-628"><a href="#ReportGenerator-628"><span class="linenos">628</span></a>                <span class="n">projected_house</span><span class="p">,</span>
</span><span id="ReportGenerator-629"><a href="#ReportGenerator-629"><span class="linenos">629</span></a>                <span class="n">point</span><span class="o">.</span><span class="n">point_sign</span><span class="p">,</span>
</span><span id="ReportGenerator-630"><a href="#ReportGenerator-630"><span class="linenos">630</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="o">.</span><span class="n">point_degree</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-631"><a href="#ReportGenerator-631"><span class="linenos">631</span></a>            <span class="p">])</span>
</span><span id="ReportGenerator-632"><a href="#ReportGenerator-632"><span class="linenos">632</span></a>
</span><span id="ReportGenerator-633"><a href="#ReportGenerator-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="n">AsciiTable</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
</span><span id="ReportGenerator-634"><a href="#ReportGenerator-634"><span class="linenos">634</span></a>
</span><span id="ReportGenerator-635"><a href="#ReportGenerator-635"><span class="linenos">635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_relationship_score_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-636"><a href="#ReportGenerator-636"><span class="linenos">636</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">):</span>
</span><span id="ReportGenerator-637"><a href="#ReportGenerator-637"><span class="linenos">637</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-638"><a href="#ReportGenerator-638"><span class="linenos">638</span></a>
</span><span id="ReportGenerator-639"><a href="#ReportGenerator-639"><span class="linenos">639</span></a>        <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RelationshipScoreModel</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">,</span> <span class="s2">&quot;relationship_score&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ReportGenerator-640"><a href="#ReportGenerator-640"><span class="linenos">640</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">score</span><span class="p">:</span>
</span><span id="ReportGenerator-641"><a href="#ReportGenerator-641"><span class="linenos">641</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-642"><a href="#ReportGenerator-642"><span class="linenos">642</span></a>
</span><span id="ReportGenerator-643"><a href="#ReportGenerator-643"><span class="linenos">643</span></a>        <span class="n">summary_table</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ReportGenerator-644"><a href="#ReportGenerator-644"><span class="linenos">644</span></a>            <span class="p">[</span><span class="s2">&quot;Metric&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-645"><a href="#ReportGenerator-645"><span class="linenos">645</span></a>            <span class="p">[</span><span class="s2">&quot;Score&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">score_value</span><span class="p">)],</span>
</span><span id="ReportGenerator-646"><a href="#ReportGenerator-646"><span class="linenos">646</span></a>            <span class="p">[</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">score_description</span><span class="p">)],</span>
</span><span id="ReportGenerator-647"><a href="#ReportGenerator-647"><span class="linenos">647</span></a>            <span class="p">[</span><span class="s2">&quot;Destiny Signature&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">score</span><span class="o">.</span><span class="n">is_destiny_sign</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span><span class="p">],</span>
</span><span id="ReportGenerator-648"><a href="#ReportGenerator-648"><span class="linenos">648</span></a>        <span class="p">]</span>
</span><span id="ReportGenerator-649"><a href="#ReportGenerator-649"><span class="linenos">649</span></a>
</span><span id="ReportGenerator-650"><a href="#ReportGenerator-650"><span class="linenos">650</span></a>        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">AsciiTable</span><span class="p">(</span><span class="n">summary_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Relationship Score Summary&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">]</span>
</span><span id="ReportGenerator-651"><a href="#ReportGenerator-651"><span class="linenos">651</span></a>
</span><span id="ReportGenerator-652"><a href="#ReportGenerator-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="n">score</span><span class="o">.</span><span class="n">aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-653"><a href="#ReportGenerator-653"><span class="linenos">653</span></a>            <span class="n">aspects_table</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Point 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Aspect&quot;</span><span class="p">,</span> <span class="s2">&quot;Point 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Orb&quot;</span><span class="p">]]</span>
</span><span id="ReportGenerator-654"><a href="#ReportGenerator-654"><span class="linenos">654</span></a>            <span class="k">for</span> <span class="n">aspect</span> <span class="ow">in</span> <span class="n">score</span><span class="o">.</span><span class="n">aspects</span><span class="p">:</span>
</span><span id="ReportGenerator-655"><a href="#ReportGenerator-655"><span class="linenos">655</span></a>                <span class="n">aspects_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
</span><span id="ReportGenerator-656"><a href="#ReportGenerator-656"><span class="linenos">656</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p1_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-657"><a href="#ReportGenerator-657"><span class="linenos">657</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">aspect</span><span class="p">,</span>
</span><span id="ReportGenerator-658"><a href="#ReportGenerator-658"><span class="linenos">658</span></a>                    <span class="n">aspect</span><span class="o">.</span><span class="n">p2_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="ReportGenerator-659"><a href="#ReportGenerator-659"><span class="linenos">659</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aspect</span><span class="o">.</span><span class="n">orbit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ReportGenerator-660"><a href="#ReportGenerator-660"><span class="linenos">660</span></a>                <span class="p">])</span>
</span><span id="ReportGenerator-661"><a href="#ReportGenerator-661"><span class="linenos">661</span></a>            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AsciiTable</span><span class="p">(</span><span class="n">aspects_table</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Score Supporting Aspects&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span id="ReportGenerator-662"><a href="#ReportGenerator-662"><span class="linenos">662</span></a>
</span><span id="ReportGenerator-663"><a href="#ReportGenerator-663"><span class="linenos">663</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span>
</span><span id="ReportGenerator-664"><a href="#ReportGenerator-664"><span class="linenos">664</span></a>
</span><span id="ReportGenerator-665"><a href="#ReportGenerator-665"><span class="linenos">665</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-666"><a href="#ReportGenerator-666"><span class="linenos">666</span></a>    <span class="c1"># Utility helpers</span>
</span><span id="ReportGenerator-667"><a href="#ReportGenerator-667"><span class="linenos">667</span></a>    <span class="c1"># ------------------------------------------------------------------ #</span>
</span><span id="ReportGenerator-668"><a href="#ReportGenerator-668"><span class="linenos">668</span></a>
</span><span id="ReportGenerator-669"><a href="#ReportGenerator-669"><span class="linenos">669</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ReportGenerator-670"><a href="#ReportGenerator-670"><span class="linenos">670</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_year</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ReportGenerator-671"><a href="#ReportGenerator-671"><span class="linenos">671</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">iso_datetime</span><span class="p">:</span>
</span><span id="ReportGenerator-672"><a href="#ReportGenerator-672"><span class="linenos">672</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="ReportGenerator-673"><a href="#ReportGenerator-673"><span class="linenos">673</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ReportGenerator-674"><a href="#ReportGenerator-674"><span class="linenos">674</span></a>            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-675"><a href="#ReportGenerator-675"><span class="linenos">675</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="ReportGenerator-676"><a href="#ReportGenerator-676"><span class="linenos">676</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="ReportGenerator-677"><a href="#ReportGenerator-677"><span class="linenos">677</span></a>
</span><span id="ReportGenerator-678"><a href="#ReportGenerator-678"><span class="linenos">678</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ReportGenerator-679"><a href="#ReportGenerator-679"><span class="linenos">679</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_format_date</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-680"><a href="#ReportGenerator-680"><span class="linenos">680</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator-681"><a href="#ReportGenerator-681"><span class="linenos">681</span></a><span class="sd">        Format datetime in dd/mm/yyyy format.</span>
</span><span id="ReportGenerator-682"><a href="#ReportGenerator-682"><span class="linenos">682</span></a>
</span><span id="ReportGenerator-683"><a href="#ReportGenerator-683"><span class="linenos">683</span></a><span class="sd">        .. deprecated::</span>
</span><span id="ReportGenerator-684"><a href="#ReportGenerator-684"><span class="linenos">684</span></a><span class="sd">            Use _format_date_iso() for internationally unambiguous date formatting.</span>
</span><span id="ReportGenerator-685"><a href="#ReportGenerator-685"><span class="linenos">685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReportGenerator-686"><a href="#ReportGenerator-686"><span class="linenos">686</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">iso_datetime</span><span class="p">:</span>
</span><span id="ReportGenerator-687"><a href="#ReportGenerator-687"><span class="linenos">687</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-688"><a href="#ReportGenerator-688"><span class="linenos">688</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ReportGenerator-689"><a href="#ReportGenerator-689"><span class="linenos">689</span></a>            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-690"><a href="#ReportGenerator-690"><span class="linenos">690</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="ReportGenerator-691"><a href="#ReportGenerator-691"><span class="linenos">691</span></a>            <span class="k">return</span> <span class="n">iso_datetime</span>
</span><span id="ReportGenerator-692"><a href="#ReportGenerator-692"><span class="linenos">692</span></a>
</span><span id="ReportGenerator-693"><a href="#ReportGenerator-693"><span class="linenos">693</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ReportGenerator-694"><a href="#ReportGenerator-694"><span class="linenos">694</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_format_date_iso</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator-695"><a href="#ReportGenerator-695"><span class="linenos">695</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator-696"><a href="#ReportGenerator-696"><span class="linenos">696</span></a><span class="sd">        Format datetime in ISO 8601 format (YYYY-MM-DD).</span>
</span><span id="ReportGenerator-697"><a href="#ReportGenerator-697"><span class="linenos">697</span></a>
</span><span id="ReportGenerator-698"><a href="#ReportGenerator-698"><span class="linenos">698</span></a><span class="sd">        This format is internationally unambiguous and follows the ISO 8601 standard.</span>
</span><span id="ReportGenerator-699"><a href="#ReportGenerator-699"><span class="linenos">699</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReportGenerator-700"><a href="#ReportGenerator-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">iso_datetime</span><span class="p">:</span>
</span><span id="ReportGenerator-701"><a href="#ReportGenerator-701"><span class="linenos">701</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="ReportGenerator-702"><a href="#ReportGenerator-702"><span class="linenos">702</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ReportGenerator-703"><a href="#ReportGenerator-703"><span class="linenos">703</span></a>            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator-704"><a href="#ReportGenerator-704"><span class="linenos">704</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="ReportGenerator-705"><a href="#ReportGenerator-705"><span class="linenos">705</span></a>            <span class="k">return</span> <span class="n">iso_datetime</span>
</span></pre></div>


            <div class="docstring"><p>Generate textual reports for astrological data models with a structure that mirrors the
chart-specific dispatch logic used in <code>~<a href="#ChartDrawer">kerykeion.charts.chart_drawer.ChartDrawer</a></code>.</p>

<p>The generator accepts any of the chart data models handled by <code><a href="#ChartDrawer">ChartDrawer</a></code> as well as
raw <code>AstrologicalSubjectModel</code> instances. The <code><a href="#ReportGenerator.print_report">print_report</a></code> method automatically
selects the appropriate layout and sections depending on the underlying chart type.</p>
</div>


                            <div id="ReportGenerator.__init__" class="classattr">
                                        <input id="ReportGenerator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ReportGenerator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">include_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ReportGenerator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReportGenerator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReportGenerator.__init__-56"><a href="#ReportGenerator.__init__-56"><span class="linenos">56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ReportGenerator.__init__-57"><a href="#ReportGenerator.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReportGenerator.__init__-58"><a href="#ReportGenerator.__init__-58"><span class="linenos">58</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ChartDataModel</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="ReportGenerator.__init__-59"><a href="#ReportGenerator.__init__-59"><span class="linenos">59</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ReportGenerator.__init__-60"><a href="#ReportGenerator.__init__-60"><span class="linenos">60</span></a>        <span class="n">include_aspects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ReportGenerator.__init__-61"><a href="#ReportGenerator.__init__-61"><span class="linenos">61</span></a>        <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator.__init__-62"><a href="#ReportGenerator.__init__-62"><span class="linenos">62</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator.__init__-63"><a href="#ReportGenerator.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="ReportGenerator.__init__-64"><a href="#ReportGenerator.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_include_aspects_default</span> <span class="o">=</span> <span class="n">include_aspects</span>
</span><span id="ReportGenerator.__init__-65"><a href="#ReportGenerator.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_aspects_default</span> <span class="o">=</span> <span class="n">max_aspects</span>
</span><span id="ReportGenerator.__init__-66"><a href="#ReportGenerator.__init__-66"><span class="linenos">66</span></a>
</span><span id="ReportGenerator.__init__-67"><a href="#ReportGenerator.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator.__init__-68"><a href="#ReportGenerator.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span><span class="p">:</span> <span class="n">LiteralReportKind</span>
</span><span id="ReportGenerator.__init__-69"><a href="#ReportGenerator.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChartDataModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator.__init__-70"><a href="#ReportGenerator.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_primary_subject</span><span class="p">:</span> <span class="n">SubjectLike</span>
</span><span id="ReportGenerator.__init__-71"><a href="#ReportGenerator.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_secondary_subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SubjectLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ReportGenerator.__init__-72"><a href="#ReportGenerator.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator.__init__-73"><a href="#ReportGenerator.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ReportGenerator.__init__-74"><a href="#ReportGenerator.__init__-74"><span class="linenos">74</span></a>
</span><span id="ReportGenerator.__init__-75"><a href="#ReportGenerator.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_model</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="ReportGenerator.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span>

        
    </div>
    <a class="headerlink" href="#ReportGenerator.model"></a>
    
    

                            </div>
                            <div id="ReportGenerator.chart_type" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_type</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ReportGenerator.chart_type"></a>
    
    

                            </div>
                            <div id="ReportGenerator.generate_report" class="classattr">
                                        <input id="ReportGenerator.generate_report-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_report</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">include_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ReportGenerator.generate_report-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReportGenerator.generate_report"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReportGenerator.generate_report-81"><a href="#ReportGenerator.generate_report-81"><span class="linenos"> 81</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span>
</span><span id="ReportGenerator.generate_report-82"><a href="#ReportGenerator.generate_report-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReportGenerator.generate_report-83"><a href="#ReportGenerator.generate_report-83"><span class="linenos"> 83</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ReportGenerator.generate_report-84"><a href="#ReportGenerator.generate_report-84"><span class="linenos"> 84</span></a>        <span class="n">include_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator.generate_report-85"><a href="#ReportGenerator.generate_report-85"><span class="linenos"> 85</span></a>        <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator.generate_report-86"><a href="#ReportGenerator.generate_report-86"><span class="linenos"> 86</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ReportGenerator.generate_report-87"><a href="#ReportGenerator.generate_report-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator.generate_report-88"><a href="#ReportGenerator.generate_report-88"><span class="linenos"> 88</span></a><span class="sd">        Build the report content without printing it.</span>
</span><span id="ReportGenerator.generate_report-89"><a href="#ReportGenerator.generate_report-89"><span class="linenos"> 89</span></a>
</span><span id="ReportGenerator.generate_report-90"><a href="#ReportGenerator.generate_report-90"><span class="linenos"> 90</span></a><span class="sd">        Args:</span>
</span><span id="ReportGenerator.generate_report-91"><a href="#ReportGenerator.generate_report-91"><span class="linenos"> 91</span></a><span class="sd">            include_aspects: Override the default setting for including the aspects section.</span>
</span><span id="ReportGenerator.generate_report-92"><a href="#ReportGenerator.generate_report-92"><span class="linenos"> 92</span></a><span class="sd">            max_aspects: Override the default limit for the number of aspects displayed.</span>
</span><span id="ReportGenerator.generate_report-93"><a href="#ReportGenerator.generate_report-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReportGenerator.generate_report-94"><a href="#ReportGenerator.generate_report-94"><span class="linenos"> 94</span></a>        <span class="n">include_aspects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include_aspects_default</span> <span class="k">if</span> <span class="n">include_aspects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">include_aspects</span>
</span><span id="ReportGenerator.generate_report-95"><a href="#ReportGenerator.generate_report-95"><span class="linenos"> 95</span></a>        <span class="n">max_aspects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_aspects_default</span> <span class="k">if</span> <span class="n">max_aspects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_aspects</span>
</span><span id="ReportGenerator.generate_report-96"><a href="#ReportGenerator.generate_report-96"><span class="linenos"> 96</span></a>
</span><span id="ReportGenerator.generate_report-97"><a href="#ReportGenerator.generate_report-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">==</span> <span class="s2">&quot;subject&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator.generate_report-98"><a href="#ReportGenerator.generate_report-98"><span class="linenos"> 98</span></a>            <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_subject_report</span><span class="p">()</span>
</span><span id="ReportGenerator.generate_report-99"><a href="#ReportGenerator.generate_report-99"><span class="linenos"> 99</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_kind</span> <span class="o">==</span> <span class="s2">&quot;single_chart&quot;</span><span class="p">:</span>
</span><span id="ReportGenerator.generate_report-100"><a href="#ReportGenerator.generate_report-100"><span class="linenos">100</span></a>            <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_single_chart_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="n">include_aspects</span><span class="p">,</span> <span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">)</span>
</span><span id="ReportGenerator.generate_report-101"><a href="#ReportGenerator.generate_report-101"><span class="linenos">101</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ReportGenerator.generate_report-102"><a href="#ReportGenerator.generate_report-102"><span class="linenos">102</span></a>            <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dual_chart_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="n">include_aspects</span><span class="p">,</span> <span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">)</span>
</span><span id="ReportGenerator.generate_report-103"><a href="#ReportGenerator.generate_report-103"><span class="linenos">103</span></a>
</span><span id="ReportGenerator.generate_report-104"><a href="#ReportGenerator.generate_report-104"><span class="linenos">104</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_title</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ReportGenerator.generate_report-105"><a href="#ReportGenerator.generate_report-105"><span class="linenos">105</span></a>        <span class="n">full_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">title</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">section</span> <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span> <span class="k">if</span> <span class="n">section</span><span class="p">]]</span>
</span><span id="ReportGenerator.generate_report-106"><a href="#ReportGenerator.generate_report-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">full_sections</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Build the report content without printing it.</p>

<p>Args:
    include_aspects: Override the default setting for including the aspects section.
    max_aspects: Override the default limit for the number of aspects displayed.</p>
</div>


                            </div>
                            <div id="ReportGenerator.print_report" class="classattr">
                                        <input id="ReportGenerator.print_report-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_report</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">include_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ReportGenerator.print_report-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReportGenerator.print_report"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReportGenerator.print_report-108"><a href="#ReportGenerator.print_report-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_report</span><span class="p">(</span>
</span><span id="ReportGenerator.print_report-109"><a href="#ReportGenerator.print_report-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ReportGenerator.print_report-110"><a href="#ReportGenerator.print_report-110"><span class="linenos">110</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="ReportGenerator.print_report-111"><a href="#ReportGenerator.print_report-111"><span class="linenos">111</span></a>        <span class="n">include_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator.print_report-112"><a href="#ReportGenerator.print_report-112"><span class="linenos">112</span></a>        <span class="n">max_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ReportGenerator.print_report-113"><a href="#ReportGenerator.print_report-113"><span class="linenos">113</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ReportGenerator.print_report-114"><a href="#ReportGenerator.print_report-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ReportGenerator.print_report-115"><a href="#ReportGenerator.print_report-115"><span class="linenos">115</span></a><span class="sd">        Print the generated report to stdout.</span>
</span><span id="ReportGenerator.print_report-116"><a href="#ReportGenerator.print_report-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReportGenerator.print_report-117"><a href="#ReportGenerator.print_report-117"><span class="linenos">117</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">include_aspects</span><span class="o">=</span><span class="n">include_aspects</span><span class="p">,</span> <span class="n">max_aspects</span><span class="o">=</span><span class="n">max_aspects</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Print the generated report to stdout.</p>
</div>


                            </div>
                </section>
                <section id="KerykeionSettingsModel">
                            <input id="KerykeionSettingsModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KerykeionSettingsModel</span><wbr>(<span class="base">kerykeion.schemas.kr_models.SubscriptableBaseModel</span>):

                <label class="view-source-button" for="KerykeionSettingsModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionSettingsModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionSettingsModel-185"><a href="#KerykeionSettingsModel-185"><span class="linenos">185</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KerykeionSettingsModel</span><span class="p">(</span><span class="n">SubscriptableBaseModel</span><span class="p">):</span>
</span><span id="KerykeionSettingsModel-186"><a href="#KerykeionSettingsModel-186"><span class="linenos">186</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="KerykeionSettingsModel-187"><a href="#KerykeionSettingsModel-187"><span class="linenos">187</span></a><span class="sd">    This class is used to define the global settings for the Kerykeion.</span>
</span><span id="KerykeionSettingsModel-188"><a href="#KerykeionSettingsModel-188"><span class="linenos">188</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="KerykeionSettingsModel-189"><a href="#KerykeionSettingsModel-189"><span class="linenos">189</span></a>    <span class="n">language_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">KerykeionLanguageModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Language Settings&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The language settings of the chart&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This class is used to define the global settings for the Kerykeion.</p>
</div>


                            <div id="KerykeionSettingsModel.language_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">language_settings</span><span class="annotation">: dict[str, kerykeion.schemas.settings_models.KerykeionLanguageModel]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionSettingsModel.language_settings"></a>
    
    

                            </div>
                            <div id="KerykeionSettingsModel.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#KerykeionSettingsModel.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="TransitsTimeRangeFactory">
                            <input id="TransitsTimeRangeFactory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TransitsTimeRangeFactory</span>:

                <label class="view-source-button" for="TransitsTimeRangeFactory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TransitsTimeRangeFactory-72"><a href="#TransitsTimeRangeFactory-72"><span class="linenos"> 72</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TransitsTimeRangeFactory</span><span class="p">:</span>
</span><span id="TransitsTimeRangeFactory-73"><a href="#TransitsTimeRangeFactory-73"><span class="linenos"> 73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory-74"><a href="#TransitsTimeRangeFactory-74"><span class="linenos"> 74</span></a><span class="sd">    Factory class for calculating astrological transits over time periods.</span>
</span><span id="TransitsTimeRangeFactory-75"><a href="#TransitsTimeRangeFactory-75"><span class="linenos"> 75</span></a>
</span><span id="TransitsTimeRangeFactory-76"><a href="#TransitsTimeRangeFactory-76"><span class="linenos"> 76</span></a><span class="sd">    This class analyzes the angular relationships (aspects) between transiting</span>
</span><span id="TransitsTimeRangeFactory-77"><a href="#TransitsTimeRangeFactory-77"><span class="linenos"> 77</span></a><span class="sd">    celestial bodies and natal chart positions across multiple time points,</span>
</span><span id="TransitsTimeRangeFactory-78"><a href="#TransitsTimeRangeFactory-78"><span class="linenos"> 78</span></a><span class="sd">    generating structured transit data for astrological analysis.</span>
</span><span id="TransitsTimeRangeFactory-79"><a href="#TransitsTimeRangeFactory-79"><span class="linenos"> 79</span></a>
</span><span id="TransitsTimeRangeFactory-80"><a href="#TransitsTimeRangeFactory-80"><span class="linenos"> 80</span></a><span class="sd">    The factory compares ephemeris data points (representing planetary positions</span>
</span><span id="TransitsTimeRangeFactory-81"><a href="#TransitsTimeRangeFactory-81"><span class="linenos"> 81</span></a><span class="sd">    at different moments) with a natal chart to identify when specific geometric</span>
</span><span id="TransitsTimeRangeFactory-82"><a href="#TransitsTimeRangeFactory-82"><span class="linenos"> 82</span></a><span class="sd">    configurations occur between transiting and natal celestial bodies.</span>
</span><span id="TransitsTimeRangeFactory-83"><a href="#TransitsTimeRangeFactory-83"><span class="linenos"> 83</span></a>
</span><span id="TransitsTimeRangeFactory-84"><a href="#TransitsTimeRangeFactory-84"><span class="linenos"> 84</span></a><span class="sd">    Args:</span>
</span><span id="TransitsTimeRangeFactory-85"><a href="#TransitsTimeRangeFactory-85"><span class="linenos"> 85</span></a><span class="sd">        natal_chart (AstrologicalSubjectModel): The natal chart used as the reference</span>
</span><span id="TransitsTimeRangeFactory-86"><a href="#TransitsTimeRangeFactory-86"><span class="linenos"> 86</span></a><span class="sd">            point for transit calculations. All transiting positions are compared</span>
</span><span id="TransitsTimeRangeFactory-87"><a href="#TransitsTimeRangeFactory-87"><span class="linenos"> 87</span></a><span class="sd">            against this chart&#39;s planetary positions.</span>
</span><span id="TransitsTimeRangeFactory-88"><a href="#TransitsTimeRangeFactory-88"><span class="linenos"> 88</span></a><span class="sd">        ephemeris_data_points (List[AstrologicalSubjectModel]): A list of astrological</span>
</span><span id="TransitsTimeRangeFactory-89"><a href="#TransitsTimeRangeFactory-89"><span class="linenos"> 89</span></a><span class="sd">            subject models representing different moments in time, typically generated</span>
</span><span id="TransitsTimeRangeFactory-90"><a href="#TransitsTimeRangeFactory-90"><span class="linenos"> 90</span></a><span class="sd">            by EphemerisDataFactory. Each point contains planetary positions for</span>
</span><span id="TransitsTimeRangeFactory-91"><a href="#TransitsTimeRangeFactory-91"><span class="linenos"> 91</span></a><span class="sd">            a specific date/time.</span>
</span><span id="TransitsTimeRangeFactory-92"><a href="#TransitsTimeRangeFactory-92"><span class="linenos"> 92</span></a><span class="sd">        active_points (List[AstrologicalPoint], optional): List of celestial bodies</span>
</span><span id="TransitsTimeRangeFactory-93"><a href="#TransitsTimeRangeFactory-93"><span class="linenos"> 93</span></a><span class="sd">            to include in aspect calculations (e.g., Sun, Moon, planets, asteroids).</span>
</span><span id="TransitsTimeRangeFactory-94"><a href="#TransitsTimeRangeFactory-94"><span class="linenos"> 94</span></a><span class="sd">            Defaults to DEFAULT_ACTIVE_POINTS.</span>
</span><span id="TransitsTimeRangeFactory-95"><a href="#TransitsTimeRangeFactory-95"><span class="linenos"> 95</span></a><span class="sd">        active_aspects (List[ActiveAspect], optional): List of aspect types to</span>
</span><span id="TransitsTimeRangeFactory-96"><a href="#TransitsTimeRangeFactory-96"><span class="linenos"> 96</span></a><span class="sd">            calculate (e.g., conjunction, opposition, trine, square, sextile).</span>
</span><span id="TransitsTimeRangeFactory-97"><a href="#TransitsTimeRangeFactory-97"><span class="linenos"> 97</span></a><span class="sd">            Defaults to DEFAULT_ACTIVE_ASPECTS.</span>
</span><span id="TransitsTimeRangeFactory-98"><a href="#TransitsTimeRangeFactory-98"><span class="linenos"> 98</span></a><span class="sd">        settings_file (Union[Path, KerykeionSettingsModel, dict, None], optional):</span>
</span><span id="TransitsTimeRangeFactory-99"><a href="#TransitsTimeRangeFactory-99"><span class="linenos"> 99</span></a><span class="sd">            Configuration settings for calculations. Can be a file path, settings</span>
</span><span id="TransitsTimeRangeFactory-100"><a href="#TransitsTimeRangeFactory-100"><span class="linenos">100</span></a><span class="sd">            model, dictionary, or None for defaults. Defaults to None.</span>
</span><span id="TransitsTimeRangeFactory-101"><a href="#TransitsTimeRangeFactory-101"><span class="linenos">101</span></a><span class="sd">        axis_orb_limit (float | None, optional): Optional orb threshold applied to chart axes</span>
</span><span id="TransitsTimeRangeFactory-102"><a href="#TransitsTimeRangeFactory-102"><span class="linenos">102</span></a><span class="sd">            during single-chart aspect calculations. Dual-chart calculations ignore this value.</span>
</span><span id="TransitsTimeRangeFactory-103"><a href="#TransitsTimeRangeFactory-103"><span class="linenos">103</span></a>
</span><span id="TransitsTimeRangeFactory-104"><a href="#TransitsTimeRangeFactory-104"><span class="linenos">104</span></a><span class="sd">    Attributes:</span>
</span><span id="TransitsTimeRangeFactory-105"><a href="#TransitsTimeRangeFactory-105"><span class="linenos">105</span></a><span class="sd">        natal_chart: The reference natal chart for transit calculations.</span>
</span><span id="TransitsTimeRangeFactory-106"><a href="#TransitsTimeRangeFactory-106"><span class="linenos">106</span></a><span class="sd">        ephemeris_data_points: Time-series planetary position data.</span>
</span><span id="TransitsTimeRangeFactory-107"><a href="#TransitsTimeRangeFactory-107"><span class="linenos">107</span></a><span class="sd">        active_points: Celestial bodies included in calculations.</span>
</span><span id="TransitsTimeRangeFactory-108"><a href="#TransitsTimeRangeFactory-108"><span class="linenos">108</span></a><span class="sd">        active_aspects: Aspect types considered for analysis.</span>
</span><span id="TransitsTimeRangeFactory-109"><a href="#TransitsTimeRangeFactory-109"><span class="linenos">109</span></a><span class="sd">        settings_file: Configuration settings for the calculations.</span>
</span><span id="TransitsTimeRangeFactory-110"><a href="#TransitsTimeRangeFactory-110"><span class="linenos">110</span></a><span class="sd">        axis_orb_limit: Optional orb override used when calculating single-chart aspects.</span>
</span><span id="TransitsTimeRangeFactory-111"><a href="#TransitsTimeRangeFactory-111"><span class="linenos">111</span></a>
</span><span id="TransitsTimeRangeFactory-112"><a href="#TransitsTimeRangeFactory-112"><span class="linenos">112</span></a><span class="sd">    Examples:</span>
</span><span id="TransitsTimeRangeFactory-113"><a href="#TransitsTimeRangeFactory-113"><span class="linenos">113</span></a><span class="sd">        Basic transit calculation:</span>
</span><span id="TransitsTimeRangeFactory-114"><a href="#TransitsTimeRangeFactory-114"><span class="linenos">114</span></a>
</span><span id="TransitsTimeRangeFactory-115"><a href="#TransitsTimeRangeFactory-115"><span class="linenos">115</span></a><span class="sd">        &gt;&gt;&gt; natal_chart = AstrologicalSubjectFactory.from_birth_data(...)</span>
</span><span id="TransitsTimeRangeFactory-116"><a href="#TransitsTimeRangeFactory-116"><span class="linenos">116</span></a><span class="sd">        &gt;&gt;&gt; ephemeris_data = ephemeris_factory.get_ephemeris_data_as_astrological_subjects()</span>
</span><span id="TransitsTimeRangeFactory-117"><a href="#TransitsTimeRangeFactory-117"><span class="linenos">117</span></a><span class="sd">        &gt;&gt;&gt; factory = TransitsTimeRangeFactory(natal_chart, ephemeris_data)</span>
</span><span id="TransitsTimeRangeFactory-118"><a href="#TransitsTimeRangeFactory-118"><span class="linenos">118</span></a><span class="sd">        &gt;&gt;&gt; transits = factory.get_transit_moments()</span>
</span><span id="TransitsTimeRangeFactory-119"><a href="#TransitsTimeRangeFactory-119"><span class="linenos">119</span></a>
</span><span id="TransitsTimeRangeFactory-120"><a href="#TransitsTimeRangeFactory-120"><span class="linenos">120</span></a><span class="sd">        Custom configuration:</span>
</span><span id="TransitsTimeRangeFactory-121"><a href="#TransitsTimeRangeFactory-121"><span class="linenos">121</span></a>
</span><span id="TransitsTimeRangeFactory-122"><a href="#TransitsTimeRangeFactory-122"><span class="linenos">122</span></a><span class="sd">        &gt;&gt;&gt; from kerykeion.schemas import AstrologicalPoint, ActiveAspect</span>
</span><span id="TransitsTimeRangeFactory-123"><a href="#TransitsTimeRangeFactory-123"><span class="linenos">123</span></a><span class="sd">        &gt;&gt;&gt; custom_points = [&quot;Sun&quot;, &quot;Moon&quot;]</span>
</span><span id="TransitsTimeRangeFactory-124"><a href="#TransitsTimeRangeFactory-124"><span class="linenos">124</span></a><span class="sd">        &gt;&gt;&gt; custom_aspects = [ActiveAspect.CONJUNCTION, ActiveAspect.OPPOSITION]</span>
</span><span id="TransitsTimeRangeFactory-125"><a href="#TransitsTimeRangeFactory-125"><span class="linenos">125</span></a><span class="sd">        &gt;&gt;&gt; factory = TransitsTimeRangeFactory(</span>
</span><span id="TransitsTimeRangeFactory-126"><a href="#TransitsTimeRangeFactory-126"><span class="linenos">126</span></a><span class="sd">        ...     natal_chart, ephemeris_data,</span>
</span><span id="TransitsTimeRangeFactory-127"><a href="#TransitsTimeRangeFactory-127"><span class="linenos">127</span></a><span class="sd">        ...     active_points=custom_points,</span>
</span><span id="TransitsTimeRangeFactory-128"><a href="#TransitsTimeRangeFactory-128"><span class="linenos">128</span></a><span class="sd">        ...     active_aspects=custom_aspects</span>
</span><span id="TransitsTimeRangeFactory-129"><a href="#TransitsTimeRangeFactory-129"><span class="linenos">129</span></a><span class="sd">        ... )</span>
</span><span id="TransitsTimeRangeFactory-130"><a href="#TransitsTimeRangeFactory-130"><span class="linenos">130</span></a>
</span><span id="TransitsTimeRangeFactory-131"><a href="#TransitsTimeRangeFactory-131"><span class="linenos">131</span></a><span class="sd">    Note:</span>
</span><span id="TransitsTimeRangeFactory-132"><a href="#TransitsTimeRangeFactory-132"><span class="linenos">132</span></a><span class="sd">        - Calculation time scales with the number of ephemeris data points</span>
</span><span id="TransitsTimeRangeFactory-133"><a href="#TransitsTimeRangeFactory-133"><span class="linenos">133</span></a><span class="sd">        - More active points and aspects increase computational requirements</span>
</span><span id="TransitsTimeRangeFactory-134"><a href="#TransitsTimeRangeFactory-134"><span class="linenos">134</span></a><span class="sd">        - The natal chart&#39;s coordinate system should match the ephemeris data</span>
</span><span id="TransitsTimeRangeFactory-135"><a href="#TransitsTimeRangeFactory-135"><span class="linenos">135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory-136"><a href="#TransitsTimeRangeFactory-136"><span class="linenos">136</span></a>
</span><span id="TransitsTimeRangeFactory-137"><a href="#TransitsTimeRangeFactory-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory-138"><a href="#TransitsTimeRangeFactory-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-139"><a href="#TransitsTimeRangeFactory-139"><span class="linenos">139</span></a>        <span class="n">natal_chart</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-140"><a href="#TransitsTimeRangeFactory-140"><span class="linenos">140</span></a>        <span class="n">ephemeris_data_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="TransitsTimeRangeFactory-141"><a href="#TransitsTimeRangeFactory-141"><span class="linenos">141</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-142"><a href="#TransitsTimeRangeFactory-142"><span class="linenos">142</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-143"><a href="#TransitsTimeRangeFactory-143"><span class="linenos">143</span></a>        <span class="n">settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">KerykeionSettingsModel</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-144"><a href="#TransitsTimeRangeFactory-144"><span class="linenos">144</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-145"><a href="#TransitsTimeRangeFactory-145"><span class="linenos">145</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-146"><a href="#TransitsTimeRangeFactory-146"><span class="linenos">146</span></a>    <span class="p">):</span>
</span><span id="TransitsTimeRangeFactory-147"><a href="#TransitsTimeRangeFactory-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory-148"><a href="#TransitsTimeRangeFactory-148"><span class="linenos">148</span></a><span class="sd">        Initialize the TransitsTimeRangeFactory with calculation parameters.</span>
</span><span id="TransitsTimeRangeFactory-149"><a href="#TransitsTimeRangeFactory-149"><span class="linenos">149</span></a>
</span><span id="TransitsTimeRangeFactory-150"><a href="#TransitsTimeRangeFactory-150"><span class="linenos">150</span></a><span class="sd">        Sets up the factory with all necessary data and configuration for calculating</span>
</span><span id="TransitsTimeRangeFactory-151"><a href="#TransitsTimeRangeFactory-151"><span class="linenos">151</span></a><span class="sd">        transits across the specified time period. The natal chart serves as the</span>
</span><span id="TransitsTimeRangeFactory-152"><a href="#TransitsTimeRangeFactory-152"><span class="linenos">152</span></a><span class="sd">        reference point, while ephemeris data points provide the transiting positions</span>
</span><span id="TransitsTimeRangeFactory-153"><a href="#TransitsTimeRangeFactory-153"><span class="linenos">153</span></a><span class="sd">        for comparison.</span>
</span><span id="TransitsTimeRangeFactory-154"><a href="#TransitsTimeRangeFactory-154"><span class="linenos">154</span></a>
</span><span id="TransitsTimeRangeFactory-155"><a href="#TransitsTimeRangeFactory-155"><span class="linenos">155</span></a><span class="sd">        Args:</span>
</span><span id="TransitsTimeRangeFactory-156"><a href="#TransitsTimeRangeFactory-156"><span class="linenos">156</span></a><span class="sd">            natal_chart (AstrologicalSubjectModel): Reference natal chart containing</span>
</span><span id="TransitsTimeRangeFactory-157"><a href="#TransitsTimeRangeFactory-157"><span class="linenos">157</span></a><span class="sd">                the baseline planetary positions for transit calculations.</span>
</span><span id="TransitsTimeRangeFactory-158"><a href="#TransitsTimeRangeFactory-158"><span class="linenos">158</span></a><span class="sd">            ephemeris_data_points (List[AstrologicalSubjectModel]): Time-ordered list</span>
</span><span id="TransitsTimeRangeFactory-159"><a href="#TransitsTimeRangeFactory-159"><span class="linenos">159</span></a><span class="sd">                of planetary positions representing different moments in time.</span>
</span><span id="TransitsTimeRangeFactory-160"><a href="#TransitsTimeRangeFactory-160"><span class="linenos">160</span></a><span class="sd">                Typically generated by EphemerisDataFactory.</span>
</span><span id="TransitsTimeRangeFactory-161"><a href="#TransitsTimeRangeFactory-161"><span class="linenos">161</span></a><span class="sd">            active_points (List[AstrologicalPoint], optional): Celestial bodies to</span>
</span><span id="TransitsTimeRangeFactory-162"><a href="#TransitsTimeRangeFactory-162"><span class="linenos">162</span></a><span class="sd">                include in aspect calculations. Determines which planets/points are</span>
</span><span id="TransitsTimeRangeFactory-163"><a href="#TransitsTimeRangeFactory-163"><span class="linenos">163</span></a><span class="sd">                analyzed for aspects. Defaults to DEFAULT_ACTIVE_POINTS.</span>
</span><span id="TransitsTimeRangeFactory-164"><a href="#TransitsTimeRangeFactory-164"><span class="linenos">164</span></a><span class="sd">            active_aspects (List[ActiveAspect], optional): Types of angular relationships</span>
</span><span id="TransitsTimeRangeFactory-165"><a href="#TransitsTimeRangeFactory-165"><span class="linenos">165</span></a><span class="sd">                to calculate between natal and transiting positions. Defaults to</span>
</span><span id="TransitsTimeRangeFactory-166"><a href="#TransitsTimeRangeFactory-166"><span class="linenos">166</span></a><span class="sd">                DEFAULT_ACTIVE_ASPECTS.</span>
</span><span id="TransitsTimeRangeFactory-167"><a href="#TransitsTimeRangeFactory-167"><span class="linenos">167</span></a><span class="sd">            settings_file (Union[Path, KerykeionSettingsModel, dict, None], optional):</span>
</span><span id="TransitsTimeRangeFactory-168"><a href="#TransitsTimeRangeFactory-168"><span class="linenos">168</span></a><span class="sd">                Configuration settings for orb tolerances, calculation methods, and</span>
</span><span id="TransitsTimeRangeFactory-169"><a href="#TransitsTimeRangeFactory-169"><span class="linenos">169</span></a><span class="sd">                other parameters. Defaults to None (uses system defaults).</span>
</span><span id="TransitsTimeRangeFactory-170"><a href="#TransitsTimeRangeFactory-170"><span class="linenos">170</span></a><span class="sd">            axis_orb_limit (float | None, optional): Optional orb threshold for</span>
</span><span id="TransitsTimeRangeFactory-171"><a href="#TransitsTimeRangeFactory-171"><span class="linenos">171</span></a><span class="sd">                chart axes applied during aspect calculations.</span>
</span><span id="TransitsTimeRangeFactory-172"><a href="#TransitsTimeRangeFactory-172"><span class="linenos">172</span></a>
</span><span id="TransitsTimeRangeFactory-173"><a href="#TransitsTimeRangeFactory-173"><span class="linenos">173</span></a><span class="sd">        Note:</span>
</span><span id="TransitsTimeRangeFactory-174"><a href="#TransitsTimeRangeFactory-174"><span class="linenos">174</span></a><span class="sd">            - All ephemeris data points should use the same coordinate system as the natal chart</span>
</span><span id="TransitsTimeRangeFactory-175"><a href="#TransitsTimeRangeFactory-175"><span class="linenos">175</span></a><span class="sd">            - The order of ephemeris_data_points determines the chronological sequence</span>
</span><span id="TransitsTimeRangeFactory-176"><a href="#TransitsTimeRangeFactory-176"><span class="linenos">176</span></a><span class="sd">            - Settings affect orb tolerances and calculation precision</span>
</span><span id="TransitsTimeRangeFactory-177"><a href="#TransitsTimeRangeFactory-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory-178"><a href="#TransitsTimeRangeFactory-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">natal_chart</span> <span class="o">=</span> <span class="n">natal_chart</span>
</span><span id="TransitsTimeRangeFactory-179"><a href="#TransitsTimeRangeFactory-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_data_points</span> <span class="o">=</span> <span class="n">ephemeris_data_points</span>
</span><span id="TransitsTimeRangeFactory-180"><a href="#TransitsTimeRangeFactory-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">active_points</span>
</span><span id="TransitsTimeRangeFactory-181"><a href="#TransitsTimeRangeFactory-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="TransitsTimeRangeFactory-182"><a href="#TransitsTimeRangeFactory-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings_file</span> <span class="o">=</span> <span class="n">settings_file</span>
</span><span id="TransitsTimeRangeFactory-183"><a href="#TransitsTimeRangeFactory-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis_orb_limit</span> <span class="o">=</span> <span class="n">axis_orb_limit</span>
</span><span id="TransitsTimeRangeFactory-184"><a href="#TransitsTimeRangeFactory-184"><span class="linenos">184</span></a>
</span><span id="TransitsTimeRangeFactory-185"><a href="#TransitsTimeRangeFactory-185"><span class="linenos">185</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_transit_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitsTimeRangeModel</span><span class="p">:</span>
</span><span id="TransitsTimeRangeFactory-186"><a href="#TransitsTimeRangeFactory-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory-187"><a href="#TransitsTimeRangeFactory-187"><span class="linenos">187</span></a><span class="sd">        Calculate and generate transit data for all configured time points.</span>
</span><span id="TransitsTimeRangeFactory-188"><a href="#TransitsTimeRangeFactory-188"><span class="linenos">188</span></a>
</span><span id="TransitsTimeRangeFactory-189"><a href="#TransitsTimeRangeFactory-189"><span class="linenos">189</span></a><span class="sd">        This method processes each ephemeris data point to identify angular relationships</span>
</span><span id="TransitsTimeRangeFactory-190"><a href="#TransitsTimeRangeFactory-190"><span class="linenos">190</span></a><span class="sd">        (aspects) between transiting celestial bodies and natal chart positions. It</span>
</span><span id="TransitsTimeRangeFactory-191"><a href="#TransitsTimeRangeFactory-191"><span class="linenos">191</span></a><span class="sd">        creates a comprehensive model containing all transit moments with their</span>
</span><span id="TransitsTimeRangeFactory-192"><a href="#TransitsTimeRangeFactory-192"><span class="linenos">192</span></a><span class="sd">        corresponding aspects and timestamps.</span>
</span><span id="TransitsTimeRangeFactory-193"><a href="#TransitsTimeRangeFactory-193"><span class="linenos">193</span></a>
</span><span id="TransitsTimeRangeFactory-194"><a href="#TransitsTimeRangeFactory-194"><span class="linenos">194</span></a><span class="sd">        The calculation process:</span>
</span><span id="TransitsTimeRangeFactory-195"><a href="#TransitsTimeRangeFactory-195"><span class="linenos">195</span></a><span class="sd">        1. Iterates through each ephemeris data point chronologically</span>
</span><span id="TransitsTimeRangeFactory-196"><a href="#TransitsTimeRangeFactory-196"><span class="linenos">196</span></a><span class="sd">        2. Compares transiting planetary positions with natal chart positions</span>
</span><span id="TransitsTimeRangeFactory-197"><a href="#TransitsTimeRangeFactory-197"><span class="linenos">197</span></a><span class="sd">        3. Identifies aspects that fall within the configured orb tolerances</span>
</span><span id="TransitsTimeRangeFactory-198"><a href="#TransitsTimeRangeFactory-198"><span class="linenos">198</span></a><span class="sd">        4. Creates timestamped transit moment records</span>
</span><span id="TransitsTimeRangeFactory-199"><a href="#TransitsTimeRangeFactory-199"><span class="linenos">199</span></a><span class="sd">        5. Compiles all data into a structured model for analysis</span>
</span><span id="TransitsTimeRangeFactory-200"><a href="#TransitsTimeRangeFactory-200"><span class="linenos">200</span></a>
</span><span id="TransitsTimeRangeFactory-201"><a href="#TransitsTimeRangeFactory-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="TransitsTimeRangeFactory-202"><a href="#TransitsTimeRangeFactory-202"><span class="linenos">202</span></a><span class="sd">            TransitsTimeRangeModel: A comprehensive model containing:</span>
</span><span id="TransitsTimeRangeFactory-203"><a href="#TransitsTimeRangeFactory-203"><span class="linenos">203</span></a><span class="sd">                - dates (List[str]): ISO-formatted datetime strings for all data points</span>
</span><span id="TransitsTimeRangeFactory-204"><a href="#TransitsTimeRangeFactory-204"><span class="linenos">204</span></a><span class="sd">                - subject (AstrologicalSubjectModel): The natal chart used as reference</span>
</span><span id="TransitsTimeRangeFactory-205"><a href="#TransitsTimeRangeFactory-205"><span class="linenos">205</span></a><span class="sd">                - transits (List[TransitMomentModel]): Chronological list of transit moments,</span>
</span><span id="TransitsTimeRangeFactory-206"><a href="#TransitsTimeRangeFactory-206"><span class="linenos">206</span></a><span class="sd">                  each containing:</span>
</span><span id="TransitsTimeRangeFactory-207"><a href="#TransitsTimeRangeFactory-207"><span class="linenos">207</span></a><span class="sd">                  * date (str): ISO-formatted timestamp for the transit moment</span>
</span><span id="TransitsTimeRangeFactory-208"><a href="#TransitsTimeRangeFactory-208"><span class="linenos">208</span></a><span class="sd">                  * aspects (List[RelevantAspect]): All aspects formed at this moment</span>
</span><span id="TransitsTimeRangeFactory-209"><a href="#TransitsTimeRangeFactory-209"><span class="linenos">209</span></a><span class="sd">                    between transiting and natal positions</span>
</span><span id="TransitsTimeRangeFactory-210"><a href="#TransitsTimeRangeFactory-210"><span class="linenos">210</span></a>
</span><span id="TransitsTimeRangeFactory-211"><a href="#TransitsTimeRangeFactory-211"><span class="linenos">211</span></a><span class="sd">        Examples:</span>
</span><span id="TransitsTimeRangeFactory-212"><a href="#TransitsTimeRangeFactory-212"><span class="linenos">212</span></a><span class="sd">            Basic usage:</span>
</span><span id="TransitsTimeRangeFactory-213"><a href="#TransitsTimeRangeFactory-213"><span class="linenos">213</span></a>
</span><span id="TransitsTimeRangeFactory-214"><a href="#TransitsTimeRangeFactory-214"><span class="linenos">214</span></a><span class="sd">            &gt;&gt;&gt; factory = TransitsTimeRangeFactory(natal_chart, ephemeris_data)</span>
</span><span id="TransitsTimeRangeFactory-215"><a href="#TransitsTimeRangeFactory-215"><span class="linenos">215</span></a><span class="sd">            &gt;&gt;&gt; results = factory.get_transit_moments()</span>
</span><span id="TransitsTimeRangeFactory-216"><a href="#TransitsTimeRangeFactory-216"><span class="linenos">216</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="TransitsTimeRangeFactory-217"><a href="#TransitsTimeRangeFactory-217"><span class="linenos">217</span></a><span class="sd">            &gt;&gt;&gt; # Access specific data</span>
</span><span id="TransitsTimeRangeFactory-218"><a href="#TransitsTimeRangeFactory-218"><span class="linenos">218</span></a><span class="sd">            &gt;&gt;&gt; all_dates = results.dates</span>
</span><span id="TransitsTimeRangeFactory-219"><a href="#TransitsTimeRangeFactory-219"><span class="linenos">219</span></a><span class="sd">            &gt;&gt;&gt; first_transit = results.transits[0]</span>
</span><span id="TransitsTimeRangeFactory-220"><a href="#TransitsTimeRangeFactory-220"><span class="linenos">220</span></a><span class="sd">            &gt;&gt;&gt; aspects_at_first_moment = first_transit.aspects</span>
</span><span id="TransitsTimeRangeFactory-221"><a href="#TransitsTimeRangeFactory-221"><span class="linenos">221</span></a>
</span><span id="TransitsTimeRangeFactory-222"><a href="#TransitsTimeRangeFactory-222"><span class="linenos">222</span></a><span class="sd">            Processing results:</span>
</span><span id="TransitsTimeRangeFactory-223"><a href="#TransitsTimeRangeFactory-223"><span class="linenos">223</span></a>
</span><span id="TransitsTimeRangeFactory-224"><a href="#TransitsTimeRangeFactory-224"><span class="linenos">224</span></a><span class="sd">            &gt;&gt;&gt; results = factory.get_transit_moments()</span>
</span><span id="TransitsTimeRangeFactory-225"><a href="#TransitsTimeRangeFactory-225"><span class="linenos">225</span></a><span class="sd">            &gt;&gt;&gt; for transit_moment in results.transits:</span>
</span><span id="TransitsTimeRangeFactory-226"><a href="#TransitsTimeRangeFactory-226"><span class="linenos">226</span></a><span class="sd">            ...     print(f&quot;Date: {transit_moment.date}&quot;)</span>
</span><span id="TransitsTimeRangeFactory-227"><a href="#TransitsTimeRangeFactory-227"><span class="linenos">227</span></a><span class="sd">            ...     for aspect in transit_moment.aspects:</span>
</span><span id="TransitsTimeRangeFactory-228"><a href="#TransitsTimeRangeFactory-228"><span class="linenos">228</span></a><span class="sd">            ...         print(f&quot;  {aspect.p1_name} {aspect.aspect} {aspect.p2_name}&quot;)</span>
</span><span id="TransitsTimeRangeFactory-229"><a href="#TransitsTimeRangeFactory-229"><span class="linenos">229</span></a>
</span><span id="TransitsTimeRangeFactory-230"><a href="#TransitsTimeRangeFactory-230"><span class="linenos">230</span></a><span class="sd">        Performance Notes:</span>
</span><span id="TransitsTimeRangeFactory-231"><a href="#TransitsTimeRangeFactory-231"><span class="linenos">231</span></a><span class="sd">            - Calculation time is proportional to: number of time points  active points  active aspects</span>
</span><span id="TransitsTimeRangeFactory-232"><a href="#TransitsTimeRangeFactory-232"><span class="linenos">232</span></a><span class="sd">            - Large datasets may require significant processing time</span>
</span><span id="TransitsTimeRangeFactory-233"><a href="#TransitsTimeRangeFactory-233"><span class="linenos">233</span></a><span class="sd">            - Memory usage scales with the number of aspects found</span>
</span><span id="TransitsTimeRangeFactory-234"><a href="#TransitsTimeRangeFactory-234"><span class="linenos">234</span></a><span class="sd">            - Consider filtering active_points and active_aspects for better performance</span>
</span><span id="TransitsTimeRangeFactory-235"><a href="#TransitsTimeRangeFactory-235"><span class="linenos">235</span></a>
</span><span id="TransitsTimeRangeFactory-236"><a href="#TransitsTimeRangeFactory-236"><span class="linenos">236</span></a><span class="sd">        See Also:</span>
</span><span id="TransitsTimeRangeFactory-237"><a href="#TransitsTimeRangeFactory-237"><span class="linenos">237</span></a><span class="sd">            TransitMomentModel: Individual transit moment structure</span>
</span><span id="TransitsTimeRangeFactory-238"><a href="#TransitsTimeRangeFactory-238"><span class="linenos">238</span></a><span class="sd">            TransitsTimeRangeModel: Complete transit dataset structure</span>
</span><span id="TransitsTimeRangeFactory-239"><a href="#TransitsTimeRangeFactory-239"><span class="linenos">239</span></a><span class="sd">            AspectsFactory: Underlying aspect calculation engine</span>
</span><span id="TransitsTimeRangeFactory-240"><a href="#TransitsTimeRangeFactory-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory-241"><a href="#TransitsTimeRangeFactory-241"><span class="linenos">241</span></a>        <span class="n">transit_moments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TransitsTimeRangeFactory-242"><a href="#TransitsTimeRangeFactory-242"><span class="linenos">242</span></a>
</span><span id="TransitsTimeRangeFactory-243"><a href="#TransitsTimeRangeFactory-243"><span class="linenos">243</span></a>        <span class="k">for</span> <span class="n">ephemeris_point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_data_points</span><span class="p">:</span>
</span><span id="TransitsTimeRangeFactory-244"><a href="#TransitsTimeRangeFactory-244"><span class="linenos">244</span></a>            <span class="c1"># Calculate aspects between transit positions and natal chart</span>
</span><span id="TransitsTimeRangeFactory-245"><a href="#TransitsTimeRangeFactory-245"><span class="linenos">245</span></a>            <span class="n">aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory-246"><a href="#TransitsTimeRangeFactory-246"><span class="linenos">246</span></a>                <span class="n">ephemeris_point</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-247"><a href="#TransitsTimeRangeFactory-247"><span class="linenos">247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">natal_chart</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-248"><a href="#TransitsTimeRangeFactory-248"><span class="linenos">248</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-249"><a href="#TransitsTimeRangeFactory-249"><span class="linenos">249</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-250"><a href="#TransitsTimeRangeFactory-250"><span class="linenos">250</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-251"><a href="#TransitsTimeRangeFactory-251"><span class="linenos">251</span></a>                <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># Transit is moving</span>
</span><span id="TransitsTimeRangeFactory-252"><a href="#TransitsTimeRangeFactory-252"><span class="linenos">252</span></a>                <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Natal is fixed</span>
</span><span id="TransitsTimeRangeFactory-253"><a href="#TransitsTimeRangeFactory-253"><span class="linenos">253</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="TransitsTimeRangeFactory-254"><a href="#TransitsTimeRangeFactory-254"><span class="linenos">254</span></a>
</span><span id="TransitsTimeRangeFactory-255"><a href="#TransitsTimeRangeFactory-255"><span class="linenos">255</span></a>            <span class="c1"># Create a transit moment for this point in time</span>
</span><span id="TransitsTimeRangeFactory-256"><a href="#TransitsTimeRangeFactory-256"><span class="linenos">256</span></a>            <span class="n">transit_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory-257"><a href="#TransitsTimeRangeFactory-257"><span class="linenos">257</span></a>                <span class="n">TransitMomentModel</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory-258"><a href="#TransitsTimeRangeFactory-258"><span class="linenos">258</span></a>                    <span class="n">date</span><span class="o">=</span><span class="n">ephemeris_point</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-259"><a href="#TransitsTimeRangeFactory-259"><span class="linenos">259</span></a>                    <span class="n">aspects</span><span class="o">=</span><span class="n">aspects</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-260"><a href="#TransitsTimeRangeFactory-260"><span class="linenos">260</span></a>                <span class="p">)</span>
</span><span id="TransitsTimeRangeFactory-261"><a href="#TransitsTimeRangeFactory-261"><span class="linenos">261</span></a>            <span class="p">)</span>
</span><span id="TransitsTimeRangeFactory-262"><a href="#TransitsTimeRangeFactory-262"><span class="linenos">262</span></a>
</span><span id="TransitsTimeRangeFactory-263"><a href="#TransitsTimeRangeFactory-263"><span class="linenos">263</span></a>        <span class="c1"># Create and return the complete transits model</span>
</span><span id="TransitsTimeRangeFactory-264"><a href="#TransitsTimeRangeFactory-264"><span class="linenos">264</span></a>        <span class="k">return</span> <span class="n">TransitsTimeRangeModel</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory-265"><a href="#TransitsTimeRangeFactory-265"><span class="linenos">265</span></a>            <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_data_points</span><span class="p">],</span>
</span><span id="TransitsTimeRangeFactory-266"><a href="#TransitsTimeRangeFactory-266"><span class="linenos">266</span></a>            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">natal_chart</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory-267"><a href="#TransitsTimeRangeFactory-267"><span class="linenos">267</span></a>            <span class="n">transits</span><span class="o">=</span><span class="n">transit_moments</span>
</span><span id="TransitsTimeRangeFactory-268"><a href="#TransitsTimeRangeFactory-268"><span class="linenos">268</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Factory class for calculating astrological transits over time periods.</p>

<p>This class analyzes the angular relationships (aspects) between transiting
celestial bodies and natal chart positions across multiple time points,
generating structured transit data for astrological analysis.</p>

<p>The factory compares ephemeris data points (representing planetary positions
at different moments) with a natal chart to identify when specific geometric
configurations occur between transiting and natal celestial bodies.</p>

<p>Args:
    natal_chart (AstrologicalSubjectModel): The natal chart used as the reference
        point for transit calculations. All transiting positions are compared
        against this chart's planetary positions.
    ephemeris_data_points (List[AstrologicalSubjectModel]): A list of astrological
        subject models representing different moments in time, typically generated
        by EphemerisDataFactory. Each point contains planetary positions for
        a specific date/time.
    active_points (List[AstrologicalPoint], optional): List of celestial bodies
        to include in aspect calculations (e.g., Sun, Moon, planets, asteroids).
        Defaults to DEFAULT_ACTIVE_POINTS.
    active_aspects (List[ActiveAspect], optional): List of aspect types to
        calculate (e.g., conjunction, opposition, trine, square, sextile).
        Defaults to DEFAULT_ACTIVE_ASPECTS.
    settings_file (Union[Path, KerykeionSettingsModel, dict, None], optional):
        Configuration settings for calculations. Can be a file path, settings
        model, dictionary, or None for defaults. Defaults to None.
    axis_orb_limit (float | None, optional): Optional orb threshold applied to chart axes
        during single-chart aspect calculations. Dual-chart calculations ignore this value.</p>

<p>Attributes:
    natal_chart: The reference natal chart for transit calculations.
    ephemeris_data_points: Time-series planetary position data.
    active_points: Celestial bodies included in calculations.
    active_aspects: Aspect types considered for analysis.
    settings_file: Configuration settings for the calculations.
    axis_orb_limit: Optional orb override used when calculating single-chart aspects.</p>

<p>Examples:
    Basic transit calculation:</p>

<pre><code>&gt;&gt;&gt; natal_chart = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(...)
&gt;&gt;&gt; ephemeris_data = ephemeris_factory.get_ephemeris_data_as_astrological_subjects()
&gt;&gt;&gt; factory = TransitsTimeRangeFactory(natal_chart, ephemeris_data)
&gt;&gt;&gt; transits = factory.get_transit_moments()

Custom configuration:

&gt;&gt;&gt; from kerykeion.schemas import AstrologicalPoint, ActiveAspect
&gt;&gt;&gt; custom_points = ["Sun", "Moon"]
&gt;&gt;&gt; custom_aspects = [ActiveAspect.CONJUNCTION, ActiveAspect.OPPOSITION]
&gt;&gt;&gt; factory = TransitsTimeRangeFactory(
...     natal_chart, ephemeris_data,
...     active_points=custom_points,
...     active_aspects=custom_aspects
... )
</code></pre>

<p>Note:
    - Calculation time scales with the number of ephemeris data points
    - More active points and aspects increase computational requirements
    - The natal chart's coordinate system should match the ephemeris data</p>
</div>


                            <div id="TransitsTimeRangeFactory.__init__" class="classattr">
                                        <input id="TransitsTimeRangeFactory.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TransitsTimeRangeFactory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">natal_chart</span><span class="p">:</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>,</span><span class="param">	<span class="n">ephemeris_data_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">]</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;conjunction&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;opposition&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;trine&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sextile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;quintile&#39;</span><span class="p">,</span> <span class="s1">&#39;orb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>,</span><span class="param">	<span class="n">settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n"><a href="#KerykeionSettingsModel">KerykeionSettingsModel</a></span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="TransitsTimeRangeFactory.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TransitsTimeRangeFactory.__init__-137"><a href="#TransitsTimeRangeFactory.__init__-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory.__init__-138"><a href="#TransitsTimeRangeFactory.__init__-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-139"><a href="#TransitsTimeRangeFactory.__init__-139"><span class="linenos">139</span></a>        <span class="n">natal_chart</span><span class="p">:</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-140"><a href="#TransitsTimeRangeFactory.__init__-140"><span class="linenos">140</span></a>        <span class="n">ephemeris_data_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="TransitsTimeRangeFactory.__init__-141"><a href="#TransitsTimeRangeFactory.__init__-141"><span class="linenos">141</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-142"><a href="#TransitsTimeRangeFactory.__init__-142"><span class="linenos">142</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-143"><a href="#TransitsTimeRangeFactory.__init__-143"><span class="linenos">143</span></a>        <span class="n">settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">KerykeionSettingsModel</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-144"><a href="#TransitsTimeRangeFactory.__init__-144"><span class="linenos">144</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-145"><a href="#TransitsTimeRangeFactory.__init__-145"><span class="linenos">145</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.__init__-146"><a href="#TransitsTimeRangeFactory.__init__-146"><span class="linenos">146</span></a>    <span class="p">):</span>
</span><span id="TransitsTimeRangeFactory.__init__-147"><a href="#TransitsTimeRangeFactory.__init__-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory.__init__-148"><a href="#TransitsTimeRangeFactory.__init__-148"><span class="linenos">148</span></a><span class="sd">        Initialize the TransitsTimeRangeFactory with calculation parameters.</span>
</span><span id="TransitsTimeRangeFactory.__init__-149"><a href="#TransitsTimeRangeFactory.__init__-149"><span class="linenos">149</span></a>
</span><span id="TransitsTimeRangeFactory.__init__-150"><a href="#TransitsTimeRangeFactory.__init__-150"><span class="linenos">150</span></a><span class="sd">        Sets up the factory with all necessary data and configuration for calculating</span>
</span><span id="TransitsTimeRangeFactory.__init__-151"><a href="#TransitsTimeRangeFactory.__init__-151"><span class="linenos">151</span></a><span class="sd">        transits across the specified time period. The natal chart serves as the</span>
</span><span id="TransitsTimeRangeFactory.__init__-152"><a href="#TransitsTimeRangeFactory.__init__-152"><span class="linenos">152</span></a><span class="sd">        reference point, while ephemeris data points provide the transiting positions</span>
</span><span id="TransitsTimeRangeFactory.__init__-153"><a href="#TransitsTimeRangeFactory.__init__-153"><span class="linenos">153</span></a><span class="sd">        for comparison.</span>
</span><span id="TransitsTimeRangeFactory.__init__-154"><a href="#TransitsTimeRangeFactory.__init__-154"><span class="linenos">154</span></a>
</span><span id="TransitsTimeRangeFactory.__init__-155"><a href="#TransitsTimeRangeFactory.__init__-155"><span class="linenos">155</span></a><span class="sd">        Args:</span>
</span><span id="TransitsTimeRangeFactory.__init__-156"><a href="#TransitsTimeRangeFactory.__init__-156"><span class="linenos">156</span></a><span class="sd">            natal_chart (AstrologicalSubjectModel): Reference natal chart containing</span>
</span><span id="TransitsTimeRangeFactory.__init__-157"><a href="#TransitsTimeRangeFactory.__init__-157"><span class="linenos">157</span></a><span class="sd">                the baseline planetary positions for transit calculations.</span>
</span><span id="TransitsTimeRangeFactory.__init__-158"><a href="#TransitsTimeRangeFactory.__init__-158"><span class="linenos">158</span></a><span class="sd">            ephemeris_data_points (List[AstrologicalSubjectModel]): Time-ordered list</span>
</span><span id="TransitsTimeRangeFactory.__init__-159"><a href="#TransitsTimeRangeFactory.__init__-159"><span class="linenos">159</span></a><span class="sd">                of planetary positions representing different moments in time.</span>
</span><span id="TransitsTimeRangeFactory.__init__-160"><a href="#TransitsTimeRangeFactory.__init__-160"><span class="linenos">160</span></a><span class="sd">                Typically generated by EphemerisDataFactory.</span>
</span><span id="TransitsTimeRangeFactory.__init__-161"><a href="#TransitsTimeRangeFactory.__init__-161"><span class="linenos">161</span></a><span class="sd">            active_points (List[AstrologicalPoint], optional): Celestial bodies to</span>
</span><span id="TransitsTimeRangeFactory.__init__-162"><a href="#TransitsTimeRangeFactory.__init__-162"><span class="linenos">162</span></a><span class="sd">                include in aspect calculations. Determines which planets/points are</span>
</span><span id="TransitsTimeRangeFactory.__init__-163"><a href="#TransitsTimeRangeFactory.__init__-163"><span class="linenos">163</span></a><span class="sd">                analyzed for aspects. Defaults to DEFAULT_ACTIVE_POINTS.</span>
</span><span id="TransitsTimeRangeFactory.__init__-164"><a href="#TransitsTimeRangeFactory.__init__-164"><span class="linenos">164</span></a><span class="sd">            active_aspects (List[ActiveAspect], optional): Types of angular relationships</span>
</span><span id="TransitsTimeRangeFactory.__init__-165"><a href="#TransitsTimeRangeFactory.__init__-165"><span class="linenos">165</span></a><span class="sd">                to calculate between natal and transiting positions. Defaults to</span>
</span><span id="TransitsTimeRangeFactory.__init__-166"><a href="#TransitsTimeRangeFactory.__init__-166"><span class="linenos">166</span></a><span class="sd">                DEFAULT_ACTIVE_ASPECTS.</span>
</span><span id="TransitsTimeRangeFactory.__init__-167"><a href="#TransitsTimeRangeFactory.__init__-167"><span class="linenos">167</span></a><span class="sd">            settings_file (Union[Path, KerykeionSettingsModel, dict, None], optional):</span>
</span><span id="TransitsTimeRangeFactory.__init__-168"><a href="#TransitsTimeRangeFactory.__init__-168"><span class="linenos">168</span></a><span class="sd">                Configuration settings for orb tolerances, calculation methods, and</span>
</span><span id="TransitsTimeRangeFactory.__init__-169"><a href="#TransitsTimeRangeFactory.__init__-169"><span class="linenos">169</span></a><span class="sd">                other parameters. Defaults to None (uses system defaults).</span>
</span><span id="TransitsTimeRangeFactory.__init__-170"><a href="#TransitsTimeRangeFactory.__init__-170"><span class="linenos">170</span></a><span class="sd">            axis_orb_limit (float | None, optional): Optional orb threshold for</span>
</span><span id="TransitsTimeRangeFactory.__init__-171"><a href="#TransitsTimeRangeFactory.__init__-171"><span class="linenos">171</span></a><span class="sd">                chart axes applied during aspect calculations.</span>
</span><span id="TransitsTimeRangeFactory.__init__-172"><a href="#TransitsTimeRangeFactory.__init__-172"><span class="linenos">172</span></a>
</span><span id="TransitsTimeRangeFactory.__init__-173"><a href="#TransitsTimeRangeFactory.__init__-173"><span class="linenos">173</span></a><span class="sd">        Note:</span>
</span><span id="TransitsTimeRangeFactory.__init__-174"><a href="#TransitsTimeRangeFactory.__init__-174"><span class="linenos">174</span></a><span class="sd">            - All ephemeris data points should use the same coordinate system as the natal chart</span>
</span><span id="TransitsTimeRangeFactory.__init__-175"><a href="#TransitsTimeRangeFactory.__init__-175"><span class="linenos">175</span></a><span class="sd">            - The order of ephemeris_data_points determines the chronological sequence</span>
</span><span id="TransitsTimeRangeFactory.__init__-176"><a href="#TransitsTimeRangeFactory.__init__-176"><span class="linenos">176</span></a><span class="sd">            - Settings affect orb tolerances and calculation precision</span>
</span><span id="TransitsTimeRangeFactory.__init__-177"><a href="#TransitsTimeRangeFactory.__init__-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory.__init__-178"><a href="#TransitsTimeRangeFactory.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">natal_chart</span> <span class="o">=</span> <span class="n">natal_chart</span>
</span><span id="TransitsTimeRangeFactory.__init__-179"><a href="#TransitsTimeRangeFactory.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_data_points</span> <span class="o">=</span> <span class="n">ephemeris_data_points</span>
</span><span id="TransitsTimeRangeFactory.__init__-180"><a href="#TransitsTimeRangeFactory.__init__-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="n">active_points</span>
</span><span id="TransitsTimeRangeFactory.__init__-181"><a href="#TransitsTimeRangeFactory.__init__-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="TransitsTimeRangeFactory.__init__-182"><a href="#TransitsTimeRangeFactory.__init__-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings_file</span> <span class="o">=</span> <span class="n">settings_file</span>
</span><span id="TransitsTimeRangeFactory.__init__-183"><a href="#TransitsTimeRangeFactory.__init__-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis_orb_limit</span> <span class="o">=</span> <span class="n">axis_orb_limit</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the TransitsTimeRangeFactory with calculation parameters.</p>

<p>Sets up the factory with all necessary data and configuration for calculating
transits across the specified time period. The natal chart serves as the
reference point, while ephemeris data points provide the transiting positions
for comparison.</p>

<p>Args:
    natal_chart (AstrologicalSubjectModel): Reference natal chart containing
        the baseline planetary positions for transit calculations.
    ephemeris_data_points (List[AstrologicalSubjectModel]): Time-ordered list
        of planetary positions representing different moments in time.
        Typically generated by EphemerisDataFactory.
    active_points (List[AstrologicalPoint], optional): Celestial bodies to
        include in aspect calculations. Determines which planets/points are
        analyzed for aspects. Defaults to DEFAULT_ACTIVE_POINTS.
    active_aspects (List[ActiveAspect], optional): Types of angular relationships
        to calculate between natal and transiting positions. Defaults to
        DEFAULT_ACTIVE_ASPECTS.
    settings_file (Union[Path, KerykeionSettingsModel, dict, None], optional):
        Configuration settings for orb tolerances, calculation methods, and
        other parameters. Defaults to None (uses system defaults).
    axis_orb_limit (float | None, optional): Optional orb threshold for
        chart axes applied during aspect calculations.</p>

<p>Note:
    - All ephemeris data points should use the same coordinate system as the natal chart
    - The order of ephemeris_data_points determines the chronological sequence
    - Settings affect orb tolerances and calculation precision</p>
</div>


                            </div>
                            <div id="TransitsTimeRangeFactory.natal_chart" class="classattr">
                                <div class="attr variable">
            <span class="name">natal_chart</span>

        
    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.natal_chart"></a>
    
    

                            </div>
                            <div id="TransitsTimeRangeFactory.ephemeris_data_points" class="classattr">
                                <div class="attr variable">
            <span class="name">ephemeris_data_points</span>

        
    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.ephemeris_data_points"></a>
    
    

                            </div>
                            <div id="TransitsTimeRangeFactory.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span>

        
    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.active_points"></a>
    
    

                            </div>
                            <div id="TransitsTimeRangeFactory.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span>

        
    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.active_aspects"></a>
    
    

                            </div>
                            <div id="TransitsTimeRangeFactory.settings_file" class="classattr">
                                <div class="attr variable">
            <span class="name">settings_file</span>

        
    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.settings_file"></a>
    
    

                            </div>
                            <div id="TransitsTimeRangeFactory.axis_orb_limit" class="classattr">
                                <div class="attr variable">
            <span class="name">axis_orb_limit</span>

        
    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.axis_orb_limit"></a>
    
    

                            </div>
                            <div id="TransitsTimeRangeFactory.get_transit_moments" class="classattr">
                                        <input id="TransitsTimeRangeFactory.get_transit_moments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_transit_moments</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">TransitsTimeRangeModel</span>:</span></span>

                <label class="view-source-button" for="TransitsTimeRangeFactory.get_transit_moments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TransitsTimeRangeFactory.get_transit_moments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TransitsTimeRangeFactory.get_transit_moments-185"><a href="#TransitsTimeRangeFactory.get_transit_moments-185"><span class="linenos">185</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_transit_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitsTimeRangeModel</span><span class="p">:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-186"><a href="#TransitsTimeRangeFactory.get_transit_moments-186"><span class="linenos">186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-187"><a href="#TransitsTimeRangeFactory.get_transit_moments-187"><span class="linenos">187</span></a><span class="sd">        Calculate and generate transit data for all configured time points.</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-188"><a href="#TransitsTimeRangeFactory.get_transit_moments-188"><span class="linenos">188</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-189"><a href="#TransitsTimeRangeFactory.get_transit_moments-189"><span class="linenos">189</span></a><span class="sd">        This method processes each ephemeris data point to identify angular relationships</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-190"><a href="#TransitsTimeRangeFactory.get_transit_moments-190"><span class="linenos">190</span></a><span class="sd">        (aspects) between transiting celestial bodies and natal chart positions. It</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-191"><a href="#TransitsTimeRangeFactory.get_transit_moments-191"><span class="linenos">191</span></a><span class="sd">        creates a comprehensive model containing all transit moments with their</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-192"><a href="#TransitsTimeRangeFactory.get_transit_moments-192"><span class="linenos">192</span></a><span class="sd">        corresponding aspects and timestamps.</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-193"><a href="#TransitsTimeRangeFactory.get_transit_moments-193"><span class="linenos">193</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-194"><a href="#TransitsTimeRangeFactory.get_transit_moments-194"><span class="linenos">194</span></a><span class="sd">        The calculation process:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-195"><a href="#TransitsTimeRangeFactory.get_transit_moments-195"><span class="linenos">195</span></a><span class="sd">        1. Iterates through each ephemeris data point chronologically</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-196"><a href="#TransitsTimeRangeFactory.get_transit_moments-196"><span class="linenos">196</span></a><span class="sd">        2. Compares transiting planetary positions with natal chart positions</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-197"><a href="#TransitsTimeRangeFactory.get_transit_moments-197"><span class="linenos">197</span></a><span class="sd">        3. Identifies aspects that fall within the configured orb tolerances</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-198"><a href="#TransitsTimeRangeFactory.get_transit_moments-198"><span class="linenos">198</span></a><span class="sd">        4. Creates timestamped transit moment records</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-199"><a href="#TransitsTimeRangeFactory.get_transit_moments-199"><span class="linenos">199</span></a><span class="sd">        5. Compiles all data into a structured model for analysis</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-200"><a href="#TransitsTimeRangeFactory.get_transit_moments-200"><span class="linenos">200</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-201"><a href="#TransitsTimeRangeFactory.get_transit_moments-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-202"><a href="#TransitsTimeRangeFactory.get_transit_moments-202"><span class="linenos">202</span></a><span class="sd">            TransitsTimeRangeModel: A comprehensive model containing:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-203"><a href="#TransitsTimeRangeFactory.get_transit_moments-203"><span class="linenos">203</span></a><span class="sd">                - dates (List[str]): ISO-formatted datetime strings for all data points</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-204"><a href="#TransitsTimeRangeFactory.get_transit_moments-204"><span class="linenos">204</span></a><span class="sd">                - subject (AstrologicalSubjectModel): The natal chart used as reference</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-205"><a href="#TransitsTimeRangeFactory.get_transit_moments-205"><span class="linenos">205</span></a><span class="sd">                - transits (List[TransitMomentModel]): Chronological list of transit moments,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-206"><a href="#TransitsTimeRangeFactory.get_transit_moments-206"><span class="linenos">206</span></a><span class="sd">                  each containing:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-207"><a href="#TransitsTimeRangeFactory.get_transit_moments-207"><span class="linenos">207</span></a><span class="sd">                  * date (str): ISO-formatted timestamp for the transit moment</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-208"><a href="#TransitsTimeRangeFactory.get_transit_moments-208"><span class="linenos">208</span></a><span class="sd">                  * aspects (List[RelevantAspect]): All aspects formed at this moment</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-209"><a href="#TransitsTimeRangeFactory.get_transit_moments-209"><span class="linenos">209</span></a><span class="sd">                    between transiting and natal positions</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-210"><a href="#TransitsTimeRangeFactory.get_transit_moments-210"><span class="linenos">210</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-211"><a href="#TransitsTimeRangeFactory.get_transit_moments-211"><span class="linenos">211</span></a><span class="sd">        Examples:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-212"><a href="#TransitsTimeRangeFactory.get_transit_moments-212"><span class="linenos">212</span></a><span class="sd">            Basic usage:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-213"><a href="#TransitsTimeRangeFactory.get_transit_moments-213"><span class="linenos">213</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-214"><a href="#TransitsTimeRangeFactory.get_transit_moments-214"><span class="linenos">214</span></a><span class="sd">            &gt;&gt;&gt; factory = TransitsTimeRangeFactory(natal_chart, ephemeris_data)</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-215"><a href="#TransitsTimeRangeFactory.get_transit_moments-215"><span class="linenos">215</span></a><span class="sd">            &gt;&gt;&gt; results = factory.get_transit_moments()</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-216"><a href="#TransitsTimeRangeFactory.get_transit_moments-216"><span class="linenos">216</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-217"><a href="#TransitsTimeRangeFactory.get_transit_moments-217"><span class="linenos">217</span></a><span class="sd">            &gt;&gt;&gt; # Access specific data</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-218"><a href="#TransitsTimeRangeFactory.get_transit_moments-218"><span class="linenos">218</span></a><span class="sd">            &gt;&gt;&gt; all_dates = results.dates</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-219"><a href="#TransitsTimeRangeFactory.get_transit_moments-219"><span class="linenos">219</span></a><span class="sd">            &gt;&gt;&gt; first_transit = results.transits[0]</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-220"><a href="#TransitsTimeRangeFactory.get_transit_moments-220"><span class="linenos">220</span></a><span class="sd">            &gt;&gt;&gt; aspects_at_first_moment = first_transit.aspects</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-221"><a href="#TransitsTimeRangeFactory.get_transit_moments-221"><span class="linenos">221</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-222"><a href="#TransitsTimeRangeFactory.get_transit_moments-222"><span class="linenos">222</span></a><span class="sd">            Processing results:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-223"><a href="#TransitsTimeRangeFactory.get_transit_moments-223"><span class="linenos">223</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-224"><a href="#TransitsTimeRangeFactory.get_transit_moments-224"><span class="linenos">224</span></a><span class="sd">            &gt;&gt;&gt; results = factory.get_transit_moments()</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-225"><a href="#TransitsTimeRangeFactory.get_transit_moments-225"><span class="linenos">225</span></a><span class="sd">            &gt;&gt;&gt; for transit_moment in results.transits:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-226"><a href="#TransitsTimeRangeFactory.get_transit_moments-226"><span class="linenos">226</span></a><span class="sd">            ...     print(f&quot;Date: {transit_moment.date}&quot;)</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-227"><a href="#TransitsTimeRangeFactory.get_transit_moments-227"><span class="linenos">227</span></a><span class="sd">            ...     for aspect in transit_moment.aspects:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-228"><a href="#TransitsTimeRangeFactory.get_transit_moments-228"><span class="linenos">228</span></a><span class="sd">            ...         print(f&quot;  {aspect.p1_name} {aspect.aspect} {aspect.p2_name}&quot;)</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-229"><a href="#TransitsTimeRangeFactory.get_transit_moments-229"><span class="linenos">229</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-230"><a href="#TransitsTimeRangeFactory.get_transit_moments-230"><span class="linenos">230</span></a><span class="sd">        Performance Notes:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-231"><a href="#TransitsTimeRangeFactory.get_transit_moments-231"><span class="linenos">231</span></a><span class="sd">            - Calculation time is proportional to: number of time points  active points  active aspects</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-232"><a href="#TransitsTimeRangeFactory.get_transit_moments-232"><span class="linenos">232</span></a><span class="sd">            - Large datasets may require significant processing time</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-233"><a href="#TransitsTimeRangeFactory.get_transit_moments-233"><span class="linenos">233</span></a><span class="sd">            - Memory usage scales with the number of aspects found</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-234"><a href="#TransitsTimeRangeFactory.get_transit_moments-234"><span class="linenos">234</span></a><span class="sd">            - Consider filtering active_points and active_aspects for better performance</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-235"><a href="#TransitsTimeRangeFactory.get_transit_moments-235"><span class="linenos">235</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-236"><a href="#TransitsTimeRangeFactory.get_transit_moments-236"><span class="linenos">236</span></a><span class="sd">        See Also:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-237"><a href="#TransitsTimeRangeFactory.get_transit_moments-237"><span class="linenos">237</span></a><span class="sd">            TransitMomentModel: Individual transit moment structure</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-238"><a href="#TransitsTimeRangeFactory.get_transit_moments-238"><span class="linenos">238</span></a><span class="sd">            TransitsTimeRangeModel: Complete transit dataset structure</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-239"><a href="#TransitsTimeRangeFactory.get_transit_moments-239"><span class="linenos">239</span></a><span class="sd">            AspectsFactory: Underlying aspect calculation engine</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-240"><a href="#TransitsTimeRangeFactory.get_transit_moments-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-241"><a href="#TransitsTimeRangeFactory.get_transit_moments-241"><span class="linenos">241</span></a>        <span class="n">transit_moments</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-242"><a href="#TransitsTimeRangeFactory.get_transit_moments-242"><span class="linenos">242</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-243"><a href="#TransitsTimeRangeFactory.get_transit_moments-243"><span class="linenos">243</span></a>        <span class="k">for</span> <span class="n">ephemeris_point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_data_points</span><span class="p">:</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-244"><a href="#TransitsTimeRangeFactory.get_transit_moments-244"><span class="linenos">244</span></a>            <span class="c1"># Calculate aspects between transit positions and natal chart</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-245"><a href="#TransitsTimeRangeFactory.get_transit_moments-245"><span class="linenos">245</span></a>            <span class="n">aspects</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-246"><a href="#TransitsTimeRangeFactory.get_transit_moments-246"><span class="linenos">246</span></a>                <span class="n">ephemeris_point</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-247"><a href="#TransitsTimeRangeFactory.get_transit_moments-247"><span class="linenos">247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">natal_chart</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-248"><a href="#TransitsTimeRangeFactory.get_transit_moments-248"><span class="linenos">248</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-249"><a href="#TransitsTimeRangeFactory.get_transit_moments-249"><span class="linenos">249</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-250"><a href="#TransitsTimeRangeFactory.get_transit_moments-250"><span class="linenos">250</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_orb_limit</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-251"><a href="#TransitsTimeRangeFactory.get_transit_moments-251"><span class="linenos">251</span></a>                <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># Transit is moving</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-252"><a href="#TransitsTimeRangeFactory.get_transit_moments-252"><span class="linenos">252</span></a>                <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Natal is fixed</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-253"><a href="#TransitsTimeRangeFactory.get_transit_moments-253"><span class="linenos">253</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">aspects</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-254"><a href="#TransitsTimeRangeFactory.get_transit_moments-254"><span class="linenos">254</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-255"><a href="#TransitsTimeRangeFactory.get_transit_moments-255"><span class="linenos">255</span></a>            <span class="c1"># Create a transit moment for this point in time</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-256"><a href="#TransitsTimeRangeFactory.get_transit_moments-256"><span class="linenos">256</span></a>            <span class="n">transit_moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-257"><a href="#TransitsTimeRangeFactory.get_transit_moments-257"><span class="linenos">257</span></a>                <span class="n">TransitMomentModel</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-258"><a href="#TransitsTimeRangeFactory.get_transit_moments-258"><span class="linenos">258</span></a>                    <span class="n">date</span><span class="o">=</span><span class="n">ephemeris_point</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-259"><a href="#TransitsTimeRangeFactory.get_transit_moments-259"><span class="linenos">259</span></a>                    <span class="n">aspects</span><span class="o">=</span><span class="n">aspects</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-260"><a href="#TransitsTimeRangeFactory.get_transit_moments-260"><span class="linenos">260</span></a>                <span class="p">)</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-261"><a href="#TransitsTimeRangeFactory.get_transit_moments-261"><span class="linenos">261</span></a>            <span class="p">)</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-262"><a href="#TransitsTimeRangeFactory.get_transit_moments-262"><span class="linenos">262</span></a>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-263"><a href="#TransitsTimeRangeFactory.get_transit_moments-263"><span class="linenos">263</span></a>        <span class="c1"># Create and return the complete transits model</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-264"><a href="#TransitsTimeRangeFactory.get_transit_moments-264"><span class="linenos">264</span></a>        <span class="k">return</span> <span class="n">TransitsTimeRangeModel</span><span class="p">(</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-265"><a href="#TransitsTimeRangeFactory.get_transit_moments-265"><span class="linenos">265</span></a>            <span class="n">dates</span><span class="o">=</span><span class="p">[</span><span class="n">point</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ephemeris_data_points</span><span class="p">],</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-266"><a href="#TransitsTimeRangeFactory.get_transit_moments-266"><span class="linenos">266</span></a>            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">natal_chart</span><span class="p">,</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-267"><a href="#TransitsTimeRangeFactory.get_transit_moments-267"><span class="linenos">267</span></a>            <span class="n">transits</span><span class="o">=</span><span class="n">transit_moments</span>
</span><span id="TransitsTimeRangeFactory.get_transit_moments-268"><a href="#TransitsTimeRangeFactory.get_transit_moments-268"><span class="linenos">268</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate and generate transit data for all configured time points.</p>

<p>This method processes each ephemeris data point to identify angular relationships
(aspects) between transiting celestial bodies and natal chart positions. It
creates a comprehensive model containing all transit moments with their
corresponding aspects and timestamps.</p>

<p>The calculation process:</p>

<ol>
<li>Iterates through each ephemeris data point chronologically</li>
<li>Compares transiting planetary positions with natal chart positions</li>
<li>Identifies aspects that fall within the configured orb tolerances</li>
<li>Creates timestamped transit moment records</li>
<li>Compiles all data into a structured model for analysis</li>
</ol>

<p>Returns:
    TransitsTimeRangeModel: A comprehensive model containing:
        - dates (List[str]): ISO-formatted datetime strings for all data points
        - subject (AstrologicalSubjectModel): The natal chart used as reference
        - transits (List[TransitMomentModel]): Chronological list of transit moments,
          each containing:
          * date (str): ISO-formatted timestamp for the transit moment
          * aspects (List[RelevantAspect]): All aspects formed at this moment
            between transiting and natal positions</p>

<p>Examples:
    Basic usage:</p>

<pre><code>&gt;&gt;&gt; factory = TransitsTimeRangeFactory(natal_chart, ephemeris_data)
&gt;&gt;&gt; results = factory.get_transit_moments()
&gt;&gt;&gt;
&gt;&gt;&gt; # Access specific data
&gt;&gt;&gt; all_dates = results.dates
&gt;&gt;&gt; first_transit = results.transits[0]
&gt;&gt;&gt; aspects_at_first_moment = first_transit.aspects

Processing results:

&gt;&gt;&gt; results = factory.get_transit_moments()
&gt;&gt;&gt; for transit_moment in results.transits:
...     print(f"Date: {transit_moment.date}")
...     for aspect in transit_moment.aspects:
...         print(f"  {aspect.p1_name} {aspect.aspect} {aspect.p2_name}")
</code></pre>

<p>Performance Notes:
    - Calculation time is proportional to: number of time points  active points  active aspects
    - Large datasets may require significant processing time
    - Memory usage scales with the number of aspects found
    - Consider filtering active_points and active_aspects for better performance</p>

<p>See Also:
    TransitMomentModel: Individual transit moment structure
    TransitsTimeRangeModel: Complete transit dataset structure
    AspectsFactory: Underlying aspect calculation engine</p>
</div>


                            </div>
                </section>
                <section id="to_context">
                            <input id="to_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_context</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">KerykeionPointModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">LunarPhaseModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n"><a href="#PlanetReturnModel">PlanetReturnModel</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AspectModel</span><span class="p">,</span> <span class="n"><a href="#SingleChartDataModel">SingleChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#DualChartDataModel">DualChartDataModel</a></span><span class="p">,</span> <span class="n"><a href="#ElementDistributionModel">ElementDistributionModel</a></span><span class="p">,</span> <span class="n"><a href="#QualityDistributionModel">QualityDistributionModel</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">TransitMomentModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">TransitsTimeRangeModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">PointInHouseModel</span><span class="p">,</span> <span class="n"><a href="#HouseComparisonModel">HouseComparisonModel</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="to_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#to_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="to_context-592"><a href="#to_context-592"><span class="linenos">592</span></a><span class="k">def</span><span class="w"> </span><span class="nf">to_context</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="to_context-593"><a href="#to_context-593"><span class="linenos">593</span></a>    <span class="n">KerykeionPointModel</span><span class="p">,</span>
</span><span id="to_context-594"><a href="#to_context-594"><span class="linenos">594</span></a>    <span class="n">LunarPhaseModel</span><span class="p">,</span>
</span><span id="to_context-595"><a href="#to_context-595"><span class="linenos">595</span></a>    <span class="n">AstrologicalSubjectModel</span><span class="p">,</span>
</span><span id="to_context-596"><a href="#to_context-596"><span class="linenos">596</span></a>    <span class="n">CompositeSubjectModel</span><span class="p">,</span>
</span><span id="to_context-597"><a href="#to_context-597"><span class="linenos">597</span></a>    <span class="n">PlanetReturnModel</span><span class="p">,</span>
</span><span id="to_context-598"><a href="#to_context-598"><span class="linenos">598</span></a>    <span class="n">AspectModel</span><span class="p">,</span>
</span><span id="to_context-599"><a href="#to_context-599"><span class="linenos">599</span></a>    <span class="n">SingleChartDataModel</span><span class="p">,</span>
</span><span id="to_context-600"><a href="#to_context-600"><span class="linenos">600</span></a>    <span class="n">DualChartDataModel</span><span class="p">,</span>
</span><span id="to_context-601"><a href="#to_context-601"><span class="linenos">601</span></a>    <span class="n">ElementDistributionModel</span><span class="p">,</span>
</span><span id="to_context-602"><a href="#to_context-602"><span class="linenos">602</span></a>    <span class="n">QualityDistributionModel</span><span class="p">,</span>
</span><span id="to_context-603"><a href="#to_context-603"><span class="linenos">603</span></a>    <span class="n">TransitMomentModel</span><span class="p">,</span>
</span><span id="to_context-604"><a href="#to_context-604"><span class="linenos">604</span></a>    <span class="n">TransitsTimeRangeModel</span><span class="p">,</span>
</span><span id="to_context-605"><a href="#to_context-605"><span class="linenos">605</span></a>    <span class="n">PointInHouseModel</span><span class="p">,</span>
</span><span id="to_context-606"><a href="#to_context-606"><span class="linenos">606</span></a>    <span class="n">HouseComparisonModel</span><span class="p">,</span>
</span><span id="to_context-607"><a href="#to_context-607"><span class="linenos">607</span></a><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="to_context-608"><a href="#to_context-608"><span class="linenos">608</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="to_context-609"><a href="#to_context-609"><span class="linenos">609</span></a><span class="sd">    Main dispatcher function to convert any Kerykeion model to textual context.</span>
</span><span id="to_context-610"><a href="#to_context-610"><span class="linenos">610</span></a>
</span><span id="to_context-611"><a href="#to_context-611"><span class="linenos">611</span></a><span class="sd">    This function automatically detects the model type and routes to the</span>
</span><span id="to_context-612"><a href="#to_context-612"><span class="linenos">612</span></a><span class="sd">    appropriate transformer function.</span>
</span><span id="to_context-613"><a href="#to_context-613"><span class="linenos">613</span></a>
</span><span id="to_context-614"><a href="#to_context-614"><span class="linenos">614</span></a><span class="sd">    Args:</span>
</span><span id="to_context-615"><a href="#to_context-615"><span class="linenos">615</span></a><span class="sd">        model: Any supported Kerykeion Pydantic model.</span>
</span><span id="to_context-616"><a href="#to_context-616"><span class="linenos">616</span></a>
</span><span id="to_context-617"><a href="#to_context-617"><span class="linenos">617</span></a><span class="sd">    Returns:</span>
</span><span id="to_context-618"><a href="#to_context-618"><span class="linenos">618</span></a><span class="sd">        A string containing the textual representation of the model.</span>
</span><span id="to_context-619"><a href="#to_context-619"><span class="linenos">619</span></a>
</span><span id="to_context-620"><a href="#to_context-620"><span class="linenos">620</span></a><span class="sd">    Raises:</span>
</span><span id="to_context-621"><a href="#to_context-621"><span class="linenos">621</span></a><span class="sd">        TypeError: If the model type is not supported.</span>
</span><span id="to_context-622"><a href="#to_context-622"><span class="linenos">622</span></a>
</span><span id="to_context-623"><a href="#to_context-623"><span class="linenos">623</span></a><span class="sd">    Example:</span>
</span><span id="to_context-624"><a href="#to_context-624"><span class="linenos">624</span></a><span class="sd">        &gt;&gt;&gt; from kerykeion import AstrologicalSubjectFactory, to_context</span>
</span><span id="to_context-625"><a href="#to_context-625"><span class="linenos">625</span></a><span class="sd">        &gt;&gt;&gt; subject = AstrologicalSubjectFactory.from_birth_data(...)</span>
</span><span id="to_context-626"><a href="#to_context-626"><span class="linenos">626</span></a><span class="sd">        &gt;&gt;&gt; context = to_context(subject)</span>
</span><span id="to_context-627"><a href="#to_context-627"><span class="linenos">627</span></a><span class="sd">        &gt;&gt;&gt; print(context)</span>
</span><span id="to_context-628"><a href="#to_context-628"><span class="linenos">628</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="to_context-629"><a href="#to_context-629"><span class="linenos">629</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">SingleChartDataModel</span><span class="p">):</span>
</span><span id="to_context-630"><a href="#to_context-630"><span class="linenos">630</span></a>        <span class="k">return</span> <span class="n">single_chart_data_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-631"><a href="#to_context-631"><span class="linenos">631</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">):</span>
</span><span id="to_context-632"><a href="#to_context-632"><span class="linenos">632</span></a>        <span class="k">return</span> <span class="n">dual_chart_data_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-633"><a href="#to_context-633"><span class="linenos">633</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">TransitsTimeRangeModel</span><span class="p">):</span>
</span><span id="to_context-634"><a href="#to_context-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="n">transits_time_range_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-635"><a href="#to_context-635"><span class="linenos">635</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">TransitMomentModel</span><span class="p">):</span>
</span><span id="to_context-636"><a href="#to_context-636"><span class="linenos">636</span></a>        <span class="k">return</span> <span class="n">transit_moment_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-637"><a href="#to_context-637"><span class="linenos">637</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">,</span> <span class="n">PlanetReturnModel</span><span class="p">)):</span>
</span><span id="to_context-638"><a href="#to_context-638"><span class="linenos">638</span></a>        <span class="k">return</span> <span class="n">astrological_subject_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-639"><a href="#to_context-639"><span class="linenos">639</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">KerykeionPointModel</span><span class="p">):</span>
</span><span id="to_context-640"><a href="#to_context-640"><span class="linenos">640</span></a>        <span class="k">return</span> <span class="n">kerykeion_point_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-641"><a href="#to_context-641"><span class="linenos">641</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">LunarPhaseModel</span><span class="p">):</span>
</span><span id="to_context-642"><a href="#to_context-642"><span class="linenos">642</span></a>        <span class="k">return</span> <span class="n">lunar_phase_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-643"><a href="#to_context-643"><span class="linenos">643</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">AspectModel</span><span class="p">):</span>
</span><span id="to_context-644"><a href="#to_context-644"><span class="linenos">644</span></a>        <span class="k">return</span> <span class="n">aspect_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-645"><a href="#to_context-645"><span class="linenos">645</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ElementDistributionModel</span><span class="p">):</span>
</span><span id="to_context-646"><a href="#to_context-646"><span class="linenos">646</span></a>        <span class="k">return</span> <span class="n">element_distribution_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-647"><a href="#to_context-647"><span class="linenos">647</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">QualityDistributionModel</span><span class="p">):</span>
</span><span id="to_context-648"><a href="#to_context-648"><span class="linenos">648</span></a>        <span class="k">return</span> <span class="n">quality_distribution_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-649"><a href="#to_context-649"><span class="linenos">649</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">PointInHouseModel</span><span class="p">):</span>
</span><span id="to_context-650"><a href="#to_context-650"><span class="linenos">650</span></a>        <span class="k">return</span> <span class="n">point_in_house_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-651"><a href="#to_context-651"><span class="linenos">651</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">HouseComparisonModel</span><span class="p">):</span>
</span><span id="to_context-652"><a href="#to_context-652"><span class="linenos">652</span></a>        <span class="k">return</span> <span class="n">house_comparison_to_context</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="to_context-653"><a href="#to_context-653"><span class="linenos">653</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="to_context-654"><a href="#to_context-654"><span class="linenos">654</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="to_context-655"><a href="#to_context-655"><span class="linenos">655</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported model type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="to_context-656"><a href="#to_context-656"><span class="linenos">656</span></a>            <span class="sa">f</span><span class="s2">&quot;Supported types are: KerykeionPointModel, LunarPhaseModel, &quot;</span>
</span><span id="to_context-657"><a href="#to_context-657"><span class="linenos">657</span></a>            <span class="sa">f</span><span class="s2">&quot;AstrologicalSubjectModel, CompositeSubjectModel, PlanetReturnModel, &quot;</span>
</span><span id="to_context-658"><a href="#to_context-658"><span class="linenos">658</span></a>            <span class="sa">f</span><span class="s2">&quot;AspectModel, SingleChartDataModel, DualChartDataModel, &quot;</span>
</span><span id="to_context-659"><a href="#to_context-659"><span class="linenos">659</span></a>            <span class="sa">f</span><span class="s2">&quot;ElementDistributionModel, QualityDistributionModel, &quot;</span>
</span><span id="to_context-660"><a href="#to_context-660"><span class="linenos">660</span></a>            <span class="sa">f</span><span class="s2">&quot;TransitMomentModel, TransitsTimeRangeModel, &quot;</span>
</span><span id="to_context-661"><a href="#to_context-661"><span class="linenos">661</span></a>            <span class="sa">f</span><span class="s2">&quot;PointInHouseModel, HouseComparisonModel&quot;</span>
</span><span id="to_context-662"><a href="#to_context-662"><span class="linenos">662</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Main dispatcher function to convert any Kerykeion model to textual context.</p>

<p>This function automatically detects the model type and routes to the
appropriate transformer function.</p>

<p>Args:
    model: Any supported Kerykeion Pydantic model.</p>

<p>Returns:
    A string containing the textual representation of the model.</p>

<p>Raises:
    TypeError: If the model type is not supported.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>from kerykeion import AstrologicalSubjectFactory, to_context
      subject = <a href="#AstrologicalSubjectFactory.from_birth_data">AstrologicalSubjectFactory.from_birth_data</a>(...)
      context = to_context(subject)
      print(context)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                </section>
                <section id="AstrologicalSubject">
                            <input id="AstrologicalSubject-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AstrologicalSubject</span>:

                <label class="view-source-button" for="AstrologicalSubject-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject-152"><a href="#AstrologicalSubject-152"><span class="linenos">152</span></a><span class="k">class</span><span class="w"> </span><span class="nc">AstrologicalSubject</span><span class="p">:</span>
</span><span id="AstrologicalSubject-153"><a href="#AstrologicalSubject-153"><span class="linenos">153</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Backward compatible wrapper implementing the requested __init__ signature.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-154"><a href="#AstrologicalSubject-154"><span class="linenos">154</span></a>
</span><span id="AstrologicalSubject-155"><a href="#AstrologicalSubject-155"><span class="linenos">155</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">_dt</span>
</span><span id="AstrologicalSubject-156"><a href="#AstrologicalSubject-156"><span class="linenos">156</span></a>    <span class="n">NOW</span> <span class="o">=</span> <span class="n">_dt</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
</span><span id="AstrologicalSubject-157"><a href="#AstrologicalSubject-157"><span class="linenos">157</span></a>
</span><span id="AstrologicalSubject-158"><a href="#AstrologicalSubject-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AstrologicalSubject-159"><a href="#AstrologicalSubject-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AstrologicalSubject-160"><a href="#AstrologicalSubject-160"><span class="linenos">160</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-161"><a href="#AstrologicalSubject-161"><span class="linenos">161</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject-162"><a href="#AstrologicalSubject-162"><span class="linenos">162</span></a>        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject-163"><a href="#AstrologicalSubject-163"><span class="linenos">163</span></a>        <span class="n">day</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject-164"><a href="#AstrologicalSubject-164"><span class="linenos">164</span></a>        <span class="n">hour</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject-165"><a href="#AstrologicalSubject-165"><span class="linenos">165</span></a>        <span class="n">minute</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject-166"><a href="#AstrologicalSubject-166"><span class="linenos">166</span></a>        <span class="n">city</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-167"><a href="#AstrologicalSubject-167"><span class="linenos">167</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-168"><a href="#AstrologicalSubject-168"><span class="linenos">168</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-169"><a href="#AstrologicalSubject-169"><span class="linenos">169</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-170"><a href="#AstrologicalSubject-170"><span class="linenos">170</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-171"><a href="#AstrologicalSubject-171"><span class="linenos">171</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-172"><a href="#AstrologicalSubject-172"><span class="linenos">172</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ZodiacType</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># default resolved below</span>
</span><span id="AstrologicalSubject-173"><a href="#AstrologicalSubject-173"><span class="linenos">173</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubject-174"><a href="#AstrologicalSubject-174"><span class="linenos">174</span></a>        <span class="n">disable_chiron</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># deprecated</span>
</span><span id="AstrologicalSubject-175"><a href="#AstrologicalSubject-175"><span class="linenos">175</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-176"><a href="#AstrologicalSubject-176"><span class="linenos">176</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">HousesSystemIdentifier</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-177"><a href="#AstrologicalSubject-177"><span class="linenos">177</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PerspectiveType</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-178"><a href="#AstrologicalSubject-178"><span class="linenos">178</span></a>        <span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-179"><a href="#AstrologicalSubject-179"><span class="linenos">179</span></a>        <span class="n">is_dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-180"><a href="#AstrologicalSubject-180"><span class="linenos">180</span></a>        <span class="n">disable_chiron_and_lilith</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># currently not forwarded (not in factory)</span>
</span><span id="AstrologicalSubject-181"><a href="#AstrologicalSubject-181"><span class="linenos">181</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubject-182"><a href="#AstrologicalSubject-182"><span class="linenos">182</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.astrological_subject_factory</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="AstrologicalSubject-183"><a href="#AstrologicalSubject-183"><span class="linenos">183</span></a>            <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject-184"><a href="#AstrologicalSubject-184"><span class="linenos">184</span></a>            <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubject-185"><a href="#AstrologicalSubject-185"><span class="linenos">185</span></a>            <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject-186"><a href="#AstrologicalSubject-186"><span class="linenos">186</span></a>            <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span><span class="p">,</span>
</span><span id="AstrologicalSubject-187"><a href="#AstrologicalSubject-187"><span class="linenos">187</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-188"><a href="#AstrologicalSubject-188"><span class="linenos">188</span></a>
</span><span id="AstrologicalSubject-189"><a href="#AstrologicalSubject-189"><span class="linenos">189</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;AstrologicalSubject&quot;</span><span class="p">,</span> <span class="s2">&quot;AstrologicalSubjectFactory.from_birth_data&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubject-190"><a href="#AstrologicalSubject-190"><span class="linenos">190</span></a>
</span><span id="AstrologicalSubject-191"><a href="#AstrologicalSubject-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">disable_chiron</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubject-192"><a href="#AstrologicalSubject-192"><span class="linenos">192</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&#39;disable_chiron&#39;  deprecato e ignorato.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AstrologicalSubject-193"><a href="#AstrologicalSubject-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">disable_chiron_and_lilith</span><span class="p">:</span>
</span><span id="AstrologicalSubject-194"><a href="#AstrologicalSubject-194"><span class="linenos">194</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject-195"><a href="#AstrologicalSubject-195"><span class="linenos">195</span></a>                <span class="s2">&quot;&#39;disable_chiron_and_lilith&#39; non  supportato da from_birth_data in questa versione ed  ignorato.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-196"><a href="#AstrologicalSubject-196"><span class="linenos">196</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject-197"><a href="#AstrologicalSubject-197"><span class="linenos">197</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject-198"><a href="#AstrologicalSubject-198"><span class="linenos">198</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubject-199"><a href="#AstrologicalSubject-199"><span class="linenos">199</span></a>
</span><span id="AstrologicalSubject-200"><a href="#AstrologicalSubject-200"><span class="linenos">200</span></a>        <span class="c1"># Normalize legacy zodiac type values</span>
</span><span id="AstrologicalSubject-201"><a href="#AstrologicalSubject-201"><span class="linenos">201</span></a>        <span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">_normalize_zodiac_type_with_warning</span><span class="p">(</span><span class="n">zodiac_type</span><span class="p">)</span>
</span><span id="AstrologicalSubject-202"><a href="#AstrologicalSubject-202"><span class="linenos">202</span></a>        <span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span> <span class="k">if</span> <span class="n">zodiac_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">zodiac_type</span>
</span><span id="AstrologicalSubject-203"><a href="#AstrologicalSubject-203"><span class="linenos">203</span></a>
</span><span id="AstrologicalSubject-204"><a href="#AstrologicalSubject-204"><span class="linenos">204</span></a>        <span class="n">houses_system_identifier</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AstrologicalSubject-205"><a href="#AstrologicalSubject-205"><span class="linenos">205</span></a>            <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span> <span class="k">if</span> <span class="n">houses_system_identifier</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">houses_system_identifier</span>
</span><span id="AstrologicalSubject-206"><a href="#AstrologicalSubject-206"><span class="linenos">206</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-207"><a href="#AstrologicalSubject-207"><span class="linenos">207</span></a>        <span class="n">perspective_type</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span> <span class="k">if</span> <span class="n">perspective_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">perspective_type</span>
</span><span id="AstrologicalSubject-208"><a href="#AstrologicalSubject-208"><span class="linenos">208</span></a>        <span class="n">cache_expire_after_days</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AstrologicalSubject-209"><a href="#AstrologicalSubject-209"><span class="linenos">209</span></a>            <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span> <span class="k">if</span> <span class="n">cache_expire_after_days</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cache_expire_after_days</span>
</span><span id="AstrologicalSubject-210"><a href="#AstrologicalSubject-210"><span class="linenos">210</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-211"><a href="#AstrologicalSubject-211"><span class="linenos">211</span></a>
</span><span id="AstrologicalSubject-212"><a href="#AstrologicalSubject-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubject-213"><a href="#AstrologicalSubject-213"><span class="linenos">213</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubject-214"><a href="#AstrologicalSubject-214"><span class="linenos">214</span></a>            <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
</span><span id="AstrologicalSubject-215"><a href="#AstrologicalSubject-215"><span class="linenos">215</span></a>            <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span>
</span><span id="AstrologicalSubject-216"><a href="#AstrologicalSubject-216"><span class="linenos">216</span></a>            <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span>
</span><span id="AstrologicalSubject-217"><a href="#AstrologicalSubject-217"><span class="linenos">217</span></a>            <span class="n">hour</span><span class="o">=</span><span class="n">hour</span><span class="p">,</span>
</span><span id="AstrologicalSubject-218"><a href="#AstrologicalSubject-218"><span class="linenos">218</span></a>            <span class="n">minute</span><span class="o">=</span><span class="n">minute</span><span class="p">,</span>
</span><span id="AstrologicalSubject-219"><a href="#AstrologicalSubject-219"><span class="linenos">219</span></a>            <span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="AstrologicalSubject-220"><a href="#AstrologicalSubject-220"><span class="linenos">220</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubject-221"><a href="#AstrologicalSubject-221"><span class="linenos">221</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubject-222"><a href="#AstrologicalSubject-222"><span class="linenos">222</span></a>            <span class="n">lng</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lng</span><span class="p">)</span> <span class="k">if</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-223"><a href="#AstrologicalSubject-223"><span class="linenos">223</span></a>            <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-224"><a href="#AstrologicalSubject-224"><span class="linenos">224</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubject-225"><a href="#AstrologicalSubject-225"><span class="linenos">225</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubject-226"><a href="#AstrologicalSubject-226"><span class="linenos">226</span></a>            <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
</span><span id="AstrologicalSubject-227"><a href="#AstrologicalSubject-227"><span class="linenos">227</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-228"><a href="#AstrologicalSubject-228"><span class="linenos">228</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-229"><a href="#AstrologicalSubject-229"><span class="linenos">229</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-230"><a href="#AstrologicalSubject-230"><span class="linenos">230</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-231"><a href="#AstrologicalSubject-231"><span class="linenos">231</span></a>            <span class="n">cache_expire_after_days</span><span class="o">=</span><span class="n">cache_expire_after_days</span><span class="p">,</span>
</span><span id="AstrologicalSubject-232"><a href="#AstrologicalSubject-232"><span class="linenos">232</span></a>            <span class="n">is_dst</span><span class="o">=</span><span class="n">is_dst</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-233"><a href="#AstrologicalSubject-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-234"><a href="#AstrologicalSubject-234"><span class="linenos">234</span></a>
</span><span id="AstrologicalSubject-235"><a href="#AstrologicalSubject-235"><span class="linenos">235</span></a>        <span class="c1"># Legacy filesystem attributes</span>
</span><span id="AstrologicalSubject-236"><a href="#AstrologicalSubject-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">json_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="AstrologicalSubject-237"><a href="#AstrologicalSubject-237"><span class="linenos">237</span></a>
</span><span id="AstrologicalSubject-238"><a href="#AstrologicalSubject-238"><span class="linenos">238</span></a>    <span class="c1"># Backward compatibility properties for v4 lunar node names</span>
</span><span id="AstrologicalSubject-239"><a href="#AstrologicalSubject-239"><span class="linenos">239</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject-240"><a href="#AstrologicalSubject-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mean_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject-241"><a href="#AstrologicalSubject-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use mean_north_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-242"><a href="#AstrologicalSubject-242"><span class="linenos">242</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject-243"><a href="#AstrologicalSubject-243"><span class="linenos">243</span></a>            <span class="s2">&quot;&#39;mean_node&#39; is deprecated in Kerykeion v5. Use &#39;mean_north_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-244"><a href="#AstrologicalSubject-244"><span class="linenos">244</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject-245"><a href="#AstrologicalSubject-245"><span class="linenos">245</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject-246"><a href="#AstrologicalSubject-246"><span class="linenos">246</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-247"><a href="#AstrologicalSubject-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">mean_north_lunar_node</span>
</span><span id="AstrologicalSubject-248"><a href="#AstrologicalSubject-248"><span class="linenos">248</span></a>
</span><span id="AstrologicalSubject-249"><a href="#AstrologicalSubject-249"><span class="linenos">249</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject-250"><a href="#AstrologicalSubject-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">true_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject-251"><a href="#AstrologicalSubject-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use true_north_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-252"><a href="#AstrologicalSubject-252"><span class="linenos">252</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject-253"><a href="#AstrologicalSubject-253"><span class="linenos">253</span></a>            <span class="s2">&quot;&#39;true_node&#39; is deprecated in Kerykeion v5. Use &#39;true_north_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-254"><a href="#AstrologicalSubject-254"><span class="linenos">254</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject-255"><a href="#AstrologicalSubject-255"><span class="linenos">255</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject-256"><a href="#AstrologicalSubject-256"><span class="linenos">256</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-257"><a href="#AstrologicalSubject-257"><span class="linenos">257</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">true_north_lunar_node</span>
</span><span id="AstrologicalSubject-258"><a href="#AstrologicalSubject-258"><span class="linenos">258</span></a>
</span><span id="AstrologicalSubject-259"><a href="#AstrologicalSubject-259"><span class="linenos">259</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject-260"><a href="#AstrologicalSubject-260"><span class="linenos">260</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mean_south_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject-261"><a href="#AstrologicalSubject-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use mean_south_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-262"><a href="#AstrologicalSubject-262"><span class="linenos">262</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject-263"><a href="#AstrologicalSubject-263"><span class="linenos">263</span></a>            <span class="s2">&quot;&#39;mean_south_node&#39; is deprecated in Kerykeion v5. Use &#39;mean_south_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-264"><a href="#AstrologicalSubject-264"><span class="linenos">264</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject-265"><a href="#AstrologicalSubject-265"><span class="linenos">265</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject-266"><a href="#AstrologicalSubject-266"><span class="linenos">266</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-267"><a href="#AstrologicalSubject-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">mean_south_lunar_node</span>
</span><span id="AstrologicalSubject-268"><a href="#AstrologicalSubject-268"><span class="linenos">268</span></a>
</span><span id="AstrologicalSubject-269"><a href="#AstrologicalSubject-269"><span class="linenos">269</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject-270"><a href="#AstrologicalSubject-270"><span class="linenos">270</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">true_south_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject-271"><a href="#AstrologicalSubject-271"><span class="linenos">271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use true_south_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-272"><a href="#AstrologicalSubject-272"><span class="linenos">272</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject-273"><a href="#AstrologicalSubject-273"><span class="linenos">273</span></a>            <span class="s2">&quot;&#39;true_south_node&#39; is deprecated in Kerykeion v5. Use &#39;true_south_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-274"><a href="#AstrologicalSubject-274"><span class="linenos">274</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject-275"><a href="#AstrologicalSubject-275"><span class="linenos">275</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject-276"><a href="#AstrologicalSubject-276"><span class="linenos">276</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-277"><a href="#AstrologicalSubject-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">true_south_lunar_node</span>
</span><span id="AstrologicalSubject-278"><a href="#AstrologicalSubject-278"><span class="linenos">278</span></a>
</span><span id="AstrologicalSubject-279"><a href="#AstrologicalSubject-279"><span class="linenos">279</span></a>    <span class="c1"># Provide attribute passthrough for planetary points / houses used in README</span>
</span><span id="AstrologicalSubject-280"><a href="#AstrologicalSubject-280"><span class="linenos">280</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>  <span class="c1"># pragma: no cover - dynamic proxy</span>
</span><span id="AstrologicalSubject-281"><a href="#AstrologicalSubject-281"><span class="linenos">281</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AstrologicalSubject-282"><a href="#AstrologicalSubject-282"><span class="linenos">282</span></a>            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="AstrologicalSubject-283"><a href="#AstrologicalSubject-283"><span class="linenos">283</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="AstrologicalSubject-284"><a href="#AstrologicalSubject-284"><span class="linenos">284</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AstrologicalSubject has no attribute &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
</span><span id="AstrologicalSubject-285"><a href="#AstrologicalSubject-285"><span class="linenos">285</span></a>
</span><span id="AstrologicalSubject-286"><a href="#AstrologicalSubject-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AstrologicalSubject-287"><a href="#AstrologicalSubject-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
</span><span id="AstrologicalSubject-288"><a href="#AstrologicalSubject-288"><span class="linenos">288</span></a>
</span><span id="AstrologicalSubject-289"><a href="#AstrologicalSubject-289"><span class="linenos">289</span></a>    <span class="c1"># Provide json() similar convenience</span>
</span><span id="AstrologicalSubject-290"><a href="#AstrologicalSubject-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json</span><span class="p">(</span>
</span><span id="AstrologicalSubject-291"><a href="#AstrologicalSubject-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AstrologicalSubject-292"><a href="#AstrologicalSubject-292"><span class="linenos">292</span></a>        <span class="n">dump</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubject-293"><a href="#AstrologicalSubject-293"><span class="linenos">293</span></a>        <span class="n">destination_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-294"><a href="#AstrologicalSubject-294"><span class="linenos">294</span></a>        <span class="n">indent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-295"><a href="#AstrologicalSubject-295"><span class="linenos">295</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AstrologicalSubject-296"><a href="#AstrologicalSubject-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Replicate legacy json() behaviour returning a JSON string and optionally dumping to disk.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-297"><a href="#AstrologicalSubject-297"><span class="linenos">297</span></a>
</span><span id="AstrologicalSubject-298"><a href="#AstrologicalSubject-298"><span class="linenos">298</span></a>        <span class="n">json_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
</span><span id="AstrologicalSubject-299"><a href="#AstrologicalSubject-299"><span class="linenos">299</span></a>
</span><span id="AstrologicalSubject-300"><a href="#AstrologicalSubject-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dump</span><span class="p">:</span>
</span><span id="AstrologicalSubject-301"><a href="#AstrologicalSubject-301"><span class="linenos">301</span></a>            <span class="k">return</span> <span class="n">json_string</span>
</span><span id="AstrologicalSubject-302"><a href="#AstrologicalSubject-302"><span class="linenos">302</span></a>
</span><span id="AstrologicalSubject-303"><a href="#AstrologicalSubject-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="n">destination_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubject-304"><a href="#AstrologicalSubject-304"><span class="linenos">304</span></a>            <span class="n">target_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">)</span>
</span><span id="AstrologicalSubject-305"><a href="#AstrologicalSubject-305"><span class="linenos">305</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubject-306"><a href="#AstrologicalSubject-306"><span class="linenos">306</span></a>            <span class="n">target_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_dir</span>
</span><span id="AstrologicalSubject-307"><a href="#AstrologicalSubject-307"><span class="linenos">307</span></a>
</span><span id="AstrologicalSubject-308"><a href="#AstrologicalSubject-308"><span class="linenos">308</span></a>        <span class="n">target_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AstrologicalSubject-309"><a href="#AstrologicalSubject-309"><span class="linenos">309</span></a>        <span class="n">json_path</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_kerykeion.json&quot;</span>
</span><span id="AstrologicalSubject-310"><a href="#AstrologicalSubject-310"><span class="linenos">310</span></a>
</span><span id="AstrologicalSubject-311"><a href="#AstrologicalSubject-311"><span class="linenos">311</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="AstrologicalSubject-312"><a href="#AstrologicalSubject-312"><span class="linenos">312</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
</span><span id="AstrologicalSubject-313"><a href="#AstrologicalSubject-313"><span class="linenos">313</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JSON file dumped in </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>
</span><span id="AstrologicalSubject-314"><a href="#AstrologicalSubject-314"><span class="linenos">314</span></a>
</span><span id="AstrologicalSubject-315"><a href="#AstrologicalSubject-315"><span class="linenos">315</span></a>        <span class="k">return</span> <span class="n">json_string</span>
</span><span id="AstrologicalSubject-316"><a href="#AstrologicalSubject-316"><span class="linenos">316</span></a>
</span><span id="AstrologicalSubject-317"><a href="#AstrologicalSubject-317"><span class="linenos">317</span></a>    <span class="c1"># Legacy helpers -----------------------------------------------------</span>
</span><span id="AstrologicalSubject-318"><a href="#AstrologicalSubject-318"><span class="linenos">318</span></a>    <span class="nd">@staticmethod</span>
</span><span id="AstrologicalSubject-319"><a href="#AstrologicalSubject-319"><span class="linenos">319</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_iso_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
</span><span id="AstrologicalSubject-320"><a href="#AstrologicalSubject-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">):</span>
</span><span id="AstrologicalSubject-321"><a href="#AstrologicalSubject-321"><span class="linenos">321</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;+00:00&quot;</span>
</span><span id="AstrologicalSubject-322"><a href="#AstrologicalSubject-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="AstrologicalSubject-323"><a href="#AstrologicalSubject-323"><span class="linenos">323</span></a>
</span><span id="AstrologicalSubject-324"><a href="#AstrologicalSubject-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubject-325"><a href="#AstrologicalSubject-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the underlying Pydantic model (legacy compatibility).&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-326"><a href="#AstrologicalSubject-326"><span class="linenos">326</span></a>
</span><span id="AstrologicalSubject-327"><a href="#AstrologicalSubject-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span><span id="AstrologicalSubject-328"><a href="#AstrologicalSubject-328"><span class="linenos">328</span></a>
</span><span id="AstrologicalSubject-329"><a href="#AstrologicalSubject-329"><span class="linenos">329</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AstrologicalSubject-330"><a href="#AstrologicalSubject-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span id="AstrologicalSubject-331"><a href="#AstrologicalSubject-331"><span class="linenos">331</span></a>
</span><span id="AstrologicalSubject-332"><a href="#AstrologicalSubject-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AstrologicalSubject-333"><a href="#AstrologicalSubject-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</span><span id="AstrologicalSubject-334"><a href="#AstrologicalSubject-334"><span class="linenos">334</span></a>
</span><span id="AstrologicalSubject-335"><a href="#AstrologicalSubject-335"><span class="linenos">335</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AstrologicalSubject-336"><a href="#AstrologicalSubject-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="AstrologicalSubject-337"><a href="#AstrologicalSubject-337"><span class="linenos">337</span></a>            <span class="sa">f</span><span class="s2">&quot;Astrological data for: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span><span class="si">}</span><span class="s2"> UTC</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="AstrologicalSubject-338"><a href="#AstrologicalSubject-338"><span class="linenos">338</span></a>            <span class="sa">f</span><span class="s2">&quot;Birth location: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">city</span><span class="si">}</span><span class="s2">, Lat </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">lat</span><span class="si">}</span><span class="s2">, Lon </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">lng</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="AstrologicalSubject-339"><a href="#AstrologicalSubject-339"><span class="linenos">339</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-340"><a href="#AstrologicalSubject-340"><span class="linenos">340</span></a>
</span><span id="AstrologicalSubject-341"><a href="#AstrologicalSubject-341"><span class="linenos">341</span></a>    <span class="nd">@cached_property</span>
</span><span id="AstrologicalSubject-342"><a href="#AstrologicalSubject-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">utc_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="AstrologicalSubject-343"><a href="#AstrologicalSubject-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Backwards-compatible float UTC time value.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-344"><a href="#AstrologicalSubject-344"><span class="linenos">344</span></a>
</span><span id="AstrologicalSubject-345"><a href="#AstrologicalSubject-345"><span class="linenos">345</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_iso_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span><span class="p">)</span>
</span><span id="AstrologicalSubject-346"><a href="#AstrologicalSubject-346"><span class="linenos">346</span></a>        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">3_600_000_000</span>
</span><span id="AstrologicalSubject-347"><a href="#AstrologicalSubject-347"><span class="linenos">347</span></a>
</span><span id="AstrologicalSubject-348"><a href="#AstrologicalSubject-348"><span class="linenos">348</span></a>    <span class="nd">@cached_property</span>
</span><span id="AstrologicalSubject-349"><a href="#AstrologicalSubject-349"><span class="linenos">349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">local_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="AstrologicalSubject-350"><a href="#AstrologicalSubject-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Backwards-compatible float local time value.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject-351"><a href="#AstrologicalSubject-351"><span class="linenos">351</span></a>
</span><span id="AstrologicalSubject-352"><a href="#AstrologicalSubject-352"><span class="linenos">352</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_iso_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span>
</span><span id="AstrologicalSubject-353"><a href="#AstrologicalSubject-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">3_600_000_000</span>
</span><span id="AstrologicalSubject-354"><a href="#AstrologicalSubject-354"><span class="linenos">354</span></a>
</span><span id="AstrologicalSubject-355"><a href="#AstrologicalSubject-355"><span class="linenos">355</span></a>    <span class="c1"># Factory method compatibility (class method in old API)</span>
</span><span id="AstrologicalSubject-356"><a href="#AstrologicalSubject-356"><span class="linenos">356</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubject-357"><a href="#AstrologicalSubject-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_from_iso_utc_time</span><span class="p">(</span>
</span><span id="AstrologicalSubject-358"><a href="#AstrologicalSubject-358"><span class="linenos">358</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubject-359"><a href="#AstrologicalSubject-359"><span class="linenos">359</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubject-360"><a href="#AstrologicalSubject-360"><span class="linenos">360</span></a>        <span class="n">iso_utc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubject-361"><a href="#AstrologicalSubject-361"><span class="linenos">361</span></a>        <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-362"><a href="#AstrologicalSubject-362"><span class="linenos">362</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-363"><a href="#AstrologicalSubject-363"><span class="linenos">363</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/GMT&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-364"><a href="#AstrologicalSubject-364"><span class="linenos">364</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubject-365"><a href="#AstrologicalSubject-365"><span class="linenos">365</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="AstrologicalSubject-366"><a href="#AstrologicalSubject-366"><span class="linenos">366</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">51.5074</span><span class="p">,</span>
</span><span id="AstrologicalSubject-367"><a href="#AstrologicalSubject-367"><span class="linenos">367</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-368"><a href="#AstrologicalSubject-368"><span class="linenos">368</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ZodiacType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-369"><a href="#AstrologicalSubject-369"><span class="linenos">369</span></a>        <span class="n">disable_chiron_and_lilith</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubject-370"><a href="#AstrologicalSubject-370"><span class="linenos">370</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-371"><a href="#AstrologicalSubject-371"><span class="linenos">371</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">HousesSystemIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-372"><a href="#AstrologicalSubject-372"><span class="linenos">372</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PerspectiveType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject-373"><a href="#AstrologicalSubject-373"><span class="linenos">373</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AstrologicalSubject-374"><a href="#AstrologicalSubject-374"><span class="linenos">374</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AstrologicalSubject&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubject-375"><a href="#AstrologicalSubject-375"><span class="linenos">375</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.astrological_subject_factory</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="AstrologicalSubject-376"><a href="#AstrologicalSubject-376"><span class="linenos">376</span></a>            <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject-377"><a href="#AstrologicalSubject-377"><span class="linenos">377</span></a>            <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubject-378"><a href="#AstrologicalSubject-378"><span class="linenos">378</span></a>            <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject-379"><a href="#AstrologicalSubject-379"><span class="linenos">379</span></a>            <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">,</span>
</span><span id="AstrologicalSubject-380"><a href="#AstrologicalSubject-380"><span class="linenos">380</span></a>            <span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">,</span>
</span><span id="AstrologicalSubject-381"><a href="#AstrologicalSubject-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-382"><a href="#AstrologicalSubject-382"><span class="linenos">382</span></a>
</span><span id="AstrologicalSubject-383"><a href="#AstrologicalSubject-383"><span class="linenos">383</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;AstrologicalSubject.get_from_iso_utc_time&quot;</span><span class="p">,</span> <span class="s2">&quot;AstrologicalSubjectFactory.from_iso_utc_time&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubject-384"><a href="#AstrologicalSubject-384"><span class="linenos">384</span></a>
</span><span id="AstrologicalSubject-385"><a href="#AstrologicalSubject-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">disable_chiron_and_lilith</span><span class="p">:</span>
</span><span id="AstrologicalSubject-386"><a href="#AstrologicalSubject-386"><span class="linenos">386</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject-387"><a href="#AstrologicalSubject-387"><span class="linenos">387</span></a>                <span class="s2">&quot;&#39;disable_chiron_and_lilith&#39; is ignored by the new factory pipeline.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject-388"><a href="#AstrologicalSubject-388"><span class="linenos">388</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject-389"><a href="#AstrologicalSubject-389"><span class="linenos">389</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject-390"><a href="#AstrologicalSubject-390"><span class="linenos">390</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubject-391"><a href="#AstrologicalSubject-391"><span class="linenos">391</span></a>
</span><span id="AstrologicalSubject-392"><a href="#AstrologicalSubject-392"><span class="linenos">392</span></a>        <span class="n">resolved_geonames</span> <span class="o">=</span> <span class="n">geonames_username</span> <span class="ow">or</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span>
</span><span id="AstrologicalSubject-393"><a href="#AstrologicalSubject-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">online</span> <span class="ow">and</span> <span class="n">resolved_geonames</span> <span class="o">==</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">:</span>
</span><span id="AstrologicalSubject-394"><a href="#AstrologicalSubject-394"><span class="linenos">394</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AstrologicalSubject-395"><a href="#AstrologicalSubject-395"><span class="linenos">395</span></a>
</span><span id="AstrologicalSubject-396"><a href="#AstrologicalSubject-396"><span class="linenos">396</span></a>        <span class="c1"># Normalize legacy zodiac type values</span>
</span><span id="AstrologicalSubject-397"><a href="#AstrologicalSubject-397"><span class="linenos">397</span></a>        <span class="n">normalized_zodiac_type</span> <span class="o">=</span> <span class="n">_normalize_zodiac_type_with_warning</span><span class="p">(</span><span class="n">zodiac_type</span><span class="p">)</span>
</span><span id="AstrologicalSubject-398"><a href="#AstrologicalSubject-398"><span class="linenos">398</span></a>
</span><span id="AstrologicalSubject-399"><a href="#AstrologicalSubject-399"><span class="linenos">399</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_iso_utc_time</span><span class="p">(</span>
</span><span id="AstrologicalSubject-400"><a href="#AstrologicalSubject-400"><span class="linenos">400</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubject-401"><a href="#AstrologicalSubject-401"><span class="linenos">401</span></a>            <span class="n">iso_utc_time</span><span class="o">=</span><span class="n">iso_utc_time</span><span class="p">,</span>
</span><span id="AstrologicalSubject-402"><a href="#AstrologicalSubject-402"><span class="linenos">402</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubject-403"><a href="#AstrologicalSubject-403"><span class="linenos">403</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubject-404"><a href="#AstrologicalSubject-404"><span class="linenos">404</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubject-405"><a href="#AstrologicalSubject-405"><span class="linenos">405</span></a>            <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
</span><span id="AstrologicalSubject-406"><a href="#AstrologicalSubject-406"><span class="linenos">406</span></a>            <span class="n">lng</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span>
</span><span id="AstrologicalSubject-407"><a href="#AstrologicalSubject-407"><span class="linenos">407</span></a>            <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span>
</span><span id="AstrologicalSubject-408"><a href="#AstrologicalSubject-408"><span class="linenos">408</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">resolved_geonames</span><span class="p">,</span>
</span><span id="AstrologicalSubject-409"><a href="#AstrologicalSubject-409"><span class="linenos">409</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="p">(</span><span class="n">normalized_zodiac_type</span> <span class="ow">or</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-410"><a href="#AstrologicalSubject-410"><span class="linenos">410</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubject-411"><a href="#AstrologicalSubject-411"><span class="linenos">411</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="p">(</span><span class="n">houses_system_identifier</span> <span class="ow">or</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-412"><a href="#AstrologicalSubject-412"><span class="linenos">412</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="p">(</span><span class="n">perspective_type</span> <span class="ow">or</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject-413"><a href="#AstrologicalSubject-413"><span class="linenos">413</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="AstrologicalSubject-414"><a href="#AstrologicalSubject-414"><span class="linenos">414</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject-415"><a href="#AstrologicalSubject-415"><span class="linenos">415</span></a>
</span><span id="AstrologicalSubject-416"><a href="#AstrologicalSubject-416"><span class="linenos">416</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="AstrologicalSubject-417"><a href="#AstrologicalSubject-417"><span class="linenos">417</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="AstrologicalSubject-418"><a href="#AstrologicalSubject-418"><span class="linenos">418</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">json_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="AstrologicalSubject-419"><a href="#AstrologicalSubject-419"><span class="linenos">419</span></a>        <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


            <div class="docstring"><p>Backward compatible wrapper implementing the requested __init__ signature.</p>
</div>


                            <div id="AstrologicalSubject.__init__" class="classattr">
                                        <input id="AstrologicalSubject.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AstrologicalSubject</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Now&#39;</span>,</span><span class="param">	<span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2025</span>,</span><span class="param">	<span class="n">month</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span>,</span><span class="param">	<span class="n">day</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">29</span>,</span><span class="param">	<span class="n">hour</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">23</span>,</span><span class="param">	<span class="n">minute</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span>,</span><span class="param">	<span class="n">city</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span> <span class="s1">&#39;Sidereal&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_chiron</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FAGAN_BRADLEY&#39;</span><span class="p">,</span> <span class="s1">&#39;LAHIRI&#39;</span><span class="p">,</span> <span class="s1">&#39;DELUCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMAN&#39;</span><span class="p">,</span> <span class="s1">&#39;USHASHASHI&#39;</span><span class="p">,</span> <span class="s1">&#39;KRISHNAMURTI&#39;</span><span class="p">,</span> <span class="s1">&#39;DJWHAL_KHUL&#39;</span><span class="p">,</span> <span class="s1">&#39;YUKTESHWAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JN_BHASIN&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER1&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER2&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER3&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_HUBER&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_ETPSC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALDEBARAN_15TAU&#39;</span><span class="p">,</span> <span class="s1">&#39;HIPPARCHOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SASSANIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;J2000&#39;</span><span class="p">,</span> <span class="s1">&#39;J1900&#39;</span><span class="p">,</span> <span class="s1">&#39;B1950&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">perspective_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Apparent Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Heliocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Topocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;True Geocentric&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">is_dst</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">disable_chiron_and_lilith</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="AstrologicalSubject.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.__init__-158"><a href="#AstrologicalSubject.__init__-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="AstrologicalSubject.__init__-159"><a href="#AstrologicalSubject.__init__-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-160"><a href="#AstrologicalSubject.__init__-160"><span class="linenos">160</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Now&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-161"><a href="#AstrologicalSubject.__init__-161"><span class="linenos">161</span></a>        <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject.__init__-162"><a href="#AstrologicalSubject.__init__-162"><span class="linenos">162</span></a>        <span class="n">month</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject.__init__-163"><a href="#AstrologicalSubject.__init__-163"><span class="linenos">163</span></a>        <span class="n">day</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject.__init__-164"><a href="#AstrologicalSubject.__init__-164"><span class="linenos">164</span></a>        <span class="n">hour</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject.__init__-165"><a href="#AstrologicalSubject.__init__-165"><span class="linenos">165</span></a>        <span class="n">minute</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NOW</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="AstrologicalSubject.__init__-166"><a href="#AstrologicalSubject.__init__-166"><span class="linenos">166</span></a>        <span class="n">city</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-167"><a href="#AstrologicalSubject.__init__-167"><span class="linenos">167</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-168"><a href="#AstrologicalSubject.__init__-168"><span class="linenos">168</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-169"><a href="#AstrologicalSubject.__init__-169"><span class="linenos">169</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-170"><a href="#AstrologicalSubject.__init__-170"><span class="linenos">170</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-171"><a href="#AstrologicalSubject.__init__-171"><span class="linenos">171</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-172"><a href="#AstrologicalSubject.__init__-172"><span class="linenos">172</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ZodiacType</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># default resolved below</span>
</span><span id="AstrologicalSubject.__init__-173"><a href="#AstrologicalSubject.__init__-173"><span class="linenos">173</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-174"><a href="#AstrologicalSubject.__init__-174"><span class="linenos">174</span></a>        <span class="n">disable_chiron</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># deprecated</span>
</span><span id="AstrologicalSubject.__init__-175"><a href="#AstrologicalSubject.__init__-175"><span class="linenos">175</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-176"><a href="#AstrologicalSubject.__init__-176"><span class="linenos">176</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">HousesSystemIdentifier</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-177"><a href="#AstrologicalSubject.__init__-177"><span class="linenos">177</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PerspectiveType</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-178"><a href="#AstrologicalSubject.__init__-178"><span class="linenos">178</span></a>        <span class="n">cache_expire_after_days</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-179"><a href="#AstrologicalSubject.__init__-179"><span class="linenos">179</span></a>        <span class="n">is_dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-180"><a href="#AstrologicalSubject.__init__-180"><span class="linenos">180</span></a>        <span class="n">disable_chiron_and_lilith</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># currently not forwarded (not in factory)</span>
</span><span id="AstrologicalSubject.__init__-181"><a href="#AstrologicalSubject.__init__-181"><span class="linenos">181</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubject.__init__-182"><a href="#AstrologicalSubject.__init__-182"><span class="linenos">182</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.astrological_subject_factory</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="AstrologicalSubject.__init__-183"><a href="#AstrologicalSubject.__init__-183"><span class="linenos">183</span></a>            <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-184"><a href="#AstrologicalSubject.__init__-184"><span class="linenos">184</span></a>            <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-185"><a href="#AstrologicalSubject.__init__-185"><span class="linenos">185</span></a>            <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-186"><a href="#AstrologicalSubject.__init__-186"><span class="linenos">186</span></a>            <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-187"><a href="#AstrologicalSubject.__init__-187"><span class="linenos">187</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-188"><a href="#AstrologicalSubject.__init__-188"><span class="linenos">188</span></a>
</span><span id="AstrologicalSubject.__init__-189"><a href="#AstrologicalSubject.__init__-189"><span class="linenos">189</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;AstrologicalSubject&quot;</span><span class="p">,</span> <span class="s2">&quot;AstrologicalSubjectFactory.from_birth_data&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-190"><a href="#AstrologicalSubject.__init__-190"><span class="linenos">190</span></a>
</span><span id="AstrologicalSubject.__init__-191"><a href="#AstrologicalSubject.__init__-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">disable_chiron</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubject.__init__-192"><a href="#AstrologicalSubject.__init__-192"><span class="linenos">192</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&#39;disable_chiron&#39;  deprecato e ignorato.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-193"><a href="#AstrologicalSubject.__init__-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">disable_chiron_and_lilith</span><span class="p">:</span>
</span><span id="AstrologicalSubject.__init__-194"><a href="#AstrologicalSubject.__init__-194"><span class="linenos">194</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject.__init__-195"><a href="#AstrologicalSubject.__init__-195"><span class="linenos">195</span></a>                <span class="s2">&quot;&#39;disable_chiron_and_lilith&#39; non  supportato da from_birth_data in questa versione ed  ignorato.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-196"><a href="#AstrologicalSubject.__init__-196"><span class="linenos">196</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-197"><a href="#AstrologicalSubject.__init__-197"><span class="linenos">197</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-198"><a href="#AstrologicalSubject.__init__-198"><span class="linenos">198</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-199"><a href="#AstrologicalSubject.__init__-199"><span class="linenos">199</span></a>
</span><span id="AstrologicalSubject.__init__-200"><a href="#AstrologicalSubject.__init__-200"><span class="linenos">200</span></a>        <span class="c1"># Normalize legacy zodiac type values</span>
</span><span id="AstrologicalSubject.__init__-201"><a href="#AstrologicalSubject.__init__-201"><span class="linenos">201</span></a>        <span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">_normalize_zodiac_type_with_warning</span><span class="p">(</span><span class="n">zodiac_type</span><span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-202"><a href="#AstrologicalSubject.__init__-202"><span class="linenos">202</span></a>        <span class="n">zodiac_type</span> <span class="o">=</span> <span class="n">DEFAULT_ZODIAC_TYPE</span> <span class="k">if</span> <span class="n">zodiac_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">zodiac_type</span>
</span><span id="AstrologicalSubject.__init__-203"><a href="#AstrologicalSubject.__init__-203"><span class="linenos">203</span></a>
</span><span id="AstrologicalSubject.__init__-204"><a href="#AstrologicalSubject.__init__-204"><span class="linenos">204</span></a>        <span class="n">houses_system_identifier</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AstrologicalSubject.__init__-205"><a href="#AstrologicalSubject.__init__-205"><span class="linenos">205</span></a>            <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span> <span class="k">if</span> <span class="n">houses_system_identifier</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">houses_system_identifier</span>
</span><span id="AstrologicalSubject.__init__-206"><a href="#AstrologicalSubject.__init__-206"><span class="linenos">206</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-207"><a href="#AstrologicalSubject.__init__-207"><span class="linenos">207</span></a>        <span class="n">perspective_type</span> <span class="o">=</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span> <span class="k">if</span> <span class="n">perspective_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">perspective_type</span>
</span><span id="AstrologicalSubject.__init__-208"><a href="#AstrologicalSubject.__init__-208"><span class="linenos">208</span></a>        <span class="n">cache_expire_after_days</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AstrologicalSubject.__init__-209"><a href="#AstrologicalSubject.__init__-209"><span class="linenos">209</span></a>            <span class="n">DEFAULT_GEONAMES_CACHE_EXPIRE_AFTER_DAYS</span> <span class="k">if</span> <span class="n">cache_expire_after_days</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cache_expire_after_days</span>
</span><span id="AstrologicalSubject.__init__-210"><a href="#AstrologicalSubject.__init__-210"><span class="linenos">210</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-211"><a href="#AstrologicalSubject.__init__-211"><span class="linenos">211</span></a>
</span><span id="AstrologicalSubject.__init__-212"><a href="#AstrologicalSubject.__init__-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_birth_data</span><span class="p">(</span>
</span><span id="AstrologicalSubject.__init__-213"><a href="#AstrologicalSubject.__init__-213"><span class="linenos">213</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-214"><a href="#AstrologicalSubject.__init__-214"><span class="linenos">214</span></a>            <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-215"><a href="#AstrologicalSubject.__init__-215"><span class="linenos">215</span></a>            <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-216"><a href="#AstrologicalSubject.__init__-216"><span class="linenos">216</span></a>            <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-217"><a href="#AstrologicalSubject.__init__-217"><span class="linenos">217</span></a>            <span class="n">hour</span><span class="o">=</span><span class="n">hour</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-218"><a href="#AstrologicalSubject.__init__-218"><span class="linenos">218</span></a>            <span class="n">minute</span><span class="o">=</span><span class="n">minute</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-219"><a href="#AstrologicalSubject.__init__-219"><span class="linenos">219</span></a>            <span class="n">seconds</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-220"><a href="#AstrologicalSubject.__init__-220"><span class="linenos">220</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-221"><a href="#AstrologicalSubject.__init__-221"><span class="linenos">221</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-222"><a href="#AstrologicalSubject.__init__-222"><span class="linenos">222</span></a>            <span class="n">lng</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lng</span><span class="p">)</span> <span class="k">if</span> <span class="n">lng</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-223"><a href="#AstrologicalSubject.__init__-223"><span class="linenos">223</span></a>            <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-224"><a href="#AstrologicalSubject.__init__-224"><span class="linenos">224</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-225"><a href="#AstrologicalSubject.__init__-225"><span class="linenos">225</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">geonames_username</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-226"><a href="#AstrologicalSubject.__init__-226"><span class="linenos">226</span></a>            <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-227"><a href="#AstrologicalSubject.__init__-227"><span class="linenos">227</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="n">zodiac_type</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.__init__-228"><a href="#AstrologicalSubject.__init__-228"><span class="linenos">228</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.__init__-229"><a href="#AstrologicalSubject.__init__-229"><span class="linenos">229</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="n">houses_system_identifier</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.__init__-230"><a href="#AstrologicalSubject.__init__-230"><span class="linenos">230</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="n">perspective_type</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.__init__-231"><a href="#AstrologicalSubject.__init__-231"><span class="linenos">231</span></a>            <span class="n">cache_expire_after_days</span><span class="o">=</span><span class="n">cache_expire_after_days</span><span class="p">,</span>
</span><span id="AstrologicalSubject.__init__-232"><a href="#AstrologicalSubject.__init__-232"><span class="linenos">232</span></a>            <span class="n">is_dst</span><span class="o">=</span><span class="n">is_dst</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.__init__-233"><a href="#AstrologicalSubject.__init__-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.__init__-234"><a href="#AstrologicalSubject.__init__-234"><span class="linenos">234</span></a>
</span><span id="AstrologicalSubject.__init__-235"><a href="#AstrologicalSubject.__init__-235"><span class="linenos">235</span></a>        <span class="c1"># Legacy filesystem attributes</span>
</span><span id="AstrologicalSubject.__init__-236"><a href="#AstrologicalSubject.__init__-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">json_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="AstrologicalSubject.NOW" class="classattr">
                                <div class="attr variable">
            <span class="name">NOW</span>        =
<span class="default_value">datetime.datetime(2025, 12, 29, 23, 9, 23, 659445)</span>

        
    </div>
    <a class="headerlink" href="#AstrologicalSubject.NOW"></a>
    
    

                            </div>
                            <div id="AstrologicalSubject.json_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">json_dir</span>

        
    </div>
    <a class="headerlink" href="#AstrologicalSubject.json_dir"></a>
    
    

                            </div>
                            <div id="AstrologicalSubject.mean_node" class="classattr">
                                        <input id="AstrologicalSubject.mean_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">mean_node</span>

                <label class="view-source-button" for="AstrologicalSubject.mean_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.mean_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.mean_node-239"><a href="#AstrologicalSubject.mean_node-239"><span class="linenos">239</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject.mean_node-240"><a href="#AstrologicalSubject.mean_node-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mean_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject.mean_node-241"><a href="#AstrologicalSubject.mean_node-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use mean_north_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.mean_node-242"><a href="#AstrologicalSubject.mean_node-242"><span class="linenos">242</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject.mean_node-243"><a href="#AstrologicalSubject.mean_node-243"><span class="linenos">243</span></a>            <span class="s2">&quot;&#39;mean_node&#39; is deprecated in Kerykeion v5. Use &#39;mean_north_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.mean_node-244"><a href="#AstrologicalSubject.mean_node-244"><span class="linenos">244</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject.mean_node-245"><a href="#AstrologicalSubject.mean_node-245"><span class="linenos">245</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject.mean_node-246"><a href="#AstrologicalSubject.mean_node-246"><span class="linenos">246</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.mean_node-247"><a href="#AstrologicalSubject.mean_node-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">mean_north_lunar_node</span>
</span></pre></div>


            <div class="docstring"><p>Deprecated: Use mean_north_lunar_node instead.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.true_node" class="classattr">
                                        <input id="AstrologicalSubject.true_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">true_node</span>

                <label class="view-source-button" for="AstrologicalSubject.true_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.true_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.true_node-249"><a href="#AstrologicalSubject.true_node-249"><span class="linenos">249</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject.true_node-250"><a href="#AstrologicalSubject.true_node-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">true_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject.true_node-251"><a href="#AstrologicalSubject.true_node-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use true_north_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.true_node-252"><a href="#AstrologicalSubject.true_node-252"><span class="linenos">252</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject.true_node-253"><a href="#AstrologicalSubject.true_node-253"><span class="linenos">253</span></a>            <span class="s2">&quot;&#39;true_node&#39; is deprecated in Kerykeion v5. Use &#39;true_north_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.true_node-254"><a href="#AstrologicalSubject.true_node-254"><span class="linenos">254</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject.true_node-255"><a href="#AstrologicalSubject.true_node-255"><span class="linenos">255</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject.true_node-256"><a href="#AstrologicalSubject.true_node-256"><span class="linenos">256</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.true_node-257"><a href="#AstrologicalSubject.true_node-257"><span class="linenos">257</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">true_north_lunar_node</span>
</span></pre></div>


            <div class="docstring"><p>Deprecated: Use true_north_lunar_node instead.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.mean_south_node" class="classattr">
                                        <input id="AstrologicalSubject.mean_south_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">mean_south_node</span>

                <label class="view-source-button" for="AstrologicalSubject.mean_south_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.mean_south_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.mean_south_node-259"><a href="#AstrologicalSubject.mean_south_node-259"><span class="linenos">259</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject.mean_south_node-260"><a href="#AstrologicalSubject.mean_south_node-260"><span class="linenos">260</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mean_south_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject.mean_south_node-261"><a href="#AstrologicalSubject.mean_south_node-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use mean_south_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.mean_south_node-262"><a href="#AstrologicalSubject.mean_south_node-262"><span class="linenos">262</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject.mean_south_node-263"><a href="#AstrologicalSubject.mean_south_node-263"><span class="linenos">263</span></a>            <span class="s2">&quot;&#39;mean_south_node&#39; is deprecated in Kerykeion v5. Use &#39;mean_south_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.mean_south_node-264"><a href="#AstrologicalSubject.mean_south_node-264"><span class="linenos">264</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject.mean_south_node-265"><a href="#AstrologicalSubject.mean_south_node-265"><span class="linenos">265</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject.mean_south_node-266"><a href="#AstrologicalSubject.mean_south_node-266"><span class="linenos">266</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.mean_south_node-267"><a href="#AstrologicalSubject.mean_south_node-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">mean_south_lunar_node</span>
</span></pre></div>


            <div class="docstring"><p>Deprecated: Use mean_south_lunar_node instead.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.true_south_node" class="classattr">
                                        <input id="AstrologicalSubject.true_south_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">true_south_node</span>

                <label class="view-source-button" for="AstrologicalSubject.true_south_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.true_south_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.true_south_node-269"><a href="#AstrologicalSubject.true_south_node-269"><span class="linenos">269</span></a>    <span class="nd">@property</span>
</span><span id="AstrologicalSubject.true_south_node-270"><a href="#AstrologicalSubject.true_south_node-270"><span class="linenos">270</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">true_south_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AstrologicalSubject.true_south_node-271"><a href="#AstrologicalSubject.true_south_node-271"><span class="linenos">271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Use true_south_lunar_node instead.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.true_south_node-272"><a href="#AstrologicalSubject.true_south_node-272"><span class="linenos">272</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject.true_south_node-273"><a href="#AstrologicalSubject.true_south_node-273"><span class="linenos">273</span></a>            <span class="s2">&quot;&#39;true_south_node&#39; is deprecated in Kerykeion v5. Use &#39;true_south_lunar_node&#39; instead.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.true_south_node-274"><a href="#AstrologicalSubject.true_south_node-274"><span class="linenos">274</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject.true_south_node-275"><a href="#AstrologicalSubject.true_south_node-275"><span class="linenos">275</span></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject.true_south_node-276"><a href="#AstrologicalSubject.true_south_node-276"><span class="linenos">276</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.true_south_node-277"><a href="#AstrologicalSubject.true_south_node-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">true_south_lunar_node</span>
</span></pre></div>


            <div class="docstring"><p>Deprecated: Use true_south_lunar_node instead.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.json" class="classattr">
                                        <input id="AstrologicalSubject.json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">json</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">dump</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">destination_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">indent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubject.json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.json-290"><a href="#AstrologicalSubject.json-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json</span><span class="p">(</span>
</span><span id="AstrologicalSubject.json-291"><a href="#AstrologicalSubject.json-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AstrologicalSubject.json-292"><a href="#AstrologicalSubject.json-292"><span class="linenos">292</span></a>        <span class="n">dump</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubject.json-293"><a href="#AstrologicalSubject.json-293"><span class="linenos">293</span></a>        <span class="n">destination_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.json-294"><a href="#AstrologicalSubject.json-294"><span class="linenos">294</span></a>        <span class="n">indent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.json-295"><a href="#AstrologicalSubject.json-295"><span class="linenos">295</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AstrologicalSubject.json-296"><a href="#AstrologicalSubject.json-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Replicate legacy json() behaviour returning a JSON string and optionally dumping to disk.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.json-297"><a href="#AstrologicalSubject.json-297"><span class="linenos">297</span></a>
</span><span id="AstrologicalSubject.json-298"><a href="#AstrologicalSubject.json-298"><span class="linenos">298</span></a>        <span class="n">json_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
</span><span id="AstrologicalSubject.json-299"><a href="#AstrologicalSubject.json-299"><span class="linenos">299</span></a>
</span><span id="AstrologicalSubject.json-300"><a href="#AstrologicalSubject.json-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dump</span><span class="p">:</span>
</span><span id="AstrologicalSubject.json-301"><a href="#AstrologicalSubject.json-301"><span class="linenos">301</span></a>            <span class="k">return</span> <span class="n">json_string</span>
</span><span id="AstrologicalSubject.json-302"><a href="#AstrologicalSubject.json-302"><span class="linenos">302</span></a>
</span><span id="AstrologicalSubject.json-303"><a href="#AstrologicalSubject.json-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="n">destination_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AstrologicalSubject.json-304"><a href="#AstrologicalSubject.json-304"><span class="linenos">304</span></a>            <span class="n">target_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination_folder</span><span class="p">)</span>
</span><span id="AstrologicalSubject.json-305"><a href="#AstrologicalSubject.json-305"><span class="linenos">305</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AstrologicalSubject.json-306"><a href="#AstrologicalSubject.json-306"><span class="linenos">306</span></a>            <span class="n">target_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_dir</span>
</span><span id="AstrologicalSubject.json-307"><a href="#AstrologicalSubject.json-307"><span class="linenos">307</span></a>
</span><span id="AstrologicalSubject.json-308"><a href="#AstrologicalSubject.json-308"><span class="linenos">308</span></a>        <span class="n">target_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AstrologicalSubject.json-309"><a href="#AstrologicalSubject.json-309"><span class="linenos">309</span></a>        <span class="n">json_path</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_kerykeion.json&quot;</span>
</span><span id="AstrologicalSubject.json-310"><a href="#AstrologicalSubject.json-310"><span class="linenos">310</span></a>
</span><span id="AstrologicalSubject.json-311"><a href="#AstrologicalSubject.json-311"><span class="linenos">311</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="AstrologicalSubject.json-312"><a href="#AstrologicalSubject.json-312"><span class="linenos">312</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
</span><span id="AstrologicalSubject.json-313"><a href="#AstrologicalSubject.json-313"><span class="linenos">313</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JSON file dumped in </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>
</span><span id="AstrologicalSubject.json-314"><a href="#AstrologicalSubject.json-314"><span class="linenos">314</span></a>
</span><span id="AstrologicalSubject.json-315"><a href="#AstrologicalSubject.json-315"><span class="linenos">315</span></a>        <span class="k">return</span> <span class="n">json_string</span>
</span></pre></div>


            <div class="docstring"><p>Replicate legacy json() behaviour returning a JSON string and optionally dumping to disk.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.model" class="classattr">
                                        <input id="AstrologicalSubject.model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubject.model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.model-324"><a href="#AstrologicalSubject.model-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstrologicalSubjectModel</span><span class="p">:</span>
</span><span id="AstrologicalSubject.model-325"><a href="#AstrologicalSubject.model-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the underlying Pydantic model (legacy compatibility).&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.model-326"><a href="#AstrologicalSubject.model-326"><span class="linenos">326</span></a>
</span><span id="AstrologicalSubject.model-327"><a href="#AstrologicalSubject.model-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>
</span></pre></div>


            <div class="docstring"><p>Return the underlying Pydantic model (legacy compatibility).</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.get" class="classattr">
                                        <input id="AstrologicalSubject.get-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">item</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubject.get-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.get"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.get-332"><a href="#AstrologicalSubject.get-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="AstrologicalSubject.get-333"><a href="#AstrologicalSubject.get-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="AstrologicalSubject.utc_time" class="classattr">
                                        <input id="AstrologicalSubject.utc_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">utc_time</span><span class="annotation">: float</span>

                <label class="view-source-button" for="AstrologicalSubject.utc_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.utc_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.utc_time-341"><a href="#AstrologicalSubject.utc_time-341"><span class="linenos">341</span></a>    <span class="nd">@cached_property</span>
</span><span id="AstrologicalSubject.utc_time-342"><a href="#AstrologicalSubject.utc_time-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">utc_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="AstrologicalSubject.utc_time-343"><a href="#AstrologicalSubject.utc_time-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Backwards-compatible float UTC time value.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.utc_time-344"><a href="#AstrologicalSubject.utc_time-344"><span class="linenos">344</span></a>
</span><span id="AstrologicalSubject.utc_time-345"><a href="#AstrologicalSubject.utc_time-345"><span class="linenos">345</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_iso_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">iso_formatted_utc_datetime</span><span class="p">)</span>
</span><span id="AstrologicalSubject.utc_time-346"><a href="#AstrologicalSubject.utc_time-346"><span class="linenos">346</span></a>        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">3_600_000_000</span>
</span></pre></div>


            <div class="docstring"><p>Backwards-compatible float UTC time value.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.local_time" class="classattr">
                                        <input id="AstrologicalSubject.local_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">local_time</span><span class="annotation">: float</span>

                <label class="view-source-button" for="AstrologicalSubject.local_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.local_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.local_time-348"><a href="#AstrologicalSubject.local_time-348"><span class="linenos">348</span></a>    <span class="nd">@cached_property</span>
</span><span id="AstrologicalSubject.local_time-349"><a href="#AstrologicalSubject.local_time-349"><span class="linenos">349</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">local_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="AstrologicalSubject.local_time-350"><a href="#AstrologicalSubject.local_time-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Backwards-compatible float local time value.&quot;&quot;&quot;</span>
</span><span id="AstrologicalSubject.local_time-351"><a href="#AstrologicalSubject.local_time-351"><span class="linenos">351</span></a>
</span><span id="AstrologicalSubject.local_time-352"><a href="#AstrologicalSubject.local_time-352"><span class="linenos">352</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_iso_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">iso_formatted_local_datetime</span><span class="p">)</span>
</span><span id="AstrologicalSubject.local_time-353"><a href="#AstrologicalSubject.local_time-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">second</span> <span class="o">/</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">3_600_000_000</span>
</span></pre></div>


            <div class="docstring"><p>Backwards-compatible float local time value.</p>
</div>


                            </div>
                            <div id="AstrologicalSubject.get_from_iso_utc_time" class="classattr">
                                        <input id="AstrologicalSubject.get_from_iso_utc_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_from_iso_utc_time</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">iso_utc_time</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Greenwich&#39;</span>,</span><span class="param">	<span class="n">nation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GB&#39;</span>,</span><span class="param">	<span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Etc/GMT&#39;</span>,</span><span class="param">	<span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">51.5074</span>,</span><span class="param">	<span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Tropical&#39;</span><span class="p">,</span> <span class="s1">&#39;Sidereal&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">disable_chiron_and_lilith</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FAGAN_BRADLEY&#39;</span><span class="p">,</span> <span class="s1">&#39;LAHIRI&#39;</span><span class="p">,</span> <span class="s1">&#39;DELUCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RAMAN&#39;</span><span class="p">,</span> <span class="s1">&#39;USHASHASHI&#39;</span><span class="p">,</span> <span class="s1">&#39;KRISHNAMURTI&#39;</span><span class="p">,</span> <span class="s1">&#39;DJWHAL_KHUL&#39;</span><span class="p">,</span> <span class="s1">&#39;YUKTESHWAR&#39;</span><span class="p">,</span> <span class="s1">&#39;JN_BHASIN&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER1&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER2&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_KUGLER3&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_HUBER&#39;</span><span class="p">,</span> <span class="s1">&#39;BABYL_ETPSC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALDEBARAN_15TAU&#39;</span><span class="p">,</span> <span class="s1">&#39;HIPPARCHOS&#39;</span><span class="p">,</span> <span class="s1">&#39;SASSANIAN&#39;</span><span class="p">,</span> <span class="s1">&#39;J2000&#39;</span><span class="p">,</span> <span class="s1">&#39;J1900&#39;</span><span class="p">,</span> <span class="s1">&#39;B1950&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">perspective_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Apparent Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Heliocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Topocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;True Geocentric&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n"><a href="#AstrologicalSubject">AstrologicalSubject</a></span>:</span></span>

                <label class="view-source-button" for="AstrologicalSubject.get_from_iso_utc_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AstrologicalSubject.get_from_iso_utc_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AstrologicalSubject.get_from_iso_utc_time-356"><a href="#AstrologicalSubject.get_from_iso_utc_time-356"><span class="linenos">356</span></a>    <span class="nd">@classmethod</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-357"><a href="#AstrologicalSubject.get_from_iso_utc_time-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_from_iso_utc_time</span><span class="p">(</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-358"><a href="#AstrologicalSubject.get_from_iso_utc_time-358"><span class="linenos">358</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-359"><a href="#AstrologicalSubject.get_from_iso_utc_time-359"><span class="linenos">359</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-360"><a href="#AstrologicalSubject.get_from_iso_utc_time-360"><span class="linenos">360</span></a>        <span class="n">iso_utc_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-361"><a href="#AstrologicalSubject.get_from_iso_utc_time-361"><span class="linenos">361</span></a>        <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-362"><a href="#AstrologicalSubject.get_from_iso_utc_time-362"><span class="linenos">362</span></a>        <span class="n">nation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-363"><a href="#AstrologicalSubject.get_from_iso_utc_time-363"><span class="linenos">363</span></a>        <span class="n">tz_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/GMT&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-364"><a href="#AstrologicalSubject.get_from_iso_utc_time-364"><span class="linenos">364</span></a>        <span class="n">online</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-365"><a href="#AstrologicalSubject.get_from_iso_utc_time-365"><span class="linenos">365</span></a>        <span class="n">lng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-366"><a href="#AstrologicalSubject.get_from_iso_utc_time-366"><span class="linenos">366</span></a>        <span class="n">lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">51.5074</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-367"><a href="#AstrologicalSubject.get_from_iso_utc_time-367"><span class="linenos">367</span></a>        <span class="n">geonames_username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-368"><a href="#AstrologicalSubject.get_from_iso_utc_time-368"><span class="linenos">368</span></a>        <span class="n">zodiac_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ZodiacType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-369"><a href="#AstrologicalSubject.get_from_iso_utc_time-369"><span class="linenos">369</span></a>        <span class="n">disable_chiron_and_lilith</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-370"><a href="#AstrologicalSubject.get_from_iso_utc_time-370"><span class="linenos">370</span></a>        <span class="n">sidereal_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SiderealMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-371"><a href="#AstrologicalSubject.get_from_iso_utc_time-371"><span class="linenos">371</span></a>        <span class="n">houses_system_identifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">HousesSystemIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-372"><a href="#AstrologicalSubject.get_from_iso_utc_time-372"><span class="linenos">372</span></a>        <span class="n">perspective_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PerspectiveType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-373"><a href="#AstrologicalSubject.get_from_iso_utc_time-373"><span class="linenos">373</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-374"><a href="#AstrologicalSubject.get_from_iso_utc_time-374"><span class="linenos">374</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AstrologicalSubject&quot;</span><span class="p">:</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-375"><a href="#AstrologicalSubject.get_from_iso_utc_time-375"><span class="linenos">375</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.astrological_subject_factory</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-376"><a href="#AstrologicalSubject.get_from_iso_utc_time-376"><span class="linenos">376</span></a>            <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-377"><a href="#AstrologicalSubject.get_from_iso_utc_time-377"><span class="linenos">377</span></a>            <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-378"><a href="#AstrologicalSubject.get_from_iso_utc_time-378"><span class="linenos">378</span></a>            <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-379"><a href="#AstrologicalSubject.get_from_iso_utc_time-379"><span class="linenos">379</span></a>            <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-380"><a href="#AstrologicalSubject.get_from_iso_utc_time-380"><span class="linenos">380</span></a>            <span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-381"><a href="#AstrologicalSubject.get_from_iso_utc_time-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-382"><a href="#AstrologicalSubject.get_from_iso_utc_time-382"><span class="linenos">382</span></a>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-383"><a href="#AstrologicalSubject.get_from_iso_utc_time-383"><span class="linenos">383</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;AstrologicalSubject.get_from_iso_utc_time&quot;</span><span class="p">,</span> <span class="s2">&quot;AstrologicalSubjectFactory.from_iso_utc_time&quot;</span><span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-384"><a href="#AstrologicalSubject.get_from_iso_utc_time-384"><span class="linenos">384</span></a>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-385"><a href="#AstrologicalSubject.get_from_iso_utc_time-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">disable_chiron_and_lilith</span><span class="p">:</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-386"><a href="#AstrologicalSubject.get_from_iso_utc_time-386"><span class="linenos">386</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-387"><a href="#AstrologicalSubject.get_from_iso_utc_time-387"><span class="linenos">387</span></a>                <span class="s2">&quot;&#39;disable_chiron_and_lilith&#39; is ignored by the new factory pipeline.&quot;</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-388"><a href="#AstrologicalSubject.get_from_iso_utc_time-388"><span class="linenos">388</span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-389"><a href="#AstrologicalSubject.get_from_iso_utc_time-389"><span class="linenos">389</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-390"><a href="#AstrologicalSubject.get_from_iso_utc_time-390"><span class="linenos">390</span></a>            <span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-391"><a href="#AstrologicalSubject.get_from_iso_utc_time-391"><span class="linenos">391</span></a>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-392"><a href="#AstrologicalSubject.get_from_iso_utc_time-392"><span class="linenos">392</span></a>        <span class="n">resolved_geonames</span> <span class="o">=</span> <span class="n">geonames_username</span> <span class="ow">or</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-393"><a href="#AstrologicalSubject.get_from_iso_utc_time-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">online</span> <span class="ow">and</span> <span class="n">resolved_geonames</span> <span class="o">==</span> <span class="n">DEFAULT_GEONAMES_USERNAME</span><span class="p">:</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-394"><a href="#AstrologicalSubject.get_from_iso_utc_time-394"><span class="linenos">394</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">GEONAMES_DEFAULT_USERNAME_WARNING</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-395"><a href="#AstrologicalSubject.get_from_iso_utc_time-395"><span class="linenos">395</span></a>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-396"><a href="#AstrologicalSubject.get_from_iso_utc_time-396"><span class="linenos">396</span></a>        <span class="c1"># Normalize legacy zodiac type values</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-397"><a href="#AstrologicalSubject.get_from_iso_utc_time-397"><span class="linenos">397</span></a>        <span class="n">normalized_zodiac_type</span> <span class="o">=</span> <span class="n">_normalize_zodiac_type_with_warning</span><span class="p">(</span><span class="n">zodiac_type</span><span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-398"><a href="#AstrologicalSubject.get_from_iso_utc_time-398"><span class="linenos">398</span></a>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-399"><a href="#AstrologicalSubject.get_from_iso_utc_time-399"><span class="linenos">399</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">AstrologicalSubjectFactory</span><span class="o">.</span><span class="n">from_iso_utc_time</span><span class="p">(</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-400"><a href="#AstrologicalSubject.get_from_iso_utc_time-400"><span class="linenos">400</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-401"><a href="#AstrologicalSubject.get_from_iso_utc_time-401"><span class="linenos">401</span></a>            <span class="n">iso_utc_time</span><span class="o">=</span><span class="n">iso_utc_time</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-402"><a href="#AstrologicalSubject.get_from_iso_utc_time-402"><span class="linenos">402</span></a>            <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-403"><a href="#AstrologicalSubject.get_from_iso_utc_time-403"><span class="linenos">403</span></a>            <span class="n">nation</span><span class="o">=</span><span class="n">nation</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-404"><a href="#AstrologicalSubject.get_from_iso_utc_time-404"><span class="linenos">404</span></a>            <span class="n">tz_str</span><span class="o">=</span><span class="n">tz_str</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-405"><a href="#AstrologicalSubject.get_from_iso_utc_time-405"><span class="linenos">405</span></a>            <span class="n">online</span><span class="o">=</span><span class="n">online</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-406"><a href="#AstrologicalSubject.get_from_iso_utc_time-406"><span class="linenos">406</span></a>            <span class="n">lng</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-407"><a href="#AstrologicalSubject.get_from_iso_utc_time-407"><span class="linenos">407</span></a>            <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-408"><a href="#AstrologicalSubject.get_from_iso_utc_time-408"><span class="linenos">408</span></a>            <span class="n">geonames_username</span><span class="o">=</span><span class="n">resolved_geonames</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-409"><a href="#AstrologicalSubject.get_from_iso_utc_time-409"><span class="linenos">409</span></a>            <span class="n">zodiac_type</span><span class="o">=</span><span class="p">(</span><span class="n">normalized_zodiac_type</span> <span class="ow">or</span> <span class="n">DEFAULT_ZODIAC_TYPE</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-410"><a href="#AstrologicalSubject.get_from_iso_utc_time-410"><span class="linenos">410</span></a>            <span class="n">sidereal_mode</span><span class="o">=</span><span class="n">sidereal_mode</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-411"><a href="#AstrologicalSubject.get_from_iso_utc_time-411"><span class="linenos">411</span></a>            <span class="n">houses_system_identifier</span><span class="o">=</span><span class="p">(</span><span class="n">houses_system_identifier</span> <span class="ow">or</span> <span class="n">DEFAULT_HOUSES_SYSTEM_IDENTIFIER</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-412"><a href="#AstrologicalSubject.get_from_iso_utc_time-412"><span class="linenos">412</span></a>            <span class="n">perspective_type</span><span class="o">=</span><span class="p">(</span><span class="n">perspective_type</span> <span class="ow">or</span> <span class="n">DEFAULT_PERSPECTIVE_TYPE</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-413"><a href="#AstrologicalSubject.get_from_iso_utc_time-413"><span class="linenos">413</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-414"><a href="#AstrologicalSubject.get_from_iso_utc_time-414"><span class="linenos">414</span></a>        <span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-415"><a href="#AstrologicalSubject.get_from_iso_utc_time-415"><span class="linenos">415</span></a>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-416"><a href="#AstrologicalSubject.get_from_iso_utc_time-416"><span class="linenos">416</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-417"><a href="#AstrologicalSubject.get_from_iso_utc_time-417"><span class="linenos">417</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-418"><a href="#AstrologicalSubject.get_from_iso_utc_time-418"><span class="linenos">418</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">json_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="AstrologicalSubject.get_from_iso_utc_time-419"><a href="#AstrologicalSubject.get_from_iso_utc_time-419"><span class="linenos">419</span></a>        <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="KerykeionChartSVG">
                            <input id="KerykeionChartSVG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KerykeionChartSVG</span>:

                <label class="view-source-button" for="KerykeionChartSVG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG-424"><a href="#KerykeionChartSVG-424"><span class="linenos">424</span></a><span class="k">class</span><span class="w"> </span><span class="nc">KerykeionChartSVG</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-425"><a href="#KerykeionChartSVG-425"><span class="linenos">425</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper emulating the v4 chart generation interface.</span>
</span><span id="KerykeionChartSVG-426"><a href="#KerykeionChartSVG-426"><span class="linenos">426</span></a>
</span><span id="KerykeionChartSVG-427"><a href="#KerykeionChartSVG-427"><span class="linenos">427</span></a><span class="sd">    Old usage:</span>
</span><span id="KerykeionChartSVG-428"><a href="#KerykeionChartSVG-428"><span class="linenos">428</span></a><span class="sd">        chart = KerykeionChartSVG(subject, chart_type=&quot;ExternalNatal&quot;, second_subject)</span>
</span><span id="KerykeionChartSVG-429"><a href="#KerykeionChartSVG-429"><span class="linenos">429</span></a><span class="sd">        chart.makeSVG(minify_svg=True, remove_css_variables=True)</span>
</span><span id="KerykeionChartSVG-430"><a href="#KerykeionChartSVG-430"><span class="linenos">430</span></a>
</span><span id="KerykeionChartSVG-431"><a href="#KerykeionChartSVG-431"><span class="linenos">431</span></a><span class="sd">    Replaced by ChartDataFactory + ChartDrawer.</span>
</span><span id="KerykeionChartSVG-432"><a href="#KerykeionChartSVG-432"><span class="linenos">432</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="KerykeionChartSVG-433"><a href="#KerykeionChartSVG-433"><span class="linenos">433</span></a>
</span><span id="KerykeionChartSVG-434"><a href="#KerykeionChartSVG-434"><span class="linenos">434</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-435"><a href="#KerykeionChartSVG-435"><span class="linenos">435</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-436"><a href="#KerykeionChartSVG-436"><span class="linenos">436</span></a>        <span class="n">first_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">],</span>
</span><span id="KerykeionChartSVG-437"><a href="#KerykeionChartSVG-437"><span class="linenos">437</span></a>        <span class="n">chart_type</span><span class="p">:</span> <span class="n">ChartType</span> <span class="o">=</span> <span class="s2">&quot;Natal&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-438"><a href="#KerykeionChartSVG-438"><span class="linenos">438</span></a>        <span class="n">second_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-439"><a href="#KerykeionChartSVG-439"><span class="linenos">439</span></a>        <span class="n">new_output_directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-440"><a href="#KerykeionChartSVG-440"><span class="linenos">440</span></a>        <span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># retained for signature compatibility (unused)</span>
</span><span id="KerykeionChartSVG-441"><a href="#KerykeionChartSVG-441"><span class="linenos">441</span></a>        <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;classic&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-442"><a href="#KerykeionChartSVG-442"><span class="linenos">442</span></a>        <span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-443"><a href="#KerykeionChartSVG-443"><span class="linenos">443</span></a>        <span class="n">chart_language</span><span class="p">:</span> <span class="n">KerykeionChartLanguage</span> <span class="o">=</span> <span class="s2">&quot;EN&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-444"><a href="#KerykeionChartSVG-444"><span class="linenos">444</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="KerykeionChartSVG-445"><a href="#KerykeionChartSVG-445"><span class="linenos">445</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-446"><a href="#KerykeionChartSVG-446"><span class="linenos">446</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-447"><a href="#KerykeionChartSVG-447"><span class="linenos">447</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-448"><a href="#KerykeionChartSVG-448"><span class="linenos">448</span></a>
</span><span id="KerykeionChartSVG-449"><a href="#KerykeionChartSVG-449"><span class="linenos">449</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-450"><a href="#KerykeionChartSVG-450"><span class="linenos">450</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;KerykeionChartSVG&quot;</span><span class="p">,</span> <span class="s2">&quot;ChartDataFactory + ChartDrawer&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-451"><a href="#KerykeionChartSVG-451"><span class="linenos">451</span></a>
</span><span id="KerykeionChartSVG-452"><a href="#KerykeionChartSVG-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="n">new_settings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-453"><a href="#KerykeionChartSVG-453"><span class="linenos">453</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-454"><a href="#KerykeionChartSVG-454"><span class="linenos">454</span></a>                <span class="s2">&quot;&#39;new_settings_file&#39; is deprecated and ignored in Kerykeion v5. Use language_pack instead.&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-455"><a href="#KerykeionChartSVG-455"><span class="linenos">455</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-456"><a href="#KerykeionChartSVG-456"><span class="linenos">456</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-457"><a href="#KerykeionChartSVG-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="KerykeionChartSVG-458"><a href="#KerykeionChartSVG-458"><span class="linenos">458</span></a>
</span><span id="KerykeionChartSVG-459"><a href="#KerykeionChartSVG-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_obj</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-460"><a href="#KerykeionChartSVG-460"><span class="linenos">460</span></a>            <span class="n">subject_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_obj</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-461"><a href="#KerykeionChartSVG-461"><span class="linenos">461</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-462"><a href="#KerykeionChartSVG-462"><span class="linenos">462</span></a>            <span class="n">subject_model</span> <span class="o">=</span> <span class="n">first_obj</span>
</span><span id="KerykeionChartSVG-463"><a href="#KerykeionChartSVG-463"><span class="linenos">463</span></a>
</span><span id="KerykeionChartSVG-464"><a href="#KerykeionChartSVG-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_obj</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-465"><a href="#KerykeionChartSVG-465"><span class="linenos">465</span></a>            <span class="n">second_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">]]</span> <span class="o">=</span> <span class="n">second_obj</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-466"><a href="#KerykeionChartSVG-466"><span class="linenos">466</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-467"><a href="#KerykeionChartSVG-467"><span class="linenos">467</span></a>            <span class="n">second_model</span> <span class="o">=</span> <span class="n">second_obj</span>
</span><span id="KerykeionChartSVG-468"><a href="#KerykeionChartSVG-468"><span class="linenos">468</span></a>
</span><span id="KerykeionChartSVG-469"><a href="#KerykeionChartSVG-469"><span class="linenos">469</span></a>        <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-470"><a href="#KerykeionChartSVG-470"><span class="linenos">470</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-471"><a href="#KerykeionChartSVG-471"><span class="linenos">471</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-472"><a href="#KerykeionChartSVG-472"><span class="linenos">472</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_aspects</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-473"><a href="#KerykeionChartSVG-473"><span class="linenos">473</span></a>
</span><span id="KerykeionChartSVG-474"><a href="#KerykeionChartSVG-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_type</span>
</span><span id="KerykeionChartSVG-475"><a href="#KerykeionChartSVG-475"><span class="linenos">475</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span> <span class="o">=</span> <span class="n">language_pack</span>
</span><span id="KerykeionChartSVG-476"><a href="#KerykeionChartSVG-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="n">theme</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="KerykeionChartSVG-477"><a href="#KerykeionChartSVG-477"><span class="linenos">477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">=</span> <span class="n">double_chart_aspect_grid_type</span>
</span><span id="KerykeionChartSVG-478"><a href="#KerykeionChartSVG-478"><span class="linenos">478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span> <span class="o">=</span> <span class="n">chart_language</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="KerykeionChartSVG-479"><a href="#KerykeionChartSVG-479"><span class="linenos">479</span></a>
</span><span id="KerykeionChartSVG-480"><a href="#KerykeionChartSVG-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span> <span class="o">=</span> <span class="n">subject_model</span>
</span><span id="KerykeionChartSVG-481"><a href="#KerykeionChartSVG-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span> <span class="o">=</span> <span class="n">second_model</span>
</span><span id="KerykeionChartSVG-482"><a href="#KerykeionChartSVG-482"><span class="linenos">482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">subject_model</span>
</span><span id="KerykeionChartSVG-483"><a href="#KerykeionChartSVG-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span> <span class="o">=</span> <span class="n">subject_model</span>
</span><span id="KerykeionChartSVG-484"><a href="#KerykeionChartSVG-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_user</span> <span class="o">=</span> <span class="n">second_model</span>
</span><span id="KerykeionChartSVG-485"><a href="#KerykeionChartSVG-485"><span class="linenos">485</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="o">=</span> <span class="n">second_model</span>
</span><span id="KerykeionChartSVG-486"><a href="#KerykeionChartSVG-486"><span class="linenos">486</span></a>
</span><span id="KerykeionChartSVG-487"><a href="#KerykeionChartSVG-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span> <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">)</span>  <span class="c1"># type: ignore[list-item]</span>
</span><span id="KerykeionChartSVG-488"><a href="#KerykeionChartSVG-488"><span class="linenos">488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="n">_normalize_active_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-489"><a href="#KerykeionChartSVG-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="KerykeionChartSVG-490"><a href="#KerykeionChartSVG-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="KerykeionChartSVG-491"><a href="#KerykeionChartSVG-491"><span class="linenos">491</span></a>
</span><span id="KerykeionChartSVG-492"><a href="#KerykeionChartSVG-492"><span class="linenos">492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">new_output_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_output_directory</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-493"><a href="#KerykeionChartSVG-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span>
</span><span id="KerykeionChartSVG-494"><a href="#KerykeionChartSVG-494"><span class="linenos">494</span></a>
</span><span id="KerykeionChartSVG-495"><a href="#KerykeionChartSVG-495"><span class="linenos">495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="KerykeionChartSVG-496"><a href="#KerykeionChartSVG-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG-497"><a href="#KerykeionChartSVG-497"><span class="linenos">497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG-498"><a href="#KerykeionChartSVG-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-499"><a href="#KerykeionChartSVG-499"><span class="linenos">499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG-500"><a href="#KerykeionChartSVG-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="KerykeionChartSVG-501"><a href="#KerykeionChartSVG-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG-502"><a href="#KerykeionChartSVG-502"><span class="linenos">502</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG-503"><a href="#KerykeionChartSVG-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="KerykeionChartSVG-504"><a href="#KerykeionChartSVG-504"><span class="linenos">504</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-505"><a href="#KerykeionChartSVG-505"><span class="linenos">505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-506"><a href="#KerykeionChartSVG-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-507"><a href="#KerykeionChartSVG-507"><span class="linenos">507</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-508"><a href="#KerykeionChartSVG-508"><span class="linenos">508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-509"><a href="#KerykeionChartSVG-509"><span class="linenos">509</span></a>
</span><span id="KerykeionChartSVG-510"><a href="#KerykeionChartSVG-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChartDrawer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-511"><a href="#KerykeionChartSVG-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SingleChartDataModel</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-512"><a href="#KerykeionChartSVG-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_external_view</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KerykeionChartSVG-513"><a href="#KerykeionChartSVG-513"><span class="linenos">513</span></a>
</span><span id="KerykeionChartSVG-514"><a href="#KerykeionChartSVG-514"><span class="linenos">514</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-515"><a href="#KerykeionChartSVG-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-516"><a href="#KerykeionChartSVG-516"><span class="linenos">516</span></a>            <span class="k">return</span>
</span><span id="KerykeionChartSVG-517"><a href="#KerykeionChartSVG-517"><span class="linenos">517</span></a>
</span><span id="KerykeionChartSVG-518"><a href="#KerykeionChartSVG-518"><span class="linenos">518</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-519"><a href="#KerykeionChartSVG-519"><span class="linenos">519</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First object is required to build charts.&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-520"><a href="#KerykeionChartSVG-520"><span class="linenos">520</span></a>
</span><span id="KerykeionChartSVG-521"><a href="#KerykeionChartSVG-521"><span class="linenos">521</span></a>        <span class="n">chart_type_normalized</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-522"><a href="#KerykeionChartSVG-522"><span class="linenos">522</span></a>        <span class="n">active_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span>
</span><span id="KerykeionChartSVG-523"><a href="#KerykeionChartSVG-523"><span class="linenos">523</span></a>        <span class="n">active_aspects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span>
</span><span id="KerykeionChartSVG-524"><a href="#KerykeionChartSVG-524"><span class="linenos">524</span></a>        <span class="n">external_view</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="KerykeionChartSVG-525"><a href="#KerykeionChartSVG-525"><span class="linenos">525</span></a>
</span><span id="KerykeionChartSVG-526"><a href="#KerykeionChartSVG-526"><span class="linenos">526</span></a>        <span class="k">if</span> <span class="n">chart_type_normalized</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;natal&quot;</span><span class="p">,</span> <span class="s2">&quot;birth&quot;</span><span class="p">,</span> <span class="s2">&quot;externalnatal&quot;</span><span class="p">,</span> <span class="s2">&quot;external_natal&quot;</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-527"><a href="#KerykeionChartSVG-527"><span class="linenos">527</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_natal_chart_data</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-528"><a href="#KerykeionChartSVG-528"><span class="linenos">528</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">,</span> <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span> <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span>
</span><span id="KerykeionChartSVG-529"><a href="#KerykeionChartSVG-529"><span class="linenos">529</span></a>            <span class="p">)</span>
</span><span id="KerykeionChartSVG-530"><a href="#KerykeionChartSVG-530"><span class="linenos">530</span></a>            <span class="k">if</span> <span class="n">chart_type_normalized</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;externalnatal&quot;</span><span class="p">,</span> <span class="s2">&quot;external_natal&quot;</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-531"><a href="#KerykeionChartSVG-531"><span class="linenos">531</span></a>                <span class="n">external_view</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="KerykeionChartSVG-532"><a href="#KerykeionChartSVG-532"><span class="linenos">532</span></a>        <span class="k">elif</span> <span class="n">chart_type_normalized</span> <span class="o">==</span> <span class="s2">&quot;synastry&quot;</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-533"><a href="#KerykeionChartSVG-533"><span class="linenos">533</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-534"><a href="#KerykeionChartSVG-534"><span class="linenos">534</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Second object is required for Synastry charts.&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-535"><a href="#KerykeionChartSVG-535"><span class="linenos">535</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-536"><a href="#KerykeionChartSVG-536"><span class="linenos">536</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span>
</span><span id="KerykeionChartSVG-537"><a href="#KerykeionChartSVG-537"><span class="linenos">537</span></a>            <span class="p">):</span>
</span><span id="KerykeionChartSVG-538"><a href="#KerykeionChartSVG-538"><span class="linenos">538</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Synastry charts require two AstrologicalSubject instances.&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-539"><a href="#KerykeionChartSVG-539"><span class="linenos">539</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_synastry_chart_data</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-540"><a href="#KerykeionChartSVG-540"><span class="linenos">540</span></a>                <span class="n">cast</span><span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-541"><a href="#KerykeionChartSVG-541"><span class="linenos">541</span></a>                <span class="n">cast</span><span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-542"><a href="#KerykeionChartSVG-542"><span class="linenos">542</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-543"><a href="#KerykeionChartSVG-543"><span class="linenos">543</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-544"><a href="#KerykeionChartSVG-544"><span class="linenos">544</span></a>            <span class="p">)</span>
</span><span id="KerykeionChartSVG-545"><a href="#KerykeionChartSVG-545"><span class="linenos">545</span></a>        <span class="k">elif</span> <span class="n">chart_type_normalized</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-546"><a href="#KerykeionChartSVG-546"><span class="linenos">546</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-547"><a href="#KerykeionChartSVG-547"><span class="linenos">547</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Second object is required for Transit charts.&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-548"><a href="#KerykeionChartSVG-548"><span class="linenos">548</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-549"><a href="#KerykeionChartSVG-549"><span class="linenos">549</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span>
</span><span id="KerykeionChartSVG-550"><a href="#KerykeionChartSVG-550"><span class="linenos">550</span></a>            <span class="p">):</span>
</span><span id="KerykeionChartSVG-551"><a href="#KerykeionChartSVG-551"><span class="linenos">551</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Transit charts require natal and transit AstrologicalSubject instances.&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-552"><a href="#KerykeionChartSVG-552"><span class="linenos">552</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_transit_chart_data</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-553"><a href="#KerykeionChartSVG-553"><span class="linenos">553</span></a>                <span class="n">cast</span><span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-554"><a href="#KerykeionChartSVG-554"><span class="linenos">554</span></a>                <span class="n">cast</span><span class="p">(</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-555"><a href="#KerykeionChartSVG-555"><span class="linenos">555</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-556"><a href="#KerykeionChartSVG-556"><span class="linenos">556</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-557"><a href="#KerykeionChartSVG-557"><span class="linenos">557</span></a>            <span class="p">)</span>
</span><span id="KerykeionChartSVG-558"><a href="#KerykeionChartSVG-558"><span class="linenos">558</span></a>        <span class="k">elif</span> <span class="n">chart_type_normalized</span> <span class="o">==</span> <span class="s2">&quot;composite&quot;</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-559"><a href="#KerykeionChartSVG-559"><span class="linenos">559</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-560"><a href="#KerykeionChartSVG-560"><span class="linenos">560</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First object must be a CompositeSubjectModel instance for composite charts.&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-561"><a href="#KerykeionChartSVG-561"><span class="linenos">561</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">ChartDataFactory</span><span class="o">.</span><span class="n">create_composite_chart_data</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-562"><a href="#KerykeionChartSVG-562"><span class="linenos">562</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span><span class="p">,</span> <span class="n">active_points</span><span class="o">=</span><span class="n">active_points</span><span class="p">,</span> <span class="n">active_aspects</span><span class="o">=</span><span class="n">active_aspects</span>
</span><span id="KerykeionChartSVG-563"><a href="#KerykeionChartSVG-563"><span class="linenos">563</span></a>            <span class="p">)</span>
</span><span id="KerykeionChartSVG-564"><a href="#KerykeionChartSVG-564"><span class="linenos">564</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-565"><a href="#KerykeionChartSVG-565"><span class="linenos">565</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported or improperly configured chart_type &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-566"><a href="#KerykeionChartSVG-566"><span class="linenos">566</span></a>
</span><span id="KerykeionChartSVG-567"><a href="#KerykeionChartSVG-567"><span class="linenos">567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_external_view</span> <span class="o">=</span> <span class="n">external_view</span>
</span><span id="KerykeionChartSVG-568"><a href="#KerykeionChartSVG-568"><span class="linenos">568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="KerykeionChartSVG-569"><a href="#KerykeionChartSVG-569"><span class="linenos">569</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="KerykeionChartSVG-570"><a href="#KerykeionChartSVG-570"><span class="linenos">570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="o">=</span> <span class="n">ChartDrawer</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-571"><a href="#KerykeionChartSVG-571"><span class="linenos">571</span></a>            <span class="n">chart_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-572"><a href="#KerykeionChartSVG-572"><span class="linenos">572</span></a>            <span class="n">theme</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Optional</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-573"><a href="#KerykeionChartSVG-573"><span class="linenos">573</span></a>            <span class="n">double_chart_aspect_grid_type</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-574"><a href="#KerykeionChartSVG-574"><span class="linenos">574</span></a>            <span class="n">chart_language</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">KerykeionChartLanguage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span><span class="p">),</span>
</span><span id="KerykeionChartSVG-575"><a href="#KerykeionChartSVG-575"><span class="linenos">575</span></a>            <span class="n">language_pack</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-576"><a href="#KerykeionChartSVG-576"><span class="linenos">576</span></a>            <span class="n">external_view</span><span class="o">=</span><span class="n">external_view</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-577"><a href="#KerykeionChartSVG-577"><span class="linenos">577</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG-578"><a href="#KerykeionChartSVG-578"><span class="linenos">578</span></a>
</span><span id="KerykeionChartSVG-579"><a href="#KerykeionChartSVG-579"><span class="linenos">579</span></a>        <span class="c1"># Mirror commonly accessed attributes from legacy class</span>
</span><span id="KerykeionChartSVG-580"><a href="#KerykeionChartSVG-580"><span class="linenos">580</span></a>        <span class="n">drawer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span>
</span><span id="KerykeionChartSVG-581"><a href="#KerykeionChartSVG-581"><span class="linenos">581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;available_planets_setting&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="KerykeionChartSVG-582"><a href="#KerykeionChartSVG-582"><span class="linenos">582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;available_kerykeion_celestial_points&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="KerykeionChartSVG-583"><a href="#KerykeionChartSVG-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;aspects_list&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="KerykeionChartSVG-584"><a href="#KerykeionChartSVG-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;t_available_kerykeion_celestial_points&quot;</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-585"><a href="#KerykeionChartSVG-585"><span class="linenos">585</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;t_available_kerykeion_celestial_points&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-586"><a href="#KerykeionChartSVG-586"><span class="linenos">586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;chart_colors_settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="KerykeionChartSVG-587"><a href="#KerykeionChartSVG-587"><span class="linenos">587</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;planets_settings&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="KerykeionChartSVG-588"><a href="#KerykeionChartSVG-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;aspects_settings&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="KerykeionChartSVG-589"><a href="#KerykeionChartSVG-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_settings</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;language_settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="KerykeionChartSVG-590"><a href="#KerykeionChartSVG-590"><span class="linenos">590</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-591"><a href="#KerykeionChartSVG-591"><span class="linenos">591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-592"><a href="#KerykeionChartSVG-592"><span class="linenos">592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-593"><a href="#KerykeionChartSVG-593"><span class="linenos">593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;geolat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-594"><a href="#KerykeionChartSVG-594"><span class="linenos">594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="s2">&quot;geolon&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-595"><a href="#KerykeionChartSVG-595"><span class="linenos">595</span></a>        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;main_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;first_circle_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;second_circle_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;third_circle_radius&quot;</span><span class="p">]:</span>
</span><span id="KerykeionChartSVG-596"><a href="#KerykeionChartSVG-596"><span class="linenos">596</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</span><span id="KerykeionChartSVG-597"><a href="#KerykeionChartSVG-597"><span class="linenos">597</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drawer</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
</span><span id="KerykeionChartSVG-598"><a href="#KerykeionChartSVG-598"><span class="linenos">598</span></a>
</span><span id="KerykeionChartSVG-599"><a href="#KerykeionChartSVG-599"><span class="linenos">599</span></a>    <span class="c1"># Legacy method names --------------------------------------------------</span>
</span><span id="KerykeionChartSVG-600"><a href="#KerykeionChartSVG-600"><span class="linenos">600</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-601"><a href="#KerykeionChartSVG-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-602"><a href="#KerykeionChartSVG-602"><span class="linenos">602</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-603"><a href="#KerykeionChartSVG-603"><span class="linenos">603</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">generate_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-604"><a href="#KerykeionChartSVG-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG-605"><a href="#KerykeionChartSVG-605"><span class="linenos">605</span></a>        <span class="k">return</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG-606"><a href="#KerykeionChartSVG-606"><span class="linenos">606</span></a>
</span><span id="KerykeionChartSVG-607"><a href="#KerykeionChartSVG-607"><span class="linenos">607</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeSVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-608"><a href="#KerykeionChartSVG-608"><span class="linenos">608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-609"><a href="#KerykeionChartSVG-609"><span class="linenos">609</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-610"><a href="#KerykeionChartSVG-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-611"><a href="#KerykeionChartSVG-611"><span class="linenos">611</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-612"><a href="#KerykeionChartSVG-612"><span class="linenos">612</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-613"><a href="#KerykeionChartSVG-613"><span class="linenos">613</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-614"><a href="#KerykeionChartSVG-614"><span class="linenos">614</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG-615"><a href="#KerykeionChartSVG-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-616"><a href="#KerykeionChartSVG-616"><span class="linenos">616</span></a>
</span><span id="KerykeionChartSVG-617"><a href="#KerykeionChartSVG-617"><span class="linenos">617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeWheelOnlyTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-618"><a href="#KerykeionChartSVG-618"><span class="linenos">618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-619"><a href="#KerykeionChartSVG-619"><span class="linenos">619</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-620"><a href="#KerykeionChartSVG-620"><span class="linenos">620</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">generate_wheel_only_svg_string</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-621"><a href="#KerykeionChartSVG-621"><span class="linenos">621</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-622"><a href="#KerykeionChartSVG-622"><span class="linenos">622</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-623"><a href="#KerykeionChartSVG-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG-624"><a href="#KerykeionChartSVG-624"><span class="linenos">624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG-625"><a href="#KerykeionChartSVG-625"><span class="linenos">625</span></a>        <span class="k">return</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG-626"><a href="#KerykeionChartSVG-626"><span class="linenos">626</span></a>
</span><span id="KerykeionChartSVG-627"><a href="#KerykeionChartSVG-627"><span class="linenos">627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeWheelOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-628"><a href="#KerykeionChartSVG-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-629"><a href="#KerykeionChartSVG-629"><span class="linenos">629</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-630"><a href="#KerykeionChartSVG-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_wheel_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-631"><a href="#KerykeionChartSVG-631"><span class="linenos">631</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-632"><a href="#KerykeionChartSVG-632"><span class="linenos">632</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-633"><a href="#KerykeionChartSVG-633"><span class="linenos">633</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-634"><a href="#KerykeionChartSVG-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG-635"><a href="#KerykeionChartSVG-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-636"><a href="#KerykeionChartSVG-636"><span class="linenos">636</span></a>
</span><span id="KerykeionChartSVG-637"><a href="#KerykeionChartSVG-637"><span class="linenos">637</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeAspectGridOnlyTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-638"><a href="#KerykeionChartSVG-638"><span class="linenos">638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-639"><a href="#KerykeionChartSVG-639"><span class="linenos">639</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-640"><a href="#KerykeionChartSVG-640"><span class="linenos">640</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">generate_aspect_grid_only_svg_string</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-641"><a href="#KerykeionChartSVG-641"><span class="linenos">641</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-642"><a href="#KerykeionChartSVG-642"><span class="linenos">642</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-643"><a href="#KerykeionChartSVG-643"><span class="linenos">643</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG-644"><a href="#KerykeionChartSVG-644"><span class="linenos">644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG-645"><a href="#KerykeionChartSVG-645"><span class="linenos">645</span></a>        <span class="k">return</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG-646"><a href="#KerykeionChartSVG-646"><span class="linenos">646</span></a>
</span><span id="KerykeionChartSVG-647"><a href="#KerykeionChartSVG-647"><span class="linenos">647</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeAspectGridOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG-648"><a href="#KerykeionChartSVG-648"><span class="linenos">648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG-649"><a href="#KerykeionChartSVG-649"><span class="linenos">649</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG-650"><a href="#KerykeionChartSVG-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_aspect_grid_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG-651"><a href="#KerykeionChartSVG-651"><span class="linenos">651</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-652"><a href="#KerykeionChartSVG-652"><span class="linenos">652</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-653"><a href="#KerykeionChartSVG-653"><span class="linenos">653</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG-654"><a href="#KerykeionChartSVG-654"><span class="linenos">654</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG-655"><a href="#KerykeionChartSVG-655"><span class="linenos">655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span><span id="KerykeionChartSVG-656"><a href="#KerykeionChartSVG-656"><span class="linenos">656</span></a>
</span><span id="KerykeionChartSVG-657"><a href="#KerykeionChartSVG-657"><span class="linenos">657</span></a>    <span class="c1"># Aliases for new naming in README next (optional convenience)</span>
</span><span id="KerykeionChartSVG-658"><a href="#KerykeionChartSVG-658"><span class="linenos">658</span></a>    <span class="n">save_svg</span> <span class="o">=</span> <span class="n">makeSVG</span>
</span><span id="KerykeionChartSVG-659"><a href="#KerykeionChartSVG-659"><span class="linenos">659</span></a>    <span class="n">save_wheel_only_svg_file</span> <span class="o">=</span> <span class="n">makeWheelOnlySVG</span>
</span><span id="KerykeionChartSVG-660"><a href="#KerykeionChartSVG-660"><span class="linenos">660</span></a>    <span class="n">save_aspect_grid_only_svg_file</span> <span class="o">=</span> <span class="n">makeAspectGridOnlySVG</span>
</span><span id="KerykeionChartSVG-661"><a href="#KerykeionChartSVG-661"><span class="linenos">661</span></a>    <span class="n">makeGridOnlySVG</span> <span class="o">=</span> <span class="n">makeAspectGridOnlySVG</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper emulating the v4 chart generation interface.</p>

<p>Old usage:
    chart = KerykeionChartSVG(subject, chart_type="ExternalNatal", second_subject)
    chart.makeSVG(minify_svg=True, remove_css_variables=True)</p>

<p>Replaced by ChartDataFactory + ChartDrawer.</p>
</div>


                            <div id="KerykeionChartSVG.__init__" class="classattr">
                                        <input id="KerykeionChartSVG.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">KerykeionChartSVG</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AstrologicalSubject">AstrologicalSubject</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">]</span>,</span><span class="param">	<span class="n">chart_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Natal&#39;</span><span class="p">,</span> <span class="s1">&#39;Synastry&#39;</span><span class="p">,</span> <span class="s1">&#39;Transit&#39;</span><span class="p">,</span> <span class="s1">&#39;Composite&#39;</span><span class="p">,</span> <span class="s1">&#39;DualReturnChart&#39;</span><span class="p">,</span> <span class="s1">&#39;SingleReturnChart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Natal&#39;</span>,</span><span class="param">	<span class="n">second_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AstrologicalSubject">AstrologicalSubject</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">new_output_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">theme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;light&#39;</span><span class="p">,</span> <span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;dark-high-contrast&#39;</span><span class="p">,</span> <span class="s1">&#39;classic&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">,</span> <span class="s1">&#39;black-and-white&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;classic&#39;</span>,</span><span class="param">	<span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span>,</span><span class="param">	<span class="n">chart_language</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;EN&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;PT&#39;</span><span class="p">,</span> <span class="s1">&#39;IT&#39;</span><span class="p">,</span> <span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;ES&#39;</span><span class="p">,</span> <span class="s1">&#39;RU&#39;</span><span class="p">,</span> <span class="s1">&#39;TR&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">,</span> <span class="s1">&#39;HI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;EN&#39;</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="KerykeionChartSVG.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.__init__-434"><a href="#KerykeionChartSVG.__init__-434"><span class="linenos">434</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.__init__-435"><a href="#KerykeionChartSVG.__init__-435"><span class="linenos">435</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-436"><a href="#KerykeionChartSVG.__init__-436"><span class="linenos">436</span></a>        <span class="n">first_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">],</span>
</span><span id="KerykeionChartSVG.__init__-437"><a href="#KerykeionChartSVG.__init__-437"><span class="linenos">437</span></a>        <span class="n">chart_type</span><span class="p">:</span> <span class="n">ChartType</span> <span class="o">=</span> <span class="s2">&quot;Natal&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-438"><a href="#KerykeionChartSVG.__init__-438"><span class="linenos">438</span></a>        <span class="n">second_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-439"><a href="#KerykeionChartSVG.__init__-439"><span class="linenos">439</span></a>        <span class="n">new_output_directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-440"><a href="#KerykeionChartSVG.__init__-440"><span class="linenos">440</span></a>        <span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># retained for signature compatibility (unused)</span>
</span><span id="KerykeionChartSVG.__init__-441"><a href="#KerykeionChartSVG.__init__-441"><span class="linenos">441</span></a>        <span class="n">theme</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">KerykeionChartTheme</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;classic&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-442"><a href="#KerykeionChartSVG.__init__-442"><span class="linenos">442</span></a>        <span class="n">double_chart_aspect_grid_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;list&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-443"><a href="#KerykeionChartSVG.__init__-443"><span class="linenos">443</span></a>        <span class="n">chart_language</span><span class="p">:</span> <span class="n">KerykeionChartLanguage</span> <span class="o">=</span> <span class="s2">&quot;EN&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-444"><a href="#KerykeionChartSVG.__init__-444"><span class="linenos">444</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstrologicalPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="KerykeionChartSVG.__init__-445"><a href="#KerykeionChartSVG.__init__-445"><span class="linenos">445</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-446"><a href="#KerykeionChartSVG.__init__-446"><span class="linenos">446</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-447"><a href="#KerykeionChartSVG.__init__-447"><span class="linenos">447</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-448"><a href="#KerykeionChartSVG.__init__-448"><span class="linenos">448</span></a>
</span><span id="KerykeionChartSVG.__init__-449"><a href="#KerykeionChartSVG.__init__-449"><span class="linenos">449</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.__init__-450"><a href="#KerykeionChartSVG.__init__-450"><span class="linenos">450</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;KerykeionChartSVG&quot;</span><span class="p">,</span> <span class="s2">&quot;ChartDataFactory + ChartDrawer&quot;</span><span class="p">)</span>
</span><span id="KerykeionChartSVG.__init__-451"><a href="#KerykeionChartSVG.__init__-451"><span class="linenos">451</span></a>
</span><span id="KerykeionChartSVG.__init__-452"><a href="#KerykeionChartSVG.__init__-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="n">new_settings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.__init__-453"><a href="#KerykeionChartSVG.__init__-453"><span class="linenos">453</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.__init__-454"><a href="#KerykeionChartSVG.__init__-454"><span class="linenos">454</span></a>                <span class="s2">&quot;&#39;new_settings_file&#39; is deprecated and ignored in Kerykeion v5. Use language_pack instead.&quot;</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-455"><a href="#KerykeionChartSVG.__init__-455"><span class="linenos">455</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-456"><a href="#KerykeionChartSVG.__init__-456"><span class="linenos">456</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.__init__-457"><a href="#KerykeionChartSVG.__init__-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="KerykeionChartSVG.__init__-458"><a href="#KerykeionChartSVG.__init__-458"><span class="linenos">458</span></a>
</span><span id="KerykeionChartSVG.__init__-459"><a href="#KerykeionChartSVG.__init__-459"><span class="linenos">459</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_obj</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">):</span>
</span><span id="KerykeionChartSVG.__init__-460"><a href="#KerykeionChartSVG.__init__-460"><span class="linenos">460</span></a>            <span class="n">subject_model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_obj</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.__init__-461"><a href="#KerykeionChartSVG.__init__-461"><span class="linenos">461</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.__init__-462"><a href="#KerykeionChartSVG.__init__-462"><span class="linenos">462</span></a>            <span class="n">subject_model</span> <span class="o">=</span> <span class="n">first_obj</span>
</span><span id="KerykeionChartSVG.__init__-463"><a href="#KerykeionChartSVG.__init__-463"><span class="linenos">463</span></a>
</span><span id="KerykeionChartSVG.__init__-464"><a href="#KerykeionChartSVG.__init__-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_obj</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">):</span>
</span><span id="KerykeionChartSVG.__init__-465"><a href="#KerykeionChartSVG.__init__-465"><span class="linenos">465</span></a>            <span class="n">second_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">]]</span> <span class="o">=</span> <span class="n">second_obj</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.__init__-466"><a href="#KerykeionChartSVG.__init__-466"><span class="linenos">466</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.__init__-467"><a href="#KerykeionChartSVG.__init__-467"><span class="linenos">467</span></a>            <span class="n">second_model</span> <span class="o">=</span> <span class="n">second_obj</span>
</span><span id="KerykeionChartSVG.__init__-468"><a href="#KerykeionChartSVG.__init__-468"><span class="linenos">468</span></a>
</span><span id="KerykeionChartSVG.__init__-469"><a href="#KerykeionChartSVG.__init__-469"><span class="linenos">469</span></a>        <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.__init__-470"><a href="#KerykeionChartSVG.__init__-470"><span class="linenos">470</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">)</span>
</span><span id="KerykeionChartSVG.__init__-471"><a href="#KerykeionChartSVG.__init__-471"><span class="linenos">471</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.__init__-472"><a href="#KerykeionChartSVG.__init__-472"><span class="linenos">472</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_aspects</span><span class="p">)</span>
</span><span id="KerykeionChartSVG.__init__-473"><a href="#KerykeionChartSVG.__init__-473"><span class="linenos">473</span></a>
</span><span id="KerykeionChartSVG.__init__-474"><a href="#KerykeionChartSVG.__init__-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_type</span> <span class="o">=</span> <span class="n">chart_type</span>
</span><span id="KerykeionChartSVG.__init__-475"><a href="#KerykeionChartSVG.__init__-475"><span class="linenos">475</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span> <span class="o">=</span> <span class="n">language_pack</span>
</span><span id="KerykeionChartSVG.__init__-476"><a href="#KerykeionChartSVG.__init__-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theme</span> <span class="o">=</span> <span class="n">theme</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="KerykeionChartSVG.__init__-477"><a href="#KerykeionChartSVG.__init__-477"><span class="linenos">477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">double_chart_aspect_grid_type</span> <span class="o">=</span> <span class="n">double_chart_aspect_grid_type</span>
</span><span id="KerykeionChartSVG.__init__-478"><a href="#KerykeionChartSVG.__init__-478"><span class="linenos">478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_language</span> <span class="o">=</span> <span class="n">chart_language</span>  <span class="c1"># type: ignore[assignment]</span>
</span><span id="KerykeionChartSVG.__init__-479"><a href="#KerykeionChartSVG.__init__-479"><span class="linenos">479</span></a>
</span><span id="KerykeionChartSVG.__init__-480"><a href="#KerykeionChartSVG.__init__-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_subject_model</span> <span class="o">=</span> <span class="n">subject_model</span>
</span><span id="KerykeionChartSVG.__init__-481"><a href="#KerykeionChartSVG.__init__-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_second_model</span> <span class="o">=</span> <span class="n">second_model</span>
</span><span id="KerykeionChartSVG.__init__-482"><a href="#KerykeionChartSVG.__init__-482"><span class="linenos">482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">subject_model</span>
</span><span id="KerykeionChartSVG.__init__-483"><a href="#KerykeionChartSVG.__init__-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_obj</span> <span class="o">=</span> <span class="n">subject_model</span>
</span><span id="KerykeionChartSVG.__init__-484"><a href="#KerykeionChartSVG.__init__-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_user</span> <span class="o">=</span> <span class="n">second_model</span>
</span><span id="KerykeionChartSVG.__init__-485"><a href="#KerykeionChartSVG.__init__-485"><span class="linenos">485</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_obj</span> <span class="o">=</span> <span class="n">second_model</span>
</span><span id="KerykeionChartSVG.__init__-486"><a href="#KerykeionChartSVG.__init__-486"><span class="linenos">486</span></a>
</span><span id="KerykeionChartSVG.__init__-487"><a href="#KerykeionChartSVG.__init__-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span> <span class="k">if</span> <span class="n">active_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">)</span>  <span class="c1"># type: ignore[list-item]</span>
</span><span id="KerykeionChartSVG.__init__-488"><a href="#KerykeionChartSVG.__init__-488"><span class="linenos">488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="n">_normalize_active_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="KerykeionChartSVG.__init__-489"><a href="#KerykeionChartSVG.__init__-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="KerykeionChartSVG.__init__-490"><a href="#KerykeionChartSVG.__init__-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="KerykeionChartSVG.__init__-491"><a href="#KerykeionChartSVG.__init__-491"><span class="linenos">491</span></a>
</span><span id="KerykeionChartSVG.__init__-492"><a href="#KerykeionChartSVG.__init__-492"><span class="linenos">492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">new_output_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_output_directory</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.__init__-493"><a href="#KerykeionChartSVG.__init__-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_output_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span>
</span><span id="KerykeionChartSVG.__init__-494"><a href="#KerykeionChartSVG.__init__-494"><span class="linenos">494</span></a>
</span><span id="KerykeionChartSVG.__init__-495"><a href="#KerykeionChartSVG.__init__-495"><span class="linenos">495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="KerykeionChartSVG.__init__-496"><a href="#KerykeionChartSVG.__init__-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG.__init__-497"><a href="#KerykeionChartSVG.__init__-497"><span class="linenos">497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_planets_setting</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG.__init__-498"><a href="#KerykeionChartSVG.__init__-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">t_available_kerykeion_celestial_points</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-499"><a href="#KerykeionChartSVG.__init__-499"><span class="linenos">499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">available_kerykeion_celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG.__init__-500"><a href="#KerykeionChartSVG.__init__-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chart_colors_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="KerykeionChartSVG.__init__-501"><a href="#KerykeionChartSVG.__init__-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">planets_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG.__init__-502"><a href="#KerykeionChartSVG.__init__-502"><span class="linenos">502</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="KerykeionChartSVG.__init__-503"><a href="#KerykeionChartSVG.__init__-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="KerykeionChartSVG.__init__-504"><a href="#KerykeionChartSVG.__init__-504"><span class="linenos">504</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-505"><a href="#KerykeionChartSVG.__init__-505"><span class="linenos">505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-506"><a href="#KerykeionChartSVG.__init__-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-507"><a href="#KerykeionChartSVG.__init__-507"><span class="linenos">507</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geolat</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-508"><a href="#KerykeionChartSVG.__init__-508"><span class="linenos">508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geolon</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-509"><a href="#KerykeionChartSVG.__init__-509"><span class="linenos">509</span></a>
</span><span id="KerykeionChartSVG.__init__-510"><a href="#KerykeionChartSVG.__init__-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChartDrawer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-511"><a href="#KerykeionChartSVG.__init__-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">SingleChartDataModel</span><span class="p">,</span> <span class="n">DualChartDataModel</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.__init__-512"><a href="#KerykeionChartSVG.__init__-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_external_view</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.chart_type" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_type</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.chart_type"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.language_pack" class="classattr">
                                <div class="attr variable">
            <span class="name">language_pack</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.language_pack"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.theme" class="classattr">
                                <div class="attr variable">
            <span class="name">theme</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.theme"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.double_chart_aspect_grid_type" class="classattr">
                                <div class="attr variable">
            <span class="name">double_chart_aspect_grid_type</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.double_chart_aspect_grid_type"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.chart_language" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_language</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.chart_language"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.user" class="classattr">
                                <div class="attr variable">
            <span class="name">user</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.user"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.first_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">first_obj</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.first_obj"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.t_user" class="classattr">
                                <div class="attr variable">
            <span class="name">t_user</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.t_user"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.second_obj" class="classattr">
                                <div class="attr variable">
            <span class="name">second_obj</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.second_obj"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.active_points"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.active_aspects"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.output_directory" class="classattr">
                                <div class="attr variable">
            <span class="name">output_directory</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.output_directory"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.template" class="classattr">
                                <div class="attr variable">
            <span class="name">template</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.template"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.aspects_list" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects_list</span><span class="annotation">: list[dict[str, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.aspects_list"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.available_planets_setting" class="classattr">
                                <div class="attr variable">
            <span class="name">available_planets_setting</span><span class="annotation">: list[dict[str, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.available_planets_setting"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.t_available_kerykeion_celestial_points" class="classattr">
                                <div class="attr variable">
            <span class="name">t_available_kerykeion_celestial_points</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.t_available_kerykeion_celestial_points"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.available_kerykeion_celestial_points" class="classattr">
                                <div class="attr variable">
            <span class="name">available_kerykeion_celestial_points</span><span class="annotation">: list[dict[str, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.available_kerykeion_celestial_points"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.chart_colors_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">chart_colors_settings</span><span class="annotation">: dict[str, typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.chart_colors_settings"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.planets_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">planets_settings</span><span class="annotation">: list[dict[str, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.planets_settings"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.aspects_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects_settings</span><span class="annotation">: list[dict[str, typing.Any]]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.aspects_settings"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.language_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">language_settings</span><span class="annotation">: dict[str, typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.language_settings"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.height" class="classattr">
                                <div class="attr variable">
            <span class="name">height</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.height"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.width" class="classattr">
                                <div class="attr variable">
            <span class="name">width</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.width"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.location" class="classattr">
                                <div class="attr variable">
            <span class="name">location</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.location"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.geolat" class="classattr">
                                <div class="attr variable">
            <span class="name">geolat</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.geolat"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.geolon" class="classattr">
                                <div class="attr variable">
            <span class="name">geolon</span>

        
    </div>
    <a class="headerlink" href="#KerykeionChartSVG.geolon"></a>
    
    

                            </div>
                            <div id="KerykeionChartSVG.makeTemplate" class="classattr">
                                        <input id="KerykeionChartSVG.makeTemplate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeTemplate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeTemplate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeTemplate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeTemplate-600"><a href="#KerykeionChartSVG.makeTemplate-600"><span class="linenos">600</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeTemplate-601"><a href="#KerykeionChartSVG.makeTemplate-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeTemplate-602"><a href="#KerykeionChartSVG.makeTemplate-602"><span class="linenos">602</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeTemplate-603"><a href="#KerykeionChartSVG.makeTemplate-603"><span class="linenos">603</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">generate_svg_string</span><span class="p">(</span><span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">)</span>
</span><span id="KerykeionChartSVG.makeTemplate-604"><a href="#KerykeionChartSVG.makeTemplate-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG.makeTemplate-605"><a href="#KerykeionChartSVG.makeTemplate-605"><span class="linenos">605</span></a>        <span class="k">return</span> <span class="n">template</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.makeSVG" class="classattr">
                                        <input id="KerykeionChartSVG.makeSVG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeSVG</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeSVG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeSVG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeSVG-607"><a href="#KerykeionChartSVG.makeSVG-607"><span class="linenos">607</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeSVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeSVG-608"><a href="#KerykeionChartSVG.makeSVG-608"><span class="linenos">608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeSVG-609"><a href="#KerykeionChartSVG.makeSVG-609"><span class="linenos">609</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeSVG-610"><a href="#KerykeionChartSVG.makeSVG-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.makeSVG-611"><a href="#KerykeionChartSVG.makeSVG-611"><span class="linenos">611</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeSVG-612"><a href="#KerykeionChartSVG.makeSVG-612"><span class="linenos">612</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeSVG-613"><a href="#KerykeionChartSVG.makeSVG-613"><span class="linenos">613</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeSVG-614"><a href="#KerykeionChartSVG.makeSVG-614"><span class="linenos">614</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.makeSVG-615"><a href="#KerykeionChartSVG.makeSVG-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.makeWheelOnlyTemplate" class="classattr">
                                        <input id="KerykeionChartSVG.makeWheelOnlyTemplate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeWheelOnlyTemplate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeWheelOnlyTemplate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeWheelOnlyTemplate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-617"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-617"><span class="linenos">617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeWheelOnlyTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-618"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-618"><span class="linenos">618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-619"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-619"><span class="linenos">619</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-620"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-620"><span class="linenos">620</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">generate_wheel_only_svg_string</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-621"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-621"><span class="linenos">621</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-622"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-622"><span class="linenos">622</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-623"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-624"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-624"><span class="linenos">624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG.makeWheelOnlyTemplate-625"><a href="#KerykeionChartSVG.makeWheelOnlyTemplate-625"><span class="linenos">625</span></a>        <span class="k">return</span> <span class="n">template</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.makeWheelOnlySVG" class="classattr">
                                        <input id="KerykeionChartSVG.makeWheelOnlySVG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeWheelOnlySVG</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeWheelOnlySVG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeWheelOnlySVG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeWheelOnlySVG-627"><a href="#KerykeionChartSVG.makeWheelOnlySVG-627"><span class="linenos">627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeWheelOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-628"><a href="#KerykeionChartSVG.makeWheelOnlySVG-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-629"><a href="#KerykeionChartSVG.makeWheelOnlySVG-629"><span class="linenos">629</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-630"><a href="#KerykeionChartSVG.makeWheelOnlySVG-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_wheel_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-631"><a href="#KerykeionChartSVG.makeWheelOnlySVG-631"><span class="linenos">631</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-632"><a href="#KerykeionChartSVG.makeWheelOnlySVG-632"><span class="linenos">632</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-633"><a href="#KerykeionChartSVG.makeWheelOnlySVG-633"><span class="linenos">633</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-634"><a href="#KerykeionChartSVG.makeWheelOnlySVG-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.makeWheelOnlySVG-635"><a href="#KerykeionChartSVG.makeWheelOnlySVG-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.makeAspectGridOnlyTemplate" class="classattr">
                                        <input id="KerykeionChartSVG.makeAspectGridOnlyTemplate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeAspectGridOnlyTemplate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeAspectGridOnlyTemplate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeAspectGridOnlyTemplate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-637"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-637"><span class="linenos">637</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeAspectGridOnlyTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-638"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-638"><span class="linenos">638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-639"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-639"><span class="linenos">639</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-640"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-640"><span class="linenos">640</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">generate_aspect_grid_only_svg_string</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-641"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-641"><span class="linenos">641</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-642"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-642"><span class="linenos">642</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-643"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-643"><span class="linenos">643</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-644"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-644"><span class="linenos">644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlyTemplate-645"><a href="#KerykeionChartSVG.makeAspectGridOnlyTemplate-645"><span class="linenos">645</span></a>        <span class="k">return</span> <span class="n">template</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.makeAspectGridOnlySVG" class="classattr">
                                        <input id="KerykeionChartSVG.makeAspectGridOnlySVG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeAspectGridOnlySVG</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeAspectGridOnlySVG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeAspectGridOnlySVG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-647"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-647"><span class="linenos">647</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeAspectGridOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-648"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-648"><span class="linenos">648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-649"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-649"><span class="linenos">649</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-650"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_aspect_grid_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-651"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-651"><span class="linenos">651</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-652"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-652"><span class="linenos">652</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-653"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-653"><span class="linenos">653</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-654"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-654"><span class="linenos">654</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.makeAspectGridOnlySVG-655"><a href="#KerykeionChartSVG.makeAspectGridOnlySVG-655"><span class="linenos">655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.save_svg" class="classattr">
                                        <input id="KerykeionChartSVG.save_svg-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_svg</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.save_svg-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.save_svg"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.save_svg-607"><a href="#KerykeionChartSVG.save_svg-607"><span class="linenos">607</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeSVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.save_svg-608"><a href="#KerykeionChartSVG.save_svg-608"><span class="linenos">608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.save_svg-609"><a href="#KerykeionChartSVG.save_svg-609"><span class="linenos">609</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.save_svg-610"><a href="#KerykeionChartSVG.save_svg-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_svg</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.save_svg-611"><a href="#KerykeionChartSVG.save_svg-611"><span class="linenos">611</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_svg-612"><a href="#KerykeionChartSVG.save_svg-612"><span class="linenos">612</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_svg-613"><a href="#KerykeionChartSVG.save_svg-613"><span class="linenos">613</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_svg-614"><a href="#KerykeionChartSVG.save_svg-614"><span class="linenos">614</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.save_svg-615"><a href="#KerykeionChartSVG.save_svg-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.save_wheel_only_svg_file" class="classattr">
                                        <input id="KerykeionChartSVG.save_wheel_only_svg_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_wheel_only_svg_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.save_wheel_only_svg_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.save_wheel_only_svg_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.save_wheel_only_svg_file-627"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-627"><span class="linenos">627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeWheelOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-628"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-629"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-629"><span class="linenos">629</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-630"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_wheel_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-631"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-631"><span class="linenos">631</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-632"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-632"><span class="linenos">632</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-633"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-633"><span class="linenos">633</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-634"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.save_wheel_only_svg_file-635"><a href="#KerykeionChartSVG.save_wheel_only_svg_file-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.save_aspect_grid_only_svg_file" class="classattr">
                                        <input id="KerykeionChartSVG.save_aspect_grid_only_svg_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_aspect_grid_only_svg_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.save_aspect_grid_only_svg_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.save_aspect_grid_only_svg_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-647"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-647"><span class="linenos">647</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeAspectGridOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-648"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-648"><span class="linenos">648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-649"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-649"><span class="linenos">649</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-650"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_aspect_grid_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-651"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-651"><span class="linenos">651</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-652"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-652"><span class="linenos">652</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-653"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-653"><span class="linenos">653</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-654"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-654"><span class="linenos">654</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.save_aspect_grid_only_svg_file-655"><a href="#KerykeionChartSVG.save_aspect_grid_only_svg_file-655"><span class="linenos">655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="KerykeionChartSVG.makeGridOnlySVG" class="classattr">
                                        <input id="KerykeionChartSVG.makeGridOnlySVG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeGridOnlySVG</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="KerykeionChartSVG.makeGridOnlySVG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KerykeionChartSVG.makeGridOnlySVG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KerykeionChartSVG.makeGridOnlySVG-647"><a href="#KerykeionChartSVG.makeGridOnlySVG-647"><span class="linenos">647</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeAspectGridOnlySVG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">remove_css_variables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-648"><a href="#KerykeionChartSVG.makeGridOnlySVG-648"><span class="linenos">648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_chart</span><span class="p">()</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-649"><a href="#KerykeionChartSVG.makeGridOnlySVG-649"><span class="linenos">649</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-650"><a href="#KerykeionChartSVG.makeGridOnlySVG-650"><span class="linenos">650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="o">.</span><span class="n">save_aspect_grid_only_svg_file</span><span class="p">(</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-651"><a href="#KerykeionChartSVG.makeGridOnlySVG-651"><span class="linenos">651</span></a>            <span class="n">output_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-652"><a href="#KerykeionChartSVG.makeGridOnlySVG-652"><span class="linenos">652</span></a>            <span class="n">minify</span><span class="o">=</span><span class="n">minify</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-653"><a href="#KerykeionChartSVG.makeGridOnlySVG-653"><span class="linenos">653</span></a>            <span class="n">remove_css_variables</span><span class="o">=</span><span class="n">remove_css_variables</span><span class="p">,</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-654"><a href="#KerykeionChartSVG.makeGridOnlySVG-654"><span class="linenos">654</span></a>        <span class="p">)</span>
</span><span id="KerykeionChartSVG.makeGridOnlySVG-655"><a href="#KerykeionChartSVG.makeGridOnlySVG-655"><span class="linenos">655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chart_drawer</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="NatalAspects">
                            <input id="NatalAspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NatalAspects</span>:

                <label class="view-source-button" for="NatalAspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NatalAspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NatalAspects-666"><a href="#NatalAspects-666"><span class="linenos">666</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NatalAspects</span><span class="p">:</span>
</span><span id="NatalAspects-667"><a href="#NatalAspects-667"><span class="linenos">667</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper replicating the master branch NatalAspects interface.</span>
</span><span id="NatalAspects-668"><a href="#NatalAspects-668"><span class="linenos">668</span></a>
</span><span id="NatalAspects-669"><a href="#NatalAspects-669"><span class="linenos">669</span></a><span class="sd">    Replacement: AspectsFactory.single_subject_aspects(subject)</span>
</span><span id="NatalAspects-670"><a href="#NatalAspects-670"><span class="linenos">670</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NatalAspects-671"><a href="#NatalAspects-671"><span class="linenos">671</span></a>
</span><span id="NatalAspects-672"><a href="#NatalAspects-672"><span class="linenos">672</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="NatalAspects-673"><a href="#NatalAspects-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NatalAspects-674"><a href="#NatalAspects-674"><span class="linenos">674</span></a>        <span class="n">user</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">],</span>
</span><span id="NatalAspects-675"><a href="#NatalAspects-675"><span class="linenos">675</span></a>        <span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects-676"><a href="#NatalAspects-676"><span class="linenos">676</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="NatalAspects-677"><a href="#NatalAspects-677"><span class="linenos">677</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects-678"><a href="#NatalAspects-678"><span class="linenos">678</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="NatalAspects-679"><a href="#NatalAspects-679"><span class="linenos">679</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects-680"><a href="#NatalAspects-680"><span class="linenos">680</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects-681"><a href="#NatalAspects-681"><span class="linenos">681</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects-682"><a href="#NatalAspects-682"><span class="linenos">682</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;NatalAspects&quot;</span><span class="p">,</span> <span class="s2">&quot;AspectsFactory.single_chart_aspects&quot;</span><span class="p">)</span>
</span><span id="NatalAspects-683"><a href="#NatalAspects-683"><span class="linenos">683</span></a>
</span><span id="NatalAspects-684"><a href="#NatalAspects-684"><span class="linenos">684</span></a>        <span class="k">if</span> <span class="n">new_settings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects-685"><a href="#NatalAspects-685"><span class="linenos">685</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="NatalAspects-686"><a href="#NatalAspects-686"><span class="linenos">686</span></a>                <span class="s2">&quot;&#39;new_settings_file&#39; is deprecated and ignored in Kerykeion v5. Use language_pack instead.&quot;</span><span class="p">,</span>
</span><span id="NatalAspects-687"><a href="#NatalAspects-687"><span class="linenos">687</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="NatalAspects-688"><a href="#NatalAspects-688"><span class="linenos">688</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="NatalAspects-689"><a href="#NatalAspects-689"><span class="linenos">689</span></a>            <span class="p">)</span>
</span><span id="NatalAspects-690"><a href="#NatalAspects-690"><span class="linenos">690</span></a>
</span><span id="NatalAspects-691"><a href="#NatalAspects-691"><span class="linenos">691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">model</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">)</span> <span class="k">else</span> <span class="n">user</span>
</span><span id="NatalAspects-692"><a href="#NatalAspects-692"><span class="linenos">692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">new_settings_file</span> <span class="o">=</span> <span class="n">new_settings_file</span>
</span><span id="NatalAspects-693"><a href="#NatalAspects-693"><span class="linenos">693</span></a>
</span><span id="NatalAspects-694"><a href="#NatalAspects-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span> <span class="o">=</span> <span class="n">language_pack</span>
</span><span id="NatalAspects-695"><a href="#NatalAspects-695"><span class="linenos">695</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NatalAspects-696"><a href="#NatalAspects-696"><span class="linenos">696</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NatalAspects-697"><a href="#NatalAspects-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axes_orbit_settings</span> <span class="o">=</span> <span class="n">axis_orb_limit</span>
</span><span id="NatalAspects-698"><a href="#NatalAspects-698"><span class="linenos">698</span></a>
</span><span id="NatalAspects-699"><a href="#NatalAspects-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="NatalAspects-700"><a href="#NatalAspects-700"><span class="linenos">700</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="n">_normalize_active_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="NatalAspects-701"><a href="#NatalAspects-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects-702"><a href="#NatalAspects-702"><span class="linenos">702</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">)</span>
</span><span id="NatalAspects-703"><a href="#NatalAspects-703"><span class="linenos">703</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NatalAspects-704"><a href="#NatalAspects-704"><span class="linenos">704</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_aspects</span><span class="p">)</span>
</span><span id="NatalAspects-705"><a href="#NatalAspects-705"><span class="linenos">705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="NatalAspects-706"><a href="#NatalAspects-706"><span class="linenos">706</span></a>
</span><span id="NatalAspects-707"><a href="#NatalAspects-707"><span class="linenos">707</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_aspects_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NatalAspects-708"><a href="#NatalAspects-708"><span class="linenos">708</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NatalAspects-709"><a href="#NatalAspects-709"><span class="linenos">709</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NatalAspects-710"><a href="#NatalAspects-710"><span class="linenos">710</span></a>
</span><span id="NatalAspects-711"><a href="#NatalAspects-711"><span class="linenos">711</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_aspects_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NatalAspects-712"><a href="#NatalAspects-712"><span class="linenos">712</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aspects_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects-713"><a href="#NatalAspects-713"><span class="linenos">713</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aspects_model</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">single_chart_aspects</span><span class="p">(</span>
</span><span id="NatalAspects-714"><a href="#NatalAspects-714"><span class="linenos">714</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="NatalAspects-715"><a href="#NatalAspects-715"><span class="linenos">715</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span><span class="p">,</span>
</span><span id="NatalAspects-716"><a href="#NatalAspects-716"><span class="linenos">716</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="NatalAspects-717"><a href="#NatalAspects-717"><span class="linenos">717</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_orbit_settings</span><span class="p">,</span>
</span><span id="NatalAspects-718"><a href="#NatalAspects-718"><span class="linenos">718</span></a>            <span class="p">)</span>
</span><span id="NatalAspects-719"><a href="#NatalAspects-719"><span class="linenos">719</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aspects_model</span>
</span><span id="NatalAspects-720"><a href="#NatalAspects-720"><span class="linenos">720</span></a>
</span><span id="NatalAspects-721"><a href="#NatalAspects-721"><span class="linenos">721</span></a>    <span class="nd">@cached_property</span>
</span><span id="NatalAspects-722"><a href="#NatalAspects-722"><span class="linenos">722</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">all_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NatalAspects-723"><a href="#NatalAspects-723"><span class="linenos">723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="NatalAspects-724"><a href="#NatalAspects-724"><span class="linenos">724</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects-725"><a href="#NatalAspects-725"><span class="linenos">725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_aspects_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="NatalAspects-726"><a href="#NatalAspects-726"><span class="linenos">726</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span>
</span><span id="NatalAspects-727"><a href="#NatalAspects-727"><span class="linenos">727</span></a>
</span><span id="NatalAspects-728"><a href="#NatalAspects-728"><span class="linenos">728</span></a>    <span class="nd">@cached_property</span>
</span><span id="NatalAspects-729"><a href="#NatalAspects-729"><span class="linenos">729</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relevant_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NatalAspects-730"><a href="#NatalAspects-730"><span class="linenos">730</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="NatalAspects-731"><a href="#NatalAspects-731"><span class="linenos">731</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects-732"><a href="#NatalAspects-732"><span class="linenos">732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_aspects_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="NatalAspects-733"><a href="#NatalAspects-733"><span class="linenos">733</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper replicating the master branch NatalAspects interface.</p>

<p>Replacement: AspectsFactory.single_subject_aspects(subject)</p>
</div>


                            <div id="NatalAspects.__init__" class="classattr">
                                        <input id="NatalAspects.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">NatalAspects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">user</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AstrologicalSubject">AstrologicalSubject</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">CompositeSubjectModel</span><span class="p">]</span>,</span><span class="param">	<span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="NatalAspects.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NatalAspects.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NatalAspects.__init__-672"><a href="#NatalAspects.__init__-672"><span class="linenos">672</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="NatalAspects.__init__-673"><a href="#NatalAspects.__init__-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-674"><a href="#NatalAspects.__init__-674"><span class="linenos">674</span></a>        <span class="n">user</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">,</span> <span class="n">CompositeSubjectModel</span><span class="p">],</span>
</span><span id="NatalAspects.__init__-675"><a href="#NatalAspects.__init__-675"><span class="linenos">675</span></a>        <span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-676"><a href="#NatalAspects.__init__-676"><span class="linenos">676</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-677"><a href="#NatalAspects.__init__-677"><span class="linenos">677</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-678"><a href="#NatalAspects.__init__-678"><span class="linenos">678</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-679"><a href="#NatalAspects.__init__-679"><span class="linenos">679</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-680"><a href="#NatalAspects.__init__-680"><span class="linenos">680</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-681"><a href="#NatalAspects.__init__-681"><span class="linenos">681</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects.__init__-682"><a href="#NatalAspects.__init__-682"><span class="linenos">682</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;NatalAspects&quot;</span><span class="p">,</span> <span class="s2">&quot;AspectsFactory.single_chart_aspects&quot;</span><span class="p">)</span>
</span><span id="NatalAspects.__init__-683"><a href="#NatalAspects.__init__-683"><span class="linenos">683</span></a>
</span><span id="NatalAspects.__init__-684"><a href="#NatalAspects.__init__-684"><span class="linenos">684</span></a>        <span class="k">if</span> <span class="n">new_settings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects.__init__-685"><a href="#NatalAspects.__init__-685"><span class="linenos">685</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="NatalAspects.__init__-686"><a href="#NatalAspects.__init__-686"><span class="linenos">686</span></a>                <span class="s2">&quot;&#39;new_settings_file&#39; is deprecated and ignored in Kerykeion v5. Use language_pack instead.&quot;</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-687"><a href="#NatalAspects.__init__-687"><span class="linenos">687</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-688"><a href="#NatalAspects.__init__-688"><span class="linenos">688</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="NatalAspects.__init__-689"><a href="#NatalAspects.__init__-689"><span class="linenos">689</span></a>            <span class="p">)</span>
</span><span id="NatalAspects.__init__-690"><a href="#NatalAspects.__init__-690"><span class="linenos">690</span></a>
</span><span id="NatalAspects.__init__-691"><a href="#NatalAspects.__init__-691"><span class="linenos">691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">model</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">)</span> <span class="k">else</span> <span class="n">user</span>
</span><span id="NatalAspects.__init__-692"><a href="#NatalAspects.__init__-692"><span class="linenos">692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">new_settings_file</span> <span class="o">=</span> <span class="n">new_settings_file</span>
</span><span id="NatalAspects.__init__-693"><a href="#NatalAspects.__init__-693"><span class="linenos">693</span></a>
</span><span id="NatalAspects.__init__-694"><a href="#NatalAspects.__init__-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span> <span class="o">=</span> <span class="n">language_pack</span>
</span><span id="NatalAspects.__init__-695"><a href="#NatalAspects.__init__-695"><span class="linenos">695</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NatalAspects.__init__-696"><a href="#NatalAspects.__init__-696"><span class="linenos">696</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NatalAspects.__init__-697"><a href="#NatalAspects.__init__-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axes_orbit_settings</span> <span class="o">=</span> <span class="n">axis_orb_limit</span>
</span><span id="NatalAspects.__init__-698"><a href="#NatalAspects.__init__-698"><span class="linenos">698</span></a>
</span><span id="NatalAspects.__init__-699"><a href="#NatalAspects.__init__-699"><span class="linenos">699</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="NatalAspects.__init__-700"><a href="#NatalAspects.__init__-700"><span class="linenos">700</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="n">_normalize_active_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="NatalAspects.__init__-701"><a href="#NatalAspects.__init__-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects.__init__-702"><a href="#NatalAspects.__init__-702"><span class="linenos">702</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">)</span>
</span><span id="NatalAspects.__init__-703"><a href="#NatalAspects.__init__-703"><span class="linenos">703</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NatalAspects.__init__-704"><a href="#NatalAspects.__init__-704"><span class="linenos">704</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_aspects</span><span class="p">)</span>
</span><span id="NatalAspects.__init__-705"><a href="#NatalAspects.__init__-705"><span class="linenos">705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="NatalAspects.__init__-706"><a href="#NatalAspects.__init__-706"><span class="linenos">706</span></a>
</span><span id="NatalAspects.__init__-707"><a href="#NatalAspects.__init__-707"><span class="linenos">707</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_aspects_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NatalAspects.__init__-708"><a href="#NatalAspects.__init__-708"><span class="linenos">708</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NatalAspects.__init__-709"><a href="#NatalAspects.__init__-709"><span class="linenos">709</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="NatalAspects.user" class="classattr">
                                <div class="attr variable">
            <span class="name">user</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.user"></a>
    
    

                            </div>
                            <div id="NatalAspects.new_settings_file" class="classattr">
                                <div class="attr variable">
            <span class="name">new_settings_file</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.new_settings_file"></a>
    
    

                            </div>
                            <div id="NatalAspects.language_pack" class="classattr">
                                <div class="attr variable">
            <span class="name">language_pack</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.language_pack"></a>
    
    

                            </div>
                            <div id="NatalAspects.celestial_points" class="classattr">
                                <div class="attr variable">
            <span class="name">celestial_points</span><span class="annotation">: list[typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.celestial_points"></a>
    
    

                            </div>
                            <div id="NatalAspects.aspects_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects_settings</span><span class="annotation">: list[typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.aspects_settings"></a>
    
    

                            </div>
                            <div id="NatalAspects.axes_orbit_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">axes_orbit_settings</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.axes_orbit_settings"></a>
    
    

                            </div>
                            <div id="NatalAspects.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.active_points"></a>
    
    

                            </div>
                            <div id="NatalAspects.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span>

        
    </div>
    <a class="headerlink" href="#NatalAspects.active_aspects"></a>
    
    

                            </div>
                            <div id="NatalAspects.all_aspects" class="classattr">
                                        <input id="NatalAspects.all_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">all_aspects</span>

                <label class="view-source-button" for="NatalAspects.all_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NatalAspects.all_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NatalAspects.all_aspects-721"><a href="#NatalAspects.all_aspects-721"><span class="linenos">721</span></a>    <span class="nd">@cached_property</span>
</span><span id="NatalAspects.all_aspects-722"><a href="#NatalAspects.all_aspects-722"><span class="linenos">722</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">all_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NatalAspects.all_aspects-723"><a href="#NatalAspects.all_aspects-723"><span class="linenos">723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="NatalAspects.all_aspects-724"><a href="#NatalAspects.all_aspects-724"><span class="linenos">724</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects.all_aspects-725"><a href="#NatalAspects.all_aspects-725"><span class="linenos">725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_aspects_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="NatalAspects.all_aspects-726"><a href="#NatalAspects.all_aspects-726"><span class="linenos">726</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span>
</span></pre></div>


            <div class="docstring"><p>Legacy property - returns the same as aspects for backwards compatibility.</p>
</div>


                            </div>
                            <div id="NatalAspects.relevant_aspects" class="classattr">
                                        <input id="NatalAspects.relevant_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">relevant_aspects</span>

                <label class="view-source-button" for="NatalAspects.relevant_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NatalAspects.relevant_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NatalAspects.relevant_aspects-728"><a href="#NatalAspects.relevant_aspects-728"><span class="linenos">728</span></a>    <span class="nd">@cached_property</span>
</span><span id="NatalAspects.relevant_aspects-729"><a href="#NatalAspects.relevant_aspects-729"><span class="linenos">729</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relevant_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NatalAspects.relevant_aspects-730"><a href="#NatalAspects.relevant_aspects-730"><span class="linenos">730</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="NatalAspects.relevant_aspects-731"><a href="#NatalAspects.relevant_aspects-731"><span class="linenos">731</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NatalAspects.relevant_aspects-732"><a href="#NatalAspects.relevant_aspects-732"><span class="linenos">732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_aspects_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="NatalAspects.relevant_aspects-733"><a href="#NatalAspects.relevant_aspects-733"><span class="linenos">733</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span>
</span></pre></div>


            <div class="docstring"><p>Legacy property - returns the same as aspects for backwards compatibility.</p>
</div>


                            </div>
                </section>
                <section id="SynastryAspects">
                            <input id="SynastryAspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SynastryAspects</span>:

                <label class="view-source-button" for="SynastryAspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SynastryAspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SynastryAspects-738"><a href="#SynastryAspects-738"><span class="linenos">738</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SynastryAspects</span><span class="p">:</span>
</span><span id="SynastryAspects-739"><a href="#SynastryAspects-739"><span class="linenos">739</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper replicating the master branch synastry aspects interface.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects-740"><a href="#SynastryAspects-740"><span class="linenos">740</span></a>
</span><span id="SynastryAspects-741"><a href="#SynastryAspects-741"><span class="linenos">741</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SynastryAspects-742"><a href="#SynastryAspects-742"><span class="linenos">742</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SynastryAspects-743"><a href="#SynastryAspects-743"><span class="linenos">743</span></a>        <span class="n">kr_object_one</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="SynastryAspects-744"><a href="#SynastryAspects-744"><span class="linenos">744</span></a>        <span class="n">kr_object_two</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="SynastryAspects-745"><a href="#SynastryAspects-745"><span class="linenos">745</span></a>        <span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects-746"><a href="#SynastryAspects-746"><span class="linenos">746</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="SynastryAspects-747"><a href="#SynastryAspects-747"><span class="linenos">747</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects-748"><a href="#SynastryAspects-748"><span class="linenos">748</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="SynastryAspects-749"><a href="#SynastryAspects-749"><span class="linenos">749</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects-750"><a href="#SynastryAspects-750"><span class="linenos">750</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects-751"><a href="#SynastryAspects-751"><span class="linenos">751</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects-752"><a href="#SynastryAspects-752"><span class="linenos">752</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;SynastryAspects&quot;</span><span class="p">,</span> <span class="s2">&quot;AspectsFactory.dual_chart_aspects&quot;</span><span class="p">)</span>
</span><span id="SynastryAspects-753"><a href="#SynastryAspects-753"><span class="linenos">753</span></a>
</span><span id="SynastryAspects-754"><a href="#SynastryAspects-754"><span class="linenos">754</span></a>        <span class="k">if</span> <span class="n">new_settings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects-755"><a href="#SynastryAspects-755"><span class="linenos">755</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="SynastryAspects-756"><a href="#SynastryAspects-756"><span class="linenos">756</span></a>                <span class="s2">&quot;&#39;new_settings_file&#39; is deprecated and ignored in Kerykeion v5. Use language_pack instead.&quot;</span><span class="p">,</span>
</span><span id="SynastryAspects-757"><a href="#SynastryAspects-757"><span class="linenos">757</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="SynastryAspects-758"><a href="#SynastryAspects-758"><span class="linenos">758</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="SynastryAspects-759"><a href="#SynastryAspects-759"><span class="linenos">759</span></a>            <span class="p">)</span>
</span><span id="SynastryAspects-760"><a href="#SynastryAspects-760"><span class="linenos">760</span></a>
</span><span id="SynastryAspects-761"><a href="#SynastryAspects-761"><span class="linenos">761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_user</span> <span class="o">=</span> <span class="n">kr_object_one</span><span class="o">.</span><span class="n">model</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kr_object_one</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">)</span> <span class="k">else</span> <span class="n">kr_object_one</span>
</span><span id="SynastryAspects-762"><a href="#SynastryAspects-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_user</span> <span class="o">=</span> <span class="n">kr_object_two</span><span class="o">.</span><span class="n">model</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kr_object_two</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">)</span> <span class="k">else</span> <span class="n">kr_object_two</span>
</span><span id="SynastryAspects-763"><a href="#SynastryAspects-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">new_settings_file</span> <span class="o">=</span> <span class="n">new_settings_file</span>
</span><span id="SynastryAspects-764"><a href="#SynastryAspects-764"><span class="linenos">764</span></a>
</span><span id="SynastryAspects-765"><a href="#SynastryAspects-765"><span class="linenos">765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span> <span class="o">=</span> <span class="n">language_pack</span>
</span><span id="SynastryAspects-766"><a href="#SynastryAspects-766"><span class="linenos">766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SynastryAspects-767"><a href="#SynastryAspects-767"><span class="linenos">767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SynastryAspects-768"><a href="#SynastryAspects-768"><span class="linenos">768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axes_orbit_settings</span> <span class="o">=</span> <span class="n">axis_orb_limit</span>
</span><span id="SynastryAspects-769"><a href="#SynastryAspects-769"><span class="linenos">769</span></a>
</span><span id="SynastryAspects-770"><a href="#SynastryAspects-770"><span class="linenos">770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="SynastryAspects-771"><a href="#SynastryAspects-771"><span class="linenos">771</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="n">_normalize_active_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="SynastryAspects-772"><a href="#SynastryAspects-772"><span class="linenos">772</span></a>        <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects-773"><a href="#SynastryAspects-773"><span class="linenos">773</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">)</span>
</span><span id="SynastryAspects-774"><a href="#SynastryAspects-774"><span class="linenos">774</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SynastryAspects-775"><a href="#SynastryAspects-775"><span class="linenos">775</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_aspects</span><span class="p">)</span>
</span><span id="SynastryAspects-776"><a href="#SynastryAspects-776"><span class="linenos">776</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="SynastryAspects-777"><a href="#SynastryAspects-777"><span class="linenos">777</span></a>
</span><span id="SynastryAspects-778"><a href="#SynastryAspects-778"><span class="linenos">778</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dual_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects-779"><a href="#SynastryAspects-779"><span class="linenos">779</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects-780"><a href="#SynastryAspects-780"><span class="linenos">780</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects-781"><a href="#SynastryAspects-781"><span class="linenos">781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects-782"><a href="#SynastryAspects-782"><span class="linenos">782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects-783"><a href="#SynastryAspects-783"><span class="linenos">783</span></a>
</span><span id="SynastryAspects-784"><a href="#SynastryAspects-784"><span class="linenos">784</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_dual_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects-785"><a href="#SynastryAspects-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dual_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects-786"><a href="#SynastryAspects-786"><span class="linenos">786</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dual_model</span> <span class="o">=</span> <span class="n">AspectsFactory</span><span class="o">.</span><span class="n">dual_chart_aspects</span><span class="p">(</span>
</span><span id="SynastryAspects-787"><a href="#SynastryAspects-787"><span class="linenos">787</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">first_user</span><span class="p">,</span>
</span><span id="SynastryAspects-788"><a href="#SynastryAspects-788"><span class="linenos">788</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">second_user</span><span class="p">,</span>
</span><span id="SynastryAspects-789"><a href="#SynastryAspects-789"><span class="linenos">789</span></a>                <span class="n">active_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span><span class="p">,</span>
</span><span id="SynastryAspects-790"><a href="#SynastryAspects-790"><span class="linenos">790</span></a>                <span class="n">active_aspects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span><span class="p">,</span>
</span><span id="SynastryAspects-791"><a href="#SynastryAspects-791"><span class="linenos">791</span></a>                <span class="n">axis_orb_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_orbit_settings</span><span class="p">,</span>
</span><span id="SynastryAspects-792"><a href="#SynastryAspects-792"><span class="linenos">792</span></a>                <span class="n">first_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SynastryAspects-793"><a href="#SynastryAspects-793"><span class="linenos">793</span></a>                <span class="n">second_subject_is_fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SynastryAspects-794"><a href="#SynastryAspects-794"><span class="linenos">794</span></a>            <span class="p">)</span>
</span><span id="SynastryAspects-795"><a href="#SynastryAspects-795"><span class="linenos">795</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dual_model</span>
</span><span id="SynastryAspects-796"><a href="#SynastryAspects-796"><span class="linenos">796</span></a>
</span><span id="SynastryAspects-797"><a href="#SynastryAspects-797"><span class="linenos">797</span></a>    <span class="nd">@cached_property</span>
</span><span id="SynastryAspects-798"><a href="#SynastryAspects-798"><span class="linenos">798</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">all_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects-799"><a href="#SynastryAspects-799"><span class="linenos">799</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects-800"><a href="#SynastryAspects-800"><span class="linenos">800</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects-801"><a href="#SynastryAspects-801"><span class="linenos">801</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_dual_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="SynastryAspects-802"><a href="#SynastryAspects-802"><span class="linenos">802</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span>
</span><span id="SynastryAspects-803"><a href="#SynastryAspects-803"><span class="linenos">803</span></a>
</span><span id="SynastryAspects-804"><a href="#SynastryAspects-804"><span class="linenos">804</span></a>    <span class="nd">@cached_property</span>
</span><span id="SynastryAspects-805"><a href="#SynastryAspects-805"><span class="linenos">805</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relevant_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects-806"><a href="#SynastryAspects-806"><span class="linenos">806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects-807"><a href="#SynastryAspects-807"><span class="linenos">807</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects-808"><a href="#SynastryAspects-808"><span class="linenos">808</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_dual_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="SynastryAspects-809"><a href="#SynastryAspects-809"><span class="linenos">809</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span>
</span><span id="SynastryAspects-810"><a href="#SynastryAspects-810"><span class="linenos">810</span></a>
</span><span id="SynastryAspects-811"><a href="#SynastryAspects-811"><span class="linenos">811</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relevant_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects-812"><a href="#SynastryAspects-812"><span class="linenos">812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy method for compatibility with master branch.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects-813"><a href="#SynastryAspects-813"><span class="linenos">813</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_aspects</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper replicating the master branch synastry aspects interface.</p>
</div>


                            <div id="SynastryAspects.__init__" class="classattr">
                                        <input id="SynastryAspects.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SynastryAspects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">kr_object_one</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AstrologicalSubject">AstrologicalSubject</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">]</span>,</span><span class="param">	<span class="n">kr_object_two</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#AstrologicalSubject">AstrologicalSubject</a></span><span class="p">,</span> <span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">AstrologicalSubjectModel</span><span class="p">]</span>,</span><span class="param">	<span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">active_points</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;True_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">,</span> <span class="s1">&#39;Pholus&#39;</span><span class="p">,</span> <span class="s1">&#39;Ceres&#39;</span><span class="p">,</span> <span class="s1">&#39;Pallas&#39;</span><span class="p">,</span> <span class="s1">&#39;Juno&#39;</span><span class="p">,</span> <span class="s1">&#39;Vesta&#39;</span><span class="p">,</span> <span class="s1">&#39;Eris&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedna&#39;</span><span class="p">,</span> <span class="s1">&#39;Haumea&#39;</span><span class="p">,</span> <span class="s1">&#39;Makemake&#39;</span><span class="p">,</span> <span class="s1">&#39;Ixion&#39;</span><span class="p">,</span> <span class="s1">&#39;Orcus&#39;</span><span class="p">,</span> <span class="s1">&#39;Quaoar&#39;</span><span class="p">,</span> <span class="s1">&#39;Regulus&#39;</span><span class="p">,</span> <span class="s1">&#39;Spica&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fortunae&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Spiritus&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Amoris&#39;</span><span class="p">,</span> <span class="s1">&#39;Pars_Fidei&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti_Vertex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sun&#39;</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">,</span> <span class="s1">&#39;True_North_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;True_South_Lunar_Node&#39;</span><span class="p">,</span> <span class="s1">&#39;Chiron&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean_Lilith&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium_Coeli&#39;</span><span class="p">,</span> <span class="s1">&#39;Descendant&#39;</span><span class="p">,</span> <span class="s1">&#39;Imum_Coeli&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">kerykeion</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">kr_models</span><span class="o">.</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SynastryAspects.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SynastryAspects.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SynastryAspects.__init__-741"><a href="#SynastryAspects.__init__-741"><span class="linenos">741</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SynastryAspects.__init__-742"><a href="#SynastryAspects.__init__-742"><span class="linenos">742</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-743"><a href="#SynastryAspects.__init__-743"><span class="linenos">743</span></a>        <span class="n">kr_object_one</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="SynastryAspects.__init__-744"><a href="#SynastryAspects.__init__-744"><span class="linenos">744</span></a>        <span class="n">kr_object_two</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstrologicalSubject</span><span class="p">,</span> <span class="n">AstrologicalSubjectModel</span><span class="p">],</span>
</span><span id="SynastryAspects.__init__-745"><a href="#SynastryAspects.__init__-745"><span class="linenos">745</span></a>        <span class="n">new_settings_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-746"><a href="#SynastryAspects.__init__-746"><span class="linenos">746</span></a>        <span class="n">active_points</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AstrologicalPoint</span><span class="p">]]</span> <span class="o">=</span> <span class="n">DEFAULT_ACTIVE_POINTS</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-747"><a href="#SynastryAspects.__init__-747"><span class="linenos">747</span></a>        <span class="n">active_aspects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ActiveAspect</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-748"><a href="#SynastryAspects.__init__-748"><span class="linenos">748</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-749"><a href="#SynastryAspects.__init__-749"><span class="linenos">749</span></a>        <span class="n">language_pack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-750"><a href="#SynastryAspects.__init__-750"><span class="linenos">750</span></a>        <span class="n">axis_orb_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-751"><a href="#SynastryAspects.__init__-751"><span class="linenos">751</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects.__init__-752"><a href="#SynastryAspects.__init__-752"><span class="linenos">752</span></a>        <span class="n">_deprecated</span><span class="p">(</span><span class="s2">&quot;SynastryAspects&quot;</span><span class="p">,</span> <span class="s2">&quot;AspectsFactory.dual_chart_aspects&quot;</span><span class="p">)</span>
</span><span id="SynastryAspects.__init__-753"><a href="#SynastryAspects.__init__-753"><span class="linenos">753</span></a>
</span><span id="SynastryAspects.__init__-754"><a href="#SynastryAspects.__init__-754"><span class="linenos">754</span></a>        <span class="k">if</span> <span class="n">new_settings_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects.__init__-755"><a href="#SynastryAspects.__init__-755"><span class="linenos">755</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="SynastryAspects.__init__-756"><a href="#SynastryAspects.__init__-756"><span class="linenos">756</span></a>                <span class="s2">&quot;&#39;new_settings_file&#39; is deprecated and ignored in Kerykeion v5. Use language_pack instead.&quot;</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-757"><a href="#SynastryAspects.__init__-757"><span class="linenos">757</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-758"><a href="#SynastryAspects.__init__-758"><span class="linenos">758</span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="SynastryAspects.__init__-759"><a href="#SynastryAspects.__init__-759"><span class="linenos">759</span></a>            <span class="p">)</span>
</span><span id="SynastryAspects.__init__-760"><a href="#SynastryAspects.__init__-760"><span class="linenos">760</span></a>
</span><span id="SynastryAspects.__init__-761"><a href="#SynastryAspects.__init__-761"><span class="linenos">761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_user</span> <span class="o">=</span> <span class="n">kr_object_one</span><span class="o">.</span><span class="n">model</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kr_object_one</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">)</span> <span class="k">else</span> <span class="n">kr_object_one</span>
</span><span id="SynastryAspects.__init__-762"><a href="#SynastryAspects.__init__-762"><span class="linenos">762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">second_user</span> <span class="o">=</span> <span class="n">kr_object_two</span><span class="o">.</span><span class="n">model</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kr_object_two</span><span class="p">,</span> <span class="n">AstrologicalSubject</span><span class="p">)</span> <span class="k">else</span> <span class="n">kr_object_two</span>
</span><span id="SynastryAspects.__init__-763"><a href="#SynastryAspects.__init__-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">new_settings_file</span> <span class="o">=</span> <span class="n">new_settings_file</span>
</span><span id="SynastryAspects.__init__-764"><a href="#SynastryAspects.__init__-764"><span class="linenos">764</span></a>
</span><span id="SynastryAspects.__init__-765"><a href="#SynastryAspects.__init__-765"><span class="linenos">765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">language_pack</span> <span class="o">=</span> <span class="n">language_pack</span>
</span><span id="SynastryAspects.__init__-766"><a href="#SynastryAspects.__init__-766"><span class="linenos">766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">celestial_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SynastryAspects.__init__-767"><a href="#SynastryAspects.__init__-767"><span class="linenos">767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aspects_settings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SynastryAspects.__init__-768"><a href="#SynastryAspects.__init__-768"><span class="linenos">768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axes_orbit_settings</span> <span class="o">=</span> <span class="n">axis_orb_limit</span>
</span><span id="SynastryAspects.__init__-769"><a href="#SynastryAspects.__init__-769"><span class="linenos">769</span></a>
</span><span id="SynastryAspects.__init__-770"><a href="#SynastryAspects.__init__-770"><span class="linenos">770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="SynastryAspects.__init__-771"><a href="#SynastryAspects.__init__-771"><span class="linenos">771</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_active_points</span> <span class="o">=</span> <span class="n">_normalize_active_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_points</span><span class="p">)</span>
</span><span id="SynastryAspects.__init__-772"><a href="#SynastryAspects.__init__-772"><span class="linenos">772</span></a>        <span class="k">if</span> <span class="n">active_aspects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects.__init__-773"><a href="#SynastryAspects.__init__-773"><span class="linenos">773</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEFAULT_ACTIVE_ASPECTS</span><span class="p">)</span>
</span><span id="SynastryAspects.__init__-774"><a href="#SynastryAspects.__init__-774"><span class="linenos">774</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SynastryAspects.__init__-775"><a href="#SynastryAspects.__init__-775"><span class="linenos">775</span></a>            <span class="n">active_aspects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_aspects</span><span class="p">)</span>
</span><span id="SynastryAspects.__init__-776"><a href="#SynastryAspects.__init__-776"><span class="linenos">776</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_aspects</span> <span class="o">=</span> <span class="n">active_aspects</span>
</span><span id="SynastryAspects.__init__-777"><a href="#SynastryAspects.__init__-777"><span class="linenos">777</span></a>
</span><span id="SynastryAspects.__init__-778"><a href="#SynastryAspects.__init__-778"><span class="linenos">778</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dual_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects.__init__-779"><a href="#SynastryAspects.__init__-779"><span class="linenos">779</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects.__init__-780"><a href="#SynastryAspects.__init__-780"><span class="linenos">780</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects.__init__-781"><a href="#SynastryAspects.__init__-781"><span class="linenos">781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SynastryAspects.__init__-782"><a href="#SynastryAspects.__init__-782"><span class="linenos">782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="SynastryAspects.first_user" class="classattr">
                                <div class="attr variable">
            <span class="name">first_user</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.first_user"></a>
    
    

                            </div>
                            <div id="SynastryAspects.second_user" class="classattr">
                                <div class="attr variable">
            <span class="name">second_user</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.second_user"></a>
    
    

                            </div>
                            <div id="SynastryAspects.new_settings_file" class="classattr">
                                <div class="attr variable">
            <span class="name">new_settings_file</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.new_settings_file"></a>
    
    

                            </div>
                            <div id="SynastryAspects.language_pack" class="classattr">
                                <div class="attr variable">
            <span class="name">language_pack</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.language_pack"></a>
    
    

                            </div>
                            <div id="SynastryAspects.celestial_points" class="classattr">
                                <div class="attr variable">
            <span class="name">celestial_points</span><span class="annotation">: list[typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.celestial_points"></a>
    
    

                            </div>
                            <div id="SynastryAspects.aspects_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">aspects_settings</span><span class="annotation">: list[typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.aspects_settings"></a>
    
    

                            </div>
                            <div id="SynastryAspects.axes_orbit_settings" class="classattr">
                                <div class="attr variable">
            <span class="name">axes_orbit_settings</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.axes_orbit_settings"></a>
    
    

                            </div>
                            <div id="SynastryAspects.active_points" class="classattr">
                                <div class="attr variable">
            <span class="name">active_points</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.active_points"></a>
    
    

                            </div>
                            <div id="SynastryAspects.active_aspects" class="classattr">
                                <div class="attr variable">
            <span class="name">active_aspects</span>

        
    </div>
    <a class="headerlink" href="#SynastryAspects.active_aspects"></a>
    
    

                            </div>
                            <div id="SynastryAspects.all_aspects" class="classattr">
                                        <input id="SynastryAspects.all_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">all_aspects</span>

                <label class="view-source-button" for="SynastryAspects.all_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SynastryAspects.all_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SynastryAspects.all_aspects-797"><a href="#SynastryAspects.all_aspects-797"><span class="linenos">797</span></a>    <span class="nd">@cached_property</span>
</span><span id="SynastryAspects.all_aspects-798"><a href="#SynastryAspects.all_aspects-798"><span class="linenos">798</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">all_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects.all_aspects-799"><a href="#SynastryAspects.all_aspects-799"><span class="linenos">799</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects.all_aspects-800"><a href="#SynastryAspects.all_aspects-800"><span class="linenos">800</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects.all_aspects-801"><a href="#SynastryAspects.all_aspects-801"><span class="linenos">801</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_dual_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="SynastryAspects.all_aspects-802"><a href="#SynastryAspects.all_aspects-802"><span class="linenos">802</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_aspects_cache</span>
</span></pre></div>


            <div class="docstring"><p>Legacy property - returns the same as aspects for backwards compatibility.</p>
</div>


                            </div>
                            <div id="SynastryAspects.relevant_aspects" class="classattr">
                                        <input id="SynastryAspects.relevant_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">relevant_aspects</span>

                <label class="view-source-button" for="SynastryAspects.relevant_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SynastryAspects.relevant_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SynastryAspects.relevant_aspects-804"><a href="#SynastryAspects.relevant_aspects-804"><span class="linenos">804</span></a>    <span class="nd">@cached_property</span>
</span><span id="SynastryAspects.relevant_aspects-805"><a href="#SynastryAspects.relevant_aspects-805"><span class="linenos">805</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relevant_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects.relevant_aspects-806"><a href="#SynastryAspects.relevant_aspects-806"><span class="linenos">806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy property - returns the same as aspects for backwards compatibility.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects.relevant_aspects-807"><a href="#SynastryAspects.relevant_aspects-807"><span class="linenos">807</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SynastryAspects.relevant_aspects-808"><a href="#SynastryAspects.relevant_aspects-808"><span class="linenos">808</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_dual_model</span><span class="p">()</span><span class="o">.</span><span class="n">aspects</span><span class="p">)</span>
</span><span id="SynastryAspects.relevant_aspects-809"><a href="#SynastryAspects.relevant_aspects-809"><span class="linenos">809</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relevant_aspects_cache</span>
</span></pre></div>


            <div class="docstring"><p>Legacy property - returns the same as aspects for backwards compatibility.</p>
</div>


                            </div>
                            <div id="SynastryAspects.get_relevant_aspects" class="classattr">
                                        <input id="SynastryAspects.get_relevant_aspects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_relevant_aspects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SynastryAspects.get_relevant_aspects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SynastryAspects.get_relevant_aspects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SynastryAspects.get_relevant_aspects-811"><a href="#SynastryAspects.get_relevant_aspects-811"><span class="linenos">811</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_relevant_aspects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SynastryAspects.get_relevant_aspects-812"><a href="#SynastryAspects.get_relevant_aspects-812"><span class="linenos">812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Legacy method for compatibility with master branch.&quot;&quot;&quot;</span>
</span><span id="SynastryAspects.get_relevant_aspects-813"><a href="#SynastryAspects.get_relevant_aspects-813"><span class="linenos">813</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_aspects</span>
</span></pre></div>


            <div class="docstring"><p>Legacy method for compatibility with master branch.</p>
</div>


                            </div>
                </section>
    </main>
</body>
</html>